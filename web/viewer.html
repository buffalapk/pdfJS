<!DOCTYPE html>
<!--
Copyright 2012 Mozilla Foundation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

Adobe CMap resources are covered by their own copyright but the same license:

    Copyright 1990-2015 Adobe Systems Incorporated.

See https://github.com/adobe-type-tools/cmap-resources
-->
<html dir="ltr" mozdisallowselectionprint>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="google" content="notranslate">
    <title>PDF.js viewer</title>

<!-- This snippet is used in production (included from viewer.html) -->
<link rel="resource" type="application/l10n" href="data:application/json;base64,eyJqYSI6ImRhdGE6YXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO2Jhc2U2NCxJeUJVYUdseklGTnZkWEpqWlNCRGIyUmxJRVp2Y20wZ2FYTWdjM1ZpYW1WamRDQjBieUIwYUdVZ2RHVnliWE1nYjJZZ2RHaGxJRTF2ZW1sc2JHRWdVSFZpYkdsakNpTWdUR2xqWlc1elpTd2dkaTRnTWk0d0xpQkpaaUJoSUdOdmNIa2diMllnZEdobElFMVFUQ0IzWVhNZ2JtOTBJR1JwYzNSeWFXSjFkR1ZrSUhkcGRHZ2dkR2hwY3dvaklHWnBiR1VzSUZsdmRTQmpZVzRnYjJKMFlXbHVJRzl1WlNCaGRDQm9kSFJ3T2k4dmJXOTZhV3hzWVM1dmNtY3ZUVkJNTHpJdU1DOHVDZ29LSXlNZ1RXRnBiaUIwYjI5c1ltRnlJR0oxZEhSdmJuTWdLSFJ2YjJ4MGFYQnpJR0Z1WkNCaGJIUWdkR1Y0ZENCbWIzSWdhVzFoWjJWektRb0tjR1JtYW5NdGNISmxkbWx2ZFhNdFluVjBkRzl1SUQwS0lDQWdJQzUwYVhSc1pTQTlJT1dKamVPQnJ1T0RtdU9Edk9PQ3VPT0J1T2FJdStPQ2l1T0J2dU9CbVFwd1pHWnFjeTF3Y21WMmFXOTFjeTFpZFhSMGIyNHRiR0ZpWld3Z1BTRGxpWTNqZ2JnS2NHUm1hbk10Ym1WNGRDMWlkWFIwYjI0Z1BRb2dJQ0FnTG5ScGRHeGxJRDBnNXF5aDQ0R3U0NE9hNDRPODQ0SzQ0NEc0NllDeTQ0Ry80NEcrNDRHWkNuQmtabXB6TFc1bGVIUXRZblYwZEc5dUxXeGhZbVZzSUQwZzVxeWg0NEc0Q2lNZ0xuUnBkR3hsT2lCVWIyOXNkR2x3SUdadmNpQjBhR1VnY0dGblpVNTFiV0psY2lCcGJuQjFkQzRLY0dSbWFuTXRjR0ZuWlMxcGJuQjFkQ0E5Q2lBZ0lDQXVkR2wwYkdVZ1BTRGpnNXJqZzd6amdyZ0tJeUJXWVhKcFlXSnNaWE02Q2lNZ0lDQWtjR0ZuWlhORGIzVnVkQ0FvVG5WdFltVnlLU0F0SUhSb1pTQjBiM1JoYkNCdWRXMWlaWElnYjJZZ2NHRm5aWE1nYVc0Z2RHaGxJR1J2WTNWdFpXNTBDaU1nVkdocGN5QnpkSEpwYm1jZ1ptOXNiRzkzY3lCaGJpQnBibkIxZENCbWFXVnNaQ0IzYVhSb0lIUm9aU0J1ZFcxaVpYSWdiMllnZEdobElIQmhaMlVnWTNWeWNtVnVkR3g1SUdScGMzQnNZWGxsWkM0S2NHUm1hbk10YjJZdGNHRm5aWE1nUFNBdklIc2dKSEJoWjJWelEyOTFiblFnZlFvaklGWmhjbWxoWW14bGN6b0tJeUFnSUNSd1lXZGxUblZ0WW1WeUlDaE9kVzFpWlhJcElDMGdkR2hsSUdOMWNuSmxiblJzZVNCMmFYTnBZbXhsSUhCaFoyVUtJeUFnSUNSd1lXZGxjME52ZFc1MElDaE9kVzFpWlhJcElDMGdkR2hsSUhSdmRHRnNJRzUxYldKbGNpQnZaaUJ3WVdkbGN5QnBiaUIwYUdVZ1pHOWpkVzFsYm5RS2NHUm1hbk10Y0dGblpTMXZaaTF3WVdkbGN5QTlJQ2g3SUNSd1lXZGxUblZ0WW1WeUlIMGdMeUI3SUNSd1lXZGxjME52ZFc1MElIMHBDbkJrWm1wekxYcHZiMjB0YjNWMExXSjFkSFJ2YmlBOUNpQWdJQ0F1ZEdsMGJHVWdQU0Rvb2FqbnBMcmpncExudUs3bHNJL2pnWmZqZ2I3amdaa0tjR1JtYW5NdGVtOXZiUzF2ZFhRdFluVjBkRzl1TFd4aFltVnNJRDBnNTdpdTViQ1BDbkJrWm1wekxYcHZiMjB0YVc0dFluVjBkRzl1SUQwS0lDQWdJQzUwYVhSc1pTQTlJT2locU9la3V1T0NrdWFMb2VXa3ArT0JsK09CdnVPQm1RcHdaR1pxY3kxNmIyOXRMV2x1TFdKMWRIUnZiaTFzWVdKbGJDQTlJT2FMb2VXa3B3cHdaR1pxY3kxNmIyOXRMWE5sYkdWamRDQTlDaUFnSUNBdWRHbDBiR1VnUFNEbWk2SGxwS2N2NTdpdTViQ1BDbkJrWm1wekxYQnlaWE5sYm5SaGRHbHZiaTF0YjJSbExXSjFkSFJ2YmlBOUNpQWdJQ0F1ZEdsMGJHVWdQU0RqZzVmamc2empncnpqZzdQamc0YmpnN3pqZ3Jmamc2ZmpnN1BqZzZMamc3empnNG5qZ2F2bGlJZmpnb3JtbTcvamdZampnYjdqZ1prS2NHUm1hbk10Y0hKbGMyVnVkR0YwYVc5dUxXMXZaR1V0WW5WMGRHOXVMV3hoWW1Wc0lEMGc0NE9YNDRPczQ0Szg0NE96NDRPRzQ0Tzg0NEszNDRPbjQ0T3o0NE9pNDRPODQ0T0pDbkJrWm1wekxXOXdaVzR0Wm1sc1pTMWlkWFIwYjI0Z1BRb2dJQ0FnTG5ScGRHeGxJRDBnNDRPVjQ0S2g0NEtrNDRPcjQ0S1M2WmFMNDRHTjQ0Rys0NEdaQ25Ca1ptcHpMVzl3Wlc0dFptbHNaUzFpZFhSMGIyNHRiR0ZpWld3Z1BTRHBsb3ZqZ1k4S2NHUm1hbk10Y0hKcGJuUXRZblYwZEc5dUlEMEtJQ0FnSUM1MGFYUnNaU0E5SU9XTnNPV0l0K09CbCtPQnZ1T0JtUXB3WkdacWN5MXdjbWx1ZEMxaWRYUjBiMjR0YkdGaVpXd2dQU0RsamJEbGlMY0tjR1JtYW5NdGMyRjJaUzFpZFhSMGIyNGdQUW9nSUNBZ0xuUnBkR3hsSUQwZzVMK2Q1YTJZNDRHWDQ0Rys0NEdaQ25Ca1ptcHpMWE5oZG1VdFluVjBkRzl1TFd4aFltVnNJRDBnNUwrZDVhMllDaU1nVlhObFpDQnBiaUJHYVhKbFptOTRJR1p2Y2lCQmJtUnliMmxrSUdGeklHRWdkRzl2YkhScGNDQm1iM0lnZEdobElHUnZkMjVzYjJGa0lHSjFkSFJ2YmlBbzRvQ2NaRzkzYm14dllXVGlnSjBnYVhNZ1lTQjJaWEppS1M0S2NHUm1hbk10Wkc5M2JteHZZV1F0WW5WMGRHOXVJRDBLSUNBZ0lDNTBhWFJzWlNBOUlPT0RnT09DcHVPRHMrT0RyZU9Edk9PRGllT0JsK09CdnVPQm1Rb2pJRlZ6WldRZ2FXNGdSbWx5WldadmVDQm1iM0lnUVc1a2NtOXBaQ0JoY3lCaElHeGhZbVZzSUdadmNpQjBhR1VnWkc5M2JteHZZV1FnWW5WMGRHOXVJQ2ppZ0p4a2IzZHViRzloWk9LQW5TQnBjeUJoSUhabGNtSXBMZ29qSUV4bGJtZDBhQ0J2WmlCMGFHVWdkSEpoYm5Oc1lYUnBiMjRnYldGMGRHVnljeUJ6YVc1alpTQjNaU0JoY21VZ2FXNGdZU0J0YjJKcGJHVWdZMjl1ZEdWNGRDd2dkMmwwYUNCc2FXMXBkR1ZrSUhOamNtVmxiaUJsYzNSaGRHVXVDbkJrWm1wekxXUnZkMjVzYjJGa0xXSjFkSFJ2Ymkxc1lXSmxiQ0E5SU9PRGdPT0NwdU9EcytPRHJlT0R2T09EaVFwd1pHWnFjeTFpYjI5cmJXRnlheTFpZFhSMGIyNGdQUW9nSUNBZ0xuUnBkR3hsSUQwZzU0Kys1WnlvNDRHdTQ0T2E0NE84NDRLNDQ0R3VJRlZTVENEamdhZmpnWmtnS09lUHZ1V2NxT09CcnVPRG11T0R2T09DdU9PQ2t1aWhxT2VrdXVPQm1lT0NpeUJWVWt3cENuQmtabXB6TFdKdmIydHRZWEpyTFdKMWRIUnZiaTFzWVdKbGJDQTlJT2VQdnVXY3FPT0JydU9EbXVPRHZPT0N1QW9LSXlNZ0lGTmxZMjl1WkdGeWVTQjBiMjlzWW1GeUlHRnVaQ0JqYjI1MFpYaDBJRzFsYm5VS0NuQmtabXB6TFhSdmIyeHpMV0oxZEhSdmJpQTlDaUFnSUNBdWRHbDBiR1VnUFNEamc0VGpnN3pqZzZzS2NHUm1hbk10ZEc5dmJITXRZblYwZEc5dUxXeGhZbVZzSUQwZzQ0T0U0NE84NDRPckNuQmtabXB6TFdacGNuTjBMWEJoWjJVdFluVjBkRzl1SUQwS0lDQWdJQzUwYVhSc1pTQTlJT2FjZ09XSW5lT0JydU9EbXVPRHZPT0N1T09CdU9lbnUrV0xsZU9CbCtPQnZ1T0JtUXB3WkdacWN5MW1hWEp6ZEMxd1lXZGxMV0oxZEhSdmJpMXNZV0psYkNBOUlPYWNnT1dJbmVPQnJ1T0RtdU9Edk9PQ3VPT0J1T2VudStXTGxRcHdaR1pxY3kxc1lYTjBMWEJoWjJVdFluVjBkRzl1SUQwS0lDQWdJQzUwYVhSc1pTQTlJT2FjZ09XK2pPT0JydU9EbXVPRHZPT0N1T09CdU9lbnUrV0xsZU9CbCtPQnZ1T0JtUXB3WkdacWN5MXNZWE4wTFhCaFoyVXRZblYwZEc5dUxXeGhZbVZzSUQwZzVweUE1YjZNNDRHdTQ0T2E0NE84NDRLNDQ0RzQ1NmU3NVl1VkNuQmtabXB6TFhCaFoyVXRjbTkwWVhSbExXTjNMV0oxZEhSdmJpQTlDaUFnSUNBdWRHbDBiR1VnUFNEamc1cmpnN3pqZ3JqamdwTGxqN1BqZ2JqbG01N291NkxqZ1pmamdiN2pnWmtLY0dSbWFuTXRjR0ZuWlMxeWIzUmhkR1V0WTNjdFluVjBkRzl1TFd4aFltVnNJRDBnNVkrejVadWU2THVpQ25Ca1ptcHpMWEJoWjJVdGNtOTBZWFJsTFdOamR5MWlkWFIwYjI0Z1BRb2dJQ0FnTG5ScGRHeGxJRDBnNDRPYTQ0Tzg0NEs0NDRLUzViZW00NEc0NVp1ZTZMdWk0NEdYNDRHKzQ0R1pDbkJrWm1wekxYQmhaMlV0Y205MFlYUmxMV05qZHkxaWRYUjBiMjR0YkdGaVpXd2dQU0RsdDZibG01N291NklLY0dSbWFuTXRZM1Z5YzI5eUxYUmxlSFF0YzJWc1pXTjBMWFJ2YjJ3dFluVjBkRzl1SUQwS0lDQWdJQzUwYVhSc1pTQTlJT09EaHVPQ3JlT0N1ZU9EaU9tQnVPYUtudU9EaE9PRHZPT0RxK09Da3VhY2llV0t1ZU9CcStPQmwrT0J2dU9CbVFwd1pHWnFjeTFqZFhKemIzSXRkR1Y0ZEMxelpXeGxZM1F0ZEc5dmJDMWlkWFIwYjI0dGJHRmlaV3dnUFNEamc0YmpncTNqZ3Juamc0anBnYmptaXA3amc0VGpnN3pqZzZzS2NHUm1hbk10WTNWeWMyOXlMV2hoYm1RdGRHOXZiQzFpZFhSMGIyNGdQUW9nSUNBZ0xuUnBkR3hsSUQwZzVvbUw0NEd1NDRHeTQ0S0o0NE9FNDRPODQ0T3I0NEtTNXB5SjVZcTU0NEdyNDRHWDQ0Rys0NEdaQ25Ca1ptcHpMV04xY25OdmNpMW9ZVzVrTFhSdmIyd3RZblYwZEc5dUxXeGhZbVZzSUQwZzVvbUw0NEd1NDRHeTQ0S0o0NE9FNDRPODQ0T3JDbkJrWm1wekxYTmpjbTlzYkMxd1lXZGxMV0oxZEhSdmJpQTlDaUFnSUNBdWRHbDBiR1VnUFNEamc1cmpnN3pqZ3JqbGpaamt2WTNqZ2FmamdybmpncS9qZzYzamc3empnNnZqZ1pmamdiN2pnWmtLY0dSbWFuTXRjMk55YjJ4c0xYQmhaMlV0WW5WMGRHOXVMV3hoWW1Wc0lEMGc0NE9hNDRPODQ0SzQ1WTJZNUwyTjQ0R240NEs1NDRLdjQ0T3Q0NE84NDRPckNuQmtabXB6TFhOamNtOXNiQzEyWlhKMGFXTmhiQzFpZFhSMGIyNGdQUW9nSUNBZ0xuUnBkR3hsSUQwZzU3aW00NEs1NDRLdjQ0T3Q0NE84NDRPcjQ0R3I0NEdYNDRHKzQ0R1pDbkJrWm1wekxYTmpjbTlzYkMxMlpYSjBhV05oYkMxaWRYUjBiMjR0YkdGaVpXd2dQU0RudUtiamdybmpncS9qZzYzamc3empnNnNLY0dSbWFuTXRjMk55YjJ4c0xXaHZjbWw2YjI1MFlXd3RZblYwZEc5dUlEMEtJQ0FnSUM1MGFYUnNaU0E5SU9hb3F1T0N1ZU9DcitPRHJlT0R2T09EcStPQnErT0JsK09CdnVPQm1RcHdaR1pxY3kxelkzSnZiR3d0YUc5eWFYcHZiblJoYkMxaWRYUjBiMjR0YkdGaVpXd2dQU0RtcUtyamdybmpncS9qZzYzamc3empnNnNLY0dSbWFuTXRjMk55YjJ4c0xYZHlZWEJ3WldRdFluVjBkRzl1SUQwS0lDQWdJQzUwYVhSc1pTQTlJT2FLbU9PQ2l1aS9sT09CbCtPQ3VlT0NyK09EcmVPRHZPT0RxK09CcStPQmwrT0J2dU9CbVFwd1pHWnFjeTF6WTNKdmJHd3RkM0poY0hCbFpDMWlkWFIwYjI0dGJHRmlaV3dnUFNEbWlwampnb3JvdjVUamdaZmpncm5qZ3Evamc2M2pnN3pqZzZzS2NHUm1hbk10YzNCeVpXRmtMVzV2Ym1VdFluVjBkRzl1SUQwS0lDQWdJQzUwYVhSc1pTQTlJT2ltaSttV2krT0JqZU9CcStPQmwrT0J2dU9CbStPQ2t3cHdaR1pxY3kxemNISmxZV1F0Ym05dVpTMWlkWFIwYjI0dGJHRmlaV3dnUFNEb3BvdnBsb3ZqZ1kzamdhdmpnWmZqZ2FyamdZUUtjR1JtYW5NdGMzQnlaV0ZrTFc5a1pDMWlkWFIwYjI0Z1BRb2dJQ0FnTG5ScGRHeGxJRDBnNWFXSDVwV3c0NE9hNDRPODQ0SzQ2WmFMNWFlTDQ0R242S2FMNlphTDQ0R040NEdyNDRHWDQ0Rys0NEdaQ25Ca1ptcHpMWE53Y21WaFpDMXZaR1F0WW5WMGRHOXVMV3hoWW1Wc0lEMGc1YVdINXBXdzQ0T2E0NE84NDRLNDZLYUw2WmFMNDRHTkNuQmtabXB6TFhOd2NtVmhaQzFsZG1WdUxXSjFkSFJ2YmlBOUNpQWdJQ0F1ZEdsMGJHVWdQU0RsZ2JibWxiRGpnNXJqZzd6amdyanBsb3ZscDR2amdhZm9wb3ZwbG92amdZM2pnYXZqZ1pmamdiN2pnWmtLY0dSbWFuTXRjM0J5WldGa0xXVjJaVzR0WW5WMGRHOXVMV3hoWW1Wc0lEMGc1WUcyNXBXdzQ0T2E0NE84NDRLNDZLYUw2WmFMNDRHTkNnb2pJeUJFYjJOMWJXVnVkQ0J3Y205d1pYSjBhV1Z6SUdScFlXeHZad29LY0dSbWFuTXRaRzlqZFcxbGJuUXRjSEp2Y0dWeWRHbGxjeTFpZFhSMGIyNGdQUW9nSUNBZ0xuUnBkR3hsSUQwZzVwYUg1cHU0NDRHdTQ0T1g0NE90NDRPUjQ0T0c0NEtqTGk0dUNuQmtabXB6TFdSdlkzVnRaVzUwTFhCeWIzQmxjblJwWlhNdFluVjBkRzl1TFd4aFltVnNJRDBnNXBhSDVwdTQ0NEd1NDRPWDQ0T3Q0NE9SNDRPRzQ0S2pMaTR1Q25Ca1ptcHpMV1J2WTNWdFpXNTBMWEJ5YjNCbGNuUnBaWE10Wm1sc1pTMXVZVzFsSUQwZzQ0T1Y0NEtoNDRLazQ0T3I1WkNOT2dwd1pHWnFjeTFrYjJOMWJXVnVkQzF3Y205d1pYSjBhV1Z6TFdacGJHVXRjMmw2WlNBOUlPT0RsZU9Db2VPQ3BPT0RxK09DdGVPQ3BPT0N1am9LSXlCV1lYSnBZV0pzWlhNNkNpTWdJQ0FrYTJJZ0tFNTFiV0psY2lrZ0xTQjBhR1VnVUVSR0lHWnBiR1VnYzJsNlpTQnBiaUJyYVd4dllubDBaWE1LSXlBZ0lDUmlJQ2hPZFcxaVpYSXBJQzBnZEdobElGQkVSaUJtYVd4bElITnBlbVVnYVc0Z1lubDBaWE1LY0dSbWFuTXRaRzlqZFcxbGJuUXRjSEp2Y0dWeWRHbGxjeTF6YVhwbExXdGlJRDBnZXlCT1ZVMUNSVklvSkd0aUxDQnRZWGhwYlhWdFUybG5ibWxtYVdOaGJuUkVhV2RwZEhNNklETXBJSDBnUzBJZ0tIc2dKR0lnZlNEamc1RGpncVRqZzRncENpTWdWbUZ5YVdGaWJHVnpPZ29qSUNBZ0pHMWlJQ2hPZFcxaVpYSXBJQzBnZEdobElGQkVSaUJtYVd4bElITnBlbVVnYVc0Z2JXVm5ZV0o1ZEdWekNpTWdJQ0FrWWlBb1RuVnRZbVZ5S1NBdElIUm9aU0JRUkVZZ1ptbHNaU0J6YVhwbElHbHVJR0o1ZEdWekNuQmtabXB6TFdSdlkzVnRaVzUwTFhCeWIzQmxjblJwWlhNdGMybDZaUzF0WWlBOUlIc2dUbFZOUWtWU0tDUnRZaXdnYldGNGFXMTFiVk5wWjI1cFptbGpZVzUwUkdsbmFYUnpPaUF6S1NCOUlFMUNJQ2g3SUNSaUlIMGc0NE9RNDRLazQ0T0lLUW9qSUZaaGNtbGhZbXhsY3pvS0l5QWdJQ1J6YVhwbFgydGlJQ2hPZFcxaVpYSXBJQzBnZEdobElGQkVSaUJtYVd4bElITnBlbVVnYVc0Z2EybHNiMko1ZEdWekNpTWdJQ0FrYzJsNlpWOWlJQ2hPZFcxaVpYSXBJQzBnZEdobElGQkVSaUJtYVd4bElITnBlbVVnYVc0Z1lubDBaWE1LY0dSbWFuTXRaRzlqZFcxbGJuUXRjSEp2Y0dWeWRHbGxjeTFyWWlBOUlIc2dKSE5wZW1WZmEySWdmU0JMUWlBb2V5QWtjMmw2WlY5aUlIMGc0NE9RNDRLazQ0T0lLUW9qSUZaaGNtbGhZbXhsY3pvS0l5QWdJQ1J6YVhwbFgyMWlJQ2hPZFcxaVpYSXBJQzBnZEdobElGQkVSaUJtYVd4bElITnBlbVVnYVc0Z2JXVm5ZV0o1ZEdWekNpTWdJQ0FrYzJsNlpWOWlJQ2hPZFcxaVpYSXBJQzBnZEdobElGQkVSaUJtYVd4bElITnBlbVVnYVc0Z1lubDBaWE1LY0dSbWFuTXRaRzlqZFcxbGJuUXRjSEp2Y0dWeWRHbGxjeTF0WWlBOUlIc2dKSE5wZW1WZmJXSWdmU0JOUWlBb2V5QWtjMmw2WlY5aUlIMGc0NE9RNDRLazQ0T0lLUXB3WkdacWN5MWtiMk4xYldWdWRDMXdjbTl3WlhKMGFXVnpMWFJwZEd4bElEMGc0NEsvNDRLazQ0T0k0NE9yT2dwd1pHWnFjeTFrYjJOMWJXVnVkQzF3Y205d1pYSjBhV1Z6TFdGMWRHaHZjaUE5SU9TOW5PYUlrT2lBaFRvS2NHUm1hbk10Wkc5amRXMWxiblF0Y0hKdmNHVnlkR2xsY3kxemRXSnFaV04wSUQwZzVMdTI1WkNOT2dwd1pHWnFjeTFrYjJOMWJXVnVkQzF3Y205d1pYSjBhV1Z6TFd0bGVYZHZjbVJ6SUQwZzQ0S3Q0NE84NDRPdjQ0Tzg0NE9KT2dwd1pHWnFjeTFrYjJOMWJXVnVkQzF3Y205d1pYSjBhV1Z6TFdOeVpXRjBhVzl1TFdSaGRHVWdQU0Rrdlp6bWlKRG1sNlU2Q25Ca1ptcHpMV1J2WTNWdFpXNTBMWEJ5YjNCbGNuUnBaWE10Ylc5a2FXWnBZMkYwYVc5dUxXUmhkR1VnUFNEbW03VG1sckRtbDZVNkNpTWdWbUZ5YVdGaWJHVnpPZ29qSUNBZ0pHUmhkR1ZQWW1vZ0tFUmhkR1VwSUMwZ2RHaGxJR055WldGMGFXOXVMMjF2WkdsbWFXTmhkR2x2YmlCa1lYUmxJR0Z1WkNCMGFXMWxJRzltSUhSb1pTQlFSRVlnWm1sc1pRcHdaR1pxY3kxa2IyTjFiV1Z1ZEMxd2NtOXdaWEowYVdWekxXUmhkR1V0ZEdsdFpTMXpkSEpwYm1jZ1BTQjdJRVJCVkVWVVNVMUZLQ1JrWVhSbFQySnFMQ0JrWVhSbFUzUjViR1U2SUNKemFHOXlkQ0lzSUhScGJXVlRkSGxzWlRvZ0ltMWxaR2wxYlNJcElIMEtJeUJXWVhKcFlXSnNaWE02Q2lNZ0lDQWtaR0YwWlNBb1JHRjBaU2tnTFNCMGFHVWdZM0psWVhScGIyNHZiVzlrYVdacFkyRjBhVzl1SUdSaGRHVWdiMllnZEdobElGQkVSaUJtYVd4bENpTWdJQ0FrZEdsdFpTQW9WR2x0WlNrZ0xTQjBhR1VnWTNKbFlYUnBiMjR2Ylc5a2FXWnBZMkYwYVc5dUlIUnBiV1VnYjJZZ2RHaGxJRkJFUmlCbWFXeGxDbkJrWm1wekxXUnZZM1Z0Wlc1MExYQnliM0JsY25ScFpYTXRaR0YwWlMxemRISnBibWNnUFNCN0lDUmtZWFJsSUgwc0lIc2dKSFJwYldVZ2ZRcHdaR1pxY3kxa2IyTjFiV1Z1ZEMxd2NtOXdaWEowYVdWekxXTnlaV0YwYjNJZ1BTRGpncUxqZzVmamc2cmpnckhqZzd6amdyZmpnNmZqZzdNNkNuQmtabXB6TFdSdlkzVnRaVzUwTFhCeWIzQmxjblJwWlhNdGNISnZaSFZqWlhJZ1BTQlFSRVlnNUwyYzVvaVFPZ3B3WkdacWN5MWtiMk4xYldWdWRDMXdjbTl3WlhKMGFXVnpMWFpsY25OcGIyNGdQU0JRUkVZZzQ0R3U0NE9RNDRPODQ0SzQ0NE9uNDRPek9ncHdaR1pxY3kxa2IyTjFiV1Z1ZEMxd2NtOXdaWEowYVdWekxYQmhaMlV0WTI5MWJuUWdQU0RqZzVyamc3empncmptbGJBNkNuQmtabXB6TFdSdlkzVnRaVzUwTFhCeWIzQmxjblJwWlhNdGNHRm5aUzF6YVhwbElEMGc0NE9hNDRPODQ0SzQ0NEsxNDRLazQ0SzZPZ3B3WkdacWN5MWtiMk4xYldWdWRDMXdjbTl3WlhKMGFXVnpMWEJoWjJVdGMybDZaUzExYm1sMExXbHVZMmhsY3lBOUlHbHVDbkJrWm1wekxXUnZZM1Z0Wlc1MExYQnliM0JsY25ScFpYTXRjR0ZuWlMxemFYcGxMWFZ1YVhRdGJXbHNiR2x0WlhSbGNuTWdQU0J0YlFwd1pHWnFjeTFrYjJOMWJXVnVkQzF3Y205d1pYSjBhV1Z6TFhCaFoyVXRjMmw2WlMxdmNtbGxiblJoZEdsdmJpMXdiM0owY21GcGRDQTlJT2U0cGdwd1pHWnFjeTFrYjJOMWJXVnVkQzF3Y205d1pYSjBhV1Z6TFhCaFoyVXRjMmw2WlMxdmNtbGxiblJoZEdsdmJpMXNZVzVrYzJOaGNHVWdQU0RtcUtvS2NHUm1hbk10Wkc5amRXMWxiblF0Y0hKdmNHVnlkR2xsY3kxd1lXZGxMWE5wZW1VdGJtRnRaUzFoTFhSb2NtVmxJRDBnUVRNS2NHUm1hbk10Wkc5amRXMWxiblF0Y0hKdmNHVnlkR2xsY3kxd1lXZGxMWE5wZW1VdGJtRnRaUzFoTFdadmRYSWdQU0JCTkFwd1pHWnFjeTFrYjJOMWJXVnVkQzF3Y205d1pYSjBhV1Z6TFhCaFoyVXRjMmw2WlMxdVlXMWxMV3hsZEhSbGNpQTlJT09Eck9PQ3YrT0R2QXB3WkdacWN5MWtiMk4xYldWdWRDMXdjbTl3WlhKMGFXVnpMWEJoWjJVdGMybDZaUzF1WVcxbExXeGxaMkZzSUQwZzQ0T3E0NE84NDRLczQ0T3JDZ29qSXlCV1lYSnBZV0pzWlhNNkNpTWpJQ0FnSkhkcFpIUm9JQ2hPZFcxaVpYSXBJQzBnZEdobElIZHBaSFJvSUc5bUlIUm9aU0FvWTNWeWNtVnVkQ2tnY0dGblpRb2pJeUFnSUNSb1pXbG5hSFFnS0U1MWJXSmxjaWtnTFNCMGFHVWdhR1ZwWjJoMElHOW1JSFJvWlNBb1kzVnljbVZ1ZENrZ2NHRm5aUW9qSXlBZ0lDUjFibWwwSUNoVGRISnBibWNwSUMwZ2RHaGxJSFZ1YVhRZ2IyWWdiV1ZoYzNWeVpXMWxiblFnYjJZZ2RHaGxJQ2hqZFhKeVpXNTBLU0J3WVdkbENpTWpJQ0FnSkc1aGJXVWdLRk4wY21sdVp5a2dMU0IwYUdVZ2JtRnRaU0J2WmlCMGFHVWdLR04xY25KbGJuUXBJSEJoWjJVS0l5TWdJQ0FrYjNKcFpXNTBZWFJwYjI0Z0tGTjBjbWx1WnlrZ0xTQjBhR1VnYjNKcFpXNTBZWFJwYjI0Z2IyWWdkR2hsSUNoamRYSnlaVzUwS1NCd1lXZGxDZ3B3WkdacWN5MWtiMk4xYldWdWRDMXdjbTl3WlhKMGFXVnpMWEJoWjJVdGMybDZaUzFrYVcxbGJuTnBiMjR0YzNSeWFXNW5JRDBnZXlBa2QybGtkR2dnZlNERGx5QjdJQ1JvWldsbmFIUWdmU0I3SUNSMWJtbDBJSDBnS0hzZ0pHOXlhV1Z1ZEdGMGFXOXVJSDBwQ25Ca1ptcHpMV1J2WTNWdFpXNTBMWEJ5YjNCbGNuUnBaWE10Y0dGblpTMXphWHBsTFdScGJXVnVjMmx2YmkxdVlXMWxMWE4wY21sdVp5QTlJSHNnSkhkcFpIUm9JSDBndzVjZ2V5QWthR1ZwWjJoMElIMGdleUFrZFc1cGRDQjlJQ2g3SUNSdVlXMWxJSDBzSUhzZ0pHOXlhV1Z1ZEdGMGFXOXVJSDBwQ2dvakl3b0tJeUJVYUdVZ2JHbHVaV0Z5YVhwaGRHbHZiaUJ6ZEdGMGRYTWdiMllnZEdobElHUnZZM1Z0Wlc1ME95QjFjM1ZoYkd4NUlHTmhiR3hsWkNBaVJtRnpkQ0JYWldJZ1ZtbGxkeUlnYVc0S0l5QkZibWRzYVhOb0lHeHZZMkZzWlhNZ2IyWWdRV1J2WW1VZ2MyOW1kSGRoY21VdUNuQmtabXB6TFdSdlkzVnRaVzUwTFhCeWIzQmxjblJwWlhNdGJHbHVaV0Z5YVhwbFpDQTlJT09DcHVPQ3ArT0RsdWlocU9la3V1ZVVxT09CcSthY2dPbUJxZVdNbGpvS2NHUm1hbk10Wkc5amRXMWxiblF0Y0hKdmNHVnlkR2xsY3kxc2FXNWxZWEpwZW1Wa0xYbGxjeUE5SU9PQnIrT0JoQXB3WkdacWN5MWtiMk4xYldWdWRDMXdjbTl3WlhKMGFXVnpMV3hwYm1WaGNtbDZaV1F0Ym04Z1BTRGpnWVRqZ1lUamdZZ0tjR1JtYW5NdFpHOWpkVzFsYm5RdGNISnZjR1Z5ZEdsbGN5MWpiRzl6WlMxaWRYUjBiMjRnUFNEcGxvbmpnWmpqZ29zS0NpTWpJRkJ5YVc1MENncHdaR1pxY3kxd2NtbHVkQzF3Y205bmNtVnpjeTF0WlhOellXZGxJRDBnNXBhSDVwdTQ0NEd1NVkydzVZaTM0NEtTNXJxVzVZS1o0NEdYNDRHbTQ0R0U0NEcrNDRHWkxpNHVDaU1nVm1GeWFXRmliR1Z6T2dvaklDQWdKSEJ5YjJkeVpYTnpJQ2hPZFcxaVpYSXBJQzBnY0dWeVkyVnVkQ0IyWVd4MVpRcHdaR1pxY3kxd2NtbHVkQzF3Y205bmNtVnpjeTF3WlhKalpXNTBJRDBnZXlBa2NISnZaM0psYzNNZ2ZTVUtjR1JtYW5NdGNISnBiblF0Y0hKdlozSmxjM010WTJ4dmMyVXRZblYwZEc5dUlEMGc0NEt0NDRPajQ0T3o0NEs3NDRPckNuQmtabXB6TFhCeWFXNTBhVzVuTFc1dmRDMXpkWEJ3YjNKMFpXUWdQU0RvcmFibGtZbzZJT09CaytPQnJ1T0RsdU9EcWVPQ3B1T0N0dU9Edk9PQnArT0JyK1dOc09XSXQrT0JqT1d1ak9XRnFPT0JxK09DdGVPRG5lT0R2T09EaU9PQmxlT0NqT09CcHVPQmhPT0J2dU9CbStPQ2srT0FnZ3B3WkdacWN5MXdjbWx1ZEdsdVp5MXViM1F0Y21WaFpIa2dQU0RvcmFibGtZbzZJRkJFUmlEamdwTGxqYkRsaUxmamdabmpnb3ZqZ1ovamdvSGpnYTdvcXEzamdiL292cnpqZ2IvamdZem50WUxrdW9iamdaZmpnYWJqZ1lUamdiN2pnWnZqZ3BQamdJSUtDaU1qSUZSdmIyeDBhWEJ6SUdGdVpDQmhiSFFnZEdWNGRDQm1iM0lnYzJsa1pTQndZVzVsYkNCMGIyOXNZbUZ5SUdKMWRIUnZibk1LQ25Ca1ptcHpMWFJ2WjJkc1pTMXphV1JsWW1GeUxXSjFkSFJ2YmlBOUNpQWdJQ0F1ZEdsMGJHVWdQU0RqZ3JYamdxVGpnNG5qZzVEamc3em9vYWpucExyamdwTGxpSWZqZ29ybW03L2pnWWpqZ2I3amdaa0tjR1JtYW5NdGRHOW5aMnhsTFhOcFpHVmlZWEl0Ym05MGFXWnBZMkYwYVc5dUxXSjFkSFJ2YmlBOUNpQWdJQ0F1ZEdsMGJHVWdQU0RqZ3JYamdxVGpnNG5qZzVEamc3em9vYWpucExyamdwTGxpSWZqZ29ybW03L2pnWWpqZ2I3amdaa2dLT2FXaCthYnVPT0JxK1dRcStPQnZ1T0NqT09DaStPQ291T0NwdU9EaU9PRHFlT0NwT09Ec3lBdklPYTN1K1M3bUNBdklPT0RyT09DcE9PRHBPT0R2Q2tLY0dSbWFuTXRkRzluWjJ4bExYTnBaR1ZpWVhJdFluVjBkRzl1TFd4aFltVnNJRDBnNDRLMTQ0S2s0NE9KNDRPUTQ0Tzg0NEd1NVlpSDQ0S0s1cHUvNDRHSUNuQmtabXB6TFdSdlkzVnRaVzUwTFc5MWRHeHBibVV0WW5WMGRHOXVJRDBLSUNBZ0lDNTBhWFJzWlNBOUlPYVdoK2FidU9PQnJ1ZWJydWFzb2VPQ2t1aWhxT2VrdXVPQmwrT0J2dU9CbVNBbzQ0T0E0NE9XNDRPcjQ0S3Y0NE9xNDRPRDQ0S3Y0NEduNmFDRjU1dXU0NEtTNlphTDZaYUo0NEdYNDRHKzQ0R1pLUXB3WkdacWN5MWtiMk4xYldWdWRDMXZkWFJzYVc1bExXSjFkSFJ2Ymkxc1lXSmxiQ0E5SU9hV2grYWJ1T09CcnVlYnJ1YXNvUXB3WkdacWN5MWhkSFJoWTJodFpXNTBjeTFpZFhSMGIyNGdQUW9nSUNBZ0xuUnBkR3hsSUQwZzVyZTc1THVZNDRPVjQ0S2g0NEtrNDRPcjQ0S1M2S0dvNTZTNjQ0R1g0NEcrNDRHWkNuQmtabXB6TFdGMGRHRmphRzFsYm5SekxXSjFkSFJ2Ymkxc1lXSmxiQ0E5SU9hM3UrUzdtT09EbGVPQ29lT0NwT09EcXdwd1pHWnFjeTFzWVhsbGNuTXRZblYwZEc5dUlEMEtJQ0FnSUM1MGFYUnNaU0E5SU9PRHJPT0NwT09EcE9PRHZPT0NrdWlocU9la3V1T0JsK09CdnVPQm1TQW80NE9BNDRPVzQ0T3I0NEt2NDRPcTQ0T0Q0NEt2NDRHbjQ0R1o0NEc1NDRHbTQ0R3U0NE9zNDRLazQ0T2s0NE84NDRHTTVZaWQ1cHlmNTRxMjVvV0w0NEdyNW9pNzQ0S0s0NEcrNDRHWktRcHdaR1pxY3kxc1lYbGxjbk10WW5WMGRHOXVMV3hoWW1Wc0lEMGc0NE9zNDRLazQ0T2s0NE84Q25Ca1ptcHpMWFJvZFcxaWN5MWlkWFIwYjI0Z1BRb2dJQ0FnTG5ScGRHeGxJRDBnNTdpdTViQ1A1NG1JNDRLUzZLR281NlM2NDRHWDQ0Rys0NEdaQ25Ca1ptcHpMWFJvZFcxaWN5MWlkWFIwYjI0dGJHRmlaV3dnUFNEbnVLN2xzSS9uaVlnS2NHUm1hbk10WTNWeWNtVnVkQzF2ZFhSc2FXNWxMV2wwWlcwdFluVjBkRzl1SUQwS0lDQWdJQzUwYVhSc1pTQTlJT2VQdnVXY3FPT0JydU9Db3VPQ3B1T0RpT09EcWVPQ3BPT0RzK21naGVlYnJ1T0NrdWFrbk9lMG9ncHdaR1pxY3kxamRYSnlaVzUwTFc5MWRHeHBibVV0YVhSbGJTMWlkWFIwYjI0dGJHRmlaV3dnUFNEbmo3N2xuS2pqZ2E3amdxTGpncWJqZzRqamc2bmpncVRqZzdQcG9JWG5tNjRLY0dSbWFuTXRabWx1WkdKaGNpMWlkWFIwYjI0Z1BRb2dJQ0FnTG5ScGRHeGxJRDBnNXBhSDVwdTQ1WWFGNDRLUzVxU2M1N1NpNDRHWDQ0Rys0NEdaQ25Ca1ptcHpMV1pwYm1SaVlYSXRZblYwZEc5dUxXeGhZbVZzSUQwZzVxU2M1N1NpQ25Ca1ptcHpMV0ZrWkdsMGFXOXVZV3d0YkdGNVpYSnpJRDBnNkwrOTVZcWc0NE9zNDRLazQ0T2s0NE84Q2dvakl5QlVhSFZ0WW01aGFXeHpJSEJoYm1Wc0lHbDBaVzBnS0hSdmIyeDBhWEFnWVc1a0lHRnNkQ0IwWlhoMElHWnZjaUJwYldGblpYTXBDZ29qSUZaaGNtbGhZbXhsY3pvS0l5QWdJQ1J3WVdkbElDaE9kVzFpWlhJcElDMGdkR2hsSUhCaFoyVWdiblZ0WW1WeUNuQmtabXB6TFhSb2RXMWlMWEJoWjJVdGRHbDBiR1VnUFFvZ0lDQWdMblJwZEd4bElEMGdleUFrY0dGblpTQjlJT09EbXVPRHZPT0N1QW9qSUZaaGNtbGhZbXhsY3pvS0l5QWdJQ1J3WVdkbElDaE9kVzFpWlhJcElDMGdkR2hsSUhCaFoyVWdiblZ0WW1WeUNuQmtabXB6TFhSb2RXMWlMWEJoWjJVdFkyRnVkbUZ6SUQwS0lDQWdJQzVoY21saExXeGhZbVZzSUQwZ2V5QWtjR0ZuWlNCOUlPT0RtdU9Edk9PQ3VPT0JydWU0cnVXd2orZUppQW9LSXlNZ1JtbHVaQ0J3WVc1bGJDQmlkWFIwYjI0Z2RHbDBiR1VnWVc1a0lHMWxjM05oWjJWekNncHdaR1pxY3kxbWFXNWtMV2x1Y0hWMElEMEtJQ0FnSUM1MGFYUnNaU0E5SU9ha25PZTBvZ29nSUNBZ0xuQnNZV05sYUc5c1pHVnlJRDBnNXBhSDVwdTQ1WWFGNDRLUzVxU2M1N1NpTGk0dUNuQmtabXB6TFdacGJtUXRjSEpsZG1sdmRYTXRZblYwZEc5dUlEMEtJQ0FnSUM1MGFYUnNaU0E5SU9lUHZ1V2NxT09DaU9PQ2l1V0pqZU9CcnVTOWplZTlydU9CcCthTWgrV3VtdWFXaCtXdGwrV0lsK09Cak9lUHZ1T0NqT09DaSttRHFPV0lodU9Da3Vha25PZTBvdU9CbCtPQnZ1T0JtUXB3WkdacWN5MW1hVzVrTFhCeVpYWnBiM1Z6TFdKMWRIUnZiaTFzWVdKbGJDQTlJT1dKamVPQnVBcHdaR1pxY3kxbWFXNWtMVzVsZUhRdFluVjBkRzl1SUQwS0lDQWdJQzUwYVhSc1pTQTlJT2VQdnVXY3FPT0NpT09DaXVXK2pPT0JydVM5amVlOXJ1T0JwK2FNaCtXdW11YVdoK1d0bCtXSWwrT0JqT2VQdnVPQ2pPT0NpK21EcU9XSWh1T0NrdWFrbk9lMG91T0JsK09CdnVPQm1RcHdaR1pxY3kxbWFXNWtMVzVsZUhRdFluVjBkRzl1TFd4aFltVnNJRDBnNXF5aDQ0RzRDbkJrWm1wekxXWnBibVF0YUdsbmFHeHBaMmgwTFdOb1pXTnJZbTk0SUQwZzQ0R1o0NEc1NDRHbTVieTM2S3EvNktHbzU2UzZDbkJrWm1wekxXWnBibVF0YldGMFkyZ3RZMkZ6WlMxamFHVmphMkp2ZUMxc1lXSmxiQ0E5SU9Xa3ArYVdoK1d0bHkvbHNJL21sb2ZsclpmamdwTGxqTHJsaUtVS2NHUm1hbk10Wm1sdVpDMXRZWFJqYUMxa2FXRmpjbWwwYVdOekxXTm9aV05yWW05NExXeGhZbVZzSUQwZzU1bTY2Wit6NVl5NjVZaWw1NnltNVkrMzQ0S1M1WXk2NVlpbENuQmtabXB6TFdacGJtUXRaVzUwYVhKbExYZHZjbVF0WTJobFkydGliM2d0YkdGaVpXd2dQU0Rsalpqb3FwN2t1SURvaDdRS2NHUm1hbk10Wm1sdVpDMXlaV0ZqYUdWa0xYUnZjQ0E5SU9hV2grYWJ1T1dGaU9tZ3JlT0JxK1dJc09tQmxPT0JsK09CbitPQnJ1T0JwK2FjcStXd3Z1T0JpK09DaWVlMm11T0JrZU9CcHVha25PZTBvdU9CbCtPQnZ1T0JtUXB3WkdacWN5MW1hVzVrTFhKbFlXTm9aV1F0WW05MGRHOXRJRDBnNXBhSDVwdTQ1cHlyNWJDKzQ0R3I1WWl3NllHVTQ0R1g0NEdmNDRHdTQ0R241WVdJNmFDdDQ0R0w0NEtKNTdhYTQ0R1I0NEdtNXFTYzU3U2k0NEdYNDRHKzQ0R1pDaU1nVm1GeWFXRmliR1Z6T2dvaklDQWdKR04xY25KbGJuUWdLRTUxYldKbGNpa2dMU0IwYUdVZ2FXNWtaWGdnYjJZZ2RHaGxJR04xY25KbGJuUnNlU0JoWTNScGRtVWdabWx1WkNCeVpYTjFiSFFLSXlBZ0lDUjBiM1JoYkNBb1RuVnRZbVZ5S1NBdElIUm9aU0IwYjNSaGJDQnVkVzFpWlhJZ2IyWWdiV0YwWTJobGN5QnBiaUIwYUdVZ1pHOWpkVzFsYm5RS2NHUm1hbk10Wm1sdVpDMXRZWFJqYUMxamIzVnVkQ0E5SUhzZ0pIUnZkR0ZzSUgwZzVMdTI1TGl0SUhzZ0pHTjFjbkpsYm5RZ2ZTRGt1N2JubTY0S0l5QldZWEpwWVdKc1pYTTZDaU1nSUNBa2JHbHRhWFFnS0U1MWJXSmxjaWtnTFNCMGFHVWdiV0Y0YVcxMWJTQnVkVzFpWlhJZ2IyWWdiV0YwWTJobGN3cHdaR1pxY3kxbWFXNWtMVzFoZEdOb0xXTnZkVzUwTFd4cGJXbDBJRDBnZXlBa2JHbHRhWFFnZlNEa3U3Ymt1NlhrdUlya3VJRG9oN1FLY0dSbWFuTXRabWx1WkMxdWIzUXRabTkxYm1RZ1BTRG9wb3ZqZ2FUamdZdmpnb3JqZ2I3amdadmpncFBqZ2FmamdaZmpnWjhLQ2lNaklGQnlaV1JsWm1sdVpXUWdlbTl2YlNCMllXeDFaWE1LQ25Ca1ptcHpMWEJoWjJVdGMyTmhiR1V0ZDJsa2RHZ2dQU0RsdVlYamdhdmxrSWpqZ28vamdadmpnb3NLY0dSbWFuTXRjR0ZuWlMxelkyRnNaUzFtYVhRZ1BTRGpnNXJqZzd6amdyampnYTdqZ3JYamdxVGpncnJqZ2F2bGtJampnby9qZ1p2amdvc0tjR1JtYW5NdGNHRm5aUzF6WTJGc1pTMWhkWFJ2SUQwZzZJZXE1WXVWNDRLNjQ0Tzg0NE9nQ25Ca1ptcHpMWEJoWjJVdGMyTmhiR1V0WVdOMGRXRnNJRDBnNWE2ZjZacWI0NEd1NDRLMTQ0S2s0NEs2Q2lNZ1ZtRnlhV0ZpYkdWek9nb2pJQ0FnSkhOallXeGxJQ2hPZFcxaVpYSXBJQzBnY0dWeVkyVnVkQ0IyWVd4MVpTQm1iM0lnY0dGblpTQnpZMkZzWlFwd1pHWnFjeTF3WVdkbExYTmpZV3hsTFhCbGNtTmxiblFnUFNCN0lDUnpZMkZzWlNCOUpRb0tJeU1nVUVSR0lIQmhaMlVLQ2lNZ1ZtRnlhV0ZpYkdWek9nb2pJQ0FnSkhCaFoyVWdLRTUxYldKbGNpa2dMU0IwYUdVZ2NHRm5aU0J1ZFcxaVpYSUtjR1JtYW5NdGNHRm5aUzFzWVc1a2JXRnlheUE5Q2lBZ0lDQXVZWEpwWVMxc1lXSmxiQ0E5SUhzZ0pIQmhaMlVnZlNEamc1cmpnN3pqZ3JnS0NpTWpJRXh2WVdScGJtY2dhVzVrYVdOaGRHOXlJRzFsYzNOaFoyVnpDZ3B3WkdacWN5MXNiMkZrYVc1bkxXVnljbTl5SUQwZ1VFUkdJT09CcnVpcXJlT0J2K2krdk9PQnYrUzRyZU9CcStPQ3FPT0RxZU9Edk9PQmpPZVp1dWVVbitPQmwrT0J2dU9CbCtPQm4rT0FnZ3B3WkdacWN5MXBiblpoYkdsa0xXWnBiR1V0WlhKeWIzSWdQU0RuaEtIbGlybmpnYjdqZ1ovamdhL25vTFRta0kzamdaZmpnWjhnVUVSR0lPT0RsZU9Db2VPQ3BPT0RxK09BZ2dwd1pHWnFjeTF0YVhOemFXNW5MV1pwYkdVdFpYSnliM0lnUFNCUVJFWWc0NE9WNDRLaDQ0S2s0NE9yNDRHTTZLYUw0NEdrNDRHTDQ0S0s0NEcrNDRHYjQ0S1Q0NENDQ25Ca1ptcHpMWFZ1Wlhod1pXTjBaV1F0Y21WemNHOXVjMlV0WlhKeWIzSWdQU0RqZ3JYamc3empnNURqZzd6amdZdmpnb25rdW9qbW5KL2pnWnZqZ2F6bHY1em5yWlRqZ1l6amdZTGpnb3JqZ2I3amdaZmpnWi9qZ0lJS2NHUm1hbk10Y21WdVpHVnlhVzVuTFdWeWNtOXlJRDBnNDRPYTQ0Tzg0NEs0NDRHdTQ0T3M0NE96NDRPQTQ0T3E0NE96NDRLdzVMaXQ0NEdyNDRLbzQ0T3A0NE84NDRHTTU1bTY1NVNmNDRHWDQ0Rys0NEdYNDRHZjQ0Q0NDZ29qSXlCQmJtNXZkR0YwYVc5dWN3b0tJeUJXWVhKcFlXSnNaWE02Q2lNZ0lDQWtaR0YwWlNBb1JHRjBaU2tnTFNCMGFHVWdiVzlrYVdacFkyRjBhVzl1SUdSaGRHVWdiMllnZEdobElHRnVibTkwWVhScGIyNEtJeUFnSUNSMGFXMWxJQ2hVYVcxbEtTQXRJSFJvWlNCdGIyUnBabWxqWVhScGIyNGdkR2x0WlNCdlppQjBhR1VnWVc1dWIzUmhkR2x2Ymdwd1pHWnFjeTFoYm01dmRHRjBhVzl1TFdSaGRHVXRjM1J5YVc1bklEMGdleUFrWkdGMFpTQjlMQ0I3SUNSMGFXMWxJSDBLSXlBdVlXeDBPaUJVYUdseklHbHpJSFZ6WldRZ1lYTWdZU0IwYjI5c2RHbHdMZ29qSUZaaGNtbGhZbXhsY3pvS0l5QWdJQ1IwZVhCbElDaFRkSEpwYm1jcElDMGdZVzRnWVc1dWIzUmhkR2x2YmlCMGVYQmxJR1p5YjIwZ1lTQnNhWE4wSUdSbFptbHVaV1FnYVc0Z2RHaGxJRkJFUmlCemNHVmpDaU1nS0RNeU1EQXdMVEU2TWpBd09DQlVZV0pzWlNBeE5qa2c0b0NUSUVGdWJtOTBZWFJwYjI0Z2RIbHdaWE1wTGdvaklGTnZiV1VnWTI5dGJXOXVJSFI1Y0dWeklHRnlaU0JsTG1jdU9pQWlRMmhsWTJzaUxDQWlWR1Y0ZENJc0lDSkRiMjF0Wlc1MElpd2dJazV2ZEdVaUNuQmtabXB6TFhSbGVIUXRZVzV1YjNSaGRHbHZiaTEwZVhCbElEMEtJQ0FnSUM1aGJIUWdQU0JiZXlBa2RIbHdaU0I5SU9henFPbUhpRjBLSXlCV1lYSnBZV0pzWlhNNkNpTWdJQ0FrWkdGMFpVOWlhaUFvUkdGMFpTa2dMU0IwYUdVZ2JXOWthV1pwWTJGMGFXOXVJR1JoZEdVZ1lXNWtJSFJwYldVZ2IyWWdkR2hsSUdGdWJtOTBZWFJwYjI0S2NHUm1hbk10WVc1dWIzUmhkR2x2Ymkxa1lYUmxMWFJwYldVdGMzUnlhVzVuSUQwZ2V5QkVRVlJGVkVsTlJTZ2taR0YwWlU5aWFpd2daR0YwWlZOMGVXeGxPaUFpYzJodmNuUWlMQ0IwYVcxbFUzUjViR1U2SUNKdFpXUnBkVzBpS1NCOUNnb2pJeUJRWVhOemQyOXlaQW9LY0dSbWFuTXRjR0Z6YzNkdmNtUXRiR0ZpWld3Z1BTRGpnWlBqZ2E0Z1VFUkdJT09EbGVPQ29lT0NwT09EcStPQ2t1bVdpK09CaitPQm4rT0NnZU9CcnVPRGtlT0N1ZU9EcitPRHZPT0RpZU9Da3VXRnBlV0ttK09CbCtPQnB1T0JqK09Cb09PQmxlT0JoT09BZ2dwd1pHWnFjeTF3WVhOemQyOXlaQzFwYm5aaGJHbGtJRDBnNDRPUjQ0SzU0NE92NDRPODQ0T0o0NEdNNXEyajQ0R1g0NEdQNDRHQzQ0S0s0NEcrNDRHYjQ0S1Q0NENDNDRLQzQ0R0c1TGlBNWJxbTZLbW00NEdYNDRHbTQ0R1A0NEdnNDRHVjQ0R0U0NENDQ25Ca1ptcHpMWEJoYzNOM2IzSmtMVzlyTFdKMWRIUnZiaUE5SUU5TENuQmtabXB6TFhCaGMzTjNiM0prTFdOaGJtTmxiQzFpZFhSMGIyNGdQU0RqZ3Ezamc2UGpnN1BqZ3J2amc2c0tjR1JtYW5NdGQyVmlMV1p2Ym5SekxXUnBjMkZpYkdWa0lEMGc0NEttNDRLbjQ0T1c0NE9WNDRLcDQ0T3o0NE9JNDRHTTU0U2g1WXE1NDRHcjQ0R3E0NEdqNDRHbTQ0R0U0NEcrNDRHWk9pRGxuNHZqZ29Ib3ZyempnYjdqZ296amdaOGdVRVJHSU9PQnJ1T0RsZU9DcWVPRHMrT0RpT09Da3VTOXYrZVVxT09CcCtPQmplT0J2dU9CbStPQ2srT0FnZ29LSXlNZ1JXUnBkR2x1WndvS2NHUm1hbk10WldScGRHOXlMV1p5WldVdGRHVjRkQzFpZFhSMGIyNGdQUW9nSUNBZ0xuUnBkR3hsSUQwZzQ0T1Y0NE9xNDRPODQ0T0c0NEt0NDRLNTQ0T0k1ck9vNlllSTQ0S1M2TCs5NVlxZzQ0R1g0NEcrNDRHWkNuQmtabXB6TFdWa2FYUnZjaTFtY21WbExYUmxlSFF0WW5WMGRHOXVMV3hoWW1Wc0lEMGc0NE9WNDRPcTQ0Tzg0NE9HNDRLdDQ0SzU0NE9JNXJPbzZZZUlDbkJrWm1wekxXVmthWFJ2Y2kxcGJtc3RZblYwZEc5dUlEMEtJQ0FnSUM1MGFYUnNaU0E5SU9PQ3BPT0RzK09DcithenFPbUhpT09Da3VpL3ZlV0tvT09CbCtPQnZ1T0JtUXB3WkdacWN5MWxaR2wwYjNJdGFXNXJMV0oxZEhSdmJpMXNZV0psYkNBOUlPT0NwT09EcytPQ3IrYXpxT21IaUFwd1pHWnFjeTFsWkdsMGIzSXRjM1JoYlhBdFluVjBkRzl1SUQwS0lDQWdJQzUwYVhSc1pTQTlJT2VVdStXRGorT0NrdWkvdmVXS29PT0J2dU9CbitPQnIrZTNxT21iaHVPQmwrT0J2dU9CbVFwd1pHWnFjeTFsWkdsMGIzSXRjM1JoYlhBdFluVjBkRzl1TFd4aFltVnNJRDBnNTVTNzVZT1A0NEtTNkwrOTVZcWc0NEcrNDRHZjQ0R3Y1N2VvNlp1R0NuQmtabXB6TFdWa2FYUnZjaTFvYVdkb2JHbG5hSFF0WW5WMGRHOXVJRDBLSUNBZ0lDNTBhWFJzWlNBOUlPVzh0K2lxditPQmwrT0J2dU9CbVFwd1pHWnFjeTFsWkdsMGIzSXRhR2xuYUd4cFoyaDBMV0oxZEhSdmJpMXNZV0psYkNBOUlPVzh0K2lxdndwd1pHWnFjeTFvYVdkb2JHbG5hSFF0Wm14dllYUnBibWN0WW5WMGRHOXVNU0E5Q2lBZ0lDQXVkR2wwYkdVZ1BTRGx2TGZvcXI4S0lDQWdJQzVoY21saExXeGhZbVZzSUQwZzVieTM2S3EvNDRHWDQ0Rys0NEdaQ25Ca1ptcHpMV2hwWjJoc2FXZG9kQzFtYkc5aGRHbHVaeTFpZFhSMGIyNHRiR0ZpWld3Z1BTRGx2TGZvcXI4S2NHUm1hbk10WldScGRHOXlMWE5wWjI1aGRIVnlaUzFpZFhSMGIyNGdQUW9nSUNBZ0xuUnBkR3hsSUQwZzU3Mnk1WkNONDRLUzZMKzk1WXFnNDRHWDQ0Rys0NEdaQ25Ca1ptcHpMV1ZrYVhSdmNpMXphV2R1WVhSMWNtVXRZblYwZEc5dUxXeGhZbVZzSUQwZzU3Mnk1WkNONDRLUzZMKzk1WXFnQ2dvakl5QkVaV1poZFd4MElHVmthWFJ2Y2lCaGNtbGhJR3hoWW1Wc2N3b0tJeURpZ0p4SWFXZG9iR2xuYUhUaWdKMGdhWE1nWVNCdWIzVnVMQ0IwYUdVZ2MzUnlhVzVuSUdseklIVnpaV1FnYjI0Z2RHaGxJR1ZrYVhSdmNpQm1iM0lnYUdsbmFHeHBaMmgwY3k0S2NHUm1hbk10WldScGRHOXlMV2hwWjJoc2FXZG9kQzFsWkdsMGIzSWdQUW9nSUNBZ0xtRnlhV0V0YkdGaVpXd2dQU0Rsdkxmb3FyL2pncWpqZzRmamdxUGpnci9qZzd3S0l5RGlnSnhFY21GM2FXNW40b0NkSUdseklHRWdibTkxYml3Z2RHaGxJSE4wY21sdVp5QnBjeUIxYzJWa0lHOXVJSFJvWlNCbFpHbDBiM0lnWm05eUlHUnlZWGRwYm1kekxncHdaR1pxY3kxbFpHbDBiM0l0YVc1ckxXVmthWFJ2Y2lBOUNpQWdJQ0F1WVhKcFlTMXNZV0psYkNBOUlPYVBqK2VVdStPQ3FPT0RoK09DbytPQ3YrT0R2QW9qSUZWelpXUWdkMmhsYmlCaElITnBaMjVoZEhWeVpTQmxaR2wwYjNJZ2FYTWdjMlZzWldOMFpXUXZhRzkyWlhKbFpDNEtJeUJXWVhKcFlXSnNaWE02Q2lNZ0lDQWtaR1Z6WTNKcGNIUnBiMjRnS0ZOMGNtbHVaeWtnTFNCaElITjBjbWx1WnlCa1pYTmpjbWxpYVc1bkwyeGhZbVZzYVc1bklIUm9aU0J6YVdkdVlYUjFjbVV1Q25Ca1ptcHpMV1ZrYVhSdmNpMXphV2R1WVhSMWNtVXRaV1JwZEc5eU1TQTlDaUFnSUNBdVlYSnBZUzFrWlhOamNtbHdkR2x2YmlBOUlPZTlzdVdRamVPQ3FPT0RoK09DbytPQ3YrT0R2RG9nZXlBa1pHVnpZM0pwY0hScGIyNGdmUXB3WkdacWN5MWxaR2wwYjNJdGMzUmhiWEF0WldScGRHOXlJRDBLSUNBZ0lDNWhjbWxoTFd4aFltVnNJRDBnNTVTNzVZT1A0NEtvNDRPSDQ0S2o0NEsvNDRPOENnb2pJeUJTWlcxdmRtVWdZblYwZEc5dUlHWnZjaUIwYUdVZ2RtRnlhVzkxY3lCcmFXNWtJRzltSUdWa2FYUnZjaTRLQ25Ca1ptcHpMV1ZrYVhSdmNpMXlaVzF2ZG1VdGFXNXJMV0oxZEhSdmJpQTlDaUFnSUNBdWRHbDBiR1VnUFNEamdxVGpnN1BqZ3EvbXM2anBoNGpqZ3BMbGlZcnBtYVRqZ1pmamdiN2pnWmtLY0dSbWFuTXRaV1JwZEc5eUxYSmxiVzkyWlMxbWNtVmxkR1Y0ZEMxaWRYUjBiMjRnUFFvZ0lDQWdMblJwZEd4bElEMGc0NE9HNDRLdDQ0SzU0NE9JNDRLUzVZbUs2Wm1rNDRHWDQ0Rys0NEdaQ25Ca1ptcHpMV1ZrYVhSdmNpMXlaVzF2ZG1VdGMzUmhiWEF0WW5WMGRHOXVJRDBLSUNBZ0lDNTBhWFJzWlNBOUlPZVV1K1dEaitPQ2t1V0ppdW1acE9PQmwrT0J2dU9CbVFwd1pHWnFjeTFsWkdsMGIzSXRjbVZ0YjNabExXaHBaMmhzYVdkb2RDMWlkWFIwYjI0Z1BRb2dJQ0FnTG5ScGRHeGxJRDBnNWJ5MzZLcS80NEtTNVltSzZabWs0NEdYNDRHKzQ0R1pDbkJrWm1wekxXVmthWFJ2Y2kxeVpXMXZkbVV0YzJsbmJtRjBkWEpsTFdKMWRIUnZiaUE5Q2lBZ0lDQXVkR2wwYkdVZ1BTRG52Ykxsa0kzamdwTGxpWXJwbWFUamdaZmpnYjdqZ1prS0NpTWpDZ29qSUVWa2FYUnZjaUJRWVhKaGJXVjBaWEp6Q25Ca1ptcHpMV1ZrYVhSdmNpMW1jbVZsTFhSbGVIUXRZMjlzYjNJdGFXNXdkWFFnUFNEb2liSUtjR1JtYW5NdFpXUnBkRzl5TFdaeVpXVXRkR1Y0ZEMxemFYcGxMV2x1Y0hWMElEMGc0NEsxNDRLazQ0SzZDbkJrWm1wekxXVmthWFJ2Y2kxcGJtc3RZMjlzYjNJdGFXNXdkWFFnUFNEb2liSUtjR1JtYW5NdFpXUnBkRzl5TFdsdWF5MTBhR2xqYTI1bGMzTXRhVzV3ZFhRZ1BTRGxwS3JqZ1pVS2NHUm1hbk10WldScGRHOXlMV2x1YXkxdmNHRmphWFI1TFdsdWNIVjBJRDBnNUxpTjZZQ1A1cGlPNWJxbUNuQmtabXB6TFdWa2FYUnZjaTF6ZEdGdGNDMWhaR1F0YVcxaFoyVXRZblYwZEc5dUlEMEtJQ0FnSUM1MGFYUnNaU0E5SU9lVXUrV0RqK09Da3VpL3ZlV0tvT09CbCtPQnZ1T0JtUXB3WkdacWN5MWxaR2wwYjNJdGMzUmhiWEF0WVdSa0xXbHRZV2RsTFdKMWRIUnZiaTFzWVdKbGJDQTlJT2VVdStXRGorT0NrdWkvdmVXS29Bb2pJRlJvYVhNZ2NtVm1aWEp6SUhSdklIUm9aU0IwYUdsamEyNWxjM01nYjJZZ2RHaGxJR3hwYm1VZ2RYTmxaQ0JtYjNJZ1puSmxaU0JvYVdkb2JHbG5hSFJwYm1jZ0tHNXZkQ0JpYjNWdVpDQjBieUIwWlhoMEtRcHdaR1pxY3kxbFpHbDBiM0l0Wm5KbFpTMW9hV2RvYkdsbmFIUXRkR2hwWTJ0dVpYTnpMV2x1Y0hWMElEMGc1YVNxNDRHVkNuQmtabXB6TFdWa2FYUnZjaTFtY21WbExXaHBaMmhzYVdkb2RDMTBhR2xqYTI1bGMzTXRkR2wwYkdVZ1BRb2dJQ0FnTG5ScGRHeGxJRDBnNDRPRzQ0S3Q0NEs1NDRPSTVMdWw1YVNXNDRHdTQ0S2k0NEtrNDRPRzQ0T2c0NEtTNWJ5MzZLcS80NEdaNDRLTDVwbUM0NEd1NWFTcTQ0R1Y0NEtTNWFTSjVwdTA0NEdYNDRHKzQ0R1pDbkJrWm1wekxXVmthWFJ2Y2kxaFpHUXRjMmxuYm1GMGRYSmxMV052Ym5SaGFXNWxjaUE5Q2lBZ0lDQXVZWEpwWVMxc1lXSmxiQ0E5SU9lOXN1V1FqZU9DcytPRHMrT0RpT09EcmVPRHZPT0RxK09CcU9TL25lV3RtT09CbGVPQ2pPT0JuK2U5c3VXUWpRcHdaR1pxY3kxbFpHbDBiM0l0YzJsbmJtRjBkWEpsTFdGa1pDMXphV2R1WVhSMWNtVXRZblYwZEc5dUlEMEtJQ0FnSUM1MGFYUnNaU0E5SU9hV3NPT0JsK09CaE9lOXN1V1FqZU9Da3VpL3ZlV0tvT09CbCtPQnZ1T0JtUXB3WkdacWN5MWxaR2wwYjNJdGMybG5ibUYwZFhKbExXRmtaQzF6YVdkdVlYUjFjbVV0WW5WMGRHOXVMV3hoWW1Wc0lEMGc1cGF3NDRHWDQ0R0U1NzJ5NVpDTjQ0S1M2TCs5NVlxZ0NpTWdWWE5sWkNCdmJpQjBhR1VnWW5WMGRHOXVJSFJ2SUhWelpTQmhiaUJoYkhKbFlXUjVJSE5oZG1Wa0lITnBaMjVoZEhWeVpTNEtJeUJXWVhKcFlXSnNaWE02Q2lNZ0lDQWtaR1Z6WTNKcGNIUnBiMjRnS0ZOMGNtbHVaeWtnTFNCaElITjBjbWx1WnlCa1pYTmpjbWxpYVc1bkwyeGhZbVZzYVc1bklIUm9aU0J6YVdkdVlYUjFjbVV1Q25Ca1ptcHpMV1ZrYVhSdmNpMWhaR1F0YzJGMlpXUXRjMmxuYm1GMGRYSmxMV0oxZEhSdmJpQTlDaUFnSUNBdWRHbDBiR1VnUFNEa3Y1M2xyWmpqZ1pYamdvempnWi9udmJMbGtJMDZJSHNnSkdSbGMyTnlhWEIwYVc5dUlIMEtJeUF1WkdWbVlYVnNkQzFqYjI1MFpXNTBJR2x6SUhWelpXUWdZWE1nWVNCd2JHRmpaV2h2YkdSbGNpQnBiaUJoYmlCbGJYQjBlU0IwWlhoMElHVmthWFJ2Y2k0S2NHUm1hbk10Wm5KbFpTMTBaWGgwTWlBOUNpQWdJQ0F1WVhKcFlTMXNZV0psYkNBOUlPT0RsZU9EcXVPRHZPT0RodU9DcmVPQ3VlT0RpT2F6cU9tSGlPT0NxT09EaCtPQ28rT0N2K09EdkFvZ0lDQWdMbVJsWm1GMWJIUXRZMjl1ZEdWdWRDQTlJT09EaHVPQ3JlT0N1ZU9EaU9PQ2t1V0ZwZVdLbStPQmwrT0JwdU9CaitPQm9PT0JsZU9CaEM0dUxncHdaR1pxY3kxbWNtVmxMWFJsZUhRZ1BRb2dJQ0FnTG1GeWFXRXRiR0ZpWld3Z1BTRGpnNVhqZzZyamc3empnNGJqZ3EzamdybmpnNGptczZqcGg0ampncWpqZzRmamdxUGpnci9qZzd3S2NHUm1hbk10Wm5KbFpTMTBaWGgwTFdSbFptRjFiSFF0WTI5dWRHVnVkQ0E5SU9PRGh1T0NyZU9DdWVPRGlPT0NrdVdGcGVXS20rT0JsK09CcHVPQmorT0JvT09CbGVPQmhDNHVMZ3B3WkdacWN5MXBibXNnUFFvZ0lDQWdMbUZ5YVdFdGJHRmlaV3dnUFNEamdxVGpnN1BqZ3EvbXM2anBoNGpqZ3Fqamc0ZmpncVBqZ3Ivamc3d0tjR1JtYW5NdGFXNXJMV05oYm5aaGN5QTlDaUFnSUNBdVlYSnBZUzFzWVdKbGJDQTlJT09EcHVPRHZPT0N0dU9Edk9TOW5PYUlrT2VVdStXRGp3b0tJeU1nUVd4MExYUmxlSFFnWkdsaGJHOW5DZ3B3WkdacWN5MWxaR2wwYjNJdFlXeDBMWFJsZUhRdFluVjBkRzl1TFd4aFltVnNJRDBnNUx1ajVwdS80NE9HNDRLdDQ0SzU0NE9JQ25Ca1ptcHpMV1ZrYVhSdmNpMWhiSFF0ZEdWNGRDMWxaR2wwTFdKMWRIUnZiaUE5Q2lBZ0lDQXVZWEpwWVMxc1lXSmxiQ0E5SU9TN28rYWJ2K09EaHVPQ3JlT0N1ZU9EaU9PQ2t1ZTNxT21iaGdwd1pHWnFjeTFsWkdsMGIzSXRZV3gwTFhSbGVIUXRaV1JwZEMxaWRYUjBiMjR0YkdGaVpXd2dQU0RrdTZQbW03L2pnNGJqZ3EzamdybmpnNGpqZ3BMbnQ2anBtNFlLY0dSbWFuTXRaV1JwZEc5eUxXRnNkQzEwWlhoMExXUnBZV3h2Wnkxc1lXSmxiQ0E5SU9PQ3F1T0RsK09DdCtPRHArT0RzK09CcnVtQnVPYUtuZ3B3WkdacWN5MWxaR2wwYjNJdFlXeDBMWFJsZUhRdFpHbGhiRzluTFdSbGMyTnlhWEIwYVc5dUlEMGc1THVqNXB1LzQ0T0c0NEt0NDRLNTQ0T0k0NEd2NTVTNzVZT1A0NEdNNktHbzU2UzY0NEdWNDRLTTQ0R3E0NEdFNWFDMDVaQ0k0NEtFNktxdDQ0Ry82TDY4NDRHKzQ0S000NEdxNDRHRTVhQzA1WkNJNDRHcjQ0T200NE84NDRLMjQ0Tzg0NEd1NVlxcDQ0R1I0NEdyNDRHcTQ0S0s0NEcrNDRHWjQ0Q0NDbkJrWm1wekxXVmthWFJ2Y2kxaGJIUXRkR1Y0ZEMxaFpHUXRaR1Z6WTNKcGNIUnBiMjR0YkdGaVpXd2dQU0RvcXF6bW1JN2pncExvdjczbGlxQUtjR1JtYW5NdFpXUnBkRzl5TFdGc2RDMTBaWGgwTFdGa1pDMWtaWE5qY21sd2RHbHZiaTFrWlhOamNtbHdkR2x2YmlBOUlPV3Z2dWl4b2VPQ2hPaW9yZVd1bXVPQWdlV0xsZVM5bk9PQ2t1aXFyT2FZanVPQm1lT0NpK2VmcmVPQmhPYVdoK2Vyb09PQ2t1aW9tT1dGcGVPQmwrT0JwdU9CaitPQm9PT0JsZU9CaE9PQWdncHdaR1pxY3kxbFpHbDBiM0l0WVd4MExYUmxlSFF0YldGeWF5MWtaV052Y21GMGFYWmxMV3hoWW1Wc0lEMGc2S09GNmFPKzQ0T2U0NE84NDRLdjQ0S1M1THVZNDRHUjQ0S0xDbkJrWm1wekxXVmthWFJ2Y2kxaGJIUXRkR1Y0ZEMxdFlYSnJMV1JsWTI5eVlYUnBkbVV0WkdWelkzSnBjSFJwYjI0Z1BTRGpnWlBqZ296amdhL2xqTHJsaUlmamdvcm50NXJqZ29UamdxYmpncW5qZzd6amdyL2pnN3pqZzU3amc3empncS9qZ2FyamdhbmpnYTdvbzRYcG83N25sTHZsZzQvamdhdmt2Yi9ubEtqamdaWGpnb3pqZ2I3amdabmpnSUlLY0dSbWFuTXRaV1JwZEc5eUxXRnNkQzEwWlhoMExXTmhibU5sYkMxaWRYUjBiMjRnUFNEamdxM2pnNlBqZzdQamdydmpnNnNLY0dSbWFuTXRaV1JwZEc5eUxXRnNkQzEwWlhoMExYTmhkbVV0WW5WMGRHOXVJRDBnNUwrZDVhMllDbkJrWm1wekxXVmthWFJ2Y2kxaGJIUXRkR1Y0ZEMxa1pXTnZjbUYwYVhabExYUnZiMngwYVhBZ1BTRG9vNFhwbzc3amc1N2pnN3pqZ3EvamdZemt1NWpqZ1lUamdhYmpnWVRqZ2I3amdaa0tJeUF1Y0d4aFkyVm9iMnhrWlhJNklGUm9hWE1nYVhNZ1lTQndiR0ZqWldodmJHUmxjaUJtYjNJZ2RHaGxJR0ZzZENCMFpYaDBJR2x1Y0hWMElHRnlaV0VLY0dSbWFuTXRaV1JwZEc5eUxXRnNkQzEwWlhoMExYUmxlSFJoY21WaElEMEtJQ0FnSUM1d2JHRmpaV2h2YkdSbGNpQTlJT1MraXpyamdJem9pNlhqZ1lUa3VycmpnWXpqZzRiamc3empnNWJqZzZ2amdhN2x1SzNqZ2F2amdhVGpnWVRqZ2FicG81L2t1b3ZqZ3BMamdaZmpnYWJqZ1lUamdiN2pnWm5qZ0kwS0l5QkJiSFJsY201aGRHbDJaU0IwWlhoMElDaGhiSFFnZEdWNGRDa2dhR1ZzY0hNZ2QyaGxiaUJ3Wlc5d2JHVWdZMkZ1SjNRZ2MyVmxJSFJvWlNCcGJXRm5aUzRLY0dSbWFuTXRaV1JwZEc5eUxXRnNkQzEwWlhoMExXSjFkSFJ2YmlBOUNpQWdJQ0F1WVhKcFlTMXNZV0psYkNBOUlPUzdvK2FiditPRGh1T0NyZU9DdWVPRGlBb0tJeU1nUldScGRHOXlJSEpsYzJsNlpYSnpDaU1qSUZSb2FYTWdhWE1nZFhObFpDQnBiaUJoYmlCaGNtbGhJR3hoWW1Wc0lIUnZJR2hsYkhBZ2RHOGdkVzVrWlhKemRHRnVaQ0IwYUdVZ2NtOXNaU0J2WmlCMGFHVWdjbVZ6YVhwbGNpNEtDbkJrWm1wekxXVmthWFJ2Y2kxeVpYTnBlbVZ5TFd4aFltVnNMWFJ2Y0Mxc1pXWjBJRDBnNWJlbTVMaUs2WnFGSU9LQWxDRGpnclhqZ3FUamdycmxwSW5tbTdRS2NHUm1hbk10WldScGRHOXlMWEpsYzJsNlpYSXRiR0ZpWld3dGRHOXdMVzFwWkdSc1pTQTlJT1M0aXVTNHJlV2tyaURpZ0pRZzQ0SzE0NEtrNDRLNjVhU0o1cHUwQ25Ca1ptcHpMV1ZrYVhSdmNpMXlaWE5wZW1WeUxXeGhZbVZzTFhSdmNDMXlhV2RvZENBOUlPV1BzK1M0aXVtYWhTRGlnSlFnNDRLMTQ0S2s0NEs2NWFTSjVwdTBDbkJrWm1wekxXVmthWFJ2Y2kxeVpYTnBlbVZ5TFd4aFltVnNMVzFwWkdSc1pTMXlhV2RvZENBOUlPV1BzK1M0cmVXa3JpRGlnSlFnNDRLMTQ0S2s0NEs2NWFTSjVwdTBDbkJrWm1wekxXVmthWFJ2Y2kxeVpYTnBlbVZ5TFd4aFltVnNMV0p2ZEhSdmJTMXlhV2RvZENBOUlPV1BzK1M0aSttYWhTRGlnSlFnNDRLMTQ0S2s0NEs2NWFTSjVwdTBDbkJrWm1wekxXVmthWFJ2Y2kxeVpYTnBlbVZ5TFd4aFltVnNMV0p2ZEhSdmJTMXRhV1JrYkdVZ1BTRGt1SXZrdUszbHBLNGc0b0NVSU9PQ3RlT0NwT09DdXVXa2llYWJ0QXB3WkdacWN5MWxaR2wwYjNJdGNtVnphWHBsY2kxc1lXSmxiQzFpYjNSMGIyMHRiR1ZtZENBOUlPVzNwdVM0aSttYWhTRGlnSlFnNDRLMTQ0S2s0NEs2NWFTSjVwdTBDbkJrWm1wekxXVmthWFJ2Y2kxeVpYTnBlbVZ5TFd4aFltVnNMVzFwWkdSc1pTMXNaV1owSUQwZzViZW01TGl0NWFTdUlPS0FsQ0RqZ3JYamdxVGpncnJscElubW03UUtjR1JtYW5NdFpXUnBkRzl5TFhKbGMybDZaWEl0ZEc5d0xXeGxablFnUFFvZ0lDQWdMbUZ5YVdFdGJHRmlaV3dnUFNEbHQ2Ymt1SXJwbW9VZzRvQ1VJT09DdGVPQ3BPT0N1dVdraWVhYnRBcHdaR1pxY3kxbFpHbDBiM0l0Y21WemFYcGxjaTEwYjNBdGJXbGtaR3hsSUQwS0lDQWdJQzVoY21saExXeGhZbVZzSUQwZzVMaUs1TGl0NWFTdUlPS0FsQ0RqZ3JYamdxVGpncnJscElubW03UUtjR1JtYW5NdFpXUnBkRzl5TFhKbGMybDZaWEl0ZEc5d0xYSnBaMmgwSUQwS0lDQWdJQzVoY21saExXeGhZbVZzSUQwZzVZK3o1TGlLNlpxRklPS0FsQ0RqZ3JYamdxVGpncnJscElubW03UUtjR1JtYW5NdFpXUnBkRzl5TFhKbGMybDZaWEl0Yldsa1pHeGxMWEpwWjJoMElEMEtJQ0FnSUM1aGNtbGhMV3hoWW1Wc0lEMGc1WSt6NUxpdDVhU3VJT0tBbENEamdyWGpncVRqZ3JybHBJbm1tN1FLY0dSbWFuTXRaV1JwZEc5eUxYSmxjMmw2WlhJdFltOTBkRzl0TFhKcFoyaDBJRDBLSUNBZ0lDNWhjbWxoTFd4aFltVnNJRDBnNVkrejVMaUw2WnFGSU9LQWxDRGpnclhqZ3FUamdycmxwSW5tbTdRS2NHUm1hbk10WldScGRHOXlMWEpsYzJsNlpYSXRZbTkwZEc5dExXMXBaR1JzWlNBOUNpQWdJQ0F1WVhKcFlTMXNZV0psYkNBOUlPUzRpK1M0cmVXa3JpRGlnSlFnNDRLMTQ0S2s0NEs2NWFTSjVwdTBDbkJrWm1wekxXVmthWFJ2Y2kxeVpYTnBlbVZ5TFdKdmRIUnZiUzFzWldaMElEMEtJQ0FnSUM1aGNtbGhMV3hoWW1Wc0lEMGc1YmVtNUxpTDZacUZJT0tBbENEamdyWGpncVRqZ3JybHBJbm1tN1FLY0dSbWFuTXRaV1JwZEc5eUxYSmxjMmw2WlhJdGJXbGtaR3hsTFd4bFpuUWdQUW9nSUNBZ0xtRnlhV0V0YkdGaVpXd2dQU0RsdDZia3VLM2xwSzRnNG9DVUlPT0N0ZU9DcE9PQ3V1V2tpZWFidEFvS0l5TWdRMjlzYjNJZ2NHbGphMlZ5Q2dvaklGUm9hWE1nYldWaGJuTWdJa052Ykc5eUlIVnpaV1FnZEc4Z2FHbG5hR3hwWjJoMElIUmxlSFFpQ25Ca1ptcHpMV1ZrYVhSdmNpMW9hV2RvYkdsbmFIUXRZMjlzYjNKd2FXTnJaWEl0YkdGaVpXd2dQU0Rsdkxmb3FyL29pYklLY0dSbWFuTXRaV1JwZEc5eUxXTnZiRzl5Y0dsamEyVnlMV0oxZEhSdmJpQTlDaUFnSUNBdWRHbDBiR1VnUFNEb2liTGpncExscElubW03VGpnWmZqZ2I3amdaa0tjR1JtYW5NdFpXUnBkRzl5TFdOdmJHOXljR2xqYTJWeUxXUnliM0JrYjNkdUlEMEtJQ0FnSUM1aGNtbGhMV3hoWW1Wc0lEMGc2SW15NDRHdTZZRzQ1b3FlQ25Ca1ptcHpMV1ZrYVhSdmNpMWpiMnh2Y25CcFkydGxjaTE1Wld4c2IzY2dQUW9nSUNBZ0xuUnBkR3hsSUQwZzZidUU2SW15Q25Ca1ptcHpMV1ZrYVhSdmNpMWpiMnh2Y25CcFkydGxjaTFuY21WbGJpQTlDaUFnSUNBdWRHbDBiR1VnUFNEbnQ1SG9pYklLY0dSbWFuTXRaV1JwZEc5eUxXTnZiRzl5Y0dsamEyVnlMV0pzZFdVZ1BRb2dJQ0FnTG5ScGRHeGxJRDBnNloyUzZJbXlDbkJrWm1wekxXVmthWFJ2Y2kxamIyeHZjbkJwWTJ0bGNpMXdhVzVySUQwS0lDQWdJQzUwYVhSc1pTQTlJT09EbE9PRHMrT0NyK2lKc2dwd1pHWnFjeTFsWkdsMGIzSXRZMjlzYjNKd2FXTnJaWEl0Y21Wa0lEMEtJQ0FnSUM1MGFYUnNaU0E5SU9pMXBPaUpzZ29LSXlNZ1UyaHZkeUJoYkd3Z2FHbG5hR3hwWjJoMGN3b2pJeUJVYUdseklHbHpJR0VnZEc5bloyeGxJR0oxZEhSdmJpQjBieUJ6YUc5M0wyaHBaR1VnWVd4c0lIUm9aU0JvYVdkb2JHbG5hSFJ6TGdvS2NHUm1hbk10WldScGRHOXlMV2hwWjJoc2FXZG9kQzF6YUc5M0xXRnNiQzFpZFhSMGIyNHRiR0ZpWld3Z1BTRGpnWm5qZ2JuamdhYm9vYWpucExvS0l5QW9YbTFlS1NCbGJpMVZVem9nTG5ScGRHeGxJRDBnVTJodmR5QmhiR3dLY0dSbWFuTXRaV1JwZEc5eUxXaHBaMmhzYVdkb2RDMXphRzkzTFdGc2JDMWlkWFIwYjI0Z1BRb2dJQ0FnTG5ScGRHeGxJRDBnNWJ5MzZLcS80NEd1NktHbzU2UzY0NEtTNVlpSDQ0S0s1cHUvNDRHSTQ0Rys0NEdaQ2dvakl5Qk9aWGNnWVd4MExYUmxlSFFnWkdsaGJHOW5DaU1qSUVkeWIzVndJRzV2ZEdVZ1ptOXlJR1Z1ZEdseVpTQm1aV0YwZFhKbE9pQkJiSFJsY201aGRHbDJaU0IwWlhoMElDaGhiSFFnZEdWNGRDa2dhR1ZzY0hNZ2QyaGxiaUJ3Wlc5d2JHVWdZMkZ1SjNRZ2MyVmxJSFJvWlNCcGJXRm5aUzRnVkdocGN5Qm1aV0YwZFhKbElHbHVZMngxWkdWeklHRWdkRzl2YkNCMGJ5QmpjbVZoZEdVZ1lXeDBJSFJsZUhRZ1lYVjBiMjFoZEdsallXeHNlU0IxYzJsdVp5QmhiaUJCU1NCdGIyUmxiQ0IwYUdGMElIZHZjbXR6SUd4dlkyRnNiSGtnYjI0Z2RHaGxJSFZ6WlhJbmN5QmtaWFpwWTJVZ2RHOGdjSEpsYzJWeWRtVWdjSEpwZG1GamVTNEtDaU1nVFc5a1lXd2dhR1ZoWkdWeUlIQnZjMmwwYVc5dVpXUWdZV0p2ZG1VZ1lTQjBaWGgwSUdKdmVDQjNhR1Z5WlNCMWMyVnljeUJqWVc0Z1pXUnBkQ0IwYUdVZ1lXeDBJSFJsZUhRdUNuQmtabXB6TFdWa2FYUnZjaTF1WlhjdFlXeDBMWFJsZUhRdFpHbGhiRzluTFdWa2FYUXRiR0ZpWld3Z1BTRGt1NlBtbTcvamc0YmpncTNqZ3Juamc0ampncExudDZqcG00WWdLT2VVdStXRGorT0JydWlxck9hWWppa0tJeUJOYjJSaGJDQm9aV0ZrWlhJZ2NHOXphWFJwYjI1bFpDQmhZbTkyWlNCaElIUmxlSFFnWW05NElIZG9aWEpsSUhWelpYSnpJR05oYmlCaFpHUWdkR2hsSUdGc2RDQjBaWGgwTGdwd1pHWnFjeTFsWkdsMGIzSXRibVYzTFdGc2RDMTBaWGgwTFdScFlXeHZaeTFoWkdRdGJHRmlaV3dnUFNEa3U2UG1tNy9qZzRiamdxM2pncm5qZzRqamdwTG92NzNsaXFBZ0tPZVV1K1dEaitPQnJ1aXFyT2FZamlrS2NHUm1hbk10WldScGRHOXlMVzVsZHkxaGJIUXRkR1Y0ZEMxMFpYaDBZWEpsWVNBOUNpQWdJQ0F1Y0d4aFkyVm9iMnhrWlhJZ1BTRGpnWlBqZ1pQamdhdm9xcXptbUk3amdwTG9xSmpsaGFYamdaZmpnYWJqZ1kvamdhRGpnWlhqZ1lRdUxpNEtJeUJVYUdseklIUmxlSFFnY21WbVpYSnpJSFJ2SUhSb1pTQmhiSFFnZEdWNGRDQmliM2dnWVdKdmRtVWdkR2hwY3lCa1pYTmpjbWx3ZEdsdmJpNGdTWFFnYjJabVpYSnpJR0VnWkdWbWFXNXBkR2x2YmlCdlppQmhiSFFnZEdWNGRDNEtjR1JtYW5NdFpXUnBkRzl5TFc1bGR5MWhiSFF0ZEdWNGRDMWtaWE5qY21sd2RHbHZiaUE5SU9lVXUrV0RqK09Cak9pcXJlT0J2K2krdk9PQnZ1T0NqT09CcXVPQmhPV2d0T1dRaU9PQ2hPaW1pK09CaU9PQnF1T0JoT1M2dXVPQnJ1T0JuK09DZ2VPQnJ1ZWZyZU9CaE9pcXJPYVlqdU9CcCtPQm1lT0FnZ3B3WkdacWN5MWxaR2wwYjNJdGJtVjNMV0ZzZEMxMFpYaDBMV1JwYzJOc1lXbHRaWEl4SUQwZzQ0R1Q0NEd1NUx1ajVwdS80NE9HNDRLdDQ0SzU0NE9JNDRHdjZJZXE1WXVWNTVxRTQ0R3I1NVNmNW9pUTQ0R1Y0NEtNNDRHZjQ0R2Y0NEtCNXEyajU2SzY0NEduNDRHcTQ0R0U1WSt2NklPOTVvQ240NEdNNDRHQzQ0S0s0NEcrNDRHWjQ0Q0NDbkJrWm1wekxXVmthWFJ2Y2kxdVpYY3RZV3gwTFhSbGVIUXRaR2x6WTJ4aGFXMWxjaTFzWldGeWJpMXRiM0psTFhWeWJDQTlJT2lwcytlMHNPYURoZVdnc1Fwd1pHWnFjeTFsWkdsMGIzSXRibVYzTFdGc2RDMTBaWGgwTFdOeVpXRjBaUzFoZFhSdmJXRjBhV05oYkd4NUxXSjFkSFJ2Ymkxc1lXSmxiQ0E5SU9TN28rYWJ2K09EaHVPQ3JlT0N1ZU9EaU9PQ2t1aUhxdVdMbGVlVW4rYUlrQXB3WkdacWN5MWxaR2wwYjNJdGJtVjNMV0ZzZEMxMFpYaDBMVzV2ZEMxdWIzY3RZblYwZEc5dUlEMGc1YjZNNDRHbkNuQmtabXB6TFdWa2FYUnZjaTF1WlhjdFlXeDBMWFJsZUhRdFpYSnliM0l0ZEdsMGJHVWdQU0RrdTZQbW03L2pnNGJqZ3EzamdybmpnNGpqZ3BMb2g2cmxpNVhubEovbWlKRGpnYWZqZ1kzamdiN2pnWnZqZ3BQamdhZmpnWmZqZ1o4S2NHUm1hbk10WldScGRHOXlMVzVsZHkxaGJIUXRkR1Y0ZEMxbGNuSnZjaTFrWlhOamNtbHdkR2x2YmlBOUlPT0JsT2lIcXVXSWh1T0JwK1M3bythYnYrT0RodU9DcmVPQ3VlT0RpT09Da3VhYnVPT0JqK09CaStXK2pPT0JwK09DZ3VPQmh1UzRnT1c2cHVpcHB1T0JsK09CcHVPQmorT0JvT09CbGVPQmhPT0FnZ3B3WkdacWN5MWxaR2wwYjNJdGJtVjNMV0ZzZEMxMFpYaDBMV1Z5Y205eUxXTnNiM05sTFdKMWRIUnZiaUE5SU9tV2llT0JtT09DaXdvaklGWmhjbWxoWW14bGN6b0tJeUFnSUNSMGIzUmhiRk5wZW1VZ0tFNTFiV0psY2lrZ0xTQjBhR1VnZEc5MFlXd2djMmw2WlNBb2FXNGdUVUlwSUc5bUlIUm9aU0JCU1NCdGIyUmxiQzRLSXlBZ0lDUmtiM2R1Ykc5aFpHVmtVMmw2WlNBb1RuVnRZbVZ5S1NBdElIUm9aU0JrYjNkdWJHOWhaR1ZrSUhOcGVtVWdLR2x1SUUxQ0tTQnZaaUIwYUdVZ1FVa2diVzlrWld3dUNuQmtabXB6TFdWa2FYUnZjaTF1WlhjdFlXeDBMWFJsZUhRdFlXa3RiVzlrWld3dFpHOTNibXh2WVdScGJtY3RjSEp2WjNKbGMzTWdQU0RrdTZQbW03L2pnNGJqZ3EzamdybmpnNGdnUVVrZzQ0T2k0NE9INDRPcjQ0S1M0NE9BNDRLbTQ0T3o0NE90NDRPODQ0T0o0NEdYNDRHbTQ0R0U0NEcrNDRHWklDaDdJQ1JrYjNkdWJHOWhaR1ZrVTJsNlpTQjlJQzhnZXlBa2RHOTBZV3hUYVhwbElIMGdUVUlwQ2lBZ0lDQXVZWEpwWVMxMllXeDFaWFJsZUhRZ1BTRGt1NlBtbTcvamc0YmpncTNqZ3Juamc0Z2dRVWtnNDRPaTQ0T0g0NE9yNDRLUzQ0T0E0NEttNDRPejQ0T3Q0NE84NDRPSjQ0R1g0NEdtNDRHRTQ0Rys0NEdaSUNoN0lDUmtiM2R1Ykc5aFpHVmtVMmw2WlNCOUlDOGdleUFrZEc5MFlXeFRhWHBsSUgwZ1RVSXBDaU1nVkdocGN5QnBjeUJoSUdKMWRIUnZiaUIwYUdGMElIVnpaWEp6SUdOaGJpQmpiR2xqYXlCMGJ5QmxaR2wwSUhSb1pTQmhiSFFnZEdWNGRDQjBhR1Y1SUdoaGRtVWdZV3h5WldGa2VTQmhaR1JsWkM0S2NHUm1hbk10WldScGRHOXlMVzVsZHkxaGJIUXRkR1Y0ZEMxaFpHUmxaQzFpZFhSMGIyNGdQUW9nSUNBZ0xtRnlhV0V0YkdGaVpXd2dQU0RrdTZQbW03L2pnNGJqZ3EzamdybmpnNGpqZ3BMb3Y3M2xpcURqZ1pmamdiN2pnWmZqZ1o4S2NHUm1hbk10WldScGRHOXlMVzVsZHkxaGJIUXRkR1Y0ZEMxaFpHUmxaQzFpZFhSMGIyNHRiR0ZpWld3Z1BTRGt1NlBtbTcvamc0YmpncTNqZ3Juamc0ampncExvdjczbGlxRGpnWmZqZ2I3amdaZmpnWjhLSXlCVWFHbHpJR2x6SUdFZ1luVjBkRzl1SUhSb1lYUWdkWE5sY25NZ1kyRnVJR05zYVdOcklIUnZJRzl3Wlc0Z2RHaGxJR0ZzZENCMFpYaDBJR1ZrYVhSdmNpQmhibVFnWVdSa0lHRnNkQ0IwWlhoMElIZG9aVzRnYVhRZ2FYTWdibTkwSUhCeVpYTmxiblF1Q25Ca1ptcHpMV1ZrYVhSdmNpMXVaWGN0WVd4MExYUmxlSFF0YldsemMybHVaeTFpZFhSMGIyNGdQUW9nSUNBZ0xtRnlhV0V0YkdGaVpXd2dQU0RrdTZQbW03L2pnNGJqZ3EzamdybmpnNGpqZ1l6amdZTGpnb3JqZ2I3amdadmpncE1LY0dSbWFuTXRaV1JwZEc5eUxXNWxkeTFoYkhRdGRHVjRkQzF0YVhOemFXNW5MV0oxZEhSdmJpMXNZV0psYkNBOUlPUzdvK2FiditPRGh1T0NyZU9DdWVPRGlPT0JqT09CZ3VPQ2l1T0J2dU9CbStPQ2t3b2pJRlJvYVhNZ2FYTWdZU0JpZFhSMGIyNGdkR2hoZENCdmNHVnVjeUIxY0NCMGFHVWdZV3gwSUhSbGVIUWdiVzlrWVd3Z2QyaGxjbVVnZFhObGNuTWdjMmh2ZFd4a0lISmxkbWxsZHlCMGFHVWdZV3gwSUhSbGVIUWdkR2hoZENCM1lYTWdZWFYwYjIxaGRHbGpZV3hzZVNCblpXNWxjbUYwWldRdUNuQmtabXB6TFdWa2FYUnZjaTF1WlhjdFlXeDBMWFJsZUhRdGRHOHRjbVYyYVdWM0xXSjFkSFJ2YmlBOUNpQWdJQ0F1WVhKcFlTMXNZV0psYkNBOUlPUzdvK2FiditPRGh1T0NyZU9DdWVPRGlPT0NrdU9Eck9PRGsrT0RwZU9EdkFwd1pHWnFjeTFsWkdsMGIzSXRibVYzTFdGc2RDMTBaWGgwTFhSdkxYSmxkbWxsZHkxaWRYUjBiMjR0YkdGaVpXd2dQU0RrdTZQbW03L2pnNGJqZ3EzamdybmpnNGpqZ3BMamc2empnNVBqZzZYamc3d0tJeUFpUTNKbFlYUmxaQ0JoZFhSdmJXRjBhV05oYkd4NUlpQnBjeUJoSUhCeVpXWnBlQ0IwYUdGMElIZHBiR3dnWW1VZ1lXUmtaV1FnZEc4Z2RHaGxJR0psWjJsdWJtbHVaeUJ2WmlCaGJua2dZV3gwSUhSbGVIUWdkR2hoZENCb1lYTWdZbVZsYmlCaGRYUnZiV0YwYVdOaGJHeDVJR2RsYm1WeVlYUmxaQzRnUVdaMFpYSWdkR2hsSUdOdmJHOXVMQ0IwYUdVZ2RYTmxjaUIzYVd4c0lITmxaUzlvWldGeUlIUm9aU0JoWTNSMVlXd2dZV3gwSUhSbGVIUWdaR1Z6WTNKcGNIUnBiMjR1SUVsbUlIUm9aU0JoYkhRZ2RHVjRkQ0JvWVhNZ1ltVmxiaUJsWkdsMFpXUWdZbmtnWVNCb2RXMWhiaXdnZEdocGN5QndjbVZtYVhnZ2QybHNiQ0J1YjNRZ1lYQndaV0Z5TGdvaklGWmhjbWxoWW14bGN6b0tJeUFnSUNSblpXNWxjbUYwWldSQmJIUlVaWGgwSUNoVGRISnBibWNwSUMwZ2RHaGxJR2RsYm1WeVlYUmxaQ0JoYkhRdGRHVjRkQzRLY0dSbWFuTXRaV1JwZEc5eUxXNWxkeTFoYkhRdGRHVjRkQzFuWlc1bGNtRjBaV1F0WVd4MExYUmxlSFF0ZDJsMGFDMWthWE5qYkdGcGJXVnlJRDBnNkllcTVZdVY1NVNmNW9pUTQ0R1Y0NEtNNDRHKzQ0R1g0NEdmT2lCN0lDUm5aVzVsY21GMFpXUkJiSFJVWlhoMElIMEtDaU1qSUVsdFlXZGxJR0ZzZEMxMFpYaDBJSE5sZEhScGJtZHpDZ3B3WkdacWN5MXBiV0ZuWlMxaGJIUXRkR1Y0ZEMxelpYUjBhVzVuY3kxaWRYUjBiMjRnUFFvZ0lDQWdMblJwZEd4bElEMGc1NVM3NVlPUDQ0R3U1THVqNXB1LzQ0T0c0NEt0NDRLNTQ0T0k2S2l0NWE2YUNuQmtabXB6TFdsdFlXZGxMV0ZzZEMxMFpYaDBMWE5sZEhScGJtZHpMV0oxZEhSdmJpMXNZV0psYkNBOUlPZVV1K1dEaitPQnJ1UzdvK2FiditPRGh1T0NyZU9DdWVPRGlPaW9yZVd1bWdwd1pHWnFjeTFsWkdsMGIzSXRZV3gwTFhSbGVIUXRjMlYwZEdsdVozTXRaR2xoYkc5bkxXeGhZbVZzSUQwZzU1Uzc1WU9QNDRHdTVMdWo1cHUvNDRPRzQ0S3Q0NEs1NDRPSTZLaXQ1YTZhQ25Ca1ptcHpMV1ZrYVhSdmNpMWhiSFF0ZEdWNGRDMXpaWFIwYVc1bmN5MWhkWFJ2YldGMGFXTXRkR2wwYkdVZ1BTRG9oNnJsaTVYa3U2UG1tNy9qZzRiamdxM2pncm5qZzRnS2NHUm1hbk10WldScGRHOXlMV0ZzZEMxMFpYaDBMWE5sZEhScGJtZHpMV055WldGMFpTMXRiMlJsYkMxaWRYUjBiMjR0YkdGaVpXd2dQU0RrdTZQbW03L2pnNGJqZ3EzamdybmpnNGpqZ3BMb2g2cmxpNVhubEovbWlKQUtjR1JtYW5NdFpXUnBkRzl5TFdGc2RDMTBaWGgwTFhObGRIUnBibWR6TFdOeVpXRjBaUzF0YjJSbGJDMWtaWE5qY21sd2RHbHZiaUE5SU9lVXUrV0RqK09Cak9pcXJlT0J2K2krdk9PQnZ1T0NqT09CcXVPQmhPV2d0T1dRaU9PQ2hPaW1pK09CaU9PQnF1T0JoT1M2dXVPQnJ1T0JuK09DZ2VPQnEraXFyT2FZanVPQ2t1YVBrT2FoaU9PQmwrT0J2dU9CbWVPQWdnb2pJRlpoY21saFlteGxjem9LSXlBZ0lDUjBiM1JoYkZOcGVtVWdLRTUxYldKbGNpa2dMU0IwYUdVZ2RHOTBZV3dnYzJsNlpTQW9hVzRnVFVJcElHOW1JSFJvWlNCQlNTQnRiMlJsYkM0S2NHUm1hbk10WldScGRHOXlMV0ZzZEMxMFpYaDBMWE5sZEhScGJtZHpMV1J2ZDI1c2IyRmtMVzF2WkdWc0xXeGhZbVZzSUQwZzVMdWo1cHUvNDRPRzQ0S3Q0NEs1NDRPSUlFRkpJT09Eb3VPRGgrT0RxeUFvZXlBa2RHOTBZV3hUYVhwbElIMGdUVUlwQ25Ca1ptcHpMV1ZrYVhSdmNpMWhiSFF0ZEdWNGRDMXpaWFIwYVc1bmN5MWhhUzF0YjJSbGJDMWtaWE5qY21sd2RHbHZiaUE5SU9PRHJlT0R2T09DcStPRHErT0JydWVycithY3ErUzRpdU9CcCtXdW4raWhqT09CbGVPQ2pPT0NpK09CbitPQ2dlT0RoK09Edk9PQ3YrT0JyK21kbnVXRnJPbVdpK09CcStPQnF1T0NpdU9CdnVPQm1lT0FndVM3bythYnYrT0RodU9DcmVPQ3VlT0RpT09CcnVpSHF1V0xsZWVVbithSWtPT0JxK1cvaGVpbWdlT0JwK09CbWVPQWdncHdaR1pxY3kxbFpHbDBiM0l0WVd4MExYUmxlSFF0YzJWMGRHbHVaM010WkdWc1pYUmxMVzF2WkdWc0xXSjFkSFJ2YmlBOUlPV0ppdW1acEFwd1pHWnFjeTFsWkdsMGIzSXRZV3gwTFhSbGVIUXRjMlYwZEdsdVozTXRaRzkzYm14dllXUXRiVzlrWld3dFluVjBkRzl1SUQwZzQ0T0E0NEttNDRPejQ0T3Q0NE84NDRPSkNuQmtabXB6TFdWa2FYUnZjaTFoYkhRdGRHVjRkQzF6WlhSMGFXNW5jeTFrYjNkdWJHOWhaR2x1WnkxdGIyUmxiQzFpZFhSMGIyNGdQU0RqZzREamdxYmpnN1BqZzYzamc3empnNG5rdUswdUxpNEtjR1JtYW5NdFpXUnBkRzl5TFdGc2RDMTBaWGgwTFhObGRIUnBibWR6TFdWa2FYUnZjaTEwYVhSc1pTQTlJT1M3bythYnYrT0RodU9DcmVPQ3VlT0RpT09DcU9PRGgrT0NvK09DditPRHZBcHdaR1pxY3kxbFpHbDBiM0l0WVd4MExYUmxlSFF0YzJWMGRHbHVaM010YzJodmR5MWthV0ZzYjJjdFluVjBkRzl1TFd4aFltVnNJRDBnNTVTNzVZT1A0NEd1NkwrOTVZcWc1cG1DNDRHcjVMdWo1cHUvNDRPRzQ0S3Q0NEs1NDRPSTQ0S280NE9INDRLajQ0Sy80NE84NDRLUzZLR281NlM2NDRHWjQ0S0xDbkJrWm1wekxXVmthWFJ2Y2kxaGJIUXRkR1Y0ZEMxelpYUjBhVzVuY3kxemFHOTNMV1JwWVd4dlp5MWtaWE5qY21sd2RHbHZiaUE5SU9PQm1lT0J1ZU9CcHVPQnJ1ZVV1K1dEaitPQnErUzdvK2FiditPRGh1T0NyZU9DdWVPRGlPT0NrdWkvdmVXS29PT0JtZU9DaStXS3FlT0JrZU9CcStPQnF1T0NpdU9CdnVPQm1lT0FnZ3B3WkdacWN5MWxaR2wwYjNJdFlXeDBMWFJsZUhRdGMyVjBkR2x1WjNNdFkyeHZjMlV0WW5WMGRHOXVJRDBnNlphSjQ0R1k0NEtMQ2dvakl5QWlRVzV1YjNSaGRHbHZibk1nY21WdGIzWmxaQ0lnWW1GeUNncHdaR1pxY3kxbFpHbDBiM0l0ZFc1a2J5MWlZWEl0YldWemMyRm5aUzFvYVdkb2JHbG5hSFFnUFNEbHZMZm9xci9vb2FqbnBMcmpnWXpsaVlycG1hVGpnWlhqZ296amdiN2pnWmZqZ1o4S2NHUm1hbk10WldScGRHOXlMWFZ1Wkc4dFltRnlMVzFsYzNOaFoyVXRabkpsWlhSbGVIUWdQU0RqZzVYamc2cmpnN3pqZzRiamdxM2pncm5qZzRqbXM2anBoNGpqZ1l6bGlZcnBtYVRqZ1pYamdvempnYjdqZ1pmamdaOEtjR1JtYW5NdFpXUnBkRzl5TFhWdVpHOHRZbUZ5TFcxbGMzTmhaMlV0YVc1cklEMGc0NEtrNDRPejQ0S3Y1ck9vNlllSTQ0R001WW1LNlptazQ0R1Y0NEtNNDRHKzQ0R1g0NEdmQ25Ca1ptcHpMV1ZrYVhSdmNpMTFibVJ2TFdKaGNpMXRaWE56WVdkbExYTjBZVzF3SUQwZzU1Uzc1WU9QNDRHTTVZbUs2Wm1rNDRHVjQ0S000NEcrNDRHWDQ0R2ZDbkJrWm1wekxXVmthWFJ2Y2kxMWJtUnZMV0poY2kxdFpYTnpZV2RsTFhOcFoyNWhkSFZ5WlNBOUlPZTlzdVdRamVPQmpPV0ppdW1acE9PQmxlT0NqT09CdnVPQmwrT0Jud29qSUZaaGNtbGhZbXhsY3pvS0l5QWdJQ1JqYjNWdWRDQW9UblZ0WW1WeUtTQXRJSFJvWlNCdWRXMWlaWElnYjJZZ2NtVnRiM1psWkNCaGJtNXZkR0YwYVc5dWN5NEtjR1JtYW5NdFpXUnBkRzl5TFhWdVpHOHRZbUZ5TFcxbGMzTmhaMlV0YlhWc2RHbHdiR1VnUFNCN0lDUmpiM1Z1ZENCOUlPV0FpK09CcnVhenFPbUhpT09Cak9XSml1bVpwT09CbGVPQ2pPT0J2dU9CbCtPQm53cHdaR1pxY3kxbFpHbDBiM0l0ZFc1a2J5MWlZWEl0ZFc1a2J5MWlkWFIwYjI0Z1BRb2dJQ0FnTG5ScGRHeGxJRDBnNVlXRDQ0R3I1b2k3NDRHWkNuQmtabXB6TFdWa2FYUnZjaTExYm1SdkxXSmhjaTExYm1SdkxXSjFkSFJ2Ymkxc1lXSmxiQ0E5SU9XRmcrT0JxK2FJdStPQm1RcHdaR1pxY3kxbFpHbDBiM0l0ZFc1a2J5MWlZWEl0WTJ4dmMyVXRZblYwZEc5dUlEMEtJQ0FnSUM1MGFYUnNaU0E5SU9tV2llT0JtT09DaXdwd1pHWnFjeTFsWkdsMGIzSXRkVzVrYnkxaVlYSXRZMnh2YzJVdFluVjBkRzl1TFd4aFltVnNJRDBnNlphSjQ0R1k0NEtMQ2dvakl5QkJaR1FnWVNCemFXZHVZWFIxY21VZ1pHbGhiRzluQ2dwd1pHWnFjeTFsWkdsMGIzSXRZV1JrTFhOcFoyNWhkSFZ5WlMxa2FXRnNiMmN0YkdGaVpXd2dQU0RqZ1pQamdhN2pnNERqZ3FUamdxTGpnNjNqZ3JEamdhZmpnYS9qZzZiamc3empncmJqZzd6amdZem52Ykxsa0kzamdwTGt2WnptaUpEamdaZmpnYVlnVUVSR0lPYVdoK2FidU9PQnEraS92ZVdLb09PQnArT0JqZU9CdnVPQm1lT0FnZ3B3WkdacWN5MWxaR2wwYjNJdFlXUmtMWE5wWjI1aGRIVnlaUzFrYVdGc2IyY3RkR2wwYkdVZ1BTRG52Ykxsa0kzamdwTG92NzNsaXFBS0NpTWpJRlJoWWlCdVlXMWxjd29LSXlCVWVYQmxJR2x6SUdFZ2RtVnlZaUFvZVc5MUlHTmhiaUIwZVhCbElIbHZkWElnYm1GdFpTQmhjeUJ6YVdkdVlYUjFjbVVwQ25Ca1ptcHpMV1ZrYVhSdmNpMWhaR1F0YzJsbmJtRjBkWEpsTFhSNWNHVXRZblYwZEc5dUlEMGc0NEsvNDRLazQ0T1hDaUFnSUNBdWRHbDBiR1VnUFNEamdxM2pnN3pqZzV6amc3empnNG5saGFYbGlwdmpnWmZqZ2I3amdaa0tJeUJFY21GM0lHbHpJR0VnZG1WeVlpQW9lVzkxSUdOaGJpQmtjbUYzSUhsdmRYSWdjMmxuYm1GMGRYSmxLUXB3WkdacWN5MWxaR2wwYjNJdFlXUmtMWE5wWjI1aGRIVnlaUzFrY21GM0xXSjFkSFJ2YmlBOUlPYUppK2FidU9PQmpRb2dJQ0FnTG5ScGRHeGxJRDBnNW9tTDVwdTQ0NEdONVlXbDVZcWI0NEdYNDRHKzQ0R1pDbkJrWm1wekxXVmthWFJ2Y2kxaFpHUXRjMmxuYm1GMGRYSmxMV2x0WVdkbExXSjFkSFJ2YmlBOUlPZVV1K1dEandvZ0lDQWdMblJwZEd4bElEMGc1NVM3NVlPUDQ0S1M1b3lINWE2YTQ0R1g0NEcrNDRHWkNnb2pJeUJVWVdJZ2NHRnVaV3h6Q2dwd1pHWnFjeTFsWkdsMGIzSXRZV1JrTFhOcFoyNWhkSFZ5WlMxMGVYQmxMV2x1Y0hWMElEMEtJQ0FnSUM1aGNtbGhMV3hoWW1Wc0lEMGc1NzJ5NVpDTjQ0S1M0NEt0NDRPODQ0T2M0NE84NDRPSjVZV2w1WXFiQ2lBZ0lDQXVjR3hoWTJWb2IyeGtaWElnUFNEbnZiTGxrSTNqZ3BMamdxM2pnN3pqZzV6amc3empnNG5saGFYbGlwc0tjR1JtYW5NdFpXUnBkRzl5TFdGa1pDMXphV2R1WVhSMWNtVXRaSEpoZHkxd2JHRmpaV2h2YkdSbGNpQTlJT2U5c3VXUWplT0NrdWFKaSthYnVPT0JqZVdGcGVXS213cHdaR1pxY3kxbFpHbDBiM0l0WVdSa0xYTnBaMjVoZEhWeVpTMWtjbUYzTFhSb2FXTnJibVZ6Y3kxeVlXNW5aUzFzWVdKbGJDQTlJT2UzbXVPQnJ1V2txdU9CbFFvaklGWmhjbWxoWW14bGN6b0tJeUFnSUNSMGFHbGphMjVsYzNNZ0tFNTFiV0psY2lrZ0xTQjBhR1VnZEdocFkydHVaWE56SUNocGJpQndhWGhsYkhNcElHOW1JSFJvWlNCc2FXNWxJSFZ6WldRZ2RHOGdaSEpoZHlCaElITnBaMjVoZEhWeVpTNEtjR1JtYW5NdFpXUnBkRzl5TFdGa1pDMXphV2R1WVhSMWNtVXRaSEpoZHkxMGFHbGphMjVsYzNNdGNtRnVaMlVnUFFvZ0lDQWdMblJwZEd4bElEMGc1N2VhNDRHdTVhU3E0NEdWT2lCN0lDUjBhR2xqYTI1bGMzTWdmUXB3WkdacWN5MWxaR2wwYjNJdFlXUmtMWE5wWjI1aGRIVnlaUzFwYldGblpTMXdiR0ZqWldodmJHUmxjaUE5SU9PRGxlT0NvZU9DcE9PRHErT0NrdU9CaytPQmsrT0JxK09EaWVPRHFlT0RnK09Dc09PQmwrT0JwdU9Db3VPRGcrT0RsK09EcmVPRHZPT0RpUXB3WkdacWN5MWxaR2wwYjNJdFlXUmtMWE5wWjI1aGRIVnlaUzFwYldGblpTMWljbTkzYzJVdGJHbHVheUE5Q2lBZ0lDQjdJRkJNUVZSR1QxSk5LQ2tnTFQ0S0lDQWdJQ0FnSUNCYmJXRmpiM05kSU9PQnZ1T0JuK09CcitlVXUrV0RqK09EbGVPQ29lT0NwT09EcStPQ2t1bUJ1T2FLbmdvZ0lDQWdJQ0FnS2x0dmRHaGxjbDBnNDRHKzQ0R2Y0NEd2NTVTNzVZT1A0NE9WNDRLaDQ0S2s0NE9yNDRLUzVZK0M1NFduQ2lBZ0lDQjlDZ29qSXlCRGIyNTBjbTlzY3dvS2NHUm1hbk10WldScGRHOXlMV0ZrWkMxemFXZHVZWFIxY21VdFpHVnpZM0pwY0hScGIyNHRiR0ZpWld3Z1BTRG9xcXptbUk0Z0tPUzdvK2FiditPRGh1T0NyZU9DdWVPRGlDa0tjR1JtYW5NdFpXUnBkRzl5TFdGa1pDMXphV2R1WVhSMWNtVXRaR1Z6WTNKcGNIUnBiMjR0YVc1d2RYUWdQUW9nSUNBZ0xuUnBkR3hsSUQwZzZLcXM1cGlPSUNqa3U2UG1tNy9qZzRiamdxM2pncm5qZzRncElPT0NrdWkvdmVXS29PT0JsK09CdnVPQm1RcHdaR1pxY3kxbFpHbDBiM0l0WVdSa0xYTnBaMjVoZEhWeVpTMWtaWE5qY21sd2RHbHZiaTFrWldaaGRXeDBMWGRvWlc0dFpISmhkMmx1WnlBOUlPZTlzdVdRalFwd1pHWnFjeTFsWkdsMGIzSXRZV1JrTFhOcFoyNWhkSFZ5WlMxamJHVmhjaTFpZFhSMGIyNHRiR0ZpWld3Z1BTRG52Ykxsa0kzamdwTG10b2psanJzS2NHUm1hbk10WldScGRHOXlMV0ZrWkMxemFXZHVZWFIxY21VdFkyeGxZWEl0WW5WMGRHOXVJRDBLSUNBZ0lDNTBhWFJzWlNBOUlPZTlzdVdRamVPQ2t1YTJpT1dPdStPQmwrT0J2dU9CbVFwd1pHWnFjeTFsWkdsMGIzSXRZV1JrTFhOcFoyNWhkSFZ5WlMxellYWmxMV05vWldOclltOTRJRDBnNTcyeTVaQ040NEtTNUwrZDVhMllDbkJrWm1wekxXVmthWFJ2Y2kxaFpHUXRjMmxuYm1GMGRYSmxMWE5oZG1VdGQyRnlibWx1WnkxdFpYTnpZV2RsSUQwZzVMK2Q1YTJZNDRHVjQ0S000NEdmNTcyeTVaQ040NEdNNUxpSzZabVE0NEd1SURVZzVZQ0w0NEdyNllHVTQ0R1g0NEcrNDRHWDQ0R2Y0NENDNDRHVjQ0S0o0NEdyNUwrZDVhMlk0NEdaNDRLTDQ0R3I0NEd2NDRHRTQ0R2E0NEtNNDRHTDQ0S1M1WW1LNlptazQ0R1g0NEdtNDRHUDQ0R2c0NEdWNDRHRTQ0Q0NDbkJrWm1wekxXVmthWFJ2Y2kxaFpHUXRjMmxuYm1GMGRYSmxMV2x0WVdkbExYVndiRzloWkMxbGNuSnZjaTEwYVhSc1pTQTlJT2VVdStXRGorT0NrdU9Db3VPRGcrT0RsK09EcmVPRHZPT0RpZU9CcCtPQmplT0J2dU9CbStPQ2t3cHdaR1pxY3kxbFpHbDBiM0l0WVdSa0xYTnBaMjVoZEhWeVpTMXBiV0ZuWlMxMWNHeHZZV1F0WlhKeWIzSXRaR1Z6WTNKcGNIUnBiMjRnUFNEamc0M2pnNFBqZzRqamc2L2pnN3pqZ3EvbWpxWG50cHJqZ3BMbm9ycm9xbzNqZ1puamdvdmpnWXZsaUtYamdhN25sTHZsZzQvamdwTG9xYWJqZ1pmamdhYmpnWS9qZ2FEamdaWGpnWVRqZ0lJS2NHUm1hbk10WldScGRHOXlMV0ZrWkMxemFXZHVZWFIxY21VdFpYSnliM0l0WTJ4dmMyVXRZblYwZEc5dUlEMGc2WmFKNDRHWTQ0S0xDZ29qSXlCRWFXRnNiMmNnWW5WMGRHOXVjd29LY0dSbWFuTXRaV1JwZEc5eUxXRmtaQzF6YVdkdVlYUjFjbVV0WTJGdVkyVnNMV0oxZEhSdmJpQTlJT09DcmVPRG8rT0RzK09DdStPRHF3cHdaR1pxY3kxbFpHbDBiM0l0WVdSa0xYTnBaMjVoZEhWeVpTMWhaR1F0WW5WMGRHOXVJRDBnNkwrOTVZcWdDbkJrWm1wekxXVmthWFJ2Y2kxbFpHbDBMWE5wWjI1aGRIVnlaUzExY0dSaGRHVXRZblYwZEc5dUlEMGc1cHUwNXBhd0Nnb2pJeUJOWVdsdUlHMWxiblVnWm05eUlHRmtaR2x1Wnk5eVpXMXZkbWx1WnlCemFXZHVZWFIxY21WekNncHdaR1pxY3kxbFpHbDBiM0l0WkdWc1pYUmxMWE5wWjI1aGRIVnlaUzFpZFhSMGIyNHhJRDBLSUNBZ0lDNTBhWFJzWlNBOUlPUy9uZVd0bU9PQmxlT0NqT09CbitlOXN1V1FqZU9Da3VXSml1bVpwT09CbCtPQnZ1T0JtUXB3WkdacWN5MWxaR2wwYjNJdFpHVnNaWFJsTFhOcFoyNWhkSFZ5WlMxaWRYUjBiMjR0YkdGaVpXd3hJRDBnNUwrZDVhMlk0NEdWNDRLTTQ0R2Y1NzJ5NVpDTjQ0S1M1WW1LNlpta0Nnb2pJeUJGWkdsMGIzSWdkRzl2YkdKaGNnb0tjR1JtYW5NdFpXUnBkRzl5TFdGa1pDMXphV2R1WVhSMWNtVXRaV1JwZEMxaWRYUjBiMjR0YkdGaVpXd2dQU0RvcXF6bW1JN2pncExudDZqcG00WUtDaU1qSUVWa2FYUWdjMmxuYm1GMGRYSmxJR1JsYzJOeWFYQjBhVzl1SUdScFlXeHZad29LY0dSbWFuTXRaV1JwZEc5eUxXVmthWFF0YzJsbmJtRjBkWEpsTFdScFlXeHZaeTEwYVhSc1pTQTlJT2lxck9hWWp1T0JydWUzcU9tYmhnbz0ifQ==">
<script src="data:text/plain;base64,LyoqCiAqIEBsaWNzdGFydCBUaGUgZm9sbG93aW5nIGlzIHRoZSBlbnRpcmUgbGljZW5zZSBub3RpY2UgZm9yIHRoZQogKiBKYXZhU2NyaXB0IGNvZGUgaW4gdGhpcyBwYWdlCiAqCiAqIENvcHlyaWdodCAyMDI0IE1vemlsbGEgRm91bmRhdGlvbgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKiBAbGljZW5kIFRoZSBhYm92ZSBpcyB0aGUgZW50aXJlIGxpY2Vuc2Ugbm90aWNlIGZvciB0aGUKICogSmF2YVNjcmlwdCBjb2RlIGluIHRoaXMgcGFnZQogKi8KCi8qKgogKiBwZGZqc1ZlcnNpb24gPSA1LjMuMzEKICogcGRmanNCdWlsZCA9IDQ3YWQ4MjBkOQogKi8KCjsvLyAuL3NyYy9zaGFyZWQvdXRpbC5qcwpjb25zdCBpc05vZGVKUyA9IHR5cGVvZiBwcm9jZXNzID09PSAib2JqZWN0IiAmJiBwcm9jZXNzICsgIiIgPT09ICJbb2JqZWN0IHByb2Nlc3NdIiAmJiAhcHJvY2Vzcy52ZXJzaW9ucy5udyAmJiAhKHByb2Nlc3MudmVyc2lvbnMuZWxlY3Ryb24gJiYgcHJvY2Vzcy50eXBlICYmIHByb2Nlc3MudHlwZSAhPT0gImJyb3dzZXIiKTsKY29uc3QgRk9OVF9JREVOVElUWV9NQVRSSVggPSBbMC4wMDEsIDAsIDAsIDAuMDAxLCAwLCAwXTsKY29uc3QgTElORV9GQUNUT1IgPSAxLjM1Owpjb25zdCBMSU5FX0RFU0NFTlRfRkFDVE9SID0gMC4zNTsKY29uc3QgQkFTRUxJTkVfRkFDVE9SID0gTElORV9ERVNDRU5UX0ZBQ1RPUiAvIExJTkVfRkFDVE9SOwpjb25zdCBSZW5kZXJpbmdJbnRlbnRGbGFnID0gewogIEFOWTogMHgwMSwKICBESVNQTEFZOiAweDAyLAogIFBSSU5UOiAweDA0LAogIFNBVkU6IDB4MDgsCiAgQU5OT1RBVElPTlNfRk9STVM6IDB4MTAsCiAgQU5OT1RBVElPTlNfU1RPUkFHRTogMHgyMCwKICBBTk5PVEFUSU9OU19ESVNBQkxFOiAweDQwLAogIElTX0VESVRJTkc6IDB4ODAsCiAgT1BMSVNUOiAweDEwMAp9Owpjb25zdCBBbm5vdGF0aW9uTW9kZSA9IHsKICBESVNBQkxFOiAwLAogIEVOQUJMRTogMSwKICBFTkFCTEVfRk9STVM6IDIsCiAgRU5BQkxFX1NUT1JBR0U6IDMKfTsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclByZWZpeCA9ICJwZGZqc19pbnRlcm5hbF9lZGl0b3JfIjsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclR5cGUgPSB7CiAgRElTQUJMRTogLTEsCiAgTk9ORTogMCwKICBGUkVFVEVYVDogMywKICBISUdITElHSFQ6IDksCiAgU1RBTVA6IDEzLAogIElOSzogMTUsCiAgU0lHTkFUVVJFOiAxMDEKfTsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUgPSB7CiAgUkVTSVpFOiAxLAogIENSRUFURTogMiwKICBGUkVFVEVYVF9TSVpFOiAxMSwKICBGUkVFVEVYVF9DT0xPUjogMTIsCiAgRlJFRVRFWFRfT1BBQ0lUWTogMTMsCiAgSU5LX0NPTE9SOiAyMSwKICBJTktfVEhJQ0tORVNTOiAyMiwKICBJTktfT1BBQ0lUWTogMjMsCiAgSElHSExJR0hUX0NPTE9SOiAzMSwKICBISUdITElHSFRfREVGQVVMVF9DT0xPUjogMzIsCiAgSElHSExJR0hUX1RISUNLTkVTUzogMzMsCiAgSElHSExJR0hUX0ZSRUU6IDM0LAogIEhJR0hMSUdIVF9TSE9XX0FMTDogMzUsCiAgRFJBV19TVEVQOiA0MQp9Owpjb25zdCBQZXJtaXNzaW9uRmxhZyA9IHsKICBQUklOVDogMHgwNCwKICBNT0RJRllfQ09OVEVOVFM6IDB4MDgsCiAgQ09QWTogMHgxMCwKICBNT0RJRllfQU5OT1RBVElPTlM6IDB4MjAsCiAgRklMTF9JTlRFUkFDVElWRV9GT1JNUzogMHgxMDAsCiAgQ09QWV9GT1JfQUNDRVNTSUJJTElUWTogMHgyMDAsCiAgQVNTRU1CTEU6IDB4NDAwLAogIFBSSU5UX0hJR0hfUVVBTElUWTogMHg4MDAKfTsKY29uc3QgVGV4dFJlbmRlcmluZ01vZGUgPSB7CiAgRklMTDogMCwKICBTVFJPS0U6IDEsCiAgRklMTF9TVFJPS0U6IDIsCiAgSU5WSVNJQkxFOiAzLAogIEZJTExfQUREX1RPX1BBVEg6IDQsCiAgU1RST0tFX0FERF9UT19QQVRIOiA1LAogIEZJTExfU1RST0tFX0FERF9UT19QQVRIOiA2LAogIEFERF9UT19QQVRIOiA3LAogIEZJTExfU1RST0tFX01BU0s6IDMsCiAgQUREX1RPX1BBVEhfRkxBRzogNAp9Owpjb25zdCB1dGlsX0ltYWdlS2luZCA9IHsKICBHUkFZU0NBTEVfMUJQUDogMSwKICBSR0JfMjRCUFA6IDIsCiAgUkdCQV8zMkJQUDogMwp9Owpjb25zdCBBbm5vdGF0aW9uVHlwZSA9IHsKICBURVhUOiAxLAogIExJTks6IDIsCiAgRlJFRVRFWFQ6IDMsCiAgTElORTogNCwKICBTUVVBUkU6IDUsCiAgQ0lSQ0xFOiA2LAogIFBPTFlHT046IDcsCiAgUE9MWUxJTkU6IDgsCiAgSElHSExJR0hUOiA5LAogIFVOREVSTElORTogMTAsCiAgU1FVSUdHTFk6IDExLAogIFNUUklLRU9VVDogMTIsCiAgU1RBTVA6IDEzLAogIENBUkVUOiAxNCwKICBJTks6IDE1LAogIFBPUFVQOiAxNiwKICBGSUxFQVRUQUNITUVOVDogMTcsCiAgU09VTkQ6IDE4LAogIE1PVklFOiAxOSwKICBXSURHRVQ6IDIwLAogIFNDUkVFTjogMjEsCiAgUFJJTlRFUk1BUks6IDIyLAogIFRSQVBORVQ6IDIzLAogIFdBVEVSTUFSSzogMjQsCiAgVEhSRUVEOiAyNSwKICBSRURBQ1Q6IDI2Cn07CmNvbnN0IEFubm90YXRpb25SZXBseVR5cGUgPSB7CiAgR1JPVVA6ICJHcm91cCIsCiAgUkVQTFk6ICJSIgp9Owpjb25zdCBBbm5vdGF0aW9uRmxhZyA9IHsKICBJTlZJU0lCTEU6IDB4MDEsCiAgSElEREVOOiAweDAyLAogIFBSSU5UOiAweDA0LAogIE5PWk9PTTogMHgwOCwKICBOT1JPVEFURTogMHgxMCwKICBOT1ZJRVc6IDB4MjAsCiAgUkVBRE9OTFk6IDB4NDAsCiAgTE9DS0VEOiAweDgwLAogIFRPR0dMRU5PVklFVzogMHgxMDAsCiAgTE9DS0VEQ09OVEVOVFM6IDB4MjAwCn07CmNvbnN0IEFubm90YXRpb25GaWVsZEZsYWcgPSB7CiAgUkVBRE9OTFk6IDB4MDAwMDAwMSwKICBSRVFVSVJFRDogMHgwMDAwMDAyLAogIE5PRVhQT1JUOiAweDAwMDAwMDQsCiAgTVVMVElMSU5FOiAweDAwMDEwMDAsCiAgUEFTU1dPUkQ6IDB4MDAwMjAwMCwKICBOT1RPR0dMRVRPT0ZGOiAweDAwMDQwMDAsCiAgUkFESU86IDB4MDAwODAwMCwKICBQVVNIQlVUVE9OOiAweDAwMTAwMDAsCiAgQ09NQk86IDB4MDAyMDAwMCwKICBFRElUOiAweDAwNDAwMDAsCiAgU09SVDogMHgwMDgwMDAwLAogIEZJTEVTRUxFQ1Q6IDB4MDEwMDAwMCwKICBNVUxUSVNFTEVDVDogMHgwMjAwMDAwLAogIERPTk9UU1BFTExDSEVDSzogMHgwNDAwMDAwLAogIERPTk9UU0NST0xMOiAweDA4MDAwMDAsCiAgQ09NQjogMHgxMDAwMDAwLAogIFJJQ0hURVhUOiAweDIwMDAwMDAsCiAgUkFESU9TSU5VTklTT046IDB4MjAwMDAwMCwKICBDT01NSVRPTlNFTENIQU5HRTogMHg0MDAwMDAwCn07CmNvbnN0IEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUgPSB7CiAgU09MSUQ6IDEsCiAgREFTSEVEOiAyLAogIEJFVkVMRUQ6IDMsCiAgSU5TRVQ6IDQsCiAgVU5ERVJMSU5FOiA1Cn07CmNvbnN0IEFubm90YXRpb25BY3Rpb25FdmVudFR5cGUgPSB7CiAgRTogIk1vdXNlIEVudGVyIiwKICBYOiAiTW91c2UgRXhpdCIsCiAgRDogIk1vdXNlIERvd24iLAogIFU6ICJNb3VzZSBVcCIsCiAgRm86ICJGb2N1cyIsCiAgQmw6ICJCbHVyIiwKICBQTzogIlBhZ2VPcGVuIiwKICBQQzogIlBhZ2VDbG9zZSIsCiAgUFY6ICJQYWdlVmlzaWJsZSIsCiAgUEk6ICJQYWdlSW52aXNpYmxlIiwKICBLOiAiS2V5c3Ryb2tlIiwKICBGOiAiRm9ybWF0IiwKICBWOiAiVmFsaWRhdGUiLAogIEM6ICJDYWxjdWxhdGUiCn07CmNvbnN0IERvY3VtZW50QWN0aW9uRXZlbnRUeXBlID0gewogIFdDOiAiV2lsbENsb3NlIiwKICBXUzogIldpbGxTYXZlIiwKICBEUzogIkRpZFNhdmUiLAogIFdQOiAiV2lsbFByaW50IiwKICBEUDogIkRpZFByaW50Igp9Owpjb25zdCBQYWdlQWN0aW9uRXZlbnRUeXBlID0gewogIE86ICJQYWdlT3BlbiIsCiAgQzogIlBhZ2VDbG9zZSIKfTsKY29uc3QgVmVyYm9zaXR5TGV2ZWwgPSB7CiAgRVJST1JTOiAwLAogIFdBUk5JTkdTOiAxLAogIElORk9TOiA1Cn07CmNvbnN0IE9QUyA9IHsKICBkZXBlbmRlbmN5OiAxLAogIHNldExpbmVXaWR0aDogMiwKICBzZXRMaW5lQ2FwOiAzLAogIHNldExpbmVKb2luOiA0LAogIHNldE1pdGVyTGltaXQ6IDUsCiAgc2V0RGFzaDogNiwKICBzZXRSZW5kZXJpbmdJbnRlbnQ6IDcsCiAgc2V0RmxhdG5lc3M6IDgsCiAgc2V0R1N0YXRlOiA5LAogIHNhdmU6IDEwLAogIHJlc3RvcmU6IDExLAogIHRyYW5zZm9ybTogMTIsCiAgbW92ZVRvOiAxMywKICBsaW5lVG86IDE0LAogIGN1cnZlVG86IDE1LAogIGN1cnZlVG8yOiAxNiwKICBjdXJ2ZVRvMzogMTcsCiAgY2xvc2VQYXRoOiAxOCwKICByZWN0YW5nbGU6IDE5LAogIHN0cm9rZTogMjAsCiAgY2xvc2VTdHJva2U6IDIxLAogIGZpbGw6IDIyLAogIGVvRmlsbDogMjMsCiAgZmlsbFN0cm9rZTogMjQsCiAgZW9GaWxsU3Ryb2tlOiAyNSwKICBjbG9zZUZpbGxTdHJva2U6IDI2LAogIGNsb3NlRU9GaWxsU3Ryb2tlOiAyNywKICBlbmRQYXRoOiAyOCwKICBjbGlwOiAyOSwKICBlb0NsaXA6IDMwLAogIGJlZ2luVGV4dDogMzEsCiAgZW5kVGV4dDogMzIsCiAgc2V0Q2hhclNwYWNpbmc6IDMzLAogIHNldFdvcmRTcGFjaW5nOiAzNCwKICBzZXRIU2NhbGU6IDM1LAogIHNldExlYWRpbmc6IDM2LAogIHNldEZvbnQ6IDM3LAogIHNldFRleHRSZW5kZXJpbmdNb2RlOiAzOCwKICBzZXRUZXh0UmlzZTogMzksCiAgbW92ZVRleHQ6IDQwLAogIHNldExlYWRpbmdNb3ZlVGV4dDogNDEsCiAgc2V0VGV4dE1hdHJpeDogNDIsCiAgbmV4dExpbmU6IDQzLAogIHNob3dUZXh0OiA0NCwKICBzaG93U3BhY2VkVGV4dDogNDUsCiAgbmV4dExpbmVTaG93VGV4dDogNDYsCiAgbmV4dExpbmVTZXRTcGFjaW5nU2hvd1RleHQ6IDQ3LAogIHNldENoYXJXaWR0aDogNDgsCiAgc2V0Q2hhcldpZHRoQW5kQm91bmRzOiA0OSwKICBzZXRTdHJva2VDb2xvclNwYWNlOiA1MCwKICBzZXRGaWxsQ29sb3JTcGFjZTogNTEsCiAgc2V0U3Ryb2tlQ29sb3I6IDUyLAogIHNldFN0cm9rZUNvbG9yTjogNTMsCiAgc2V0RmlsbENvbG9yOiA1NCwKICBzZXRGaWxsQ29sb3JOOiA1NSwKICBzZXRTdHJva2VHcmF5OiA1NiwKICBzZXRGaWxsR3JheTogNTcsCiAgc2V0U3Ryb2tlUkdCQ29sb3I6IDU4LAogIHNldEZpbGxSR0JDb2xvcjogNTksCiAgc2V0U3Ryb2tlQ01ZS0NvbG9yOiA2MCwKICBzZXRGaWxsQ01ZS0NvbG9yOiA2MSwKICBzaGFkaW5nRmlsbDogNjIsCiAgYmVnaW5JbmxpbmVJbWFnZTogNjMsCiAgYmVnaW5JbWFnZURhdGE6IDY0LAogIGVuZElubGluZUltYWdlOiA2NSwKICBwYWludFhPYmplY3Q6IDY2LAogIG1hcmtQb2ludDogNjcsCiAgbWFya1BvaW50UHJvcHM6IDY4LAogIGJlZ2luTWFya2VkQ29udGVudDogNjksCiAgYmVnaW5NYXJrZWRDb250ZW50UHJvcHM6IDcwLAogIGVuZE1hcmtlZENvbnRlbnQ6IDcxLAogIGJlZ2luQ29tcGF0OiA3MiwKICBlbmRDb21wYXQ6IDczLAogIHBhaW50Rm9ybVhPYmplY3RCZWdpbjogNzQsCiAgcGFpbnRGb3JtWE9iamVjdEVuZDogNzUsCiAgYmVnaW5Hcm91cDogNzYsCiAgZW5kR3JvdXA6IDc3LAogIGJlZ2luQW5ub3RhdGlvbjogODAsCiAgZW5kQW5ub3RhdGlvbjogODEsCiAgcGFpbnRJbWFnZU1hc2tYT2JqZWN0OiA4MywKICBwYWludEltYWdlTWFza1hPYmplY3RHcm91cDogODQsCiAgcGFpbnRJbWFnZVhPYmplY3Q6IDg1LAogIHBhaW50SW5saW5lSW1hZ2VYT2JqZWN0OiA4NiwKICBwYWludElubGluZUltYWdlWE9iamVjdEdyb3VwOiA4NywKICBwYWludEltYWdlWE9iamVjdFJlcGVhdDogODgsCiAgcGFpbnRJbWFnZU1hc2tYT2JqZWN0UmVwZWF0OiA4OSwKICBwYWludFNvbGlkQ29sb3JJbWFnZU1hc2s6IDkwLAogIGNvbnN0cnVjdFBhdGg6IDkxLAogIHNldFN0cm9rZVRyYW5zcGFyZW50OiA5MiwKICBzZXRGaWxsVHJhbnNwYXJlbnQ6IDkzLAogIHJhd0ZpbGxQYXRoOiA5NAp9Owpjb25zdCBEcmF3T1BTID0gewogIG1vdmVUbzogMCwKICBsaW5lVG86IDEsCiAgY3VydmVUbzogMiwKICBjbG9zZVBhdGg6IDMKfTsKY29uc3QgUGFzc3dvcmRSZXNwb25zZXMgPSB7CiAgTkVFRF9QQVNTV09SRDogMSwKICBJTkNPUlJFQ1RfUEFTU1dPUkQ6IDIKfTsKbGV0IHZlcmJvc2l0eSA9IFZlcmJvc2l0eUxldmVsLldBUk5JTkdTOwpmdW5jdGlvbiBzZXRWZXJib3NpdHlMZXZlbChsZXZlbCkgewogIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGxldmVsKSkgewogICAgdmVyYm9zaXR5ID0gbGV2ZWw7CiAgfQp9CmZ1bmN0aW9uIGdldFZlcmJvc2l0eUxldmVsKCkgewogIHJldHVybiB2ZXJib3NpdHk7Cn0KZnVuY3Rpb24gaW5mbyhtc2cpIHsKICBpZiAodmVyYm9zaXR5ID49IFZlcmJvc2l0eUxldmVsLklORk9TKSB7CiAgICBjb25zb2xlLmxvZyhgSW5mbzogJHttc2d9YCk7CiAgfQp9CmZ1bmN0aW9uIHdhcm4obXNnKSB7CiAgaWYgKHZlcmJvc2l0eSA+PSBWZXJib3NpdHlMZXZlbC5XQVJOSU5HUykgewogICAgY29uc29sZS5sb2coYFdhcm5pbmc6ICR7bXNnfWApOwogIH0KfQpmdW5jdGlvbiB1bnJlYWNoYWJsZShtc2cpIHsKICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKfQpmdW5jdGlvbiBhc3NlcnQoY29uZCwgbXNnKSB7CiAgaWYgKCFjb25kKSB7CiAgICB1bnJlYWNoYWJsZShtc2cpOwogIH0KfQpmdW5jdGlvbiBfaXNWYWxpZFByb3RvY29sKHVybCkgewogIHN3aXRjaCAodXJsPy5wcm90b2NvbCkgewogICAgY2FzZSAiaHR0cDoiOgogICAgY2FzZSAiaHR0cHM6IjoKICAgIGNhc2UgImZ0cDoiOgogICAgY2FzZSAibWFpbHRvOiI6CiAgICBjYXNlICJ0ZWw6IjoKICAgICAgcmV0dXJuIHRydWU7CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gZmFsc2U7CiAgfQp9CmZ1bmN0aW9uIGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwodXJsLCBiYXNlVXJsID0gbnVsbCwgb3B0aW9ucyA9IG51bGwpIHsKICBpZiAoIXVybCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChvcHRpb25zICYmIHR5cGVvZiB1cmwgPT09ICJzdHJpbmciKSB7CiAgICBpZiAob3B0aW9ucy5hZGREZWZhdWx0UHJvdG9jb2wgJiYgdXJsLnN0YXJ0c1dpdGgoInd3dy4iKSkgewogICAgICBjb25zdCBkb3RzID0gdXJsLm1hdGNoKC9cLi9nKTsKICAgICAgaWYgKGRvdHM/Lmxlbmd0aCA+PSAyKSB7CiAgICAgICAgdXJsID0gYGh0dHA6Ly8ke3VybH1gOwogICAgICB9CiAgICB9CiAgICBpZiAob3B0aW9ucy50cnlDb252ZXJ0RW5jb2RpbmcpIHsKICAgICAgdHJ5IHsKICAgICAgICB1cmwgPSBzdHJpbmdUb1VURjhTdHJpbmcodXJsKTsKICAgICAgfSBjYXRjaCB7fQogICAgfQogIH0KICBjb25zdCBhYnNvbHV0ZVVybCA9IGJhc2VVcmwgPyBVUkwucGFyc2UodXJsLCBiYXNlVXJsKSA6IFVSTC5wYXJzZSh1cmwpOwogIHJldHVybiBfaXNWYWxpZFByb3RvY29sKGFic29sdXRlVXJsKSA/IGFic29sdXRlVXJsIDogbnVsbDsKfQpmdW5jdGlvbiB1cGRhdGVVcmxIYXNoKHVybCwgaGFzaCwgYWxsb3dSZWwgPSBmYWxzZSkgewogIGNvbnN0IHJlcyA9IFVSTC5wYXJzZSh1cmwpOwogIGlmIChyZXMpIHsKICAgIHJlcy5oYXNoID0gaGFzaDsKICAgIHJldHVybiByZXMuaHJlZjsKICB9CiAgaWYgKGFsbG93UmVsICYmIGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwodXJsLCAiaHR0cDovL2V4YW1wbGUuY29tIikpIHsKICAgIHJldHVybiB1cmwuc3BsaXQoIiMiLCAxKVswXSArIGAke2hhc2ggPyBgIyR7aGFzaH1gIDogIiJ9YDsKICB9CiAgcmV0dXJuICIiOwp9CmZ1bmN0aW9uIHNoYWRvdyhvYmosIHByb3AsIHZhbHVlLCBub25TZXJpYWxpemFibGUgPSBmYWxzZSkgewogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIHByb3AsIHsKICAgIHZhbHVlLAogICAgZW51bWVyYWJsZTogIW5vblNlcmlhbGl6YWJsZSwKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIHdyaXRhYmxlOiBmYWxzZQogIH0pOwogIHJldHVybiB2YWx1ZTsKfQpjb25zdCBCYXNlRXhjZXB0aW9uID0gZnVuY3Rpb24gQmFzZUV4Y2VwdGlvbkNsb3N1cmUoKSB7CiAgZnVuY3Rpb24gQmFzZUV4Y2VwdGlvbihtZXNzYWdlLCBuYW1lKSB7CiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogICAgdGhpcy5uYW1lID0gbmFtZTsKICB9CiAgQmFzZUV4Y2VwdGlvbi5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTsKICBCYXNlRXhjZXB0aW9uLmNvbnN0cnVjdG9yID0gQmFzZUV4Y2VwdGlvbjsKICByZXR1cm4gQmFzZUV4Y2VwdGlvbjsKfSgpOwpjbGFzcyBQYXNzd29yZEV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZywgY29kZSkgewogICAgc3VwZXIobXNnLCAiUGFzc3dvcmRFeGNlcHRpb24iKTsKICAgIHRoaXMuY29kZSA9IGNvZGU7CiAgfQp9CmNsYXNzIFVua25vd25FcnJvckV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZywgZGV0YWlscykgewogICAgc3VwZXIobXNnLCAiVW5rbm93bkVycm9yRXhjZXB0aW9uIik7CiAgICB0aGlzLmRldGFpbHMgPSBkZXRhaWxzOwogIH0KfQpjbGFzcyBJbnZhbGlkUERGRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnKSB7CiAgICBzdXBlcihtc2csICJJbnZhbGlkUERGRXhjZXB0aW9uIik7CiAgfQp9CmNsYXNzIFJlc3BvbnNlRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnLCBzdGF0dXMsIG1pc3NpbmcpIHsKICAgIHN1cGVyKG1zZywgIlJlc3BvbnNlRXhjZXB0aW9uIik7CiAgICB0aGlzLnN0YXR1cyA9IHN0YXR1czsKICAgIHRoaXMubWlzc2luZyA9IG1pc3Npbmc7CiAgfQp9CmNsYXNzIEZvcm1hdEVycm9yIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnKSB7CiAgICBzdXBlcihtc2csICJGb3JtYXRFcnJvciIpOwogIH0KfQpjbGFzcyBBYm9ydEV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiQWJvcnRFeGNlcHRpb24iKTsKICB9Cn0KZnVuY3Rpb24gYnl0ZXNUb1N0cmluZyhieXRlcykgewogIGlmICh0eXBlb2YgYnl0ZXMgIT09ICJvYmplY3QiIHx8IGJ5dGVzPy5sZW5ndGggPT09IHVuZGVmaW5lZCkgewogICAgdW5yZWFjaGFibGUoIkludmFsaWQgYXJndW1lbnQgZm9yIGJ5dGVzVG9TdHJpbmciKTsKICB9CiAgY29uc3QgbGVuZ3RoID0gYnl0ZXMubGVuZ3RoOwogIGNvbnN0IE1BWF9BUkdVTUVOVF9DT1VOVCA9IDgxOTI7CiAgaWYgKGxlbmd0aCA8IE1BWF9BUkdVTUVOVF9DT1VOVCkgewogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgYnl0ZXMpOwogIH0KICBjb25zdCBzdHJCdWYgPSBbXTsKICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSBNQVhfQVJHVU1FTlRfQ09VTlQpIHsKICAgIGNvbnN0IGNodW5rRW5kID0gTWF0aC5taW4oaSArIE1BWF9BUkdVTUVOVF9DT1VOVCwgbGVuZ3RoKTsKICAgIGNvbnN0IGNodW5rID0gYnl0ZXMuc3ViYXJyYXkoaSwgY2h1bmtFbmQpOwogICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBjaHVuaykpOwogIH0KICByZXR1cm4gc3RyQnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHN0cmluZ1RvQnl0ZXMoc3RyKSB7CiAgaWYgKHR5cGVvZiBzdHIgIT09ICJzdHJpbmciKSB7CiAgICB1bnJlYWNoYWJsZSgiSW52YWxpZCBhcmd1bWVudCBmb3Igc3RyaW5nVG9CeXRlcyIpOwogIH0KICBjb25zdCBsZW5ndGggPSBzdHIubGVuZ3RoOwogIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsKICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICBieXRlc1tpXSA9IHN0ci5jaGFyQ29kZUF0KGkpICYgMHhmZjsKICB9CiAgcmV0dXJuIGJ5dGVzOwp9CmZ1bmN0aW9uIHN0cmluZzMyKHZhbHVlKSB7CiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUodmFsdWUgPj4gMjQgJiAweGZmLCB2YWx1ZSA+PiAxNiAmIDB4ZmYsIHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmYpOwp9CmZ1bmN0aW9uIG9iamVjdFNpemUob2JqKSB7CiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikubGVuZ3RoOwp9CmZ1bmN0aW9uIGlzTGl0dGxlRW5kaWFuKCkgewogIGNvbnN0IGJ1ZmZlcjggPSBuZXcgVWludDhBcnJheSg0KTsKICBidWZmZXI4WzBdID0gMTsKICBjb25zdCB2aWV3MzIgPSBuZXcgVWludDMyQXJyYXkoYnVmZmVyOC5idWZmZXIsIDAsIDEpOwogIHJldHVybiB2aWV3MzJbMF0gPT09IDE7Cn0KZnVuY3Rpb24gaXNFdmFsU3VwcG9ydGVkKCkgewogIHRyeSB7CiAgICBuZXcgRnVuY3Rpb24oIiIpOwogICAgcmV0dXJuIHRydWU7CiAgfSBjYXRjaCB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9CmNsYXNzIHV0aWxfRmVhdHVyZVRlc3QgewogIHN0YXRpYyBnZXQgaXNMaXR0bGVFbmRpYW4oKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc0xpdHRsZUVuZGlhbiIsIGlzTGl0dGxlRW5kaWFuKCkpOwogIH0KICBzdGF0aWMgZ2V0IGlzRXZhbFN1cHBvcnRlZCgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImlzRXZhbFN1cHBvcnRlZCIsIGlzRXZhbFN1cHBvcnRlZCgpKTsKICB9CiAgc3RhdGljIGdldCBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkIiwgdHlwZW9mIE9mZnNjcmVlbkNhbnZhcyAhPT0gInVuZGVmaW5lZCIpOwogIH0KICBzdGF0aWMgZ2V0IGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNJbWFnZURlY29kZXJTdXBwb3J0ZWQiLCB0eXBlb2YgSW1hZ2VEZWNvZGVyICE9PSAidW5kZWZpbmVkIik7CiAgfQogIHN0YXRpYyBnZXQgcGxhdGZvcm0oKSB7CiAgICBjb25zdCB7CiAgICAgIHBsYXRmb3JtLAogICAgICB1c2VyQWdlbnQKICAgIH0gPSBuYXZpZ2F0b3I7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJwbGF0Zm9ybSIsIHsKICAgICAgaXNBbmRyb2lkOiB1c2VyQWdlbnQuaW5jbHVkZXMoIkFuZHJvaWQiKSwKICAgICAgaXNMaW51eDogcGxhdGZvcm0uaW5jbHVkZXMoIkxpbnV4IiksCiAgICAgIGlzTWFjOiBwbGF0Zm9ybS5pbmNsdWRlcygiTWFjIiksCiAgICAgIGlzV2luZG93czogcGxhdGZvcm0uaW5jbHVkZXMoIldpbiIpLAogICAgICBpc0ZpcmVmb3g6IHVzZXJBZ2VudC5pbmNsdWRlcygiRmlyZWZveCIpCiAgICB9KTsKICB9CiAgc3RhdGljIGdldCBpc0NTU1JvdW5kU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNDU1NSb3VuZFN1cHBvcnRlZCIsIGdsb2JhbFRoaXMuQ1NTPy5zdXBwb3J0cz8uKCJ3aWR0aDogcm91bmQoMS41cHgsIDFweCkiKSk7CiAgfQp9CmNvbnN0IGhleE51bWJlcnMgPSBBcnJheS5mcm9tKEFycmF5KDI1Nikua2V5cygpLCBuID0+IG4udG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICIwIikpOwpjbGFzcyBVdGlsIHsKICBzdGF0aWMgbWFrZUhleENvbG9yKHIsIGcsIGIpIHsKICAgIHJldHVybiBgIyR7aGV4TnVtYmVyc1tyXX0ke2hleE51bWJlcnNbZ119JHtoZXhOdW1iZXJzW2JdfWA7CiAgfQogIHN0YXRpYyBzY2FsZU1pbk1heCh0cmFuc2Zvcm0sIG1pbk1heCkgewogICAgbGV0IHRlbXA7CiAgICBpZiAodHJhbnNmb3JtWzBdKSB7CiAgICAgIGlmICh0cmFuc2Zvcm1bMF0gPCAwKSB7CiAgICAgICAgdGVtcCA9IG1pbk1heFswXTsKICAgICAgICBtaW5NYXhbMF0gPSBtaW5NYXhbMl07CiAgICAgICAgbWluTWF4WzJdID0gdGVtcDsKICAgICAgfQogICAgICBtaW5NYXhbMF0gKj0gdHJhbnNmb3JtWzBdOwogICAgICBtaW5NYXhbMl0gKj0gdHJhbnNmb3JtWzBdOwogICAgICBpZiAodHJhbnNmb3JtWzNdIDwgMCkgewogICAgICAgIHRlbXAgPSBtaW5NYXhbMV07CiAgICAgICAgbWluTWF4WzFdID0gbWluTWF4WzNdOwogICAgICAgIG1pbk1heFszXSA9IHRlbXA7CiAgICAgIH0KICAgICAgbWluTWF4WzFdICo9IHRyYW5zZm9ybVszXTsKICAgICAgbWluTWF4WzNdICo9IHRyYW5zZm9ybVszXTsKICAgIH0gZWxzZSB7CiAgICAgIHRlbXAgPSBtaW5NYXhbMF07CiAgICAgIG1pbk1heFswXSA9IG1pbk1heFsxXTsKICAgICAgbWluTWF4WzFdID0gdGVtcDsKICAgICAgdGVtcCA9IG1pbk1heFsyXTsKICAgICAgbWluTWF4WzJdID0gbWluTWF4WzNdOwogICAgICBtaW5NYXhbM10gPSB0ZW1wOwogICAgICBpZiAodHJhbnNmb3JtWzFdIDwgMCkgewogICAgICAgIHRlbXAgPSBtaW5NYXhbMV07CiAgICAgICAgbWluTWF4WzFdID0gbWluTWF4WzNdOwogICAgICAgIG1pbk1heFszXSA9IHRlbXA7CiAgICAgIH0KICAgICAgbWluTWF4WzFdICo9IHRyYW5zZm9ybVsxXTsKICAgICAgbWluTWF4WzNdICo9IHRyYW5zZm9ybVsxXTsKICAgICAgaWYgKHRyYW5zZm9ybVsyXSA8IDApIHsKICAgICAgICB0ZW1wID0gbWluTWF4WzBdOwogICAgICAgIG1pbk1heFswXSA9IG1pbk1heFsyXTsKICAgICAgICBtaW5NYXhbMl0gPSB0ZW1wOwogICAgICB9CiAgICAgIG1pbk1heFswXSAqPSB0cmFuc2Zvcm1bMl07CiAgICAgIG1pbk1heFsyXSAqPSB0cmFuc2Zvcm1bMl07CiAgICB9CiAgICBtaW5NYXhbMF0gKz0gdHJhbnNmb3JtWzRdOwogICAgbWluTWF4WzFdICs9IHRyYW5zZm9ybVs1XTsKICAgIG1pbk1heFsyXSArPSB0cmFuc2Zvcm1bNF07CiAgICBtaW5NYXhbM10gKz0gdHJhbnNmb3JtWzVdOwogIH0KICBzdGF0aWMgdHJhbnNmb3JtKG0xLCBtMikgewogICAgcmV0dXJuIFttMVswXSAqIG0yWzBdICsgbTFbMl0gKiBtMlsxXSwgbTFbMV0gKiBtMlswXSArIG0xWzNdICogbTJbMV0sIG0xWzBdICogbTJbMl0gKyBtMVsyXSAqIG0yWzNdLCBtMVsxXSAqIG0yWzJdICsgbTFbM10gKiBtMlszXSwgbTFbMF0gKiBtMls0XSArIG0xWzJdICogbTJbNV0gKyBtMVs0XSwgbTFbMV0gKiBtMls0XSArIG0xWzNdICogbTJbNV0gKyBtMVs1XV07CiAgfQogIHN0YXRpYyBhcHBseVRyYW5zZm9ybShwLCBtLCBwb3MgPSAwKSB7CiAgICBjb25zdCBwMCA9IHBbcG9zXTsKICAgIGNvbnN0IHAxID0gcFtwb3MgKyAxXTsKICAgIHBbcG9zXSA9IHAwICogbVswXSArIHAxICogbVsyXSArIG1bNF07CiAgICBwW3BvcyArIDFdID0gcDAgKiBtWzFdICsgcDEgKiBtWzNdICsgbVs1XTsKICB9CiAgc3RhdGljIGFwcGx5VHJhbnNmb3JtVG9CZXppZXIocCwgdHJhbnNmb3JtLCBwb3MgPSAwKSB7CiAgICBjb25zdCBtMCA9IHRyYW5zZm9ybVswXTsKICAgIGNvbnN0IG0xID0gdHJhbnNmb3JtWzFdOwogICAgY29uc3QgbTIgPSB0cmFuc2Zvcm1bMl07CiAgICBjb25zdCBtMyA9IHRyYW5zZm9ybVszXTsKICAgIGNvbnN0IG00ID0gdHJhbnNmb3JtWzRdOwogICAgY29uc3QgbTUgPSB0cmFuc2Zvcm1bNV07CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkgKz0gMikgewogICAgICBjb25zdCBwSSA9IHBbcG9zICsgaV07CiAgICAgIGNvbnN0IHBJMSA9IHBbcG9zICsgaSArIDFdOwogICAgICBwW3BvcyArIGldID0gcEkgKiBtMCArIHBJMSAqIG0yICsgbTQ7CiAgICAgIHBbcG9zICsgaSArIDFdID0gcEkgKiBtMSArIHBJMSAqIG0zICsgbTU7CiAgICB9CiAgfQogIHN0YXRpYyBhcHBseUludmVyc2VUcmFuc2Zvcm0ocCwgbSkgewogICAgY29uc3QgcDAgPSBwWzBdOwogICAgY29uc3QgcDEgPSBwWzFdOwogICAgY29uc3QgZCA9IG1bMF0gKiBtWzNdIC0gbVsxXSAqIG1bMl07CiAgICBwWzBdID0gKHAwICogbVszXSAtIHAxICogbVsyXSArIG1bMl0gKiBtWzVdIC0gbVs0XSAqIG1bM10pIC8gZDsKICAgIHBbMV0gPSAoLXAwICogbVsxXSArIHAxICogbVswXSArIG1bNF0gKiBtWzFdIC0gbVs1XSAqIG1bMF0pIC8gZDsKICB9CiAgc3RhdGljIGF4aWFsQWxpZ25lZEJvdW5kaW5nQm94KHJlY3QsIHRyYW5zZm9ybSwgb3V0cHV0KSB7CiAgICBjb25zdCBtMCA9IHRyYW5zZm9ybVswXTsKICAgIGNvbnN0IG0xID0gdHJhbnNmb3JtWzFdOwogICAgY29uc3QgbTIgPSB0cmFuc2Zvcm1bMl07CiAgICBjb25zdCBtMyA9IHRyYW5zZm9ybVszXTsKICAgIGNvbnN0IG00ID0gdHJhbnNmb3JtWzRdOwogICAgY29uc3QgbTUgPSB0cmFuc2Zvcm1bNV07CiAgICBjb25zdCByMCA9IHJlY3RbMF07CiAgICBjb25zdCByMSA9IHJlY3RbMV07CiAgICBjb25zdCByMiA9IHJlY3RbMl07CiAgICBjb25zdCByMyA9IHJlY3RbM107CiAgICBsZXQgYTAgPSBtMCAqIHIwICsgbTQ7CiAgICBsZXQgYTIgPSBhMDsKICAgIGxldCBhMSA9IG0wICogcjIgKyBtNDsKICAgIGxldCBhMyA9IGExOwogICAgbGV0IGIwID0gbTMgKiByMSArIG01OwogICAgbGV0IGIyID0gYjA7CiAgICBsZXQgYjEgPSBtMyAqIHIzICsgbTU7CiAgICBsZXQgYjMgPSBiMTsKICAgIGlmIChtMSAhPT0gMCB8fCBtMiAhPT0gMCkgewogICAgICBjb25zdCBtMXIwID0gbTEgKiByMDsKICAgICAgY29uc3QgbTFyMiA9IG0xICogcjI7CiAgICAgIGNvbnN0IG0ycjEgPSBtMiAqIHIxOwogICAgICBjb25zdCBtMnIzID0gbTIgKiByMzsKICAgICAgYTAgKz0gbTJyMTsKICAgICAgYTMgKz0gbTJyMTsKICAgICAgYTEgKz0gbTJyMzsKICAgICAgYTIgKz0gbTJyMzsKICAgICAgYjAgKz0gbTFyMDsKICAgICAgYjMgKz0gbTFyMDsKICAgICAgYjEgKz0gbTFyMjsKICAgICAgYjIgKz0gbTFyMjsKICAgIH0KICAgIG91dHB1dFswXSA9IE1hdGgubWluKG91dHB1dFswXSwgYTAsIGExLCBhMiwgYTMpOwogICAgb3V0cHV0WzFdID0gTWF0aC5taW4ob3V0cHV0WzFdLCBiMCwgYjEsIGIyLCBiMyk7CiAgICBvdXRwdXRbMl0gPSBNYXRoLm1heChvdXRwdXRbMl0sIGEwLCBhMSwgYTIsIGEzKTsKICAgIG91dHB1dFszXSA9IE1hdGgubWF4KG91dHB1dFszXSwgYjAsIGIxLCBiMiwgYjMpOwogIH0KICBzdGF0aWMgaW52ZXJzZVRyYW5zZm9ybShtKSB7CiAgICBjb25zdCBkID0gbVswXSAqIG1bM10gLSBtWzFdICogbVsyXTsKICAgIHJldHVybiBbbVszXSAvIGQsIC1tWzFdIC8gZCwgLW1bMl0gLyBkLCBtWzBdIC8gZCwgKG1bMl0gKiBtWzVdIC0gbVs0XSAqIG1bM10pIC8gZCwgKG1bNF0gKiBtWzFdIC0gbVs1XSAqIG1bMF0pIC8gZF07CiAgfQogIHN0YXRpYyBzaW5ndWxhclZhbHVlRGVjb21wb3NlMmRTY2FsZShtYXRyaXgsIG91dHB1dCkgewogICAgY29uc3QgbTAgPSBtYXRyaXhbMF07CiAgICBjb25zdCBtMSA9IG1hdHJpeFsxXTsKICAgIGNvbnN0IG0yID0gbWF0cml4WzJdOwogICAgY29uc3QgbTMgPSBtYXRyaXhbM107CiAgICBjb25zdCBhID0gbTAgKiogMiArIG0xICoqIDI7CiAgICBjb25zdCBiID0gbTAgKiBtMiArIG0xICogbTM7CiAgICBjb25zdCBjID0gbTIgKiogMiArIG0zICoqIDI7CiAgICBjb25zdCBmaXJzdCA9IChhICsgYykgLyAyOwogICAgY29uc3Qgc2Vjb25kID0gTWF0aC5zcXJ0KGZpcnN0ICoqIDIgLSAoYSAqIGMgLSBiICoqIDIpKTsKICAgIG91dHB1dFswXSA9IE1hdGguc3FydChmaXJzdCArIHNlY29uZCB8fCAxKTsKICAgIG91dHB1dFsxXSA9IE1hdGguc3FydChmaXJzdCAtIHNlY29uZCB8fCAxKTsKICB9CiAgc3RhdGljIG5vcm1hbGl6ZVJlY3QocmVjdCkgewogICAgY29uc3QgciA9IHJlY3Quc2xpY2UoMCk7CiAgICBpZiAocmVjdFswXSA+IHJlY3RbMl0pIHsKICAgICAgclswXSA9IHJlY3RbMl07CiAgICAgIHJbMl0gPSByZWN0WzBdOwogICAgfQogICAgaWYgKHJlY3RbMV0gPiByZWN0WzNdKSB7CiAgICAgIHJbMV0gPSByZWN0WzNdOwogICAgICByWzNdID0gcmVjdFsxXTsKICAgIH0KICAgIHJldHVybiByOwogIH0KICBzdGF0aWMgaW50ZXJzZWN0KHJlY3QxLCByZWN0MikgewogICAgY29uc3QgeExvdyA9IE1hdGgubWF4KE1hdGgubWluKHJlY3QxWzBdLCByZWN0MVsyXSksIE1hdGgubWluKHJlY3QyWzBdLCByZWN0MlsyXSkpOwogICAgY29uc3QgeEhpZ2ggPSBNYXRoLm1pbihNYXRoLm1heChyZWN0MVswXSwgcmVjdDFbMl0pLCBNYXRoLm1heChyZWN0MlswXSwgcmVjdDJbMl0pKTsKICAgIGlmICh4TG93ID4geEhpZ2gpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCB5TG93ID0gTWF0aC5tYXgoTWF0aC5taW4ocmVjdDFbMV0sIHJlY3QxWzNdKSwgTWF0aC5taW4ocmVjdDJbMV0sIHJlY3QyWzNdKSk7CiAgICBjb25zdCB5SGlnaCA9IE1hdGgubWluKE1hdGgubWF4KHJlY3QxWzFdLCByZWN0MVszXSksIE1hdGgubWF4KHJlY3QyWzFdLCByZWN0MlszXSkpOwogICAgaWYgKHlMb3cgPiB5SGlnaCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiBbeExvdywgeUxvdywgeEhpZ2gsIHlIaWdoXTsKICB9CiAgc3RhdGljIHBvaW50Qm91bmRpbmdCb3goeCwgeSwgbWluTWF4KSB7CiAgICBtaW5NYXhbMF0gPSBNYXRoLm1pbihtaW5NYXhbMF0sIHgpOwogICAgbWluTWF4WzFdID0gTWF0aC5taW4obWluTWF4WzFdLCB5KTsKICAgIG1pbk1heFsyXSA9IE1hdGgubWF4KG1pbk1heFsyXSwgeCk7CiAgICBtaW5NYXhbM10gPSBNYXRoLm1heChtaW5NYXhbM10sIHkpOwogIH0KICBzdGF0aWMgcmVjdEJvdW5kaW5nQm94KHgwLCB5MCwgeDEsIHkxLCBtaW5NYXgpIHsKICAgIG1pbk1heFswXSA9IE1hdGgubWluKG1pbk1heFswXSwgeDAsIHgxKTsKICAgIG1pbk1heFsxXSA9IE1hdGgubWluKG1pbk1heFsxXSwgeTAsIHkxKTsKICAgIG1pbk1heFsyXSA9IE1hdGgubWF4KG1pbk1heFsyXSwgeDAsIHgxKTsKICAgIG1pbk1heFszXSA9IE1hdGgubWF4KG1pbk1heFszXSwgeTAsIHkxKTsKICB9CiAgc3RhdGljICNnZXRFeHRyZW11bU9uQ3VydmUoeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCB0LCBtaW5NYXgpIHsKICAgIGlmICh0IDw9IDAgfHwgdCA+PSAxKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG10ID0gMSAtIHQ7CiAgICBjb25zdCB0dCA9IHQgKiB0OwogICAgY29uc3QgdHR0ID0gdHQgKiB0OwogICAgY29uc3QgeCA9IG10ICogKG10ICogKG10ICogeDAgKyAzICogdCAqIHgxKSArIDMgKiB0dCAqIHgyKSArIHR0dCAqIHgzOwogICAgY29uc3QgeSA9IG10ICogKG10ICogKG10ICogeTAgKyAzICogdCAqIHkxKSArIDMgKiB0dCAqIHkyKSArIHR0dCAqIHkzOwogICAgbWluTWF4WzBdID0gTWF0aC5taW4obWluTWF4WzBdLCB4KTsKICAgIG1pbk1heFsxXSA9IE1hdGgubWluKG1pbk1heFsxXSwgeSk7CiAgICBtaW5NYXhbMl0gPSBNYXRoLm1heChtaW5NYXhbMl0sIHgpOwogICAgbWluTWF4WzNdID0gTWF0aC5tYXgobWluTWF4WzNdLCB5KTsKICB9CiAgc3RhdGljICNnZXRFeHRyZW11bSh4MCwgeDEsIHgyLCB4MywgeTAsIHkxLCB5MiwgeTMsIGEsIGIsIGMsIG1pbk1heCkgewogICAgaWYgKE1hdGguYWJzKGEpIDwgMWUtMTIpIHsKICAgICAgaWYgKE1hdGguYWJzKGIpID49IDFlLTEyKSB7CiAgICAgICAgdGhpcy4jZ2V0RXh0cmVtdW1PbkN1cnZlKHgwLCB4MSwgeDIsIHgzLCB5MCwgeTEsIHkyLCB5MywgLWMgLyBiLCBtaW5NYXgpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGRlbHRhID0gYiAqKiAyIC0gNCAqIGMgKiBhOwogICAgaWYgKGRlbHRhIDwgMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBzcXJ0RGVsdGEgPSBNYXRoLnNxcnQoZGVsdGEpOwogICAgY29uc3QgYTIgPSAyICogYTsKICAgIHRoaXMuI2dldEV4dHJlbXVtT25DdXJ2ZSh4MCwgeDEsIHgyLCB4MywgeTAsIHkxLCB5MiwgeTMsICgtYiArIHNxcnREZWx0YSkgLyBhMiwgbWluTWF4KTsKICAgIHRoaXMuI2dldEV4dHJlbXVtT25DdXJ2ZSh4MCwgeDEsIHgyLCB4MywgeTAsIHkxLCB5MiwgeTMsICgtYiAtIHNxcnREZWx0YSkgLyBhMiwgbWluTWF4KTsKICB9CiAgc3RhdGljIGJlemllckJvdW5kaW5nQm94KHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5MywgbWluTWF4KSB7CiAgICBtaW5NYXhbMF0gPSBNYXRoLm1pbihtaW5NYXhbMF0sIHgwLCB4Myk7CiAgICBtaW5NYXhbMV0gPSBNYXRoLm1pbihtaW5NYXhbMV0sIHkwLCB5Myk7CiAgICBtaW5NYXhbMl0gPSBNYXRoLm1heChtaW5NYXhbMl0sIHgwLCB4Myk7CiAgICBtaW5NYXhbM10gPSBNYXRoLm1heChtaW5NYXhbM10sIHkwLCB5Myk7CiAgICB0aGlzLiNnZXRFeHRyZW11bSh4MCwgeDEsIHgyLCB4MywgeTAsIHkxLCB5MiwgeTMsIDMgKiAoLXgwICsgMyAqICh4MSAtIHgyKSArIHgzKSwgNiAqICh4MCAtIDIgKiB4MSArIHgyKSwgMyAqICh4MSAtIHgwKSwgbWluTWF4KTsKICAgIHRoaXMuI2dldEV4dHJlbXVtKHgwLCB4MSwgeDIsIHgzLCB5MCwgeTEsIHkyLCB5MywgMyAqICgteTAgKyAzICogKHkxIC0geTIpICsgeTMpLCA2ICogKHkwIC0gMiAqIHkxICsgeTIpLCAzICogKHkxIC0geTApLCBtaW5NYXgpOwogIH0KfQpjb25zdCBQREZTdHJpbmdUcmFuc2xhdGVUYWJsZSA9ICgvKiB1bnVzZWQgcHVyZSBleHByZXNzaW9uIG9yIHN1cGVyICovIG51bGwgJiYgKFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAweDJkOCwgMHgyYzcsIDB4MmM2LCAweDJkOSwgMHgyZGQsIDB4MmRiLCAweDJkYSwgMHgyZGMsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDB4MjAyMiwgMHgyMDIwLCAweDIwMjEsIDB4MjAyNiwgMHgyMDE0LCAweDIwMTMsIDB4MTkyLCAweDIwNDQsIDB4MjAzOSwgMHgyMDNhLCAweDIyMTIsIDB4MjAzMCwgMHgyMDFlLCAweDIwMWMsIDB4MjAxZCwgMHgyMDE4LCAweDIwMTksIDB4MjAxYSwgMHgyMTIyLCAweGZiMDEsIDB4ZmIwMiwgMHgxNDEsIDB4MTUyLCAweDE2MCwgMHgxNzgsIDB4MTdkLCAweDEzMSwgMHgxNDIsIDB4MTUzLCAweDE2MSwgMHgxN2UsIDAsIDB4MjBhY10pKTsKZnVuY3Rpb24gc3RyaW5nVG9QREZTdHJpbmcoc3RyLCBrZWVwRXNjYXBlU2VxdWVuY2UgPSBmYWxzZSkgewogIGlmIChzdHJbMF0gPj0gIlx4RUYiKSB7CiAgICBsZXQgZW5jb2Rpbmc7CiAgICBpZiAoc3RyWzBdID09PSAiXHhGRSIgJiYgc3RyWzFdID09PSAiXHhGRiIpIHsKICAgICAgZW5jb2RpbmcgPSAidXRmLTE2YmUiOwogICAgICBpZiAoc3RyLmxlbmd0aCAlIDIgPT09IDEpIHsKICAgICAgICBzdHIgPSBzdHIuc2xpY2UoMCwgLTEpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHN0clswXSA9PT0gIlx4RkYiICYmIHN0clsxXSA9PT0gIlx4RkUiKSB7CiAgICAgIGVuY29kaW5nID0gInV0Zi0xNmxlIjsKICAgICAgaWYgKHN0ci5sZW5ndGggJSAyID09PSAxKSB7CiAgICAgICAgc3RyID0gc3RyLnNsaWNlKDAsIC0xKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChzdHJbMF0gPT09ICJceEVGIiAmJiBzdHJbMV0gPT09ICJceEJCIiAmJiBzdHJbMl0gPT09ICJceEJGIikgewogICAgICBlbmNvZGluZyA9ICJ1dGYtOCI7CiAgICB9CiAgICBpZiAoZW5jb2RpbmcpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKGVuY29kaW5nLCB7CiAgICAgICAgICBmYXRhbDogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGJ1ZmZlciA9IHN0cmluZ1RvQnl0ZXMoc3RyKTsKICAgICAgICBjb25zdCBkZWNvZGVkID0gZGVjb2Rlci5kZWNvZGUoYnVmZmVyKTsKICAgICAgICBpZiAoa2VlcEVzY2FwZVNlcXVlbmNlIHx8ICFkZWNvZGVkLmluY2x1ZGVzKCJceDFiIikpIHsKICAgICAgICAgIHJldHVybiBkZWNvZGVkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVjb2RlZC5yZXBsYWNlQWxsKC9ceDFiW15ceDFiXSooPzpceDFifCQpL2csICIiKTsKICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICB3YXJuKGBzdHJpbmdUb1BERlN0cmluZzogIiR7ZXh9Ii5gKTsKICAgICAgfQogICAgfQogIH0KICBjb25zdCBzdHJCdWYgPSBbXTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhckNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgIGlmICgha2VlcEVzY2FwZVNlcXVlbmNlICYmIGNoYXJDb2RlID09PSAweDFiKSB7CiAgICAgIHdoaWxlICgrK2kgPCBpaSAmJiBzdHIuY2hhckNvZGVBdChpKSAhPT0gMHgxYikge30KICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBjb2RlID0gUERGU3RyaW5nVHJhbnNsYXRlVGFibGVbY2hhckNvZGVdOwogICAgc3RyQnVmLnB1c2goY29kZSA/IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSkgOiBzdHIuY2hhckF0KGkpKTsKICB9CiAgcmV0dXJuIHN0ckJ1Zi5qb2luKCIiKTsKfQpmdW5jdGlvbiBzdHJpbmdUb1VURjhTdHJpbmcoc3RyKSB7CiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoc3RyKSk7Cn0KZnVuY3Rpb24gdXRmOFN0cmluZ1RvU3RyaW5nKHN0cikgewogIHJldHVybiB1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoc3RyKSk7Cn0KZnVuY3Rpb24gaXNBcnJheUVxdWFsKGFycjEsIGFycjIpIHsKICBpZiAoYXJyMS5sZW5ndGggIT09IGFycjIubGVuZ3RoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGZvciAobGV0IGkgPSAwLCBpaSA9IGFycjEubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgaWYgKGFycjFbaV0gIT09IGFycjJbaV0pIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBnZXRNb2RpZmljYXRpb25EYXRlKGRhdGUgPSBuZXcgRGF0ZSgpKSB7CiAgY29uc3QgYnVmZmVyID0gW2RhdGUuZ2V0VVRDRnVsbFllYXIoKS50b1N0cmluZygpLCAoZGF0ZS5nZXRVVENNb250aCgpICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpLCBkYXRlLmdldFVUQ0RhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICIwIiksIGRhdGUuZ2V0VVRDSG91cnMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICIwIiksIGRhdGUuZ2V0VVRDTWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgIjAiKSwgZGF0ZS5nZXRVVENTZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpXTsKICByZXR1cm4gYnVmZmVyLmpvaW4oIiIpOwp9CmxldCBOb3JtYWxpemVSZWdleCA9IG51bGw7CmxldCBOb3JtYWxpemF0aW9uTWFwID0gbnVsbDsKZnVuY3Rpb24gbm9ybWFsaXplVW5pY29kZShzdHIpIHsKICBpZiAoIU5vcm1hbGl6ZVJlZ2V4KSB7CiAgICBOb3JtYWxpemVSZWdleCA9IC8oW1x1MDBhMFx1MDBiNVx1MDM3ZVx1MGViM1x1MjAwMC1cdTIwMGFcdTIwMmZcdTIxMjZcdWZiMDAtXHVmYjA0XHVmYjA2XHVmYjIwLVx1ZmIzNlx1ZmIzOC1cdWZiM2NcdWZiM2VcdWZiNDAtXHVmYjQxXHVmYjQzLVx1ZmI0NFx1ZmI0Ni1cdWZiYTFcdWZiYTQtXHVmYmE5XHVmYmFlLVx1ZmJiMVx1ZmJkMy1cdWZiZGNcdWZiZGUtXHVmYmU3XHVmYmVhLVx1ZmJmOFx1ZmJmYy1cdWZiZmRcdWZjMDAtXHVmYzVkXHVmYzY0LVx1ZmNmMVx1ZmNmNS1cdWZkM2RcdWZkODhcdWZkZjRcdWZkZmEtXHVmZGZiXHVmZTcxXHVmZTc3XHVmZTc5XHVmZTdiXHVmZTdkXSspfChcdWZiMDUrKS9ndTsKICAgIE5vcm1hbGl6YXRpb25NYXAgPSBuZXcgTWFwKFtbIu+shSIsICLFv3QiXV0pOwogIH0KICByZXR1cm4gc3RyLnJlcGxhY2VBbGwoTm9ybWFsaXplUmVnZXgsIChfLCBwMSwgcDIpID0+IHAxID8gcDEubm9ybWFsaXplKCJORktDIikgOiBOb3JtYWxpemF0aW9uTWFwLmdldChwMikpOwp9CmZ1bmN0aW9uIGdldFV1aWQoKSB7CiAgaWYgKHR5cGVvZiBjcnlwdG8ucmFuZG9tVVVJRCA9PT0gImZ1bmN0aW9uIikgewogICAgcmV0dXJuIGNyeXB0by5yYW5kb21VVUlEKCk7CiAgfQogIGNvbnN0IGJ1ZiA9IG5ldyBVaW50OEFycmF5KDMyKTsKICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGJ1Zik7CiAgcmV0dXJuIGJ5dGVzVG9TdHJpbmcoYnVmKTsKfQpjb25zdCBBbm5vdGF0aW9uUHJlZml4ID0gInBkZmpzX2ludGVybmFsX2lkXyI7CmZ1bmN0aW9uIF9pc1ZhbGlkRXhwbGljaXREZXN0KHZhbGlkUmVmLCB2YWxpZE5hbWUsIGRlc3QpIHsKICBpZiAoIUFycmF5LmlzQXJyYXkoZGVzdCkgfHwgZGVzdC5sZW5ndGggPCAyKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNvbnN0IFtwYWdlLCB6b29tLCAuLi5hcmdzXSA9IGRlc3Q7CiAgaWYgKCF2YWxpZFJlZihwYWdlKSAmJiAhTnVtYmVyLmlzSW50ZWdlcihwYWdlKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAoIXZhbGlkTmFtZSh6b29tKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjb25zdCBhcmdzTGVuID0gYXJncy5sZW5ndGg7CiAgbGV0IGFsbG93TnVsbCA9IHRydWU7CiAgc3dpdGNoICh6b29tLm5hbWUpIHsKICAgIGNhc2UgIlhZWiI6CiAgICAgIGlmIChhcmdzTGVuIDwgMiB8fCBhcmdzTGVuID4gMykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIkZpdCI6CiAgICBjYXNlICJGaXRCIjoKICAgICAgcmV0dXJuIGFyZ3NMZW4gPT09IDA7CiAgICBjYXNlICJGaXRIIjoKICAgIGNhc2UgIkZpdEJIIjoKICAgIGNhc2UgIkZpdFYiOgogICAgY2FzZSAiRml0QlYiOgogICAgICBpZiAoYXJnc0xlbiA+IDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJGaXRSIjoKICAgICAgaWYgKGFyZ3NMZW4gIT09IDQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgYWxsb3dOdWxsID0gZmFsc2U7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGZhbHNlOwogIH0KICBmb3IgKGNvbnN0IGFyZyBvZiBhcmdzKSB7CiAgICBpZiAodHlwZW9mIGFyZyA9PT0gIm51bWJlciIgfHwgYWxsb3dOdWxsICYmIGFyZyA9PT0gbnVsbCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuIHRydWU7Cn0KZnVuY3Rpb24gTWF0aENsYW1wKHYsIG1pbiwgbWF4KSB7CiAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KHYsIG1pbiksIG1heCk7Cn0KZnVuY3Rpb24gdG9IZXhVdGlsKGFycikgewogIGlmIChVaW50OEFycmF5LnByb3RvdHlwZS50b0hleCkgewogICAgcmV0dXJuIGFyci50b0hleCgpOwogIH0KICByZXR1cm4gQXJyYXkuZnJvbShhcnIsIG51bSA9PiBoZXhOdW1iZXJzW251bV0pLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHRvQmFzZTY0VXRpbChhcnIpIHsKICBpZiAoVWludDhBcnJheS5wcm90b3R5cGUudG9CYXNlNjQpIHsKICAgIHJldHVybiBhcnIudG9CYXNlNjQoKTsKICB9CiAgcmV0dXJuIGJ0b2EoYnl0ZXNUb1N0cmluZyhhcnIpKTsKfQpmdW5jdGlvbiBmcm9tQmFzZTY0VXRpbChzdHIpIHsKICBpZiAoVWludDhBcnJheS5mcm9tQmFzZTY0KSB7CiAgICByZXR1cm4gVWludDhBcnJheS5mcm9tQmFzZTY0KHN0cik7CiAgfQogIHJldHVybiBzdHJpbmdUb0J5dGVzKGF0b2Ioc3RyKSk7Cn0KaWYgKHR5cGVvZiBQcm9taXNlLnRyeSAhPT0gImZ1bmN0aW9uIikgewogIFByb21pc2UudHJ5ID0gZnVuY3Rpb24gKGZuLCAuLi5hcmdzKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgIHJlc29sdmUoZm4oLi4uYXJncykpOwogICAgfSk7CiAgfTsKfQppZiAodHlwZW9mIE1hdGguc3VtUHJlY2lzZSAhPT0gImZ1bmN0aW9uIikgewogIE1hdGguc3VtUHJlY2lzZSA9IGZ1bmN0aW9uIChudW1iZXJzKSB7CiAgICByZXR1cm4gbnVtYmVycy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKTsKICB9Owp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9kaXNwbGF5X3V0aWxzLmpzCgpjb25zdCBTVkdfTlMgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciOwpjbGFzcyBQaXhlbHNQZXJJbmNoIHsKICBzdGF0aWMgQ1NTID0gOTYuMDsKICBzdGF0aWMgUERGID0gNzIuMDsKICBzdGF0aWMgUERGX1RPX0NTU19VTklUUyA9IHRoaXMuQ1NTIC8gdGhpcy5QREY7Cn0KYXN5bmMgZnVuY3Rpb24gZmV0Y2hEYXRhKHVybCwgdHlwZSA9ICJ0ZXh0IikgewogIGlmIChpc1ZhbGlkRmV0Y2hVcmwodXJsLCBkb2N1bWVudC5iYXNlVVJJKSkgewogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwpOwogICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICB0aHJvdyBuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCk7CiAgICB9CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAiYXJyYXlidWZmZXIiOgogICAgICAgIHJldHVybiByZXNwb25zZS5hcnJheUJ1ZmZlcigpOwogICAgICBjYXNlICJibG9iIjoKICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmxvYigpOwogICAgICBjYXNlICJqc29uIjoKICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgfQogICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKTsKICB9CiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgIHJlcXVlc3Qub3BlbigiR0VUIiwgdXJsLCB0cnVlKTsKICAgIHJlcXVlc3QucmVzcG9uc2VUeXBlID0gdHlwZTsKICAgIHJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gKCkgPT4gewogICAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlICE9PSBYTUxIdHRwUmVxdWVzdC5ET05FKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA9PT0gMjAwIHx8IHJlcXVlc3Quc3RhdHVzID09PSAwKSB7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICBjYXNlICJhcnJheWJ1ZmZlciI6CiAgICAgICAgICBjYXNlICJibG9iIjoKICAgICAgICAgIGNhc2UgImpzb24iOgogICAgICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzcG9uc2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXNwb25zZVRleHQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICByZWplY3QobmV3IEVycm9yKHJlcXVlc3Quc3RhdHVzVGV4dCkpOwogICAgfTsKICAgIHJlcXVlc3Quc2VuZChudWxsKTsKICB9KTsKfQpjbGFzcyBQYWdlVmlld3BvcnQgewogIGNvbnN0cnVjdG9yKHsKICAgIHZpZXdCb3gsCiAgICB1c2VyVW5pdCwKICAgIHNjYWxlLAogICAgcm90YXRpb24sCiAgICBvZmZzZXRYID0gMCwKICAgIG9mZnNldFkgPSAwLAogICAgZG9udEZsaXAgPSBmYWxzZQogIH0pIHsKICAgIHRoaXMudmlld0JveCA9IHZpZXdCb3g7CiAgICB0aGlzLnVzZXJVbml0ID0gdXNlclVuaXQ7CiAgICB0aGlzLnNjYWxlID0gc2NhbGU7CiAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247CiAgICB0aGlzLm9mZnNldFggPSBvZmZzZXRYOwogICAgdGhpcy5vZmZzZXRZID0gb2Zmc2V0WTsKICAgIHNjYWxlICo9IHVzZXJVbml0OwogICAgY29uc3QgY2VudGVyWCA9ICh2aWV3Qm94WzJdICsgdmlld0JveFswXSkgLyAyOwogICAgY29uc3QgY2VudGVyWSA9ICh2aWV3Qm94WzNdICsgdmlld0JveFsxXSkgLyAyOwogICAgbGV0IHJvdGF0ZUEsIHJvdGF0ZUIsIHJvdGF0ZUMsIHJvdGF0ZUQ7CiAgICByb3RhdGlvbiAlPSAzNjA7CiAgICBpZiAocm90YXRpb24gPCAwKSB7CiAgICAgIHJvdGF0aW9uICs9IDM2MDsKICAgIH0KICAgIHN3aXRjaCAocm90YXRpb24pIHsKICAgICAgY2FzZSAxODA6CiAgICAgICAgcm90YXRlQSA9IC0xOwogICAgICAgIHJvdGF0ZUIgPSAwOwogICAgICAgIHJvdGF0ZUMgPSAwOwogICAgICAgIHJvdGF0ZUQgPSAxOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDkwOgogICAgICAgIHJvdGF0ZUEgPSAwOwogICAgICAgIHJvdGF0ZUIgPSAxOwogICAgICAgIHJvdGF0ZUMgPSAxOwogICAgICAgIHJvdGF0ZUQgPSAwOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI3MDoKICAgICAgICByb3RhdGVBID0gMDsKICAgICAgICByb3RhdGVCID0gLTE7CiAgICAgICAgcm90YXRlQyA9IC0xOwogICAgICAgIHJvdGF0ZUQgPSAwOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDA6CiAgICAgICAgcm90YXRlQSA9IDE7CiAgICAgICAgcm90YXRlQiA9IDA7CiAgICAgICAgcm90YXRlQyA9IDA7CiAgICAgICAgcm90YXRlRCA9IC0xOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcigiUGFnZVZpZXdwb3J0OiBJbnZhbGlkIHJvdGF0aW9uLCBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgOTAgZGVncmVlcy4iKTsKICAgIH0KICAgIGlmIChkb250RmxpcCkgewogICAgICByb3RhdGVDID0gLXJvdGF0ZUM7CiAgICAgIHJvdGF0ZUQgPSAtcm90YXRlRDsKICAgIH0KICAgIGxldCBvZmZzZXRDYW52YXNYLCBvZmZzZXRDYW52YXNZOwogICAgbGV0IHdpZHRoLCBoZWlnaHQ7CiAgICBpZiAocm90YXRlQSA9PT0gMCkgewogICAgICBvZmZzZXRDYW52YXNYID0gTWF0aC5hYnMoY2VudGVyWSAtIHZpZXdCb3hbMV0pICogc2NhbGUgKyBvZmZzZXRYOwogICAgICBvZmZzZXRDYW52YXNZID0gTWF0aC5hYnMoY2VudGVyWCAtIHZpZXdCb3hbMF0pICogc2NhbGUgKyBvZmZzZXRZOwogICAgICB3aWR0aCA9ICh2aWV3Qm94WzNdIC0gdmlld0JveFsxXSkgKiBzY2FsZTsKICAgICAgaGVpZ2h0ID0gKHZpZXdCb3hbMl0gLSB2aWV3Qm94WzBdKSAqIHNjYWxlOwogICAgfSBlbHNlIHsKICAgICAgb2Zmc2V0Q2FudmFzWCA9IE1hdGguYWJzKGNlbnRlclggLSB2aWV3Qm94WzBdKSAqIHNjYWxlICsgb2Zmc2V0WDsKICAgICAgb2Zmc2V0Q2FudmFzWSA9IE1hdGguYWJzKGNlbnRlclkgLSB2aWV3Qm94WzFdKSAqIHNjYWxlICsgb2Zmc2V0WTsKICAgICAgd2lkdGggPSAodmlld0JveFsyXSAtIHZpZXdCb3hbMF0pICogc2NhbGU7CiAgICAgIGhlaWdodCA9ICh2aWV3Qm94WzNdIC0gdmlld0JveFsxXSkgKiBzY2FsZTsKICAgIH0KICAgIHRoaXMudHJhbnNmb3JtID0gW3JvdGF0ZUEgKiBzY2FsZSwgcm90YXRlQiAqIHNjYWxlLCByb3RhdGVDICogc2NhbGUsIHJvdGF0ZUQgKiBzY2FsZSwgb2Zmc2V0Q2FudmFzWCAtIHJvdGF0ZUEgKiBzY2FsZSAqIGNlbnRlclggLSByb3RhdGVDICogc2NhbGUgKiBjZW50ZXJZLCBvZmZzZXRDYW52YXNZIC0gcm90YXRlQiAqIHNjYWxlICogY2VudGVyWCAtIHJvdGF0ZUQgKiBzY2FsZSAqIGNlbnRlclldOwogICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgfQogIGdldCByYXdEaW1zKCkgewogICAgY29uc3QgZGltcyA9IHRoaXMudmlld0JveDsKICAgIHJldHVybiBzaGFkb3codGhpcywgInJhd0RpbXMiLCB7CiAgICAgIHBhZ2VXaWR0aDogZGltc1syXSAtIGRpbXNbMF0sCiAgICAgIHBhZ2VIZWlnaHQ6IGRpbXNbM10gLSBkaW1zWzFdLAogICAgICBwYWdlWDogZGltc1swXSwKICAgICAgcGFnZVk6IGRpbXNbMV0KICAgIH0pOwogIH0KICBjbG9uZSh7CiAgICBzY2FsZSA9IHRoaXMuc2NhbGUsCiAgICByb3RhdGlvbiA9IHRoaXMucm90YXRpb24sCiAgICBvZmZzZXRYID0gdGhpcy5vZmZzZXRYLAogICAgb2Zmc2V0WSA9IHRoaXMub2Zmc2V0WSwKICAgIGRvbnRGbGlwID0gZmFsc2UKICB9ID0ge30pIHsKICAgIHJldHVybiBuZXcgUGFnZVZpZXdwb3J0KHsKICAgICAgdmlld0JveDogdGhpcy52aWV3Qm94LnNsaWNlKCksCiAgICAgIHVzZXJVbml0OiB0aGlzLnVzZXJVbml0LAogICAgICBzY2FsZSwKICAgICAgcm90YXRpb24sCiAgICAgIG9mZnNldFgsCiAgICAgIG9mZnNldFksCiAgICAgIGRvbnRGbGlwCiAgICB9KTsKICB9CiAgY29udmVydFRvVmlld3BvcnRQb2ludCh4LCB5KSB7CiAgICBjb25zdCBwID0gW3gsIHldOwogICAgVXRpbC5hcHBseVRyYW5zZm9ybShwLCB0aGlzLnRyYW5zZm9ybSk7CiAgICByZXR1cm4gcDsKICB9CiAgY29udmVydFRvVmlld3BvcnRSZWN0YW5nbGUocmVjdCkgewogICAgY29uc3QgdG9wTGVmdCA9IFtyZWN0WzBdLCByZWN0WzFdXTsKICAgIFV0aWwuYXBwbHlUcmFuc2Zvcm0odG9wTGVmdCwgdGhpcy50cmFuc2Zvcm0pOwogICAgY29uc3QgYm90dG9tUmlnaHQgPSBbcmVjdFsyXSwgcmVjdFszXV07CiAgICBVdGlsLmFwcGx5VHJhbnNmb3JtKGJvdHRvbVJpZ2h0LCB0aGlzLnRyYW5zZm9ybSk7CiAgICByZXR1cm4gW3RvcExlZnRbMF0sIHRvcExlZnRbMV0sIGJvdHRvbVJpZ2h0WzBdLCBib3R0b21SaWdodFsxXV07CiAgfQogIGNvbnZlcnRUb1BkZlBvaW50KHgsIHkpIHsKICAgIGNvbnN0IHAgPSBbeCwgeV07CiAgICBVdGlsLmFwcGx5SW52ZXJzZVRyYW5zZm9ybShwLCB0aGlzLnRyYW5zZm9ybSk7CiAgICByZXR1cm4gcDsKICB9Cn0KY2xhc3MgUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnLCBleHRyYURlbGF5ID0gMCkgewogICAgc3VwZXIobXNnLCAiUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uIik7CiAgICB0aGlzLmV4dHJhRGVsYXkgPSBleHRyYURlbGF5OwogIH0KfQpmdW5jdGlvbiBpc0RhdGFTY2hlbWUodXJsKSB7CiAgY29uc3QgaWkgPSB1cmwubGVuZ3RoOwogIGxldCBpID0gMDsKICB3aGlsZSAoaSA8IGlpICYmIHVybFtpXS50cmltKCkgPT09ICIiKSB7CiAgICBpKys7CiAgfQogIHJldHVybiB1cmwuc3Vic3RyaW5nKGksIGkgKyA1KS50b0xvd2VyQ2FzZSgpID09PSAiZGF0YToiOwp9CmZ1bmN0aW9uIGlzUGRmRmlsZShmaWxlbmFtZSkgewogIHJldHVybiB0eXBlb2YgZmlsZW5hbWUgPT09ICJzdHJpbmciICYmIC9cLnBkZiQvaS50ZXN0KGZpbGVuYW1lKTsKfQpmdW5jdGlvbiBnZXRGaWxlbmFtZUZyb21VcmwodXJsKSB7CiAgW3VybF0gPSB1cmwuc3BsaXQoL1sjP10vLCAxKTsKICByZXR1cm4gdXJsLnN1YnN0cmluZyh1cmwubGFzdEluZGV4T2YoIi8iKSArIDEpOwp9CmZ1bmN0aW9uIGdldFBkZkZpbGVuYW1lRnJvbVVybCh1cmwsIGRlZmF1bHRGaWxlbmFtZSA9ICJkb2N1bWVudC5wZGYiKSB7CiAgaWYgKHR5cGVvZiB1cmwgIT09ICJzdHJpbmciKSB7CiAgICByZXR1cm4gZGVmYXVsdEZpbGVuYW1lOwogIH0KICBpZiAoaXNEYXRhU2NoZW1lKHVybCkpIHsKICAgIHdhcm4oJ2dldFBkZkZpbGVuYW1lRnJvbVVybDogaWdub3JlICJkYXRhOiItVVJMIGZvciBwZXJmb3JtYW5jZSByZWFzb25zLicpOwogICAgcmV0dXJuIGRlZmF1bHRGaWxlbmFtZTsKICB9CiAgY29uc3QgcmVVUkkgPSAvXig/Oig/OlteOl0rOik/XC9cL1teL10rKT8oW14/I10qKShcP1teI10qKT8oIy4qKT8kLzsKICBjb25zdCByZUZpbGVuYW1lID0gL1teLz8jPV0rXC5wZGZcYig/IS4qXC5wZGZcYikvaTsKICBjb25zdCBzcGxpdFVSSSA9IHJlVVJJLmV4ZWModXJsKTsKICBsZXQgc3VnZ2VzdGVkRmlsZW5hbWUgPSByZUZpbGVuYW1lLmV4ZWMoc3BsaXRVUklbMV0pIHx8IHJlRmlsZW5hbWUuZXhlYyhzcGxpdFVSSVsyXSkgfHwgcmVGaWxlbmFtZS5leGVjKHNwbGl0VVJJWzNdKTsKICBpZiAoc3VnZ2VzdGVkRmlsZW5hbWUpIHsKICAgIHN1Z2dlc3RlZEZpbGVuYW1lID0gc3VnZ2VzdGVkRmlsZW5hbWVbMF07CiAgICBpZiAoc3VnZ2VzdGVkRmlsZW5hbWUuaW5jbHVkZXMoIiUiKSkgewogICAgICB0cnkgewogICAgICAgIHN1Z2dlc3RlZEZpbGVuYW1lID0gcmVGaWxlbmFtZS5leGVjKGRlY29kZVVSSUNvbXBvbmVudChzdWdnZXN0ZWRGaWxlbmFtZSkpWzBdOwogICAgICB9IGNhdGNoIHt9CiAgICB9CiAgfQogIHJldHVybiBzdWdnZXN0ZWRGaWxlbmFtZSB8fCBkZWZhdWx0RmlsZW5hbWU7Cn0KY2xhc3MgU3RhdFRpbWVyIHsKICBzdGFydGVkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB0aW1lcyA9IFtdOwogIHRpbWUobmFtZSkgewogICAgaWYgKG5hbWUgaW4gdGhpcy5zdGFydGVkKSB7CiAgICAgIHdhcm4oYFRpbWVyIGlzIGFscmVhZHkgcnVubmluZyBmb3IgJHtuYW1lfWApOwogICAgfQogICAgdGhpcy5zdGFydGVkW25hbWVdID0gRGF0ZS5ub3coKTsKICB9CiAgdGltZUVuZChuYW1lKSB7CiAgICBpZiAoIShuYW1lIGluIHRoaXMuc3RhcnRlZCkpIHsKICAgICAgd2FybihgVGltZXIgaGFzIG5vdCBiZWVuIHN0YXJ0ZWQgZm9yICR7bmFtZX1gKTsKICAgIH0KICAgIHRoaXMudGltZXMucHVzaCh7CiAgICAgIG5hbWUsCiAgICAgIHN0YXJ0OiB0aGlzLnN0YXJ0ZWRbbmFtZV0sCiAgICAgIGVuZDogRGF0ZS5ub3coKQogICAgfSk7CiAgICBkZWxldGUgdGhpcy5zdGFydGVkW25hbWVdOwogIH0KICB0b1N0cmluZygpIHsKICAgIGNvbnN0IG91dEJ1ZiA9IFtdOwogICAgbGV0IGxvbmdlc3QgPSAwOwogICAgZm9yIChjb25zdCB7CiAgICAgIG5hbWUKICAgIH0gb2YgdGhpcy50aW1lcykgewogICAgICBsb25nZXN0ID0gTWF0aC5tYXgobmFtZS5sZW5ndGgsIGxvbmdlc3QpOwogICAgfQogICAgZm9yIChjb25zdCB7CiAgICAgIG5hbWUsCiAgICAgIHN0YXJ0LAogICAgICBlbmQKICAgIH0gb2YgdGhpcy50aW1lcykgewogICAgICBvdXRCdWYucHVzaChgJHtuYW1lLnBhZEVuZChsb25nZXN0KX0gJHtlbmQgLSBzdGFydH1tc1xuYCk7CiAgICB9CiAgICByZXR1cm4gb3V0QnVmLmpvaW4oIiIpOwogIH0KfQpmdW5jdGlvbiBpc1ZhbGlkRmV0Y2hVcmwodXJsLCBiYXNlVXJsKSB7CiAgY29uc3QgcmVzID0gYmFzZVVybCA/IFVSTC5wYXJzZSh1cmwsIGJhc2VVcmwpIDogVVJMLnBhcnNlKHVybCk7CiAgcmV0dXJuIHJlcz8ucHJvdG9jb2wgPT09ICJodHRwOiIgfHwgcmVzPy5wcm90b2NvbCA9PT0gImh0dHBzOiI7Cn0KZnVuY3Rpb24gbm9Db250ZXh0TWVudShlKSB7CiAgZS5wcmV2ZW50RGVmYXVsdCgpOwp9CmZ1bmN0aW9uIHN0b3BFdmVudChlKSB7CiAgZS5wcmV2ZW50RGVmYXVsdCgpOwogIGUuc3RvcFByb3BhZ2F0aW9uKCk7Cn0KZnVuY3Rpb24gZGVwcmVjYXRlZChkZXRhaWxzKSB7CiAgY29uc29sZS5sb2coIkRlcHJlY2F0ZWQgQVBJIHVzYWdlOiAiICsgZGV0YWlscyk7Cn0KY2xhc3MgUERGRGF0ZVN0cmluZyB7CiAgc3RhdGljICNyZWdleDsKICBzdGF0aWMgdG9EYXRlT2JqZWN0KGlucHV0KSB7CiAgICBpZiAoIWlucHV0IHx8IHR5cGVvZiBpbnB1dCAhPT0gInN0cmluZyIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICB0aGlzLiNyZWdleCB8fD0gbmV3IFJlZ0V4cCgiXkQ6IiArICIoXFxkezR9KSIgKyAiKFxcZHsyfSk/IiArICIoXFxkezJ9KT8iICsgIihcXGR7Mn0pPyIgKyAiKFxcZHsyfSk/IiArICIoXFxkezJ9KT8iICsgIihbWnwrfC1dKT8iICsgIihcXGR7Mn0pPyIgKyAiJz8iICsgIihcXGR7Mn0pPyIgKyAiJz8iKTsKICAgIGNvbnN0IG1hdGNoZXMgPSB0aGlzLiNyZWdleC5leGVjKGlucHV0KTsKICAgIGlmICghbWF0Y2hlcykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHllYXIgPSBwYXJzZUludChtYXRjaGVzWzFdLCAxMCk7CiAgICBsZXQgbW9udGggPSBwYXJzZUludChtYXRjaGVzWzJdLCAxMCk7CiAgICBtb250aCA9IG1vbnRoID49IDEgJiYgbW9udGggPD0gMTIgPyBtb250aCAtIDEgOiAwOwogICAgbGV0IGRheSA9IHBhcnNlSW50KG1hdGNoZXNbM10sIDEwKTsKICAgIGRheSA9IGRheSA+PSAxICYmIGRheSA8PSAzMSA/IGRheSA6IDE7CiAgICBsZXQgaG91ciA9IHBhcnNlSW50KG1hdGNoZXNbNF0sIDEwKTsKICAgIGhvdXIgPSBob3VyID49IDAgJiYgaG91ciA8PSAyMyA/IGhvdXIgOiAwOwogICAgbGV0IG1pbnV0ZSA9IHBhcnNlSW50KG1hdGNoZXNbNV0sIDEwKTsKICAgIG1pbnV0ZSA9IG1pbnV0ZSA+PSAwICYmIG1pbnV0ZSA8PSA1OSA/IG1pbnV0ZSA6IDA7CiAgICBsZXQgc2Vjb25kID0gcGFyc2VJbnQobWF0Y2hlc1s2XSwgMTApOwogICAgc2Vjb25kID0gc2Vjb25kID49IDAgJiYgc2Vjb25kIDw9IDU5ID8gc2Vjb25kIDogMDsKICAgIGNvbnN0IHVuaXZlcnNhbFRpbWVSZWxhdGlvbiA9IG1hdGNoZXNbN10gfHwgIloiOwogICAgbGV0IG9mZnNldEhvdXIgPSBwYXJzZUludChtYXRjaGVzWzhdLCAxMCk7CiAgICBvZmZzZXRIb3VyID0gb2Zmc2V0SG91ciA+PSAwICYmIG9mZnNldEhvdXIgPD0gMjMgPyBvZmZzZXRIb3VyIDogMDsKICAgIGxldCBvZmZzZXRNaW51dGUgPSBwYXJzZUludChtYXRjaGVzWzldLCAxMCkgfHwgMDsKICAgIG9mZnNldE1pbnV0ZSA9IG9mZnNldE1pbnV0ZSA+PSAwICYmIG9mZnNldE1pbnV0ZSA8PSA1OSA/IG9mZnNldE1pbnV0ZSA6IDA7CiAgICBpZiAodW5pdmVyc2FsVGltZVJlbGF0aW9uID09PSAiLSIpIHsKICAgICAgaG91ciArPSBvZmZzZXRIb3VyOwogICAgICBtaW51dGUgKz0gb2Zmc2V0TWludXRlOwogICAgfSBlbHNlIGlmICh1bml2ZXJzYWxUaW1lUmVsYXRpb24gPT09ICIrIikgewogICAgICBob3VyIC09IG9mZnNldEhvdXI7CiAgICAgIG1pbnV0ZSAtPSBvZmZzZXRNaW51dGU7CiAgICB9CiAgICByZXR1cm4gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGgsIGRheSwgaG91ciwgbWludXRlLCBzZWNvbmQpKTsKICB9Cn0KZnVuY3Rpb24gZ2V0WGZhUGFnZVZpZXdwb3J0KHhmYVBhZ2UsIHsKICBzY2FsZSA9IDEsCiAgcm90YXRpb24gPSAwCn0pIHsKICBjb25zdCB7CiAgICB3aWR0aCwKICAgIGhlaWdodAogIH0gPSB4ZmFQYWdlLmF0dHJpYnV0ZXMuc3R5bGU7CiAgY29uc3Qgdmlld0JveCA9IFswLCAwLCBwYXJzZUludCh3aWR0aCksIHBhcnNlSW50KGhlaWdodCldOwogIHJldHVybiBuZXcgUGFnZVZpZXdwb3J0KHsKICAgIHZpZXdCb3gsCiAgICB1c2VyVW5pdDogMSwKICAgIHNjYWxlLAogICAgcm90YXRpb24KICB9KTsKfQpmdW5jdGlvbiBnZXRSR0IoY29sb3IpIHsKICBpZiAoY29sb3Iuc3RhcnRzV2l0aCgiIyIpKSB7CiAgICBjb25zdCBjb2xvclJHQiA9IHBhcnNlSW50KGNvbG9yLnNsaWNlKDEpLCAxNik7CiAgICByZXR1cm4gWyhjb2xvclJHQiAmIDB4ZmYwMDAwKSA+PiAxNiwgKGNvbG9yUkdCICYgMHgwMGZmMDApID4+IDgsIGNvbG9yUkdCICYgMHgwMDAwZmZdOwogIH0KICBpZiAoY29sb3Iuc3RhcnRzV2l0aCgicmdiKCIpKSB7CiAgICByZXR1cm4gY29sb3Iuc2xpY2UoNCwgLTEpLnNwbGl0KCIsIikubWFwKHggPT4gcGFyc2VJbnQoeCkpOwogIH0KICBpZiAoY29sb3Iuc3RhcnRzV2l0aCgicmdiYSgiKSkgewogICAgcmV0dXJuIGNvbG9yLnNsaWNlKDUsIC0xKS5zcGxpdCgiLCIpLm1hcCh4ID0+IHBhcnNlSW50KHgpKS5zbGljZSgwLCAzKTsKICB9CiAgd2FybihgTm90IGEgdmFsaWQgY29sb3IgZm9ybWF0OiAiJHtjb2xvcn0iYCk7CiAgcmV0dXJuIFswLCAwLCAwXTsKfQpmdW5jdGlvbiBnZXRDb2xvclZhbHVlcyhjb2xvcnMpIHsKICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogIHNwYW4uc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwogIHNwYW4uc3R5bGUuY29sb3JTY2hlbWUgPSAib25seSBsaWdodCI7CiAgZG9jdW1lbnQuYm9keS5hcHBlbmQoc3Bhbik7CiAgZm9yIChjb25zdCBuYW1lIG9mIGNvbG9ycy5rZXlzKCkpIHsKICAgIHNwYW4uc3R5bGUuY29sb3IgPSBuYW1lOwogICAgY29uc3QgY29tcHV0ZWRDb2xvciA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHNwYW4pLmNvbG9yOwogICAgY29sb3JzLnNldChuYW1lLCBnZXRSR0IoY29tcHV0ZWRDb2xvcikpOwogIH0KICBzcGFuLnJlbW92ZSgpOwp9CmZ1bmN0aW9uIGdldEN1cnJlbnRUcmFuc2Zvcm0oY3R4KSB7CiAgY29uc3QgewogICAgYSwKICAgIGIsCiAgICBjLAogICAgZCwKICAgIGUsCiAgICBmCiAgfSA9IGN0eC5nZXRUcmFuc2Zvcm0oKTsKICByZXR1cm4gW2EsIGIsIGMsIGQsIGUsIGZdOwp9CmZ1bmN0aW9uIGdldEN1cnJlbnRUcmFuc2Zvcm1JbnZlcnNlKGN0eCkgewogIGNvbnN0IHsKICAgIGEsCiAgICBiLAogICAgYywKICAgIGQsCiAgICBlLAogICAgZgogIH0gPSBjdHguZ2V0VHJhbnNmb3JtKCkuaW52ZXJ0U2VsZigpOwogIHJldHVybiBbYSwgYiwgYywgZCwgZSwgZl07Cn0KZnVuY3Rpb24gc2V0TGF5ZXJEaW1lbnNpb25zKGRpdiwgdmlld3BvcnQsIG11c3RGbGlwID0gZmFsc2UsIG11c3RSb3RhdGUgPSB0cnVlKSB7CiAgaWYgKHZpZXdwb3J0IGluc3RhbmNlb2YgUGFnZVZpZXdwb3J0KSB7CiAgICBjb25zdCB7CiAgICAgIHBhZ2VXaWR0aCwKICAgICAgcGFnZUhlaWdodAogICAgfSA9IHZpZXdwb3J0LnJhd0RpbXM7CiAgICBjb25zdCB7CiAgICAgIHN0eWxlCiAgICB9ID0gZGl2OwogICAgY29uc3QgdXNlUm91bmQgPSB1dGlsX0ZlYXR1cmVUZXN0LmlzQ1NTUm91bmRTdXBwb3J0ZWQ7CiAgICBjb25zdCB3ID0gYHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikgKiAke3BhZ2VXaWR0aH1weGAsCiAgICAgIGggPSBgdmFyKC0tdG90YWwtc2NhbGUtZmFjdG9yKSAqICR7cGFnZUhlaWdodH1weGA7CiAgICBjb25zdCB3aWR0aFN0ciA9IHVzZVJvdW5kID8gYHJvdW5kKGRvd24sICR7d30sIHZhcigtLXNjYWxlLXJvdW5kLXgpKWAgOiBgY2FsYygke3d9KWAsCiAgICAgIGhlaWdodFN0ciA9IHVzZVJvdW5kID8gYHJvdW5kKGRvd24sICR7aH0sIHZhcigtLXNjYWxlLXJvdW5kLXkpKWAgOiBgY2FsYygke2h9KWA7CiAgICBpZiAoIW11c3RGbGlwIHx8IHZpZXdwb3J0LnJvdGF0aW9uICUgMTgwID09PSAwKSB7CiAgICAgIHN0eWxlLndpZHRoID0gd2lkdGhTdHI7CiAgICAgIHN0eWxlLmhlaWdodCA9IGhlaWdodFN0cjsKICAgIH0gZWxzZSB7CiAgICAgIHN0eWxlLndpZHRoID0gaGVpZ2h0U3RyOwogICAgICBzdHlsZS5oZWlnaHQgPSB3aWR0aFN0cjsKICAgIH0KICB9CiAgaWYgKG11c3RSb3RhdGUpIHsKICAgIGRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtbWFpbi1yb3RhdGlvbiIsIHZpZXdwb3J0LnJvdGF0aW9uKTsKICB9Cn0KY2xhc3MgT3V0cHV0U2NhbGUgewogIGNvbnN0cnVjdG9yKCkgewogICAgY29uc3QgewogICAgICBwaXhlbFJhdGlvCiAgICB9ID0gT3V0cHV0U2NhbGU7CiAgICB0aGlzLnN4ID0gcGl4ZWxSYXRpbzsKICAgIHRoaXMuc3kgPSBwaXhlbFJhdGlvOwogIH0KICBnZXQgc2NhbGVkKCkgewogICAgcmV0dXJuIHRoaXMuc3ggIT09IDEgfHwgdGhpcy5zeSAhPT0gMTsKICB9CiAgZ2V0IHN5bW1ldHJpYygpIHsKICAgIHJldHVybiB0aGlzLnN4ID09PSB0aGlzLnN5OwogIH0KICBsaW1pdENhbnZhcyh3aWR0aCwgaGVpZ2h0LCBtYXhQaXhlbHMsIG1heERpbSwgY2FwQXJlYUZhY3RvciA9IC0xKSB7CiAgICBsZXQgbWF4QXJlYVNjYWxlID0gSW5maW5pdHksCiAgICAgIG1heFdpZHRoU2NhbGUgPSBJbmZpbml0eSwKICAgICAgbWF4SGVpZ2h0U2NhbGUgPSBJbmZpbml0eTsKICAgIG1heFBpeGVscyA9IE91dHB1dFNjYWxlLmNhcFBpeGVscyhtYXhQaXhlbHMsIGNhcEFyZWFGYWN0b3IpOwogICAgaWYgKG1heFBpeGVscyA+IDApIHsKICAgICAgbWF4QXJlYVNjYWxlID0gTWF0aC5zcXJ0KG1heFBpeGVscyAvICh3aWR0aCAqIGhlaWdodCkpOwogICAgfQogICAgaWYgKG1heERpbSAhPT0gLTEpIHsKICAgICAgbWF4V2lkdGhTY2FsZSA9IG1heERpbSAvIHdpZHRoOwogICAgICBtYXhIZWlnaHRTY2FsZSA9IG1heERpbSAvIGhlaWdodDsKICAgIH0KICAgIGNvbnN0IG1heFNjYWxlID0gTWF0aC5taW4obWF4QXJlYVNjYWxlLCBtYXhXaWR0aFNjYWxlLCBtYXhIZWlnaHRTY2FsZSk7CiAgICBpZiAodGhpcy5zeCA+IG1heFNjYWxlIHx8IHRoaXMuc3kgPiBtYXhTY2FsZSkgewogICAgICB0aGlzLnN4ID0gbWF4U2NhbGU7CiAgICAgIHRoaXMuc3kgPSBtYXhTY2FsZTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHN0YXRpYyBnZXQgcGl4ZWxSYXRpbygpIHsKICAgIHJldHVybiBnbG9iYWxUaGlzLmRldmljZVBpeGVsUmF0aW8gfHwgMTsKICB9CiAgc3RhdGljIGNhcFBpeGVscyhtYXhQaXhlbHMsIGNhcEFyZWFGYWN0b3IpIHsKICAgIGlmIChjYXBBcmVhRmFjdG9yID49IDApIHsKICAgICAgY29uc3Qgd2luUGl4ZWxzID0gTWF0aC5jZWlsKHdpbmRvdy5zY3JlZW4uYXZhaWxXaWR0aCAqIHdpbmRvdy5zY3JlZW4uYXZhaWxIZWlnaHQgKiB0aGlzLnBpeGVsUmF0aW8gKiogMiAqICgxICsgY2FwQXJlYUZhY3RvciAvIDEwMCkpOwogICAgICByZXR1cm4gbWF4UGl4ZWxzID4gMCA/IE1hdGgubWluKG1heFBpeGVscywgd2luUGl4ZWxzKSA6IHdpblBpeGVsczsKICAgIH0KICAgIHJldHVybiBtYXhQaXhlbHM7CiAgfQp9CmNvbnN0IFN1cHBvcnRlZEltYWdlTWltZVR5cGVzID0gWyJpbWFnZS9hcG5nIiwgImltYWdlL2F2aWYiLCAiaW1hZ2UvYm1wIiwgImltYWdlL2dpZiIsICJpbWFnZS9qcGVnIiwgImltYWdlL3BuZyIsICJpbWFnZS9zdmcreG1sIiwgImltYWdlL3dlYnAiLCAiaW1hZ2UveC1pY29uIl07Cgo7Ly8gLi9zcmMvZGlzcGxheS9lZGl0b3IvdG9vbGJhci5qcwoKY2xhc3MgRWRpdG9yVG9vbGJhciB7CiAgI3Rvb2xiYXIgPSBudWxsOwogICNjb2xvclBpY2tlciA9IG51bGw7CiAgI2VkaXRvcjsKICAjYnV0dG9ucyA9IG51bGw7CiAgI2FsdFRleHQgPSBudWxsOwogICNzaWduYXR1cmVEZXNjcmlwdGlvbkJ1dHRvbiA9IG51bGw7CiAgc3RhdGljICNsMTBuUmVtb3ZlID0gbnVsbDsKICBjb25zdHJ1Y3RvcihlZGl0b3IpIHsKICAgIHRoaXMuI2VkaXRvciA9IGVkaXRvcjsKICAgIEVkaXRvclRvb2xiYXIuI2wxMG5SZW1vdmUgfHw9IE9iamVjdC5mcmVlemUoewogICAgICBmcmVldGV4dDogInBkZmpzLWVkaXRvci1yZW1vdmUtZnJlZXRleHQtYnV0dG9uIiwKICAgICAgaGlnaGxpZ2h0OiAicGRmanMtZWRpdG9yLXJlbW92ZS1oaWdobGlnaHQtYnV0dG9uIiwKICAgICAgaW5rOiAicGRmanMtZWRpdG9yLXJlbW92ZS1pbmstYnV0dG9uIiwKICAgICAgc3RhbXA6ICJwZGZqcy1lZGl0b3ItcmVtb3ZlLXN0YW1wLWJ1dHRvbiIsCiAgICAgIHNpZ25hdHVyZTogInBkZmpzLWVkaXRvci1yZW1vdmUtc2lnbmF0dXJlLWJ1dHRvbiIKICAgIH0pOwogIH0KICByZW5kZXIoKSB7CiAgICBjb25zdCBlZGl0VG9vbGJhciA9IHRoaXMuI3Rvb2xiYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGVkaXRUb29sYmFyLmNsYXNzTGlzdC5hZGQoImVkaXRUb29sYmFyIiwgImhpZGRlbiIpOwogICAgZWRpdFRvb2xiYXIuc2V0QXR0cmlidXRlKCJyb2xlIiwgInRvb2xiYXIiKTsKICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuI2VkaXRvci5fdWlNYW5hZ2VyLl9zaWduYWw7CiAgICBlZGl0VG9vbGJhci5hZGRFdmVudExpc3RlbmVyKCJjb250ZXh0bWVudSIsIG5vQ29udGV4dE1lbnUsIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGVkaXRUb29sYmFyLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgRWRpdG9yVG9vbGJhci4jcG9pbnRlckRvd24sIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGNvbnN0IGJ1dHRvbnMgPSB0aGlzLiNidXR0b25zID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBidXR0b25zLmNsYXNzTmFtZSA9ICJidXR0b25zIjsKICAgIGVkaXRUb29sYmFyLmFwcGVuZChidXR0b25zKTsKICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy4jZWRpdG9yLnRvb2xiYXJQb3NpdGlvbjsKICAgIGlmIChwb3NpdGlvbikgewogICAgICBjb25zdCB7CiAgICAgICAgc3R5bGUKICAgICAgfSA9IGVkaXRUb29sYmFyOwogICAgICBjb25zdCB4ID0gdGhpcy4jZWRpdG9yLl91aU1hbmFnZXIuZGlyZWN0aW9uID09PSAibHRyIiA/IDEgLSBwb3NpdGlvblswXSA6IHBvc2l0aW9uWzBdOwogICAgICBzdHlsZS5pbnNldElubGluZUVuZCA9IGAkezEwMCAqIHh9JWA7CiAgICAgIHN0eWxlLnRvcCA9IGBjYWxjKCR7MTAwICogcG9zaXRpb25bMV19JSArIHZhcigtLWVkaXRvci10b29sYmFyLXZlcnQtb2Zmc2V0KSlgOwogICAgfQogICAgdGhpcy4jYWRkRGVsZXRlQnV0dG9uKCk7CiAgICByZXR1cm4gZWRpdFRvb2xiYXI7CiAgfQogIGdldCBkaXYoKSB7CiAgICByZXR1cm4gdGhpcy4jdG9vbGJhcjsKICB9CiAgc3RhdGljICNwb2ludGVyRG93bihlKSB7CiAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogIH0KICAjZm9jdXNJbihlKSB7CiAgICB0aGlzLiNlZGl0b3IuX2ZvY3VzRXZlbnRzQWxsb3dlZCA9IGZhbHNlOwogICAgc3RvcEV2ZW50KGUpOwogIH0KICAjZm9jdXNPdXQoZSkgewogICAgdGhpcy4jZWRpdG9yLl9mb2N1c0V2ZW50c0FsbG93ZWQgPSB0cnVlOwogICAgc3RvcEV2ZW50KGUpOwogIH0KICAjYWRkTGlzdGVuZXJzVG9FbGVtZW50KGVsZW1lbnQpIHsKICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuI2VkaXRvci5fdWlNYW5hZ2VyLl9zaWduYWw7CiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoImZvY3VzaW4iLCB0aGlzLiNmb2N1c0luLmJpbmQodGhpcyksIHsKICAgICAgY2FwdHVyZTogdHJ1ZSwKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiZm9jdXNvdXQiLCB0aGlzLiNmb2N1c091dC5iaW5kKHRoaXMpLCB7CiAgICAgIGNhcHR1cmU6IHRydWUsCiAgICAgIHNpZ25hbAogICAgfSk7CiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51Iiwgbm9Db250ZXh0TWVudSwgewogICAgICBzaWduYWwKICAgIH0pOwogIH0KICBoaWRlKCkgewogICAgdGhpcy4jdG9vbGJhci5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgIHRoaXMuI2NvbG9yUGlja2VyPy5oaWRlRHJvcGRvd24oKTsKICB9CiAgc2hvdygpIHsKICAgIHRoaXMuI3Rvb2xiYXIuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgICB0aGlzLiNhbHRUZXh0Py5zaG93bigpOwogIH0KICAjYWRkRGVsZXRlQnV0dG9uKCkgewogICAgY29uc3QgewogICAgICBlZGl0b3JUeXBlLAogICAgICBfdWlNYW5hZ2VyCiAgICB9ID0gdGhpcy4jZWRpdG9yOwogICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICBidXR0b24uY2xhc3NOYW1lID0gImRlbGV0ZSI7CiAgICBidXR0b24udGFiSW5kZXggPSAwOwogICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgRWRpdG9yVG9vbGJhci4jbDEwblJlbW92ZVtlZGl0b3JUeXBlXSk7CiAgICB0aGlzLiNhZGRMaXN0ZW5lcnNUb0VsZW1lbnQoYnV0dG9uKTsKICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGUgPT4gewogICAgICBfdWlNYW5hZ2VyLmRlbGV0ZSgpOwogICAgfSwgewogICAgICBzaWduYWw6IF91aU1hbmFnZXIuX3NpZ25hbAogICAgfSk7CiAgICB0aGlzLiNidXR0b25zLmFwcGVuZChidXR0b24pOwogIH0KICBnZXQgI2RpdmlkZXIoKSB7CiAgICBjb25zdCBkaXZpZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBkaXZpZGVyLmNsYXNzTmFtZSA9ICJkaXZpZGVyIjsKICAgIHJldHVybiBkaXZpZGVyOwogIH0KICBhc3luYyBhZGRBbHRUZXh0KGFsdFRleHQpIHsKICAgIGNvbnN0IGJ1dHRvbiA9IGF3YWl0IGFsdFRleHQucmVuZGVyKCk7CiAgICB0aGlzLiNhZGRMaXN0ZW5lcnNUb0VsZW1lbnQoYnV0dG9uKTsKICAgIHRoaXMuI2J1dHRvbnMucHJlcGVuZChidXR0b24sIHRoaXMuI2RpdmlkZXIpOwogICAgdGhpcy4jYWx0VGV4dCA9IGFsdFRleHQ7CiAgfQogIGFkZENvbG9yUGlja2VyKGNvbG9yUGlja2VyKSB7CiAgICB0aGlzLiNjb2xvclBpY2tlciA9IGNvbG9yUGlja2VyOwogICAgY29uc3QgYnV0dG9uID0gY29sb3JQaWNrZXIucmVuZGVyQnV0dG9uKCk7CiAgICB0aGlzLiNhZGRMaXN0ZW5lcnNUb0VsZW1lbnQoYnV0dG9uKTsKICAgIHRoaXMuI2J1dHRvbnMucHJlcGVuZChidXR0b24sIHRoaXMuI2RpdmlkZXIpOwogIH0KICBhc3luYyBhZGRFZGl0U2lnbmF0dXJlQnV0dG9uKHNpZ25hdHVyZU1hbmFnZXIpIHsKICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMuI3NpZ25hdHVyZURlc2NyaXB0aW9uQnV0dG9uID0gYXdhaXQgc2lnbmF0dXJlTWFuYWdlci5yZW5kZXJFZGl0QnV0dG9uKHRoaXMuI2VkaXRvcik7CiAgICB0aGlzLiNhZGRMaXN0ZW5lcnNUb0VsZW1lbnQoYnV0dG9uKTsKICAgIHRoaXMuI2J1dHRvbnMucHJlcGVuZChidXR0b24sIHRoaXMuI2RpdmlkZXIpOwogIH0KICB1cGRhdGVFZGl0U2lnbmF0dXJlQnV0dG9uKGRlc2NyaXB0aW9uKSB7CiAgICBpZiAodGhpcy4jc2lnbmF0dXJlRGVzY3JpcHRpb25CdXR0b24pIHsKICAgICAgdGhpcy4jc2lnbmF0dXJlRGVzY3JpcHRpb25CdXR0b24udGl0bGUgPSBkZXNjcmlwdGlvbjsKICAgIH0KICB9CiAgcmVtb3ZlKCkgewogICAgdGhpcy4jdG9vbGJhci5yZW1vdmUoKTsKICAgIHRoaXMuI2NvbG9yUGlja2VyPy5kZXN0cm95KCk7CiAgICB0aGlzLiNjb2xvclBpY2tlciA9IG51bGw7CiAgfQp9CmNsYXNzIEhpZ2hsaWdodFRvb2xiYXIgewogICNidXR0b25zID0gbnVsbDsKICAjdG9vbGJhciA9IG51bGw7CiAgI3VpTWFuYWdlcjsKICBjb25zdHJ1Y3Rvcih1aU1hbmFnZXIpIHsKICAgIHRoaXMuI3VpTWFuYWdlciA9IHVpTWFuYWdlcjsKICB9CiAgI3JlbmRlcigpIHsKICAgIGNvbnN0IGVkaXRUb29sYmFyID0gdGhpcy4jdG9vbGJhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgZWRpdFRvb2xiYXIuY2xhc3NOYW1lID0gImVkaXRUb29sYmFyIjsKICAgIGVkaXRUb29sYmFyLnNldEF0dHJpYnV0ZSgicm9sZSIsICJ0b29sYmFyIik7CiAgICBlZGl0VG9vbGJhci5hZGRFdmVudExpc3RlbmVyKCJjb250ZXh0bWVudSIsIG5vQ29udGV4dE1lbnUsIHsKICAgICAgc2lnbmFsOiB0aGlzLiN1aU1hbmFnZXIuX3NpZ25hbAogICAgfSk7CiAgICBjb25zdCBidXR0b25zID0gdGhpcy4jYnV0dG9ucyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgYnV0dG9ucy5jbGFzc05hbWUgPSAiYnV0dG9ucyI7CiAgICBlZGl0VG9vbGJhci5hcHBlbmQoYnV0dG9ucyk7CiAgICB0aGlzLiNhZGRIaWdobGlnaHRCdXR0b24oKTsKICAgIHJldHVybiBlZGl0VG9vbGJhcjsKICB9CiAgI2dldExhc3RQb2ludChib3hlcywgaXNMVFIpIHsKICAgIGxldCBsYXN0WSA9IDA7CiAgICBsZXQgbGFzdFggPSAwOwogICAgZm9yIChjb25zdCBib3ggb2YgYm94ZXMpIHsKICAgICAgY29uc3QgeSA9IGJveC55ICsgYm94LmhlaWdodDsKICAgICAgaWYgKHkgPCBsYXN0WSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHggPSBib3gueCArIChpc0xUUiA/IGJveC53aWR0aCA6IDApOwogICAgICBpZiAoeSA+IGxhc3RZKSB7CiAgICAgICAgbGFzdFggPSB4OwogICAgICAgIGxhc3RZID0geTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoaXNMVFIpIHsKICAgICAgICBpZiAoeCA+IGxhc3RYKSB7CiAgICAgICAgICBsYXN0WCA9IHg7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHggPCBsYXN0WCkgewogICAgICAgIGxhc3RYID0geDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIFtpc0xUUiA/IDEgLSBsYXN0WCA6IGxhc3RYLCBsYXN0WV07CiAgfQogIHNob3cocGFyZW50LCBib3hlcywgaXNMVFIpIHsKICAgIGNvbnN0IFt4LCB5XSA9IHRoaXMuI2dldExhc3RQb2ludChib3hlcywgaXNMVFIpOwogICAgY29uc3QgewogICAgICBzdHlsZQogICAgfSA9IHRoaXMuI3Rvb2xiYXIgfHw9IHRoaXMuI3JlbmRlcigpOwogICAgcGFyZW50LmFwcGVuZCh0aGlzLiN0b29sYmFyKTsKICAgIHN0eWxlLmluc2V0SW5saW5lRW5kID0gYCR7MTAwICogeH0lYDsKICAgIHN0eWxlLnRvcCA9IGBjYWxjKCR7MTAwICogeX0lICsgdmFyKC0tZWRpdG9yLXRvb2xiYXItdmVydC1vZmZzZXQpKWA7CiAgfQogIGhpZGUoKSB7CiAgICB0aGlzLiN0b29sYmFyLnJlbW92ZSgpOwogIH0KICAjYWRkSGlnaGxpZ2h0QnV0dG9uKCkgewogICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICBidXR0b24uY2xhc3NOYW1lID0gImhpZ2hsaWdodEJ1dHRvbiI7CiAgICBidXR0b24udGFiSW5kZXggPSAwOwogICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgYHBkZmpzLWhpZ2hsaWdodC1mbG9hdGluZy1idXR0b24xYCk7CiAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgYnV0dG9uLmFwcGVuZChzcGFuKTsKICAgIHNwYW4uY2xhc3NOYW1lID0gInZpc3VhbGx5SGlkZGVuIjsKICAgIHNwYW4uc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCAicGRmanMtaGlnaGxpZ2h0LWZsb2F0aW5nLWJ1dHRvbi1sYWJlbCIpOwogICAgY29uc3Qgc2lnbmFsID0gdGhpcy4jdWlNYW5hZ2VyLl9zaWduYWw7CiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY29udGV4dG1lbnUiLCBub0NvbnRleHRNZW51LCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIHRoaXMuI3VpTWFuYWdlci5oaWdobGlnaHRTZWxlY3Rpb24oImZsb2F0aW5nX2J1dHRvbiIpOwogICAgfSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgdGhpcy4jYnV0dG9ucy5hcHBlbmQoYnV0dG9uKTsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L2VkaXRvci90b29scy5qcwoKCgpmdW5jdGlvbiBiaW5kRXZlbnRzKG9iaiwgZWxlbWVudCwgbmFtZXMpIHsKICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHsKICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCBvYmpbbmFtZV0uYmluZChvYmopKTsKICB9Cn0KY2xhc3MgSWRNYW5hZ2VyIHsKICAjaWQgPSAwOwogIGdldCBpZCgpIHsKICAgIHJldHVybiBgJHtBbm5vdGF0aW9uRWRpdG9yUHJlZml4fSR7dGhpcy4jaWQrK31gOwogIH0KfQpjbGFzcyBJbWFnZU1hbmFnZXIgewogICNiYXNlSWQgPSBnZXRVdWlkKCk7CiAgI2lkID0gMDsKICAjY2FjaGUgPSBudWxsOwogIHN0YXRpYyBnZXQgX2lzU1ZHRml0dGluZ0NhbnZhcygpIHsKICAgIGNvbnN0IHN2ZyA9IGBkYXRhOmltYWdlL3N2Zyt4bWw7Y2hhcnNldD1VVEYtOCw8c3ZnIHZpZXdCb3g9IjAgMCAxIDEiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEiIGhlaWdodD0iMSIgc3R5bGU9ImZpbGw6cmVkOyIvPjwvc3ZnPmA7CiAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKDEsIDMpOwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICB3aWxsUmVhZEZyZXF1ZW50bHk6IHRydWUKICAgIH0pOwogICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTsKICAgIGltYWdlLnNyYyA9IHN2ZzsKICAgIGNvbnN0IHByb21pc2UgPSBpbWFnZS5kZWNvZGUoKS50aGVuKCgpID0+IHsKICAgICAgY3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMCwgMSwgMSwgMCwgMCwgMSwgMyk7CiAgICAgIHJldHVybiBuZXcgVWludDMyQXJyYXkoY3R4LmdldEltYWdlRGF0YSgwLCAwLCAxLCAxKS5kYXRhLmJ1ZmZlcilbMF0gPT09IDA7CiAgICB9KTsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9pc1NWR0ZpdHRpbmdDYW52YXMiLCBwcm9taXNlKTsKICB9CiAgYXN5bmMgI2dldChrZXksIHJhd0RhdGEpIHsKICAgIHRoaXMuI2NhY2hlIHx8PSBuZXcgTWFwKCk7CiAgICBsZXQgZGF0YSA9IHRoaXMuI2NhY2hlLmdldChrZXkpOwogICAgaWYgKGRhdGEgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAoZGF0YT8uYml0bWFwKSB7CiAgICAgIGRhdGEucmVmQ291bnRlciArPSAxOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICAgIHRyeSB7CiAgICAgIGRhdGEgfHw9IHsKICAgICAgICBiaXRtYXA6IG51bGwsCiAgICAgICAgaWQ6IGBpbWFnZV8ke3RoaXMuI2Jhc2VJZH1fJHt0aGlzLiNpZCsrfWAsCiAgICAgICAgcmVmQ291bnRlcjogMCwKICAgICAgICBpc1N2ZzogZmFsc2UKICAgICAgfTsKICAgICAgbGV0IGltYWdlOwogICAgICBpZiAodHlwZW9mIHJhd0RhdGEgPT09ICJzdHJpbmciKSB7CiAgICAgICAgZGF0YS51cmwgPSByYXdEYXRhOwogICAgICAgIGltYWdlID0gYXdhaXQgZmV0Y2hEYXRhKHJhd0RhdGEsICJibG9iIik7CiAgICAgIH0gZWxzZSBpZiAocmF3RGF0YSBpbnN0YW5jZW9mIEZpbGUpIHsKICAgICAgICBpbWFnZSA9IGRhdGEuZmlsZSA9IHJhd0RhdGE7CiAgICAgIH0gZWxzZSBpZiAocmF3RGF0YSBpbnN0YW5jZW9mIEJsb2IpIHsKICAgICAgICBpbWFnZSA9IHJhd0RhdGE7CiAgICAgIH0KICAgICAgaWYgKGltYWdlLnR5cGUgPT09ICJpbWFnZS9zdmcreG1sIikgewogICAgICAgIGNvbnN0IG11c3RSZW1vdmVBc3BlY3RSYXRpb1Byb21pc2UgPSBJbWFnZU1hbmFnZXIuX2lzU1ZHRml0dGluZ0NhbnZhczsKICAgICAgICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICBjb25zdCBpbWFnZUVsZW1lbnQgPSBuZXcgSW1hZ2UoKTsKICAgICAgICBjb25zdCBpbWFnZVByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICBpbWFnZUVsZW1lbnQub25sb2FkID0gKCkgPT4gewogICAgICAgICAgICBkYXRhLmJpdG1hcCA9IGltYWdlRWxlbWVudDsKICAgICAgICAgICAgZGF0YS5pc1N2ZyA9IHRydWU7CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH07CiAgICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9IGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdXJsID0gZGF0YS5zdmdVcmwgPSBmaWxlUmVhZGVyLnJlc3VsdDsKICAgICAgICAgICAgaW1hZ2VFbGVtZW50LnNyYyA9IChhd2FpdCBtdXN0UmVtb3ZlQXNwZWN0UmF0aW9Qcm9taXNlKSA/IGAke3VybH0jc3ZnVmlldyhwcmVzZXJ2ZUFzcGVjdFJhdGlvKG5vbmUpKWAgOiB1cmw7CiAgICAgICAgICB9OwogICAgICAgICAgaW1hZ2VFbGVtZW50Lm9uZXJyb3IgPSBmaWxlUmVhZGVyLm9uZXJyb3IgPSByZWplY3Q7CiAgICAgICAgfSk7CiAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNEYXRhVVJMKGltYWdlKTsKICAgICAgICBhd2FpdCBpbWFnZVByb21pc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YS5iaXRtYXAgPSBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChpbWFnZSk7CiAgICAgIH0KICAgICAgZGF0YS5yZWZDb3VudGVyID0gMTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgd2FybihlKTsKICAgICAgZGF0YSA9IG51bGw7CiAgICB9CiAgICB0aGlzLiNjYWNoZS5zZXQoa2V5LCBkYXRhKTsKICAgIGlmIChkYXRhKSB7CiAgICAgIHRoaXMuI2NhY2hlLnNldChkYXRhLmlkLCBkYXRhKTsKICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBhc3luYyBnZXRGcm9tRmlsZShmaWxlKSB7CiAgICBjb25zdCB7CiAgICAgIGxhc3RNb2RpZmllZCwKICAgICAgbmFtZSwKICAgICAgc2l6ZSwKICAgICAgdHlwZQogICAgfSA9IGZpbGU7CiAgICByZXR1cm4gdGhpcy4jZ2V0KGAke2xhc3RNb2RpZmllZH1fJHtuYW1lfV8ke3NpemV9XyR7dHlwZX1gLCBmaWxlKTsKICB9CiAgYXN5bmMgZ2V0RnJvbVVybCh1cmwpIHsKICAgIHJldHVybiB0aGlzLiNnZXQodXJsLCB1cmwpOwogIH0KICBhc3luYyBnZXRGcm9tQmxvYihpZCwgYmxvYlByb21pc2UpIHsKICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBibG9iUHJvbWlzZTsKICAgIHJldHVybiB0aGlzLiNnZXQoaWQsIGJsb2IpOwogIH0KICBhc3luYyBnZXRGcm9tSWQoaWQpIHsKICAgIHRoaXMuI2NhY2hlIHx8PSBuZXcgTWFwKCk7CiAgICBjb25zdCBkYXRhID0gdGhpcy4jY2FjaGUuZ2V0KGlkKTsKICAgIGlmICghZGF0YSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChkYXRhLmJpdG1hcCkgewogICAgICBkYXRhLnJlZkNvdW50ZXIgKz0gMTsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBpZiAoZGF0YS5maWxlKSB7CiAgICAgIHJldHVybiB0aGlzLmdldEZyb21GaWxlKGRhdGEuZmlsZSk7CiAgICB9CiAgICBpZiAoZGF0YS5ibG9iUHJvbWlzZSkgewogICAgICBjb25zdCB7CiAgICAgICAgYmxvYlByb21pc2UKICAgICAgfSA9IGRhdGE7CiAgICAgIGRlbGV0ZSBkYXRhLmJsb2JQcm9taXNlOwogICAgICByZXR1cm4gdGhpcy5nZXRGcm9tQmxvYihkYXRhLmlkLCBibG9iUHJvbWlzZSk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5nZXRGcm9tVXJsKGRhdGEudXJsKTsKICB9CiAgZ2V0RnJvbUNhbnZhcyhpZCwgY2FudmFzKSB7CiAgICB0aGlzLiNjYWNoZSB8fD0gbmV3IE1hcCgpOwogICAgbGV0IGRhdGEgPSB0aGlzLiNjYWNoZS5nZXQoaWQpOwogICAgaWYgKGRhdGE/LmJpdG1hcCkgewogICAgICBkYXRhLnJlZkNvdW50ZXIgKz0gMTsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICBjb25zdCBjdHggPSBvZmZzY3JlZW4uZ2V0Q29udGV4dCgiMmQiKTsKICAgIGN0eC5kcmF3SW1hZ2UoY2FudmFzLCAwLCAwKTsKICAgIGRhdGEgPSB7CiAgICAgIGJpdG1hcDogb2Zmc2NyZWVuLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpLAogICAgICBpZDogYGltYWdlXyR7dGhpcy4jYmFzZUlkfV8ke3RoaXMuI2lkKyt9YCwKICAgICAgcmVmQ291bnRlcjogMSwKICAgICAgaXNTdmc6IGZhbHNlCiAgICB9OwogICAgdGhpcy4jY2FjaGUuc2V0KGlkLCBkYXRhKTsKICAgIHRoaXMuI2NhY2hlLnNldChkYXRhLmlkLCBkYXRhKTsKICAgIHJldHVybiBkYXRhOwogIH0KICBnZXRTdmdVcmwoaWQpIHsKICAgIGNvbnN0IGRhdGEgPSB0aGlzLiNjYWNoZS5nZXQoaWQpOwogICAgaWYgKCFkYXRhPy5pc1N2ZykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiBkYXRhLnN2Z1VybDsKICB9CiAgZGVsZXRlSWQoaWQpIHsKICAgIHRoaXMuI2NhY2hlIHx8PSBuZXcgTWFwKCk7CiAgICBjb25zdCBkYXRhID0gdGhpcy4jY2FjaGUuZ2V0KGlkKTsKICAgIGlmICghZGF0YSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBkYXRhLnJlZkNvdW50ZXIgLT0gMTsKICAgIGlmIChkYXRhLnJlZkNvdW50ZXIgIT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgewogICAgICBiaXRtYXAKICAgIH0gPSBkYXRhOwogICAgaWYgKCFkYXRhLnVybCAmJiAhZGF0YS5maWxlKSB7CiAgICAgIGNvbnN0IGNhbnZhcyA9IG5ldyBPZmZzY3JlZW5DYW52YXMoYml0bWFwLndpZHRoLCBiaXRtYXAuaGVpZ2h0KTsKICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoImJpdG1hcHJlbmRlcmVyIik7CiAgICAgIGN0eC50cmFuc2ZlckZyb21JbWFnZUJpdG1hcChiaXRtYXApOwogICAgICBkYXRhLmJsb2JQcm9taXNlID0gY2FudmFzLmNvbnZlcnRUb0Jsb2IoKTsKICAgIH0KICAgIGJpdG1hcC5jbG9zZT8uKCk7CiAgICBkYXRhLmJpdG1hcCA9IG51bGw7CiAgfQogIGlzVmFsaWRJZChpZCkgewogICAgcmV0dXJuIGlkLnN0YXJ0c1dpdGgoYGltYWdlXyR7dGhpcy4jYmFzZUlkfV9gKTsKICB9Cn0KY2xhc3MgQ29tbWFuZE1hbmFnZXIgewogICNjb21tYW5kcyA9IFtdOwogICNsb2NrZWQgPSBmYWxzZTsKICAjbWF4U2l6ZTsKICAjcG9zaXRpb24gPSAtMTsKICBjb25zdHJ1Y3RvcihtYXhTaXplID0gMTI4KSB7CiAgICB0aGlzLiNtYXhTaXplID0gbWF4U2l6ZTsKICB9CiAgYWRkKHsKICAgIGNtZCwKICAgIHVuZG8sCiAgICBwb3N0LAogICAgbXVzdEV4ZWMsCiAgICB0eXBlID0gTmFOLAogICAgb3ZlcndyaXRlSWZTYW1lVHlwZSA9IGZhbHNlLAogICAga2VlcFVuZG8gPSBmYWxzZQogIH0pIHsKICAgIGlmIChtdXN0RXhlYykgewogICAgICBjbWQoKTsKICAgIH0KICAgIGlmICh0aGlzLiNsb2NrZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc2F2ZSA9IHsKICAgICAgY21kLAogICAgICB1bmRvLAogICAgICBwb3N0LAogICAgICB0eXBlCiAgICB9OwogICAgaWYgKHRoaXMuI3Bvc2l0aW9uID09PSAtMSkgewogICAgICBpZiAodGhpcy4jY29tbWFuZHMubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuI2NvbW1hbmRzLmxlbmd0aCA9IDA7CiAgICAgIH0KICAgICAgdGhpcy4jcG9zaXRpb24gPSAwOwogICAgICB0aGlzLiNjb21tYW5kcy5wdXNoKHNhdmUpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAob3ZlcndyaXRlSWZTYW1lVHlwZSAmJiB0aGlzLiNjb21tYW5kc1t0aGlzLiNwb3NpdGlvbl0udHlwZSA9PT0gdHlwZSkgewogICAgICBpZiAoa2VlcFVuZG8pIHsKICAgICAgICBzYXZlLnVuZG8gPSB0aGlzLiNjb21tYW5kc1t0aGlzLiNwb3NpdGlvbl0udW5kbzsKICAgICAgfQogICAgICB0aGlzLiNjb21tYW5kc1t0aGlzLiNwb3NpdGlvbl0gPSBzYXZlOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBuZXh0ID0gdGhpcy4jcG9zaXRpb24gKyAxOwogICAgaWYgKG5leHQgPT09IHRoaXMuI21heFNpemUpIHsKICAgICAgdGhpcy4jY29tbWFuZHMuc3BsaWNlKDAsIDEpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy4jcG9zaXRpb24gPSBuZXh0OwogICAgICBpZiAobmV4dCA8IHRoaXMuI2NvbW1hbmRzLmxlbmd0aCkgewogICAgICAgIHRoaXMuI2NvbW1hbmRzLnNwbGljZShuZXh0KTsKICAgICAgfQogICAgfQogICAgdGhpcy4jY29tbWFuZHMucHVzaChzYXZlKTsKICB9CiAgdW5kbygpIHsKICAgIGlmICh0aGlzLiNwb3NpdGlvbiA9PT0gLTEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jbG9ja2VkID0gdHJ1ZTsKICAgIGNvbnN0IHsKICAgICAgdW5kbywKICAgICAgcG9zdAogICAgfSA9IHRoaXMuI2NvbW1hbmRzW3RoaXMuI3Bvc2l0aW9uXTsKICAgIHVuZG8oKTsKICAgIHBvc3Q/LigpOwogICAgdGhpcy4jbG9ja2VkID0gZmFsc2U7CiAgICB0aGlzLiNwb3NpdGlvbiAtPSAxOwogIH0KICByZWRvKCkgewogICAgaWYgKHRoaXMuI3Bvc2l0aW9uIDwgdGhpcy4jY29tbWFuZHMubGVuZ3RoIC0gMSkgewogICAgICB0aGlzLiNwb3NpdGlvbiArPSAxOwogICAgICB0aGlzLiNsb2NrZWQgPSB0cnVlOwogICAgICBjb25zdCB7CiAgICAgICAgY21kLAogICAgICAgIHBvc3QKICAgICAgfSA9IHRoaXMuI2NvbW1hbmRzW3RoaXMuI3Bvc2l0aW9uXTsKICAgICAgY21kKCk7CiAgICAgIHBvc3Q/LigpOwogICAgICB0aGlzLiNsb2NrZWQgPSBmYWxzZTsKICAgIH0KICB9CiAgaGFzU29tZXRoaW5nVG9VbmRvKCkgewogICAgcmV0dXJuIHRoaXMuI3Bvc2l0aW9uICE9PSAtMTsKICB9CiAgaGFzU29tZXRoaW5nVG9SZWRvKCkgewogICAgcmV0dXJuIHRoaXMuI3Bvc2l0aW9uIDwgdGhpcy4jY29tbWFuZHMubGVuZ3RoIC0gMTsKICB9CiAgY2xlYW5UeXBlKHR5cGUpIHsKICAgIGlmICh0aGlzLiNwb3NpdGlvbiA9PT0gLTEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChsZXQgaSA9IHRoaXMuI3Bvc2l0aW9uOyBpID49IDA7IGktLSkgewogICAgICBpZiAodGhpcy4jY29tbWFuZHNbaV0udHlwZSAhPT0gdHlwZSkgewogICAgICAgIHRoaXMuI2NvbW1hbmRzLnNwbGljZShpICsgMSwgdGhpcy4jcG9zaXRpb24gLSBpKTsKICAgICAgICB0aGlzLiNwb3NpdGlvbiA9IGk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICB0aGlzLiNjb21tYW5kcy5sZW5ndGggPSAwOwogICAgdGhpcy4jcG9zaXRpb24gPSAtMTsKICB9CiAgZGVzdHJveSgpIHsKICAgIHRoaXMuI2NvbW1hbmRzID0gbnVsbDsKICB9Cn0KY2xhc3MgS2V5Ym9hcmRNYW5hZ2VyIHsKICBjb25zdHJ1Y3RvcihjYWxsYmFja3MpIHsKICAgIHRoaXMuYnVmZmVyID0gW107CiAgICB0aGlzLmNhbGxiYWNrcyA9IG5ldyBNYXAoKTsKICAgIHRoaXMuYWxsS2V5cyA9IG5ldyBTZXQoKTsKICAgIGNvbnN0IHsKICAgICAgaXNNYWMKICAgIH0gPSB1dGlsX0ZlYXR1cmVUZXN0LnBsYXRmb3JtOwogICAgZm9yIChjb25zdCBba2V5cywgY2FsbGJhY2ssIG9wdGlvbnMgPSB7fV0gb2YgY2FsbGJhY2tzKSB7CiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHsKICAgICAgICBjb25zdCBpc01hY0tleSA9IGtleS5zdGFydHNXaXRoKCJtYWMrIik7CiAgICAgICAgaWYgKGlzTWFjICYmIGlzTWFjS2V5KSB7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5zZXQoa2V5LnNsaWNlKDQpLCB7CiAgICAgICAgICAgIGNhbGxiYWNrLAogICAgICAgICAgICBvcHRpb25zCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuYWxsS2V5cy5hZGQoa2V5LnNwbGl0KCIrIikuYXQoLTEpKTsKICAgICAgICB9IGVsc2UgaWYgKCFpc01hYyAmJiAhaXNNYWNLZXkpIHsKICAgICAgICAgIHRoaXMuY2FsbGJhY2tzLnNldChrZXksIHsKICAgICAgICAgICAgY2FsbGJhY2ssCiAgICAgICAgICAgIG9wdGlvbnMKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5hbGxLZXlzLmFkZChrZXkuc3BsaXQoIisiKS5hdCgtMSkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICAjc2VyaWFsaXplKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQuYWx0S2V5KSB7CiAgICAgIHRoaXMuYnVmZmVyLnB1c2goImFsdCIpOwogICAgfQogICAgaWYgKGV2ZW50LmN0cmxLZXkpIHsKICAgICAgdGhpcy5idWZmZXIucHVzaCgiY3RybCIpOwogICAgfQogICAgaWYgKGV2ZW50Lm1ldGFLZXkpIHsKICAgICAgdGhpcy5idWZmZXIucHVzaCgibWV0YSIpOwogICAgfQogICAgaWYgKGV2ZW50LnNoaWZ0S2V5KSB7CiAgICAgIHRoaXMuYnVmZmVyLnB1c2goInNoaWZ0Iik7CiAgICB9CiAgICB0aGlzLmJ1ZmZlci5wdXNoKGV2ZW50LmtleSk7CiAgICBjb25zdCBzdHIgPSB0aGlzLmJ1ZmZlci5qb2luKCIrIik7CiAgICB0aGlzLmJ1ZmZlci5sZW5ndGggPSAwOwogICAgcmV0dXJuIHN0cjsKICB9CiAgZXhlYyhzZWxmLCBldmVudCkgewogICAgaWYgKCF0aGlzLmFsbEtleXMuaGFzKGV2ZW50LmtleSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgaW5mbyA9IHRoaXMuY2FsbGJhY2tzLmdldCh0aGlzLiNzZXJpYWxpemUoZXZlbnQpKTsKICAgIGlmICghaW5mbykgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGNhbGxiYWNrLAogICAgICBvcHRpb25zOiB7CiAgICAgICAgYnViYmxlcyA9IGZhbHNlLAogICAgICAgIGFyZ3MgPSBbXSwKICAgICAgICBjaGVja2VyID0gbnVsbAogICAgICB9CiAgICB9ID0gaW5mbzsKICAgIGlmIChjaGVja2VyICYmICFjaGVja2VyKHNlbGYsIGV2ZW50KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjYWxsYmFjay5iaW5kKHNlbGYsIC4uLmFyZ3MsIGV2ZW50KSgpOwogICAgaWYgKCFidWJibGVzKSB7CiAgICAgIHN0b3BFdmVudChldmVudCk7CiAgICB9CiAgfQp9CmNsYXNzIENvbG9yTWFuYWdlciB7CiAgc3RhdGljIF9jb2xvcnNNYXBwaW5nID0gbmV3IE1hcChbWyJDYW52YXNUZXh0IiwgWzAsIDAsIDBdXSwgWyJDYW52YXMiLCBbMjU1LCAyNTUsIDI1NV1dXSk7CiAgZ2V0IF9jb2xvcnMoKSB7CiAgICBjb25zdCBjb2xvcnMgPSBuZXcgTWFwKFtbIkNhbnZhc1RleHQiLCBudWxsXSwgWyJDYW52YXMiLCBudWxsXV0pOwogICAgZ2V0Q29sb3JWYWx1ZXMoY29sb3JzKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9jb2xvcnMiLCBjb2xvcnMpOwogIH0KICBjb252ZXJ0KGNvbG9yKSB7CiAgICBjb25zdCByZ2IgPSBnZXRSR0IoY29sb3IpOwogICAgaWYgKCF3aW5kb3cubWF0Y2hNZWRpYSgiKGZvcmNlZC1jb2xvcnM6IGFjdGl2ZSkiKS5tYXRjaGVzKSB7CiAgICAgIHJldHVybiByZ2I7CiAgICB9CiAgICBmb3IgKGNvbnN0IFtuYW1lLCBSR0JdIG9mIHRoaXMuX2NvbG9ycykgewogICAgICBpZiAoUkdCLmV2ZXJ5KCh4LCBpKSA9PiB4ID09PSByZ2JbaV0pKSB7CiAgICAgICAgcmV0dXJuIENvbG9yTWFuYWdlci5fY29sb3JzTWFwcGluZy5nZXQobmFtZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZ2I7CiAgfQogIGdldEhleENvZGUobmFtZSkgewogICAgY29uc3QgcmdiID0gdGhpcy5fY29sb3JzLmdldChuYW1lKTsKICAgIGlmICghcmdiKSB7CiAgICAgIHJldHVybiBuYW1lOwogICAgfQogICAgcmV0dXJuIFV0aWwubWFrZUhleENvbG9yKC4uLnJnYik7CiAgfQp9CmNsYXNzIEFubm90YXRpb25FZGl0b3JVSU1hbmFnZXIgewogICNhYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgI2FjdGl2ZUVkaXRvciA9IG51bGw7CiAgI2FsbEVkaXRvcnMgPSBuZXcgTWFwKCk7CiAgI2FsbExheWVycyA9IG5ldyBNYXAoKTsKICAjYWx0VGV4dE1hbmFnZXIgPSBudWxsOwogICNhbm5vdGF0aW9uU3RvcmFnZSA9IG51bGw7CiAgI2NoYW5nZWRFeGlzdGluZ0Fubm90YXRpb25zID0gbnVsbDsKICAjY29tbWFuZE1hbmFnZXIgPSBuZXcgQ29tbWFuZE1hbmFnZXIoKTsKICAjY29weVBhc3RlQUMgPSBudWxsOwogICNjdXJyZW50RHJhd2luZ1Nlc3Npb24gPSBudWxsOwogICNjdXJyZW50UGFnZUluZGV4ID0gMDsKICAjZGVsZXRlZEFubm90YXRpb25zRWxlbWVudElkcyA9IG5ldyBTZXQoKTsKICAjZHJhZ2dpbmdFZGl0b3JzID0gbnVsbDsKICAjZWRpdG9yVHlwZXMgPSBudWxsOwogICNlZGl0b3JzVG9SZXNjYWxlID0gbmV3IFNldCgpOwogIF9lZGl0b3JVbmRvQmFyID0gbnVsbDsKICAjZW5hYmxlSGlnaGxpZ2h0RmxvYXRpbmdCdXR0b24gPSBmYWxzZTsKICAjZW5hYmxlVXBkYXRlZEFkZEltYWdlID0gZmFsc2U7CiAgI2VuYWJsZU5ld0FsdFRleHRXaGVuQWRkaW5nSW1hZ2UgPSBmYWxzZTsKICAjZmlsdGVyRmFjdG9yeSA9IG51bGw7CiAgI2ZvY3VzTWFpbkNvbnRhaW5lclRpbWVvdXRJZCA9IG51bGw7CiAgI2ZvY3VzTWFuYWdlckFDID0gbnVsbDsKICAjaGlnaGxpZ2h0Q29sb3JzID0gbnVsbDsKICAjaGlnaGxpZ2h0V2hlblNoaWZ0VXAgPSBmYWxzZTsKICAjaGlnaGxpZ2h0VG9vbGJhciA9IG51bGw7CiAgI2lkTWFuYWdlciA9IG5ldyBJZE1hbmFnZXIoKTsKICAjaXNFbmFibGVkID0gZmFsc2U7CiAgI2lzV2FpdGluZyA9IGZhbHNlOwogICNrZXlib2FyZE1hbmFnZXJBQyA9IG51bGw7CiAgI2xhc3RBY3RpdmVFbGVtZW50ID0gbnVsbDsKICAjbWFpbkhpZ2hsaWdodENvbG9yUGlja2VyID0gbnVsbDsKICAjbWlzc2luZ0NhbnZhc2VzID0gbnVsbDsKICAjbWxNYW5hZ2VyID0gbnVsbDsKICAjbW9kZSA9IEFubm90YXRpb25FZGl0b3JUeXBlLk5PTkU7CiAgI3NlbGVjdGVkRWRpdG9ycyA9IG5ldyBTZXQoKTsKICAjc2VsZWN0ZWRUZXh0Tm9kZSA9IG51bGw7CiAgI3NpZ25hdHVyZU1hbmFnZXIgPSBudWxsOwogICNwYWdlQ29sb3JzID0gbnVsbDsKICAjc2hvd0FsbFN0YXRlcyA9IG51bGw7CiAgI3ByZXZpb3VzU3RhdGVzID0gewogICAgaXNFZGl0aW5nOiBmYWxzZSwKICAgIGlzRW1wdHk6IHRydWUsCiAgICBoYXNTb21ldGhpbmdUb1VuZG86IGZhbHNlLAogICAgaGFzU29tZXRoaW5nVG9SZWRvOiBmYWxzZSwKICAgIGhhc1NlbGVjdGVkRWRpdG9yOiBmYWxzZSwKICAgIGhhc1NlbGVjdGVkVGV4dDogZmFsc2UKICB9OwogICN0cmFuc2xhdGlvbiA9IFswLCAwXTsKICAjdHJhbnNsYXRpb25UaW1lb3V0SWQgPSBudWxsOwogICNjb250YWluZXIgPSBudWxsOwogICN2aWV3ZXIgPSBudWxsOwogICN1cGRhdGVNb2RlQ2FwYWJpbGl0eSA9IG51bGw7CiAgc3RhdGljIFRSQU5TTEFURV9TTUFMTCA9IDE7CiAgc3RhdGljIFRSQU5TTEFURV9CSUcgPSAxMDsKICBzdGF0aWMgZ2V0IF9rZXlib2FyZE1hbmFnZXIoKSB7CiAgICBjb25zdCBwcm90byA9IEFubm90YXRpb25FZGl0b3JVSU1hbmFnZXIucHJvdG90eXBlOwogICAgY29uc3QgYXJyb3dDaGVja2VyID0gc2VsZiA9PiBzZWxmLiNjb250YWluZXIuY29udGFpbnMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgJiYgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC50YWdOYW1lICE9PSAiQlVUVE9OIiAmJiBzZWxmLmhhc1NvbWV0aGluZ1RvQ29udHJvbCgpOwogICAgY29uc3QgdGV4dElucHV0Q2hlY2tlciA9IChfc2VsZiwgewogICAgICB0YXJnZXQ6IGVsCiAgICB9KSA9PiB7CiAgICAgIGlmIChlbCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICB0eXBlCiAgICAgICAgfSA9IGVsOwogICAgICAgIHJldHVybiB0eXBlICE9PSAidGV4dCIgJiYgdHlwZSAhPT0gIm51bWJlciI7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogICAgY29uc3Qgc21hbGwgPSB0aGlzLlRSQU5TTEFURV9TTUFMTDsKICAgIGNvbnN0IGJpZyA9IHRoaXMuVFJBTlNMQVRFX0JJRzsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9rZXlib2FyZE1hbmFnZXIiLCBuZXcgS2V5Ym9hcmRNYW5hZ2VyKFtbWyJjdHJsK2EiLCAibWFjK21ldGErYSJdLCBwcm90by5zZWxlY3RBbGwsIHsKICAgICAgY2hlY2tlcjogdGV4dElucHV0Q2hlY2tlcgogICAgfV0sIFtbImN0cmwreiIsICJtYWMrbWV0YSt6Il0sIHByb3RvLnVuZG8sIHsKICAgICAgY2hlY2tlcjogdGV4dElucHV0Q2hlY2tlcgogICAgfV0sIFtbImN0cmwreSIsICJjdHJsK3NoaWZ0K3oiLCAibWFjK21ldGErc2hpZnQreiIsICJjdHJsK3NoaWZ0K1oiLCAibWFjK21ldGErc2hpZnQrWiJdLCBwcm90by5yZWRvLCB7CiAgICAgIGNoZWNrZXI6IHRleHRJbnB1dENoZWNrZXIKICAgIH1dLCBbWyJCYWNrc3BhY2UiLCAiYWx0K0JhY2tzcGFjZSIsICJjdHJsK0JhY2tzcGFjZSIsICJzaGlmdCtCYWNrc3BhY2UiLCAibWFjK0JhY2tzcGFjZSIsICJtYWMrYWx0K0JhY2tzcGFjZSIsICJtYWMrY3RybCtCYWNrc3BhY2UiLCAiRGVsZXRlIiwgImN0cmwrRGVsZXRlIiwgInNoaWZ0K0RlbGV0ZSIsICJtYWMrRGVsZXRlIl0sIHByb3RvLmRlbGV0ZSwgewogICAgICBjaGVja2VyOiB0ZXh0SW5wdXRDaGVja2VyCiAgICB9XSwgW1siRW50ZXIiLCAibWFjK0VudGVyIl0sIHByb3RvLmFkZE5ld0VkaXRvckZyb21LZXlib2FyZCwgewogICAgICBjaGVja2VyOiAoc2VsZiwgewogICAgICAgIHRhcmdldDogZWwKICAgICAgfSkgPT4gIShlbCBpbnN0YW5jZW9mIEhUTUxCdXR0b25FbGVtZW50KSAmJiBzZWxmLiNjb250YWluZXIuY29udGFpbnMoZWwpICYmICFzZWxmLmlzRW50ZXJIYW5kbGVkCiAgICB9XSwgW1siICIsICJtYWMrICJdLCBwcm90by5hZGROZXdFZGl0b3JGcm9tS2V5Ym9hcmQsIHsKICAgICAgY2hlY2tlcjogKHNlbGYsIHsKICAgICAgICB0YXJnZXQ6IGVsCiAgICAgIH0pID0+ICEoZWwgaW5zdGFuY2VvZiBIVE1MQnV0dG9uRWxlbWVudCkgJiYgc2VsZi4jY29udGFpbmVyLmNvbnRhaW5zKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpCiAgICB9XSwgW1siRXNjYXBlIiwgIm1hYytFc2NhcGUiXSwgcHJvdG8udW5zZWxlY3RBbGxdLCBbWyJBcnJvd0xlZnQiLCAibWFjK0Fycm93TGVmdCJdLCBwcm90by50cmFuc2xhdGVTZWxlY3RlZEVkaXRvcnMsIHsKICAgICAgYXJnczogWy1zbWFsbCwgMF0sCiAgICAgIGNoZWNrZXI6IGFycm93Q2hlY2tlcgogICAgfV0sIFtbImN0cmwrQXJyb3dMZWZ0IiwgIm1hYytzaGlmdCtBcnJvd0xlZnQiXSwgcHJvdG8udHJhbnNsYXRlU2VsZWN0ZWRFZGl0b3JzLCB7CiAgICAgIGFyZ3M6IFstYmlnLCAwXSwKICAgICAgY2hlY2tlcjogYXJyb3dDaGVja2VyCiAgICB9XSwgW1siQXJyb3dSaWdodCIsICJtYWMrQXJyb3dSaWdodCJdLCBwcm90by50cmFuc2xhdGVTZWxlY3RlZEVkaXRvcnMsIHsKICAgICAgYXJnczogW3NtYWxsLCAwXSwKICAgICAgY2hlY2tlcjogYXJyb3dDaGVja2VyCiAgICB9XSwgW1siY3RybCtBcnJvd1JpZ2h0IiwgIm1hYytzaGlmdCtBcnJvd1JpZ2h0Il0sIHByb3RvLnRyYW5zbGF0ZVNlbGVjdGVkRWRpdG9ycywgewogICAgICBhcmdzOiBbYmlnLCAwXSwKICAgICAgY2hlY2tlcjogYXJyb3dDaGVja2VyCiAgICB9XSwgW1siQXJyb3dVcCIsICJtYWMrQXJyb3dVcCJdLCBwcm90by50cmFuc2xhdGVTZWxlY3RlZEVkaXRvcnMsIHsKICAgICAgYXJnczogWzAsIC1zbWFsbF0sCiAgICAgIGNoZWNrZXI6IGFycm93Q2hlY2tlcgogICAgfV0sIFtbImN0cmwrQXJyb3dVcCIsICJtYWMrc2hpZnQrQXJyb3dVcCJdLCBwcm90by50cmFuc2xhdGVTZWxlY3RlZEVkaXRvcnMsIHsKICAgICAgYXJnczogWzAsIC1iaWddLAogICAgICBjaGVja2VyOiBhcnJvd0NoZWNrZXIKICAgIH1dLCBbWyJBcnJvd0Rvd24iLCAibWFjK0Fycm93RG93biJdLCBwcm90by50cmFuc2xhdGVTZWxlY3RlZEVkaXRvcnMsIHsKICAgICAgYXJnczogWzAsIHNtYWxsXSwKICAgICAgY2hlY2tlcjogYXJyb3dDaGVja2VyCiAgICB9XSwgW1siY3RybCtBcnJvd0Rvd24iLCAibWFjK3NoaWZ0K0Fycm93RG93biJdLCBwcm90by50cmFuc2xhdGVTZWxlY3RlZEVkaXRvcnMsIHsKICAgICAgYXJnczogWzAsIGJpZ10sCiAgICAgIGNoZWNrZXI6IGFycm93Q2hlY2tlcgogICAgfV1dKSk7CiAgfQogIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgdmlld2VyLCBhbHRUZXh0TWFuYWdlciwgc2lnbmF0dXJlTWFuYWdlciwgZXZlbnRCdXMsIHBkZkRvY3VtZW50LCBwYWdlQ29sb3JzLCBoaWdobGlnaHRDb2xvcnMsIGVuYWJsZUhpZ2hsaWdodEZsb2F0aW5nQnV0dG9uLCBlbmFibGVVcGRhdGVkQWRkSW1hZ2UsIGVuYWJsZU5ld0FsdFRleHRXaGVuQWRkaW5nSW1hZ2UsIG1sTWFuYWdlciwgZWRpdG9yVW5kb0Jhciwgc3VwcG9ydHNQaW5jaFRvWm9vbSkgewogICAgY29uc3Qgc2lnbmFsID0gdGhpcy5fc2lnbmFsID0gdGhpcy4jYWJvcnRDb250cm9sbGVyLnNpZ25hbDsKICAgIHRoaXMuI2NvbnRhaW5lciA9IGNvbnRhaW5lcjsKICAgIHRoaXMuI3ZpZXdlciA9IHZpZXdlcjsKICAgIHRoaXMuI2FsdFRleHRNYW5hZ2VyID0gYWx0VGV4dE1hbmFnZXI7CiAgICB0aGlzLiNzaWduYXR1cmVNYW5hZ2VyID0gc2lnbmF0dXJlTWFuYWdlcjsKICAgIHRoaXMuX2V2ZW50QnVzID0gZXZlbnRCdXM7CiAgICBldmVudEJ1cy5fb24oImVkaXRpbmdhY3Rpb24iLCB0aGlzLm9uRWRpdGluZ0FjdGlvbi5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICBldmVudEJ1cy5fb24oInBhZ2VjaGFuZ2luZyIsIHRoaXMub25QYWdlQ2hhbmdpbmcuYmluZCh0aGlzKSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgZXZlbnRCdXMuX29uKCJzY2FsZWNoYW5naW5nIiwgdGhpcy5vblNjYWxlQ2hhbmdpbmcuYmluZCh0aGlzKSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgZXZlbnRCdXMuX29uKCJyb3RhdGlvbmNoYW5naW5nIiwgdGhpcy5vblJvdGF0aW9uQ2hhbmdpbmcuYmluZCh0aGlzKSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgZXZlbnRCdXMuX29uKCJzZXRwcmVmZXJlbmNlIiwgdGhpcy5vblNldFByZWZlcmVuY2UuYmluZCh0aGlzKSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgZXZlbnRCdXMuX29uKCJzd2l0Y2hhbm5vdGF0aW9uZWRpdG9ycGFyYW1zIiwgZXZ0ID0+IHRoaXMudXBkYXRlUGFyYW1zKGV2dC50eXBlLCBldnQudmFsdWUpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB0aGlzLiNhZGRTZWxlY3Rpb25MaXN0ZW5lcigpOwogICAgdGhpcy4jYWRkRHJhZ0FuZERyb3BMaXN0ZW5lcnMoKTsKICAgIHRoaXMuI2FkZEtleWJvYXJkTWFuYWdlcigpOwogICAgdGhpcy4jYW5ub3RhdGlvblN0b3JhZ2UgPSBwZGZEb2N1bWVudC5hbm5vdGF0aW9uU3RvcmFnZTsKICAgIHRoaXMuI2ZpbHRlckZhY3RvcnkgPSBwZGZEb2N1bWVudC5maWx0ZXJGYWN0b3J5OwogICAgdGhpcy4jcGFnZUNvbG9ycyA9IHBhZ2VDb2xvcnM7CiAgICB0aGlzLiNoaWdobGlnaHRDb2xvcnMgPSBoaWdobGlnaHRDb2xvcnMgfHwgbnVsbDsKICAgIHRoaXMuI2VuYWJsZUhpZ2hsaWdodEZsb2F0aW5nQnV0dG9uID0gZW5hYmxlSGlnaGxpZ2h0RmxvYXRpbmdCdXR0b247CiAgICB0aGlzLiNlbmFibGVVcGRhdGVkQWRkSW1hZ2UgPSBlbmFibGVVcGRhdGVkQWRkSW1hZ2U7CiAgICB0aGlzLiNlbmFibGVOZXdBbHRUZXh0V2hlbkFkZGluZ0ltYWdlID0gZW5hYmxlTmV3QWx0VGV4dFdoZW5BZGRpbmdJbWFnZTsKICAgIHRoaXMuI21sTWFuYWdlciA9IG1sTWFuYWdlciB8fCBudWxsOwogICAgdGhpcy52aWV3UGFyYW1ldGVycyA9IHsKICAgICAgcmVhbFNjYWxlOiBQaXhlbHNQZXJJbmNoLlBERl9UT19DU1NfVU5JVFMsCiAgICAgIHJvdGF0aW9uOiAwCiAgICB9OwogICAgdGhpcy5pc1NoaWZ0S2V5RG93biA9IGZhbHNlOwogICAgdGhpcy5fZWRpdG9yVW5kb0JhciA9IGVkaXRvclVuZG9CYXIgfHwgbnVsbDsKICAgIHRoaXMuX3N1cHBvcnRzUGluY2hUb1pvb20gPSBzdXBwb3J0c1BpbmNoVG9ab29tICE9PSBmYWxzZTsKICB9CiAgZGVzdHJveSgpIHsKICAgIHRoaXMuI3VwZGF0ZU1vZGVDYXBhYmlsaXR5Py5yZXNvbHZlKCk7CiAgICB0aGlzLiN1cGRhdGVNb2RlQ2FwYWJpbGl0eSA9IG51bGw7CiAgICB0aGlzLiNhYm9ydENvbnRyb2xsZXI/LmFib3J0KCk7CiAgICB0aGlzLiNhYm9ydENvbnRyb2xsZXIgPSBudWxsOwogICAgdGhpcy5fc2lnbmFsID0gbnVsbDsKICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgdGhpcy4jYWxsTGF5ZXJzLnZhbHVlcygpKSB7CiAgICAgIGxheWVyLmRlc3Ryb3koKTsKICAgIH0KICAgIHRoaXMuI2FsbExheWVycy5jbGVhcigpOwogICAgdGhpcy4jYWxsRWRpdG9ycy5jbGVhcigpOwogICAgdGhpcy4jZWRpdG9yc1RvUmVzY2FsZS5jbGVhcigpOwogICAgdGhpcy4jbWlzc2luZ0NhbnZhc2VzPy5jbGVhcigpOwogICAgdGhpcy4jYWN0aXZlRWRpdG9yID0gbnVsbDsKICAgIHRoaXMuI3NlbGVjdGVkRWRpdG9ycy5jbGVhcigpOwogICAgdGhpcy4jY29tbWFuZE1hbmFnZXIuZGVzdHJveSgpOwogICAgdGhpcy4jYWx0VGV4dE1hbmFnZXI/LmRlc3Ryb3koKTsKICAgIHRoaXMuI3NpZ25hdHVyZU1hbmFnZXI/LmRlc3Ryb3koKTsKICAgIHRoaXMuI2hpZ2hsaWdodFRvb2xiYXI/LmhpZGUoKTsKICAgIHRoaXMuI2hpZ2hsaWdodFRvb2xiYXIgPSBudWxsOwogICAgdGhpcy4jbWFpbkhpZ2hsaWdodENvbG9yUGlja2VyPy5kZXN0cm95KCk7CiAgICB0aGlzLiNtYWluSGlnaGxpZ2h0Q29sb3JQaWNrZXIgPSBudWxsOwogICAgaWYgKHRoaXMuI2ZvY3VzTWFpbkNvbnRhaW5lclRpbWVvdXRJZCkgewogICAgICBjbGVhclRpbWVvdXQodGhpcy4jZm9jdXNNYWluQ29udGFpbmVyVGltZW91dElkKTsKICAgICAgdGhpcy4jZm9jdXNNYWluQ29udGFpbmVyVGltZW91dElkID0gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLiN0cmFuc2xhdGlvblRpbWVvdXRJZCkgewogICAgICBjbGVhclRpbWVvdXQodGhpcy4jdHJhbnNsYXRpb25UaW1lb3V0SWQpOwogICAgICB0aGlzLiN0cmFuc2xhdGlvblRpbWVvdXRJZCA9IG51bGw7CiAgICB9CiAgICB0aGlzLl9lZGl0b3JVbmRvQmFyPy5kZXN0cm95KCk7CiAgfQogIGNvbWJpbmVkU2lnbmFsKGFjKSB7CiAgICByZXR1cm4gQWJvcnRTaWduYWwuYW55KFt0aGlzLl9zaWduYWwsIGFjLnNpZ25hbF0pOwogIH0KICBnZXQgbWxNYW5hZ2VyKCkgewogICAgcmV0dXJuIHRoaXMuI21sTWFuYWdlcjsKICB9CiAgZ2V0IHVzZU5ld0FsdFRleHRGbG93KCkgewogICAgcmV0dXJuIHRoaXMuI2VuYWJsZVVwZGF0ZWRBZGRJbWFnZTsKICB9CiAgZ2V0IHVzZU5ld0FsdFRleHRXaGVuQWRkaW5nSW1hZ2UoKSB7CiAgICByZXR1cm4gdGhpcy4jZW5hYmxlTmV3QWx0VGV4dFdoZW5BZGRpbmdJbWFnZTsKICB9CiAgZ2V0IGhjbUZpbHRlcigpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImhjbUZpbHRlciIsIHRoaXMuI3BhZ2VDb2xvcnMgPyB0aGlzLiNmaWx0ZXJGYWN0b3J5LmFkZEhDTUZpbHRlcih0aGlzLiNwYWdlQ29sb3JzLmZvcmVncm91bmQsIHRoaXMuI3BhZ2VDb2xvcnMuYmFja2dyb3VuZCkgOiAibm9uZSIpOwogIH0KICBnZXQgZGlyZWN0aW9uKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZGlyZWN0aW9uIiwgZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLiNjb250YWluZXIpLmRpcmVjdGlvbik7CiAgfQogIGdldCBoaWdobGlnaHRDb2xvcnMoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJoaWdobGlnaHRDb2xvcnMiLCB0aGlzLiNoaWdobGlnaHRDb2xvcnMgPyBuZXcgTWFwKHRoaXMuI2hpZ2hsaWdodENvbG9ycy5zcGxpdCgiLCIpLm1hcChwYWlyID0+IHBhaXIuc3BsaXQoIj0iKS5tYXAoeCA9PiB4LnRyaW0oKSkpKSA6IG51bGwpOwogIH0KICBnZXQgaGlnaGxpZ2h0Q29sb3JOYW1lcygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImhpZ2hsaWdodENvbG9yTmFtZXMiLCB0aGlzLmhpZ2hsaWdodENvbG9ycyA/IG5ldyBNYXAoQXJyYXkuZnJvbSh0aGlzLmhpZ2hsaWdodENvbG9ycywgZSA9PiBlLnJldmVyc2UoKSkpIDogbnVsbCk7CiAgfQogIHNldEN1cnJlbnREcmF3aW5nU2Vzc2lvbihsYXllcikgewogICAgaWYgKGxheWVyKSB7CiAgICAgIHRoaXMudW5zZWxlY3RBbGwoKTsKICAgICAgdGhpcy5kaXNhYmxlVXNlclNlbGVjdCh0cnVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGlzYWJsZVVzZXJTZWxlY3QoZmFsc2UpOwogICAgfQogICAgdGhpcy4jY3VycmVudERyYXdpbmdTZXNzaW9uID0gbGF5ZXI7CiAgfQogIHNldE1haW5IaWdobGlnaHRDb2xvclBpY2tlcihjb2xvclBpY2tlcikgewogICAgdGhpcy4jbWFpbkhpZ2hsaWdodENvbG9yUGlja2VyID0gY29sb3JQaWNrZXI7CiAgfQogIGVkaXRBbHRUZXh0KGVkaXRvciwgZmlyc3RUaW1lID0gZmFsc2UpIHsKICAgIHRoaXMuI2FsdFRleHRNYW5hZ2VyPy5lZGl0QWx0VGV4dCh0aGlzLCBlZGl0b3IsIGZpcnN0VGltZSk7CiAgfQogIGdldFNpZ25hdHVyZShlZGl0b3IpIHsKICAgIHRoaXMuI3NpZ25hdHVyZU1hbmFnZXI/LmdldFNpZ25hdHVyZSh7CiAgICAgIHVpTWFuYWdlcjogdGhpcywKICAgICAgZWRpdG9yCiAgICB9KTsKICB9CiAgZ2V0IHNpZ25hdHVyZU1hbmFnZXIoKSB7CiAgICByZXR1cm4gdGhpcy4jc2lnbmF0dXJlTWFuYWdlcjsKICB9CiAgc3dpdGNoVG9Nb2RlKG1vZGUsIGNhbGxiYWNrKSB7CiAgICB0aGlzLl9ldmVudEJ1cy5vbigiYW5ub3RhdGlvbmVkaXRvcm1vZGVjaGFuZ2VkIiwgY2FsbGJhY2ssIHsKICAgICAgb25jZTogdHJ1ZSwKICAgICAgc2lnbmFsOiB0aGlzLl9zaWduYWwKICAgIH0pOwogICAgdGhpcy5fZXZlbnRCdXMuZGlzcGF0Y2goInNob3dhbm5vdGF0aW9uZWRpdG9ydWkiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgbW9kZQogICAgfSk7CiAgfQogIHNldFByZWZlcmVuY2UobmFtZSwgdmFsdWUpIHsKICAgIHRoaXMuX2V2ZW50QnVzLmRpc3BhdGNoKCJzZXRwcmVmZXJlbmNlIiwgewogICAgICBzb3VyY2U6IHRoaXMsCiAgICAgIG5hbWUsCiAgICAgIHZhbHVlCiAgICB9KTsKICB9CiAgb25TZXRQcmVmZXJlbmNlKHsKICAgIG5hbWUsCiAgICB2YWx1ZQogIH0pIHsKICAgIHN3aXRjaCAobmFtZSkgewogICAgICBjYXNlICJlbmFibGVOZXdBbHRUZXh0V2hlbkFkZGluZ0ltYWdlIjoKICAgICAgICB0aGlzLiNlbmFibGVOZXdBbHRUZXh0V2hlbkFkZGluZ0ltYWdlID0gdmFsdWU7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQogIG9uUGFnZUNoYW5naW5nKHsKICAgIHBhZ2VOdW1iZXIKICB9KSB7CiAgICB0aGlzLiNjdXJyZW50UGFnZUluZGV4ID0gcGFnZU51bWJlciAtIDE7CiAgfQogIGZvY3VzTWFpbkNvbnRhaW5lcigpIHsKICAgIHRoaXMuI2NvbnRhaW5lci5mb2N1cygpOwogIH0KICBmaW5kUGFyZW50KHgsIHkpIHsKICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgdGhpcy4jYWxsTGF5ZXJzLnZhbHVlcygpKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4OiBsYXllclgsCiAgICAgICAgeTogbGF5ZXJZLAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodAogICAgICB9ID0gbGF5ZXIuZGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICBpZiAoeCA+PSBsYXllclggJiYgeCA8PSBsYXllclggKyB3aWR0aCAmJiB5ID49IGxheWVyWSAmJiB5IDw9IGxheWVyWSArIGhlaWdodCkgewogICAgICAgIHJldHVybiBsYXllcjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGRpc2FibGVVc2VyU2VsZWN0KHZhbHVlID0gZmFsc2UpIHsKICAgIHRoaXMuI3ZpZXdlci5jbGFzc0xpc3QudG9nZ2xlKCJub1VzZXJTZWxlY3QiLCB2YWx1ZSk7CiAgfQogIGFkZFNob3VsZFJlc2NhbGUoZWRpdG9yKSB7CiAgICB0aGlzLiNlZGl0b3JzVG9SZXNjYWxlLmFkZChlZGl0b3IpOwogIH0KICByZW1vdmVTaG91bGRSZXNjYWxlKGVkaXRvcikgewogICAgdGhpcy4jZWRpdG9yc1RvUmVzY2FsZS5kZWxldGUoZWRpdG9yKTsKICB9CiAgb25TY2FsZUNoYW5naW5nKHsKICAgIHNjYWxlCiAgfSkgewogICAgdGhpcy5jb21taXRPclJlbW92ZSgpOwogICAgdGhpcy52aWV3UGFyYW1ldGVycy5yZWFsU2NhbGUgPSBzY2FsZSAqIFBpeGVsc1BlckluY2guUERGX1RPX0NTU19VTklUUzsKICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIHRoaXMuI2VkaXRvcnNUb1Jlc2NhbGUpIHsKICAgICAgZWRpdG9yLm9uU2NhbGVDaGFuZ2luZygpOwogICAgfQogICAgdGhpcy4jY3VycmVudERyYXdpbmdTZXNzaW9uPy5vblNjYWxlQ2hhbmdpbmcoKTsKICB9CiAgb25Sb3RhdGlvbkNoYW5naW5nKHsKICAgIHBhZ2VzUm90YXRpb24KICB9KSB7CiAgICB0aGlzLmNvbW1pdE9yUmVtb3ZlKCk7CiAgICB0aGlzLnZpZXdQYXJhbWV0ZXJzLnJvdGF0aW9uID0gcGFnZXNSb3RhdGlvbjsKICB9CiAgI2dldEFuY2hvckVsZW1lbnRGb3JTZWxlY3Rpb24oewogICAgYW5jaG9yTm9kZQogIH0pIHsKICAgIHJldHVybiBhbmNob3JOb2RlLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSA/IGFuY2hvck5vZGUucGFyZW50RWxlbWVudCA6IGFuY2hvck5vZGU7CiAgfQogICNnZXRMYXllckZvclRleHRMYXllcih0ZXh0TGF5ZXIpIHsKICAgIGNvbnN0IHsKICAgICAgY3VycmVudExheWVyCiAgICB9ID0gdGhpczsKICAgIGlmIChjdXJyZW50TGF5ZXIuaGFzVGV4dExheWVyKHRleHRMYXllcikpIHsKICAgICAgcmV0dXJuIGN1cnJlbnRMYXllcjsKICAgIH0KICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgdGhpcy4jYWxsTGF5ZXJzLnZhbHVlcygpKSB7CiAgICAgIGlmIChsYXllci5oYXNUZXh0TGF5ZXIodGV4dExheWVyKSkgewogICAgICAgIHJldHVybiBsYXllcjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGhpZ2hsaWdodFNlbGVjdGlvbihtZXRob2RPZkNyZWF0aW9uID0gIiIpIHsKICAgIGNvbnN0IHNlbGVjdGlvbiA9IGRvY3VtZW50LmdldFNlbGVjdGlvbigpOwogICAgaWYgKCFzZWxlY3Rpb24gfHwgc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgYW5jaG9yTm9kZSwKICAgICAgYW5jaG9yT2Zmc2V0LAogICAgICBmb2N1c05vZGUsCiAgICAgIGZvY3VzT2Zmc2V0CiAgICB9ID0gc2VsZWN0aW9uOwogICAgY29uc3QgdGV4dCA9IHNlbGVjdGlvbi50b1N0cmluZygpOwogICAgY29uc3QgYW5jaG9yRWxlbWVudCA9IHRoaXMuI2dldEFuY2hvckVsZW1lbnRGb3JTZWxlY3Rpb24oc2VsZWN0aW9uKTsKICAgIGNvbnN0IHRleHRMYXllciA9IGFuY2hvckVsZW1lbnQuY2xvc2VzdCgiLnRleHRMYXllciIpOwogICAgY29uc3QgYm94ZXMgPSB0aGlzLmdldFNlbGVjdGlvbkJveGVzKHRleHRMYXllcik7CiAgICBpZiAoIWJveGVzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHNlbGVjdGlvbi5lbXB0eSgpOwogICAgY29uc3QgbGF5ZXIgPSB0aGlzLiNnZXRMYXllckZvclRleHRMYXllcih0ZXh0TGF5ZXIpOwogICAgY29uc3QgaXNOb25lTW9kZSA9IHRoaXMuI21vZGUgPT09IEFubm90YXRpb25FZGl0b3JUeXBlLk5PTkU7CiAgICBjb25zdCBjYWxsYmFjayA9ICgpID0+IHsKICAgICAgbGF5ZXI/LmNyZWF0ZUFuZEFkZE5ld0VkaXRvcih7CiAgICAgICAgeDogMCwKICAgICAgICB5OiAwCiAgICAgIH0sIGZhbHNlLCB7CiAgICAgICAgbWV0aG9kT2ZDcmVhdGlvbiwKICAgICAgICBib3hlcywKICAgICAgICBhbmNob3JOb2RlLAogICAgICAgIGFuY2hvck9mZnNldCwKICAgICAgICBmb2N1c05vZGUsCiAgICAgICAgZm9jdXNPZmZzZXQsCiAgICAgICAgdGV4dAogICAgICB9KTsKICAgICAgaWYgKGlzTm9uZU1vZGUpIHsKICAgICAgICB0aGlzLnNob3dBbGxFZGl0b3JzKCJoaWdobGlnaHQiLCB0cnVlLCB0cnVlKTsKICAgICAgfQogICAgfTsKICAgIGlmIChpc05vbmVNb2RlKSB7CiAgICAgIHRoaXMuc3dpdGNoVG9Nb2RlKEFubm90YXRpb25FZGl0b3JUeXBlLkhJR0hMSUdIVCwgY2FsbGJhY2spOwogICAgICByZXR1cm47CiAgICB9CiAgICBjYWxsYmFjaygpOwogIH0KICAjZGlzcGxheUhpZ2hsaWdodFRvb2xiYXIoKSB7CiAgICBjb25zdCBzZWxlY3Rpb24gPSBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKTsKICAgIGlmICghc2VsZWN0aW9uIHx8IHNlbGVjdGlvbi5pc0NvbGxhcHNlZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBhbmNob3JFbGVtZW50ID0gdGhpcy4jZ2V0QW5jaG9yRWxlbWVudEZvclNlbGVjdGlvbihzZWxlY3Rpb24pOwogICAgY29uc3QgdGV4dExheWVyID0gYW5jaG9yRWxlbWVudC5jbG9zZXN0KCIudGV4dExheWVyIik7CiAgICBjb25zdCBib3hlcyA9IHRoaXMuZ2V0U2VsZWN0aW9uQm94ZXModGV4dExheWVyKTsKICAgIGlmICghYm94ZXMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jaGlnaGxpZ2h0VG9vbGJhciB8fD0gbmV3IEhpZ2hsaWdodFRvb2xiYXIodGhpcyk7CiAgICB0aGlzLiNoaWdobGlnaHRUb29sYmFyLnNob3codGV4dExheWVyLCBib3hlcywgdGhpcy5kaXJlY3Rpb24gPT09ICJsdHIiKTsKICB9CiAgYWRkVG9Bbm5vdGF0aW9uU3RvcmFnZShlZGl0b3IpIHsKICAgIGlmICghZWRpdG9yLmlzRW1wdHkoKSAmJiB0aGlzLiNhbm5vdGF0aW9uU3RvcmFnZSAmJiAhdGhpcy4jYW5ub3RhdGlvblN0b3JhZ2UuaGFzKGVkaXRvci5pZCkpIHsKICAgICAgdGhpcy4jYW5ub3RhdGlvblN0b3JhZ2Uuc2V0VmFsdWUoZWRpdG9yLmlkLCBlZGl0b3IpOwogICAgfQogIH0KICAjc2VsZWN0aW9uQ2hhbmdlKCkgewogICAgY29uc3Qgc2VsZWN0aW9uID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCk7CiAgICBpZiAoIXNlbGVjdGlvbiB8fCBzZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHsKICAgICAgaWYgKHRoaXMuI3NlbGVjdGVkVGV4dE5vZGUpIHsKICAgICAgICB0aGlzLiNoaWdobGlnaHRUb29sYmFyPy5oaWRlKCk7CiAgICAgICAgdGhpcy4jc2VsZWN0ZWRUZXh0Tm9kZSA9IG51bGw7CiAgICAgICAgdGhpcy4jZGlzcGF0Y2hVcGRhdGVTdGF0ZXMoewogICAgICAgICAgaGFzU2VsZWN0ZWRUZXh0OiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgYW5jaG9yTm9kZQogICAgfSA9IHNlbGVjdGlvbjsKICAgIGlmIChhbmNob3JOb2RlID09PSB0aGlzLiNzZWxlY3RlZFRleHROb2RlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFuY2hvckVsZW1lbnQgPSB0aGlzLiNnZXRBbmNob3JFbGVtZW50Rm9yU2VsZWN0aW9uKHNlbGVjdGlvbik7CiAgICBjb25zdCB0ZXh0TGF5ZXIgPSBhbmNob3JFbGVtZW50LmNsb3Nlc3QoIi50ZXh0TGF5ZXIiKTsKICAgIGlmICghdGV4dExheWVyKSB7CiAgICAgIGlmICh0aGlzLiNzZWxlY3RlZFRleHROb2RlKSB7CiAgICAgICAgdGhpcy4jaGlnaGxpZ2h0VG9vbGJhcj8uaGlkZSgpOwogICAgICAgIHRoaXMuI3NlbGVjdGVkVGV4dE5vZGUgPSBudWxsOwogICAgICAgIHRoaXMuI2Rpc3BhdGNoVXBkYXRlU3RhdGVzKHsKICAgICAgICAgIGhhc1NlbGVjdGVkVGV4dDogZmFsc2UKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNoaWdobGlnaHRUb29sYmFyPy5oaWRlKCk7CiAgICB0aGlzLiNzZWxlY3RlZFRleHROb2RlID0gYW5jaG9yTm9kZTsKICAgIHRoaXMuI2Rpc3BhdGNoVXBkYXRlU3RhdGVzKHsKICAgICAgaGFzU2VsZWN0ZWRUZXh0OiB0cnVlCiAgICB9KTsKICAgIGlmICh0aGlzLiNtb2RlICE9PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ISUdITElHSFQgJiYgdGhpcy4jbW9kZSAhPT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuTk9ORSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy4jbW9kZSA9PT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuSElHSExJR0hUKSB7CiAgICAgIHRoaXMuc2hvd0FsbEVkaXRvcnMoImhpZ2hsaWdodCIsIHRydWUsIHRydWUpOwogICAgfQogICAgdGhpcy4jaGlnaGxpZ2h0V2hlblNoaWZ0VXAgPSB0aGlzLmlzU2hpZnRLZXlEb3duOwogICAgaWYgKCF0aGlzLmlzU2hpZnRLZXlEb3duKSB7CiAgICAgIGNvbnN0IGFjdGl2ZUxheWVyID0gdGhpcy4jbW9kZSA9PT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuSElHSExJR0hUID8gdGhpcy4jZ2V0TGF5ZXJGb3JUZXh0TGF5ZXIodGV4dExheWVyKSA6IG51bGw7CiAgICAgIGFjdGl2ZUxheWVyPy50b2dnbGVEcmF3aW5nKCk7CiAgICAgIGNvbnN0IGFjID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgICBjb25zdCBzaWduYWwgPSB0aGlzLmNvbWJpbmVkU2lnbmFsKGFjKTsKICAgICAgY29uc3QgcG9pbnRlcnVwID0gZSA9PiB7CiAgICAgICAgaWYgKGUudHlwZSA9PT0gInBvaW50ZXJ1cCIgJiYgZS5idXR0b24gIT09IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYWMuYWJvcnQoKTsKICAgICAgICBhY3RpdmVMYXllcj8udG9nZ2xlRHJhd2luZyh0cnVlKTsKICAgICAgICBpZiAoZS50eXBlID09PSAicG9pbnRlcnVwIikgewogICAgICAgICAgdGhpcy4jb25TZWxlY3RFbmQoIm1haW5fdG9vbGJhciIpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIHBvaW50ZXJ1cCwgewogICAgICAgIHNpZ25hbAogICAgICB9KTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJsdXIiLCBwb2ludGVydXAsIHsKICAgICAgICBzaWduYWwKICAgICAgfSk7CiAgICB9CiAgfQogICNvblNlbGVjdEVuZChtZXRob2RPZkNyZWF0aW9uID0gIiIpIHsKICAgIGlmICh0aGlzLiNtb2RlID09PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ISUdITElHSFQpIHsKICAgICAgdGhpcy5oaWdobGlnaHRTZWxlY3Rpb24obWV0aG9kT2ZDcmVhdGlvbik7CiAgICB9IGVsc2UgaWYgKHRoaXMuI2VuYWJsZUhpZ2hsaWdodEZsb2F0aW5nQnV0dG9uKSB7CiAgICAgIHRoaXMuI2Rpc3BsYXlIaWdobGlnaHRUb29sYmFyKCk7CiAgICB9CiAgfQogICNhZGRTZWxlY3Rpb25MaXN0ZW5lcigpIHsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInNlbGVjdGlvbmNoYW5nZSIsIHRoaXMuI3NlbGVjdGlvbkNoYW5nZS5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbDogdGhpcy5fc2lnbmFsCiAgICB9KTsKICB9CiAgI2FkZEZvY3VzTWFuYWdlcigpIHsKICAgIGlmICh0aGlzLiNmb2N1c01hbmFnZXJBQykgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNmb2N1c01hbmFnZXJBQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuY29tYmluZWRTaWduYWwodGhpcy4jZm9jdXNNYW5hZ2VyQUMpOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImZvY3VzIiwgdGhpcy5mb2N1cy5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiYmx1ciIsIHRoaXMuYmx1ci5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgfQogICNyZW1vdmVGb2N1c01hbmFnZXIoKSB7CiAgICB0aGlzLiNmb2N1c01hbmFnZXJBQz8uYWJvcnQoKTsKICAgIHRoaXMuI2ZvY3VzTWFuYWdlckFDID0gbnVsbDsKICB9CiAgYmx1cigpIHsKICAgIHRoaXMuaXNTaGlmdEtleURvd24gPSBmYWxzZTsKICAgIGlmICh0aGlzLiNoaWdobGlnaHRXaGVuU2hpZnRVcCkgewogICAgICB0aGlzLiNoaWdobGlnaHRXaGVuU2hpZnRVcCA9IGZhbHNlOwogICAgICB0aGlzLiNvblNlbGVjdEVuZCgibWFpbl90b29sYmFyIik7CiAgICB9CiAgICBpZiAoIXRoaXMuaGFzU2VsZWN0aW9uKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgYWN0aXZlRWxlbWVudAogICAgfSA9IGRvY3VtZW50OwogICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzKSB7CiAgICAgIGlmIChlZGl0b3IuZGl2LmNvbnRhaW5zKGFjdGl2ZUVsZW1lbnQpKSB7CiAgICAgICAgdGhpcy4jbGFzdEFjdGl2ZUVsZW1lbnQgPSBbZWRpdG9yLCBhY3RpdmVFbGVtZW50XTsKICAgICAgICBlZGl0b3IuX2ZvY3VzRXZlbnRzQWxsb3dlZCA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIGZvY3VzKCkgewogICAgaWYgKCF0aGlzLiNsYXN0QWN0aXZlRWxlbWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBbbGFzdEVkaXRvciwgbGFzdEFjdGl2ZUVsZW1lbnRdID0gdGhpcy4jbGFzdEFjdGl2ZUVsZW1lbnQ7CiAgICB0aGlzLiNsYXN0QWN0aXZlRWxlbWVudCA9IG51bGw7CiAgICBsYXN0QWN0aXZlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJmb2N1c2luIiwgKCkgPT4gewogICAgICBsYXN0RWRpdG9yLl9mb2N1c0V2ZW50c0FsbG93ZWQgPSB0cnVlOwogICAgfSwgewogICAgICBvbmNlOiB0cnVlLAogICAgICBzaWduYWw6IHRoaXMuX3NpZ25hbAogICAgfSk7CiAgICBsYXN0QWN0aXZlRWxlbWVudC5mb2N1cygpOwogIH0KICAjYWRkS2V5Ym9hcmRNYW5hZ2VyKCkgewogICAgaWYgKHRoaXMuI2tleWJvYXJkTWFuYWdlckFDKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2tleWJvYXJkTWFuYWdlckFDID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgY29uc3Qgc2lnbmFsID0gdGhpcy5jb21iaW5lZFNpZ25hbCh0aGlzLiNrZXlib2FyZE1hbmFnZXJBQyk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIHRoaXMua2V5ZG93bi5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCB0aGlzLmtleXVwLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICB9CiAgI3JlbW92ZUtleWJvYXJkTWFuYWdlcigpIHsKICAgIHRoaXMuI2tleWJvYXJkTWFuYWdlckFDPy5hYm9ydCgpOwogICAgdGhpcy4ja2V5Ym9hcmRNYW5hZ2VyQUMgPSBudWxsOwogIH0KICAjYWRkQ29weVBhc3RlTGlzdGVuZXJzKCkgewogICAgaWYgKHRoaXMuI2NvcHlQYXN0ZUFDKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2NvcHlQYXN0ZUFDID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgY29uc3Qgc2lnbmFsID0gdGhpcy5jb21iaW5lZFNpZ25hbCh0aGlzLiNjb3B5UGFzdGVBQyk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjb3B5IiwgdGhpcy5jb3B5LmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImN1dCIsIHRoaXMuY3V0LmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInBhc3RlIiwgdGhpcy5wYXN0ZS5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgfQogICNyZW1vdmVDb3B5UGFzdGVMaXN0ZW5lcnMoKSB7CiAgICB0aGlzLiNjb3B5UGFzdGVBQz8uYWJvcnQoKTsKICAgIHRoaXMuI2NvcHlQYXN0ZUFDID0gbnVsbDsKICB9CiAgI2FkZERyYWdBbmREcm9wTGlzdGVuZXJzKCkgewogICAgY29uc3Qgc2lnbmFsID0gdGhpcy5fc2lnbmFsOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ292ZXIiLCB0aGlzLmRyYWdPdmVyLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImRyb3AiLCB0aGlzLmRyb3AuYmluZCh0aGlzKSwgewogICAgICBzaWduYWwKICAgIH0pOwogIH0KICBhZGRFZGl0TGlzdGVuZXJzKCkgewogICAgdGhpcy4jYWRkS2V5Ym9hcmRNYW5hZ2VyKCk7CiAgICB0aGlzLiNhZGRDb3B5UGFzdGVMaXN0ZW5lcnMoKTsKICB9CiAgcmVtb3ZlRWRpdExpc3RlbmVycygpIHsKICAgIHRoaXMuI3JlbW92ZUtleWJvYXJkTWFuYWdlcigpOwogICAgdGhpcy4jcmVtb3ZlQ29weVBhc3RlTGlzdGVuZXJzKCk7CiAgfQogIGRyYWdPdmVyKGV2ZW50KSB7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgdHlwZQogICAgfSBvZiBldmVudC5kYXRhVHJhbnNmZXIuaXRlbXMpIHsKICAgICAgZm9yIChjb25zdCBlZGl0b3JUeXBlIG9mIHRoaXMuI2VkaXRvclR5cGVzKSB7CiAgICAgICAgaWYgKGVkaXRvclR5cGUuaXNIYW5kbGluZ01pbWVGb3JQYXN0aW5nKHR5cGUpKSB7CiAgICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9ICJjb3B5IjsKICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGRyb3AoZXZlbnQpIHsKICAgIGZvciAoY29uc3QgaXRlbSBvZiBldmVudC5kYXRhVHJhbnNmZXIuaXRlbXMpIHsKICAgICAgZm9yIChjb25zdCBlZGl0b3JUeXBlIG9mIHRoaXMuI2VkaXRvclR5cGVzKSB7CiAgICAgICAgaWYgKGVkaXRvclR5cGUuaXNIYW5kbGluZ01pbWVGb3JQYXN0aW5nKGl0ZW0udHlwZSkpIHsKICAgICAgICAgIGVkaXRvclR5cGUucGFzdGUoaXRlbSwgdGhpcy5jdXJyZW50TGF5ZXIpOwogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgY29weShldmVudCkgewogICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIHRoaXMuI2FjdGl2ZUVkaXRvcj8uY29tbWl0T3JSZW1vdmUoKTsKICAgIGlmICghdGhpcy5oYXNTZWxlY3Rpb24pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZWRpdG9ycyA9IFtdOwogICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzKSB7CiAgICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBlZGl0b3Iuc2VyaWFsaXplKHRydWUpOwogICAgICBpZiAoc2VyaWFsaXplZCkgewogICAgICAgIGVkaXRvcnMucHVzaChzZXJpYWxpemVkKTsKICAgICAgfQogICAgfQogICAgaWYgKGVkaXRvcnMubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGV2ZW50LmNsaXBib2FyZERhdGEuc2V0RGF0YSgiYXBwbGljYXRpb24vcGRmanMiLCBKU09OLnN0cmluZ2lmeShlZGl0b3JzKSk7CiAgfQogIGN1dChldmVudCkgewogICAgdGhpcy5jb3B5KGV2ZW50KTsKICAgIHRoaXMuZGVsZXRlKCk7CiAgfQogIGFzeW5jIHBhc3RlKGV2ZW50KSB7CiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgY29uc3QgewogICAgICBjbGlwYm9hcmREYXRhCiAgICB9ID0gZXZlbnQ7CiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgY2xpcGJvYXJkRGF0YS5pdGVtcykgewogICAgICBmb3IgKGNvbnN0IGVkaXRvclR5cGUgb2YgdGhpcy4jZWRpdG9yVHlwZXMpIHsKICAgICAgICBpZiAoZWRpdG9yVHlwZS5pc0hhbmRsaW5nTWltZUZvclBhc3RpbmcoaXRlbS50eXBlKSkgewogICAgICAgICAgZWRpdG9yVHlwZS5wYXN0ZShpdGVtLCB0aGlzLmN1cnJlbnRMYXllcik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBsZXQgZGF0YSA9IGNsaXBib2FyZERhdGEuZ2V0RGF0YSgiYXBwbGljYXRpb24vcGRmanMiKTsKICAgIGlmICghZGF0YSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0cnkgewogICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIHdhcm4oYHBhc3RlOiAiJHtleC5tZXNzYWdlfSIuYCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnVuc2VsZWN0QWxsKCk7CiAgICBjb25zdCBsYXllciA9IHRoaXMuY3VycmVudExheWVyOwogICAgdHJ5IHsKICAgICAgY29uc3QgbmV3RWRpdG9ycyA9IFtdOwogICAgICBmb3IgKGNvbnN0IGVkaXRvciBvZiBkYXRhKSB7CiAgICAgICAgY29uc3QgZGVzZXJpYWxpemVkRWRpdG9yID0gYXdhaXQgbGF5ZXIuZGVzZXJpYWxpemUoZWRpdG9yKTsKICAgICAgICBpZiAoIWRlc2VyaWFsaXplZEVkaXRvcikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBuZXdFZGl0b3JzLnB1c2goZGVzZXJpYWxpemVkRWRpdG9yKTsKICAgICAgfQogICAgICBjb25zdCBjbWQgPSAoKSA9PiB7CiAgICAgICAgZm9yIChjb25zdCBlZGl0b3Igb2YgbmV3RWRpdG9ycykgewogICAgICAgICAgdGhpcy4jYWRkRWRpdG9yVG9MYXllcihlZGl0b3IpOwogICAgICAgIH0KICAgICAgICB0aGlzLiNzZWxlY3RFZGl0b3JzKG5ld0VkaXRvcnMpOwogICAgICB9OwogICAgICBjb25zdCB1bmRvID0gKCkgPT4gewogICAgICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIG5ld0VkaXRvcnMpIHsKICAgICAgICAgIGVkaXRvci5yZW1vdmUoKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHRoaXMuYWRkQ29tbWFuZHMoewogICAgICAgIGNtZCwKICAgICAgICB1bmRvLAogICAgICAgIG11c3RFeGVjOiB0cnVlCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgd2FybihgcGFzdGU6ICIke2V4Lm1lc3NhZ2V9Ii5gKTsKICAgIH0KICB9CiAga2V5ZG93bihldmVudCkgewogICAgaWYgKCF0aGlzLmlzU2hpZnRLZXlEb3duICYmIGV2ZW50LmtleSA9PT0gIlNoaWZ0IikgewogICAgICB0aGlzLmlzU2hpZnRLZXlEb3duID0gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLiNtb2RlICE9PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5OT05FICYmICF0aGlzLmlzRWRpdG9ySGFuZGxpbmdLZXlib2FyZCkgewogICAgICBBbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyLl9rZXlib2FyZE1hbmFnZXIuZXhlYyh0aGlzLCBldmVudCk7CiAgICB9CiAgfQogIGtleXVwKGV2ZW50KSB7CiAgICBpZiAodGhpcy5pc1NoaWZ0S2V5RG93biAmJiBldmVudC5rZXkgPT09ICJTaGlmdCIpIHsKICAgICAgdGhpcy5pc1NoaWZ0S2V5RG93biA9IGZhbHNlOwogICAgICBpZiAodGhpcy4jaGlnaGxpZ2h0V2hlblNoaWZ0VXApIHsKICAgICAgICB0aGlzLiNoaWdobGlnaHRXaGVuU2hpZnRVcCA9IGZhbHNlOwogICAgICAgIHRoaXMuI29uU2VsZWN0RW5kKCJtYWluX3Rvb2xiYXIiKTsKICAgICAgfQogICAgfQogIH0KICBvbkVkaXRpbmdBY3Rpb24oewogICAgbmFtZQogIH0pIHsKICAgIHN3aXRjaCAobmFtZSkgewogICAgICBjYXNlICJ1bmRvIjoKICAgICAgY2FzZSAicmVkbyI6CiAgICAgIGNhc2UgImRlbGV0ZSI6CiAgICAgIGNhc2UgInNlbGVjdEFsbCI6CiAgICAgICAgdGhpc1tuYW1lXSgpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJoaWdobGlnaHRTZWxlY3Rpb24iOgogICAgICAgIHRoaXMuaGlnaGxpZ2h0U2VsZWN0aW9uKCJjb250ZXh0X21lbnUiKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CiAgI2Rpc3BhdGNoVXBkYXRlU3RhdGVzKGRldGFpbHMpIHsKICAgIGNvbnN0IGhhc0NoYW5nZWQgPSBPYmplY3QuZW50cmllcyhkZXRhaWxzKS5zb21lKChba2V5LCB2YWx1ZV0pID0+IHRoaXMuI3ByZXZpb3VzU3RhdGVzW2tleV0gIT09IHZhbHVlKTsKICAgIGlmIChoYXNDaGFuZ2VkKSB7CiAgICAgIHRoaXMuX2V2ZW50QnVzLmRpc3BhdGNoKCJhbm5vdGF0aW9uZWRpdG9yc3RhdGVzY2hhbmdlZCIsIHsKICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgZGV0YWlsczogT2JqZWN0LmFzc2lnbih0aGlzLiNwcmV2aW91c1N0YXRlcywgZGV0YWlscykKICAgICAgfSk7CiAgICAgIGlmICh0aGlzLiNtb2RlID09PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ISUdITElHSFQgJiYgZGV0YWlscy5oYXNTZWxlY3RlZEVkaXRvciA9PT0gZmFsc2UpIHsKICAgICAgICB0aGlzLiNkaXNwYXRjaFVwZGF0ZVVJKFtbQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX0ZSRUUsIHRydWVdXSk7CiAgICAgIH0KICAgIH0KICB9CiAgI2Rpc3BhdGNoVXBkYXRlVUkoZGV0YWlscykgewogICAgdGhpcy5fZXZlbnRCdXMuZGlzcGF0Y2goImFubm90YXRpb25lZGl0b3JwYXJhbXNjaGFuZ2VkIiwgewogICAgICBzb3VyY2U6IHRoaXMsCiAgICAgIGRldGFpbHMKICAgIH0pOwogIH0KICBzZXRFZGl0aW5nU3RhdGUoaXNFZGl0aW5nKSB7CiAgICBpZiAoaXNFZGl0aW5nKSB7CiAgICAgIHRoaXMuI2FkZEZvY3VzTWFuYWdlcigpOwogICAgICB0aGlzLiNhZGRDb3B5UGFzdGVMaXN0ZW5lcnMoKTsKICAgICAgdGhpcy4jZGlzcGF0Y2hVcGRhdGVTdGF0ZXMoewogICAgICAgIGlzRWRpdGluZzogdGhpcy4jbW9kZSAhPT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuTk9ORSwKICAgICAgICBpc0VtcHR5OiB0aGlzLiNpc0VtcHR5KCksCiAgICAgICAgaGFzU29tZXRoaW5nVG9VbmRvOiB0aGlzLiNjb21tYW5kTWFuYWdlci5oYXNTb21ldGhpbmdUb1VuZG8oKSwKICAgICAgICBoYXNTb21ldGhpbmdUb1JlZG86IHRoaXMuI2NvbW1hbmRNYW5hZ2VyLmhhc1NvbWV0aGluZ1RvUmVkbygpLAogICAgICAgIGhhc1NlbGVjdGVkRWRpdG9yOiBmYWxzZQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuI3JlbW92ZUZvY3VzTWFuYWdlcigpOwogICAgICB0aGlzLiNyZW1vdmVDb3B5UGFzdGVMaXN0ZW5lcnMoKTsKICAgICAgdGhpcy4jZGlzcGF0Y2hVcGRhdGVTdGF0ZXMoewogICAgICAgIGlzRWRpdGluZzogZmFsc2UKICAgICAgfSk7CiAgICAgIHRoaXMuZGlzYWJsZVVzZXJTZWxlY3QoZmFsc2UpOwogICAgfQogIH0KICByZWdpc3RlckVkaXRvclR5cGVzKHR5cGVzKSB7CiAgICBpZiAodGhpcy4jZWRpdG9yVHlwZXMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jZWRpdG9yVHlwZXMgPSB0eXBlczsKICAgIGZvciAoY29uc3QgZWRpdG9yVHlwZSBvZiB0aGlzLiNlZGl0b3JUeXBlcykgewogICAgICB0aGlzLiNkaXNwYXRjaFVwZGF0ZVVJKGVkaXRvclR5cGUuZGVmYXVsdFByb3BlcnRpZXNUb1VwZGF0ZSk7CiAgICB9CiAgfQogIGdldElkKCkgewogICAgcmV0dXJuIHRoaXMuI2lkTWFuYWdlci5pZDsKICB9CiAgZ2V0IGN1cnJlbnRMYXllcigpIHsKICAgIHJldHVybiB0aGlzLiNhbGxMYXllcnMuZ2V0KHRoaXMuI2N1cnJlbnRQYWdlSW5kZXgpOwogIH0KICBnZXRMYXllcihwYWdlSW5kZXgpIHsKICAgIHJldHVybiB0aGlzLiNhbGxMYXllcnMuZ2V0KHBhZ2VJbmRleCk7CiAgfQogIGdldCBjdXJyZW50UGFnZUluZGV4KCkgewogICAgcmV0dXJuIHRoaXMuI2N1cnJlbnRQYWdlSW5kZXg7CiAgfQogIGFkZExheWVyKGxheWVyKSB7CiAgICB0aGlzLiNhbGxMYXllcnMuc2V0KGxheWVyLnBhZ2VJbmRleCwgbGF5ZXIpOwogICAgaWYgKHRoaXMuI2lzRW5hYmxlZCkgewogICAgICBsYXllci5lbmFibGUoKTsKICAgIH0gZWxzZSB7CiAgICAgIGxheWVyLmRpc2FibGUoKTsKICAgIH0KICB9CiAgcmVtb3ZlTGF5ZXIobGF5ZXIpIHsKICAgIHRoaXMuI2FsbExheWVycy5kZWxldGUobGF5ZXIucGFnZUluZGV4KTsKICB9CiAgYXN5bmMgdXBkYXRlTW9kZShtb2RlLCBlZGl0SWQgPSBudWxsLCBpc0Zyb21LZXlib2FyZCA9IGZhbHNlKSB7CiAgICBpZiAodGhpcy4jbW9kZSA9PT0gbW9kZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy4jdXBkYXRlTW9kZUNhcGFiaWxpdHkpIHsKICAgICAgYXdhaXQgdGhpcy4jdXBkYXRlTW9kZUNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgaWYgKCF0aGlzLiN1cGRhdGVNb2RlQ2FwYWJpbGl0eSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgdGhpcy4jdXBkYXRlTW9kZUNhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRoaXMuI2N1cnJlbnREcmF3aW5nU2Vzc2lvbj8uY29tbWl0T3JSZW1vdmUoKTsKICAgIHRoaXMuI21vZGUgPSBtb2RlOwogICAgaWYgKG1vZGUgPT09IEFubm90YXRpb25FZGl0b3JUeXBlLk5PTkUpIHsKICAgICAgdGhpcy5zZXRFZGl0aW5nU3RhdGUoZmFsc2UpOwogICAgICB0aGlzLiNkaXNhYmxlQWxsKCk7CiAgICAgIHRoaXMuX2VkaXRvclVuZG9CYXI/LmhpZGUoKTsKICAgICAgdGhpcy4jdXBkYXRlTW9kZUNhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAobW9kZSA9PT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuU0lHTkFUVVJFKSB7CiAgICAgIGF3YWl0IHRoaXMuI3NpZ25hdHVyZU1hbmFnZXI/LmxvYWRTaWduYXR1cmVzKCk7CiAgICB9CiAgICB0aGlzLnNldEVkaXRpbmdTdGF0ZSh0cnVlKTsKICAgIGF3YWl0IHRoaXMuI2VuYWJsZUFsbCgpOwogICAgdGhpcy51bnNlbGVjdEFsbCgpOwogICAgZm9yIChjb25zdCBsYXllciBvZiB0aGlzLiNhbGxMYXllcnMudmFsdWVzKCkpIHsKICAgICAgbGF5ZXIudXBkYXRlTW9kZShtb2RlKTsKICAgIH0KICAgIGlmICghZWRpdElkKSB7CiAgICAgIGlmIChpc0Zyb21LZXlib2FyZCkgewogICAgICAgIHRoaXMuYWRkTmV3RWRpdG9yRnJvbUtleWJvYXJkKCk7CiAgICAgIH0KICAgICAgdGhpcy4jdXBkYXRlTW9kZUNhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGVkaXRvciBvZiB0aGlzLiNhbGxFZGl0b3JzLnZhbHVlcygpKSB7CiAgICAgIGlmIChlZGl0b3IuYW5ub3RhdGlvbkVsZW1lbnRJZCA9PT0gZWRpdElkIHx8IGVkaXRvci5pZCA9PT0gZWRpdElkKSB7CiAgICAgICAgdGhpcy5zZXRTZWxlY3RlZChlZGl0b3IpOwogICAgICAgIGVkaXRvci5lbnRlckluRWRpdE1vZGUoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlZGl0b3IudW5zZWxlY3QoKTsKICAgICAgfQogICAgfQogICAgdGhpcy4jdXBkYXRlTW9kZUNhcGFiaWxpdHkucmVzb2x2ZSgpOwogIH0KICBhZGROZXdFZGl0b3JGcm9tS2V5Ym9hcmQoKSB7CiAgICBpZiAodGhpcy5jdXJyZW50TGF5ZXIuY2FuQ3JlYXRlTmV3RW1wdHlFZGl0b3IoKSkgewogICAgICB0aGlzLmN1cnJlbnRMYXllci5hZGROZXdFZGl0b3IoKTsKICAgIH0KICB9CiAgdXBkYXRlVG9vbGJhcihvcHRpb25zKSB7CiAgICBpZiAob3B0aW9ucy5tb2RlID09PSB0aGlzLiNtb2RlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2V2ZW50QnVzLmRpc3BhdGNoKCJzd2l0Y2hhbm5vdGF0aW9uZWRpdG9ybW9kZSIsIHsKICAgICAgc291cmNlOiB0aGlzLAogICAgICAuLi5vcHRpb25zCiAgICB9KTsKICB9CiAgdXBkYXRlUGFyYW1zKHR5cGUsIHZhbHVlKSB7CiAgICBpZiAoIXRoaXMuI2VkaXRvclR5cGVzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLkNSRUFURToKICAgICAgICB0aGlzLmN1cnJlbnRMYXllci5hZGROZXdFZGl0b3IodmFsdWUpOwogICAgICAgIHJldHVybjsKICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5ISUdITElHSFRfREVGQVVMVF9DT0xPUjoKICAgICAgICB0aGlzLiNtYWluSGlnaGxpZ2h0Q29sb3JQaWNrZXI/LnVwZGF0ZUNvbG9yKHZhbHVlKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5ISUdITElHSFRfU0hPV19BTEw6CiAgICAgICAgdGhpcy5fZXZlbnRCdXMuZGlzcGF0Y2goInJlcG9ydHRlbGVtZXRyeSIsIHsKICAgICAgICAgIHNvdXJjZTogdGhpcywKICAgICAgICAgIGRldGFpbHM6IHsKICAgICAgICAgICAgdHlwZTogImVkaXRpbmciLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgdHlwZTogImhpZ2hsaWdodCIsCiAgICAgICAgICAgICAgYWN0aW9uOiAidG9nZ2xlX3Zpc2liaWxpdHkiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAodGhpcy4jc2hvd0FsbFN0YXRlcyB8fD0gbmV3IE1hcCgpKS5zZXQodHlwZSwgdmFsdWUpOwogICAgICAgIHRoaXMuc2hvd0FsbEVkaXRvcnMoImhpZ2hsaWdodCIsIHZhbHVlKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIHRoaXMuI3NlbGVjdGVkRWRpdG9ycykgewogICAgICBlZGl0b3IudXBkYXRlUGFyYW1zKHR5cGUsIHZhbHVlKTsKICAgIH0KICAgIGZvciAoY29uc3QgZWRpdG9yVHlwZSBvZiB0aGlzLiNlZGl0b3JUeXBlcykgewogICAgICBlZGl0b3JUeXBlLnVwZGF0ZURlZmF1bHRQYXJhbXModHlwZSwgdmFsdWUpOwogICAgfQogIH0KICBzaG93QWxsRWRpdG9ycyh0eXBlLCB2aXNpYmxlLCB1cGRhdGVCdXR0b24gPSBmYWxzZSkgewogICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy4jYWxsRWRpdG9ycy52YWx1ZXMoKSkgewogICAgICBpZiAoZWRpdG9yLmVkaXRvclR5cGUgPT09IHR5cGUpIHsKICAgICAgICBlZGl0b3Iuc2hvdyh2aXNpYmxlKTsKICAgICAgfQogICAgfQogICAgY29uc3Qgc3RhdGUgPSB0aGlzLiNzaG93QWxsU3RhdGVzPy5nZXQoQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX1NIT1dfQUxMKSA/PyB0cnVlOwogICAgaWYgKHN0YXRlICE9PSB2aXNpYmxlKSB7CiAgICAgIHRoaXMuI2Rpc3BhdGNoVXBkYXRlVUkoW1tBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5ISUdITElHSFRfU0hPV19BTEwsIHZpc2libGVdXSk7CiAgICB9CiAgfQogIGVuYWJsZVdhaXRpbmcobXVzdFdhaXQgPSBmYWxzZSkgewogICAgaWYgKHRoaXMuI2lzV2FpdGluZyA9PT0gbXVzdFdhaXQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jaXNXYWl0aW5nID0gbXVzdFdhaXQ7CiAgICBmb3IgKGNvbnN0IGxheWVyIG9mIHRoaXMuI2FsbExheWVycy52YWx1ZXMoKSkgewogICAgICBpZiAobXVzdFdhaXQpIHsKICAgICAgICBsYXllci5kaXNhYmxlQ2xpY2soKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsYXllci5lbmFibGVDbGljaygpOwogICAgICB9CiAgICAgIGxheWVyLmRpdi5jbGFzc0xpc3QudG9nZ2xlKCJ3YWl0aW5nIiwgbXVzdFdhaXQpOwogICAgfQogIH0KICBhc3luYyAjZW5hYmxlQWxsKCkgewogICAgaWYgKCF0aGlzLiNpc0VuYWJsZWQpIHsKICAgICAgdGhpcy4jaXNFbmFibGVkID0gdHJ1ZTsKICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgICAgZm9yIChjb25zdCBsYXllciBvZiB0aGlzLiNhbGxMYXllcnMudmFsdWVzKCkpIHsKICAgICAgICBwcm9taXNlcy5wdXNoKGxheWVyLmVuYWJsZSgpKTsKICAgICAgfQogICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIHRoaXMuI2FsbEVkaXRvcnMudmFsdWVzKCkpIHsKICAgICAgICBlZGl0b3IuZW5hYmxlKCk7CiAgICAgIH0KICAgIH0KICB9CiAgI2Rpc2FibGVBbGwoKSB7CiAgICB0aGlzLnVuc2VsZWN0QWxsKCk7CiAgICBpZiAodGhpcy4jaXNFbmFibGVkKSB7CiAgICAgIHRoaXMuI2lzRW5hYmxlZCA9IGZhbHNlOwogICAgICBmb3IgKGNvbnN0IGxheWVyIG9mIHRoaXMuI2FsbExheWVycy52YWx1ZXMoKSkgewogICAgICAgIGxheWVyLmRpc2FibGUoKTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IGVkaXRvciBvZiB0aGlzLiNhbGxFZGl0b3JzLnZhbHVlcygpKSB7CiAgICAgICAgZWRpdG9yLmRpc2FibGUoKTsKICAgICAgfQogICAgfQogIH0KICBnZXRFZGl0b3JzKHBhZ2VJbmRleCkgewogICAgY29uc3QgZWRpdG9ycyA9IFtdOwogICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy4jYWxsRWRpdG9ycy52YWx1ZXMoKSkgewogICAgICBpZiAoZWRpdG9yLnBhZ2VJbmRleCA9PT0gcGFnZUluZGV4KSB7CiAgICAgICAgZWRpdG9ycy5wdXNoKGVkaXRvcik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlZGl0b3JzOwogIH0KICBnZXRFZGl0b3IoaWQpIHsKICAgIHJldHVybiB0aGlzLiNhbGxFZGl0b3JzLmdldChpZCk7CiAgfQogIGFkZEVkaXRvcihlZGl0b3IpIHsKICAgIHRoaXMuI2FsbEVkaXRvcnMuc2V0KGVkaXRvci5pZCwgZWRpdG9yKTsKICB9CiAgcmVtb3ZlRWRpdG9yKGVkaXRvcikgewogICAgaWYgKGVkaXRvci5kaXYuY29udGFpbnMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkpIHsKICAgICAgaWYgKHRoaXMuI2ZvY3VzTWFpbkNvbnRhaW5lclRpbWVvdXRJZCkgewogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLiNmb2N1c01haW5Db250YWluZXJUaW1lb3V0SWQpOwogICAgICB9CiAgICAgIHRoaXMuI2ZvY3VzTWFpbkNvbnRhaW5lclRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRoaXMuZm9jdXNNYWluQ29udGFpbmVyKCk7CiAgICAgICAgdGhpcy4jZm9jdXNNYWluQ29udGFpbmVyVGltZW91dElkID0gbnVsbDsKICAgICAgfSwgMCk7CiAgICB9CiAgICB0aGlzLiNhbGxFZGl0b3JzLmRlbGV0ZShlZGl0b3IuaWQpOwogICAgaWYgKGVkaXRvci5hbm5vdGF0aW9uRWxlbWVudElkKSB7CiAgICAgIHRoaXMuI21pc3NpbmdDYW52YXNlcz8uZGVsZXRlKGVkaXRvci5hbm5vdGF0aW9uRWxlbWVudElkKTsKICAgIH0KICAgIHRoaXMudW5zZWxlY3QoZWRpdG9yKTsKICAgIGlmICghZWRpdG9yLmFubm90YXRpb25FbGVtZW50SWQgfHwgIXRoaXMuI2RlbGV0ZWRBbm5vdGF0aW9uc0VsZW1lbnRJZHMuaGFzKGVkaXRvci5hbm5vdGF0aW9uRWxlbWVudElkKSkgewogICAgICB0aGlzLiNhbm5vdGF0aW9uU3RvcmFnZT8ucmVtb3ZlKGVkaXRvci5pZCk7CiAgICB9CiAgfQogIGFkZERlbGV0ZWRBbm5vdGF0aW9uRWxlbWVudChlZGl0b3IpIHsKICAgIHRoaXMuI2RlbGV0ZWRBbm5vdGF0aW9uc0VsZW1lbnRJZHMuYWRkKGVkaXRvci5hbm5vdGF0aW9uRWxlbWVudElkKTsKICAgIHRoaXMuYWRkQ2hhbmdlZEV4aXN0aW5nQW5ub3RhdGlvbihlZGl0b3IpOwogICAgZWRpdG9yLmRlbGV0ZWQgPSB0cnVlOwogIH0KICBpc0RlbGV0ZWRBbm5vdGF0aW9uRWxlbWVudChhbm5vdGF0aW9uRWxlbWVudElkKSB7CiAgICByZXR1cm4gdGhpcy4jZGVsZXRlZEFubm90YXRpb25zRWxlbWVudElkcy5oYXMoYW5ub3RhdGlvbkVsZW1lbnRJZCk7CiAgfQogIHJlbW92ZURlbGV0ZWRBbm5vdGF0aW9uRWxlbWVudChlZGl0b3IpIHsKICAgIHRoaXMuI2RlbGV0ZWRBbm5vdGF0aW9uc0VsZW1lbnRJZHMuZGVsZXRlKGVkaXRvci5hbm5vdGF0aW9uRWxlbWVudElkKTsKICAgIHRoaXMucmVtb3ZlQ2hhbmdlZEV4aXN0aW5nQW5ub3RhdGlvbihlZGl0b3IpOwogICAgZWRpdG9yLmRlbGV0ZWQgPSBmYWxzZTsKICB9CiAgI2FkZEVkaXRvclRvTGF5ZXIoZWRpdG9yKSB7CiAgICBjb25zdCBsYXllciA9IHRoaXMuI2FsbExheWVycy5nZXQoZWRpdG9yLnBhZ2VJbmRleCk7CiAgICBpZiAobGF5ZXIpIHsKICAgICAgbGF5ZXIuYWRkT3JSZWJ1aWxkKGVkaXRvcik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmFkZEVkaXRvcihlZGl0b3IpOwogICAgICB0aGlzLmFkZFRvQW5ub3RhdGlvblN0b3JhZ2UoZWRpdG9yKTsKICAgIH0KICB9CiAgc2V0QWN0aXZlRWRpdG9yKGVkaXRvcikgewogICAgaWYgKHRoaXMuI2FjdGl2ZUVkaXRvciA9PT0gZWRpdG9yKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2FjdGl2ZUVkaXRvciA9IGVkaXRvcjsKICAgIGlmIChlZGl0b3IpIHsKICAgICAgdGhpcy4jZGlzcGF0Y2hVcGRhdGVVSShlZGl0b3IucHJvcGVydGllc1RvVXBkYXRlKTsKICAgIH0KICB9CiAgZ2V0ICNsYXN0U2VsZWN0ZWRFZGl0b3IoKSB7CiAgICBsZXQgZWQgPSBudWxsOwogICAgZm9yIChlZCBvZiB0aGlzLiNzZWxlY3RlZEVkaXRvcnMpIHt9CiAgICByZXR1cm4gZWQ7CiAgfQogIHVwZGF0ZVVJKGVkaXRvcikgewogICAgaWYgKHRoaXMuI2xhc3RTZWxlY3RlZEVkaXRvciA9PT0gZWRpdG9yKSB7CiAgICAgIHRoaXMuI2Rpc3BhdGNoVXBkYXRlVUkoZWRpdG9yLnByb3BlcnRpZXNUb1VwZGF0ZSk7CiAgICB9CiAgfQogIHVwZGF0ZVVJRm9yRGVmYXVsdFByb3BlcnRpZXMoZWRpdG9yVHlwZSkgewogICAgdGhpcy4jZGlzcGF0Y2hVcGRhdGVVSShlZGl0b3JUeXBlLmRlZmF1bHRQcm9wZXJ0aWVzVG9VcGRhdGUpOwogIH0KICB0b2dnbGVTZWxlY3RlZChlZGl0b3IpIHsKICAgIGlmICh0aGlzLiNzZWxlY3RlZEVkaXRvcnMuaGFzKGVkaXRvcikpIHsKICAgICAgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzLmRlbGV0ZShlZGl0b3IpOwogICAgICBlZGl0b3IudW5zZWxlY3QoKTsKICAgICAgdGhpcy4jZGlzcGF0Y2hVcGRhdGVTdGF0ZXMoewogICAgICAgIGhhc1NlbGVjdGVkRWRpdG9yOiB0aGlzLmhhc1NlbGVjdGlvbgogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzLmFkZChlZGl0b3IpOwogICAgZWRpdG9yLnNlbGVjdCgpOwogICAgdGhpcy4jZGlzcGF0Y2hVcGRhdGVVSShlZGl0b3IucHJvcGVydGllc1RvVXBkYXRlKTsKICAgIHRoaXMuI2Rpc3BhdGNoVXBkYXRlU3RhdGVzKHsKICAgICAgaGFzU2VsZWN0ZWRFZGl0b3I6IHRydWUKICAgIH0pOwogIH0KICBzZXRTZWxlY3RlZChlZGl0b3IpIHsKICAgIHRoaXMuI2N1cnJlbnREcmF3aW5nU2Vzc2lvbj8uY29tbWl0T3JSZW1vdmUoKTsKICAgIGZvciAoY29uc3QgZWQgb2YgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzKSB7CiAgICAgIGlmIChlZCAhPT0gZWRpdG9yKSB7CiAgICAgICAgZWQudW5zZWxlY3QoKTsKICAgICAgfQogICAgfQogICAgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzLmNsZWFyKCk7CiAgICB0aGlzLiNzZWxlY3RlZEVkaXRvcnMuYWRkKGVkaXRvcik7CiAgICBlZGl0b3Iuc2VsZWN0KCk7CiAgICB0aGlzLiNkaXNwYXRjaFVwZGF0ZVVJKGVkaXRvci5wcm9wZXJ0aWVzVG9VcGRhdGUpOwogICAgdGhpcy4jZGlzcGF0Y2hVcGRhdGVTdGF0ZXMoewogICAgICBoYXNTZWxlY3RlZEVkaXRvcjogdHJ1ZQogICAgfSk7CiAgfQogIGlzU2VsZWN0ZWQoZWRpdG9yKSB7CiAgICByZXR1cm4gdGhpcy4jc2VsZWN0ZWRFZGl0b3JzLmhhcyhlZGl0b3IpOwogIH0KICBnZXQgZmlyc3RTZWxlY3RlZEVkaXRvcigpIHsKICAgIHJldHVybiB0aGlzLiNzZWxlY3RlZEVkaXRvcnMudmFsdWVzKCkubmV4dCgpLnZhbHVlOwogIH0KICB1bnNlbGVjdChlZGl0b3IpIHsKICAgIGVkaXRvci51bnNlbGVjdCgpOwogICAgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzLmRlbGV0ZShlZGl0b3IpOwogICAgdGhpcy4jZGlzcGF0Y2hVcGRhdGVTdGF0ZXMoewogICAgICBoYXNTZWxlY3RlZEVkaXRvcjogdGhpcy5oYXNTZWxlY3Rpb24KICAgIH0pOwogIH0KICBnZXQgaGFzU2VsZWN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuI3NlbGVjdGVkRWRpdG9ycy5zaXplICE9PSAwOwogIH0KICBnZXQgaXNFbnRlckhhbmRsZWQoKSB7CiAgICByZXR1cm4gdGhpcy4jc2VsZWN0ZWRFZGl0b3JzLnNpemUgPT09IDEgJiYgdGhpcy5maXJzdFNlbGVjdGVkRWRpdG9yLmlzRW50ZXJIYW5kbGVkOwogIH0KICB1bmRvKCkgewogICAgdGhpcy4jY29tbWFuZE1hbmFnZXIudW5kbygpOwogICAgdGhpcy4jZGlzcGF0Y2hVcGRhdGVTdGF0ZXMoewogICAgICBoYXNTb21ldGhpbmdUb1VuZG86IHRoaXMuI2NvbW1hbmRNYW5hZ2VyLmhhc1NvbWV0aGluZ1RvVW5kbygpLAogICAgICBoYXNTb21ldGhpbmdUb1JlZG86IHRydWUsCiAgICAgIGlzRW1wdHk6IHRoaXMuI2lzRW1wdHkoKQogICAgfSk7CiAgICB0aGlzLl9lZGl0b3JVbmRvQmFyPy5oaWRlKCk7CiAgfQogIHJlZG8oKSB7CiAgICB0aGlzLiNjb21tYW5kTWFuYWdlci5yZWRvKCk7CiAgICB0aGlzLiNkaXNwYXRjaFVwZGF0ZVN0YXRlcyh7CiAgICAgIGhhc1NvbWV0aGluZ1RvVW5kbzogdHJ1ZSwKICAgICAgaGFzU29tZXRoaW5nVG9SZWRvOiB0aGlzLiNjb21tYW5kTWFuYWdlci5oYXNTb21ldGhpbmdUb1JlZG8oKSwKICAgICAgaXNFbXB0eTogdGhpcy4jaXNFbXB0eSgpCiAgICB9KTsKICB9CiAgYWRkQ29tbWFuZHMocGFyYW1zKSB7CiAgICB0aGlzLiNjb21tYW5kTWFuYWdlci5hZGQocGFyYW1zKTsKICAgIHRoaXMuI2Rpc3BhdGNoVXBkYXRlU3RhdGVzKHsKICAgICAgaGFzU29tZXRoaW5nVG9VbmRvOiB0cnVlLAogICAgICBoYXNTb21ldGhpbmdUb1JlZG86IGZhbHNlLAogICAgICBpc0VtcHR5OiB0aGlzLiNpc0VtcHR5KCkKICAgIH0pOwogIH0KICBjbGVhblVuZG9TdGFjayh0eXBlKSB7CiAgICB0aGlzLiNjb21tYW5kTWFuYWdlci5jbGVhblR5cGUodHlwZSk7CiAgfQogICNpc0VtcHR5KCkgewogICAgaWYgKHRoaXMuI2FsbEVkaXRvcnMuc2l6ZSA9PT0gMCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLiNhbGxFZGl0b3JzLnNpemUgPT09IDEpIHsKICAgICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy4jYWxsRWRpdG9ycy52YWx1ZXMoKSkgewogICAgICAgIHJldHVybiBlZGl0b3IuaXNFbXB0eSgpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGRlbGV0ZSgpIHsKICAgIHRoaXMuY29tbWl0T3JSZW1vdmUoKTsKICAgIGNvbnN0IGRyYXdpbmdFZGl0b3IgPSB0aGlzLmN1cnJlbnRMYXllcj8uZW5kRHJhd2luZ1Nlc3Npb24odHJ1ZSk7CiAgICBpZiAoIXRoaXMuaGFzU2VsZWN0aW9uICYmICFkcmF3aW5nRWRpdG9yKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGVkaXRvcnMgPSBkcmF3aW5nRWRpdG9yID8gW2RyYXdpbmdFZGl0b3JdIDogWy4uLnRoaXMuI3NlbGVjdGVkRWRpdG9yc107CiAgICBjb25zdCBjbWQgPSAoKSA9PiB7CiAgICAgIHRoaXMuX2VkaXRvclVuZG9CYXI/LnNob3codW5kbywgZWRpdG9ycy5sZW5ndGggPT09IDEgPyBlZGl0b3JzWzBdLmVkaXRvclR5cGUgOiBlZGl0b3JzLmxlbmd0aCk7CiAgICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIGVkaXRvcnMpIHsKICAgICAgICBlZGl0b3IucmVtb3ZlKCk7CiAgICAgIH0KICAgIH07CiAgICBjb25zdCB1bmRvID0gKCkgPT4gewogICAgICBmb3IgKGNvbnN0IGVkaXRvciBvZiBlZGl0b3JzKSB7CiAgICAgICAgdGhpcy4jYWRkRWRpdG9yVG9MYXllcihlZGl0b3IpOwogICAgICB9CiAgICB9OwogICAgdGhpcy5hZGRDb21tYW5kcyh7CiAgICAgIGNtZCwKICAgICAgdW5kbywKICAgICAgbXVzdEV4ZWM6IHRydWUKICAgIH0pOwogIH0KICBjb21taXRPclJlbW92ZSgpIHsKICAgIHRoaXMuI2FjdGl2ZUVkaXRvcj8uY29tbWl0T3JSZW1vdmUoKTsKICB9CiAgaGFzU29tZXRoaW5nVG9Db250cm9sKCkgewogICAgcmV0dXJuIHRoaXMuI2FjdGl2ZUVkaXRvciB8fCB0aGlzLmhhc1NlbGVjdGlvbjsKICB9CiAgI3NlbGVjdEVkaXRvcnMoZWRpdG9ycykgewogICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzKSB7CiAgICAgIGVkaXRvci51bnNlbGVjdCgpOwogICAgfQogICAgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzLmNsZWFyKCk7CiAgICBmb3IgKGNvbnN0IGVkaXRvciBvZiBlZGl0b3JzKSB7CiAgICAgIGlmIChlZGl0b3IuaXNFbXB0eSgpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzLmFkZChlZGl0b3IpOwogICAgICBlZGl0b3Iuc2VsZWN0KCk7CiAgICB9CiAgICB0aGlzLiNkaXNwYXRjaFVwZGF0ZVN0YXRlcyh7CiAgICAgIGhhc1NlbGVjdGVkRWRpdG9yOiB0aGlzLmhhc1NlbGVjdGlvbgogICAgfSk7CiAgfQogIHNlbGVjdEFsbCgpIHsKICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIHRoaXMuI3NlbGVjdGVkRWRpdG9ycykgewogICAgICBlZGl0b3IuY29tbWl0KCk7CiAgICB9CiAgICB0aGlzLiNzZWxlY3RFZGl0b3JzKHRoaXMuI2FsbEVkaXRvcnMudmFsdWVzKCkpOwogIH0KICB1bnNlbGVjdEFsbCgpIHsKICAgIGlmICh0aGlzLiNhY3RpdmVFZGl0b3IpIHsKICAgICAgdGhpcy4jYWN0aXZlRWRpdG9yLmNvbW1pdE9yUmVtb3ZlKCk7CiAgICAgIGlmICh0aGlzLiNtb2RlICE9PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5OT05FKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy4jY3VycmVudERyYXdpbmdTZXNzaW9uPy5jb21taXRPclJlbW92ZSgpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpcy5oYXNTZWxlY3Rpb24pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzKSB7CiAgICAgIGVkaXRvci51bnNlbGVjdCgpOwogICAgfQogICAgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzLmNsZWFyKCk7CiAgICB0aGlzLiNkaXNwYXRjaFVwZGF0ZVN0YXRlcyh7CiAgICAgIGhhc1NlbGVjdGVkRWRpdG9yOiBmYWxzZQogICAgfSk7CiAgfQogIHRyYW5zbGF0ZVNlbGVjdGVkRWRpdG9ycyh4LCB5LCBub0NvbW1pdCA9IGZhbHNlKSB7CiAgICBpZiAoIW5vQ29tbWl0KSB7CiAgICAgIHRoaXMuY29tbWl0T3JSZW1vdmUoKTsKICAgIH0KICAgIGlmICghdGhpcy5oYXNTZWxlY3Rpb24pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jdHJhbnNsYXRpb25bMF0gKz0geDsKICAgIHRoaXMuI3RyYW5zbGF0aW9uWzFdICs9IHk7CiAgICBjb25zdCBbdG90YWxYLCB0b3RhbFldID0gdGhpcy4jdHJhbnNsYXRpb247CiAgICBjb25zdCBlZGl0b3JzID0gWy4uLnRoaXMuI3NlbGVjdGVkRWRpdG9yc107CiAgICBjb25zdCBUSU1FX1RPX1dBSVQgPSAxMDAwOwogICAgaWYgKHRoaXMuI3RyYW5zbGF0aW9uVGltZW91dElkKSB7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLiN0cmFuc2xhdGlvblRpbWVvdXRJZCk7CiAgICB9CiAgICB0aGlzLiN0cmFuc2xhdGlvblRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICB0aGlzLiN0cmFuc2xhdGlvblRpbWVvdXRJZCA9IG51bGw7CiAgICAgIHRoaXMuI3RyYW5zbGF0aW9uWzBdID0gdGhpcy4jdHJhbnNsYXRpb25bMV0gPSAwOwogICAgICB0aGlzLmFkZENvbW1hbmRzKHsKICAgICAgICBjbWQ6ICgpID0+IHsKICAgICAgICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIGVkaXRvcnMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuI2FsbEVkaXRvcnMuaGFzKGVkaXRvci5pZCkpIHsKICAgICAgICAgICAgICBlZGl0b3IudHJhbnNsYXRlSW5QYWdlKHRvdGFsWCwgdG90YWxZKTsKICAgICAgICAgICAgICBlZGl0b3IudHJhbnNsYXRpb25Eb25lKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHVuZG86ICgpID0+IHsKICAgICAgICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIGVkaXRvcnMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuI2FsbEVkaXRvcnMuaGFzKGVkaXRvci5pZCkpIHsKICAgICAgICAgICAgICBlZGl0b3IudHJhbnNsYXRlSW5QYWdlKC10b3RhbFgsIC10b3RhbFkpOwogICAgICAgICAgICAgIGVkaXRvci50cmFuc2xhdGlvbkRvbmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbXVzdEV4ZWM6IGZhbHNlCiAgICAgIH0pOwogICAgfSwgVElNRV9UT19XQUlUKTsKICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIGVkaXRvcnMpIHsKICAgICAgZWRpdG9yLnRyYW5zbGF0ZUluUGFnZSh4LCB5KTsKICAgICAgZWRpdG9yLnRyYW5zbGF0aW9uRG9uZSgpOwogICAgfQogIH0KICBzZXRVcERyYWdTZXNzaW9uKCkgewogICAgaWYgKCF0aGlzLmhhc1NlbGVjdGlvbikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmRpc2FibGVVc2VyU2VsZWN0KHRydWUpOwogICAgdGhpcy4jZHJhZ2dpbmdFZGl0b3JzID0gbmV3IE1hcCgpOwogICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzKSB7CiAgICAgIHRoaXMuI2RyYWdnaW5nRWRpdG9ycy5zZXQoZWRpdG9yLCB7CiAgICAgICAgc2F2ZWRYOiBlZGl0b3IueCwKICAgICAgICBzYXZlZFk6IGVkaXRvci55LAogICAgICAgIHNhdmVkUGFnZUluZGV4OiBlZGl0b3IucGFnZUluZGV4LAogICAgICAgIG5ld1g6IDAsCiAgICAgICAgbmV3WTogMCwKICAgICAgICBuZXdQYWdlSW5kZXg6IC0xCiAgICAgIH0pOwogICAgfQogIH0KICBlbmREcmFnU2Vzc2lvbigpIHsKICAgIGlmICghdGhpcy4jZHJhZ2dpbmdFZGl0b3JzKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuZGlzYWJsZVVzZXJTZWxlY3QoZmFsc2UpOwogICAgY29uc3QgbWFwID0gdGhpcy4jZHJhZ2dpbmdFZGl0b3JzOwogICAgdGhpcy4jZHJhZ2dpbmdFZGl0b3JzID0gbnVsbDsKICAgIGxldCBtdXN0QmVBZGRlZEluVW5kb1N0YWNrID0gZmFsc2U7CiAgICBmb3IgKGNvbnN0IFt7CiAgICAgIHgsCiAgICAgIHksCiAgICAgIHBhZ2VJbmRleAogICAgfSwgdmFsdWVdIG9mIG1hcCkgewogICAgICB2YWx1ZS5uZXdYID0geDsKICAgICAgdmFsdWUubmV3WSA9IHk7CiAgICAgIHZhbHVlLm5ld1BhZ2VJbmRleCA9IHBhZ2VJbmRleDsKICAgICAgbXVzdEJlQWRkZWRJblVuZG9TdGFjayB8fD0geCAhPT0gdmFsdWUuc2F2ZWRYIHx8IHkgIT09IHZhbHVlLnNhdmVkWSB8fCBwYWdlSW5kZXggIT09IHZhbHVlLnNhdmVkUGFnZUluZGV4OwogICAgfQogICAgaWYgKCFtdXN0QmVBZGRlZEluVW5kb1N0YWNrKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGNvbnN0IG1vdmUgPSAoZWRpdG9yLCB4LCB5LCBwYWdlSW5kZXgpID0+IHsKICAgICAgaWYgKHRoaXMuI2FsbEVkaXRvcnMuaGFzKGVkaXRvci5pZCkpIHsKICAgICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLiNhbGxMYXllcnMuZ2V0KHBhZ2VJbmRleCk7CiAgICAgICAgaWYgKHBhcmVudCkgewogICAgICAgICAgZWRpdG9yLl9zZXRQYXJlbnRBbmRQb3NpdGlvbihwYXJlbnQsIHgsIHkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlZGl0b3IucGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgICAgICAgZWRpdG9yLnggPSB4OwogICAgICAgICAgZWRpdG9yLnkgPSB5OwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHRoaXMuYWRkQ29tbWFuZHMoewogICAgICBjbWQ6ICgpID0+IHsKICAgICAgICBmb3IgKGNvbnN0IFtlZGl0b3IsIHsKICAgICAgICAgIG5ld1gsCiAgICAgICAgICBuZXdZLAogICAgICAgICAgbmV3UGFnZUluZGV4CiAgICAgICAgfV0gb2YgbWFwKSB7CiAgICAgICAgICBtb3ZlKGVkaXRvciwgbmV3WCwgbmV3WSwgbmV3UGFnZUluZGV4KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHVuZG86ICgpID0+IHsKICAgICAgICBmb3IgKGNvbnN0IFtlZGl0b3IsIHsKICAgICAgICAgIHNhdmVkWCwKICAgICAgICAgIHNhdmVkWSwKICAgICAgICAgIHNhdmVkUGFnZUluZGV4CiAgICAgICAgfV0gb2YgbWFwKSB7CiAgICAgICAgICBtb3ZlKGVkaXRvciwgc2F2ZWRYLCBzYXZlZFksIHNhdmVkUGFnZUluZGV4KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG11c3RFeGVjOiB0cnVlCiAgICB9KTsKICAgIHJldHVybiB0cnVlOwogIH0KICBkcmFnU2VsZWN0ZWRFZGl0b3JzKHR4LCB0eSkgewogICAgaWYgKCF0aGlzLiNkcmFnZ2luZ0VkaXRvcnMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy4jZHJhZ2dpbmdFZGl0b3JzLmtleXMoKSkgewogICAgICBlZGl0b3IuZHJhZyh0eCwgdHkpOwogICAgfQogIH0KICByZWJ1aWxkKGVkaXRvcikgewogICAgaWYgKGVkaXRvci5wYXJlbnQgPT09IG51bGwpIHsKICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5nZXRMYXllcihlZGl0b3IucGFnZUluZGV4KTsKICAgICAgaWYgKHBhcmVudCkgewogICAgICAgIHBhcmVudC5jaGFuZ2VQYXJlbnQoZWRpdG9yKTsKICAgICAgICBwYXJlbnQuYWRkT3JSZWJ1aWxkKGVkaXRvcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hZGRFZGl0b3IoZWRpdG9yKTsKICAgICAgICB0aGlzLmFkZFRvQW5ub3RhdGlvblN0b3JhZ2UoZWRpdG9yKTsKICAgICAgICBlZGl0b3IucmVidWlsZCgpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBlZGl0b3IucGFyZW50LmFkZE9yUmVidWlsZChlZGl0b3IpOwogICAgfQogIH0KICBnZXQgaXNFZGl0b3JIYW5kbGluZ0tleWJvYXJkKCkgewogICAgcmV0dXJuIHRoaXMuZ2V0QWN0aXZlKCk/LnNob3VsZEdldEtleWJvYXJkRXZlbnRzKCkgfHwgdGhpcy4jc2VsZWN0ZWRFZGl0b3JzLnNpemUgPT09IDEgJiYgdGhpcy5maXJzdFNlbGVjdGVkRWRpdG9yLnNob3VsZEdldEtleWJvYXJkRXZlbnRzKCk7CiAgfQogIGlzQWN0aXZlKGVkaXRvcikgewogICAgcmV0dXJuIHRoaXMuI2FjdGl2ZUVkaXRvciA9PT0gZWRpdG9yOwogIH0KICBnZXRBY3RpdmUoKSB7CiAgICByZXR1cm4gdGhpcy4jYWN0aXZlRWRpdG9yOwogIH0KICBnZXRNb2RlKCkgewogICAgcmV0dXJuIHRoaXMuI21vZGU7CiAgfQogIGdldCBpbWFnZU1hbmFnZXIoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpbWFnZU1hbmFnZXIiLCBuZXcgSW1hZ2VNYW5hZ2VyKCkpOwogIH0KICBnZXRTZWxlY3Rpb25Cb3hlcyh0ZXh0TGF5ZXIpIHsKICAgIGlmICghdGV4dExheWVyKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3Qgc2VsZWN0aW9uID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCk7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzZWxlY3Rpb24ucmFuZ2VDb3VudDsgaSA8IGlpOyBpKyspIHsKICAgICAgaWYgKCF0ZXh0TGF5ZXIuY29udGFpbnMoc2VsZWN0aW9uLmdldFJhbmdlQXQoaSkuY29tbW9uQW5jZXN0b3JDb250YWluZXIpKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHsKICAgICAgeDogbGF5ZXJYLAogICAgICB5OiBsYXllclksCiAgICAgIHdpZHRoOiBwYXJlbnRXaWR0aCwKICAgICAgaGVpZ2h0OiBwYXJlbnRIZWlnaHQKICAgIH0gPSB0ZXh0TGF5ZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICBsZXQgcm90YXRvcjsKICAgIHN3aXRjaCAodGV4dExheWVyLmdldEF0dHJpYnV0ZSgiZGF0YS1tYWluLXJvdGF0aW9uIikpIHsKICAgICAgY2FzZSAiOTAiOgogICAgICAgIHJvdGF0b3IgPSAoeCwgeSwgdywgaCkgPT4gKHsKICAgICAgICAgIHg6ICh5IC0gbGF5ZXJZKSAvIHBhcmVudEhlaWdodCwKICAgICAgICAgIHk6IDEgLSAoeCArIHcgLSBsYXllclgpIC8gcGFyZW50V2lkdGgsCiAgICAgICAgICB3aWR0aDogaCAvIHBhcmVudEhlaWdodCwKICAgICAgICAgIGhlaWdodDogdyAvIHBhcmVudFdpZHRoCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIjE4MCI6CiAgICAgICAgcm90YXRvciA9ICh4LCB5LCB3LCBoKSA9PiAoewogICAgICAgICAgeDogMSAtICh4ICsgdyAtIGxheWVyWCkgLyBwYXJlbnRXaWR0aCwKICAgICAgICAgIHk6IDEgLSAoeSArIGggLSBsYXllclkpIC8gcGFyZW50SGVpZ2h0LAogICAgICAgICAgd2lkdGg6IHcgLyBwYXJlbnRXaWR0aCwKICAgICAgICAgIGhlaWdodDogaCAvIHBhcmVudEhlaWdodAogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICIyNzAiOgogICAgICAgIHJvdGF0b3IgPSAoeCwgeSwgdywgaCkgPT4gKHsKICAgICAgICAgIHg6IDEgLSAoeSArIGggLSBsYXllclkpIC8gcGFyZW50SGVpZ2h0LAogICAgICAgICAgeTogKHggLSBsYXllclgpIC8gcGFyZW50V2lkdGgsCiAgICAgICAgICB3aWR0aDogaCAvIHBhcmVudEhlaWdodCwKICAgICAgICAgIGhlaWdodDogdyAvIHBhcmVudFdpZHRoCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcm90YXRvciA9ICh4LCB5LCB3LCBoKSA9PiAoewogICAgICAgICAgeDogKHggLSBsYXllclgpIC8gcGFyZW50V2lkdGgsCiAgICAgICAgICB5OiAoeSAtIGxheWVyWSkgLyBwYXJlbnRIZWlnaHQsCiAgICAgICAgICB3aWR0aDogdyAvIHBhcmVudFdpZHRoLAogICAgICAgICAgaGVpZ2h0OiBoIC8gcGFyZW50SGVpZ2h0CiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBjb25zdCBib3hlcyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc2VsZWN0aW9uLnJhbmdlQ291bnQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHJhbmdlID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoaSk7CiAgICAgIGlmIChyYW5nZS5jb2xsYXBzZWQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHksCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0gb2YgcmFuZ2UuZ2V0Q2xpZW50UmVjdHMoKSkgewogICAgICAgIGlmICh3aWR0aCA9PT0gMCB8fCBoZWlnaHQgPT09IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBib3hlcy5wdXNoKHJvdGF0b3IoeCwgeSwgd2lkdGgsIGhlaWdodCkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYm94ZXMubGVuZ3RoID09PSAwID8gbnVsbCA6IGJveGVzOwogIH0KICBhZGRDaGFuZ2VkRXhpc3RpbmdBbm5vdGF0aW9uKHsKICAgIGFubm90YXRpb25FbGVtZW50SWQsCiAgICBpZAogIH0pIHsKICAgICh0aGlzLiNjaGFuZ2VkRXhpc3RpbmdBbm5vdGF0aW9ucyB8fD0gbmV3IE1hcCgpKS5zZXQoYW5ub3RhdGlvbkVsZW1lbnRJZCwgaWQpOwogIH0KICByZW1vdmVDaGFuZ2VkRXhpc3RpbmdBbm5vdGF0aW9uKHsKICAgIGFubm90YXRpb25FbGVtZW50SWQKICB9KSB7CiAgICB0aGlzLiNjaGFuZ2VkRXhpc3RpbmdBbm5vdGF0aW9ucz8uZGVsZXRlKGFubm90YXRpb25FbGVtZW50SWQpOwogIH0KICByZW5kZXJBbm5vdGF0aW9uRWxlbWVudChhbm5vdGF0aW9uKSB7CiAgICBjb25zdCBlZGl0b3JJZCA9IHRoaXMuI2NoYW5nZWRFeGlzdGluZ0Fubm90YXRpb25zPy5nZXQoYW5ub3RhdGlvbi5kYXRhLmlkKTsKICAgIGlmICghZWRpdG9ySWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZWRpdG9yID0gdGhpcy4jYW5ub3RhdGlvblN0b3JhZ2UuZ2V0UmF3VmFsdWUoZWRpdG9ySWQpOwogICAgaWYgKCFlZGl0b3IpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuI21vZGUgPT09IEFubm90YXRpb25FZGl0b3JUeXBlLk5PTkUgJiYgIWVkaXRvci5oYXNCZWVuTW9kaWZpZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZWRpdG9yLnJlbmRlckFubm90YXRpb25FbGVtZW50KGFubm90YXRpb24pOwogIH0KICBzZXRNaXNzaW5nQ2FudmFzKGFubm90YXRpb25JZCwgYW5ub3RhdGlvbkVsZW1lbnRJZCwgY2FudmFzKSB7CiAgICBjb25zdCBlZGl0b3IgPSB0aGlzLiNtaXNzaW5nQ2FudmFzZXM/LmdldChhbm5vdGF0aW9uSWQpOwogICAgaWYgKCFlZGl0b3IpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZWRpdG9yLnNldENhbnZhcyhhbm5vdGF0aW9uRWxlbWVudElkLCBjYW52YXMpOwogICAgdGhpcy4jbWlzc2luZ0NhbnZhc2VzLmRlbGV0ZShhbm5vdGF0aW9uSWQpOwogIH0KICBhZGRNaXNzaW5nQ2FudmFzKGFubm90YXRpb25JZCwgZWRpdG9yKSB7CiAgICAodGhpcy4jbWlzc2luZ0NhbnZhc2VzIHx8PSBuZXcgTWFwKCkpLnNldChhbm5vdGF0aW9uSWQsIGVkaXRvcik7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9lZGl0b3IvYWx0X3RleHQuanMKCmNsYXNzIEFsdFRleHQgewogICNhbHRUZXh0ID0gbnVsbDsKICAjYWx0VGV4dERlY29yYXRpdmUgPSBmYWxzZTsKICAjYWx0VGV4dEJ1dHRvbiA9IG51bGw7CiAgI2FsdFRleHRCdXR0b25MYWJlbCA9IG51bGw7CiAgI2FsdFRleHRUb29sdGlwID0gbnVsbDsKICAjYWx0VGV4dFRvb2x0aXBUaW1lb3V0ID0gbnVsbDsKICAjYWx0VGV4dFdhc0Zyb21LZXlCb2FyZCA9IGZhbHNlOwogICNiYWRnZSA9IG51bGw7CiAgI2VkaXRvciA9IG51bGw7CiAgI2d1ZXNzZWRUZXh0ID0gbnVsbDsKICAjdGV4dFdpdGhEaXNjbGFpbWVyID0gbnVsbDsKICAjdXNlTmV3QWx0VGV4dEZsb3cgPSBmYWxzZTsKICBzdGF0aWMgI2wxMG5OZXdCdXR0b24gPSBudWxsOwogIHN0YXRpYyBfbDEwbiA9IG51bGw7CiAgY29uc3RydWN0b3IoZWRpdG9yKSB7CiAgICB0aGlzLiNlZGl0b3IgPSBlZGl0b3I7CiAgICB0aGlzLiN1c2VOZXdBbHRUZXh0RmxvdyA9IGVkaXRvci5fdWlNYW5hZ2VyLnVzZU5ld0FsdFRleHRGbG93OwogICAgQWx0VGV4dC4jbDEwbk5ld0J1dHRvbiB8fD0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgIGFkZGVkOiAicGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1hZGRlZC1idXR0b24iLAogICAgICAiYWRkZWQtbGFiZWwiOiAicGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1hZGRlZC1idXR0b24tbGFiZWwiLAogICAgICBtaXNzaW5nOiAicGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1taXNzaW5nLWJ1dHRvbiIsCiAgICAgICJtaXNzaW5nLWxhYmVsIjogInBkZmpzLWVkaXRvci1uZXctYWx0LXRleHQtbWlzc2luZy1idXR0b24tbGFiZWwiLAogICAgICByZXZpZXc6ICJwZGZqcy1lZGl0b3ItbmV3LWFsdC10ZXh0LXRvLXJldmlldy1idXR0b24iLAogICAgICAicmV2aWV3LWxhYmVsIjogInBkZmpzLWVkaXRvci1uZXctYWx0LXRleHQtdG8tcmV2aWV3LWJ1dHRvbi1sYWJlbCIKICAgIH0pOwogIH0KICBzdGF0aWMgaW5pdGlhbGl6ZShsMTBuKSB7CiAgICBBbHRUZXh0Ll9sMTBuID8/PSBsMTBuOwogIH0KICBhc3luYyByZW5kZXIoKSB7CiAgICBjb25zdCBhbHRUZXh0ID0gdGhpcy4jYWx0VGV4dEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgYWx0VGV4dC5jbGFzc05hbWUgPSAiYWx0VGV4dCI7CiAgICBhbHRUZXh0LnRhYkluZGV4ID0gIjAiOwogICAgY29uc3QgbGFiZWwgPSB0aGlzLiNhbHRUZXh0QnV0dG9uTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICBhbHRUZXh0LmFwcGVuZChsYWJlbCk7CiAgICBpZiAodGhpcy4jdXNlTmV3QWx0VGV4dEZsb3cpIHsKICAgICAgYWx0VGV4dC5jbGFzc0xpc3QuYWRkKCJuZXciKTsKICAgICAgYWx0VGV4dC5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsIEFsdFRleHQuI2wxMG5OZXdCdXR0b24ubWlzc2luZyk7CiAgICAgIGxhYmVsLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgQWx0VGV4dC4jbDEwbk5ld0J1dHRvblsibWlzc2luZy1sYWJlbCJdKTsKICAgIH0gZWxzZSB7CiAgICAgIGFsdFRleHQuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCAicGRmanMtZWRpdG9yLWFsdC10ZXh0LWJ1dHRvbiIpOwogICAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsICJwZGZqcy1lZGl0b3ItYWx0LXRleHQtYnV0dG9uLWxhYmVsIik7CiAgICB9CiAgICBjb25zdCBzaWduYWwgPSB0aGlzLiNlZGl0b3IuX3VpTWFuYWdlci5fc2lnbmFsOwogICAgYWx0VGV4dC5hZGRFdmVudExpc3RlbmVyKCJjb250ZXh0bWVudSIsIG5vQ29udGV4dE1lbnUsIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGFsdFRleHQuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBldmVudCA9PiBldmVudC5zdG9wUHJvcGFnYXRpb24oKSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgY29uc3Qgb25DbGljayA9IGV2ZW50ID0+IHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdGhpcy4jZWRpdG9yLl91aU1hbmFnZXIuZWRpdEFsdFRleHQodGhpcy4jZWRpdG9yKTsKICAgICAgaWYgKHRoaXMuI3VzZU5ld0FsdFRleHRGbG93KSB7CiAgICAgICAgdGhpcy4jZWRpdG9yLl9yZXBvcnRUZWxlbWV0cnkoewogICAgICAgICAgYWN0aW9uOiAicGRmanMuaW1hZ2UuYWx0X3RleHQuaW1hZ2Vfc3RhdHVzX2xhYmVsX2NsaWNrZWQiLAogICAgICAgICAgZGF0YTogewogICAgICAgICAgICBsYWJlbDogdGhpcy4jbGFiZWwKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfTsKICAgIGFsdFRleHQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBvbkNsaWNrLCB7CiAgICAgIGNhcHR1cmU6IHRydWUsCiAgICAgIHNpZ25hbAogICAgfSk7CiAgICBhbHRUZXh0LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBldmVudCA9PiB7CiAgICAgIGlmIChldmVudC50YXJnZXQgPT09IGFsdFRleHQgJiYgZXZlbnQua2V5ID09PSAiRW50ZXIiKSB7CiAgICAgICAgdGhpcy4jYWx0VGV4dFdhc0Zyb21LZXlCb2FyZCA9IHRydWU7CiAgICAgICAgb25DbGljayhldmVudCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGF3YWl0IHRoaXMuI3NldFN0YXRlKCk7CiAgICByZXR1cm4gYWx0VGV4dDsKICB9CiAgZ2V0ICNsYWJlbCgpIHsKICAgIHJldHVybiB0aGlzLiNhbHRUZXh0ICYmICJhZGRlZCIgfHwgdGhpcy4jYWx0VGV4dCA9PT0gbnVsbCAmJiB0aGlzLmd1ZXNzZWRUZXh0ICYmICJyZXZpZXciIHx8ICJtaXNzaW5nIjsKICB9CiAgZmluaXNoKCkgewogICAgaWYgKCF0aGlzLiNhbHRUZXh0QnV0dG9uKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2FsdFRleHRCdXR0b24uZm9jdXMoewogICAgICBmb2N1c1Zpc2libGU6IHRoaXMuI2FsdFRleHRXYXNGcm9tS2V5Qm9hcmQKICAgIH0pOwogICAgdGhpcy4jYWx0VGV4dFdhc0Zyb21LZXlCb2FyZCA9IGZhbHNlOwogIH0KICBpc0VtcHR5KCkgewogICAgaWYgKHRoaXMuI3VzZU5ld0FsdFRleHRGbG93KSB7CiAgICAgIHJldHVybiB0aGlzLiNhbHRUZXh0ID09PSBudWxsOwogICAgfQogICAgcmV0dXJuICF0aGlzLiNhbHRUZXh0ICYmICF0aGlzLiNhbHRUZXh0RGVjb3JhdGl2ZTsKICB9CiAgaGFzRGF0YSgpIHsKICAgIGlmICh0aGlzLiN1c2VOZXdBbHRUZXh0RmxvdykgewogICAgICByZXR1cm4gdGhpcy4jYWx0VGV4dCAhPT0gbnVsbCB8fCAhIXRoaXMuI2d1ZXNzZWRUZXh0OwogICAgfQogICAgcmV0dXJuIHRoaXMuaXNFbXB0eSgpOwogIH0KICBnZXQgZ3Vlc3NlZFRleHQoKSB7CiAgICByZXR1cm4gdGhpcy4jZ3Vlc3NlZFRleHQ7CiAgfQogIGFzeW5jIHNldEd1ZXNzZWRUZXh0KGd1ZXNzZWRUZXh0KSB7CiAgICBpZiAodGhpcy4jYWx0VGV4dCAhPT0gbnVsbCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNndWVzc2VkVGV4dCA9IGd1ZXNzZWRUZXh0OwogICAgdGhpcy4jdGV4dFdpdGhEaXNjbGFpbWVyID0gYXdhaXQgQWx0VGV4dC5fbDEwbi5nZXQoInBkZmpzLWVkaXRvci1uZXctYWx0LXRleHQtZ2VuZXJhdGVkLWFsdC10ZXh0LXdpdGgtZGlzY2xhaW1lciIsIHsKICAgICAgZ2VuZXJhdGVkQWx0VGV4dDogZ3Vlc3NlZFRleHQKICAgIH0pOwogICAgdGhpcy4jc2V0U3RhdGUoKTsKICB9CiAgdG9nZ2xlQWx0VGV4dEJhZGdlKHZpc2liaWxpdHkgPSBmYWxzZSkgewogICAgaWYgKCF0aGlzLiN1c2VOZXdBbHRUZXh0RmxvdyB8fCB0aGlzLiNhbHRUZXh0KSB7CiAgICAgIHRoaXMuI2JhZGdlPy5yZW1vdmUoKTsKICAgICAgdGhpcy4jYmFkZ2UgPSBudWxsOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXMuI2JhZGdlKSB7CiAgICAgIGNvbnN0IGJhZGdlID0gdGhpcy4jYmFkZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgYmFkZ2UuY2xhc3NOYW1lID0gIm5vQWx0VGV4dEJhZGdlIjsKICAgICAgdGhpcy4jZWRpdG9yLmRpdi5hcHBlbmQoYmFkZ2UpOwogICAgfQogICAgdGhpcy4jYmFkZ2UuY2xhc3NMaXN0LnRvZ2dsZSgiaGlkZGVuIiwgIXZpc2liaWxpdHkpOwogIH0KICBzZXJpYWxpemUoaXNGb3JDb3B5aW5nKSB7CiAgICBsZXQgYWx0VGV4dCA9IHRoaXMuI2FsdFRleHQ7CiAgICBpZiAoIWlzRm9yQ29weWluZyAmJiB0aGlzLiNndWVzc2VkVGV4dCA9PT0gYWx0VGV4dCkgewogICAgICBhbHRUZXh0ID0gdGhpcy4jdGV4dFdpdGhEaXNjbGFpbWVyOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgYWx0VGV4dCwKICAgICAgZGVjb3JhdGl2ZTogdGhpcy4jYWx0VGV4dERlY29yYXRpdmUsCiAgICAgIGd1ZXNzZWRUZXh0OiB0aGlzLiNndWVzc2VkVGV4dCwKICAgICAgdGV4dFdpdGhEaXNjbGFpbWVyOiB0aGlzLiN0ZXh0V2l0aERpc2NsYWltZXIKICAgIH07CiAgfQogIGdldCBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgYWx0VGV4dDogdGhpcy4jYWx0VGV4dCwKICAgICAgZGVjb3JhdGl2ZTogdGhpcy4jYWx0VGV4dERlY29yYXRpdmUKICAgIH07CiAgfQogIHNldCBkYXRhKHsKICAgIGFsdFRleHQsCiAgICBkZWNvcmF0aXZlLAogICAgZ3Vlc3NlZFRleHQsCiAgICB0ZXh0V2l0aERpc2NsYWltZXIsCiAgICBjYW5jZWwgPSBmYWxzZQogIH0pIHsKICAgIGlmIChndWVzc2VkVGV4dCkgewogICAgICB0aGlzLiNndWVzc2VkVGV4dCA9IGd1ZXNzZWRUZXh0OwogICAgICB0aGlzLiN0ZXh0V2l0aERpc2NsYWltZXIgPSB0ZXh0V2l0aERpc2NsYWltZXI7CiAgICB9CiAgICBpZiAodGhpcy4jYWx0VGV4dCA9PT0gYWx0VGV4dCAmJiB0aGlzLiNhbHRUZXh0RGVjb3JhdGl2ZSA9PT0gZGVjb3JhdGl2ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIWNhbmNlbCkgewogICAgICB0aGlzLiNhbHRUZXh0ID0gYWx0VGV4dDsKICAgICAgdGhpcy4jYWx0VGV4dERlY29yYXRpdmUgPSBkZWNvcmF0aXZlOwogICAgfQogICAgdGhpcy4jc2V0U3RhdGUoKTsKICB9CiAgdG9nZ2xlKGVuYWJsZWQgPSBmYWxzZSkgewogICAgaWYgKCF0aGlzLiNhbHRUZXh0QnV0dG9uKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghZW5hYmxlZCAmJiB0aGlzLiNhbHRUZXh0VG9vbHRpcFRpbWVvdXQpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuI2FsdFRleHRUb29sdGlwVGltZW91dCk7CiAgICAgIHRoaXMuI2FsdFRleHRUb29sdGlwVGltZW91dCA9IG51bGw7CiAgICB9CiAgICB0aGlzLiNhbHRUZXh0QnV0dG9uLmRpc2FibGVkID0gIWVuYWJsZWQ7CiAgfQogIHNob3duKCkgewogICAgdGhpcy4jZWRpdG9yLl9yZXBvcnRUZWxlbWV0cnkoewogICAgICBhY3Rpb246ICJwZGZqcy5pbWFnZS5hbHRfdGV4dC5pbWFnZV9zdGF0dXNfbGFiZWxfZGlzcGxheWVkIiwKICAgICAgZGF0YTogewogICAgICAgIGxhYmVsOiB0aGlzLiNsYWJlbAogICAgICB9CiAgICB9KTsKICB9CiAgZGVzdHJveSgpIHsKICAgIHRoaXMuI2FsdFRleHRCdXR0b24/LnJlbW92ZSgpOwogICAgdGhpcy4jYWx0VGV4dEJ1dHRvbiA9IG51bGw7CiAgICB0aGlzLiNhbHRUZXh0QnV0dG9uTGFiZWwgPSBudWxsOwogICAgdGhpcy4jYWx0VGV4dFRvb2x0aXAgPSBudWxsOwogICAgdGhpcy4jYmFkZ2U/LnJlbW92ZSgpOwogICAgdGhpcy4jYmFkZ2UgPSBudWxsOwogIH0KICBhc3luYyAjc2V0U3RhdGUoKSB7CiAgICBjb25zdCBidXR0b24gPSB0aGlzLiNhbHRUZXh0QnV0dG9uOwogICAgaWYgKCFidXR0b24pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuI3VzZU5ld0FsdFRleHRGbG93KSB7CiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJkb25lIiwgISF0aGlzLiNhbHRUZXh0KTsKICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgQWx0VGV4dC4jbDEwbk5ld0J1dHRvblt0aGlzLiNsYWJlbF0pOwogICAgICB0aGlzLiNhbHRUZXh0QnV0dG9uTGFiZWw/LnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgQWx0VGV4dC4jbDEwbk5ld0J1dHRvbltgJHt0aGlzLiNsYWJlbH0tbGFiZWxgXSk7CiAgICAgIGlmICghdGhpcy4jYWx0VGV4dCkgewogICAgICAgIHRoaXMuI2FsdFRleHRUb29sdGlwPy5yZW1vdmUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmICghdGhpcy4jYWx0VGV4dCAmJiAhdGhpcy4jYWx0VGV4dERlY29yYXRpdmUpIHsKICAgICAgICBidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgiZG9uZSIpOwogICAgICAgIHRoaXMuI2FsdFRleHRUb29sdGlwPy5yZW1vdmUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoImRvbmUiKTsKICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgInBkZmpzLWVkaXRvci1hbHQtdGV4dC1lZGl0LWJ1dHRvbiIpOwogICAgfQogICAgbGV0IHRvb2x0aXAgPSB0aGlzLiNhbHRUZXh0VG9vbHRpcDsKICAgIGlmICghdG9vbHRpcCkgewogICAgICB0aGlzLiNhbHRUZXh0VG9vbHRpcCA9IHRvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICAgIHRvb2x0aXAuY2xhc3NOYW1lID0gInRvb2x0aXAiOwogICAgICB0b29sdGlwLnNldEF0dHJpYnV0ZSgicm9sZSIsICJ0b29sdGlwIik7CiAgICAgIHRvb2x0aXAuaWQgPSBgYWx0LXRleHQtdG9vbHRpcC0ke3RoaXMuI2VkaXRvci5pZH1gOwogICAgICBjb25zdCBERUxBWV9UT19TSE9XX1RPT0xUSVAgPSAxMDA7CiAgICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuI2VkaXRvci5fdWlNYW5hZ2VyLl9zaWduYWw7CiAgICAgIHNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsICgpID0+IHsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy4jYWx0VGV4dFRvb2x0aXBUaW1lb3V0KTsKICAgICAgICB0aGlzLiNhbHRUZXh0VG9vbHRpcFRpbWVvdXQgPSBudWxsOwogICAgICB9LCB7CiAgICAgICAgb25jZTogdHJ1ZQogICAgICB9KTsKICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZW50ZXIiLCAoKSA9PiB7CiAgICAgICAgdGhpcy4jYWx0VGV4dFRvb2x0aXBUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICB0aGlzLiNhbHRUZXh0VG9vbHRpcFRpbWVvdXQgPSBudWxsOwogICAgICAgICAgdGhpcy4jYWx0VGV4dFRvb2x0aXAuY2xhc3NMaXN0LmFkZCgic2hvdyIpOwogICAgICAgICAgdGhpcy4jZWRpdG9yLl9yZXBvcnRUZWxlbWV0cnkoewogICAgICAgICAgICBhY3Rpb246ICJhbHRfdGV4dF90b29sdGlwIgogICAgICAgICAgfSk7CiAgICAgICAgfSwgREVMQVlfVE9fU0hPV19UT09MVElQKTsKICAgICAgfSwgewogICAgICAgIHNpZ25hbAogICAgICB9KTsKICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbGVhdmUiLCAoKSA9PiB7CiAgICAgICAgaWYgKHRoaXMuI2FsdFRleHRUb29sdGlwVGltZW91dCkgewogICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuI2FsdFRleHRUb29sdGlwVGltZW91dCk7CiAgICAgICAgICB0aGlzLiNhbHRUZXh0VG9vbHRpcFRpbWVvdXQgPSBudWxsOwogICAgICAgIH0KICAgICAgICB0aGlzLiNhbHRUZXh0VG9vbHRpcD8uY2xhc3NMaXN0LnJlbW92ZSgic2hvdyIpOwogICAgICB9LCB7CiAgICAgICAgc2lnbmFsCiAgICAgIH0pOwogICAgfQogICAgaWYgKHRoaXMuI2FsdFRleHREZWNvcmF0aXZlKSB7CiAgICAgIHRvb2x0aXAuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCAicGRmanMtZWRpdG9yLWFsdC10ZXh0LWRlY29yYXRpdmUtdG9vbHRpcCIpOwogICAgfSBlbHNlIHsKICAgICAgdG9vbHRpcC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIpOwogICAgICB0b29sdGlwLnRleHRDb250ZW50ID0gdGhpcy4jYWx0VGV4dDsKICAgIH0KICAgIGlmICghdG9vbHRpcC5wYXJlbnROb2RlKSB7CiAgICAgIGJ1dHRvbi5hcHBlbmQodG9vbHRpcCk7CiAgICB9CiAgICBjb25zdCBlbGVtZW50ID0gdGhpcy4jZWRpdG9yLmdldEVsZW1lbnRGb3JBbHRUZXh0KCk7CiAgICBlbGVtZW50Py5zZXRBdHRyaWJ1dGUoImFyaWEtZGVzY3JpYmVkYnkiLCB0b29sdGlwLmlkKTsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L3RvdWNoX21hbmFnZXIuanMKCmNsYXNzIFRvdWNoTWFuYWdlciB7CiAgI2NvbnRhaW5lcjsKICAjaXNQaW5jaGluZyA9IGZhbHNlOwogICNpc1BpbmNoaW5nU3RvcHBlZCA9IG51bGw7CiAgI2lzUGluY2hpbmdEaXNhYmxlZDsKICAjb25QaW5jaFN0YXJ0OwogICNvblBpbmNoaW5nOwogICNvblBpbmNoRW5kOwogICNwb2ludGVyRG93bkFDID0gbnVsbDsKICAjc2lnbmFsOwogICN0b3VjaEluZm8gPSBudWxsOwogICN0b3VjaE1hbmFnZXJBQzsKICAjdG91Y2hNb3ZlQUMgPSBudWxsOwogIGNvbnN0cnVjdG9yKHsKICAgIGNvbnRhaW5lciwKICAgIGlzUGluY2hpbmdEaXNhYmxlZCA9IG51bGwsCiAgICBpc1BpbmNoaW5nU3RvcHBlZCA9IG51bGwsCiAgICBvblBpbmNoU3RhcnQgPSBudWxsLAogICAgb25QaW5jaGluZyA9IG51bGwsCiAgICBvblBpbmNoRW5kID0gbnVsbCwKICAgIHNpZ25hbAogIH0pIHsKICAgIHRoaXMuI2NvbnRhaW5lciA9IGNvbnRhaW5lcjsKICAgIHRoaXMuI2lzUGluY2hpbmdTdG9wcGVkID0gaXNQaW5jaGluZ1N0b3BwZWQ7CiAgICB0aGlzLiNpc1BpbmNoaW5nRGlzYWJsZWQgPSBpc1BpbmNoaW5nRGlzYWJsZWQ7CiAgICB0aGlzLiNvblBpbmNoU3RhcnQgPSBvblBpbmNoU3RhcnQ7CiAgICB0aGlzLiNvblBpbmNoaW5nID0gb25QaW5jaGluZzsKICAgIHRoaXMuI29uUGluY2hFbmQgPSBvblBpbmNoRW5kOwogICAgdGhpcy4jdG91Y2hNYW5hZ2VyQUMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICB0aGlzLiNzaWduYWwgPSBBYm9ydFNpZ25hbC5hbnkoW3NpZ25hbCwgdGhpcy4jdG91Y2hNYW5hZ2VyQUMuc2lnbmFsXSk7CiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hzdGFydCIsIHRoaXMuI29uVG91Y2hTdGFydC5iaW5kKHRoaXMpLCB7CiAgICAgIHBhc3NpdmU6IGZhbHNlLAogICAgICBzaWduYWw6IHRoaXMuI3NpZ25hbAogICAgfSk7CiAgfQogIGdldCBNSU5fVE9VQ0hfRElTVEFOQ0VfVE9fUElOQ0goKSB7CiAgICByZXR1cm4gMzUgLyBPdXRwdXRTY2FsZS5waXhlbFJhdGlvOwogIH0KICAjb25Ub3VjaFN0YXJ0KGV2dCkgewogICAgaWYgKHRoaXMuI2lzUGluY2hpbmdEaXNhYmxlZD8uKCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGV2dC50b3VjaGVzLmxlbmd0aCA9PT0gMSkgewogICAgICBpZiAodGhpcy4jcG9pbnRlckRvd25BQykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBwb2ludGVyRG93bkFDID0gdGhpcy4jcG9pbnRlckRvd25BQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgICAgY29uc3Qgc2lnbmFsID0gQWJvcnRTaWduYWwuYW55KFt0aGlzLiNzaWduYWwsIHBvaW50ZXJEb3duQUMuc2lnbmFsXSk7CiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuI2NvbnRhaW5lcjsKICAgICAgY29uc3Qgb3B0cyA9IHsKICAgICAgICBjYXB0dXJlOiB0cnVlLAogICAgICAgIHNpZ25hbCwKICAgICAgICBwYXNzaXZlOiBmYWxzZQogICAgICB9OwogICAgICBjb25zdCBjYW5jZWxQb2ludGVyRG93biA9IGUgPT4gewogICAgICAgIGlmIChlLnBvaW50ZXJUeXBlID09PSAidG91Y2giKSB7CiAgICAgICAgICB0aGlzLiNwb2ludGVyRG93bkFDPy5hYm9ydCgpOwogICAgICAgICAgdGhpcy4jcG9pbnRlckRvd25BQyA9IG51bGw7CiAgICAgICAgfQogICAgICB9OwogICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBlID0+IHsKICAgICAgICBpZiAoZS5wb2ludGVyVHlwZSA9PT0gInRvdWNoIikgewogICAgICAgICAgc3RvcEV2ZW50KGUpOwogICAgICAgICAgY2FuY2VsUG9pbnRlckRvd24oZSk7CiAgICAgICAgfQogICAgICB9LCBvcHRzKTsKICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIGNhbmNlbFBvaW50ZXJEb3duLCBvcHRzKTsKICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJjYW5jZWwiLCBjYW5jZWxQb2ludGVyRG93biwgb3B0cyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpcy4jdG91Y2hNb3ZlQUMpIHsKICAgICAgdGhpcy4jdG91Y2hNb3ZlQUMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICAgIGNvbnN0IHNpZ25hbCA9IEFib3J0U2lnbmFsLmFueShbdGhpcy4jc2lnbmFsLCB0aGlzLiN0b3VjaE1vdmVBQy5zaWduYWxdKTsKICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy4jY29udGFpbmVyOwogICAgICBjb25zdCBvcHQgPSB7CiAgICAgICAgc2lnbmFsLAogICAgICAgIGNhcHR1cmU6IGZhbHNlLAogICAgICAgIHBhc3NpdmU6IGZhbHNlCiAgICAgIH07CiAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaG1vdmUiLCB0aGlzLiNvblRvdWNoTW92ZS5iaW5kKHRoaXMpLCBvcHQpOwogICAgICBjb25zdCBvblRvdWNoRW5kID0gdGhpcy4jb25Ub3VjaEVuZC5iaW5kKHRoaXMpOwogICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hlbmQiLCBvblRvdWNoRW5kLCBvcHQpOwogICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hjYW5jZWwiLCBvblRvdWNoRW5kLCBvcHQpOwogICAgICBvcHQuY2FwdHVyZSA9IHRydWU7CiAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIHN0b3BFdmVudCwgb3B0KTsKICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgc3RvcEV2ZW50LCBvcHQpOwogICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmNhbmNlbCIsIHN0b3BFdmVudCwgb3B0KTsKICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIHN0b3BFdmVudCwgb3B0KTsKICAgICAgdGhpcy4jb25QaW5jaFN0YXJ0Py4oKTsKICAgIH0KICAgIHN0b3BFdmVudChldnQpOwogICAgaWYgKGV2dC50b3VjaGVzLmxlbmd0aCAhPT0gMiB8fCB0aGlzLiNpc1BpbmNoaW5nU3RvcHBlZD8uKCkpIHsKICAgICAgdGhpcy4jdG91Y2hJbmZvID0gbnVsbDsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IFt0b3VjaDAsIHRvdWNoMV0gPSBldnQudG91Y2hlczsKICAgIGlmICh0b3VjaDAuaWRlbnRpZmllciA+IHRvdWNoMS5pZGVudGlmaWVyKSB7CiAgICAgIFt0b3VjaDAsIHRvdWNoMV0gPSBbdG91Y2gxLCB0b3VjaDBdOwogICAgfQogICAgdGhpcy4jdG91Y2hJbmZvID0gewogICAgICB0b3VjaDBYOiB0b3VjaDAuc2NyZWVuWCwKICAgICAgdG91Y2gwWTogdG91Y2gwLnNjcmVlblksCiAgICAgIHRvdWNoMVg6IHRvdWNoMS5zY3JlZW5YLAogICAgICB0b3VjaDFZOiB0b3VjaDEuc2NyZWVuWQogICAgfTsKICB9CiAgI29uVG91Y2hNb3ZlKGV2dCkgewogICAgaWYgKCF0aGlzLiN0b3VjaEluZm8gfHwgZXZ0LnRvdWNoZXMubGVuZ3RoICE9PSAyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN0b3BFdmVudChldnQpOwogICAgbGV0IFt0b3VjaDAsIHRvdWNoMV0gPSBldnQudG91Y2hlczsKICAgIGlmICh0b3VjaDAuaWRlbnRpZmllciA+IHRvdWNoMS5pZGVudGlmaWVyKSB7CiAgICAgIFt0b3VjaDAsIHRvdWNoMV0gPSBbdG91Y2gxLCB0b3VjaDBdOwogICAgfQogICAgY29uc3QgewogICAgICBzY3JlZW5YOiBzY3JlZW4wWCwKICAgICAgc2NyZWVuWTogc2NyZWVuMFkKICAgIH0gPSB0b3VjaDA7CiAgICBjb25zdCB7CiAgICAgIHNjcmVlblg6IHNjcmVlbjFYLAogICAgICBzY3JlZW5ZOiBzY3JlZW4xWQogICAgfSA9IHRvdWNoMTsKICAgIGNvbnN0IHRvdWNoSW5mbyA9IHRoaXMuI3RvdWNoSW5mbzsKICAgIGNvbnN0IHsKICAgICAgdG91Y2gwWDogcFRvdWNoMFgsCiAgICAgIHRvdWNoMFk6IHBUb3VjaDBZLAogICAgICB0b3VjaDFYOiBwVG91Y2gxWCwKICAgICAgdG91Y2gxWTogcFRvdWNoMVkKICAgIH0gPSB0b3VjaEluZm87CiAgICBjb25zdCBwcmV2R2FwWCA9IHBUb3VjaDFYIC0gcFRvdWNoMFg7CiAgICBjb25zdCBwcmV2R2FwWSA9IHBUb3VjaDFZIC0gcFRvdWNoMFk7CiAgICBjb25zdCBjdXJyR2FwWCA9IHNjcmVlbjFYIC0gc2NyZWVuMFg7CiAgICBjb25zdCBjdXJyR2FwWSA9IHNjcmVlbjFZIC0gc2NyZWVuMFk7CiAgICBjb25zdCBkaXN0YW5jZSA9IE1hdGguaHlwb3QoY3VyckdhcFgsIGN1cnJHYXBZKSB8fCAxOwogICAgY29uc3QgcERpc3RhbmNlID0gTWF0aC5oeXBvdChwcmV2R2FwWCwgcHJldkdhcFkpIHx8IDE7CiAgICBpZiAoIXRoaXMuI2lzUGluY2hpbmcgJiYgTWF0aC5hYnMocERpc3RhbmNlIC0gZGlzdGFuY2UpIDw9IFRvdWNoTWFuYWdlci5NSU5fVE9VQ0hfRElTVEFOQ0VfVE9fUElOQ0gpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdG91Y2hJbmZvLnRvdWNoMFggPSBzY3JlZW4wWDsKICAgIHRvdWNoSW5mby50b3VjaDBZID0gc2NyZWVuMFk7CiAgICB0b3VjaEluZm8udG91Y2gxWCA9IHNjcmVlbjFYOwogICAgdG91Y2hJbmZvLnRvdWNoMVkgPSBzY3JlZW4xWTsKICAgIGlmICghdGhpcy4jaXNQaW5jaGluZykgewogICAgICB0aGlzLiNpc1BpbmNoaW5nID0gdHJ1ZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgb3JpZ2luID0gWyhzY3JlZW4wWCArIHNjcmVlbjFYKSAvIDIsIChzY3JlZW4wWSArIHNjcmVlbjFZKSAvIDJdOwogICAgdGhpcy4jb25QaW5jaGluZz8uKG9yaWdpbiwgcERpc3RhbmNlLCBkaXN0YW5jZSk7CiAgfQogICNvblRvdWNoRW5kKGV2dCkgewogICAgaWYgKGV2dC50b3VjaGVzLmxlbmd0aCA+PSAyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLiN0b3VjaE1vdmVBQykgewogICAgICB0aGlzLiN0b3VjaE1vdmVBQy5hYm9ydCgpOwogICAgICB0aGlzLiN0b3VjaE1vdmVBQyA9IG51bGw7CiAgICAgIHRoaXMuI29uUGluY2hFbmQ/LigpOwogICAgfQogICAgaWYgKCF0aGlzLiN0b3VjaEluZm8pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3RvcEV2ZW50KGV2dCk7CiAgICB0aGlzLiN0b3VjaEluZm8gPSBudWxsOwogICAgdGhpcy4jaXNQaW5jaGluZyA9IGZhbHNlOwogIH0KICBkZXN0cm95KCkgewogICAgdGhpcy4jdG91Y2hNYW5hZ2VyQUM/LmFib3J0KCk7CiAgICB0aGlzLiN0b3VjaE1hbmFnZXJBQyA9IG51bGw7CiAgICB0aGlzLiNwb2ludGVyRG93bkFDPy5hYm9ydCgpOwogICAgdGhpcy4jcG9pbnRlckRvd25BQyA9IG51bGw7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9lZGl0b3IvZWRpdG9yLmpzCgoKCgoKCmNsYXNzIEFubm90YXRpb25FZGl0b3IgewogICNhY2Nlc3NpYmlsaXR5RGF0YSA9IG51bGw7CiAgI2FsbFJlc2l6ZXJEaXZzID0gbnVsbDsKICAjYWx0VGV4dCA9IG51bGw7CiAgI2Rpc2FibGVkID0gZmFsc2U7CiAgI2RyYWdQb2ludGVySWQgPSBudWxsOwogICNkcmFnUG9pbnRlclR5cGUgPSAiIjsKICAja2VlcEFzcGVjdFJhdGlvID0gZmFsc2U7CiAgI3Jlc2l6ZXJzRGl2ID0gbnVsbDsKICAjbGFzdFBvaW50ZXJDb29yZHMgPSBudWxsOwogICNzYXZlZERpbWVuc2lvbnMgPSBudWxsOwogICNmb2N1c0FDID0gbnVsbDsKICAjZm9jdXNlZFJlc2l6ZXJOYW1lID0gIiI7CiAgI2hhc0JlZW5DbGlja2VkID0gZmFsc2U7CiAgI2luaXRpYWxSZWN0ID0gbnVsbDsKICAjaXNFZGl0aW5nID0gZmFsc2U7CiAgI2lzSW5FZGl0TW9kZSA9IGZhbHNlOwogICNpc1Jlc2l6ZXJFbmFibGVkRm9yS2V5Ym9hcmQgPSBmYWxzZTsKICAjbW92ZUluRE9NVGltZW91dCA9IG51bGw7CiAgI3ByZXZEcmFnWCA9IDA7CiAgI3ByZXZEcmFnWSA9IDA7CiAgI3RlbGVtZXRyeVRpbWVvdXRzID0gbnVsbDsKICAjdG91Y2hNYW5hZ2VyID0gbnVsbDsKICBpc1NlbGVjdGVkID0gZmFsc2U7CiAgX2lzQ29weSA9IGZhbHNlOwogIF9lZGl0VG9vbGJhciA9IG51bGw7CiAgX2luaXRpYWxPcHRpb25zID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBfaW5pdGlhbERhdGEgPSBudWxsOwogIF9pc1Zpc2libGUgPSB0cnVlOwogIF91aU1hbmFnZXIgPSBudWxsOwogIF9mb2N1c0V2ZW50c0FsbG93ZWQgPSB0cnVlOwogIHN0YXRpYyBfbDEwbiA9IG51bGw7CiAgc3RhdGljIF9sMTBuUmVzaXplciA9IG51bGw7CiAgI2lzRHJhZ2dhYmxlID0gZmFsc2U7CiAgI3pJbmRleCA9IEFubm90YXRpb25FZGl0b3IuX3pJbmRleCsrOwogIHN0YXRpYyBfYm9yZGVyTGluZVdpZHRoID0gLTE7CiAgc3RhdGljIF9jb2xvck1hbmFnZXIgPSBuZXcgQ29sb3JNYW5hZ2VyKCk7CiAgc3RhdGljIF96SW5kZXggPSAxOwogIHN0YXRpYyBfdGVsZW1ldHJ5VGltZW91dCA9IDEwMDA7CiAgc3RhdGljIGdldCBfcmVzaXplcktleWJvYXJkTWFuYWdlcigpIHsKICAgIGNvbnN0IHJlc2l6ZSA9IEFubm90YXRpb25FZGl0b3IucHJvdG90eXBlLl9yZXNpemVXaXRoS2V5Ym9hcmQ7CiAgICBjb25zdCBzbWFsbCA9IEFubm90YXRpb25FZGl0b3JVSU1hbmFnZXIuVFJBTlNMQVRFX1NNQUxMOwogICAgY29uc3QgYmlnID0gQW5ub3RhdGlvbkVkaXRvclVJTWFuYWdlci5UUkFOU0xBVEVfQklHOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX3Jlc2l6ZXJLZXlib2FyZE1hbmFnZXIiLCBuZXcgS2V5Ym9hcmRNYW5hZ2VyKFtbWyJBcnJvd0xlZnQiLCAibWFjK0Fycm93TGVmdCJdLCByZXNpemUsIHsKICAgICAgYXJnczogWy1zbWFsbCwgMF0KICAgIH1dLCBbWyJjdHJsK0Fycm93TGVmdCIsICJtYWMrc2hpZnQrQXJyb3dMZWZ0Il0sIHJlc2l6ZSwgewogICAgICBhcmdzOiBbLWJpZywgMF0KICAgIH1dLCBbWyJBcnJvd1JpZ2h0IiwgIm1hYytBcnJvd1JpZ2h0Il0sIHJlc2l6ZSwgewogICAgICBhcmdzOiBbc21hbGwsIDBdCiAgICB9XSwgW1siY3RybCtBcnJvd1JpZ2h0IiwgIm1hYytzaGlmdCtBcnJvd1JpZ2h0Il0sIHJlc2l6ZSwgewogICAgICBhcmdzOiBbYmlnLCAwXQogICAgfV0sIFtbIkFycm93VXAiLCAibWFjK0Fycm93VXAiXSwgcmVzaXplLCB7CiAgICAgIGFyZ3M6IFswLCAtc21hbGxdCiAgICB9XSwgW1siY3RybCtBcnJvd1VwIiwgIm1hYytzaGlmdCtBcnJvd1VwIl0sIHJlc2l6ZSwgewogICAgICBhcmdzOiBbMCwgLWJpZ10KICAgIH1dLCBbWyJBcnJvd0Rvd24iLCAibWFjK0Fycm93RG93biJdLCByZXNpemUsIHsKICAgICAgYXJnczogWzAsIHNtYWxsXQogICAgfV0sIFtbImN0cmwrQXJyb3dEb3duIiwgIm1hYytzaGlmdCtBcnJvd0Rvd24iXSwgcmVzaXplLCB7CiAgICAgIGFyZ3M6IFswLCBiaWddCiAgICB9XSwgW1siRXNjYXBlIiwgIm1hYytFc2NhcGUiXSwgQW5ub3RhdGlvbkVkaXRvci5wcm90b3R5cGUuX3N0b3BSZXNpemluZ1dpdGhLZXlib2FyZF1dKSk7CiAgfQogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgIHRoaXMucGFyZW50ID0gcGFyYW1ldGVycy5wYXJlbnQ7CiAgICB0aGlzLmlkID0gcGFyYW1ldGVycy5pZDsKICAgIHRoaXMud2lkdGggPSB0aGlzLmhlaWdodCA9IG51bGw7CiAgICB0aGlzLnBhZ2VJbmRleCA9IHBhcmFtZXRlcnMucGFyZW50LnBhZ2VJbmRleDsKICAgIHRoaXMubmFtZSA9IHBhcmFtZXRlcnMubmFtZTsKICAgIHRoaXMuZGl2ID0gbnVsbDsKICAgIHRoaXMuX3VpTWFuYWdlciA9IHBhcmFtZXRlcnMudWlNYW5hZ2VyOwogICAgdGhpcy5hbm5vdGF0aW9uRWxlbWVudElkID0gbnVsbDsKICAgIHRoaXMuX3dpbGxLZWVwQXNwZWN0UmF0aW8gPSBmYWxzZTsKICAgIHRoaXMuX2luaXRpYWxPcHRpb25zLmlzQ2VudGVyZWQgPSBwYXJhbWV0ZXJzLmlzQ2VudGVyZWQ7CiAgICB0aGlzLl9zdHJ1Y3RUcmVlUGFyZW50SWQgPSBudWxsOwogICAgY29uc3QgewogICAgICByb3RhdGlvbiwKICAgICAgcmF3RGltczogewogICAgICAgIHBhZ2VXaWR0aCwKICAgICAgICBwYWdlSGVpZ2h0LAogICAgICAgIHBhZ2VYLAogICAgICAgIHBhZ2VZCiAgICAgIH0KICAgIH0gPSB0aGlzLnBhcmVudC52aWV3cG9ydDsKICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjsKICAgIHRoaXMucGFnZVJvdGF0aW9uID0gKDM2MCArIHJvdGF0aW9uIC0gdGhpcy5fdWlNYW5hZ2VyLnZpZXdQYXJhbWV0ZXJzLnJvdGF0aW9uKSAlIDM2MDsKICAgIHRoaXMucGFnZURpbWVuc2lvbnMgPSBbcGFnZVdpZHRoLCBwYWdlSGVpZ2h0XTsKICAgIHRoaXMucGFnZVRyYW5zbGF0aW9uID0gW3BhZ2VYLCBwYWdlWV07CiAgICBjb25zdCBbd2lkdGgsIGhlaWdodF0gPSB0aGlzLnBhcmVudERpbWVuc2lvbnM7CiAgICB0aGlzLnggPSBwYXJhbWV0ZXJzLnggLyB3aWR0aDsKICAgIHRoaXMueSA9IHBhcmFtZXRlcnMueSAvIGhlaWdodDsKICAgIHRoaXMuaXNBdHRhY2hlZFRvRE9NID0gZmFsc2U7CiAgICB0aGlzLmRlbGV0ZWQgPSBmYWxzZTsKICB9CiAgZ2V0IGVkaXRvclR5cGUoKSB7CiAgICByZXR1cm4gT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yLl90eXBlOwogIH0KICBzdGF0aWMgZ2V0IGlzRHJhd2VyKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBzdGF0aWMgZ2V0IF9kZWZhdWx0TGluZUNvbG9yKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX2RlZmF1bHRMaW5lQ29sb3IiLCB0aGlzLl9jb2xvck1hbmFnZXIuZ2V0SGV4Q29kZSgiQ2FudmFzVGV4dCIpKTsKICB9CiAgc3RhdGljIGRlbGV0ZUFubm90YXRpb25FbGVtZW50KGVkaXRvcikgewogICAgY29uc3QgZmFrZUVkaXRvciA9IG5ldyBGYWtlRWRpdG9yKHsKICAgICAgaWQ6IGVkaXRvci5wYXJlbnQuZ2V0TmV4dElkKCksCiAgICAgIHBhcmVudDogZWRpdG9yLnBhcmVudCwKICAgICAgdWlNYW5hZ2VyOiBlZGl0b3IuX3VpTWFuYWdlcgogICAgfSk7CiAgICBmYWtlRWRpdG9yLmFubm90YXRpb25FbGVtZW50SWQgPSBlZGl0b3IuYW5ub3RhdGlvbkVsZW1lbnRJZDsKICAgIGZha2VFZGl0b3IuZGVsZXRlZCA9IHRydWU7CiAgICBmYWtlRWRpdG9yLl91aU1hbmFnZXIuYWRkVG9Bbm5vdGF0aW9uU3RvcmFnZShmYWtlRWRpdG9yKTsKICB9CiAgc3RhdGljIGluaXRpYWxpemUobDEwbiwgX3VpTWFuYWdlcikgewogICAgQW5ub3RhdGlvbkVkaXRvci5fbDEwbiA/Pz0gbDEwbjsKICAgIEFubm90YXRpb25FZGl0b3IuX2wxMG5SZXNpemVyIHx8PSBPYmplY3QuZnJlZXplKHsKICAgICAgdG9wTGVmdDogInBkZmpzLWVkaXRvci1yZXNpemVyLXRvcC1sZWZ0IiwKICAgICAgdG9wTWlkZGxlOiAicGRmanMtZWRpdG9yLXJlc2l6ZXItdG9wLW1pZGRsZSIsCiAgICAgIHRvcFJpZ2h0OiAicGRmanMtZWRpdG9yLXJlc2l6ZXItdG9wLXJpZ2h0IiwKICAgICAgbWlkZGxlUmlnaHQ6ICJwZGZqcy1lZGl0b3ItcmVzaXplci1taWRkbGUtcmlnaHQiLAogICAgICBib3R0b21SaWdodDogInBkZmpzLWVkaXRvci1yZXNpemVyLWJvdHRvbS1yaWdodCIsCiAgICAgIGJvdHRvbU1pZGRsZTogInBkZmpzLWVkaXRvci1yZXNpemVyLWJvdHRvbS1taWRkbGUiLAogICAgICBib3R0b21MZWZ0OiAicGRmanMtZWRpdG9yLXJlc2l6ZXItYm90dG9tLWxlZnQiLAogICAgICBtaWRkbGVMZWZ0OiAicGRmanMtZWRpdG9yLXJlc2l6ZXItbWlkZGxlLWxlZnQiCiAgICB9KTsKICAgIGlmIChBbm5vdGF0aW9uRWRpdG9yLl9ib3JkZXJMaW5lV2lkdGggIT09IC0xKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpOwogICAgQW5ub3RhdGlvbkVkaXRvci5fYm9yZGVyTGluZVdpZHRoID0gcGFyc2VGbG9hdChzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCItLW91dGxpbmUtd2lkdGgiKSkgfHwgMDsKICB9CiAgc3RhdGljIHVwZGF0ZURlZmF1bHRQYXJhbXMoX3R5cGUsIF92YWx1ZSkge30KICBzdGF0aWMgZ2V0IGRlZmF1bHRQcm9wZXJ0aWVzVG9VcGRhdGUoKSB7CiAgICByZXR1cm4gW107CiAgfQogIHN0YXRpYyBpc0hhbmRsaW5nTWltZUZvclBhc3RpbmcobWltZSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBzdGF0aWMgcGFzdGUoaXRlbSwgcGFyZW50KSB7CiAgICB1bnJlYWNoYWJsZSgiTm90IGltcGxlbWVudGVkIik7CiAgfQogIGdldCBwcm9wZXJ0aWVzVG9VcGRhdGUoKSB7CiAgICByZXR1cm4gW107CiAgfQogIGdldCBfaXNEcmFnZ2FibGUoKSB7CiAgICByZXR1cm4gdGhpcy4jaXNEcmFnZ2FibGU7CiAgfQogIHNldCBfaXNEcmFnZ2FibGUodmFsdWUpIHsKICAgIHRoaXMuI2lzRHJhZ2dhYmxlID0gdmFsdWU7CiAgICB0aGlzLmRpdj8uY2xhc3NMaXN0LnRvZ2dsZSgiZHJhZ2dhYmxlIiwgdmFsdWUpOwogIH0KICBnZXQgaXNFbnRlckhhbmRsZWQoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgY2VudGVyKCkgewogICAgY29uc3QgW3BhZ2VXaWR0aCwgcGFnZUhlaWdodF0gPSB0aGlzLnBhZ2VEaW1lbnNpb25zOwogICAgc3dpdGNoICh0aGlzLnBhcmVudFJvdGF0aW9uKSB7CiAgICAgIGNhc2UgOTA6CiAgICAgICAgdGhpcy54IC09IHRoaXMuaGVpZ2h0ICogcGFnZUhlaWdodCAvIChwYWdlV2lkdGggKiAyKTsKICAgICAgICB0aGlzLnkgKz0gdGhpcy53aWR0aCAqIHBhZ2VXaWR0aCAvIChwYWdlSGVpZ2h0ICogMik7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMTgwOgogICAgICAgIHRoaXMueCArPSB0aGlzLndpZHRoIC8gMjsKICAgICAgICB0aGlzLnkgKz0gdGhpcy5oZWlnaHQgLyAyOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI3MDoKICAgICAgICB0aGlzLnggKz0gdGhpcy5oZWlnaHQgKiBwYWdlSGVpZ2h0IC8gKHBhZ2VXaWR0aCAqIDIpOwogICAgICAgIHRoaXMueSAtPSB0aGlzLndpZHRoICogcGFnZVdpZHRoIC8gKHBhZ2VIZWlnaHQgKiAyKTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aGlzLnggLT0gdGhpcy53aWR0aCAvIDI7CiAgICAgICAgdGhpcy55IC09IHRoaXMuaGVpZ2h0IC8gMjsKICAgICAgICBicmVhazsKICAgIH0KICAgIHRoaXMuZml4QW5kU2V0UG9zaXRpb24oKTsKICB9CiAgYWRkQ29tbWFuZHMocGFyYW1zKSB7CiAgICB0aGlzLl91aU1hbmFnZXIuYWRkQ29tbWFuZHMocGFyYW1zKTsKICB9CiAgZ2V0IGN1cnJlbnRMYXllcigpIHsKICAgIHJldHVybiB0aGlzLl91aU1hbmFnZXIuY3VycmVudExheWVyOwogIH0KICBzZXRJbkJhY2tncm91bmQoKSB7CiAgICB0aGlzLmRpdi5zdHlsZS56SW5kZXggPSAwOwogIH0KICBzZXRJbkZvcmVncm91bmQoKSB7CiAgICB0aGlzLmRpdi5zdHlsZS56SW5kZXggPSB0aGlzLiN6SW5kZXg7CiAgfQogIHNldFBhcmVudChwYXJlbnQpIHsKICAgIGlmIChwYXJlbnQgIT09IG51bGwpIHsKICAgICAgdGhpcy5wYWdlSW5kZXggPSBwYXJlbnQucGFnZUluZGV4OwogICAgICB0aGlzLnBhZ2VEaW1lbnNpb25zID0gcGFyZW50LnBhZ2VEaW1lbnNpb25zOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy4jc3RvcFJlc2l6aW5nKCk7CiAgICB9CiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsKICB9CiAgZm9jdXNpbihldmVudCkgewogICAgaWYgKCF0aGlzLl9mb2N1c0V2ZW50c0FsbG93ZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzLiNoYXNCZWVuQ2xpY2tlZCkgewogICAgICB0aGlzLnBhcmVudC5zZXRTZWxlY3RlZCh0aGlzKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuI2hhc0JlZW5DbGlja2VkID0gZmFsc2U7CiAgICB9CiAgfQogIGZvY3Vzb3V0KGV2ZW50KSB7CiAgICBpZiAoIXRoaXMuX2ZvY3VzRXZlbnRzQWxsb3dlZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXMuaXNBdHRhY2hlZFRvRE9NKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnJlbGF0ZWRUYXJnZXQ7CiAgICBpZiAodGFyZ2V0Py5jbG9zZXN0KGAjJHt0aGlzLmlkfWApKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBpZiAoIXRoaXMucGFyZW50Py5pc011bHRpcGxlU2VsZWN0aW9uKSB7CiAgICAgIHRoaXMuY29tbWl0T3JSZW1vdmUoKTsKICAgIH0KICB9CiAgY29tbWl0T3JSZW1vdmUoKSB7CiAgICBpZiAodGhpcy5pc0VtcHR5KCkpIHsKICAgICAgdGhpcy5yZW1vdmUoKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY29tbWl0KCk7CiAgICB9CiAgfQogIGNvbW1pdCgpIHsKICAgIHRoaXMuYWRkVG9Bbm5vdGF0aW9uU3RvcmFnZSgpOwogIH0KICBhZGRUb0Fubm90YXRpb25TdG9yYWdlKCkgewogICAgdGhpcy5fdWlNYW5hZ2VyLmFkZFRvQW5ub3RhdGlvblN0b3JhZ2UodGhpcyk7CiAgfQogIHNldEF0KHgsIHksIHR4LCB0eSkgewogICAgY29uc3QgW3dpZHRoLCBoZWlnaHRdID0gdGhpcy5wYXJlbnREaW1lbnNpb25zOwogICAgW3R4LCB0eV0gPSB0aGlzLnNjcmVlblRvUGFnZVRyYW5zbGF0aW9uKHR4LCB0eSk7CiAgICB0aGlzLnggPSAoeCArIHR4KSAvIHdpZHRoOwogICAgdGhpcy55ID0gKHkgKyB0eSkgLyBoZWlnaHQ7CiAgICB0aGlzLmZpeEFuZFNldFBvc2l0aW9uKCk7CiAgfQogIF9tb3ZlQWZ0ZXJQYXN0ZShiYXNlWCwgYmFzZVkpIHsKICAgIGNvbnN0IFtwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0XSA9IHRoaXMucGFyZW50RGltZW5zaW9uczsKICAgIHRoaXMuc2V0QXQoYmFzZVggKiBwYXJlbnRXaWR0aCwgYmFzZVkgKiBwYXJlbnRIZWlnaHQsIHRoaXMud2lkdGggKiBwYXJlbnRXaWR0aCwgdGhpcy5oZWlnaHQgKiBwYXJlbnRIZWlnaHQpOwogICAgdGhpcy5fb25UcmFuc2xhdGVkKCk7CiAgfQogICN0cmFuc2xhdGUoW3dpZHRoLCBoZWlnaHRdLCB4LCB5KSB7CiAgICBbeCwgeV0gPSB0aGlzLnNjcmVlblRvUGFnZVRyYW5zbGF0aW9uKHgsIHkpOwogICAgdGhpcy54ICs9IHggLyB3aWR0aDsKICAgIHRoaXMueSArPSB5IC8gaGVpZ2h0OwogICAgdGhpcy5fb25UcmFuc2xhdGluZyh0aGlzLngsIHRoaXMueSk7CiAgICB0aGlzLmZpeEFuZFNldFBvc2l0aW9uKCk7CiAgfQogIHRyYW5zbGF0ZSh4LCB5KSB7CiAgICB0aGlzLiN0cmFuc2xhdGUodGhpcy5wYXJlbnREaW1lbnNpb25zLCB4LCB5KTsKICB9CiAgdHJhbnNsYXRlSW5QYWdlKHgsIHkpIHsKICAgIHRoaXMuI2luaXRpYWxSZWN0IHx8PSBbdGhpcy54LCB0aGlzLnksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0XTsKICAgIHRoaXMuI3RyYW5zbGF0ZSh0aGlzLnBhZ2VEaW1lbnNpb25zLCB4LCB5KTsKICAgIHRoaXMuZGl2LnNjcm9sbEludG9WaWV3KHsKICAgICAgYmxvY2s6ICJuZWFyZXN0IgogICAgfSk7CiAgfQogIHRyYW5zbGF0aW9uRG9uZSgpIHsKICAgIHRoaXMuX29uVHJhbnNsYXRlZCh0aGlzLngsIHRoaXMueSk7CiAgfQogIGRyYWcodHgsIHR5KSB7CiAgICB0aGlzLiNpbml0aWFsUmVjdCB8fD0gW3RoaXMueCwgdGhpcy55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodF07CiAgICBjb25zdCB7CiAgICAgIGRpdiwKICAgICAgcGFyZW50RGltZW5zaW9uczogW3BhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHRdCiAgICB9ID0gdGhpczsKICAgIHRoaXMueCArPSB0eCAvIHBhcmVudFdpZHRoOwogICAgdGhpcy55ICs9IHR5IC8gcGFyZW50SGVpZ2h0OwogICAgaWYgKHRoaXMucGFyZW50ICYmICh0aGlzLnggPCAwIHx8IHRoaXMueCA+IDEgfHwgdGhpcy55IDwgMCB8fCB0aGlzLnkgPiAxKSkgewogICAgICBjb25zdCB7CiAgICAgICAgeCwKICAgICAgICB5CiAgICAgIH0gPSB0aGlzLmRpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgaWYgKHRoaXMucGFyZW50LmZpbmROZXdQYXJlbnQodGhpcywgeCwgeSkpIHsKICAgICAgICB0aGlzLnggLT0gTWF0aC5mbG9vcih0aGlzLngpOwogICAgICAgIHRoaXMueSAtPSBNYXRoLmZsb29yKHRoaXMueSk7CiAgICAgIH0KICAgIH0KICAgIGxldCB7CiAgICAgIHgsCiAgICAgIHkKICAgIH0gPSB0aGlzOwogICAgY29uc3QgW2J4LCBieV0gPSB0aGlzLmdldEJhc2VUcmFuc2xhdGlvbigpOwogICAgeCArPSBieDsKICAgIHkgKz0gYnk7CiAgICBjb25zdCB7CiAgICAgIHN0eWxlCiAgICB9ID0gZGl2OwogICAgc3R5bGUubGVmdCA9IGAkeygxMDAgKiB4KS50b0ZpeGVkKDIpfSVgOwogICAgc3R5bGUudG9wID0gYCR7KDEwMCAqIHkpLnRvRml4ZWQoMil9JWA7CiAgICB0aGlzLl9vblRyYW5zbGF0aW5nKHgsIHkpOwogICAgZGl2LnNjcm9sbEludG9WaWV3KHsKICAgICAgYmxvY2s6ICJuZWFyZXN0IgogICAgfSk7CiAgfQogIF9vblRyYW5zbGF0aW5nKHgsIHkpIHt9CiAgX29uVHJhbnNsYXRlZCh4LCB5KSB7fQogIGdldCBfaGFzQmVlbk1vdmVkKCkgewogICAgcmV0dXJuICEhdGhpcy4jaW5pdGlhbFJlY3QgJiYgKHRoaXMuI2luaXRpYWxSZWN0WzBdICE9PSB0aGlzLnggfHwgdGhpcy4jaW5pdGlhbFJlY3RbMV0gIT09IHRoaXMueSk7CiAgfQogIGdldCBfaGFzQmVlblJlc2l6ZWQoKSB7CiAgICByZXR1cm4gISF0aGlzLiNpbml0aWFsUmVjdCAmJiAodGhpcy4jaW5pdGlhbFJlY3RbMl0gIT09IHRoaXMud2lkdGggfHwgdGhpcy4jaW5pdGlhbFJlY3RbM10gIT09IHRoaXMuaGVpZ2h0KTsKICB9CiAgZ2V0QmFzZVRyYW5zbGF0aW9uKCkgewogICAgY29uc3QgW3BhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHRdID0gdGhpcy5wYXJlbnREaW1lbnNpb25zOwogICAgY29uc3QgewogICAgICBfYm9yZGVyTGluZVdpZHRoCiAgICB9ID0gQW5ub3RhdGlvbkVkaXRvcjsKICAgIGNvbnN0IHggPSBfYm9yZGVyTGluZVdpZHRoIC8gcGFyZW50V2lkdGg7CiAgICBjb25zdCB5ID0gX2JvcmRlckxpbmVXaWR0aCAvIHBhcmVudEhlaWdodDsKICAgIHN3aXRjaCAodGhpcy5yb3RhdGlvbikgewogICAgICBjYXNlIDkwOgogICAgICAgIHJldHVybiBbLXgsIHldOwogICAgICBjYXNlIDE4MDoKICAgICAgICByZXR1cm4gW3gsIHldOwogICAgICBjYXNlIDI3MDoKICAgICAgICByZXR1cm4gW3gsIC15XTsKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gWy14LCAteV07CiAgICB9CiAgfQogIGdldCBfbXVzdEZpeFBvc2l0aW9uKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGZpeEFuZFNldFBvc2l0aW9uKHJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbikgewogICAgY29uc3QgewogICAgICBkaXY6IHsKICAgICAgICBzdHlsZQogICAgICB9LAogICAgICBwYWdlRGltZW5zaW9uczogW3BhZ2VXaWR0aCwgcGFnZUhlaWdodF0KICAgIH0gPSB0aGlzOwogICAgbGV0IHsKICAgICAgeCwKICAgICAgeSwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IHRoaXM7CiAgICB3aWR0aCAqPSBwYWdlV2lkdGg7CiAgICBoZWlnaHQgKj0gcGFnZUhlaWdodDsKICAgIHggKj0gcGFnZVdpZHRoOwogICAgeSAqPSBwYWdlSGVpZ2h0OwogICAgaWYgKHRoaXMuX211c3RGaXhQb3NpdGlvbikgewogICAgICBzd2l0Y2ggKHJvdGF0aW9uKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgeCA9IE1hdGhDbGFtcCh4LCAwLCBwYWdlV2lkdGggLSB3aWR0aCk7CiAgICAgICAgICB5ID0gTWF0aENsYW1wKHksIDAsIHBhZ2VIZWlnaHQgLSBoZWlnaHQpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA5MDoKICAgICAgICAgIHggPSBNYXRoQ2xhbXAoeCwgMCwgcGFnZVdpZHRoIC0gaGVpZ2h0KTsKICAgICAgICAgIHkgPSBNYXRoQ2xhbXAoeSwgd2lkdGgsIHBhZ2VIZWlnaHQpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxODA6CiAgICAgICAgICB4ID0gTWF0aENsYW1wKHgsIHdpZHRoLCBwYWdlV2lkdGgpOwogICAgICAgICAgeSA9IE1hdGhDbGFtcCh5LCBoZWlnaHQsIHBhZ2VIZWlnaHQpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyNzA6CiAgICAgICAgICB4ID0gTWF0aENsYW1wKHgsIGhlaWdodCwgcGFnZVdpZHRoKTsKICAgICAgICAgIHkgPSBNYXRoQ2xhbXAoeSwgMCwgcGFnZUhlaWdodCAtIHdpZHRoKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICB0aGlzLnggPSB4IC89IHBhZ2VXaWR0aDsKICAgIHRoaXMueSA9IHkgLz0gcGFnZUhlaWdodDsKICAgIGNvbnN0IFtieCwgYnldID0gdGhpcy5nZXRCYXNlVHJhbnNsYXRpb24oKTsKICAgIHggKz0gYng7CiAgICB5ICs9IGJ5OwogICAgc3R5bGUubGVmdCA9IGAkeygxMDAgKiB4KS50b0ZpeGVkKDIpfSVgOwogICAgc3R5bGUudG9wID0gYCR7KDEwMCAqIHkpLnRvRml4ZWQoMil9JWA7CiAgICB0aGlzLm1vdmVJbkRPTSgpOwogIH0KICBzdGF0aWMgI3JvdGF0ZVBvaW50KHgsIHksIGFuZ2xlKSB7CiAgICBzd2l0Y2ggKGFuZ2xlKSB7CiAgICAgIGNhc2UgOTA6CiAgICAgICAgcmV0dXJuIFt5LCAteF07CiAgICAgIGNhc2UgMTgwOgogICAgICAgIHJldHVybiBbLXgsIC15XTsKICAgICAgY2FzZSAyNzA6CiAgICAgICAgcmV0dXJuIFsteSwgeF07CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIFt4LCB5XTsKICAgIH0KICB9CiAgc2NyZWVuVG9QYWdlVHJhbnNsYXRpb24oeCwgeSkgewogICAgcmV0dXJuIEFubm90YXRpb25FZGl0b3IuI3JvdGF0ZVBvaW50KHgsIHksIHRoaXMucGFyZW50Um90YXRpb24pOwogIH0KICBwYWdlVHJhbnNsYXRpb25Ub1NjcmVlbih4LCB5KSB7CiAgICByZXR1cm4gQW5ub3RhdGlvbkVkaXRvci4jcm90YXRlUG9pbnQoeCwgeSwgMzYwIC0gdGhpcy5wYXJlbnRSb3RhdGlvbik7CiAgfQogICNnZXRSb3RhdGlvbk1hdHJpeChyb3RhdGlvbikgewogICAgc3dpdGNoIChyb3RhdGlvbikgewogICAgICBjYXNlIDkwOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFtwYWdlV2lkdGgsIHBhZ2VIZWlnaHRdID0gdGhpcy5wYWdlRGltZW5zaW9uczsKICAgICAgICAgIHJldHVybiBbMCwgLXBhZ2VXaWR0aCAvIHBhZ2VIZWlnaHQsIHBhZ2VIZWlnaHQgLyBwYWdlV2lkdGgsIDBdOwogICAgICAgIH0KICAgICAgY2FzZSAxODA6CiAgICAgICAgcmV0dXJuIFstMSwgMCwgMCwgLTFdOwogICAgICBjYXNlIDI3MDoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbcGFnZVdpZHRoLCBwYWdlSGVpZ2h0XSA9IHRoaXMucGFnZURpbWVuc2lvbnM7CiAgICAgICAgICByZXR1cm4gWzAsIHBhZ2VXaWR0aCAvIHBhZ2VIZWlnaHQsIC1wYWdlSGVpZ2h0IC8gcGFnZVdpZHRoLCAwXTsKICAgICAgICB9CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIFsxLCAwLCAwLCAxXTsKICAgIH0KICB9CiAgZ2V0IHBhcmVudFNjYWxlKCkgewogICAgcmV0dXJuIHRoaXMuX3VpTWFuYWdlci52aWV3UGFyYW1ldGVycy5yZWFsU2NhbGU7CiAgfQogIGdldCBwYXJlbnRSb3RhdGlvbigpIHsKICAgIHJldHVybiAodGhpcy5fdWlNYW5hZ2VyLnZpZXdQYXJhbWV0ZXJzLnJvdGF0aW9uICsgdGhpcy5wYWdlUm90YXRpb24pICUgMzYwOwogIH0KICBnZXQgcGFyZW50RGltZW5zaW9ucygpIHsKICAgIGNvbnN0IHsKICAgICAgcGFyZW50U2NhbGUsCiAgICAgIHBhZ2VEaW1lbnNpb25zOiBbcGFnZVdpZHRoLCBwYWdlSGVpZ2h0XQogICAgfSA9IHRoaXM7CiAgICByZXR1cm4gW3BhZ2VXaWR0aCAqIHBhcmVudFNjYWxlLCBwYWdlSGVpZ2h0ICogcGFyZW50U2NhbGVdOwogIH0KICBzZXREaW1zKHdpZHRoLCBoZWlnaHQpIHsKICAgIGNvbnN0IFtwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0XSA9IHRoaXMucGFyZW50RGltZW5zaW9uczsKICAgIGNvbnN0IHsKICAgICAgc3R5bGUKICAgIH0gPSB0aGlzLmRpdjsKICAgIHN0eWxlLndpZHRoID0gYCR7KDEwMCAqIHdpZHRoIC8gcGFyZW50V2lkdGgpLnRvRml4ZWQoMil9JWA7CiAgICBpZiAoIXRoaXMuI2tlZXBBc3BlY3RSYXRpbykgewogICAgICBzdHlsZS5oZWlnaHQgPSBgJHsoMTAwICogaGVpZ2h0IC8gcGFyZW50SGVpZ2h0KS50b0ZpeGVkKDIpfSVgOwogICAgfQogIH0KICBmaXhEaW1zKCkgewogICAgY29uc3QgewogICAgICBzdHlsZQogICAgfSA9IHRoaXMuZGl2OwogICAgY29uc3QgewogICAgICBoZWlnaHQsCiAgICAgIHdpZHRoCiAgICB9ID0gc3R5bGU7CiAgICBjb25zdCB3aWR0aFBlcmNlbnQgPSB3aWR0aC5lbmRzV2l0aCgiJSIpOwogICAgY29uc3QgaGVpZ2h0UGVyY2VudCA9ICF0aGlzLiNrZWVwQXNwZWN0UmF0aW8gJiYgaGVpZ2h0LmVuZHNXaXRoKCIlIik7CiAgICBpZiAod2lkdGhQZXJjZW50ICYmIGhlaWdodFBlcmNlbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgW3BhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHRdID0gdGhpcy5wYXJlbnREaW1lbnNpb25zOwogICAgaWYgKCF3aWR0aFBlcmNlbnQpIHsKICAgICAgc3R5bGUud2lkdGggPSBgJHsoMTAwICogcGFyc2VGbG9hdCh3aWR0aCkgLyBwYXJlbnRXaWR0aCkudG9GaXhlZCgyKX0lYDsKICAgIH0KICAgIGlmICghdGhpcy4ja2VlcEFzcGVjdFJhdGlvICYmICFoZWlnaHRQZXJjZW50KSB7CiAgICAgIHN0eWxlLmhlaWdodCA9IGAkeygxMDAgKiBwYXJzZUZsb2F0KGhlaWdodCkgLyBwYXJlbnRIZWlnaHQpLnRvRml4ZWQoMil9JWA7CiAgICB9CiAgfQogIGdldEluaXRpYWxUcmFuc2xhdGlvbigpIHsKICAgIHJldHVybiBbMCwgMF07CiAgfQogICNjcmVhdGVSZXNpemVycygpIHsKICAgIGlmICh0aGlzLiNyZXNpemVyc0RpdikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNyZXNpemVyc0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgdGhpcy4jcmVzaXplcnNEaXYuY2xhc3NMaXN0LmFkZCgicmVzaXplcnMiKTsKICAgIGNvbnN0IGNsYXNzZXMgPSB0aGlzLl93aWxsS2VlcEFzcGVjdFJhdGlvID8gWyJ0b3BMZWZ0IiwgInRvcFJpZ2h0IiwgImJvdHRvbVJpZ2h0IiwgImJvdHRvbUxlZnQiXSA6IFsidG9wTGVmdCIsICJ0b3BNaWRkbGUiLCAidG9wUmlnaHQiLCAibWlkZGxlUmlnaHQiLCAiYm90dG9tUmlnaHQiLCAiYm90dG9tTWlkZGxlIiwgImJvdHRvbUxlZnQiLCAibWlkZGxlTGVmdCJdOwogICAgY29uc3Qgc2lnbmFsID0gdGhpcy5fdWlNYW5hZ2VyLl9zaWduYWw7CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgY2xhc3NlcykgewogICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgdGhpcy4jcmVzaXplcnNEaXYuYXBwZW5kKGRpdik7CiAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKCJyZXNpemVyIiwgbmFtZSk7CiAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtcmVzaXplci1uYW1lIiwgbmFtZSk7CiAgICAgIGRpdi5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIHRoaXMuI3Jlc2l6ZXJQb2ludGVyZG93bi5iaW5kKHRoaXMsIG5hbWUpLCB7CiAgICAgICAgc2lnbmFsCiAgICAgIH0pOwogICAgICBkaXYuYWRkRXZlbnRMaXN0ZW5lcigiY29udGV4dG1lbnUiLCBub0NvbnRleHRNZW51LCB7CiAgICAgICAgc2lnbmFsCiAgICAgIH0pOwogICAgICBkaXYudGFiSW5kZXggPSAtMTsKICAgIH0KICAgIHRoaXMuZGl2LnByZXBlbmQodGhpcy4jcmVzaXplcnNEaXYpOwogIH0KICAjcmVzaXplclBvaW50ZXJkb3duKG5hbWUsIGV2ZW50KSB7CiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgY29uc3QgewogICAgICBpc01hYwogICAgfSA9IHV0aWxfRmVhdHVyZVRlc3QucGxhdGZvcm07CiAgICBpZiAoZXZlbnQuYnV0dG9uICE9PSAwIHx8IGV2ZW50LmN0cmxLZXkgJiYgaXNNYWMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jYWx0VGV4dD8udG9nZ2xlKGZhbHNlKTsKICAgIGNvbnN0IHNhdmVkRHJhZ2dhYmxlID0gdGhpcy5faXNEcmFnZ2FibGU7CiAgICB0aGlzLl9pc0RyYWdnYWJsZSA9IGZhbHNlOwogICAgdGhpcy4jbGFzdFBvaW50ZXJDb29yZHMgPSBbZXZlbnQuc2NyZWVuWCwgZXZlbnQuc2NyZWVuWV07CiAgICBjb25zdCBhYyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuX3VpTWFuYWdlci5jb21iaW5lZFNpZ25hbChhYyk7CiAgICB0aGlzLnBhcmVudC50b2dnbGVQb2ludGVyRXZlbnRzKGZhbHNlKTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIHRoaXMuI3Jlc2l6ZXJQb2ludGVybW92ZS5iaW5kKHRoaXMsIG5hbWUpLCB7CiAgICAgIHBhc3NpdmU6IHRydWUsCiAgICAgIGNhcHR1cmU6IHRydWUsCiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2htb3ZlIiwgc3RvcEV2ZW50LCB7CiAgICAgIHBhc3NpdmU6IGZhbHNlLAogICAgICBzaWduYWwKICAgIH0pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51Iiwgbm9Db250ZXh0TWVudSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgdGhpcy4jc2F2ZWREaW1lbnNpb25zID0gewogICAgICBzYXZlZFg6IHRoaXMueCwKICAgICAgc2F2ZWRZOiB0aGlzLnksCiAgICAgIHNhdmVkV2lkdGg6IHRoaXMud2lkdGgsCiAgICAgIHNhdmVkSGVpZ2h0OiB0aGlzLmhlaWdodAogICAgfTsKICAgIGNvbnN0IHNhdmVkUGFyZW50Q3Vyc29yID0gdGhpcy5wYXJlbnQuZGl2LnN0eWxlLmN1cnNvcjsKICAgIGNvbnN0IHNhdmVkQ3Vyc29yID0gdGhpcy5kaXYuc3R5bGUuY3Vyc29yOwogICAgdGhpcy5kaXYuc3R5bGUuY3Vyc29yID0gdGhpcy5wYXJlbnQuZGl2LnN0eWxlLmN1cnNvciA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGV2ZW50LnRhcmdldCkuY3Vyc29yOwogICAgY29uc3QgcG9pbnRlclVwQ2FsbGJhY2sgPSAoKSA9PiB7CiAgICAgIGFjLmFib3J0KCk7CiAgICAgIHRoaXMucGFyZW50LnRvZ2dsZVBvaW50ZXJFdmVudHModHJ1ZSk7CiAgICAgIHRoaXMuI2FsdFRleHQ/LnRvZ2dsZSh0cnVlKTsKICAgICAgdGhpcy5faXNEcmFnZ2FibGUgPSBzYXZlZERyYWdnYWJsZTsKICAgICAgdGhpcy5wYXJlbnQuZGl2LnN0eWxlLmN1cnNvciA9IHNhdmVkUGFyZW50Q3Vyc29yOwogICAgICB0aGlzLmRpdi5zdHlsZS5jdXJzb3IgPSBzYXZlZEN1cnNvcjsKICAgICAgdGhpcy4jYWRkUmVzaXplVG9VbmRvU3RhY2soKTsKICAgIH07CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgcG9pbnRlclVwQ2FsbGJhY2ssIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJibHVyIiwgcG9pbnRlclVwQ2FsbGJhY2ssIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICB9CiAgI3Jlc2l6ZSh4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7CiAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICAgIHRoaXMueCA9IHg7CiAgICB0aGlzLnkgPSB5OwogICAgY29uc3QgW3BhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHRdID0gdGhpcy5wYXJlbnREaW1lbnNpb25zOwogICAgdGhpcy5zZXREaW1zKHBhcmVudFdpZHRoICogd2lkdGgsIHBhcmVudEhlaWdodCAqIGhlaWdodCk7CiAgICB0aGlzLmZpeEFuZFNldFBvc2l0aW9uKCk7CiAgICB0aGlzLl9vblJlc2l6ZWQoKTsKICB9CiAgX29uUmVzaXplZCgpIHt9CiAgI2FkZFJlc2l6ZVRvVW5kb1N0YWNrKCkgewogICAgaWYgKCF0aGlzLiNzYXZlZERpbWVuc2lvbnMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgewogICAgICBzYXZlZFgsCiAgICAgIHNhdmVkWSwKICAgICAgc2F2ZWRXaWR0aCwKICAgICAgc2F2ZWRIZWlnaHQKICAgIH0gPSB0aGlzLiNzYXZlZERpbWVuc2lvbnM7CiAgICB0aGlzLiNzYXZlZERpbWVuc2lvbnMgPSBudWxsOwogICAgY29uc3QgbmV3WCA9IHRoaXMueDsKICAgIGNvbnN0IG5ld1kgPSB0aGlzLnk7CiAgICBjb25zdCBuZXdXaWR0aCA9IHRoaXMud2lkdGg7CiAgICBjb25zdCBuZXdIZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgIGlmIChuZXdYID09PSBzYXZlZFggJiYgbmV3WSA9PT0gc2F2ZWRZICYmIG5ld1dpZHRoID09PSBzYXZlZFdpZHRoICYmIG5ld0hlaWdodCA9PT0gc2F2ZWRIZWlnaHQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5hZGRDb21tYW5kcyh7CiAgICAgIGNtZDogdGhpcy4jcmVzaXplLmJpbmQodGhpcywgbmV3WCwgbmV3WSwgbmV3V2lkdGgsIG5ld0hlaWdodCksCiAgICAgIHVuZG86IHRoaXMuI3Jlc2l6ZS5iaW5kKHRoaXMsIHNhdmVkWCwgc2F2ZWRZLCBzYXZlZFdpZHRoLCBzYXZlZEhlaWdodCksCiAgICAgIG11c3RFeGVjOiB0cnVlCiAgICB9KTsKICB9CiAgc3RhdGljIF9yb3VuZCh4KSB7CiAgICByZXR1cm4gTWF0aC5yb3VuZCh4ICogMTAwMDApIC8gMTAwMDA7CiAgfQogICNyZXNpemVyUG9pbnRlcm1vdmUobmFtZSwgZXZlbnQpIHsKICAgIGNvbnN0IFtwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0XSA9IHRoaXMucGFyZW50RGltZW5zaW9uczsKICAgIGNvbnN0IHNhdmVkWCA9IHRoaXMueDsKICAgIGNvbnN0IHNhdmVkWSA9IHRoaXMueTsKICAgIGNvbnN0IHNhdmVkV2lkdGggPSB0aGlzLndpZHRoOwogICAgY29uc3Qgc2F2ZWRIZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgIGNvbnN0IG1pbldpZHRoID0gQW5ub3RhdGlvbkVkaXRvci5NSU5fU0laRSAvIHBhcmVudFdpZHRoOwogICAgY29uc3QgbWluSGVpZ2h0ID0gQW5ub3RhdGlvbkVkaXRvci5NSU5fU0laRSAvIHBhcmVudEhlaWdodDsKICAgIGNvbnN0IHJvdGF0aW9uTWF0cml4ID0gdGhpcy4jZ2V0Um90YXRpb25NYXRyaXgodGhpcy5yb3RhdGlvbik7CiAgICBjb25zdCB0cmFuc2YgPSAoeCwgeSkgPT4gW3JvdGF0aW9uTWF0cml4WzBdICogeCArIHJvdGF0aW9uTWF0cml4WzJdICogeSwgcm90YXRpb25NYXRyaXhbMV0gKiB4ICsgcm90YXRpb25NYXRyaXhbM10gKiB5XTsKICAgIGNvbnN0IGludlJvdGF0aW9uTWF0cml4ID0gdGhpcy4jZ2V0Um90YXRpb25NYXRyaXgoMzYwIC0gdGhpcy5yb3RhdGlvbik7CiAgICBjb25zdCBpbnZUcmFuc2YgPSAoeCwgeSkgPT4gW2ludlJvdGF0aW9uTWF0cml4WzBdICogeCArIGludlJvdGF0aW9uTWF0cml4WzJdICogeSwgaW52Um90YXRpb25NYXRyaXhbMV0gKiB4ICsgaW52Um90YXRpb25NYXRyaXhbM10gKiB5XTsKICAgIGxldCBnZXRQb2ludDsKICAgIGxldCBnZXRPcHBvc2l0ZTsKICAgIGxldCBpc0RpYWdvbmFsID0gZmFsc2U7CiAgICBsZXQgaXNIb3Jpem9udGFsID0gZmFsc2U7CiAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgY2FzZSAidG9wTGVmdCI6CiAgICAgICAgaXNEaWFnb25hbCA9IHRydWU7CiAgICAgICAgZ2V0UG9pbnQgPSAodywgaCkgPT4gWzAsIDBdOwogICAgICAgIGdldE9wcG9zaXRlID0gKHcsIGgpID0+IFt3LCBoXTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAidG9wTWlkZGxlIjoKICAgICAgICBnZXRQb2ludCA9ICh3LCBoKSA9PiBbdyAvIDIsIDBdOwogICAgICAgIGdldE9wcG9zaXRlID0gKHcsIGgpID0+IFt3IC8gMiwgaF07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgInRvcFJpZ2h0IjoKICAgICAgICBpc0RpYWdvbmFsID0gdHJ1ZTsKICAgICAgICBnZXRQb2ludCA9ICh3LCBoKSA9PiBbdywgMF07CiAgICAgICAgZ2V0T3Bwb3NpdGUgPSAodywgaCkgPT4gWzAsIGhdOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJtaWRkbGVSaWdodCI6CiAgICAgICAgaXNIb3Jpem9udGFsID0gdHJ1ZTsKICAgICAgICBnZXRQb2ludCA9ICh3LCBoKSA9PiBbdywgaCAvIDJdOwogICAgICAgIGdldE9wcG9zaXRlID0gKHcsIGgpID0+IFswLCBoIC8gMl07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImJvdHRvbVJpZ2h0IjoKICAgICAgICBpc0RpYWdvbmFsID0gdHJ1ZTsKICAgICAgICBnZXRQb2ludCA9ICh3LCBoKSA9PiBbdywgaF07CiAgICAgICAgZ2V0T3Bwb3NpdGUgPSAodywgaCkgPT4gWzAsIDBdOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJib3R0b21NaWRkbGUiOgogICAgICAgIGdldFBvaW50ID0gKHcsIGgpID0+IFt3IC8gMiwgaF07CiAgICAgICAgZ2V0T3Bwb3NpdGUgPSAodywgaCkgPT4gW3cgLyAyLCAwXTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiYm90dG9tTGVmdCI6CiAgICAgICAgaXNEaWFnb25hbCA9IHRydWU7CiAgICAgICAgZ2V0UG9pbnQgPSAodywgaCkgPT4gWzAsIGhdOwogICAgICAgIGdldE9wcG9zaXRlID0gKHcsIGgpID0+IFt3LCAwXTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAibWlkZGxlTGVmdCI6CiAgICAgICAgaXNIb3Jpem9udGFsID0gdHJ1ZTsKICAgICAgICBnZXRQb2ludCA9ICh3LCBoKSA9PiBbMCwgaCAvIDJdOwogICAgICAgIGdldE9wcG9zaXRlID0gKHcsIGgpID0+IFt3LCBoIC8gMl07CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBjb25zdCBwb2ludCA9IGdldFBvaW50KHNhdmVkV2lkdGgsIHNhdmVkSGVpZ2h0KTsKICAgIGNvbnN0IG9wcG9zaXRlUG9pbnQgPSBnZXRPcHBvc2l0ZShzYXZlZFdpZHRoLCBzYXZlZEhlaWdodCk7CiAgICBsZXQgdHJhbnNmT3Bwb3NpdGVQb2ludCA9IHRyYW5zZiguLi5vcHBvc2l0ZVBvaW50KTsKICAgIGNvbnN0IG9wcG9zaXRlWCA9IEFubm90YXRpb25FZGl0b3IuX3JvdW5kKHNhdmVkWCArIHRyYW5zZk9wcG9zaXRlUG9pbnRbMF0pOwogICAgY29uc3Qgb3Bwb3NpdGVZID0gQW5ub3RhdGlvbkVkaXRvci5fcm91bmQoc2F2ZWRZICsgdHJhbnNmT3Bwb3NpdGVQb2ludFsxXSk7CiAgICBsZXQgcmF0aW9YID0gMTsKICAgIGxldCByYXRpb1kgPSAxOwogICAgbGV0IGRlbHRhWCwgZGVsdGFZOwogICAgaWYgKCFldmVudC5mcm9tS2V5Ym9hcmQpIHsKICAgICAgY29uc3QgewogICAgICAgIHNjcmVlblgsCiAgICAgICAgc2NyZWVuWQogICAgICB9ID0gZXZlbnQ7CiAgICAgIGNvbnN0IFtsYXN0U2NyZWVuWCwgbGFzdFNjcmVlblldID0gdGhpcy4jbGFzdFBvaW50ZXJDb29yZHM7CiAgICAgIFtkZWx0YVgsIGRlbHRhWV0gPSB0aGlzLnNjcmVlblRvUGFnZVRyYW5zbGF0aW9uKHNjcmVlblggLSBsYXN0U2NyZWVuWCwgc2NyZWVuWSAtIGxhc3RTY3JlZW5ZKTsKICAgICAgdGhpcy4jbGFzdFBvaW50ZXJDb29yZHNbMF0gPSBzY3JlZW5YOwogICAgICB0aGlzLiNsYXN0UG9pbnRlckNvb3Jkc1sxXSA9IHNjcmVlblk7CiAgICB9IGVsc2UgewogICAgICAoewogICAgICAgIGRlbHRhWCwKICAgICAgICBkZWx0YVkKICAgICAgfSA9IGV2ZW50KTsKICAgIH0KICAgIFtkZWx0YVgsIGRlbHRhWV0gPSBpbnZUcmFuc2YoZGVsdGFYIC8gcGFyZW50V2lkdGgsIGRlbHRhWSAvIHBhcmVudEhlaWdodCk7CiAgICBpZiAoaXNEaWFnb25hbCkgewogICAgICBjb25zdCBvbGREaWFnID0gTWF0aC5oeXBvdChzYXZlZFdpZHRoLCBzYXZlZEhlaWdodCk7CiAgICAgIHJhdGlvWCA9IHJhdGlvWSA9IE1hdGgubWF4KE1hdGgubWluKE1hdGguaHlwb3Qob3Bwb3NpdGVQb2ludFswXSAtIHBvaW50WzBdIC0gZGVsdGFYLCBvcHBvc2l0ZVBvaW50WzFdIC0gcG9pbnRbMV0gLSBkZWx0YVkpIC8gb2xkRGlhZywgMSAvIHNhdmVkV2lkdGgsIDEgLyBzYXZlZEhlaWdodCksIG1pbldpZHRoIC8gc2F2ZWRXaWR0aCwgbWluSGVpZ2h0IC8gc2F2ZWRIZWlnaHQpOwogICAgfSBlbHNlIGlmIChpc0hvcml6b250YWwpIHsKICAgICAgcmF0aW9YID0gTWF0aENsYW1wKE1hdGguYWJzKG9wcG9zaXRlUG9pbnRbMF0gLSBwb2ludFswXSAtIGRlbHRhWCksIG1pbldpZHRoLCAxKSAvIHNhdmVkV2lkdGg7CiAgICB9IGVsc2UgewogICAgICByYXRpb1kgPSBNYXRoQ2xhbXAoTWF0aC5hYnMob3Bwb3NpdGVQb2ludFsxXSAtIHBvaW50WzFdIC0gZGVsdGFZKSwgbWluSGVpZ2h0LCAxKSAvIHNhdmVkSGVpZ2h0OwogICAgfQogICAgY29uc3QgbmV3V2lkdGggPSBBbm5vdGF0aW9uRWRpdG9yLl9yb3VuZChzYXZlZFdpZHRoICogcmF0aW9YKTsKICAgIGNvbnN0IG5ld0hlaWdodCA9IEFubm90YXRpb25FZGl0b3IuX3JvdW5kKHNhdmVkSGVpZ2h0ICogcmF0aW9ZKTsKICAgIHRyYW5zZk9wcG9zaXRlUG9pbnQgPSB0cmFuc2YoLi4uZ2V0T3Bwb3NpdGUobmV3V2lkdGgsIG5ld0hlaWdodCkpOwogICAgY29uc3QgbmV3WCA9IG9wcG9zaXRlWCAtIHRyYW5zZk9wcG9zaXRlUG9pbnRbMF07CiAgICBjb25zdCBuZXdZID0gb3Bwb3NpdGVZIC0gdHJhbnNmT3Bwb3NpdGVQb2ludFsxXTsKICAgIHRoaXMuI2luaXRpYWxSZWN0IHx8PSBbdGhpcy54LCB0aGlzLnksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0XTsKICAgIHRoaXMud2lkdGggPSBuZXdXaWR0aDsKICAgIHRoaXMuaGVpZ2h0ID0gbmV3SGVpZ2h0OwogICAgdGhpcy54ID0gbmV3WDsKICAgIHRoaXMueSA9IG5ld1k7CiAgICB0aGlzLnNldERpbXMocGFyZW50V2lkdGggKiBuZXdXaWR0aCwgcGFyZW50SGVpZ2h0ICogbmV3SGVpZ2h0KTsKICAgIHRoaXMuZml4QW5kU2V0UG9zaXRpb24oKTsKICAgIHRoaXMuX29uUmVzaXppbmcoKTsKICB9CiAgX29uUmVzaXppbmcoKSB7fQogIGFsdFRleHRGaW5pc2goKSB7CiAgICB0aGlzLiNhbHRUZXh0Py5maW5pc2goKTsKICB9CiAgYXN5bmMgYWRkRWRpdFRvb2xiYXIoKSB7CiAgICBpZiAodGhpcy5fZWRpdFRvb2xiYXIgfHwgdGhpcy4jaXNJbkVkaXRNb2RlKSB7CiAgICAgIHJldHVybiB0aGlzLl9lZGl0VG9vbGJhcjsKICAgIH0KICAgIHRoaXMuX2VkaXRUb29sYmFyID0gbmV3IEVkaXRvclRvb2xiYXIodGhpcyk7CiAgICB0aGlzLmRpdi5hcHBlbmQodGhpcy5fZWRpdFRvb2xiYXIucmVuZGVyKCkpOwogICAgaWYgKHRoaXMuI2FsdFRleHQpIHsKICAgICAgYXdhaXQgdGhpcy5fZWRpdFRvb2xiYXIuYWRkQWx0VGV4dCh0aGlzLiNhbHRUZXh0KTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9lZGl0VG9vbGJhcjsKICB9CiAgcmVtb3ZlRWRpdFRvb2xiYXIoKSB7CiAgICBpZiAoIXRoaXMuX2VkaXRUb29sYmFyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2VkaXRUb29sYmFyLnJlbW92ZSgpOwogICAgdGhpcy5fZWRpdFRvb2xiYXIgPSBudWxsOwogICAgdGhpcy4jYWx0VGV4dD8uZGVzdHJveSgpOwogIH0KICBhZGRDb250YWluZXIoY29udGFpbmVyKSB7CiAgICBjb25zdCBlZGl0VG9vbGJhckRpdiA9IHRoaXMuX2VkaXRUb29sYmFyPy5kaXY7CiAgICBpZiAoZWRpdFRvb2xiYXJEaXYpIHsKICAgICAgZWRpdFRvb2xiYXJEaXYuYmVmb3JlKGNvbnRhaW5lcik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmRpdi5hcHBlbmQoY29udGFpbmVyKTsKICAgIH0KICB9CiAgZ2V0Q2xpZW50RGltZW5zaW9ucygpIHsKICAgIHJldHVybiB0aGlzLmRpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICB9CiAgYXN5bmMgYWRkQWx0VGV4dEJ1dHRvbigpIHsKICAgIGlmICh0aGlzLiNhbHRUZXh0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIEFsdFRleHQuaW5pdGlhbGl6ZShBbm5vdGF0aW9uRWRpdG9yLl9sMTBuKTsKICAgIHRoaXMuI2FsdFRleHQgPSBuZXcgQWx0VGV4dCh0aGlzKTsKICAgIGlmICh0aGlzLiNhY2Nlc3NpYmlsaXR5RGF0YSkgewogICAgICB0aGlzLiNhbHRUZXh0LmRhdGEgPSB0aGlzLiNhY2Nlc3NpYmlsaXR5RGF0YTsKICAgICAgdGhpcy4jYWNjZXNzaWJpbGl0eURhdGEgPSBudWxsOwogICAgfQogICAgYXdhaXQgdGhpcy5hZGRFZGl0VG9vbGJhcigpOwogIH0KICBnZXQgYWx0VGV4dERhdGEoKSB7CiAgICByZXR1cm4gdGhpcy4jYWx0VGV4dD8uZGF0YTsKICB9CiAgc2V0IGFsdFRleHREYXRhKGRhdGEpIHsKICAgIGlmICghdGhpcy4jYWx0VGV4dCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNhbHRUZXh0LmRhdGEgPSBkYXRhOwogIH0KICBnZXQgZ3Vlc3NlZEFsdFRleHQoKSB7CiAgICByZXR1cm4gdGhpcy4jYWx0VGV4dD8uZ3Vlc3NlZFRleHQ7CiAgfQogIGFzeW5jIHNldEd1ZXNzZWRBbHRUZXh0KHRleHQpIHsKICAgIGF3YWl0IHRoaXMuI2FsdFRleHQ/LnNldEd1ZXNzZWRUZXh0KHRleHQpOwogIH0KICBzZXJpYWxpemVBbHRUZXh0KGlzRm9yQ29weWluZykgewogICAgcmV0dXJuIHRoaXMuI2FsdFRleHQ/LnNlcmlhbGl6ZShpc0ZvckNvcHlpbmcpOwogIH0KICBoYXNBbHRUZXh0KCkgewogICAgcmV0dXJuICEhdGhpcy4jYWx0VGV4dCAmJiAhdGhpcy4jYWx0VGV4dC5pc0VtcHR5KCk7CiAgfQogIGhhc0FsdFRleHREYXRhKCkgewogICAgcmV0dXJuIHRoaXMuI2FsdFRleHQ/Lmhhc0RhdGEoKSA/PyBmYWxzZTsKICB9CiAgcmVuZGVyKCkgewogICAgY29uc3QgZGl2ID0gdGhpcy5kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtZWRpdG9yLXJvdGF0aW9uIiwgKDM2MCAtIHRoaXMucm90YXRpb24pICUgMzYwKTsKICAgIGRpdi5jbGFzc05hbWUgPSB0aGlzLm5hbWU7CiAgICBkaXYuc2V0QXR0cmlidXRlKCJpZCIsIHRoaXMuaWQpOwogICAgZGl2LnRhYkluZGV4ID0gdGhpcy4jZGlzYWJsZWQgPyAtMSA6IDA7CiAgICBkaXYuc2V0QXR0cmlidXRlKCJyb2xlIiwgImFwcGxpY2F0aW9uIik7CiAgICBpZiAodGhpcy5kZWZhdWx0TDEwbklkKSB7CiAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsIHRoaXMuZGVmYXVsdEwxMG5JZCk7CiAgICB9CiAgICBpZiAoIXRoaXMuX2lzVmlzaWJsZSkgewogICAgICBkaXYuY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICB9CiAgICB0aGlzLnNldEluRm9yZWdyb3VuZCgpOwogICAgdGhpcy4jYWRkRm9jdXNMaXN0ZW5lcnMoKTsKICAgIGNvbnN0IFtwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0XSA9IHRoaXMucGFyZW50RGltZW5zaW9uczsKICAgIGlmICh0aGlzLnBhcmVudFJvdGF0aW9uICUgMTgwICE9PSAwKSB7CiAgICAgIGRpdi5zdHlsZS5tYXhXaWR0aCA9IGAkeygxMDAgKiBwYXJlbnRIZWlnaHQgLyBwYXJlbnRXaWR0aCkudG9GaXhlZCgyKX0lYDsKICAgICAgZGl2LnN0eWxlLm1heEhlaWdodCA9IGAkeygxMDAgKiBwYXJlbnRXaWR0aCAvIHBhcmVudEhlaWdodCkudG9GaXhlZCgyKX0lYDsKICAgIH0KICAgIGNvbnN0IFt0eCwgdHldID0gdGhpcy5nZXRJbml0aWFsVHJhbnNsYXRpb24oKTsKICAgIHRoaXMudHJhbnNsYXRlKHR4LCB0eSk7CiAgICBiaW5kRXZlbnRzKHRoaXMsIGRpdiwgWyJrZXlkb3duIiwgInBvaW50ZXJkb3duIiwgImRibGNsaWNrIl0pOwogICAgaWYgKHRoaXMuaXNSZXNpemFibGUgJiYgdGhpcy5fdWlNYW5hZ2VyLl9zdXBwb3J0c1BpbmNoVG9ab29tKSB7CiAgICAgIHRoaXMuI3RvdWNoTWFuYWdlciB8fD0gbmV3IFRvdWNoTWFuYWdlcih7CiAgICAgICAgY29udGFpbmVyOiBkaXYsCiAgICAgICAgaXNQaW5jaGluZ0Rpc2FibGVkOiAoKSA9PiAhdGhpcy5pc1NlbGVjdGVkLAogICAgICAgIG9uUGluY2hTdGFydDogdGhpcy4jdG91Y2hQaW5jaFN0YXJ0Q2FsbGJhY2suYmluZCh0aGlzKSwKICAgICAgICBvblBpbmNoaW5nOiB0aGlzLiN0b3VjaFBpbmNoQ2FsbGJhY2suYmluZCh0aGlzKSwKICAgICAgICBvblBpbmNoRW5kOiB0aGlzLiN0b3VjaFBpbmNoRW5kQ2FsbGJhY2suYmluZCh0aGlzKSwKICAgICAgICBzaWduYWw6IHRoaXMuX3VpTWFuYWdlci5fc2lnbmFsCiAgICAgIH0pOwogICAgfQogICAgdGhpcy5fdWlNYW5hZ2VyLl9lZGl0b3JVbmRvQmFyPy5oaWRlKCk7CiAgICByZXR1cm4gZGl2OwogIH0KICAjdG91Y2hQaW5jaFN0YXJ0Q2FsbGJhY2soKSB7CiAgICB0aGlzLiNzYXZlZERpbWVuc2lvbnMgPSB7CiAgICAgIHNhdmVkWDogdGhpcy54LAogICAgICBzYXZlZFk6IHRoaXMueSwKICAgICAgc2F2ZWRXaWR0aDogdGhpcy53aWR0aCwKICAgICAgc2F2ZWRIZWlnaHQ6IHRoaXMuaGVpZ2h0CiAgICB9OwogICAgdGhpcy4jYWx0VGV4dD8udG9nZ2xlKGZhbHNlKTsKICAgIHRoaXMucGFyZW50LnRvZ2dsZVBvaW50ZXJFdmVudHMoZmFsc2UpOwogIH0KICAjdG91Y2hQaW5jaENhbGxiYWNrKF9vcmlnaW4sIHByZXZEaXN0YW5jZSwgZGlzdGFuY2UpIHsKICAgIGNvbnN0IHNsb3dEb3duRmFjdG9yID0gMC43OwogICAgbGV0IGZhY3RvciA9IHNsb3dEb3duRmFjdG9yICogKGRpc3RhbmNlIC8gcHJldkRpc3RhbmNlKSArIDEgLSBzbG93RG93bkZhY3RvcjsKICAgIGlmIChmYWN0b3IgPT09IDEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgcm90YXRpb25NYXRyaXggPSB0aGlzLiNnZXRSb3RhdGlvbk1hdHJpeCh0aGlzLnJvdGF0aW9uKTsKICAgIGNvbnN0IHRyYW5zZiA9ICh4LCB5KSA9PiBbcm90YXRpb25NYXRyaXhbMF0gKiB4ICsgcm90YXRpb25NYXRyaXhbMl0gKiB5LCByb3RhdGlvbk1hdHJpeFsxXSAqIHggKyByb3RhdGlvbk1hdHJpeFszXSAqIHldOwogICAgY29uc3QgW3BhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHRdID0gdGhpcy5wYXJlbnREaW1lbnNpb25zOwogICAgY29uc3Qgc2F2ZWRYID0gdGhpcy54OwogICAgY29uc3Qgc2F2ZWRZID0gdGhpcy55OwogICAgY29uc3Qgc2F2ZWRXaWR0aCA9IHRoaXMud2lkdGg7CiAgICBjb25zdCBzYXZlZEhlaWdodCA9IHRoaXMuaGVpZ2h0OwogICAgY29uc3QgbWluV2lkdGggPSBBbm5vdGF0aW9uRWRpdG9yLk1JTl9TSVpFIC8gcGFyZW50V2lkdGg7CiAgICBjb25zdCBtaW5IZWlnaHQgPSBBbm5vdGF0aW9uRWRpdG9yLk1JTl9TSVpFIC8gcGFyZW50SGVpZ2h0OwogICAgZmFjdG9yID0gTWF0aC5tYXgoTWF0aC5taW4oZmFjdG9yLCAxIC8gc2F2ZWRXaWR0aCwgMSAvIHNhdmVkSGVpZ2h0KSwgbWluV2lkdGggLyBzYXZlZFdpZHRoLCBtaW5IZWlnaHQgLyBzYXZlZEhlaWdodCk7CiAgICBjb25zdCBuZXdXaWR0aCA9IEFubm90YXRpb25FZGl0b3IuX3JvdW5kKHNhdmVkV2lkdGggKiBmYWN0b3IpOwogICAgY29uc3QgbmV3SGVpZ2h0ID0gQW5ub3RhdGlvbkVkaXRvci5fcm91bmQoc2F2ZWRIZWlnaHQgKiBmYWN0b3IpOwogICAgaWYgKG5ld1dpZHRoID09PSBzYXZlZFdpZHRoICYmIG5ld0hlaWdodCA9PT0gc2F2ZWRIZWlnaHQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jaW5pdGlhbFJlY3QgfHw9IFtzYXZlZFgsIHNhdmVkWSwgc2F2ZWRXaWR0aCwgc2F2ZWRIZWlnaHRdOwogICAgY29uc3QgdHJhbnNmQ2VudGVyUG9pbnQgPSB0cmFuc2Yoc2F2ZWRXaWR0aCAvIDIsIHNhdmVkSGVpZ2h0IC8gMik7CiAgICBjb25zdCBjZW50ZXJYID0gQW5ub3RhdGlvbkVkaXRvci5fcm91bmQoc2F2ZWRYICsgdHJhbnNmQ2VudGVyUG9pbnRbMF0pOwogICAgY29uc3QgY2VudGVyWSA9IEFubm90YXRpb25FZGl0b3IuX3JvdW5kKHNhdmVkWSArIHRyYW5zZkNlbnRlclBvaW50WzFdKTsKICAgIGNvbnN0IG5ld1RyYW5zZkNlbnRlclBvaW50ID0gdHJhbnNmKG5ld1dpZHRoIC8gMiwgbmV3SGVpZ2h0IC8gMik7CiAgICB0aGlzLnggPSBjZW50ZXJYIC0gbmV3VHJhbnNmQ2VudGVyUG9pbnRbMF07CiAgICB0aGlzLnkgPSBjZW50ZXJZIC0gbmV3VHJhbnNmQ2VudGVyUG9pbnRbMV07CiAgICB0aGlzLndpZHRoID0gbmV3V2lkdGg7CiAgICB0aGlzLmhlaWdodCA9IG5ld0hlaWdodDsKICAgIHRoaXMuc2V0RGltcyhwYXJlbnRXaWR0aCAqIG5ld1dpZHRoLCBwYXJlbnRIZWlnaHQgKiBuZXdIZWlnaHQpOwogICAgdGhpcy5maXhBbmRTZXRQb3NpdGlvbigpOwogICAgdGhpcy5fb25SZXNpemluZygpOwogIH0KICAjdG91Y2hQaW5jaEVuZENhbGxiYWNrKCkgewogICAgdGhpcy4jYWx0VGV4dD8udG9nZ2xlKHRydWUpOwogICAgdGhpcy5wYXJlbnQudG9nZ2xlUG9pbnRlckV2ZW50cyh0cnVlKTsKICAgIHRoaXMuI2FkZFJlc2l6ZVRvVW5kb1N0YWNrKCk7CiAgfQogIHBvaW50ZXJkb3duKGV2ZW50KSB7CiAgICBjb25zdCB7CiAgICAgIGlzTWFjCiAgICB9ID0gdXRpbF9GZWF0dXJlVGVzdC5wbGF0Zm9ybTsKICAgIGlmIChldmVudC5idXR0b24gIT09IDAgfHwgZXZlbnQuY3RybEtleSAmJiBpc01hYykgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNoYXNCZWVuQ2xpY2tlZCA9IHRydWU7CiAgICBpZiAodGhpcy5faXNEcmFnZ2FibGUpIHsKICAgICAgdGhpcy4jc2V0VXBEcmFnU2Vzc2lvbihldmVudCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI3NlbGVjdE9uUG9pbnRlckV2ZW50KGV2ZW50KTsKICB9CiAgI3NlbGVjdE9uUG9pbnRlckV2ZW50KGV2ZW50KSB7CiAgICBjb25zdCB7CiAgICAgIGlzTWFjCiAgICB9ID0gdXRpbF9GZWF0dXJlVGVzdC5wbGF0Zm9ybTsKICAgIGlmIChldmVudC5jdHJsS2V5ICYmICFpc01hYyB8fCBldmVudC5zaGlmdEtleSB8fCBldmVudC5tZXRhS2V5ICYmIGlzTWFjKSB7CiAgICAgIHRoaXMucGFyZW50LnRvZ2dsZVNlbGVjdGVkKHRoaXMpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5wYXJlbnQuc2V0U2VsZWN0ZWQodGhpcyk7CiAgICB9CiAgfQogICNzZXRVcERyYWdTZXNzaW9uKGV2ZW50KSB7CiAgICBjb25zdCB7CiAgICAgIGlzU2VsZWN0ZWQKICAgIH0gPSB0aGlzOwogICAgdGhpcy5fdWlNYW5hZ2VyLnNldFVwRHJhZ1Nlc3Npb24oKTsKICAgIGxldCBoYXNEcmFnZ2luZ1N0YXJ0ZWQgPSBmYWxzZTsKICAgIGNvbnN0IGFjID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgY29uc3Qgc2lnbmFsID0gdGhpcy5fdWlNYW5hZ2VyLmNvbWJpbmVkU2lnbmFsKGFjKTsKICAgIGNvbnN0IG9wdHMgPSB7CiAgICAgIGNhcHR1cmU6IHRydWUsCiAgICAgIHBhc3NpdmU6IGZhbHNlLAogICAgICBzaWduYWwKICAgIH07CiAgICBjb25zdCBjYW5jZWxEcmFnID0gZSA9PiB7CiAgICAgIGFjLmFib3J0KCk7CiAgICAgIHRoaXMuI2RyYWdQb2ludGVySWQgPSBudWxsOwogICAgICB0aGlzLiNoYXNCZWVuQ2xpY2tlZCA9IGZhbHNlOwogICAgICBpZiAoIXRoaXMuX3VpTWFuYWdlci5lbmREcmFnU2Vzc2lvbigpKSB7CiAgICAgICAgdGhpcy4jc2VsZWN0T25Qb2ludGVyRXZlbnQoZSk7CiAgICAgIH0KICAgICAgaWYgKGhhc0RyYWdnaW5nU3RhcnRlZCkgewogICAgICAgIHRoaXMuX29uU3RvcERyYWdnaW5nKCk7CiAgICAgIH0KICAgIH07CiAgICBpZiAoaXNTZWxlY3RlZCkgewogICAgICB0aGlzLiNwcmV2RHJhZ1ggPSBldmVudC5jbGllbnRYOwogICAgICB0aGlzLiNwcmV2RHJhZ1kgPSBldmVudC5jbGllbnRZOwogICAgICB0aGlzLiNkcmFnUG9pbnRlcklkID0gZXZlbnQucG9pbnRlcklkOwogICAgICB0aGlzLiNkcmFnUG9pbnRlclR5cGUgPSBldmVudC5wb2ludGVyVHlwZTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgZSA9PiB7CiAgICAgICAgaWYgKCFoYXNEcmFnZ2luZ1N0YXJ0ZWQpIHsKICAgICAgICAgIGhhc0RyYWdnaW5nU3RhcnRlZCA9IHRydWU7CiAgICAgICAgICB0aGlzLl9vblN0YXJ0RHJhZ2dpbmcoKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgewogICAgICAgICAgY2xpZW50WDogeCwKICAgICAgICAgIGNsaWVudFk6IHksCiAgICAgICAgICBwb2ludGVySWQKICAgICAgICB9ID0gZTsKICAgICAgICBpZiAocG9pbnRlcklkICE9PSB0aGlzLiNkcmFnUG9pbnRlcklkKSB7CiAgICAgICAgICBzdG9wRXZlbnQoZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IFt0eCwgdHldID0gdGhpcy5zY3JlZW5Ub1BhZ2VUcmFuc2xhdGlvbih4IC0gdGhpcy4jcHJldkRyYWdYLCB5IC0gdGhpcy4jcHJldkRyYWdZKTsKICAgICAgICB0aGlzLiNwcmV2RHJhZ1ggPSB4OwogICAgICAgIHRoaXMuI3ByZXZEcmFnWSA9IHk7CiAgICAgICAgdGhpcy5fdWlNYW5hZ2VyLmRyYWdTZWxlY3RlZEVkaXRvcnModHgsIHR5KTsKICAgICAgfSwgb3B0cyk7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaG1vdmUiLCBzdG9wRXZlbnQsIG9wdHMpOwogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBlID0+IHsKICAgICAgICBpZiAoZS5wb2ludGVyVHlwZSA9PT0gdGhpcy4jZHJhZ1BvaW50ZXJUeXBlKSB7CiAgICAgICAgICBpZiAodGhpcy4jdG91Y2hNYW5hZ2VyIHx8IGUuaXNQcmltYXJ5KSB7CiAgICAgICAgICAgIGNhbmNlbERyYWcoZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN0b3BFdmVudChlKTsKICAgICAgfSwgb3B0cyk7CiAgICB9CiAgICBjb25zdCBwb2ludGVyVXBDYWxsYmFjayA9IGUgPT4gewogICAgICBpZiAoIXRoaXMuI2RyYWdQb2ludGVySWQgfHwgdGhpcy4jZHJhZ1BvaW50ZXJJZCA9PT0gZS5wb2ludGVySWQpIHsKICAgICAgICBjYW5jZWxEcmFnKGUpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBzdG9wRXZlbnQoZSk7CiAgICB9OwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIHBvaW50ZXJVcENhbGxiYWNrLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiYmx1ciIsIHBvaW50ZXJVcENhbGxiYWNrLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgfQogIF9vblN0YXJ0RHJhZ2dpbmcoKSB7fQogIF9vblN0b3BEcmFnZ2luZygpIHt9CiAgbW92ZUluRE9NKCkgewogICAgaWYgKHRoaXMuI21vdmVJbkRPTVRpbWVvdXQpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuI21vdmVJbkRPTVRpbWVvdXQpOwogICAgfQogICAgdGhpcy4jbW92ZUluRE9NVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICB0aGlzLiNtb3ZlSW5ET01UaW1lb3V0ID0gbnVsbDsKICAgICAgdGhpcy5wYXJlbnQ/Lm1vdmVFZGl0b3JJbkRPTSh0aGlzKTsKICAgIH0sIDApOwogIH0KICBfc2V0UGFyZW50QW5kUG9zaXRpb24ocGFyZW50LCB4LCB5KSB7CiAgICBwYXJlbnQuY2hhbmdlUGFyZW50KHRoaXMpOwogICAgdGhpcy54ID0geDsKICAgIHRoaXMueSA9IHk7CiAgICB0aGlzLmZpeEFuZFNldFBvc2l0aW9uKCk7CiAgICB0aGlzLl9vblRyYW5zbGF0ZWQoKTsKICB9CiAgZ2V0UmVjdCh0eCwgdHksIHJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbikgewogICAgY29uc3Qgc2NhbGUgPSB0aGlzLnBhcmVudFNjYWxlOwogICAgY29uc3QgW3BhZ2VXaWR0aCwgcGFnZUhlaWdodF0gPSB0aGlzLnBhZ2VEaW1lbnNpb25zOwogICAgY29uc3QgW3BhZ2VYLCBwYWdlWV0gPSB0aGlzLnBhZ2VUcmFuc2xhdGlvbjsKICAgIGNvbnN0IHNoaWZ0WCA9IHR4IC8gc2NhbGU7CiAgICBjb25zdCBzaGlmdFkgPSB0eSAvIHNjYWxlOwogICAgY29uc3QgeCA9IHRoaXMueCAqIHBhZ2VXaWR0aDsKICAgIGNvbnN0IHkgPSB0aGlzLnkgKiBwYWdlSGVpZ2h0OwogICAgY29uc3Qgd2lkdGggPSB0aGlzLndpZHRoICogcGFnZVdpZHRoOwogICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKiBwYWdlSGVpZ2h0OwogICAgc3dpdGNoIChyb3RhdGlvbikgewogICAgICBjYXNlIDA6CiAgICAgICAgcmV0dXJuIFt4ICsgc2hpZnRYICsgcGFnZVgsIHBhZ2VIZWlnaHQgLSB5IC0gc2hpZnRZIC0gaGVpZ2h0ICsgcGFnZVksIHggKyBzaGlmdFggKyB3aWR0aCArIHBhZ2VYLCBwYWdlSGVpZ2h0IC0geSAtIHNoaWZ0WSArIHBhZ2VZXTsKICAgICAgY2FzZSA5MDoKICAgICAgICByZXR1cm4gW3ggKyBzaGlmdFkgKyBwYWdlWCwgcGFnZUhlaWdodCAtIHkgKyBzaGlmdFggKyBwYWdlWSwgeCArIHNoaWZ0WSArIGhlaWdodCArIHBhZ2VYLCBwYWdlSGVpZ2h0IC0geSArIHNoaWZ0WCArIHdpZHRoICsgcGFnZVldOwogICAgICBjYXNlIDE4MDoKICAgICAgICByZXR1cm4gW3ggLSBzaGlmdFggLSB3aWR0aCArIHBhZ2VYLCBwYWdlSGVpZ2h0IC0geSArIHNoaWZ0WSArIHBhZ2VZLCB4IC0gc2hpZnRYICsgcGFnZVgsIHBhZ2VIZWlnaHQgLSB5ICsgc2hpZnRZICsgaGVpZ2h0ICsgcGFnZVldOwogICAgICBjYXNlIDI3MDoKICAgICAgICByZXR1cm4gW3ggLSBzaGlmdFkgLSBoZWlnaHQgKyBwYWdlWCwgcGFnZUhlaWdodCAtIHkgLSBzaGlmdFggLSB3aWR0aCArIHBhZ2VZLCB4IC0gc2hpZnRZICsgcGFnZVgsIHBhZ2VIZWlnaHQgLSB5IC0gc2hpZnRYICsgcGFnZVldOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCByb3RhdGlvbiIpOwogICAgfQogIH0KICBnZXRSZWN0SW5DdXJyZW50Q29vcmRzKHJlY3QsIHBhZ2VIZWlnaHQpIHsKICAgIGNvbnN0IFt4MSwgeTEsIHgyLCB5Ml0gPSByZWN0OwogICAgY29uc3Qgd2lkdGggPSB4MiAtIHgxOwogICAgY29uc3QgaGVpZ2h0ID0geTIgLSB5MTsKICAgIHN3aXRjaCAodGhpcy5yb3RhdGlvbikgewogICAgICBjYXNlIDA6CiAgICAgICAgcmV0dXJuIFt4MSwgcGFnZUhlaWdodCAtIHkyLCB3aWR0aCwgaGVpZ2h0XTsKICAgICAgY2FzZSA5MDoKICAgICAgICByZXR1cm4gW3gxLCBwYWdlSGVpZ2h0IC0geTEsIGhlaWdodCwgd2lkdGhdOwogICAgICBjYXNlIDE4MDoKICAgICAgICByZXR1cm4gW3gyLCBwYWdlSGVpZ2h0IC0geTEsIHdpZHRoLCBoZWlnaHRdOwogICAgICBjYXNlIDI3MDoKICAgICAgICByZXR1cm4gW3gyLCBwYWdlSGVpZ2h0IC0geTIsIGhlaWdodCwgd2lkdGhdOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCByb3RhdGlvbiIpOwogICAgfQogIH0KICBvbmNlQWRkZWQoZm9jdXMpIHt9CiAgaXNFbXB0eSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZW5hYmxlRWRpdE1vZGUoKSB7CiAgICBpZiAodGhpcy5pc0luRWRpdE1vZGUoKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0aGlzLnBhcmVudC5zZXRFZGl0aW5nU3RhdGUoZmFsc2UpOwogICAgdGhpcy4jaXNJbkVkaXRNb2RlID0gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBkaXNhYmxlRWRpdE1vZGUoKSB7CiAgICBpZiAoIXRoaXMuaXNJbkVkaXRNb2RlKCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdGhpcy5wYXJlbnQuc2V0RWRpdGluZ1N0YXRlKHRydWUpOwogICAgdGhpcy4jaXNJbkVkaXRNb2RlID0gZmFsc2U7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgaXNJbkVkaXRNb2RlKCkgewogICAgcmV0dXJuIHRoaXMuI2lzSW5FZGl0TW9kZTsKICB9CiAgc2hvdWxkR2V0S2V5Ym9hcmRFdmVudHMoKSB7CiAgICByZXR1cm4gdGhpcy4jaXNSZXNpemVyRW5hYmxlZEZvcktleWJvYXJkOwogIH0KICBuZWVkc1RvQmVSZWJ1aWx0KCkgewogICAgcmV0dXJuIHRoaXMuZGl2ICYmICF0aGlzLmlzQXR0YWNoZWRUb0RPTTsKICB9CiAgZ2V0IGlzT25TY3JlZW4oKSB7CiAgICBjb25zdCB7CiAgICAgIHRvcCwKICAgICAgbGVmdCwKICAgICAgYm90dG9tLAogICAgICByaWdodAogICAgfSA9IHRoaXMuZ2V0Q2xpZW50RGltZW5zaW9ucygpOwogICAgY29uc3QgewogICAgICBpbm5lckhlaWdodCwKICAgICAgaW5uZXJXaWR0aAogICAgfSA9IHdpbmRvdzsKICAgIHJldHVybiBsZWZ0IDwgaW5uZXJXaWR0aCAmJiByaWdodCA+IDAgJiYgdG9wIDwgaW5uZXJIZWlnaHQgJiYgYm90dG9tID4gMDsKICB9CiAgI2FkZEZvY3VzTGlzdGVuZXJzKCkgewogICAgaWYgKHRoaXMuI2ZvY3VzQUMgfHwgIXRoaXMuZGl2KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2ZvY3VzQUMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBjb25zdCBzaWduYWwgPSB0aGlzLl91aU1hbmFnZXIuY29tYmluZWRTaWduYWwodGhpcy4jZm9jdXNBQyk7CiAgICB0aGlzLmRpdi5hZGRFdmVudExpc3RlbmVyKCJmb2N1c2luIiwgdGhpcy5mb2N1c2luLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHRoaXMuZGl2LmFkZEV2ZW50TGlzdGVuZXIoImZvY3Vzb3V0IiwgdGhpcy5mb2N1c291dC5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgfQogIHJlYnVpbGQoKSB7CiAgICB0aGlzLiNhZGRGb2N1c0xpc3RlbmVycygpOwogIH0KICByb3RhdGUoX2FuZ2xlKSB7fQogIHJlc2l6ZSgpIHt9CiAgc2VyaWFsaXplRGVsZXRlZCgpIHsKICAgIHJldHVybiB7CiAgICAgIGlkOiB0aGlzLmFubm90YXRpb25FbGVtZW50SWQsCiAgICAgIGRlbGV0ZWQ6IHRydWUsCiAgICAgIHBhZ2VJbmRleDogdGhpcy5wYWdlSW5kZXgsCiAgICAgIHBvcHVwUmVmOiB0aGlzLl9pbml0aWFsRGF0YT8ucG9wdXBSZWYgfHwgIiIKICAgIH07CiAgfQogIHNlcmlhbGl6ZShpc0ZvckNvcHlpbmcgPSBmYWxzZSwgY29udGV4dCA9IG51bGwpIHsKICAgIHVucmVhY2hhYmxlKCJBbiBlZGl0b3IgbXVzdCBiZSBzZXJpYWxpemFibGUiKTsKICB9CiAgc3RhdGljIGFzeW5jIGRlc2VyaWFsaXplKGRhdGEsIHBhcmVudCwgdWlNYW5hZ2VyKSB7CiAgICBjb25zdCBlZGl0b3IgPSBuZXcgdGhpcy5wcm90b3R5cGUuY29uc3RydWN0b3IoewogICAgICBwYXJlbnQsCiAgICAgIGlkOiBwYXJlbnQuZ2V0TmV4dElkKCksCiAgICAgIHVpTWFuYWdlcgogICAgfSk7CiAgICBlZGl0b3Iucm90YXRpb24gPSBkYXRhLnJvdGF0aW9uOwogICAgZWRpdG9yLiNhY2Nlc3NpYmlsaXR5RGF0YSA9IGRhdGEuYWNjZXNzaWJpbGl0eURhdGE7CiAgICBlZGl0b3IuX2lzQ29weSA9IGRhdGEuaXNDb3B5IHx8IGZhbHNlOwogICAgY29uc3QgW3BhZ2VXaWR0aCwgcGFnZUhlaWdodF0gPSBlZGl0b3IucGFnZURpbWVuc2lvbnM7CiAgICBjb25zdCBbeCwgeSwgd2lkdGgsIGhlaWdodF0gPSBlZGl0b3IuZ2V0UmVjdEluQ3VycmVudENvb3JkcyhkYXRhLnJlY3QsIHBhZ2VIZWlnaHQpOwogICAgZWRpdG9yLnggPSB4IC8gcGFnZVdpZHRoOwogICAgZWRpdG9yLnkgPSB5IC8gcGFnZUhlaWdodDsKICAgIGVkaXRvci53aWR0aCA9IHdpZHRoIC8gcGFnZVdpZHRoOwogICAgZWRpdG9yLmhlaWdodCA9IGhlaWdodCAvIHBhZ2VIZWlnaHQ7CiAgICByZXR1cm4gZWRpdG9yOwogIH0KICBnZXQgaGFzQmVlbk1vZGlmaWVkKCkgewogICAgcmV0dXJuICEhdGhpcy5hbm5vdGF0aW9uRWxlbWVudElkICYmICh0aGlzLmRlbGV0ZWQgfHwgdGhpcy5zZXJpYWxpemUoKSAhPT0gbnVsbCk7CiAgfQogIHJlbW92ZSgpIHsKICAgIHRoaXMuI2ZvY3VzQUM/LmFib3J0KCk7CiAgICB0aGlzLiNmb2N1c0FDID0gbnVsbDsKICAgIGlmICghdGhpcy5pc0VtcHR5KCkpIHsKICAgICAgdGhpcy5jb21taXQoKTsKICAgIH0KICAgIGlmICh0aGlzLnBhcmVudCkgewogICAgICB0aGlzLnBhcmVudC5yZW1vdmUodGhpcyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl91aU1hbmFnZXIucmVtb3ZlRWRpdG9yKHRoaXMpOwogICAgfQogICAgaWYgKHRoaXMuI21vdmVJbkRPTVRpbWVvdXQpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuI21vdmVJbkRPTVRpbWVvdXQpOwogICAgICB0aGlzLiNtb3ZlSW5ET01UaW1lb3V0ID0gbnVsbDsKICAgIH0KICAgIHRoaXMuI3N0b3BSZXNpemluZygpOwogICAgdGhpcy5yZW1vdmVFZGl0VG9vbGJhcigpOwogICAgaWYgKHRoaXMuI3RlbGVtZXRyeVRpbWVvdXRzKSB7CiAgICAgIGZvciAoY29uc3QgdGltZW91dCBvZiB0aGlzLiN0ZWxlbWV0cnlUaW1lb3V0cy52YWx1ZXMoKSkgewogICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgfQogICAgICB0aGlzLiN0ZWxlbWV0cnlUaW1lb3V0cyA9IG51bGw7CiAgICB9CiAgICB0aGlzLnBhcmVudCA9IG51bGw7CiAgICB0aGlzLiN0b3VjaE1hbmFnZXI/LmRlc3Ryb3koKTsKICAgIHRoaXMuI3RvdWNoTWFuYWdlciA9IG51bGw7CiAgfQogIGdldCBpc1Jlc2l6YWJsZSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgbWFrZVJlc2l6YWJsZSgpIHsKICAgIGlmICh0aGlzLmlzUmVzaXphYmxlKSB7CiAgICAgIHRoaXMuI2NyZWF0ZVJlc2l6ZXJzKCk7CiAgICAgIHRoaXMuI3Jlc2l6ZXJzRGl2LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOwogICAgfQogIH0KICBnZXQgdG9vbGJhclBvc2l0aW9uKCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGtleWRvd24oZXZlbnQpIHsKICAgIGlmICghdGhpcy5pc1Jlc2l6YWJsZSB8fCBldmVudC50YXJnZXQgIT09IHRoaXMuZGl2IHx8IGV2ZW50LmtleSAhPT0gIkVudGVyIikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl91aU1hbmFnZXIuc2V0U2VsZWN0ZWQodGhpcyk7CiAgICB0aGlzLiNzYXZlZERpbWVuc2lvbnMgPSB7CiAgICAgIHNhdmVkWDogdGhpcy54LAogICAgICBzYXZlZFk6IHRoaXMueSwKICAgICAgc2F2ZWRXaWR0aDogdGhpcy53aWR0aCwKICAgICAgc2F2ZWRIZWlnaHQ6IHRoaXMuaGVpZ2h0CiAgICB9OwogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLiNyZXNpemVyc0Rpdi5jaGlsZHJlbjsKICAgIGlmICghdGhpcy4jYWxsUmVzaXplckRpdnMpIHsKICAgICAgdGhpcy4jYWxsUmVzaXplckRpdnMgPSBBcnJheS5mcm9tKGNoaWxkcmVuKTsKICAgICAgY29uc3QgYm91bmRSZXNpemVyS2V5ZG93biA9IHRoaXMuI3Jlc2l6ZXJLZXlkb3duLmJpbmQodGhpcyk7CiAgICAgIGNvbnN0IGJvdW5kUmVzaXplckJsdXIgPSB0aGlzLiNyZXNpemVyQmx1ci5iaW5kKHRoaXMpOwogICAgICBjb25zdCBzaWduYWwgPSB0aGlzLl91aU1hbmFnZXIuX3NpZ25hbDsKICAgICAgZm9yIChjb25zdCBkaXYgb2YgdGhpcy4jYWxsUmVzaXplckRpdnMpIHsKICAgICAgICBjb25zdCBuYW1lID0gZGl2LmdldEF0dHJpYnV0ZSgiZGF0YS1yZXNpemVyLW5hbWUiKTsKICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCJyb2xlIiwgInNwaW5idXR0b24iKTsKICAgICAgICBkaXYuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGJvdW5kUmVzaXplcktleWRvd24sIHsKICAgICAgICAgIHNpZ25hbAogICAgICAgIH0pOwogICAgICAgIGRpdi5hZGRFdmVudExpc3RlbmVyKCJibHVyIiwgYm91bmRSZXNpemVyQmx1ciwgewogICAgICAgICAgc2lnbmFsCiAgICAgICAgfSk7CiAgICAgICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoImZvY3VzIiwgdGhpcy4jcmVzaXplckZvY3VzLmJpbmQodGhpcywgbmFtZSksIHsKICAgICAgICAgIHNpZ25hbAogICAgICAgIH0pOwogICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsIEFubm90YXRpb25FZGl0b3IuX2wxMG5SZXNpemVyW25hbWVdKTsKICAgICAgfQogICAgfQogICAgY29uc3QgZmlyc3QgPSB0aGlzLiNhbGxSZXNpemVyRGl2c1swXTsKICAgIGxldCBmaXJzdFBvc2l0aW9uID0gMDsKICAgIGZvciAoY29uc3QgZGl2IG9mIGNoaWxkcmVuKSB7CiAgICAgIGlmIChkaXYgPT09IGZpcnN0KSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgZmlyc3RQb3NpdGlvbisrOwogICAgfQogICAgY29uc3QgbmV4dEZpcnN0UG9zaXRpb24gPSAoMzYwIC0gdGhpcy5yb3RhdGlvbiArIHRoaXMucGFyZW50Um90YXRpb24pICUgMzYwIC8gOTAgKiAodGhpcy4jYWxsUmVzaXplckRpdnMubGVuZ3RoIC8gNCk7CiAgICBpZiAobmV4dEZpcnN0UG9zaXRpb24gIT09IGZpcnN0UG9zaXRpb24pIHsKICAgICAgaWYgKG5leHRGaXJzdFBvc2l0aW9uIDwgZmlyc3RQb3NpdGlvbikgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlyc3RQb3NpdGlvbiAtIG5leHRGaXJzdFBvc2l0aW9uOyBpKyspIHsKICAgICAgICAgIHRoaXMuI3Jlc2l6ZXJzRGl2LmFwcGVuZCh0aGlzLiNyZXNpemVyc0Rpdi5maXJzdENoaWxkKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobmV4dEZpcnN0UG9zaXRpb24gPiBmaXJzdFBvc2l0aW9uKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXh0Rmlyc3RQb3NpdGlvbiAtIGZpcnN0UG9zaXRpb247IGkrKykgewogICAgICAgICAgdGhpcy4jcmVzaXplcnNEaXYuZmlyc3RDaGlsZC5iZWZvcmUodGhpcy4jcmVzaXplcnNEaXYubGFzdENoaWxkKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbGV0IGkgPSAwOwogICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGNoaWxkcmVuKSB7CiAgICAgICAgY29uc3QgZGl2ID0gdGhpcy4jYWxsUmVzaXplckRpdnNbaSsrXTsKICAgICAgICBjb25zdCBuYW1lID0gZGl2LmdldEF0dHJpYnV0ZSgiZGF0YS1yZXNpemVyLW5hbWUiKTsKICAgICAgICBjaGlsZC5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsIEFubm90YXRpb25FZGl0b3IuX2wxMG5SZXNpemVyW25hbWVdKTsKICAgICAgfQogICAgfQogICAgdGhpcy4jc2V0UmVzaXplclRhYkluZGV4KDApOwogICAgdGhpcy4jaXNSZXNpemVyRW5hYmxlZEZvcktleWJvYXJkID0gdHJ1ZTsKICAgIHRoaXMuI3Jlc2l6ZXJzRGl2LmZpcnN0Q2hpbGQuZm9jdXMoewogICAgICBmb2N1c1Zpc2libGU6IHRydWUKICAgIH0pOwogICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogIH0KICAjcmVzaXplcktleWRvd24oZXZlbnQpIHsKICAgIEFubm90YXRpb25FZGl0b3IuX3Jlc2l6ZXJLZXlib2FyZE1hbmFnZXIuZXhlYyh0aGlzLCBldmVudCk7CiAgfQogICNyZXNpemVyQmx1cihldmVudCkgewogICAgaWYgKHRoaXMuI2lzUmVzaXplckVuYWJsZWRGb3JLZXlib2FyZCAmJiBldmVudC5yZWxhdGVkVGFyZ2V0Py5wYXJlbnROb2RlICE9PSB0aGlzLiNyZXNpemVyc0RpdikgewogICAgICB0aGlzLiNzdG9wUmVzaXppbmcoKTsKICAgIH0KICB9CiAgI3Jlc2l6ZXJGb2N1cyhuYW1lKSB7CiAgICB0aGlzLiNmb2N1c2VkUmVzaXplck5hbWUgPSB0aGlzLiNpc1Jlc2l6ZXJFbmFibGVkRm9yS2V5Ym9hcmQgPyBuYW1lIDogIiI7CiAgfQogICNzZXRSZXNpemVyVGFiSW5kZXgodmFsdWUpIHsKICAgIGlmICghdGhpcy4jYWxsUmVzaXplckRpdnMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBkaXYgb2YgdGhpcy4jYWxsUmVzaXplckRpdnMpIHsKICAgICAgZGl2LnRhYkluZGV4ID0gdmFsdWU7CiAgICB9CiAgfQogIF9yZXNpemVXaXRoS2V5Ym9hcmQoeCwgeSkgewogICAgaWYgKCF0aGlzLiNpc1Jlc2l6ZXJFbmFibGVkRm9yS2V5Ym9hcmQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jcmVzaXplclBvaW50ZXJtb3ZlKHRoaXMuI2ZvY3VzZWRSZXNpemVyTmFtZSwgewogICAgICBkZWx0YVg6IHgsCiAgICAgIGRlbHRhWTogeSwKICAgICAgZnJvbUtleWJvYXJkOiB0cnVlCiAgICB9KTsKICB9CiAgI3N0b3BSZXNpemluZygpIHsKICAgIHRoaXMuI2lzUmVzaXplckVuYWJsZWRGb3JLZXlib2FyZCA9IGZhbHNlOwogICAgdGhpcy4jc2V0UmVzaXplclRhYkluZGV4KC0xKTsKICAgIHRoaXMuI2FkZFJlc2l6ZVRvVW5kb1N0YWNrKCk7CiAgfQogIF9zdG9wUmVzaXppbmdXaXRoS2V5Ym9hcmQoKSB7CiAgICB0aGlzLiNzdG9wUmVzaXppbmcoKTsKICAgIHRoaXMuZGl2LmZvY3VzKCk7CiAgfQogIHNlbGVjdCgpIHsKICAgIGlmICh0aGlzLmlzU2VsZWN0ZWQgJiYgdGhpcy5fZWRpdFRvb2xiYXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5pc1NlbGVjdGVkID0gdHJ1ZTsKICAgIHRoaXMubWFrZVJlc2l6YWJsZSgpOwogICAgdGhpcy5kaXY/LmNsYXNzTGlzdC5hZGQoInNlbGVjdGVkRWRpdG9yIik7CiAgICBpZiAoIXRoaXMuX2VkaXRUb29sYmFyKSB7CiAgICAgIHRoaXMuYWRkRWRpdFRvb2xiYXIoKS50aGVuKCgpID0+IHsKICAgICAgICBpZiAodGhpcy5kaXY/LmNsYXNzTGlzdC5jb250YWlucygic2VsZWN0ZWRFZGl0b3IiKSkgewogICAgICAgICAgdGhpcy5fZWRpdFRvb2xiYXI/LnNob3coKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9lZGl0VG9vbGJhcj8uc2hvdygpOwogICAgdGhpcy4jYWx0VGV4dD8udG9nZ2xlQWx0VGV4dEJhZGdlKGZhbHNlKTsKICB9CiAgdW5zZWxlY3QoKSB7CiAgICBpZiAoIXRoaXMuaXNTZWxlY3RlZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmlzU2VsZWN0ZWQgPSBmYWxzZTsKICAgIHRoaXMuI3Jlc2l6ZXJzRGl2Py5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgIHRoaXMuZGl2Py5jbGFzc0xpc3QucmVtb3ZlKCJzZWxlY3RlZEVkaXRvciIpOwogICAgaWYgKHRoaXMuZGl2Py5jb250YWlucyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KSkgewogICAgICB0aGlzLl91aU1hbmFnZXIuY3VycmVudExheWVyLmRpdi5mb2N1cyh7CiAgICAgICAgcHJldmVudFNjcm9sbDogdHJ1ZQogICAgICB9KTsKICAgIH0KICAgIHRoaXMuX2VkaXRUb29sYmFyPy5oaWRlKCk7CiAgICB0aGlzLiNhbHRUZXh0Py50b2dnbGVBbHRUZXh0QmFkZ2UodHJ1ZSk7CiAgfQogIHVwZGF0ZVBhcmFtcyh0eXBlLCB2YWx1ZSkge30KICBkaXNhYmxlRWRpdGluZygpIHt9CiAgZW5hYmxlRWRpdGluZygpIHt9CiAgZ2V0IGNhbkNoYW5nZUNvbnRlbnQoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGVudGVySW5FZGl0TW9kZSgpIHsKICAgIGlmICghdGhpcy5jYW5DaGFuZ2VDb250ZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZW5hYmxlRWRpdE1vZGUoKTsKICAgIHRoaXMuZGl2LmZvY3VzKCk7CiAgfQogIGRibGNsaWNrKGV2ZW50KSB7CiAgICB0aGlzLmVudGVySW5FZGl0TW9kZSgpOwogICAgdGhpcy5wYXJlbnQudXBkYXRlVG9vbGJhcih7CiAgICAgIG1vZGU6IHRoaXMuY29uc3RydWN0b3IuX2VkaXRvclR5cGUsCiAgICAgIGVkaXRJZDogdGhpcy5pZAogICAgfSk7CiAgfQogIGdldEVsZW1lbnRGb3JBbHRUZXh0KCkgewogICAgcmV0dXJuIHRoaXMuZGl2OwogIH0KICBnZXQgY29udGVudERpdigpIHsKICAgIHJldHVybiB0aGlzLmRpdjsKICB9CiAgZ2V0IGlzRWRpdGluZygpIHsKICAgIHJldHVybiB0aGlzLiNpc0VkaXRpbmc7CiAgfQogIHNldCBpc0VkaXRpbmcodmFsdWUpIHsKICAgIHRoaXMuI2lzRWRpdGluZyA9IHZhbHVlOwogICAgaWYgKCF0aGlzLnBhcmVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodmFsdWUpIHsKICAgICAgdGhpcy5wYXJlbnQuc2V0U2VsZWN0ZWQodGhpcyk7CiAgICAgIHRoaXMucGFyZW50LnNldEFjdGl2ZUVkaXRvcih0aGlzKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMucGFyZW50LnNldEFjdGl2ZUVkaXRvcihudWxsKTsKICAgIH0KICB9CiAgc2V0QXNwZWN0UmF0aW8od2lkdGgsIGhlaWdodCkgewogICAgdGhpcy4ja2VlcEFzcGVjdFJhdGlvID0gdHJ1ZTsKICAgIGNvbnN0IGFzcGVjdFJhdGlvID0gd2lkdGggLyBoZWlnaHQ7CiAgICBjb25zdCB7CiAgICAgIHN0eWxlCiAgICB9ID0gdGhpcy5kaXY7CiAgICBzdHlsZS5hc3BlY3RSYXRpbyA9IGFzcGVjdFJhdGlvOwogICAgc3R5bGUuaGVpZ2h0ID0gImF1dG8iOwogIH0KICBzdGF0aWMgZ2V0IE1JTl9TSVpFKCkgewogICAgcmV0dXJuIDE2OwogIH0KICBzdGF0aWMgY2FuQ3JlYXRlTmV3RW1wdHlFZGl0b3IoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZ2V0IHRlbGVtZXRyeUluaXRpYWxEYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgYWN0aW9uOiAiYWRkZWQiCiAgICB9OwogIH0KICBnZXQgdGVsZW1ldHJ5RmluYWxEYXRhKCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIF9yZXBvcnRUZWxlbWV0cnkoZGF0YSwgbXVzdFdhaXQgPSBmYWxzZSkgewogICAgaWYgKG11c3RXYWl0KSB7CiAgICAgIHRoaXMuI3RlbGVtZXRyeVRpbWVvdXRzIHx8PSBuZXcgTWFwKCk7CiAgICAgIGNvbnN0IHsKICAgICAgICBhY3Rpb24KICAgICAgfSA9IGRhdGE7CiAgICAgIGxldCB0aW1lb3V0ID0gdGhpcy4jdGVsZW1ldHJ5VGltZW91dHMuZ2V0KGFjdGlvbik7CiAgICAgIGlmICh0aW1lb3V0KSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICB9CiAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLl9yZXBvcnRUZWxlbWV0cnkoZGF0YSk7CiAgICAgICAgdGhpcy4jdGVsZW1ldHJ5VGltZW91dHMuZGVsZXRlKGFjdGlvbik7CiAgICAgICAgaWYgKHRoaXMuI3RlbGVtZXRyeVRpbWVvdXRzLnNpemUgPT09IDApIHsKICAgICAgICAgIHRoaXMuI3RlbGVtZXRyeVRpbWVvdXRzID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIEFubm90YXRpb25FZGl0b3IuX3RlbGVtZXRyeVRpbWVvdXQpOwogICAgICB0aGlzLiN0ZWxlbWV0cnlUaW1lb3V0cy5zZXQoYWN0aW9uLCB0aW1lb3V0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZGF0YS50eXBlIHx8PSB0aGlzLmVkaXRvclR5cGU7CiAgICB0aGlzLl91aU1hbmFnZXIuX2V2ZW50QnVzLmRpc3BhdGNoKCJyZXBvcnR0ZWxlbWV0cnkiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgZGV0YWlsczogewogICAgICAgIHR5cGU6ICJlZGl0aW5nIiwKICAgICAgICBkYXRhCiAgICAgIH0KICAgIH0pOwogIH0KICBzaG93KHZpc2libGUgPSB0aGlzLl9pc1Zpc2libGUpIHsKICAgIHRoaXMuZGl2LmNsYXNzTGlzdC50b2dnbGUoImhpZGRlbiIsICF2aXNpYmxlKTsKICAgIHRoaXMuX2lzVmlzaWJsZSA9IHZpc2libGU7CiAgfQogIGVuYWJsZSgpIHsKICAgIGlmICh0aGlzLmRpdikgewogICAgICB0aGlzLmRpdi50YWJJbmRleCA9IDA7CiAgICB9CiAgICB0aGlzLiNkaXNhYmxlZCA9IGZhbHNlOwogIH0KICBkaXNhYmxlKCkgewogICAgaWYgKHRoaXMuZGl2KSB7CiAgICAgIHRoaXMuZGl2LnRhYkluZGV4ID0gLTE7CiAgICB9CiAgICB0aGlzLiNkaXNhYmxlZCA9IHRydWU7CiAgfQogIHJlbmRlckFubm90YXRpb25FbGVtZW50KGFubm90YXRpb24pIHsKICAgIGxldCBjb250ZW50ID0gYW5ub3RhdGlvbi5jb250YWluZXIucXVlcnlTZWxlY3RvcigiLmFubm90YXRpb25Db250ZW50Iik7CiAgICBpZiAoIWNvbnRlbnQpIHsKICAgICAgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBjb250ZW50LmNsYXNzTGlzdC5hZGQoImFubm90YXRpb25Db250ZW50IiwgdGhpcy5lZGl0b3JUeXBlKTsKICAgICAgYW5ub3RhdGlvbi5jb250YWluZXIucHJlcGVuZChjb250ZW50KTsKICAgIH0gZWxzZSBpZiAoY29udGVudC5ub2RlTmFtZSA9PT0gIkNBTlZBUyIpIHsKICAgICAgY29uc3QgY2FudmFzID0gY29udGVudDsKICAgICAgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBjb250ZW50LmNsYXNzTGlzdC5hZGQoImFubm90YXRpb25Db250ZW50IiwgdGhpcy5lZGl0b3JUeXBlKTsKICAgICAgY2FudmFzLmJlZm9yZShjb250ZW50KTsKICAgIH0KICAgIHJldHVybiBjb250ZW50OwogIH0KICByZXNldEFubm90YXRpb25FbGVtZW50KGFubm90YXRpb24pIHsKICAgIGNvbnN0IHsKICAgICAgZmlyc3RDaGlsZAogICAgfSA9IGFubm90YXRpb24uY29udGFpbmVyOwogICAgaWYgKGZpcnN0Q2hpbGQ/Lm5vZGVOYW1lID09PSAiRElWIiAmJiBmaXJzdENoaWxkLmNsYXNzTGlzdC5jb250YWlucygiYW5ub3RhdGlvbkNvbnRlbnQiKSkgewogICAgICBmaXJzdENoaWxkLnJlbW92ZSgpOwogICAgfQogIH0KfQpjbGFzcyBGYWtlRWRpdG9yIGV4dGVuZHMgQW5ub3RhdGlvbkVkaXRvciB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5hbm5vdGF0aW9uRWxlbWVudElkID0gcGFyYW1zLmFubm90YXRpb25FbGVtZW50SWQ7CiAgICB0aGlzLmRlbGV0ZWQgPSB0cnVlOwogIH0KICBzZXJpYWxpemUoKSB7CiAgICByZXR1cm4gdGhpcy5zZXJpYWxpemVEZWxldGVkKCk7CiAgfQp9Cgo7Ly8gLi9zcmMvc2hhcmVkL211cm11cmhhc2gzLmpzCmNvbnN0IFNFRUQgPSAweGMzZDJlMWYwOwpjb25zdCBNQVNLX0hJR0ggPSAweGZmZmYwMDAwOwpjb25zdCBNQVNLX0xPVyA9IDB4ZmZmZjsKY2xhc3MgTXVybXVySGFzaDNfNjQgewogIGNvbnN0cnVjdG9yKHNlZWQpIHsKICAgIHRoaXMuaDEgPSBzZWVkID8gc2VlZCAmIDB4ZmZmZmZmZmYgOiBTRUVEOwogICAgdGhpcy5oMiA9IHNlZWQgPyBzZWVkICYgMHhmZmZmZmZmZiA6IFNFRUQ7CiAgfQogIHVwZGF0ZShpbnB1dCkgewogICAgbGV0IGRhdGEsIGxlbmd0aDsKICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICJzdHJpbmciKSB7CiAgICAgIGRhdGEgPSBuZXcgVWludDhBcnJheShpbnB1dC5sZW5ndGggKiAyKTsKICAgICAgbGVuZ3RoID0gMDsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaW5wdXQubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IGNvZGUgPSBpbnB1dC5jaGFyQ29kZUF0KGkpOwogICAgICAgIGlmIChjb2RlIDw9IDB4ZmYpIHsKICAgICAgICAgIGRhdGFbbGVuZ3RoKytdID0gY29kZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YVtsZW5ndGgrK10gPSBjb2RlID4+PiA4OwogICAgICAgICAgZGF0YVtsZW5ndGgrK10gPSBjb2RlICYgMHhmZjsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KGlucHV0KSkgewogICAgICBkYXRhID0gaW5wdXQuc2xpY2UoKTsKICAgICAgbGVuZ3RoID0gZGF0YS5ieXRlTGVuZ3RoOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGRhdGEgZm9ybWF0LCBtdXN0IGJlIGEgc3RyaW5nIG9yIFR5cGVkQXJyYXkuIik7CiAgICB9CiAgICBjb25zdCBibG9ja0NvdW50cyA9IGxlbmd0aCA+PiAyOwogICAgY29uc3QgdGFpbExlbmd0aCA9IGxlbmd0aCAtIGJsb2NrQ291bnRzICogNDsKICAgIGNvbnN0IGRhdGFVaW50MzIgPSBuZXcgVWludDMyQXJyYXkoZGF0YS5idWZmZXIsIDAsIGJsb2NrQ291bnRzKTsKICAgIGxldCBrMSA9IDAsCiAgICAgIGsyID0gMDsKICAgIGxldCBoMSA9IHRoaXMuaDEsCiAgICAgIGgyID0gdGhpcy5oMjsKICAgIGNvbnN0IEMxID0gMHhjYzllMmQ1MSwKICAgICAgQzIgPSAweDFiODczNTkzOwogICAgY29uc3QgQzFfTE9XID0gQzEgJiBNQVNLX0xPVywKICAgICAgQzJfTE9XID0gQzIgJiBNQVNLX0xPVzsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2tDb3VudHM7IGkrKykgewogICAgICBpZiAoaSAmIDEpIHsKICAgICAgICBrMSA9IGRhdGFVaW50MzJbaV07CiAgICAgICAgazEgPSBrMSAqIEMxICYgTUFTS19ISUdIIHwgazEgKiBDMV9MT1cgJiBNQVNLX0xPVzsKICAgICAgICBrMSA9IGsxIDw8IDE1IHwgazEgPj4+IDE3OwogICAgICAgIGsxID0gazEgKiBDMiAmIE1BU0tfSElHSCB8IGsxICogQzJfTE9XICYgTUFTS19MT1c7CiAgICAgICAgaDEgXj0gazE7CiAgICAgICAgaDEgPSBoMSA8PCAxMyB8IGgxID4+PiAxOTsKICAgICAgICBoMSA9IGgxICogNSArIDB4ZTY1NDZiNjQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgazIgPSBkYXRhVWludDMyW2ldOwogICAgICAgIGsyID0gazIgKiBDMSAmIE1BU0tfSElHSCB8IGsyICogQzFfTE9XICYgTUFTS19MT1c7CiAgICAgICAgazIgPSBrMiA8PCAxNSB8IGsyID4+PiAxNzsKICAgICAgICBrMiA9IGsyICogQzIgJiBNQVNLX0hJR0ggfCBrMiAqIEMyX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGgyIF49IGsyOwogICAgICAgIGgyID0gaDIgPDwgMTMgfCBoMiA+Pj4gMTk7CiAgICAgICAgaDIgPSBoMiAqIDUgKyAweGU2NTQ2YjY0OwogICAgICB9CiAgICB9CiAgICBrMSA9IDA7CiAgICBzd2l0Y2ggKHRhaWxMZW5ndGgpIHsKICAgICAgY2FzZSAzOgogICAgICAgIGsxIF49IGRhdGFbYmxvY2tDb3VudHMgKiA0ICsgMl0gPDwgMTY7CiAgICAgIGNhc2UgMjoKICAgICAgICBrMSBePSBkYXRhW2Jsb2NrQ291bnRzICogNCArIDFdIDw8IDg7CiAgICAgIGNhc2UgMToKICAgICAgICBrMSBePSBkYXRhW2Jsb2NrQ291bnRzICogNF07CiAgICAgICAgazEgPSBrMSAqIEMxICYgTUFTS19ISUdIIHwgazEgKiBDMV9MT1cgJiBNQVNLX0xPVzsKICAgICAgICBrMSA9IGsxIDw8IDE1IHwgazEgPj4+IDE3OwogICAgICAgIGsxID0gazEgKiBDMiAmIE1BU0tfSElHSCB8IGsxICogQzJfTE9XICYgTUFTS19MT1c7CiAgICAgICAgaWYgKGJsb2NrQ291bnRzICYgMSkgewogICAgICAgICAgaDEgXj0gazE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGgyIF49IGsxOwogICAgICAgIH0KICAgIH0KICAgIHRoaXMuaDEgPSBoMTsKICAgIHRoaXMuaDIgPSBoMjsKICB9CiAgaGV4ZGlnZXN0KCkgewogICAgbGV0IGgxID0gdGhpcy5oMSwKICAgICAgaDIgPSB0aGlzLmgyOwogICAgaDEgXj0gaDIgPj4+IDE7CiAgICBoMSA9IGgxICogMHhlZDU1OGNjZCAmIE1BU0tfSElHSCB8IGgxICogMHg4Y2NkICYgTUFTS19MT1c7CiAgICBoMiA9IGgyICogMHhmZjUxYWZkNyAmIE1BU0tfSElHSCB8ICgoaDIgPDwgMTYgfCBoMSA+Pj4gMTYpICogMHhhZmQ3ZWQ1NSAmIE1BU0tfSElHSCkgPj4+IDE2OwogICAgaDEgXj0gaDIgPj4+IDE7CiAgICBoMSA9IGgxICogMHgxYTg1ZWM1MyAmIE1BU0tfSElHSCB8IGgxICogMHhlYzUzICYgTUFTS19MT1c7CiAgICBoMiA9IGgyICogMHhjNGNlYjlmZSAmIE1BU0tfSElHSCB8ICgoaDIgPDwgMTYgfCBoMSA+Pj4gMTYpICogMHhiOWZlMWE4NSAmIE1BU0tfSElHSCkgPj4+IDE2OwogICAgaDEgXj0gaDIgPj4+IDE7CiAgICByZXR1cm4gKGgxID4+PiAwKS50b1N0cmluZygxNikucGFkU3RhcnQoOCwgIjAiKSArIChoMiA+Pj4gMCkudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDgsICIwIik7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9hbm5vdGF0aW9uX3N0b3JhZ2UuanMKCgoKY29uc3QgU2VyaWFsaXphYmxlRW1wdHkgPSBPYmplY3QuZnJlZXplKHsKICBtYXA6IG51bGwsCiAgaGFzaDogIiIsCiAgdHJhbnNmZXI6IHVuZGVmaW5lZAp9KTsKY2xhc3MgQW5ub3RhdGlvblN0b3JhZ2UgewogICNtb2RpZmllZCA9IGZhbHNlOwogICNtb2RpZmllZElkcyA9IG51bGw7CiAgI3N0b3JhZ2UgPSBuZXcgTWFwKCk7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLm9uU2V0TW9kaWZpZWQgPSBudWxsOwogICAgdGhpcy5vblJlc2V0TW9kaWZpZWQgPSBudWxsOwogICAgdGhpcy5vbkFubm90YXRpb25FZGl0b3IgPSBudWxsOwogIH0KICBnZXRWYWx1ZShrZXksIGRlZmF1bHRWYWx1ZSkgewogICAgY29uc3QgdmFsdWUgPSB0aGlzLiNzdG9yYWdlLmdldChrZXkpOwogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKICAgIH0KICAgIHJldHVybiBPYmplY3QuYXNzaWduKGRlZmF1bHRWYWx1ZSwgdmFsdWUpOwogIH0KICBnZXRSYXdWYWx1ZShrZXkpIHsKICAgIHJldHVybiB0aGlzLiNzdG9yYWdlLmdldChrZXkpOwogIH0KICByZW1vdmUoa2V5KSB7CiAgICB0aGlzLiNzdG9yYWdlLmRlbGV0ZShrZXkpOwogICAgaWYgKHRoaXMuI3N0b3JhZ2Uuc2l6ZSA9PT0gMCkgewogICAgICB0aGlzLnJlc2V0TW9kaWZpZWQoKTsKICAgIH0KICAgIGlmICh0eXBlb2YgdGhpcy5vbkFubm90YXRpb25FZGl0b3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiB0aGlzLiNzdG9yYWdlLnZhbHVlcygpKSB7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQW5ub3RhdGlvbkVkaXRvcikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLm9uQW5ub3RhdGlvbkVkaXRvcihudWxsKTsKICAgIH0KICB9CiAgc2V0VmFsdWUoa2V5LCB2YWx1ZSkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jc3RvcmFnZS5nZXQoa2V5KTsKICAgIGxldCBtb2RpZmllZCA9IGZhbHNlOwogICAgaWYgKG9iaiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGZvciAoY29uc3QgW2VudHJ5LCB2YWxdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkgewogICAgICAgIGlmIChvYmpbZW50cnldICE9PSB2YWwpIHsKICAgICAgICAgIG1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIG9ialtlbnRyeV0gPSB2YWw7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBtb2RpZmllZCA9IHRydWU7CiAgICAgIHRoaXMuI3N0b3JhZ2Uuc2V0KGtleSwgdmFsdWUpOwogICAgfQogICAgaWYgKG1vZGlmaWVkKSB7CiAgICAgIHRoaXMuI3NldE1vZGlmaWVkKCk7CiAgICB9CiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBbm5vdGF0aW9uRWRpdG9yICYmIHR5cGVvZiB0aGlzLm9uQW5ub3RhdGlvbkVkaXRvciA9PT0gImZ1bmN0aW9uIikgewogICAgICB0aGlzLm9uQW5ub3RhdGlvbkVkaXRvcih2YWx1ZS5jb25zdHJ1Y3Rvci5fdHlwZSk7CiAgICB9CiAgfQogIGhhcyhrZXkpIHsKICAgIHJldHVybiB0aGlzLiNzdG9yYWdlLmhhcyhrZXkpOwogIH0KICBnZXQgc2l6ZSgpIHsKICAgIHJldHVybiB0aGlzLiNzdG9yYWdlLnNpemU7CiAgfQogICNzZXRNb2RpZmllZCgpIHsKICAgIGlmICghdGhpcy4jbW9kaWZpZWQpIHsKICAgICAgdGhpcy4jbW9kaWZpZWQgPSB0cnVlOwogICAgICBpZiAodHlwZW9mIHRoaXMub25TZXRNb2RpZmllZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIHRoaXMub25TZXRNb2RpZmllZCgpOwogICAgICB9CiAgICB9CiAgfQogIHJlc2V0TW9kaWZpZWQoKSB7CiAgICBpZiAodGhpcy4jbW9kaWZpZWQpIHsKICAgICAgdGhpcy4jbW9kaWZpZWQgPSBmYWxzZTsKICAgICAgaWYgKHR5cGVvZiB0aGlzLm9uUmVzZXRNb2RpZmllZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIHRoaXMub25SZXNldE1vZGlmaWVkKCk7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0IHByaW50KCkgewogICAgcmV0dXJuIG5ldyBQcmludEFubm90YXRpb25TdG9yYWdlKHRoaXMpOwogIH0KICBnZXQgc2VyaWFsaXphYmxlKCkgewogICAgaWYgKHRoaXMuI3N0b3JhZ2Uuc2l6ZSA9PT0gMCkgewogICAgICByZXR1cm4gU2VyaWFsaXphYmxlRW1wdHk7CiAgICB9CiAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCksCiAgICAgIGhhc2ggPSBuZXcgTXVybXVySGFzaDNfNjQoKSwKICAgICAgdHJhbnNmZXIgPSBbXTsKICAgIGNvbnN0IGNvbnRleHQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgbGV0IGhhc0JpdG1hcCA9IGZhbHNlOwogICAgZm9yIChjb25zdCBba2V5LCB2YWxdIG9mIHRoaXMuI3N0b3JhZ2UpIHsKICAgICAgY29uc3Qgc2VyaWFsaXplZCA9IHZhbCBpbnN0YW5jZW9mIEFubm90YXRpb25FZGl0b3IgPyB2YWwuc2VyaWFsaXplKGZhbHNlLCBjb250ZXh0KSA6IHZhbDsKICAgICAgaWYgKHNlcmlhbGl6ZWQpIHsKICAgICAgICBtYXAuc2V0KGtleSwgc2VyaWFsaXplZCk7CiAgICAgICAgaGFzaC51cGRhdGUoYCR7a2V5fToke0pTT04uc3RyaW5naWZ5KHNlcmlhbGl6ZWQpfWApOwogICAgICAgIGhhc0JpdG1hcCB8fD0gISFzZXJpYWxpemVkLmJpdG1hcDsKICAgICAgfQogICAgfQogICAgaWYgKGhhc0JpdG1hcCkgewogICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIG1hcC52YWx1ZXMoKSkgewogICAgICAgIGlmICh2YWx1ZS5iaXRtYXApIHsKICAgICAgICAgIHRyYW5zZmVyLnB1c2godmFsdWUuYml0bWFwKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtYXAuc2l6ZSA+IDAgPyB7CiAgICAgIG1hcCwKICAgICAgaGFzaDogaGFzaC5oZXhkaWdlc3QoKSwKICAgICAgdHJhbnNmZXIKICAgIH0gOiBTZXJpYWxpemFibGVFbXB0eTsKICB9CiAgZ2V0IGVkaXRvclN0YXRzKCkgewogICAgbGV0IHN0YXRzID0gbnVsbDsKICAgIGNvbnN0IHR5cGVUb0VkaXRvciA9IG5ldyBNYXAoKTsKICAgIGZvciAoY29uc3QgdmFsdWUgb2YgdGhpcy4jc3RvcmFnZS52YWx1ZXMoKSkgewogICAgICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIEFubm90YXRpb25FZGl0b3IpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgZWRpdG9yU3RhdHMgPSB2YWx1ZS50ZWxlbWV0cnlGaW5hbERhdGE7CiAgICAgIGlmICghZWRpdG9yU3RhdHMpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgdHlwZQogICAgICB9ID0gZWRpdG9yU3RhdHM7CiAgICAgIGlmICghdHlwZVRvRWRpdG9yLmhhcyh0eXBlKSkgewogICAgICAgIHR5cGVUb0VkaXRvci5zZXQodHlwZSwgT2JqZWN0LmdldFByb3RvdHlwZU9mKHZhbHVlKS5jb25zdHJ1Y3Rvcik7CiAgICAgIH0KICAgICAgc3RhdHMgfHw9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGNvbnN0IG1hcCA9IHN0YXRzW3R5cGVdIHx8PSBuZXcgTWFwKCk7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsXSBvZiBPYmplY3QuZW50cmllcyhlZGl0b3JTdGF0cykpIHsKICAgICAgICBpZiAoa2V5ID09PSAidHlwZSIpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBsZXQgY291bnRlcnMgPSBtYXAuZ2V0KGtleSk7CiAgICAgICAgaWYgKCFjb3VudGVycykgewogICAgICAgICAgY291bnRlcnMgPSBuZXcgTWFwKCk7CiAgICAgICAgICBtYXAuc2V0KGtleSwgY291bnRlcnMpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjb3VudCA9IGNvdW50ZXJzLmdldCh2YWwpID8/IDA7CiAgICAgICAgY291bnRlcnMuc2V0KHZhbCwgY291bnQgKyAxKTsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCBbdHlwZSwgZWRpdG9yXSBvZiB0eXBlVG9FZGl0b3IpIHsKICAgICAgc3RhdHNbdHlwZV0gPSBlZGl0b3IuY29tcHV0ZVRlbGVtZXRyeUZpbmFsRGF0YShzdGF0c1t0eXBlXSk7CiAgICB9CiAgICByZXR1cm4gc3RhdHM7CiAgfQogIHJlc2V0TW9kaWZpZWRJZHMoKSB7CiAgICB0aGlzLiNtb2RpZmllZElkcyA9IG51bGw7CiAgfQogIGdldCBtb2RpZmllZElkcygpIHsKICAgIGlmICh0aGlzLiNtb2RpZmllZElkcykgewogICAgICByZXR1cm4gdGhpcy4jbW9kaWZpZWRJZHM7CiAgICB9CiAgICBjb25zdCBpZHMgPSBbXTsKICAgIGZvciAoY29uc3QgdmFsdWUgb2YgdGhpcy4jc3RvcmFnZS52YWx1ZXMoKSkgewogICAgICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIEFubm90YXRpb25FZGl0b3IpIHx8ICF2YWx1ZS5hbm5vdGF0aW9uRWxlbWVudElkIHx8ICF2YWx1ZS5zZXJpYWxpemUoKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlkcy5wdXNoKHZhbHVlLmFubm90YXRpb25FbGVtZW50SWQpOwogICAgfQogICAgcmV0dXJuIHRoaXMuI21vZGlmaWVkSWRzID0gewogICAgICBpZHM6IG5ldyBTZXQoaWRzKSwKICAgICAgaGFzaDogaWRzLmpvaW4oIiwiKQogICAgfTsKICB9CiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICByZXR1cm4gdGhpcy4jc3RvcmFnZS5lbnRyaWVzKCk7CiAgfQp9CmNsYXNzIFByaW50QW5ub3RhdGlvblN0b3JhZ2UgZXh0ZW5kcyBBbm5vdGF0aW9uU3RvcmFnZSB7CiAgI3NlcmlhbGl6YWJsZTsKICBjb25zdHJ1Y3RvcihwYXJlbnQpIHsKICAgIHN1cGVyKCk7CiAgICBjb25zdCB7CiAgICAgIG1hcCwKICAgICAgaGFzaCwKICAgICAgdHJhbnNmZXIKICAgIH0gPSBwYXJlbnQuc2VyaWFsaXphYmxlOwogICAgY29uc3QgY2xvbmUgPSBzdHJ1Y3R1cmVkQ2xvbmUobWFwLCB0cmFuc2ZlciA/IHsKICAgICAgdHJhbnNmZXIKICAgIH0gOiBudWxsKTsKICAgIHRoaXMuI3NlcmlhbGl6YWJsZSA9IHsKICAgICAgbWFwOiBjbG9uZSwKICAgICAgaGFzaCwKICAgICAgdHJhbnNmZXIKICAgIH07CiAgfQogIGdldCBwcmludCgpIHsKICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgUHJpbnRBbm5vdGF0aW9uU3RvcmFnZS5wcmludCIpOwogIH0KICBnZXQgc2VyaWFsaXphYmxlKCkgewogICAgcmV0dXJuIHRoaXMuI3NlcmlhbGl6YWJsZTsKICB9CiAgZ2V0IG1vZGlmaWVkSWRzKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAibW9kaWZpZWRJZHMiLCB7CiAgICAgIGlkczogbmV3IFNldCgpLAogICAgICBoYXNoOiAiIgogICAgfSk7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9mb250X2xvYWRlci5qcwoKY2xhc3MgRm9udExvYWRlciB7CiAgI3N5c3RlbUZvbnRzID0gbmV3IFNldCgpOwogIGNvbnN0cnVjdG9yKHsKICAgIG93bmVyRG9jdW1lbnQgPSBnbG9iYWxUaGlzLmRvY3VtZW50LAogICAgc3R5bGVFbGVtZW50ID0gbnVsbAogIH0pIHsKICAgIHRoaXMuX2RvY3VtZW50ID0gb3duZXJEb2N1bWVudDsKICAgIHRoaXMubmF0aXZlRm9udEZhY2VzID0gbmV3IFNldCgpOwogICAgdGhpcy5zdHlsZUVsZW1lbnQgPSBudWxsOwogICAgdGhpcy5sb2FkaW5nUmVxdWVzdHMgPSBbXTsKICAgIHRoaXMubG9hZFRlc3RGb250SWQgPSAwOwogIH0KICBhZGROYXRpdmVGb250RmFjZShuYXRpdmVGb250RmFjZSkgewogICAgdGhpcy5uYXRpdmVGb250RmFjZXMuYWRkKG5hdGl2ZUZvbnRGYWNlKTsKICAgIHRoaXMuX2RvY3VtZW50LmZvbnRzLmFkZChuYXRpdmVGb250RmFjZSk7CiAgfQogIHJlbW92ZU5hdGl2ZUZvbnRGYWNlKG5hdGl2ZUZvbnRGYWNlKSB7CiAgICB0aGlzLm5hdGl2ZUZvbnRGYWNlcy5kZWxldGUobmF0aXZlRm9udEZhY2UpOwogICAgdGhpcy5fZG9jdW1lbnQuZm9udHMuZGVsZXRlKG5hdGl2ZUZvbnRGYWNlKTsKICB9CiAgaW5zZXJ0UnVsZShydWxlKSB7CiAgICBpZiAoIXRoaXMuc3R5bGVFbGVtZW50KSB7CiAgICAgIHRoaXMuc3R5bGVFbGVtZW50ID0gdGhpcy5fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKICAgICAgdGhpcy5fZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF0uYXBwZW5kKHRoaXMuc3R5bGVFbGVtZW50KTsKICAgIH0KICAgIGNvbnN0IHN0eWxlU2hlZXQgPSB0aGlzLnN0eWxlRWxlbWVudC5zaGVldDsKICAgIHN0eWxlU2hlZXQuaW5zZXJ0UnVsZShydWxlLCBzdHlsZVNoZWV0LmNzc1J1bGVzLmxlbmd0aCk7CiAgfQogIGNsZWFyKCkgewogICAgZm9yIChjb25zdCBuYXRpdmVGb250RmFjZSBvZiB0aGlzLm5hdGl2ZUZvbnRGYWNlcykgewogICAgICB0aGlzLl9kb2N1bWVudC5mb250cy5kZWxldGUobmF0aXZlRm9udEZhY2UpOwogICAgfQogICAgdGhpcy5uYXRpdmVGb250RmFjZXMuY2xlYXIoKTsKICAgIHRoaXMuI3N5c3RlbUZvbnRzLmNsZWFyKCk7CiAgICBpZiAodGhpcy5zdHlsZUVsZW1lbnQpIHsKICAgICAgdGhpcy5zdHlsZUVsZW1lbnQucmVtb3ZlKCk7CiAgICAgIHRoaXMuc3R5bGVFbGVtZW50ID0gbnVsbDsKICAgIH0KICB9CiAgYXN5bmMgbG9hZFN5c3RlbUZvbnQoewogICAgc3lzdGVtRm9udEluZm86IGluZm8sCiAgICBkaXNhYmxlRm9udEZhY2UsCiAgICBfaW5zcGVjdEZvbnQKICB9KSB7CiAgICBpZiAoIWluZm8gfHwgdGhpcy4jc3lzdGVtRm9udHMuaGFzKGluZm8ubG9hZGVkTmFtZSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgYXNzZXJ0KCFkaXNhYmxlRm9udEZhY2UsICJsb2FkU3lzdGVtRm9udCBzaG91bGRuJ3QgYmUgY2FsbGVkIHdoZW4gYGRpc2FibGVGb250RmFjZWAgaXMgc2V0LiIpOwogICAgaWYgKHRoaXMuaXNGb250TG9hZGluZ0FQSVN1cHBvcnRlZCkgewogICAgICBjb25zdCB7CiAgICAgICAgbG9hZGVkTmFtZSwKICAgICAgICBzcmMsCiAgICAgICAgc3R5bGUKICAgICAgfSA9IGluZm87CiAgICAgIGNvbnN0IGZvbnRGYWNlID0gbmV3IEZvbnRGYWNlKGxvYWRlZE5hbWUsIHNyYywgc3R5bGUpOwogICAgICB0aGlzLmFkZE5hdGl2ZUZvbnRGYWNlKGZvbnRGYWNlKTsKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBmb250RmFjZS5sb2FkKCk7CiAgICAgICAgdGhpcy4jc3lzdGVtRm9udHMuYWRkKGxvYWRlZE5hbWUpOwogICAgICAgIF9pbnNwZWN0Rm9udD8uKGluZm8pOwogICAgICB9IGNhdGNoIHsKICAgICAgICB3YXJuKGBDYW5ub3QgbG9hZCBzeXN0ZW0gZm9udDogJHtpbmZvLmJhc2VGb250TmFtZX0sIGluc3RhbGxpbmcgaXQgY291bGQgaGVscCB0byBpbXByb3ZlIFBERiByZW5kZXJpbmcuYCk7CiAgICAgICAgdGhpcy5yZW1vdmVOYXRpdmVGb250RmFjZShmb250RmFjZSk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgdW5yZWFjaGFibGUoIk5vdCBpbXBsZW1lbnRlZDogbG9hZFN5c3RlbUZvbnQgd2l0aG91dCB0aGUgRm9udCBMb2FkaW5nIEFQSS4iKTsKICB9CiAgYXN5bmMgYmluZChmb250KSB7CiAgICBpZiAoZm9udC5hdHRhY2hlZCB8fCBmb250Lm1pc3NpbmdGaWxlICYmICFmb250LnN5c3RlbUZvbnRJbmZvKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvbnQuYXR0YWNoZWQgPSB0cnVlOwogICAgaWYgKGZvbnQuc3lzdGVtRm9udEluZm8pIHsKICAgICAgYXdhaXQgdGhpcy5sb2FkU3lzdGVtRm9udChmb250KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuaXNGb250TG9hZGluZ0FQSVN1cHBvcnRlZCkgewogICAgICBjb25zdCBuYXRpdmVGb250RmFjZSA9IGZvbnQuY3JlYXRlTmF0aXZlRm9udEZhY2UoKTsKICAgICAgaWYgKG5hdGl2ZUZvbnRGYWNlKSB7CiAgICAgICAgdGhpcy5hZGROYXRpdmVGb250RmFjZShuYXRpdmVGb250RmFjZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGF3YWl0IG5hdGl2ZUZvbnRGYWNlLmxvYWRlZDsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgd2FybihgRmFpbGVkIHRvIGxvYWQgZm9udCAnJHtuYXRpdmVGb250RmFjZS5mYW1pbHl9JzogJyR7ZXh9Jy5gKTsKICAgICAgICAgIGZvbnQuZGlzYWJsZUZvbnRGYWNlID0gdHJ1ZTsKICAgICAgICAgIHRocm93IGV4OwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBydWxlID0gZm9udC5jcmVhdGVGb250RmFjZVJ1bGUoKTsKICAgIGlmIChydWxlKSB7CiAgICAgIHRoaXMuaW5zZXJ0UnVsZShydWxlKTsKICAgICAgaWYgKHRoaXMuaXNTeW5jRm9udExvYWRpbmdTdXBwb3J0ZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuX3F1ZXVlTG9hZGluZ0NhbGxiYWNrKHJlc29sdmUpOwogICAgICAgIHRoaXMuX3ByZXBhcmVGb250TG9hZEV2ZW50KGZvbnQsIHJlcXVlc3QpOwogICAgICB9KTsKICAgIH0KICB9CiAgZ2V0IGlzRm9udExvYWRpbmdBUElTdXBwb3J0ZWQoKSB7CiAgICBjb25zdCBoYXNGb250cyA9ICEhdGhpcy5fZG9jdW1lbnQ/LmZvbnRzOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNGb250TG9hZGluZ0FQSVN1cHBvcnRlZCIsIGhhc0ZvbnRzKTsKICB9CiAgZ2V0IGlzU3luY0ZvbnRMb2FkaW5nU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNTeW5jRm9udExvYWRpbmdTdXBwb3J0ZWQiLCBpc05vZGVKUyB8fCB1dGlsX0ZlYXR1cmVUZXN0LnBsYXRmb3JtLmlzRmlyZWZveCk7CiAgfQogIF9xdWV1ZUxvYWRpbmdDYWxsYmFjayhjYWxsYmFjaykgewogICAgZnVuY3Rpb24gY29tcGxldGVSZXF1ZXN0KCkgewogICAgICBhc3NlcnQoIXJlcXVlc3QuZG9uZSwgImNvbXBsZXRlUmVxdWVzdCgpIGNhbm5vdCBiZSBjYWxsZWQgdHdpY2UuIik7CiAgICAgIHJlcXVlc3QuZG9uZSA9IHRydWU7CiAgICAgIHdoaWxlIChsb2FkaW5nUmVxdWVzdHMubGVuZ3RoID4gMCAmJiBsb2FkaW5nUmVxdWVzdHNbMF0uZG9uZSkgewogICAgICAgIGNvbnN0IG90aGVyUmVxdWVzdCA9IGxvYWRpbmdSZXF1ZXN0cy5zaGlmdCgpOwogICAgICAgIHNldFRpbWVvdXQob3RoZXJSZXF1ZXN0LmNhbGxiYWNrLCAwKTsKICAgICAgfQogICAgfQogICAgY29uc3QgewogICAgICBsb2FkaW5nUmVxdWVzdHMKICAgIH0gPSB0aGlzOwogICAgY29uc3QgcmVxdWVzdCA9IHsKICAgICAgZG9uZTogZmFsc2UsCiAgICAgIGNvbXBsZXRlOiBjb21wbGV0ZVJlcXVlc3QsCiAgICAgIGNhbGxiYWNrCiAgICB9OwogICAgbG9hZGluZ1JlcXVlc3RzLnB1c2gocmVxdWVzdCk7CiAgICByZXR1cm4gcmVxdWVzdDsKICB9CiAgZ2V0IF9sb2FkVGVzdEZvbnQoKSB7CiAgICBjb25zdCB0ZXN0Rm9udCA9IGF0b2IoIlQxUlVUd0FMQUlBQUF3QXdRMFpHSURIdFpnNEFBQU9ZQUFBQWdVWkdWRTFsa3pad0FBQUVIQUFBQUJ4SFJFVkdBQlFBIiArICJGUUFBQkRnQUFBQWVUMU12TWxZTll3a0FBQUVnQUFBQVlHTnRZWEFCRFFMVUFBQUNOQUFBQVVKb1pXRmsveFZGRFFBQSIgKyAiQUx3QUFBQTJhR2hsWVFka0Erb0FBQUQwQUFBQUpHaHRkSGdENkFBQUFBQUVXQUFBQUFadFlYaHdBQUpRQUFBQUFSZ0EiICsgIkFBQUdibUZ0WlZqbWRINEFBQUdBQUFBQXNYQnZjM1QvaGdBekFBQURlQUFBQUNBQUFRQUFBQUVBQUxaUkZzUmZEenoxIiArICJBQXNENkFBQUFBRE9CT1RMQUFBQUFNNEtIRHdBQUFBQUErZ0RJUUFBQUFnQUFnQUFBQUFBQUFBQkFBQURJUUFBQUZvRCIgKyAiNkFBQUFBQUQ2QUFCQUFBQUFBQUFBQUFBQUFBQUFBQUFBUUFBVUFBQUFnQUFBQVFENkFIMEFBVUFBQUtLQXJ3QUFBQ00iICsgIkFvb0N2QUFBQWVBQU1RRUNBQUFDQUFZSkFBQUFBQUFBQUFBQUFRQUFBQUFBQUFBQUFBQUFBRkJtUldRQXdBQXVBQzREIiArICJJUDg0QUZvRElRQUFBQUFBQVFBQUFBQUFBQUFBQUNBQUlBQUJBQUFBRGdDdUFBRUFBQUFBQUFBQUFRQUFBQUVBQUFBQSIgKyAiQUFFQUFRQUFBQUVBQUFBQUFBSUFBUUFBQUFFQUFBQUFBQU1BQVFBQUFBRUFBQUFBQUFRQUFRQUFBQUVBQUFBQUFBVUEiICsgIkFRQUFBQUVBQUFBQUFBWUFBUUFBQUFNQUFRUUpBQUFBQWdBQkFBTUFBUVFKQUFFQUFnQUJBQU1BQVFRSkFBSUFBZ0FCIiArICJBQU1BQVFRSkFBTUFBZ0FCQUFNQUFRUUpBQVFBQWdBQkFBTUFBUVFKQUFVQUFnQUJBQU1BQVFRSkFBWUFBZ0FCV0FCWSIgKyAiQUFBQUFBQUFBd0FBQUFNQUFBQWNBQUVBQUFBQUFEd0FBd0FCQUFBQUhBQUVBQ0FBQUFBRUFBUUFBUUFBQUM3Ly93QUEiICsgIkFDNy8vLy9UQUFFQUFBQUFBQUFCQmdBQUFRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBIiArICJBQUFBQUFBQUFBQUFBQUFBQUFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQSIgKyAiQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUEiICsgIkFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBIiArICJBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQSIgKyAiQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBTUFBQUFBQUFEL2d3QXlBQUFBQVFBQUFBQUFBQUFBQUFBQUFBQUEiICsgIkFBQUJBQVFFQUFFQkFRSllBQUVCQVNINER3RDRHd0hFQXZnY0EvZ1hCSXdNQVl1TCtuejV0UVhrRDVqM0NCTG5FUUFDIiArICJBUUVCSVZoWVdGaFlXRmhZV0ZoWVdGaFlXRmhZV0ZoWVdGaFlXRmhZV0ZoWVdGaFlBQUFCQVFBQUR3QUNBUUVFRS90MyIgKyAiRG92NmZBSDZmQVQrZlBwOCtud0hEb3NNQ3ZtMUN2bTFEQXo2ZkJRQUFBQUFBQUFCQUFBQUFNbUpiekVBQUFBQXpnVGoiICsgIkZRQUFBQURPQk9RcEFBRUFBQUFBQUFBQURBQVVBQVFBQUFBQkFBQUFBZ0FCQUFBQUFBQUFBQUFENkFBQUFBQUFBQT09Iik7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfbG9hZFRlc3RGb250IiwgdGVzdEZvbnQpOwogIH0KICBfcHJlcGFyZUZvbnRMb2FkRXZlbnQoZm9udCwgcmVxdWVzdCkgewogICAgZnVuY3Rpb24gaW50MzIoZGF0YSwgb2Zmc2V0KSB7CiAgICAgIHJldHVybiBkYXRhLmNoYXJDb2RlQXQob2Zmc2V0KSA8PCAyNCB8IGRhdGEuY2hhckNvZGVBdChvZmZzZXQgKyAxKSA8PCAxNiB8IGRhdGEuY2hhckNvZGVBdChvZmZzZXQgKyAyKSA8PCA4IHwgZGF0YS5jaGFyQ29kZUF0KG9mZnNldCArIDMpICYgMHhmZjsKICAgIH0KICAgIGZ1bmN0aW9uIHNwbGljZVN0cmluZyhzLCBvZmZzZXQsIHJlbW92ZSwgaW5zZXJ0KSB7CiAgICAgIGNvbnN0IGNodW5rMSA9IHMuc3Vic3RyaW5nKDAsIG9mZnNldCk7CiAgICAgIGNvbnN0IGNodW5rMiA9IHMuc3Vic3RyaW5nKG9mZnNldCArIHJlbW92ZSk7CiAgICAgIHJldHVybiBjaHVuazEgKyBpbnNlcnQgKyBjaHVuazI7CiAgICB9CiAgICBsZXQgaSwgaWk7CiAgICBjb25zdCBjYW52YXMgPSB0aGlzLl9kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgIGNhbnZhcy53aWR0aCA9IDE7CiAgICBjYW52YXMuaGVpZ2h0ID0gMTsKICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgbGV0IGNhbGxlZCA9IDA7CiAgICBmdW5jdGlvbiBpc0ZvbnRSZWFkeShuYW1lLCBjYWxsYmFjaykgewogICAgICBpZiAoKytjYWxsZWQgPiAzMCkgewogICAgICAgIHdhcm4oIkxvYWQgdGVzdCBmb250IG5ldmVyIGxvYWRlZC4iKTsKICAgICAgICBjYWxsYmFjaygpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjdHguZm9udCA9ICIzMHB4ICIgKyBuYW1lOwogICAgICBjdHguZmlsbFRleHQoIi4iLCAwLCAyMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgMSwgMSk7CiAgICAgIGlmIChpbWFnZURhdGEuZGF0YVszXSA+IDApIHsKICAgICAgICBjYWxsYmFjaygpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBzZXRUaW1lb3V0KGlzRm9udFJlYWR5LmJpbmQobnVsbCwgbmFtZSwgY2FsbGJhY2spKTsKICAgIH0KICAgIGNvbnN0IGxvYWRUZXN0Rm9udElkID0gYGx0JHtEYXRlLm5vdygpfSR7dGhpcy5sb2FkVGVzdEZvbnRJZCsrfWA7CiAgICBsZXQgZGF0YSA9IHRoaXMuX2xvYWRUZXN0Rm9udDsKICAgIGNvbnN0IENPTU1FTlRfT0ZGU0VUID0gOTc2OwogICAgZGF0YSA9IHNwbGljZVN0cmluZyhkYXRhLCBDT01NRU5UX09GRlNFVCwgbG9hZFRlc3RGb250SWQubGVuZ3RoLCBsb2FkVGVzdEZvbnRJZCk7CiAgICBjb25zdCBDRkZfQ0hFQ0tTVU1fT0ZGU0VUID0gMTY7CiAgICBjb25zdCBYWFhYX1ZBTFVFID0gMHg1ODU4NTg1ODsKICAgIGxldCBjaGVja3N1bSA9IGludDMyKGRhdGEsIENGRl9DSEVDS1NVTV9PRkZTRVQpOwogICAgZm9yIChpID0gMCwgaWkgPSBsb2FkVGVzdEZvbnRJZC5sZW5ndGggLSAzOyBpIDwgaWk7IGkgKz0gNCkgewogICAgICBjaGVja3N1bSA9IGNoZWNrc3VtIC0gWFhYWF9WQUxVRSArIGludDMyKGxvYWRUZXN0Rm9udElkLCBpKSB8IDA7CiAgICB9CiAgICBpZiAoaSA8IGxvYWRUZXN0Rm9udElkLmxlbmd0aCkgewogICAgICBjaGVja3N1bSA9IGNoZWNrc3VtIC0gWFhYWF9WQUxVRSArIGludDMyKGxvYWRUZXN0Rm9udElkICsgIlhYWCIsIGkpIHwgMDsKICAgIH0KICAgIGRhdGEgPSBzcGxpY2VTdHJpbmcoZGF0YSwgQ0ZGX0NIRUNLU1VNX09GRlNFVCwgNCwgc3RyaW5nMzIoY2hlY2tzdW0pKTsKICAgIGNvbnN0IHVybCA9IGB1cmwoZGF0YTpmb250L29wZW50eXBlO2Jhc2U2NCwke2J0b2EoZGF0YSl9KTtgOwogICAgY29uc3QgcnVsZSA9IGBAZm9udC1mYWNlIHtmb250LWZhbWlseToiJHtsb2FkVGVzdEZvbnRJZH0iO3NyYzoke3VybH19YDsKICAgIHRoaXMuaW5zZXJ0UnVsZShydWxlKTsKICAgIGNvbnN0IGRpdiA9IHRoaXMuX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgZGl2LnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgIGRpdi5zdHlsZS53aWR0aCA9IGRpdi5zdHlsZS5oZWlnaHQgPSAiMTBweCI7CiAgICBkaXYuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgZGl2LnN0eWxlLnRvcCA9IGRpdi5zdHlsZS5sZWZ0ID0gIjBweCI7CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgW2ZvbnQubG9hZGVkTmFtZSwgbG9hZFRlc3RGb250SWRdKSB7CiAgICAgIGNvbnN0IHNwYW4gPSB0aGlzLl9kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICAgIHNwYW4udGV4dENvbnRlbnQgPSAiSGkiOwogICAgICBzcGFuLnN0eWxlLmZvbnRGYW1pbHkgPSBuYW1lOwogICAgICBkaXYuYXBwZW5kKHNwYW4pOwogICAgfQogICAgdGhpcy5fZG9jdW1lbnQuYm9keS5hcHBlbmQoZGl2KTsKICAgIGlzRm9udFJlYWR5KGxvYWRUZXN0Rm9udElkLCAoKSA9PiB7CiAgICAgIGRpdi5yZW1vdmUoKTsKICAgICAgcmVxdWVzdC5jb21wbGV0ZSgpOwogICAgfSk7CiAgfQp9CmNsYXNzIEZvbnRGYWNlT2JqZWN0IHsKICBjb25zdHJ1Y3Rvcih0cmFuc2xhdGVkRGF0YSwgaW5zcGVjdEZvbnQgPSBudWxsKSB7CiAgICB0aGlzLmNvbXBpbGVkR2x5cGhzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZvciAoY29uc3QgaSBpbiB0cmFuc2xhdGVkRGF0YSkgewogICAgICB0aGlzW2ldID0gdHJhbnNsYXRlZERhdGFbaV07CiAgICB9CiAgICB0aGlzLl9pbnNwZWN0Rm9udCA9IGluc3BlY3RGb250OwogIH0KICBjcmVhdGVOYXRpdmVGb250RmFjZSgpIHsKICAgIGlmICghdGhpcy5kYXRhIHx8IHRoaXMuZGlzYWJsZUZvbnRGYWNlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgbGV0IG5hdGl2ZUZvbnRGYWNlOwogICAgaWYgKCF0aGlzLmNzc0ZvbnRJbmZvKSB7CiAgICAgIG5hdGl2ZUZvbnRGYWNlID0gbmV3IEZvbnRGYWNlKHRoaXMubG9hZGVkTmFtZSwgdGhpcy5kYXRhLCB7fSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBjc3MgPSB7CiAgICAgICAgd2VpZ2h0OiB0aGlzLmNzc0ZvbnRJbmZvLmZvbnRXZWlnaHQKICAgICAgfTsKICAgICAgaWYgKHRoaXMuY3NzRm9udEluZm8uaXRhbGljQW5nbGUpIHsKICAgICAgICBjc3Muc3R5bGUgPSBgb2JsaXF1ZSAke3RoaXMuY3NzRm9udEluZm8uaXRhbGljQW5nbGV9ZGVnYDsKICAgICAgfQogICAgICBuYXRpdmVGb250RmFjZSA9IG5ldyBGb250RmFjZSh0aGlzLmNzc0ZvbnRJbmZvLmZvbnRGYW1pbHksIHRoaXMuZGF0YSwgY3NzKTsKICAgIH0KICAgIHRoaXMuX2luc3BlY3RGb250Py4odGhpcyk7CiAgICByZXR1cm4gbmF0aXZlRm9udEZhY2U7CiAgfQogIGNyZWF0ZUZvbnRGYWNlUnVsZSgpIHsKICAgIGlmICghdGhpcy5kYXRhIHx8IHRoaXMuZGlzYWJsZUZvbnRGYWNlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgdXJsID0gYHVybChkYXRhOiR7dGhpcy5taW1ldHlwZX07YmFzZTY0LCR7dG9CYXNlNjRVdGlsKHRoaXMuZGF0YSl9KTtgOwogICAgbGV0IHJ1bGU7CiAgICBpZiAoIXRoaXMuY3NzRm9udEluZm8pIHsKICAgICAgcnVsZSA9IGBAZm9udC1mYWNlIHtmb250LWZhbWlseToiJHt0aGlzLmxvYWRlZE5hbWV9IjtzcmM6JHt1cmx9fWA7CiAgICB9IGVsc2UgewogICAgICBsZXQgY3NzID0gYGZvbnQtd2VpZ2h0OiAke3RoaXMuY3NzRm9udEluZm8uZm9udFdlaWdodH07YDsKICAgICAgaWYgKHRoaXMuY3NzRm9udEluZm8uaXRhbGljQW5nbGUpIHsKICAgICAgICBjc3MgKz0gYGZvbnQtc3R5bGU6IG9ibGlxdWUgJHt0aGlzLmNzc0ZvbnRJbmZvLml0YWxpY0FuZ2xlfWRlZztgOwogICAgICB9CiAgICAgIHJ1bGUgPSBgQGZvbnQtZmFjZSB7Zm9udC1mYW1pbHk6IiR7dGhpcy5jc3NGb250SW5mby5mb250RmFtaWx5fSI7JHtjc3N9c3JjOiR7dXJsfX1gOwogICAgfQogICAgdGhpcy5faW5zcGVjdEZvbnQ/Lih0aGlzLCB1cmwpOwogICAgcmV0dXJuIHJ1bGU7CiAgfQogIGdldFBhdGhHZW5lcmF0b3Iob2JqcywgY2hhcmFjdGVyKSB7CiAgICBpZiAodGhpcy5jb21waWxlZEdseXBoc1tjaGFyYWN0ZXJdICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcGlsZWRHbHlwaHNbY2hhcmFjdGVyXTsKICAgIH0KICAgIGNvbnN0IG9iaklkID0gdGhpcy5sb2FkZWROYW1lICsgIl9wYXRoXyIgKyBjaGFyYWN0ZXI7CiAgICBsZXQgY21kczsKICAgIHRyeSB7CiAgICAgIGNtZHMgPSBvYmpzLmdldChvYmpJZCk7CiAgICB9IGNhdGNoIChleCkgewogICAgICB3YXJuKGBnZXRQYXRoR2VuZXJhdG9yIC0gaWdub3JpbmcgY2hhcmFjdGVyOiAiJHtleH0iLmApOwogICAgfQogICAgY29uc3QgcGF0aCA9IG5ldyBQYXRoMkQoY21kcyB8fCAiIik7CiAgICBpZiAoIXRoaXMuZm9udEV4dHJhUHJvcGVydGllcykgewogICAgICBvYmpzLmRlbGV0ZShvYmpJZCk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5jb21waWxlZEdseXBoc1tjaGFyYWN0ZXJdID0gcGF0aDsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L2FwaV91dGlscy5qcwoKZnVuY3Rpb24gZ2V0VXJsUHJvcCh2YWwpIHsKICBpZiAodmFsIGluc3RhbmNlb2YgVVJMKSB7CiAgICByZXR1cm4gdmFsLmhyZWY7CiAgfQogIGlmICh0eXBlb2YgdmFsID09PSAic3RyaW5nIikgewogICAgaWYgKGlzTm9kZUpTKSB7CiAgICAgIHJldHVybiB2YWw7CiAgICB9CiAgICBjb25zdCB1cmwgPSBVUkwucGFyc2UodmFsLCB3aW5kb3cubG9jYXRpb24pOwogICAgaWYgKHVybCkgewogICAgICByZXR1cm4gdXJsLmhyZWY7CiAgICB9CiAgfQogIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBQREYgdXJsIGRhdGE6ICIgKyAiZWl0aGVyIHN0cmluZyBvciBVUkwtb2JqZWN0IGlzIGV4cGVjdGVkIGluIHRoZSB1cmwgcHJvcGVydHkuIik7Cn0KZnVuY3Rpb24gZ2V0RGF0YVByb3AodmFsKSB7CiAgaWYgKGlzTm9kZUpTICYmIHR5cGVvZiBCdWZmZXIgIT09ICJ1bmRlZmluZWQiICYmIHZhbCBpbnN0YW5jZW9mIEJ1ZmZlcikgewogICAgdGhyb3cgbmV3IEVycm9yKCJQbGVhc2UgcHJvdmlkZSBiaW5hcnkgZGF0YSBhcyBgVWludDhBcnJheWAsIHJhdGhlciB0aGFuIGBCdWZmZXJgLiIpOwogIH0KICBpZiAodmFsIGluc3RhbmNlb2YgVWludDhBcnJheSAmJiB2YWwuYnl0ZUxlbmd0aCA9PT0gdmFsLmJ1ZmZlci5ieXRlTGVuZ3RoKSB7CiAgICByZXR1cm4gdmFsOwogIH0KICBpZiAodHlwZW9mIHZhbCA9PT0gInN0cmluZyIpIHsKICAgIHJldHVybiBzdHJpbmdUb0J5dGVzKHZhbCk7CiAgfQogIGlmICh2YWwgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciB8fCBBcnJheUJ1ZmZlci5pc1ZpZXcodmFsKSB8fCB0eXBlb2YgdmFsID09PSAib2JqZWN0IiAmJiAhaXNOYU4odmFsPy5sZW5ndGgpKSB7CiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkodmFsKTsKICB9CiAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIFBERiBiaW5hcnkgZGF0YTogZWl0aGVyIFR5cGVkQXJyYXksICIgKyAic3RyaW5nLCBvciBhcnJheS1saWtlIG9iamVjdCBpcyBleHBlY3RlZCBpbiB0aGUgZGF0YSBwcm9wZXJ0eS4iKTsKfQpmdW5jdGlvbiBnZXRGYWN0b3J5VXJsUHJvcCh2YWwpIHsKICBpZiAodHlwZW9mIHZhbCAhPT0gInN0cmluZyIpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBpZiAodmFsLmVuZHNXaXRoKCIvIikpIHsKICAgIHJldHVybiB2YWw7CiAgfQogIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBmYWN0b3J5IHVybDogIiR7dmFsfSIgbXVzdCBpbmNsdWRlIHRyYWlsaW5nIHNsYXNoLmApOwp9CmNvbnN0IGlzUmVmUHJveHkgPSB2ID0+IHR5cGVvZiB2ID09PSAib2JqZWN0IiAmJiBOdW1iZXIuaXNJbnRlZ2VyKHY/Lm51bSkgJiYgdi5udW0gPj0gMCAmJiBOdW1iZXIuaXNJbnRlZ2VyKHY/LmdlbikgJiYgdi5nZW4gPj0gMDsKY29uc3QgaXNOYW1lUHJveHkgPSB2ID0+IHR5cGVvZiB2ID09PSAib2JqZWN0IiAmJiB0eXBlb2Ygdj8ubmFtZSA9PT0gInN0cmluZyI7CmNvbnN0IGlzVmFsaWRFeHBsaWNpdERlc3QgPSBfaXNWYWxpZEV4cGxpY2l0RGVzdC5iaW5kKG51bGwsIGlzUmVmUHJveHksIGlzTmFtZVByb3h5KTsKY2xhc3MgTG9vcGJhY2tQb3J0IHsKICAjbGlzdGVuZXJzID0gbmV3IE1hcCgpOwogICNkZWZlcnJlZCA9IFByb21pc2UucmVzb2x2ZSgpOwogIHBvc3RNZXNzYWdlKG9iaiwgdHJhbnNmZXIpIHsKICAgIGNvbnN0IGV2ZW50ID0gewogICAgICBkYXRhOiBzdHJ1Y3R1cmVkQ2xvbmUob2JqLCB0cmFuc2ZlciA/IHsKICAgICAgICB0cmFuc2ZlcgogICAgICB9IDogbnVsbCkKICAgIH07CiAgICB0aGlzLiNkZWZlcnJlZC50aGVuKCgpID0+IHsKICAgICAgZm9yIChjb25zdCBbbGlzdGVuZXJdIG9mIHRoaXMuI2xpc3RlbmVycykgewogICAgICAgIGxpc3RlbmVyLmNhbGwodGhpcywgZXZlbnQpOwogICAgICB9CiAgICB9KTsKICB9CiAgYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCBsaXN0ZW5lciwgb3B0aW9ucyA9IG51bGwpIHsKICAgIGxldCBybUFib3J0ID0gbnVsbDsKICAgIGlmIChvcHRpb25zPy5zaWduYWwgaW5zdGFuY2VvZiBBYm9ydFNpZ25hbCkgewogICAgICBjb25zdCB7CiAgICAgICAgc2lnbmFsCiAgICAgIH0gPSBvcHRpb25zOwogICAgICBpZiAoc2lnbmFsLmFib3J0ZWQpIHsKICAgICAgICB3YXJuKCJMb29wYmFja1BvcnQgLSBjYW5ub3QgdXNlIGFuIGBhYm9ydGVkYCBzaWduYWwuIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IG9uQWJvcnQgPSAoKSA9PiB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIobmFtZSwgbGlzdGVuZXIpOwogICAgICBybUFib3J0ID0gKCkgPT4gc2lnbmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25BYm9ydCk7CiAgICAgIHNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwogICAgfQogICAgdGhpcy4jbGlzdGVuZXJzLnNldChsaXN0ZW5lciwgcm1BYm9ydCk7CiAgfQogIHJlbW92ZUV2ZW50TGlzdGVuZXIobmFtZSwgbGlzdGVuZXIpIHsKICAgIGNvbnN0IHJtQWJvcnQgPSB0aGlzLiNsaXN0ZW5lcnMuZ2V0KGxpc3RlbmVyKTsKICAgIHJtQWJvcnQ/LigpOwogICAgdGhpcy4jbGlzdGVuZXJzLmRlbGV0ZShsaXN0ZW5lcik7CiAgfQogIHRlcm1pbmF0ZSgpIHsKICAgIGZvciAoY29uc3QgWywgcm1BYm9ydF0gb2YgdGhpcy4jbGlzdGVuZXJzKSB7CiAgICAgIHJtQWJvcnQ/LigpOwogICAgfQogICAgdGhpcy4jbGlzdGVuZXJzLmNsZWFyKCk7CiAgfQp9Cgo7Ly8gLi9zcmMvc2hhcmVkL21lc3NhZ2VfaGFuZGxlci5qcwoKY29uc3QgQ2FsbGJhY2tLaW5kID0gewogIERBVEE6IDEsCiAgRVJST1I6IDIKfTsKY29uc3QgU3RyZWFtS2luZCA9IHsKICBDQU5DRUw6IDEsCiAgQ0FOQ0VMX0NPTVBMRVRFOiAyLAogIENMT1NFOiAzLAogIEVOUVVFVUU6IDQsCiAgRVJST1I6IDUsCiAgUFVMTDogNiwKICBQVUxMX0NPTVBMRVRFOiA3LAogIFNUQVJUX0NPTVBMRVRFOiA4Cn07CmZ1bmN0aW9uIG9uRm4oKSB7fQpmdW5jdGlvbiB3cmFwUmVhc29uKGV4KSB7CiAgaWYgKGV4IGluc3RhbmNlb2YgQWJvcnRFeGNlcHRpb24gfHwgZXggaW5zdGFuY2VvZiBJbnZhbGlkUERGRXhjZXB0aW9uIHx8IGV4IGluc3RhbmNlb2YgUGFzc3dvcmRFeGNlcHRpb24gfHwgZXggaW5zdGFuY2VvZiBSZXNwb25zZUV4Y2VwdGlvbiB8fCBleCBpbnN0YW5jZW9mIFVua25vd25FcnJvckV4Y2VwdGlvbikgewogICAgcmV0dXJuIGV4OwogIH0KICBpZiAoIShleCBpbnN0YW5jZW9mIEVycm9yIHx8IHR5cGVvZiBleCA9PT0gIm9iamVjdCIgJiYgZXggIT09IG51bGwpKSB7CiAgICB1bnJlYWNoYWJsZSgnd3JhcFJlYXNvbjogRXhwZWN0ZWQgInJlYXNvbiIgdG8gYmUgYSAocG9zc2libHkgY2xvbmVkKSBFcnJvci4nKTsKICB9CiAgc3dpdGNoIChleC5uYW1lKSB7CiAgICBjYXNlICJBYm9ydEV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgQWJvcnRFeGNlcHRpb24oZXgubWVzc2FnZSk7CiAgICBjYXNlICJJbnZhbGlkUERGRXhjZXB0aW9uIjoKICAgICAgcmV0dXJuIG5ldyBJbnZhbGlkUERGRXhjZXB0aW9uKGV4Lm1lc3NhZ2UpOwogICAgY2FzZSAiUGFzc3dvcmRFeGNlcHRpb24iOgogICAgICByZXR1cm4gbmV3IFBhc3N3b3JkRXhjZXB0aW9uKGV4Lm1lc3NhZ2UsIGV4LmNvZGUpOwogICAgY2FzZSAiUmVzcG9uc2VFeGNlcHRpb24iOgogICAgICByZXR1cm4gbmV3IFJlc3BvbnNlRXhjZXB0aW9uKGV4Lm1lc3NhZ2UsIGV4LnN0YXR1cywgZXgubWlzc2luZyk7CiAgICBjYXNlICJVbmtub3duRXJyb3JFeGNlcHRpb24iOgogICAgICByZXR1cm4gbmV3IFVua25vd25FcnJvckV4Y2VwdGlvbihleC5tZXNzYWdlLCBleC5kZXRhaWxzKTsKICB9CiAgcmV0dXJuIG5ldyBVbmtub3duRXJyb3JFeGNlcHRpb24oZXgubWVzc2FnZSwgZXgudG9TdHJpbmcoKSk7Cn0KY2xhc3MgTWVzc2FnZUhhbmRsZXIgewogICNtZXNzYWdlQUMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgY29uc3RydWN0b3Ioc291cmNlTmFtZSwgdGFyZ2V0TmFtZSwgY29tT2JqKSB7CiAgICB0aGlzLnNvdXJjZU5hbWUgPSBzb3VyY2VOYW1lOwogICAgdGhpcy50YXJnZXROYW1lID0gdGFyZ2V0TmFtZTsKICAgIHRoaXMuY29tT2JqID0gY29tT2JqOwogICAgdGhpcy5jYWxsYmFja0lkID0gMTsKICAgIHRoaXMuc3RyZWFtSWQgPSAxOwogICAgdGhpcy5zdHJlYW1TaW5rcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdGhpcy5hY3Rpb25IYW5kbGVyID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGNvbU9iai5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgdGhpcy4jb25NZXNzYWdlLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsOiB0aGlzLiNtZXNzYWdlQUMuc2lnbmFsCiAgICB9KTsKICB9CiAgI29uTWVzc2FnZSh7CiAgICBkYXRhCiAgfSkgewogICAgaWYgKGRhdGEudGFyZ2V0TmFtZSAhPT0gdGhpcy5zb3VyY2VOYW1lKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChkYXRhLnN0cmVhbSkgewogICAgICB0aGlzLiNwcm9jZXNzU3RyZWFtTWVzc2FnZShkYXRhKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGRhdGEuY2FsbGJhY2spIHsKICAgICAgY29uc3QgY2FsbGJhY2tJZCA9IGRhdGEuY2FsbGJhY2tJZDsKICAgICAgY29uc3QgY2FwYWJpbGl0eSA9IHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXNbY2FsbGJhY2tJZF07CiAgICAgIGlmICghY2FwYWJpbGl0eSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHJlc29sdmUgY2FsbGJhY2sgJHtjYWxsYmFja0lkfWApOwogICAgICB9CiAgICAgIGRlbGV0ZSB0aGlzLmNhbGxiYWNrQ2FwYWJpbGl0aWVzW2NhbGxiYWNrSWRdOwogICAgICBpZiAoZGF0YS5jYWxsYmFjayA9PT0gQ2FsbGJhY2tLaW5kLkRBVEEpIHsKICAgICAgICBjYXBhYmlsaXR5LnJlc29sdmUoZGF0YS5kYXRhKTsKICAgICAgfSBlbHNlIGlmIChkYXRhLmNhbGxiYWNrID09PSBDYWxsYmFja0tpbmQuRVJST1IpIHsKICAgICAgICBjYXBhYmlsaXR5LnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIGNhbGxiYWNrIGNhc2UiKTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBhY3Rpb24gPSB0aGlzLmFjdGlvbkhhbmRsZXJbZGF0YS5hY3Rpb25dOwogICAgaWYgKCFhY3Rpb24pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGFjdGlvbiBmcm9tIHdvcmtlcjogJHtkYXRhLmFjdGlvbn1gKTsKICAgIH0KICAgIGlmIChkYXRhLmNhbGxiYWNrSWQpIHsKICAgICAgY29uc3Qgc291cmNlTmFtZSA9IHRoaXMuc291cmNlTmFtZSwKICAgICAgICB0YXJnZXROYW1lID0gZGF0YS5zb3VyY2VOYW1lLAogICAgICAgIGNvbU9iaiA9IHRoaXMuY29tT2JqOwogICAgICBQcm9taXNlLnRyeShhY3Rpb24sIGRhdGEuZGF0YSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgY2FsbGJhY2s6IENhbGxiYWNrS2luZC5EQVRBLAogICAgICAgICAgY2FsbGJhY2tJZDogZGF0YS5jYWxsYmFja0lkLAogICAgICAgICAgZGF0YTogcmVzdWx0CiAgICAgICAgfSk7CiAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBjYWxsYmFjazogQ2FsbGJhY2tLaW5kLkVSUk9SLAogICAgICAgICAgY2FsbGJhY2tJZDogZGF0YS5jYWxsYmFja0lkLAogICAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChkYXRhLnN0cmVhbUlkKSB7CiAgICAgIHRoaXMuI2NyZWF0ZVN0cmVhbVNpbmsoZGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGFjdGlvbihkYXRhLmRhdGEpOwogIH0KICBvbihhY3Rpb25OYW1lLCBoYW5kbGVyKSB7CiAgICBjb25zdCBhaCA9IHRoaXMuYWN0aW9uSGFuZGxlcjsKICAgIGlmIChhaFthY3Rpb25OYW1lXSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIGlzIGFscmVhZHkgYW4gYWN0aW9uTmFtZSBjYWxsZWQgIiR7YWN0aW9uTmFtZX0iYCk7CiAgICB9CiAgICBhaFthY3Rpb25OYW1lXSA9IGhhbmRsZXI7CiAgfQogIHNlbmQoYWN0aW9uTmFtZSwgZGF0YSwgdHJhbnNmZXJzKSB7CiAgICB0aGlzLmNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgIHNvdXJjZU5hbWU6IHRoaXMuc291cmNlTmFtZSwKICAgICAgdGFyZ2V0TmFtZTogdGhpcy50YXJnZXROYW1lLAogICAgICBhY3Rpb246IGFjdGlvbk5hbWUsCiAgICAgIGRhdGEKICAgIH0sIHRyYW5zZmVycyk7CiAgfQogIHNlbmRXaXRoUHJvbWlzZShhY3Rpb25OYW1lLCBkYXRhLCB0cmFuc2ZlcnMpIHsKICAgIGNvbnN0IGNhbGxiYWNrSWQgPSB0aGlzLmNhbGxiYWNrSWQrKzsKICAgIGNvbnN0IGNhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXNbY2FsbGJhY2tJZF0gPSBjYXBhYmlsaXR5OwogICAgdHJ5IHsKICAgICAgdGhpcy5jb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgIHNvdXJjZU5hbWU6IHRoaXMuc291cmNlTmFtZSwKICAgICAgICB0YXJnZXROYW1lOiB0aGlzLnRhcmdldE5hbWUsCiAgICAgICAgYWN0aW9uOiBhY3Rpb25OYW1lLAogICAgICAgIGNhbGxiYWNrSWQsCiAgICAgICAgZGF0YQogICAgICB9LCB0cmFuc2ZlcnMpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgY2FwYWJpbGl0eS5yZWplY3QoZXgpOwogICAgfQogICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgc2VuZFdpdGhTdHJlYW0oYWN0aW9uTmFtZSwgZGF0YSwgcXVldWVpbmdTdHJhdGVneSwgdHJhbnNmZXJzKSB7CiAgICBjb25zdCBzdHJlYW1JZCA9IHRoaXMuc3RyZWFtSWQrKywKICAgICAgc291cmNlTmFtZSA9IHRoaXMuc291cmNlTmFtZSwKICAgICAgdGFyZ2V0TmFtZSA9IHRoaXMudGFyZ2V0TmFtZSwKICAgICAgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICByZXR1cm4gbmV3IFJlYWRhYmxlU3RyZWFtKHsKICAgICAgc3RhcnQ6IGNvbnRyb2xsZXIgPT4gewogICAgICAgIGNvbnN0IHN0YXJ0Q2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdID0gewogICAgICAgICAgY29udHJvbGxlciwKICAgICAgICAgIHN0YXJ0Q2FsbDogc3RhcnRDYXBhYmlsaXR5LAogICAgICAgICAgcHVsbENhbGw6IG51bGwsCiAgICAgICAgICBjYW5jZWxDYWxsOiBudWxsLAogICAgICAgICAgaXNDbG9zZWQ6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBhY3Rpb246IGFjdGlvbk5hbWUsCiAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgIGRhdGEsCiAgICAgICAgICBkZXNpcmVkU2l6ZTogY29udHJvbGxlci5kZXNpcmVkU2l6ZQogICAgICAgIH0sIHRyYW5zZmVycyk7CiAgICAgICAgcmV0dXJuIHN0YXJ0Q2FwYWJpbGl0eS5wcm9taXNlOwogICAgICB9LAogICAgICBwdWxsOiBjb250cm9sbGVyID0+IHsKICAgICAgICBjb25zdCBwdWxsQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLnB1bGxDYWxsID0gcHVsbENhcGFiaWxpdHk7CiAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlBVTEwsCiAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgIGRlc2lyZWRTaXplOiBjb250cm9sbGVyLmRlc2lyZWRTaXplCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHB1bGxDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0sCiAgICAgIGNhbmNlbDogcmVhc29uID0+IHsKICAgICAgICBhc3NlcnQocmVhc29uIGluc3RhbmNlb2YgRXJyb3IsICJjYW5jZWwgbXVzdCBoYXZlIGEgdmFsaWQgcmVhc29uIik7CiAgICAgICAgY29uc3QgY2FuY2VsQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLmNhbmNlbENhbGwgPSBjYW5jZWxDYXBhYmlsaXR5OwogICAgICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLmlzQ2xvc2VkID0gdHJ1ZTsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuQ0FOQ0VMLAogICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBjYW5jZWxDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0KICAgIH0sIHF1ZXVlaW5nU3RyYXRlZ3kpOwogIH0KICAjY3JlYXRlU3RyZWFtU2luayhkYXRhKSB7CiAgICBjb25zdCBzdHJlYW1JZCA9IGRhdGEuc3RyZWFtSWQsCiAgICAgIHNvdXJjZU5hbWUgPSB0aGlzLnNvdXJjZU5hbWUsCiAgICAgIHRhcmdldE5hbWUgPSBkYXRhLnNvdXJjZU5hbWUsCiAgICAgIGNvbU9iaiA9IHRoaXMuY29tT2JqOwogICAgY29uc3Qgc2VsZiA9IHRoaXMsCiAgICAgIGFjdGlvbiA9IHRoaXMuYWN0aW9uSGFuZGxlcltkYXRhLmFjdGlvbl07CiAgICBjb25zdCBzdHJlYW1TaW5rID0gewogICAgICBlbnF1ZXVlKGNodW5rLCBzaXplID0gMSwgdHJhbnNmZXJzKSB7CiAgICAgICAgaWYgKHRoaXMuaXNDYW5jZWxsZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgbGFzdERlc2lyZWRTaXplID0gdGhpcy5kZXNpcmVkU2l6ZTsKICAgICAgICB0aGlzLmRlc2lyZWRTaXplIC09IHNpemU7CiAgICAgICAgaWYgKGxhc3REZXNpcmVkU2l6ZSA+IDAgJiYgdGhpcy5kZXNpcmVkU2l6ZSA8PSAwKSB7CiAgICAgICAgICB0aGlzLnNpbmtDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgICAgICB0aGlzLnJlYWR5ID0gdGhpcy5zaW5rQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuRU5RVUVVRSwKICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgY2h1bmsKICAgICAgICB9LCB0cmFuc2ZlcnMpOwogICAgICB9LAogICAgICBjbG9zZSgpIHsKICAgICAgICBpZiAodGhpcy5pc0NhbmNlbGxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmlzQ2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuQ0xPU0UsCiAgICAgICAgICBzdHJlYW1JZAogICAgICAgIH0pOwogICAgICAgIGRlbGV0ZSBzZWxmLnN0cmVhbVNpbmtzW3N0cmVhbUlkXTsKICAgICAgfSwKICAgICAgZXJyb3IocmVhc29uKSB7CiAgICAgICAgYXNzZXJ0KHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yLCAiZXJyb3IgbXVzdCBoYXZlIGEgdmFsaWQgcmVhc29uIik7CiAgICAgICAgaWYgKHRoaXMuaXNDYW5jZWxsZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5pc0NhbmNlbGxlZCA9IHRydWU7CiAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkVSUk9SLAogICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgIH0pOwogICAgICB9LAogICAgICBzaW5rQ2FwYWJpbGl0eTogUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCksCiAgICAgIG9uUHVsbDogbnVsbCwKICAgICAgb25DYW5jZWw6IG51bGwsCiAgICAgIGlzQ2FuY2VsbGVkOiBmYWxzZSwKICAgICAgZGVzaXJlZFNpemU6IGRhdGEuZGVzaXJlZFNpemUsCiAgICAgIHJlYWR5OiBudWxsCiAgICB9OwogICAgc3RyZWFtU2luay5zaW5rQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICBzdHJlYW1TaW5rLnJlYWR5ID0gc3RyZWFtU2luay5zaW5rQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgdGhpcy5zdHJlYW1TaW5rc1tzdHJlYW1JZF0gPSBzdHJlYW1TaW5rOwogICAgUHJvbWlzZS50cnkoYWN0aW9uLCBkYXRhLmRhdGEsIHN0cmVhbVNpbmspLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuU1RBUlRfQ09NUExFVEUsCiAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgc3VjY2VzczogdHJ1ZQogICAgICB9KTsKICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlNUQVJUX0NPTVBMRVRFLAogICAgICAgIHN0cmVhbUlkLAogICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgIH0pOwogICAgfSk7CiAgfQogICNwcm9jZXNzU3RyZWFtTWVzc2FnZShkYXRhKSB7CiAgICBjb25zdCBzdHJlYW1JZCA9IGRhdGEuc3RyZWFtSWQsCiAgICAgIHNvdXJjZU5hbWUgPSB0aGlzLnNvdXJjZU5hbWUsCiAgICAgIHRhcmdldE5hbWUgPSBkYXRhLnNvdXJjZU5hbWUsCiAgICAgIGNvbU9iaiA9IHRoaXMuY29tT2JqOwogICAgY29uc3Qgc3RyZWFtQ29udHJvbGxlciA9IHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdLAogICAgICBzdHJlYW1TaW5rID0gdGhpcy5zdHJlYW1TaW5rc1tzdHJlYW1JZF07CiAgICBzd2l0Y2ggKGRhdGEuc3RyZWFtKSB7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5TVEFSVF9DT01QTEVURToKICAgICAgICBpZiAoZGF0YS5zdWNjZXNzKSB7CiAgICAgICAgICBzdHJlYW1Db250cm9sbGVyLnN0YXJ0Q2FsbC5yZXNvbHZlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuc3RhcnRDYWxsLnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuUFVMTF9DT01QTEVURToKICAgICAgICBpZiAoZGF0YS5zdWNjZXNzKSB7CiAgICAgICAgICBzdHJlYW1Db250cm9sbGVyLnB1bGxDYWxsLnJlc29sdmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5wdWxsQ2FsbC5yZWplY3Qod3JhcFJlYXNvbihkYXRhLnJlYXNvbikpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLlBVTEw6CiAgICAgICAgaWYgKCFzdHJlYW1TaW5rKSB7CiAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTF9DT01QTEVURSwKICAgICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChzdHJlYW1TaW5rLmRlc2lyZWRTaXplIDw9IDAgJiYgZGF0YS5kZXNpcmVkU2l6ZSA+IDApIHsKICAgICAgICAgIHN0cmVhbVNpbmsuc2lua0NhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICAgIH0KICAgICAgICBzdHJlYW1TaW5rLmRlc2lyZWRTaXplID0gZGF0YS5kZXNpcmVkU2l6ZTsKICAgICAgICBQcm9taXNlLnRyeShzdHJlYW1TaW5rLm9uUHVsbCB8fCBvbkZuKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFLAogICAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgICAgc3VjY2VzczogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlBVTExfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5FTlFVRVVFOgogICAgICAgIGFzc2VydChzdHJlYW1Db250cm9sbGVyLCAiZW5xdWV1ZSBzaG91bGQgaGF2ZSBzdHJlYW0gY29udHJvbGxlciIpOwogICAgICAgIGlmIChzdHJlYW1Db250cm9sbGVyLmlzQ2xvc2VkKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgc3RyZWFtQ29udHJvbGxlci5jb250cm9sbGVyLmVucXVldWUoZGF0YS5jaHVuayk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5DTE9TRToKICAgICAgICBhc3NlcnQoc3RyZWFtQ29udHJvbGxlciwgImNsb3NlIHNob3VsZCBoYXZlIHN0cmVhbSBjb250cm9sbGVyIik7CiAgICAgICAgaWYgKHN0cmVhbUNvbnRyb2xsZXIuaXNDbG9zZWQpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBzdHJlYW1Db250cm9sbGVyLmlzQ2xvc2VkID0gdHJ1ZTsKICAgICAgICBzdHJlYW1Db250cm9sbGVyLmNvbnRyb2xsZXIuY2xvc2UoKTsKICAgICAgICB0aGlzLiNkZWxldGVTdHJlYW1Db250cm9sbGVyKHN0cmVhbUNvbnRyb2xsZXIsIHN0cmVhbUlkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLkVSUk9SOgogICAgICAgIGFzc2VydChzdHJlYW1Db250cm9sbGVyLCAiZXJyb3Igc2hvdWxkIGhhdmUgc3RyZWFtIGNvbnRyb2xsZXIiKTsKICAgICAgICBzdHJlYW1Db250cm9sbGVyLmNvbnRyb2xsZXIuZXJyb3Iod3JhcFJlYXNvbihkYXRhLnJlYXNvbikpOwogICAgICAgIHRoaXMuI2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtQ29udHJvbGxlciwgc3RyZWFtSWQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuQ0FOQ0VMX0NPTVBMRVRFOgogICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuY2FuY2VsQ2FsbC5yZXNvbHZlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuY2FuY2VsQ2FsbC5yZWplY3Qod3JhcFJlYXNvbihkYXRhLnJlYXNvbikpOwogICAgICAgIH0KICAgICAgICB0aGlzLiNkZWxldGVTdHJlYW1Db250cm9sbGVyKHN0cmVhbUNvbnRyb2xsZXIsIHN0cmVhbUlkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLkNBTkNFTDoKICAgICAgICBpZiAoIXN0cmVhbVNpbmspIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjb25zdCBkYXRhUmVhc29uID0gd3JhcFJlYXNvbihkYXRhLnJlYXNvbik7CiAgICAgICAgUHJvbWlzZS50cnkoc3RyZWFtU2luay5vbkNhbmNlbCB8fCBvbkZuLCBkYXRhUmVhc29uKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DQU5DRUxfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuQ0FOQ0VMX0NPTVBMRVRFLAogICAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIHN0cmVhbVNpbmsuc2lua0NhcGFiaWxpdHkucmVqZWN0KGRhdGFSZWFzb24pOwogICAgICAgIHN0cmVhbVNpbmsuaXNDYW5jZWxsZWQgPSB0cnVlOwogICAgICAgIGRlbGV0ZSB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgc3RyZWFtIGNhc2UiKTsKICAgIH0KICB9CiAgYXN5bmMgI2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtQ29udHJvbGxlciwgc3RyZWFtSWQpIHsKICAgIGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChbc3RyZWFtQ29udHJvbGxlci5zdGFydENhbGw/LnByb21pc2UsIHN0cmVhbUNvbnRyb2xsZXIucHVsbENhbGw/LnByb21pc2UsIHN0cmVhbUNvbnRyb2xsZXIuY2FuY2VsQ2FsbD8ucHJvbWlzZV0pOwogICAgZGVsZXRlIHRoaXMuc3RyZWFtQ29udHJvbGxlcnNbc3RyZWFtSWRdOwogIH0KICBkZXN0cm95KCkgewogICAgdGhpcy4jbWVzc2FnZUFDPy5hYm9ydCgpOwogICAgdGhpcy4jbWVzc2FnZUFDID0gbnVsbDsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L2NhbnZhc19mYWN0b3J5LmpzCgpjbGFzcyBCYXNlQ2FudmFzRmFjdG9yeSB7CiAgI2VuYWJsZUhXQSA9IGZhbHNlOwogIGNvbnN0cnVjdG9yKHsKICAgIGVuYWJsZUhXQSA9IGZhbHNlCiAgfSkgewogICAgdGhpcy4jZW5hYmxlSFdBID0gZW5hYmxlSFdBOwogIH0KICBjcmVhdGUod2lkdGgsIGhlaWdodCkgewogICAgaWYgKHdpZHRoIDw9IDAgfHwgaGVpZ2h0IDw9IDApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNhbnZhcyBzaXplIik7CiAgICB9CiAgICBjb25zdCBjYW52YXMgPSB0aGlzLl9jcmVhdGVDYW52YXMod2lkdGgsIGhlaWdodCk7CiAgICByZXR1cm4gewogICAgICBjYW52YXMsCiAgICAgIGNvbnRleHQ6IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIsIHsKICAgICAgICB3aWxsUmVhZEZyZXF1ZW50bHk6ICF0aGlzLiNlbmFibGVIV0EKICAgICAgfSkKICAgIH07CiAgfQogIHJlc2V0KGNhbnZhc0FuZENvbnRleHQsIHdpZHRoLCBoZWlnaHQpIHsKICAgIGlmICghY2FudmFzQW5kQ29udGV4dC5jYW52YXMpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW52YXMgaXMgbm90IHNwZWNpZmllZCIpOwogICAgfQogICAgaWYgKHdpZHRoIDw9IDAgfHwgaGVpZ2h0IDw9IDApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNhbnZhcyBzaXplIik7CiAgICB9CiAgICBjYW52YXNBbmRDb250ZXh0LmNhbnZhcy53aWR0aCA9IHdpZHRoOwogICAgY2FudmFzQW5kQ29udGV4dC5jYW52YXMuaGVpZ2h0ID0gaGVpZ2h0OwogIH0KICBkZXN0cm95KGNhbnZhc0FuZENvbnRleHQpIHsKICAgIGlmICghY2FudmFzQW5kQ29udGV4dC5jYW52YXMpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW52YXMgaXMgbm90IHNwZWNpZmllZCIpOwogICAgfQogICAgY2FudmFzQW5kQ29udGV4dC5jYW52YXMud2lkdGggPSAwOwogICAgY2FudmFzQW5kQ29udGV4dC5jYW52YXMuaGVpZ2h0ID0gMDsKICAgIGNhbnZhc0FuZENvbnRleHQuY2FudmFzID0gbnVsbDsKICAgIGNhbnZhc0FuZENvbnRleHQuY29udGV4dCA9IG51bGw7CiAgfQogIF9jcmVhdGVDYW52YXMod2lkdGgsIGhlaWdodCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgX2NyZWF0ZUNhbnZhc2AgY2FsbGVkLiIpOwogIH0KfQpjbGFzcyBET01DYW52YXNGYWN0b3J5IGV4dGVuZHMgQmFzZUNhbnZhc0ZhY3RvcnkgewogIGNvbnN0cnVjdG9yKHsKICAgIG93bmVyRG9jdW1lbnQgPSBnbG9iYWxUaGlzLmRvY3VtZW50LAogICAgZW5hYmxlSFdBID0gZmFsc2UKICB9KSB7CiAgICBzdXBlcih7CiAgICAgIGVuYWJsZUhXQQogICAgfSk7CiAgICB0aGlzLl9kb2N1bWVudCA9IG93bmVyRG9jdW1lbnQ7CiAgfQogIF9jcmVhdGVDYW52YXMod2lkdGgsIGhlaWdodCkgewogICAgY29uc3QgY2FudmFzID0gdGhpcy5fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICBjYW52YXMud2lkdGggPSB3aWR0aDsKICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICByZXR1cm4gY2FudmFzOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvY21hcF9yZWFkZXJfZmFjdG9yeS5qcwoKCmNsYXNzIEJhc2VDTWFwUmVhZGVyRmFjdG9yeSB7CiAgY29uc3RydWN0b3IoewogICAgYmFzZVVybCA9IG51bGwsCiAgICBpc0NvbXByZXNzZWQgPSB0cnVlCiAgfSkgewogICAgdGhpcy5iYXNlVXJsID0gYmFzZVVybDsKICAgIHRoaXMuaXNDb21wcmVzc2VkID0gaXNDb21wcmVzc2VkOwogIH0KICBhc3luYyBmZXRjaCh7CiAgICBuYW1lCiAgfSkgewogICAgaWYgKCF0aGlzLmJhc2VVcmwpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJFbnN1cmUgdGhhdCB0aGUgYGNNYXBVcmxgIGFuZCBgY01hcFBhY2tlZGAgQVBJIHBhcmFtZXRlcnMgYXJlIHByb3ZpZGVkLiIpOwogICAgfQogICAgaWYgKCFuYW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiQ01hcCBuYW1lIG11c3QgYmUgc3BlY2lmaWVkLiIpOwogICAgfQogICAgY29uc3QgdXJsID0gdGhpcy5iYXNlVXJsICsgbmFtZSArICh0aGlzLmlzQ29tcHJlc3NlZCA/ICIuYmNtYXAiIDogIiIpOwogICAgcmV0dXJuIHRoaXMuX2ZldGNoKHVybCkudGhlbihjTWFwRGF0YSA9PiAoewogICAgICBjTWFwRGF0YSwKICAgICAgaXNDb21wcmVzc2VkOiB0aGlzLmlzQ29tcHJlc3NlZAogICAgfSkpLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGxvYWQgJHt0aGlzLmlzQ29tcHJlc3NlZCA/ICJiaW5hcnkgIiA6ICIifUNNYXAgYXQ6ICR7dXJsfWApOwogICAgfSk7CiAgfQogIGFzeW5jIF9mZXRjaCh1cmwpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYF9mZXRjaGAgY2FsbGVkLiIpOwogIH0KfQpjbGFzcyBET01DTWFwUmVhZGVyRmFjdG9yeSBleHRlbmRzIEJhc2VDTWFwUmVhZGVyRmFjdG9yeSB7CiAgYXN5bmMgX2ZldGNoKHVybCkgewogICAgY29uc3QgZGF0YSA9IGF3YWl0IGZldGNoRGF0YSh1cmwsIHRoaXMuaXNDb21wcmVzc2VkID8gImFycmF5YnVmZmVyIiA6ICJ0ZXh0Iik7CiAgICByZXR1cm4gZGF0YSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyID8gbmV3IFVpbnQ4QXJyYXkoZGF0YSkgOiBzdHJpbmdUb0J5dGVzKGRhdGEpOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvZmlsdGVyX2ZhY3RvcnkuanMKCgpjbGFzcyBCYXNlRmlsdGVyRmFjdG9yeSB7CiAgYWRkRmlsdGVyKG1hcHMpIHsKICAgIHJldHVybiAibm9uZSI7CiAgfQogIGFkZEhDTUZpbHRlcihmZ0NvbG9yLCBiZ0NvbG9yKSB7CiAgICByZXR1cm4gIm5vbmUiOwogIH0KICBhZGRBbHBoYUZpbHRlcihtYXApIHsKICAgIHJldHVybiAibm9uZSI7CiAgfQogIGFkZEx1bWlub3NpdHlGaWx0ZXIobWFwKSB7CiAgICByZXR1cm4gIm5vbmUiOwogIH0KICBhZGRIaWdobGlnaHRIQ01GaWx0ZXIoZmlsdGVyTmFtZSwgZmdDb2xvciwgYmdDb2xvciwgbmV3RmdDb2xvciwgbmV3QmdDb2xvcikgewogICAgcmV0dXJuICJub25lIjsKICB9CiAgZGVzdHJveShrZWVwSENNID0gZmFsc2UpIHt9Cn0KY2xhc3MgRE9NRmlsdGVyRmFjdG9yeSBleHRlbmRzIEJhc2VGaWx0ZXJGYWN0b3J5IHsKICAjYmFzZVVybDsKICAjX2NhY2hlOwogICNfZGVmczsKICAjZG9jSWQ7CiAgI2RvY3VtZW50OwogICNfaGNtQ2FjaGU7CiAgI2lkID0gMDsKICBjb25zdHJ1Y3Rvcih7CiAgICBkb2NJZCwKICAgIG93bmVyRG9jdW1lbnQgPSBnbG9iYWxUaGlzLmRvY3VtZW50CiAgfSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuI2RvY0lkID0gZG9jSWQ7CiAgICB0aGlzLiNkb2N1bWVudCA9IG93bmVyRG9jdW1lbnQ7CiAgfQogIGdldCAjY2FjaGUoKSB7CiAgICByZXR1cm4gdGhpcy4jX2NhY2hlIHx8PSBuZXcgTWFwKCk7CiAgfQogIGdldCAjaGNtQ2FjaGUoKSB7CiAgICByZXR1cm4gdGhpcy4jX2hjbUNhY2hlIHx8PSBuZXcgTWFwKCk7CiAgfQogIGdldCAjZGVmcygpIHsKICAgIGlmICghdGhpcy4jX2RlZnMpIHsKICAgICAgY29uc3QgZGl2ID0gdGhpcy4jZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGNvbnN0IHsKICAgICAgICBzdHlsZQogICAgICB9ID0gZGl2OwogICAgICBzdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgIHN0eWxlLmNvbnRhaW4gPSAic3RyaWN0IjsKICAgICAgc3R5bGUud2lkdGggPSBzdHlsZS5oZWlnaHQgPSAwOwogICAgICBzdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICAgIHN0eWxlLnRvcCA9IHN0eWxlLmxlZnQgPSAwOwogICAgICBzdHlsZS56SW5kZXggPSAtMTsKICAgICAgY29uc3Qgc3ZnID0gdGhpcy4jZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFNWR19OUywgInN2ZyIpOwogICAgICBzdmcuc2V0QXR0cmlidXRlKCJ3aWR0aCIsIDApOwogICAgICBzdmcuc2V0QXR0cmlidXRlKCJoZWlnaHQiLCAwKTsKICAgICAgdGhpcy4jX2RlZnMgPSB0aGlzLiNkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoU1ZHX05TLCAiZGVmcyIpOwogICAgICBkaXYuYXBwZW5kKHN2Zyk7CiAgICAgIHN2Zy5hcHBlbmQodGhpcy4jX2RlZnMpOwogICAgICB0aGlzLiNkb2N1bWVudC5ib2R5LmFwcGVuZChkaXYpOwogICAgfQogICAgcmV0dXJuIHRoaXMuI19kZWZzOwogIH0KICAjY3JlYXRlVGFibGVzKG1hcHMpIHsKICAgIGlmIChtYXBzLmxlbmd0aCA9PT0gMSkgewogICAgICBjb25zdCBtYXBSID0gbWFwc1swXTsKICAgICAgY29uc3QgYnVmZmVyID0gbmV3IEFycmF5KDI1Nik7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICBidWZmZXJbaV0gPSBtYXBSW2ldIC8gMjU1OwogICAgICB9CiAgICAgIGNvbnN0IHRhYmxlID0gYnVmZmVyLmpvaW4oIiwiKTsKICAgICAgcmV0dXJuIFt0YWJsZSwgdGFibGUsIHRhYmxlXTsKICAgIH0KICAgIGNvbnN0IFttYXBSLCBtYXBHLCBtYXBCXSA9IG1hcHM7CiAgICBjb25zdCBidWZmZXJSID0gbmV3IEFycmF5KDI1Nik7CiAgICBjb25zdCBidWZmZXJHID0gbmV3IEFycmF5KDI1Nik7CiAgICBjb25zdCBidWZmZXJCID0gbmV3IEFycmF5KDI1Nik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgaSsrKSB7CiAgICAgIGJ1ZmZlclJbaV0gPSBtYXBSW2ldIC8gMjU1OwogICAgICBidWZmZXJHW2ldID0gbWFwR1tpXSAvIDI1NTsKICAgICAgYnVmZmVyQltpXSA9IG1hcEJbaV0gLyAyNTU7CiAgICB9CiAgICByZXR1cm4gW2J1ZmZlclIuam9pbigiLCIpLCBidWZmZXJHLmpvaW4oIiwiKSwgYnVmZmVyQi5qb2luKCIsIildOwogIH0KICAjY3JlYXRlVXJsKGlkKSB7CiAgICBpZiAodGhpcy4jYmFzZVVybCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuI2Jhc2VVcmwgPSAiIjsKICAgICAgY29uc3QgdXJsID0gdGhpcy4jZG9jdW1lbnQuVVJMOwogICAgICBpZiAodXJsICE9PSB0aGlzLiNkb2N1bWVudC5iYXNlVVJJKSB7CiAgICAgICAgaWYgKGlzRGF0YVNjaGVtZSh1cmwpKSB7CiAgICAgICAgICB3YXJuKCcjY3JlYXRlVXJsOiBpZ25vcmUgImRhdGE6Ii1VUkwgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMuJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuI2Jhc2VVcmwgPSB1cGRhdGVVcmxIYXNoKHVybCwgIiIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGB1cmwoJHt0aGlzLiNiYXNlVXJsfSMke2lkfSlgOwogIH0KICBhZGRGaWx0ZXIobWFwcykgewogICAgaWYgKCFtYXBzKSB7CiAgICAgIHJldHVybiAibm9uZSI7CiAgICB9CiAgICBsZXQgdmFsdWUgPSB0aGlzLiNjYWNoZS5nZXQobWFwcyk7CiAgICBpZiAodmFsdWUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgY29uc3QgW3RhYmxlUiwgdGFibGVHLCB0YWJsZUJdID0gdGhpcy4jY3JlYXRlVGFibGVzKG1hcHMpOwogICAgY29uc3Qga2V5ID0gbWFwcy5sZW5ndGggPT09IDEgPyB0YWJsZVIgOiBgJHt0YWJsZVJ9JHt0YWJsZUd9JHt0YWJsZUJ9YDsKICAgIHZhbHVlID0gdGhpcy4jY2FjaGUuZ2V0KGtleSk7CiAgICBpZiAodmFsdWUpIHsKICAgICAgdGhpcy4jY2FjaGUuc2V0KG1hcHMsIHZhbHVlKTsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgY29uc3QgaWQgPSBgZ18ke3RoaXMuI2RvY0lkfV90cmFuc2Zlcl9tYXBfJHt0aGlzLiNpZCsrfWA7CiAgICBjb25zdCB1cmwgPSB0aGlzLiNjcmVhdGVVcmwoaWQpOwogICAgdGhpcy4jY2FjaGUuc2V0KG1hcHMsIHVybCk7CiAgICB0aGlzLiNjYWNoZS5zZXQoa2V5LCB1cmwpOwogICAgY29uc3QgZmlsdGVyID0gdGhpcy4jY3JlYXRlRmlsdGVyKGlkKTsKICAgIHRoaXMuI2FkZFRyYW5zZmVyTWFwQ29udmVyc2lvbih0YWJsZVIsIHRhYmxlRywgdGFibGVCLCBmaWx0ZXIpOwogICAgcmV0dXJuIHVybDsKICB9CiAgYWRkSENNRmlsdGVyKGZnQ29sb3IsIGJnQ29sb3IpIHsKICAgIGNvbnN0IGtleSA9IGAke2ZnQ29sb3J9LSR7YmdDb2xvcn1gOwogICAgY29uc3QgZmlsdGVyTmFtZSA9ICJiYXNlIjsKICAgIGxldCBpbmZvID0gdGhpcy4jaGNtQ2FjaGUuZ2V0KGZpbHRlck5hbWUpOwogICAgaWYgKGluZm8/LmtleSA9PT0ga2V5KSB7CiAgICAgIHJldHVybiBpbmZvLnVybDsKICAgIH0KICAgIGlmIChpbmZvKSB7CiAgICAgIGluZm8uZmlsdGVyPy5yZW1vdmUoKTsKICAgICAgaW5mby5rZXkgPSBrZXk7CiAgICAgIGluZm8udXJsID0gIm5vbmUiOwogICAgICBpbmZvLmZpbHRlciA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICBpbmZvID0gewogICAgICAgIGtleSwKICAgICAgICB1cmw6ICJub25lIiwKICAgICAgICBmaWx0ZXI6IG51bGwKICAgICAgfTsKICAgICAgdGhpcy4jaGNtQ2FjaGUuc2V0KGZpbHRlck5hbWUsIGluZm8pOwogICAgfQogICAgaWYgKCFmZ0NvbG9yIHx8ICFiZ0NvbG9yKSB7CiAgICAgIHJldHVybiBpbmZvLnVybDsKICAgIH0KICAgIGNvbnN0IGZnUkdCID0gdGhpcy4jZ2V0UkdCKGZnQ29sb3IpOwogICAgZmdDb2xvciA9IFV0aWwubWFrZUhleENvbG9yKC4uLmZnUkdCKTsKICAgIGNvbnN0IGJnUkdCID0gdGhpcy4jZ2V0UkdCKGJnQ29sb3IpOwogICAgYmdDb2xvciA9IFV0aWwubWFrZUhleENvbG9yKC4uLmJnUkdCKTsKICAgIHRoaXMuI2RlZnMuc3R5bGUuY29sb3IgPSAiIjsKICAgIGlmIChmZ0NvbG9yID09PSAiIzAwMDAwMCIgJiYgYmdDb2xvciA9PT0gIiNmZmZmZmYiIHx8IGZnQ29sb3IgPT09IGJnQ29sb3IpIHsKICAgICAgcmV0dXJuIGluZm8udXJsOwogICAgfQogICAgY29uc3QgbWFwID0gbmV3IEFycmF5KDI1Nik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAyNTU7IGkrKykgewogICAgICBjb25zdCB4ID0gaSAvIDI1NTsKICAgICAgbWFwW2ldID0geCA8PSAwLjAzOTI4ID8geCAvIDEyLjkyIDogKCh4ICsgMC4wNTUpIC8gMS4wNTUpICoqIDIuNDsKICAgIH0KICAgIGNvbnN0IHRhYmxlID0gbWFwLmpvaW4oIiwiKTsKICAgIGNvbnN0IGlkID0gYGdfJHt0aGlzLiNkb2NJZH1faGNtX2ZpbHRlcmA7CiAgICBjb25zdCBmaWx0ZXIgPSBpbmZvLmZpbHRlciA9IHRoaXMuI2NyZWF0ZUZpbHRlcihpZCk7CiAgICB0aGlzLiNhZGRUcmFuc2Zlck1hcENvbnZlcnNpb24odGFibGUsIHRhYmxlLCB0YWJsZSwgZmlsdGVyKTsKICAgIHRoaXMuI2FkZEdyYXlDb252ZXJzaW9uKGZpbHRlcik7CiAgICBjb25zdCBnZXRTdGVwcyA9IChjLCBuKSA9PiB7CiAgICAgIGNvbnN0IHN0YXJ0ID0gZmdSR0JbY10gLyAyNTU7CiAgICAgIGNvbnN0IGVuZCA9IGJnUkdCW2NdIC8gMjU1OwogICAgICBjb25zdCBhcnIgPSBuZXcgQXJyYXkobiArIDEpOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHsKICAgICAgICBhcnJbaV0gPSBzdGFydCArIGkgLyBuICogKGVuZCAtIHN0YXJ0KTsKICAgICAgfQogICAgICByZXR1cm4gYXJyLmpvaW4oIiwiKTsKICAgIH07CiAgICB0aGlzLiNhZGRUcmFuc2Zlck1hcENvbnZlcnNpb24oZ2V0U3RlcHMoMCwgNSksIGdldFN0ZXBzKDEsIDUpLCBnZXRTdGVwcygyLCA1KSwgZmlsdGVyKTsKICAgIGluZm8udXJsID0gdGhpcy4jY3JlYXRlVXJsKGlkKTsKICAgIHJldHVybiBpbmZvLnVybDsKICB9CiAgYWRkQWxwaGFGaWx0ZXIobWFwKSB7CiAgICBsZXQgdmFsdWUgPSB0aGlzLiNjYWNoZS5nZXQobWFwKTsKICAgIGlmICh2YWx1ZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICBjb25zdCBbdGFibGVBXSA9IHRoaXMuI2NyZWF0ZVRhYmxlcyhbbWFwXSk7CiAgICBjb25zdCBrZXkgPSBgYWxwaGFfJHt0YWJsZUF9YDsKICAgIHZhbHVlID0gdGhpcy4jY2FjaGUuZ2V0KGtleSk7CiAgICBpZiAodmFsdWUpIHsKICAgICAgdGhpcy4jY2FjaGUuc2V0KG1hcCwgdmFsdWUpOwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICBjb25zdCBpZCA9IGBnXyR7dGhpcy4jZG9jSWR9X2FscGhhX21hcF8ke3RoaXMuI2lkKyt9YDsKICAgIGNvbnN0IHVybCA9IHRoaXMuI2NyZWF0ZVVybChpZCk7CiAgICB0aGlzLiNjYWNoZS5zZXQobWFwLCB1cmwpOwogICAgdGhpcy4jY2FjaGUuc2V0KGtleSwgdXJsKTsKICAgIGNvbnN0IGZpbHRlciA9IHRoaXMuI2NyZWF0ZUZpbHRlcihpZCk7CiAgICB0aGlzLiNhZGRUcmFuc2Zlck1hcEFscGhhQ29udmVyc2lvbih0YWJsZUEsIGZpbHRlcik7CiAgICByZXR1cm4gdXJsOwogIH0KICBhZGRMdW1pbm9zaXR5RmlsdGVyKG1hcCkgewogICAgbGV0IHZhbHVlID0gdGhpcy4jY2FjaGUuZ2V0KG1hcCB8fCAibHVtaW5vc2l0eSIpOwogICAgaWYgKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGxldCB0YWJsZUEsIGtleTsKICAgIGlmIChtYXApIHsKICAgICAgW3RhYmxlQV0gPSB0aGlzLiNjcmVhdGVUYWJsZXMoW21hcF0pOwogICAgICBrZXkgPSBgbHVtaW5vc2l0eV8ke3RhYmxlQX1gOwogICAgfSBlbHNlIHsKICAgICAga2V5ID0gImx1bWlub3NpdHkiOwogICAgfQogICAgdmFsdWUgPSB0aGlzLiNjYWNoZS5nZXQoa2V5KTsKICAgIGlmICh2YWx1ZSkgewogICAgICB0aGlzLiNjYWNoZS5zZXQobWFwLCB2YWx1ZSk7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGNvbnN0IGlkID0gYGdfJHt0aGlzLiNkb2NJZH1fbHVtaW5vc2l0eV9tYXBfJHt0aGlzLiNpZCsrfWA7CiAgICBjb25zdCB1cmwgPSB0aGlzLiNjcmVhdGVVcmwoaWQpOwogICAgdGhpcy4jY2FjaGUuc2V0KG1hcCwgdXJsKTsKICAgIHRoaXMuI2NhY2hlLnNldChrZXksIHVybCk7CiAgICBjb25zdCBmaWx0ZXIgPSB0aGlzLiNjcmVhdGVGaWx0ZXIoaWQpOwogICAgdGhpcy4jYWRkTHVtaW5vc2l0eUNvbnZlcnNpb24oZmlsdGVyKTsKICAgIGlmIChtYXApIHsKICAgICAgdGhpcy4jYWRkVHJhbnNmZXJNYXBBbHBoYUNvbnZlcnNpb24odGFibGVBLCBmaWx0ZXIpOwogICAgfQogICAgcmV0dXJuIHVybDsKICB9CiAgYWRkSGlnaGxpZ2h0SENNRmlsdGVyKGZpbHRlck5hbWUsIGZnQ29sb3IsIGJnQ29sb3IsIG5ld0ZnQ29sb3IsIG5ld0JnQ29sb3IpIHsKICAgIGNvbnN0IGtleSA9IGAke2ZnQ29sb3J9LSR7YmdDb2xvcn0tJHtuZXdGZ0NvbG9yfS0ke25ld0JnQ29sb3J9YDsKICAgIGxldCBpbmZvID0gdGhpcy4jaGNtQ2FjaGUuZ2V0KGZpbHRlck5hbWUpOwogICAgaWYgKGluZm8/LmtleSA9PT0ga2V5KSB7CiAgICAgIHJldHVybiBpbmZvLnVybDsKICAgIH0KICAgIGlmIChpbmZvKSB7CiAgICAgIGluZm8uZmlsdGVyPy5yZW1vdmUoKTsKICAgICAgaW5mby5rZXkgPSBrZXk7CiAgICAgIGluZm8udXJsID0gIm5vbmUiOwogICAgICBpbmZvLmZpbHRlciA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICBpbmZvID0gewogICAgICAgIGtleSwKICAgICAgICB1cmw6ICJub25lIiwKICAgICAgICBmaWx0ZXI6IG51bGwKICAgICAgfTsKICAgICAgdGhpcy4jaGNtQ2FjaGUuc2V0KGZpbHRlck5hbWUsIGluZm8pOwogICAgfQogICAgaWYgKCFmZ0NvbG9yIHx8ICFiZ0NvbG9yKSB7CiAgICAgIHJldHVybiBpbmZvLnVybDsKICAgIH0KICAgIGNvbnN0IFtmZ1JHQiwgYmdSR0JdID0gW2ZnQ29sb3IsIGJnQ29sb3JdLm1hcCh0aGlzLiNnZXRSR0IuYmluZCh0aGlzKSk7CiAgICBsZXQgZmdHcmF5ID0gTWF0aC5yb3VuZCgwLjIxMjYgKiBmZ1JHQlswXSArIDAuNzE1MiAqIGZnUkdCWzFdICsgMC4wNzIyICogZmdSR0JbMl0pOwogICAgbGV0IGJnR3JheSA9IE1hdGgucm91bmQoMC4yMTI2ICogYmdSR0JbMF0gKyAwLjcxNTIgKiBiZ1JHQlsxXSArIDAuMDcyMiAqIGJnUkdCWzJdKTsKICAgIGxldCBbbmV3RmdSR0IsIG5ld0JnUkdCXSA9IFtuZXdGZ0NvbG9yLCBuZXdCZ0NvbG9yXS5tYXAodGhpcy4jZ2V0UkdCLmJpbmQodGhpcykpOwogICAgaWYgKGJnR3JheSA8IGZnR3JheSkgewogICAgICBbZmdHcmF5LCBiZ0dyYXksIG5ld0ZnUkdCLCBuZXdCZ1JHQl0gPSBbYmdHcmF5LCBmZ0dyYXksIG5ld0JnUkdCLCBuZXdGZ1JHQl07CiAgICB9CiAgICB0aGlzLiNkZWZzLnN0eWxlLmNvbG9yID0gIiI7CiAgICBjb25zdCBnZXRTdGVwcyA9IChmZywgYmcsIG4pID0+IHsKICAgICAgY29uc3QgYXJyID0gbmV3IEFycmF5KDI1Nik7CiAgICAgIGNvbnN0IHN0ZXAgPSAoYmdHcmF5IC0gZmdHcmF5KSAvIG47CiAgICAgIGNvbnN0IG5ld1N0YXJ0ID0gZmcgLyAyNTU7CiAgICAgIGNvbnN0IG5ld1N0ZXAgPSAoYmcgLSBmZykgLyAoMjU1ICogbik7CiAgICAgIGxldCBwcmV2ID0gMDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbjsgaSsrKSB7CiAgICAgICAgY29uc3QgayA9IE1hdGgucm91bmQoZmdHcmF5ICsgaSAqIHN0ZXApOwogICAgICAgIGNvbnN0IHZhbHVlID0gbmV3U3RhcnQgKyBpICogbmV3U3RlcDsKICAgICAgICBmb3IgKGxldCBqID0gcHJldjsgaiA8PSBrOyBqKyspIHsKICAgICAgICAgIGFycltqXSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgICBwcmV2ID0gayArIDE7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IHByZXY7IGkgPCAyNTY7IGkrKykgewogICAgICAgIGFycltpXSA9IGFycltwcmV2IC0gMV07CiAgICAgIH0KICAgICAgcmV0dXJuIGFyci5qb2luKCIsIik7CiAgICB9OwogICAgY29uc3QgaWQgPSBgZ18ke3RoaXMuI2RvY0lkfV9oY21fJHtmaWx0ZXJOYW1lfV9maWx0ZXJgOwogICAgY29uc3QgZmlsdGVyID0gaW5mby5maWx0ZXIgPSB0aGlzLiNjcmVhdGVGaWx0ZXIoaWQpOwogICAgdGhpcy4jYWRkR3JheUNvbnZlcnNpb24oZmlsdGVyKTsKICAgIHRoaXMuI2FkZFRyYW5zZmVyTWFwQ29udmVyc2lvbihnZXRTdGVwcyhuZXdGZ1JHQlswXSwgbmV3QmdSR0JbMF0sIDUpLCBnZXRTdGVwcyhuZXdGZ1JHQlsxXSwgbmV3QmdSR0JbMV0sIDUpLCBnZXRTdGVwcyhuZXdGZ1JHQlsyXSwgbmV3QmdSR0JbMl0sIDUpLCBmaWx0ZXIpOwogICAgaW5mby51cmwgPSB0aGlzLiNjcmVhdGVVcmwoaWQpOwogICAgcmV0dXJuIGluZm8udXJsOwogIH0KICBkZXN0cm95KGtlZXBIQ00gPSBmYWxzZSkgewogICAgaWYgKGtlZXBIQ00gJiYgdGhpcy4jX2hjbUNhY2hlPy5zaXplKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI19kZWZzPy5wYXJlbnROb2RlLnBhcmVudE5vZGUucmVtb3ZlKCk7CiAgICB0aGlzLiNfZGVmcyA9IG51bGw7CiAgICB0aGlzLiNfY2FjaGU/LmNsZWFyKCk7CiAgICB0aGlzLiNfY2FjaGUgPSBudWxsOwogICAgdGhpcy4jX2hjbUNhY2hlPy5jbGVhcigpOwogICAgdGhpcy4jX2hjbUNhY2hlID0gbnVsbDsKICAgIHRoaXMuI2lkID0gMDsKICB9CiAgI2FkZEx1bWlub3NpdHlDb252ZXJzaW9uKGZpbHRlcikgewogICAgY29uc3QgZmVDb2xvck1hdHJpeCA9IHRoaXMuI2RvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhTVkdfTlMsICJmZUNvbG9yTWF0cml4Iik7CiAgICBmZUNvbG9yTWF0cml4LnNldEF0dHJpYnV0ZSgidHlwZSIsICJtYXRyaXgiKTsKICAgIGZlQ29sb3JNYXRyaXguc2V0QXR0cmlidXRlKCJ2YWx1ZXMiLCAiMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4zIDAuNTkgMC4xMSAwIDAiKTsKICAgIGZpbHRlci5hcHBlbmQoZmVDb2xvck1hdHJpeCk7CiAgfQogICNhZGRHcmF5Q29udmVyc2lvbihmaWx0ZXIpIHsKICAgIGNvbnN0IGZlQ29sb3JNYXRyaXggPSB0aGlzLiNkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoU1ZHX05TLCAiZmVDb2xvck1hdHJpeCIpOwogICAgZmVDb2xvck1hdHJpeC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAibWF0cml4Iik7CiAgICBmZUNvbG9yTWF0cml4LnNldEF0dHJpYnV0ZSgidmFsdWVzIiwgIjAuMjEyNiAwLjcxNTIgMC4wNzIyIDAgMCAwLjIxMjYgMC43MTUyIDAuMDcyMiAwIDAgMC4yMTI2IDAuNzE1MiAwLjA3MjIgMCAwIDAgMCAwIDEgMCIpOwogICAgZmlsdGVyLmFwcGVuZChmZUNvbG9yTWF0cml4KTsKICB9CiAgI2NyZWF0ZUZpbHRlcihpZCkgewogICAgY29uc3QgZmlsdGVyID0gdGhpcy4jZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFNWR19OUywgImZpbHRlciIpOwogICAgZmlsdGVyLnNldEF0dHJpYnV0ZSgiY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzIiwgInNSR0IiKTsKICAgIGZpbHRlci5zZXRBdHRyaWJ1dGUoImlkIiwgaWQpOwogICAgdGhpcy4jZGVmcy5hcHBlbmQoZmlsdGVyKTsKICAgIHJldHVybiBmaWx0ZXI7CiAgfQogICNhcHBlbmRGZUZ1bmMoZmVDb21wb25lbnRUcmFuc2ZlciwgZnVuYywgdGFibGUpIHsKICAgIGNvbnN0IGZlRnVuYyA9IHRoaXMuI2RvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhTVkdfTlMsIGZ1bmMpOwogICAgZmVGdW5jLnNldEF0dHJpYnV0ZSgidHlwZSIsICJkaXNjcmV0ZSIpOwogICAgZmVGdW5jLnNldEF0dHJpYnV0ZSgidGFibGVWYWx1ZXMiLCB0YWJsZSk7CiAgICBmZUNvbXBvbmVudFRyYW5zZmVyLmFwcGVuZChmZUZ1bmMpOwogIH0KICAjYWRkVHJhbnNmZXJNYXBDb252ZXJzaW9uKHJUYWJsZSwgZ1RhYmxlLCBiVGFibGUsIGZpbHRlcikgewogICAgY29uc3QgZmVDb21wb25lbnRUcmFuc2ZlciA9IHRoaXMuI2RvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhTVkdfTlMsICJmZUNvbXBvbmVudFRyYW5zZmVyIik7CiAgICBmaWx0ZXIuYXBwZW5kKGZlQ29tcG9uZW50VHJhbnNmZXIpOwogICAgdGhpcy4jYXBwZW5kRmVGdW5jKGZlQ29tcG9uZW50VHJhbnNmZXIsICJmZUZ1bmNSIiwgclRhYmxlKTsKICAgIHRoaXMuI2FwcGVuZEZlRnVuYyhmZUNvbXBvbmVudFRyYW5zZmVyLCAiZmVGdW5jRyIsIGdUYWJsZSk7CiAgICB0aGlzLiNhcHBlbmRGZUZ1bmMoZmVDb21wb25lbnRUcmFuc2ZlciwgImZlRnVuY0IiLCBiVGFibGUpOwogIH0KICAjYWRkVHJhbnNmZXJNYXBBbHBoYUNvbnZlcnNpb24oYVRhYmxlLCBmaWx0ZXIpIHsKICAgIGNvbnN0IGZlQ29tcG9uZW50VHJhbnNmZXIgPSB0aGlzLiNkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoU1ZHX05TLCAiZmVDb21wb25lbnRUcmFuc2ZlciIpOwogICAgZmlsdGVyLmFwcGVuZChmZUNvbXBvbmVudFRyYW5zZmVyKTsKICAgIHRoaXMuI2FwcGVuZEZlRnVuYyhmZUNvbXBvbmVudFRyYW5zZmVyLCAiZmVGdW5jQSIsIGFUYWJsZSk7CiAgfQogICNnZXRSR0IoY29sb3IpIHsKICAgIHRoaXMuI2RlZnMuc3R5bGUuY29sb3IgPSBjb2xvcjsKICAgIHJldHVybiBnZXRSR0IoZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLiNkZWZzKS5nZXRQcm9wZXJ0eVZhbHVlKCJjb2xvciIpKTsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L3N0YW5kYXJkX2ZvbnRkYXRhX2ZhY3RvcnkuanMKCgpjbGFzcyBCYXNlU3RhbmRhcmRGb250RGF0YUZhY3RvcnkgewogIGNvbnN0cnVjdG9yKHsKICAgIGJhc2VVcmwgPSBudWxsCiAgfSkgewogICAgdGhpcy5iYXNlVXJsID0gYmFzZVVybDsKICB9CiAgYXN5bmMgZmV0Y2goewogICAgZmlsZW5hbWUKICB9KSB7CiAgICBpZiAoIXRoaXMuYmFzZVVybCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkVuc3VyZSB0aGF0IHRoZSBgc3RhbmRhcmRGb250RGF0YVVybGAgQVBJIHBhcmFtZXRlciBpcyBwcm92aWRlZC4iKTsKICAgIH0KICAgIGlmICghZmlsZW5hbWUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJGb250IGZpbGVuYW1lIG11c3QgYmUgc3BlY2lmaWVkLiIpOwogICAgfQogICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfSR7ZmlsZW5hbWV9YDsKICAgIHJldHVybiB0aGlzLl9mZXRjaCh1cmwpLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIGxvYWQgZm9udCBkYXRhIGF0OiAke3VybH1gKTsKICAgIH0pOwogIH0KICBhc3luYyBfZmV0Y2godXJsKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBfZmV0Y2hgIGNhbGxlZC4iKTsKICB9Cn0KY2xhc3MgRE9NU3RhbmRhcmRGb250RGF0YUZhY3RvcnkgZXh0ZW5kcyBCYXNlU3RhbmRhcmRGb250RGF0YUZhY3RvcnkgewogIGFzeW5jIF9mZXRjaCh1cmwpIHsKICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBmZXRjaERhdGEodXJsLCAiYXJyYXlidWZmZXIiKTsKICAgIHJldHVybiBuZXcgVWludDhBcnJheShkYXRhKTsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L3dhc21fZmFjdG9yeS5qcwoKCmNsYXNzIEJhc2VXYXNtRmFjdG9yeSB7CiAgY29uc3RydWN0b3IoewogICAgYmFzZVVybCA9IG51bGwKICB9KSB7CiAgICB0aGlzLmJhc2VVcmwgPSBiYXNlVXJsOwogIH0KICBhc3luYyBmZXRjaCh7CiAgICBmaWxlbmFtZQogIH0pIHsKICAgIGlmICghdGhpcy5iYXNlVXJsKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiRW5zdXJlIHRoYXQgdGhlIGB3YXNtVXJsYCBBUEkgcGFyYW1ldGVyIGlzIHByb3ZpZGVkLiIpOwogICAgfQogICAgaWYgKCFmaWxlbmFtZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldhc20gZmlsZW5hbWUgbXVzdCBiZSBzcGVjaWZpZWQuIik7CiAgICB9CiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9JHtmaWxlbmFtZX1gOwogICAgcmV0dXJuIHRoaXMuX2ZldGNoKHVybCkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmFibGUgdG8gbG9hZCB3YXNtIGRhdGEgYXQ6ICR7dXJsfWApOwogICAgfSk7CiAgfQogIGFzeW5jIF9mZXRjaCh1cmwpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYF9mZXRjaGAgY2FsbGVkLiIpOwogIH0KfQpjbGFzcyBET01XYXNtRmFjdG9yeSBleHRlbmRzIEJhc2VXYXNtRmFjdG9yeSB7CiAgYXN5bmMgX2ZldGNoKHVybCkgewogICAgY29uc3QgZGF0YSA9IGF3YWl0IGZldGNoRGF0YSh1cmwsICJhcnJheWJ1ZmZlciIpOwogICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGRhdGEpOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvbm9kZV91dGlscy5qcwoKCgoKCgppZiAoaXNOb2RlSlMpIHsKICB3YXJuKCJQbGVhc2UgdXNlIHRoZSBgbGVnYWN5YCBidWlsZCBpbiBOb2RlLmpzIGVudmlyb25tZW50cy4iKTsKfQphc3luYyBmdW5jdGlvbiBub2RlX3V0aWxzX2ZldGNoRGF0YSh1cmwpIHsKICBjb25zdCBmcyA9IHByb2Nlc3MuZ2V0QnVpbHRpbk1vZHVsZSgiZnMiKTsKICBjb25zdCBkYXRhID0gYXdhaXQgZnMucHJvbWlzZXMucmVhZEZpbGUodXJsKTsKICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoZGF0YSk7Cn0KY2xhc3MgTm9kZUZpbHRlckZhY3RvcnkgZXh0ZW5kcyBCYXNlRmlsdGVyRmFjdG9yeSB7fQpjbGFzcyBOb2RlQ2FudmFzRmFjdG9yeSBleHRlbmRzIEJhc2VDYW52YXNGYWN0b3J5IHsKICBfY3JlYXRlQ2FudmFzKHdpZHRoLCBoZWlnaHQpIHsKICAgIGNvbnN0IHJlcXVpcmUgPSBwcm9jZXNzLmdldEJ1aWx0aW5Nb2R1bGUoIm1vZHVsZSIpLmNyZWF0ZVJlcXVpcmUoaW1wb3J0Lm1ldGEudXJsKTsKICAgIGNvbnN0IGNhbnZhcyA9IHJlcXVpcmUoIkBuYXBpLXJzL2NhbnZhcyIpOwogICAgcmV0dXJuIGNhbnZhcy5jcmVhdGVDYW52YXMod2lkdGgsIGhlaWdodCk7CiAgfQp9CmNsYXNzIE5vZGVDTWFwUmVhZGVyRmFjdG9yeSBleHRlbmRzIEJhc2VDTWFwUmVhZGVyRmFjdG9yeSB7CiAgYXN5bmMgX2ZldGNoKHVybCkgewogICAgcmV0dXJuIG5vZGVfdXRpbHNfZmV0Y2hEYXRhKHVybCk7CiAgfQp9CmNsYXNzIE5vZGVTdGFuZGFyZEZvbnREYXRhRmFjdG9yeSBleHRlbmRzIEJhc2VTdGFuZGFyZEZvbnREYXRhRmFjdG9yeSB7CiAgYXN5bmMgX2ZldGNoKHVybCkgewogICAgcmV0dXJuIG5vZGVfdXRpbHNfZmV0Y2hEYXRhKHVybCk7CiAgfQp9CmNsYXNzIE5vZGVXYXNtRmFjdG9yeSBleHRlbmRzIEJhc2VXYXNtRmFjdG9yeSB7CiAgYXN5bmMgX2ZldGNoKHVybCkgewogICAgcmV0dXJuIG5vZGVfdXRpbHNfZmV0Y2hEYXRhKHVybCk7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9wYXR0ZXJuX2hlbHBlci5qcwoKCmNvbnN0IFBhdGhUeXBlID0gewogIEZJTEw6ICJGaWxsIiwKICBTVFJPS0U6ICJTdHJva2UiLAogIFNIQURJTkc6ICJTaGFkaW5nIgp9OwpmdW5jdGlvbiBhcHBseUJvdW5kaW5nQm94KGN0eCwgYmJveCkgewogIGlmICghYmJveCkgewogICAgcmV0dXJuOwogIH0KICBjb25zdCB3aWR0aCA9IGJib3hbMl0gLSBiYm94WzBdOwogIGNvbnN0IGhlaWdodCA9IGJib3hbM10gLSBiYm94WzFdOwogIGNvbnN0IHJlZ2lvbiA9IG5ldyBQYXRoMkQoKTsKICByZWdpb24ucmVjdChiYm94WzBdLCBiYm94WzFdLCB3aWR0aCwgaGVpZ2h0KTsKICBjdHguY2xpcChyZWdpb24pOwp9CmNsYXNzIEJhc2VTaGFkaW5nUGF0dGVybiB7CiAgaXNNb2RpZnlpbmdDdXJyZW50VHJhbnNmb3JtKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBnZXRQYXR0ZXJuKCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgZ2V0UGF0dGVybmAgY2FsbGVkLiIpOwogIH0KfQpjbGFzcyBSYWRpYWxBeGlhbFNoYWRpbmdQYXR0ZXJuIGV4dGVuZHMgQmFzZVNoYWRpbmdQYXR0ZXJuIHsKICBjb25zdHJ1Y3RvcihJUikgewogICAgc3VwZXIoKTsKICAgIHRoaXMuX3R5cGUgPSBJUlsxXTsKICAgIHRoaXMuX2Jib3ggPSBJUlsyXTsKICAgIHRoaXMuX2NvbG9yU3RvcHMgPSBJUlszXTsKICAgIHRoaXMuX3AwID0gSVJbNF07CiAgICB0aGlzLl9wMSA9IElSWzVdOwogICAgdGhpcy5fcjAgPSBJUls2XTsKICAgIHRoaXMuX3IxID0gSVJbN107CiAgICB0aGlzLm1hdHJpeCA9IG51bGw7CiAgfQogIF9jcmVhdGVHcmFkaWVudChjdHgpIHsKICAgIGxldCBncmFkOwogICAgaWYgKHRoaXMuX3R5cGUgPT09ICJheGlhbCIpIHsKICAgICAgZ3JhZCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCh0aGlzLl9wMFswXSwgdGhpcy5fcDBbMV0sIHRoaXMuX3AxWzBdLCB0aGlzLl9wMVsxXSk7CiAgICB9IGVsc2UgaWYgKHRoaXMuX3R5cGUgPT09ICJyYWRpYWwiKSB7CiAgICAgIGdyYWQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQodGhpcy5fcDBbMF0sIHRoaXMuX3AwWzFdLCB0aGlzLl9yMCwgdGhpcy5fcDFbMF0sIHRoaXMuX3AxWzFdLCB0aGlzLl9yMSk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGNvbG9yU3RvcCBvZiB0aGlzLl9jb2xvclN0b3BzKSB7CiAgICAgIGdyYWQuYWRkQ29sb3JTdG9wKGNvbG9yU3RvcFswXSwgY29sb3JTdG9wWzFdKTsKICAgIH0KICAgIHJldHVybiBncmFkOwogIH0KICBnZXRQYXR0ZXJuKGN0eCwgb3duZXIsIGludmVyc2UsIHBhdGhUeXBlKSB7CiAgICBsZXQgcGF0dGVybjsKICAgIGlmIChwYXRoVHlwZSA9PT0gUGF0aFR5cGUuU1RST0tFIHx8IHBhdGhUeXBlID09PSBQYXRoVHlwZS5GSUxMKSB7CiAgICAgIGNvbnN0IG93bmVyQkJveCA9IG93bmVyLmN1cnJlbnQuZ2V0Q2xpcHBlZFBhdGhCb3VuZGluZ0JveChwYXRoVHlwZSwgZ2V0Q3VycmVudFRyYW5zZm9ybShjdHgpKSB8fCBbMCwgMCwgMCwgMF07CiAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5jZWlsKG93bmVyQkJveFsyXSAtIG93bmVyQkJveFswXSkgfHwgMTsKICAgICAgY29uc3QgaGVpZ2h0ID0gTWF0aC5jZWlsKG93bmVyQkJveFszXSAtIG93bmVyQkJveFsxXSkgfHwgMTsKICAgICAgY29uc3QgdG1wQ2FudmFzID0gb3duZXIuY2FjaGVkQ2FudmFzZXMuZ2V0Q2FudmFzKCJwYXR0ZXJuIiwgd2lkdGgsIGhlaWdodCk7CiAgICAgIGNvbnN0IHRtcEN0eCA9IHRtcENhbnZhcy5jb250ZXh0OwogICAgICB0bXBDdHguY2xlYXJSZWN0KDAsIDAsIHRtcEN0eC5jYW52YXMud2lkdGgsIHRtcEN0eC5jYW52YXMuaGVpZ2h0KTsKICAgICAgdG1wQ3R4LmJlZ2luUGF0aCgpOwogICAgICB0bXBDdHgucmVjdCgwLCAwLCB0bXBDdHguY2FudmFzLndpZHRoLCB0bXBDdHguY2FudmFzLmhlaWdodCk7CiAgICAgIHRtcEN0eC50cmFuc2xhdGUoLW93bmVyQkJveFswXSwgLW93bmVyQkJveFsxXSk7CiAgICAgIGludmVyc2UgPSBVdGlsLnRyYW5zZm9ybShpbnZlcnNlLCBbMSwgMCwgMCwgMSwgb3duZXJCQm94WzBdLCBvd25lckJCb3hbMV1dKTsKICAgICAgdG1wQ3R4LnRyYW5zZm9ybSguLi5vd25lci5iYXNlVHJhbnNmb3JtKTsKICAgICAgaWYgKHRoaXMubWF0cml4KSB7CiAgICAgICAgdG1wQ3R4LnRyYW5zZm9ybSguLi50aGlzLm1hdHJpeCk7CiAgICAgIH0KICAgICAgYXBwbHlCb3VuZGluZ0JveCh0bXBDdHgsIHRoaXMuX2Jib3gpOwogICAgICB0bXBDdHguZmlsbFN0eWxlID0gdGhpcy5fY3JlYXRlR3JhZGllbnQodG1wQ3R4KTsKICAgICAgdG1wQ3R4LmZpbGwoKTsKICAgICAgcGF0dGVybiA9IGN0eC5jcmVhdGVQYXR0ZXJuKHRtcENhbnZhcy5jYW52YXMsICJuby1yZXBlYXQiKTsKICAgICAgY29uc3QgZG9tTWF0cml4ID0gbmV3IERPTU1hdHJpeChpbnZlcnNlKTsKICAgICAgcGF0dGVybi5zZXRUcmFuc2Zvcm0oZG9tTWF0cml4KTsKICAgIH0gZWxzZSB7CiAgICAgIGFwcGx5Qm91bmRpbmdCb3goY3R4LCB0aGlzLl9iYm94KTsKICAgICAgcGF0dGVybiA9IHRoaXMuX2NyZWF0ZUdyYWRpZW50KGN0eCk7CiAgICB9CiAgICByZXR1cm4gcGF0dGVybjsKICB9Cn0KZnVuY3Rpb24gZHJhd1RyaWFuZ2xlKGRhdGEsIGNvbnRleHQsIHAxLCBwMiwgcDMsIGMxLCBjMiwgYzMpIHsKICBjb25zdCBjb29yZHMgPSBjb250ZXh0LmNvb3JkcywKICAgIGNvbG9ycyA9IGNvbnRleHQuY29sb3JzOwogIGNvbnN0IGJ5dGVzID0gZGF0YS5kYXRhLAogICAgcm93U2l6ZSA9IGRhdGEud2lkdGggKiA0OwogIGxldCB0bXA7CiAgaWYgKGNvb3Jkc1twMSArIDFdID4gY29vcmRzW3AyICsgMV0pIHsKICAgIHRtcCA9IHAxOwogICAgcDEgPSBwMjsKICAgIHAyID0gdG1wOwogICAgdG1wID0gYzE7CiAgICBjMSA9IGMyOwogICAgYzIgPSB0bXA7CiAgfQogIGlmIChjb29yZHNbcDIgKyAxXSA+IGNvb3Jkc1twMyArIDFdKSB7CiAgICB0bXAgPSBwMjsKICAgIHAyID0gcDM7CiAgICBwMyA9IHRtcDsKICAgIHRtcCA9IGMyOwogICAgYzIgPSBjMzsKICAgIGMzID0gdG1wOwogIH0KICBpZiAoY29vcmRzW3AxICsgMV0gPiBjb29yZHNbcDIgKyAxXSkgewogICAgdG1wID0gcDE7CiAgICBwMSA9IHAyOwogICAgcDIgPSB0bXA7CiAgICB0bXAgPSBjMTsKICAgIGMxID0gYzI7CiAgICBjMiA9IHRtcDsKICB9CiAgY29uc3QgeDEgPSAoY29vcmRzW3AxXSArIGNvbnRleHQub2Zmc2V0WCkgKiBjb250ZXh0LnNjYWxlWDsKICBjb25zdCB5MSA9IChjb29yZHNbcDEgKyAxXSArIGNvbnRleHQub2Zmc2V0WSkgKiBjb250ZXh0LnNjYWxlWTsKICBjb25zdCB4MiA9IChjb29yZHNbcDJdICsgY29udGV4dC5vZmZzZXRYKSAqIGNvbnRleHQuc2NhbGVYOwogIGNvbnN0IHkyID0gKGNvb3Jkc1twMiArIDFdICsgY29udGV4dC5vZmZzZXRZKSAqIGNvbnRleHQuc2NhbGVZOwogIGNvbnN0IHgzID0gKGNvb3Jkc1twM10gKyBjb250ZXh0Lm9mZnNldFgpICogY29udGV4dC5zY2FsZVg7CiAgY29uc3QgeTMgPSAoY29vcmRzW3AzICsgMV0gKyBjb250ZXh0Lm9mZnNldFkpICogY29udGV4dC5zY2FsZVk7CiAgaWYgKHkxID49IHkzKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IGMxciA9IGNvbG9yc1tjMV0sCiAgICBjMWcgPSBjb2xvcnNbYzEgKyAxXSwKICAgIGMxYiA9IGNvbG9yc1tjMSArIDJdOwogIGNvbnN0IGMyciA9IGNvbG9yc1tjMl0sCiAgICBjMmcgPSBjb2xvcnNbYzIgKyAxXSwKICAgIGMyYiA9IGNvbG9yc1tjMiArIDJdOwogIGNvbnN0IGMzciA9IGNvbG9yc1tjM10sCiAgICBjM2cgPSBjb2xvcnNbYzMgKyAxXSwKICAgIGMzYiA9IGNvbG9yc1tjMyArIDJdOwogIGNvbnN0IG1pblkgPSBNYXRoLnJvdW5kKHkxKSwKICAgIG1heFkgPSBNYXRoLnJvdW5kKHkzKTsKICBsZXQgeGEsIGNhciwgY2FnLCBjYWI7CiAgbGV0IHhiLCBjYnIsIGNiZywgY2JiOwogIGZvciAobGV0IHkgPSBtaW5ZOyB5IDw9IG1heFk7IHkrKykgewogICAgaWYgKHkgPCB5MikgewogICAgICBjb25zdCBrID0geSA8IHkxID8gMCA6ICh5MSAtIHkpIC8gKHkxIC0geTIpOwogICAgICB4YSA9IHgxIC0gKHgxIC0geDIpICogazsKICAgICAgY2FyID0gYzFyIC0gKGMxciAtIGMycikgKiBrOwogICAgICBjYWcgPSBjMWcgLSAoYzFnIC0gYzJnKSAqIGs7CiAgICAgIGNhYiA9IGMxYiAtIChjMWIgLSBjMmIpICogazsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBrOwogICAgICBpZiAoeSA+IHkzKSB7CiAgICAgICAgayA9IDE7CiAgICAgIH0gZWxzZSBpZiAoeTIgPT09IHkzKSB7CiAgICAgICAgayA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgayA9ICh5MiAtIHkpIC8gKHkyIC0geTMpOwogICAgICB9CiAgICAgIHhhID0geDIgLSAoeDIgLSB4MykgKiBrOwogICAgICBjYXIgPSBjMnIgLSAoYzJyIC0gYzNyKSAqIGs7CiAgICAgIGNhZyA9IGMyZyAtIChjMmcgLSBjM2cpICogazsKICAgICAgY2FiID0gYzJiIC0gKGMyYiAtIGMzYikgKiBrOwogICAgfQogICAgbGV0IGs7CiAgICBpZiAoeSA8IHkxKSB7CiAgICAgIGsgPSAwOwogICAgfSBlbHNlIGlmICh5ID4geTMpIHsKICAgICAgayA9IDE7CiAgICB9IGVsc2UgewogICAgICBrID0gKHkxIC0geSkgLyAoeTEgLSB5Myk7CiAgICB9CiAgICB4YiA9IHgxIC0gKHgxIC0geDMpICogazsKICAgIGNiciA9IGMxciAtIChjMXIgLSBjM3IpICogazsKICAgIGNiZyA9IGMxZyAtIChjMWcgLSBjM2cpICogazsKICAgIGNiYiA9IGMxYiAtIChjMWIgLSBjM2IpICogazsKICAgIGNvbnN0IHgxXyA9IE1hdGgucm91bmQoTWF0aC5taW4oeGEsIHhiKSk7CiAgICBjb25zdCB4Ml8gPSBNYXRoLnJvdW5kKE1hdGgubWF4KHhhLCB4YikpOwogICAgbGV0IGogPSByb3dTaXplICogeSArIHgxXyAqIDQ7CiAgICBmb3IgKGxldCB4ID0geDFfOyB4IDw9IHgyXzsgeCsrKSB7CiAgICAgIGsgPSAoeGEgLSB4KSAvICh4YSAtIHhiKTsKICAgICAgaWYgKGsgPCAwKSB7CiAgICAgICAgayA9IDA7CiAgICAgIH0gZWxzZSBpZiAoayA+IDEpIHsKICAgICAgICBrID0gMTsKICAgICAgfQogICAgICBieXRlc1tqKytdID0gY2FyIC0gKGNhciAtIGNicikgKiBrIHwgMDsKICAgICAgYnl0ZXNbaisrXSA9IGNhZyAtIChjYWcgLSBjYmcpICogayB8IDA7CiAgICAgIGJ5dGVzW2orK10gPSBjYWIgLSAoY2FiIC0gY2JiKSAqIGsgfCAwOwogICAgICBieXRlc1tqKytdID0gMjU1OwogICAgfQogIH0KfQpmdW5jdGlvbiBkcmF3RmlndXJlKGRhdGEsIGZpZ3VyZSwgY29udGV4dCkgewogIGNvbnN0IHBzID0gZmlndXJlLmNvb3JkczsKICBjb25zdCBjcyA9IGZpZ3VyZS5jb2xvcnM7CiAgbGV0IGksIGlpOwogIHN3aXRjaCAoZmlndXJlLnR5cGUpIHsKICAgIGNhc2UgImxhdHRpY2UiOgogICAgICBjb25zdCB2ZXJ0aWNlc1BlclJvdyA9IGZpZ3VyZS52ZXJ0aWNlc1BlclJvdzsKICAgICAgY29uc3Qgcm93cyA9IE1hdGguZmxvb3IocHMubGVuZ3RoIC8gdmVydGljZXNQZXJSb3cpIC0gMTsKICAgICAgY29uc3QgY29scyA9IHZlcnRpY2VzUGVyUm93IC0gMTsKICAgICAgZm9yIChpID0gMDsgaSA8IHJvd3M7IGkrKykgewogICAgICAgIGxldCBxID0gaSAqIHZlcnRpY2VzUGVyUm93OwogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29sczsgaisrLCBxKyspIHsKICAgICAgICAgIGRyYXdUcmlhbmdsZShkYXRhLCBjb250ZXh0LCBwc1txXSwgcHNbcSArIDFdLCBwc1txICsgdmVydGljZXNQZXJSb3ddLCBjc1txXSwgY3NbcSArIDFdLCBjc1txICsgdmVydGljZXNQZXJSb3ddKTsKICAgICAgICAgIGRyYXdUcmlhbmdsZShkYXRhLCBjb250ZXh0LCBwc1txICsgdmVydGljZXNQZXJSb3cgKyAxXSwgcHNbcSArIDFdLCBwc1txICsgdmVydGljZXNQZXJSb3ddLCBjc1txICsgdmVydGljZXNQZXJSb3cgKyAxXSwgY3NbcSArIDFdLCBjc1txICsgdmVydGljZXNQZXJSb3ddKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJ0cmlhbmdsZXMiOgogICAgICBmb3IgKGkgPSAwLCBpaSA9IHBzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDMpIHsKICAgICAgICBkcmF3VHJpYW5nbGUoZGF0YSwgY29udGV4dCwgcHNbaV0sIHBzW2kgKyAxXSwgcHNbaSArIDJdLCBjc1tpXSwgY3NbaSArIDFdLCBjc1tpICsgMl0pOwogICAgICB9CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGZpZ3VyZSIpOwogIH0KfQpjbGFzcyBNZXNoU2hhZGluZ1BhdHRlcm4gZXh0ZW5kcyBCYXNlU2hhZGluZ1BhdHRlcm4gewogIGNvbnN0cnVjdG9yKElSKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5fY29vcmRzID0gSVJbMl07CiAgICB0aGlzLl9jb2xvcnMgPSBJUlszXTsKICAgIHRoaXMuX2ZpZ3VyZXMgPSBJUls0XTsKICAgIHRoaXMuX2JvdW5kcyA9IElSWzVdOwogICAgdGhpcy5fYmJveCA9IElSWzZdOwogICAgdGhpcy5fYmFja2dyb3VuZCA9IElSWzddOwogICAgdGhpcy5tYXRyaXggPSBudWxsOwogIH0KICBfY3JlYXRlTWVzaENhbnZhcyhjb21iaW5lZFNjYWxlLCBiYWNrZ3JvdW5kQ29sb3IsIGNhY2hlZENhbnZhc2VzKSB7CiAgICBjb25zdCBFWFBFQ1RFRF9TQ0FMRSA9IDEuMTsKICAgIGNvbnN0IE1BWF9QQVRURVJOX1NJWkUgPSAzMDAwOwogICAgY29uc3QgQk9SREVSX1NJWkUgPSAyOwogICAgY29uc3Qgb2Zmc2V0WCA9IE1hdGguZmxvb3IodGhpcy5fYm91bmRzWzBdKTsKICAgIGNvbnN0IG9mZnNldFkgPSBNYXRoLmZsb29yKHRoaXMuX2JvdW5kc1sxXSk7CiAgICBjb25zdCBib3VuZHNXaWR0aCA9IE1hdGguY2VpbCh0aGlzLl9ib3VuZHNbMl0pIC0gb2Zmc2V0WDsKICAgIGNvbnN0IGJvdW5kc0hlaWdodCA9IE1hdGguY2VpbCh0aGlzLl9ib3VuZHNbM10pIC0gb2Zmc2V0WTsKICAgIGNvbnN0IHdpZHRoID0gTWF0aC5taW4oTWF0aC5jZWlsKE1hdGguYWJzKGJvdW5kc1dpZHRoICogY29tYmluZWRTY2FsZVswXSAqIEVYUEVDVEVEX1NDQUxFKSksIE1BWF9QQVRURVJOX1NJWkUpOwogICAgY29uc3QgaGVpZ2h0ID0gTWF0aC5taW4oTWF0aC5jZWlsKE1hdGguYWJzKGJvdW5kc0hlaWdodCAqIGNvbWJpbmVkU2NhbGVbMV0gKiBFWFBFQ1RFRF9TQ0FMRSkpLCBNQVhfUEFUVEVSTl9TSVpFKTsKICAgIGNvbnN0IHNjYWxlWCA9IGJvdW5kc1dpZHRoIC8gd2lkdGg7CiAgICBjb25zdCBzY2FsZVkgPSBib3VuZHNIZWlnaHQgLyBoZWlnaHQ7CiAgICBjb25zdCBjb250ZXh0ID0gewogICAgICBjb29yZHM6IHRoaXMuX2Nvb3JkcywKICAgICAgY29sb3JzOiB0aGlzLl9jb2xvcnMsCiAgICAgIG9mZnNldFg6IC1vZmZzZXRYLAogICAgICBvZmZzZXRZOiAtb2Zmc2V0WSwKICAgICAgc2NhbGVYOiAxIC8gc2NhbGVYLAogICAgICBzY2FsZVk6IDEgLyBzY2FsZVkKICAgIH07CiAgICBjb25zdCBwYWRkZWRXaWR0aCA9IHdpZHRoICsgQk9SREVSX1NJWkUgKiAyOwogICAgY29uc3QgcGFkZGVkSGVpZ2h0ID0gaGVpZ2h0ICsgQk9SREVSX1NJWkUgKiAyOwogICAgY29uc3QgdG1wQ2FudmFzID0gY2FjaGVkQ2FudmFzZXMuZ2V0Q2FudmFzKCJtZXNoIiwgcGFkZGVkV2lkdGgsIHBhZGRlZEhlaWdodCk7CiAgICBjb25zdCB0bXBDdHggPSB0bXBDYW52YXMuY29udGV4dDsKICAgIGNvbnN0IGRhdGEgPSB0bXBDdHguY3JlYXRlSW1hZ2VEYXRhKHdpZHRoLCBoZWlnaHQpOwogICAgaWYgKGJhY2tncm91bmRDb2xvcikgewogICAgICBjb25zdCBieXRlcyA9IGRhdGEuZGF0YTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gYnl0ZXMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gNCkgewogICAgICAgIGJ5dGVzW2ldID0gYmFja2dyb3VuZENvbG9yWzBdOwogICAgICAgIGJ5dGVzW2kgKyAxXSA9IGJhY2tncm91bmRDb2xvclsxXTsKICAgICAgICBieXRlc1tpICsgMl0gPSBiYWNrZ3JvdW5kQ29sb3JbMl07CiAgICAgICAgYnl0ZXNbaSArIDNdID0gMjU1OwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IGZpZ3VyZSBvZiB0aGlzLl9maWd1cmVzKSB7CiAgICAgIGRyYXdGaWd1cmUoZGF0YSwgZmlndXJlLCBjb250ZXh0KTsKICAgIH0KICAgIHRtcEN0eC5wdXRJbWFnZURhdGEoZGF0YSwgQk9SREVSX1NJWkUsIEJPUkRFUl9TSVpFKTsKICAgIGNvbnN0IGNhbnZhcyA9IHRtcENhbnZhcy5jYW52YXM7CiAgICByZXR1cm4gewogICAgICBjYW52YXMsCiAgICAgIG9mZnNldFg6IG9mZnNldFggLSBCT1JERVJfU0laRSAqIHNjYWxlWCwKICAgICAgb2Zmc2V0WTogb2Zmc2V0WSAtIEJPUkRFUl9TSVpFICogc2NhbGVZLAogICAgICBzY2FsZVgsCiAgICAgIHNjYWxlWQogICAgfTsKICB9CiAgaXNNb2RpZnlpbmdDdXJyZW50VHJhbnNmb3JtKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGdldFBhdHRlcm4oY3R4LCBvd25lciwgaW52ZXJzZSwgcGF0aFR5cGUpIHsKICAgIGFwcGx5Qm91bmRpbmdCb3goY3R4LCB0aGlzLl9iYm94KTsKICAgIGNvbnN0IHNjYWxlID0gbmV3IEZsb2F0MzJBcnJheSgyKTsKICAgIGlmIChwYXRoVHlwZSA9PT0gUGF0aFR5cGUuU0hBRElORykgewogICAgICBVdGlsLnNpbmd1bGFyVmFsdWVEZWNvbXBvc2UyZFNjYWxlKGdldEN1cnJlbnRUcmFuc2Zvcm0oY3R4KSwgc2NhbGUpOwogICAgfSBlbHNlIGlmICh0aGlzLm1hdHJpeCkgewogICAgICBVdGlsLnNpbmd1bGFyVmFsdWVEZWNvbXBvc2UyZFNjYWxlKHRoaXMubWF0cml4LCBzY2FsZSk7CiAgICAgIGNvbnN0IFttYXRyaXhTY2FsZVgsIG1hdHJpeFNjYWxlWV0gPSBzY2FsZTsKICAgICAgVXRpbC5zaW5ndWxhclZhbHVlRGVjb21wb3NlMmRTY2FsZShvd25lci5iYXNlVHJhbnNmb3JtLCBzY2FsZSk7CiAgICAgIHNjYWxlWzBdICo9IG1hdHJpeFNjYWxlWDsKICAgICAgc2NhbGVbMV0gKj0gbWF0cml4U2NhbGVZOwogICAgfSBlbHNlIHsKICAgICAgVXRpbC5zaW5ndWxhclZhbHVlRGVjb21wb3NlMmRTY2FsZShvd25lci5iYXNlVHJhbnNmb3JtLCBzY2FsZSk7CiAgICB9CiAgICBjb25zdCB0ZW1wb3JhcnlQYXR0ZXJuQ2FudmFzID0gdGhpcy5fY3JlYXRlTWVzaENhbnZhcyhzY2FsZSwgcGF0aFR5cGUgPT09IFBhdGhUeXBlLlNIQURJTkcgPyBudWxsIDogdGhpcy5fYmFja2dyb3VuZCwgb3duZXIuY2FjaGVkQ2FudmFzZXMpOwogICAgaWYgKHBhdGhUeXBlICE9PSBQYXRoVHlwZS5TSEFESU5HKSB7CiAgICAgIGN0eC5zZXRUcmFuc2Zvcm0oLi4ub3duZXIuYmFzZVRyYW5zZm9ybSk7CiAgICAgIGlmICh0aGlzLm1hdHJpeCkgewogICAgICAgIGN0eC50cmFuc2Zvcm0oLi4udGhpcy5tYXRyaXgpOwogICAgICB9CiAgICB9CiAgICBjdHgudHJhbnNsYXRlKHRlbXBvcmFyeVBhdHRlcm5DYW52YXMub2Zmc2V0WCwgdGVtcG9yYXJ5UGF0dGVybkNhbnZhcy5vZmZzZXRZKTsKICAgIGN0eC5zY2FsZSh0ZW1wb3JhcnlQYXR0ZXJuQ2FudmFzLnNjYWxlWCwgdGVtcG9yYXJ5UGF0dGVybkNhbnZhcy5zY2FsZVkpOwogICAgcmV0dXJuIGN0eC5jcmVhdGVQYXR0ZXJuKHRlbXBvcmFyeVBhdHRlcm5DYW52YXMuY2FudmFzLCAibm8tcmVwZWF0Iik7CiAgfQp9CmNsYXNzIER1bW15U2hhZGluZ1BhdHRlcm4gZXh0ZW5kcyBCYXNlU2hhZGluZ1BhdHRlcm4gewogIGdldFBhdHRlcm4oKSB7CiAgICByZXR1cm4gImhvdHBpbmsiOwogIH0KfQpmdW5jdGlvbiBnZXRTaGFkaW5nUGF0dGVybihJUikgewogIHN3aXRjaCAoSVJbMF0pIHsKICAgIGNhc2UgIlJhZGlhbEF4aWFsIjoKICAgICAgcmV0dXJuIG5ldyBSYWRpYWxBeGlhbFNoYWRpbmdQYXR0ZXJuKElSKTsKICAgIGNhc2UgIk1lc2giOgogICAgICByZXR1cm4gbmV3IE1lc2hTaGFkaW5nUGF0dGVybihJUik7CiAgICBjYXNlICJEdW1teSI6CiAgICAgIHJldHVybiBuZXcgRHVtbXlTaGFkaW5nUGF0dGVybigpOwogIH0KICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gSVIgdHlwZTogJHtJUlswXX1gKTsKfQpjb25zdCBQYWludFR5cGUgPSB7CiAgQ09MT1JFRDogMSwKICBVTkNPTE9SRUQ6IDIKfTsKY2xhc3MgVGlsaW5nUGF0dGVybiB7CiAgc3RhdGljIE1BWF9QQVRURVJOX1NJWkUgPSAzMDAwOwogIGNvbnN0cnVjdG9yKElSLCBjdHgsIGNhbnZhc0dyYXBoaWNzRmFjdG9yeSwgYmFzZVRyYW5zZm9ybSkgewogICAgdGhpcy5jb2xvciA9IElSWzFdOwogICAgdGhpcy5vcGVyYXRvckxpc3QgPSBJUlsyXTsKICAgIHRoaXMubWF0cml4ID0gSVJbM107CiAgICB0aGlzLmJib3ggPSBJUls0XTsKICAgIHRoaXMueHN0ZXAgPSBJUls1XTsKICAgIHRoaXMueXN0ZXAgPSBJUls2XTsKICAgIHRoaXMucGFpbnRUeXBlID0gSVJbN107CiAgICB0aGlzLnRpbGluZ1R5cGUgPSBJUls4XTsKICAgIHRoaXMuY3R4ID0gY3R4OwogICAgdGhpcy5jYW52YXNHcmFwaGljc0ZhY3RvcnkgPSBjYW52YXNHcmFwaGljc0ZhY3Rvcnk7CiAgICB0aGlzLmJhc2VUcmFuc2Zvcm0gPSBiYXNlVHJhbnNmb3JtOwogIH0KICBjcmVhdGVQYXR0ZXJuQ2FudmFzKG93bmVyKSB7CiAgICBjb25zdCB7CiAgICAgIGJib3gsCiAgICAgIG9wZXJhdG9yTGlzdCwKICAgICAgcGFpbnRUeXBlLAogICAgICB0aWxpbmdUeXBlLAogICAgICBjb2xvciwKICAgICAgY2FudmFzR3JhcGhpY3NGYWN0b3J5CiAgICB9ID0gdGhpczsKICAgIGxldCB7CiAgICAgIHhzdGVwLAogICAgICB5c3RlcAogICAgfSA9IHRoaXM7CiAgICB4c3RlcCA9IE1hdGguYWJzKHhzdGVwKTsKICAgIHlzdGVwID0gTWF0aC5hYnMoeXN0ZXApOwogICAgaW5mbygiVGlsaW5nVHlwZTogIiArIHRpbGluZ1R5cGUpOwogICAgY29uc3QgeDAgPSBiYm94WzBdLAogICAgICB5MCA9IGJib3hbMV0sCiAgICAgIHgxID0gYmJveFsyXSwKICAgICAgeTEgPSBiYm94WzNdOwogICAgY29uc3Qgd2lkdGggPSB4MSAtIHgwOwogICAgY29uc3QgaGVpZ2h0ID0geTEgLSB5MDsKICAgIGNvbnN0IHNjYWxlID0gbmV3IEZsb2F0MzJBcnJheSgyKTsKICAgIFV0aWwuc2luZ3VsYXJWYWx1ZURlY29tcG9zZTJkU2NhbGUodGhpcy5tYXRyaXgsIHNjYWxlKTsKICAgIGNvbnN0IFttYXRyaXhTY2FsZVgsIG1hdHJpeFNjYWxlWV0gPSBzY2FsZTsKICAgIFV0aWwuc2luZ3VsYXJWYWx1ZURlY29tcG9zZTJkU2NhbGUodGhpcy5iYXNlVHJhbnNmb3JtLCBzY2FsZSk7CiAgICBjb25zdCBjb21iaW5lZFNjYWxlWCA9IG1hdHJpeFNjYWxlWCAqIHNjYWxlWzBdOwogICAgY29uc3QgY29tYmluZWRTY2FsZVkgPSBtYXRyaXhTY2FsZVkgKiBzY2FsZVsxXTsKICAgIGxldCBjYW52YXNXaWR0aCA9IHdpZHRoLAogICAgICBjYW52YXNIZWlnaHQgPSBoZWlnaHQsCiAgICAgIHJlZHJhd0hvcml6b250YWxseSA9IGZhbHNlLAogICAgICByZWRyYXdWZXJ0aWNhbGx5ID0gZmFsc2U7CiAgICBjb25zdCB4U2NhbGVkU3RlcCA9IE1hdGguY2VpbCh4c3RlcCAqIGNvbWJpbmVkU2NhbGVYKTsKICAgIGNvbnN0IHlTY2FsZWRTdGVwID0gTWF0aC5jZWlsKHlzdGVwICogY29tYmluZWRTY2FsZVkpOwogICAgY29uc3QgeFNjYWxlZFdpZHRoID0gTWF0aC5jZWlsKHdpZHRoICogY29tYmluZWRTY2FsZVgpOwogICAgY29uc3QgeVNjYWxlZEhlaWdodCA9IE1hdGguY2VpbChoZWlnaHQgKiBjb21iaW5lZFNjYWxlWSk7CiAgICBpZiAoeFNjYWxlZFN0ZXAgPj0geFNjYWxlZFdpZHRoKSB7CiAgICAgIGNhbnZhc1dpZHRoID0geHN0ZXA7CiAgICB9IGVsc2UgewogICAgICByZWRyYXdIb3Jpem9udGFsbHkgPSB0cnVlOwogICAgfQogICAgaWYgKHlTY2FsZWRTdGVwID49IHlTY2FsZWRIZWlnaHQpIHsKICAgICAgY2FudmFzSGVpZ2h0ID0geXN0ZXA7CiAgICB9IGVsc2UgewogICAgICByZWRyYXdWZXJ0aWNhbGx5ID0gdHJ1ZTsKICAgIH0KICAgIGNvbnN0IGRpbXggPSB0aGlzLmdldFNpemVBbmRTY2FsZShjYW52YXNXaWR0aCwgdGhpcy5jdHguY2FudmFzLndpZHRoLCBjb21iaW5lZFNjYWxlWCk7CiAgICBjb25zdCBkaW15ID0gdGhpcy5nZXRTaXplQW5kU2NhbGUoY2FudmFzSGVpZ2h0LCB0aGlzLmN0eC5jYW52YXMuaGVpZ2h0LCBjb21iaW5lZFNjYWxlWSk7CiAgICBjb25zdCB0bXBDYW52YXMgPSBvd25lci5jYWNoZWRDYW52YXNlcy5nZXRDYW52YXMoInBhdHRlcm4iLCBkaW14LnNpemUsIGRpbXkuc2l6ZSk7CiAgICBjb25zdCB0bXBDdHggPSB0bXBDYW52YXMuY29udGV4dDsKICAgIGNvbnN0IGdyYXBoaWNzID0gY2FudmFzR3JhcGhpY3NGYWN0b3J5LmNyZWF0ZUNhbnZhc0dyYXBoaWNzKHRtcEN0eCk7CiAgICBncmFwaGljcy5ncm91cExldmVsID0gb3duZXIuZ3JvdXBMZXZlbDsKICAgIHRoaXMuc2V0RmlsbEFuZFN0cm9rZVN0eWxlVG9Db250ZXh0KGdyYXBoaWNzLCBwYWludFR5cGUsIGNvbG9yKTsKICAgIHRtcEN0eC50cmFuc2xhdGUoLWRpbXguc2NhbGUgKiB4MCwgLWRpbXkuc2NhbGUgKiB5MCk7CiAgICBncmFwaGljcy50cmFuc2Zvcm0oZGlteC5zY2FsZSwgMCwgMCwgZGlteS5zY2FsZSwgMCwgMCk7CiAgICB0bXBDdHguc2F2ZSgpOwogICAgdGhpcy5jbGlwQmJveChncmFwaGljcywgeDAsIHkwLCB4MSwgeTEpOwogICAgZ3JhcGhpY3MuYmFzZVRyYW5zZm9ybSA9IGdldEN1cnJlbnRUcmFuc2Zvcm0oZ3JhcGhpY3MuY3R4KTsKICAgIGdyYXBoaWNzLmV4ZWN1dGVPcGVyYXRvckxpc3Qob3BlcmF0b3JMaXN0KTsKICAgIGdyYXBoaWNzLmVuZERyYXdpbmcoKTsKICAgIHRtcEN0eC5yZXN0b3JlKCk7CiAgICBpZiAocmVkcmF3SG9yaXpvbnRhbGx5IHx8IHJlZHJhd1ZlcnRpY2FsbHkpIHsKICAgICAgY29uc3QgaW1hZ2UgPSB0bXBDYW52YXMuY2FudmFzOwogICAgICBpZiAocmVkcmF3SG9yaXpvbnRhbGx5KSB7CiAgICAgICAgY2FudmFzV2lkdGggPSB4c3RlcDsKICAgICAgfQogICAgICBpZiAocmVkcmF3VmVydGljYWxseSkgewogICAgICAgIGNhbnZhc0hlaWdodCA9IHlzdGVwOwogICAgICB9CiAgICAgIGNvbnN0IGRpbXgyID0gdGhpcy5nZXRTaXplQW5kU2NhbGUoY2FudmFzV2lkdGgsIHRoaXMuY3R4LmNhbnZhcy53aWR0aCwgY29tYmluZWRTY2FsZVgpOwogICAgICBjb25zdCBkaW15MiA9IHRoaXMuZ2V0U2l6ZUFuZFNjYWxlKGNhbnZhc0hlaWdodCwgdGhpcy5jdHguY2FudmFzLmhlaWdodCwgY29tYmluZWRTY2FsZVkpOwogICAgICBjb25zdCB4U2l6ZSA9IGRpbXgyLnNpemU7CiAgICAgIGNvbnN0IHlTaXplID0gZGlteTIuc2l6ZTsKICAgICAgY29uc3QgdG1wQ2FudmFzMiA9IG93bmVyLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcygicGF0dGVybi13b3JrYXJvdW5kIiwgeFNpemUsIHlTaXplKTsKICAgICAgY29uc3QgdG1wQ3R4MiA9IHRtcENhbnZhczIuY29udGV4dDsKICAgICAgY29uc3QgaWkgPSByZWRyYXdIb3Jpem9udGFsbHkgPyBNYXRoLmZsb29yKHdpZHRoIC8geHN0ZXApIDogMDsKICAgICAgY29uc3QgamogPSByZWRyYXdWZXJ0aWNhbGx5ID8gTWF0aC5mbG9vcihoZWlnaHQgLyB5c3RlcCkgOiAwOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBpaTsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gamo7IGorKykgewogICAgICAgICAgdG1wQ3R4Mi5kcmF3SW1hZ2UoaW1hZ2UsIHhTaXplICogaSwgeVNpemUgKiBqLCB4U2l6ZSwgeVNpemUsIDAsIDAsIHhTaXplLCB5U2l6ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgY2FudmFzOiB0bXBDYW52YXMyLmNhbnZhcywKICAgICAgICBzY2FsZVg6IGRpbXgyLnNjYWxlLAogICAgICAgIHNjYWxlWTogZGlteTIuc2NhbGUsCiAgICAgICAgb2Zmc2V0WDogeDAsCiAgICAgICAgb2Zmc2V0WTogeTAKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGNhbnZhczogdG1wQ2FudmFzLmNhbnZhcywKICAgICAgc2NhbGVYOiBkaW14LnNjYWxlLAogICAgICBzY2FsZVk6IGRpbXkuc2NhbGUsCiAgICAgIG9mZnNldFg6IHgwLAogICAgICBvZmZzZXRZOiB5MAogICAgfTsKICB9CiAgZ2V0U2l6ZUFuZFNjYWxlKHN0ZXAsIHJlYWxPdXRwdXRTaXplLCBzY2FsZSkgewogICAgY29uc3QgbWF4U2l6ZSA9IE1hdGgubWF4KFRpbGluZ1BhdHRlcm4uTUFYX1BBVFRFUk5fU0laRSwgcmVhbE91dHB1dFNpemUpOwogICAgbGV0IHNpemUgPSBNYXRoLmNlaWwoc3RlcCAqIHNjYWxlKTsKICAgIGlmIChzaXplID49IG1heFNpemUpIHsKICAgICAgc2l6ZSA9IG1heFNpemU7CiAgICB9IGVsc2UgewogICAgICBzY2FsZSA9IHNpemUgLyBzdGVwOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgc2NhbGUsCiAgICAgIHNpemUKICAgIH07CiAgfQogIGNsaXBCYm94KGdyYXBoaWNzLCB4MCwgeTAsIHgxLCB5MSkgewogICAgY29uc3QgYmJveFdpZHRoID0geDEgLSB4MDsKICAgIGNvbnN0IGJib3hIZWlnaHQgPSB5MSAtIHkwOwogICAgZ3JhcGhpY3MuY3R4LnJlY3QoeDAsIHkwLCBiYm94V2lkdGgsIGJib3hIZWlnaHQpOwogICAgVXRpbC5heGlhbEFsaWduZWRCb3VuZGluZ0JveChbeDAsIHkwLCB4MSwgeTFdLCBnZXRDdXJyZW50VHJhbnNmb3JtKGdyYXBoaWNzLmN0eCksIGdyYXBoaWNzLmN1cnJlbnQubWluTWF4KTsKICAgIGdyYXBoaWNzLmNsaXAoKTsKICAgIGdyYXBoaWNzLmVuZFBhdGgoKTsKICB9CiAgc2V0RmlsbEFuZFN0cm9rZVN0eWxlVG9Db250ZXh0KGdyYXBoaWNzLCBwYWludFR5cGUsIGNvbG9yKSB7CiAgICBjb25zdCBjb250ZXh0ID0gZ3JhcGhpY3MuY3R4LAogICAgICBjdXJyZW50ID0gZ3JhcGhpY3MuY3VycmVudDsKICAgIHN3aXRjaCAocGFpbnRUeXBlKSB7CiAgICAgIGNhc2UgUGFpbnRUeXBlLkNPTE9SRUQ6CiAgICAgICAgY29uc3QgewogICAgICAgICAgZmlsbFN0eWxlLAogICAgICAgICAgc3Ryb2tlU3R5bGUKICAgICAgICB9ID0gdGhpcy5jdHg7CiAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSBjdXJyZW50LmZpbGxDb2xvciA9IGZpbGxTdHlsZTsKICAgICAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gY3VycmVudC5zdHJva2VDb2xvciA9IHN0cm9rZVN0eWxlOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFBhaW50VHlwZS5VTkNPTE9SRUQ6CiAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSBjb250ZXh0LnN0cm9rZVN0eWxlID0gY29sb3I7CiAgICAgICAgY3VycmVudC5maWxsQ29sb3IgPSBjdXJyZW50LnN0cm9rZUNvbG9yID0gY29sb3I7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbnN1cHBvcnRlZCBwYWludCB0eXBlOiAke3BhaW50VHlwZX1gKTsKICAgIH0KICB9CiAgaXNNb2RpZnlpbmdDdXJyZW50VHJhbnNmb3JtKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBnZXRQYXR0ZXJuKGN0eCwgb3duZXIsIGludmVyc2UsIHBhdGhUeXBlKSB7CiAgICBsZXQgbWF0cml4ID0gaW52ZXJzZTsKICAgIGlmIChwYXRoVHlwZSAhPT0gUGF0aFR5cGUuU0hBRElORykgewogICAgICBtYXRyaXggPSBVdGlsLnRyYW5zZm9ybShtYXRyaXgsIG93bmVyLmJhc2VUcmFuc2Zvcm0pOwogICAgICBpZiAodGhpcy5tYXRyaXgpIHsKICAgICAgICBtYXRyaXggPSBVdGlsLnRyYW5zZm9ybShtYXRyaXgsIHRoaXMubWF0cml4KTsKICAgICAgfQogICAgfQogICAgY29uc3QgdGVtcG9yYXJ5UGF0dGVybkNhbnZhcyA9IHRoaXMuY3JlYXRlUGF0dGVybkNhbnZhcyhvd25lcik7CiAgICBsZXQgZG9tTWF0cml4ID0gbmV3IERPTU1hdHJpeChtYXRyaXgpOwogICAgZG9tTWF0cml4ID0gZG9tTWF0cml4LnRyYW5zbGF0ZSh0ZW1wb3JhcnlQYXR0ZXJuQ2FudmFzLm9mZnNldFgsIHRlbXBvcmFyeVBhdHRlcm5DYW52YXMub2Zmc2V0WSk7CiAgICBkb21NYXRyaXggPSBkb21NYXRyaXguc2NhbGUoMSAvIHRlbXBvcmFyeVBhdHRlcm5DYW52YXMuc2NhbGVYLCAxIC8gdGVtcG9yYXJ5UGF0dGVybkNhbnZhcy5zY2FsZVkpOwogICAgY29uc3QgcGF0dGVybiA9IGN0eC5jcmVhdGVQYXR0ZXJuKHRlbXBvcmFyeVBhdHRlcm5DYW52YXMuY2FudmFzLCAicmVwZWF0Iik7CiAgICBwYXR0ZXJuLnNldFRyYW5zZm9ybShkb21NYXRyaXgpOwogICAgcmV0dXJuIHBhdHRlcm47CiAgfQp9Cgo7Ly8gLi9zcmMvc2hhcmVkL2ltYWdlX3V0aWxzLmpzCgpmdW5jdGlvbiBjb252ZXJ0VG9SR0JBKHBhcmFtcykgewogIHN3aXRjaCAocGFyYW1zLmtpbmQpIHsKICAgIGNhc2UgSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQOgogICAgICByZXR1cm4gY29udmVydEJsYWNrQW5kV2hpdGVUb1JHQkEocGFyYW1zKTsKICAgIGNhc2UgSW1hZ2VLaW5kLlJHQl8yNEJQUDoKICAgICAgcmV0dXJuIGNvbnZlcnRSR0JUb1JHQkEocGFyYW1zKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gY29udmVydEJsYWNrQW5kV2hpdGVUb1JHQkEoewogIHNyYywKICBzcmNQb3MgPSAwLAogIGRlc3QsCiAgd2lkdGgsCiAgaGVpZ2h0LAogIG5vbkJsYWNrQ29sb3IgPSAweGZmZmZmZmZmLAogIGludmVyc2VEZWNvZGUgPSBmYWxzZQp9KSB7CiAgY29uc3QgYmxhY2sgPSB1dGlsX0ZlYXR1cmVUZXN0LmlzTGl0dGxlRW5kaWFuID8gMHhmZjAwMDAwMCA6IDB4MDAwMDAwZmY7CiAgY29uc3QgW3plcm9NYXBwaW5nLCBvbmVNYXBwaW5nXSA9IGludmVyc2VEZWNvZGUgPyBbbm9uQmxhY2tDb2xvciwgYmxhY2tdIDogW2JsYWNrLCBub25CbGFja0NvbG9yXTsKICBjb25zdCB3aWR0aEluU291cmNlID0gd2lkdGggPj4gMzsKICBjb25zdCB3aWR0aFJlbWFpbmRlciA9IHdpZHRoICYgNzsKICBjb25zdCBzcmNMZW5ndGggPSBzcmMubGVuZ3RoOwogIGRlc3QgPSBuZXcgVWludDMyQXJyYXkoZGVzdC5idWZmZXIpOwogIGxldCBkZXN0UG9zID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICBmb3IgKGNvbnN0IG1heCA9IHNyY1BvcyArIHdpZHRoSW5Tb3VyY2U7IHNyY1BvcyA8IG1heDsgc3JjUG9zKyspIHsKICAgICAgY29uc3QgZWxlbSA9IHNyY1BvcyA8IHNyY0xlbmd0aCA/IHNyY1tzcmNQb3NdIDogMjU1OwogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBlbGVtICYgMGIxMDAwMDAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMDAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMDAwID8gb25lTWFwcGluZyA6IHplcm9NYXBwaW5nOwogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBlbGVtICYgMGIxMDAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwID8gb25lTWFwcGluZyA6IHplcm9NYXBwaW5nOwogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBlbGVtICYgMGIxMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMSA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgIH0KICAgIGlmICh3aWR0aFJlbWFpbmRlciA9PT0gMCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IGVsZW0gPSBzcmNQb3MgPCBzcmNMZW5ndGggPyBzcmNbc3JjUG9zKytdIDogMjU1OwogICAgZm9yIChsZXQgaiA9IDA7IGogPCB3aWR0aFJlbWFpbmRlcjsgaisrKSB7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAxIDw8IDcgLSBqID8gb25lTWFwcGluZyA6IHplcm9NYXBwaW5nOwogICAgfQogIH0KICByZXR1cm4gewogICAgc3JjUG9zLAogICAgZGVzdFBvcwogIH07Cn0KZnVuY3Rpb24gY29udmVydFJHQlRvUkdCQSh7CiAgc3JjLAogIHNyY1BvcyA9IDAsCiAgZGVzdCwKICBkZXN0UG9zID0gMCwKICB3aWR0aCwKICBoZWlnaHQKfSkgewogIGxldCBpID0gMDsKICBjb25zdCBsZW4gPSB3aWR0aCAqIGhlaWdodCAqIDM7CiAgY29uc3QgbGVuMzIgPSBsZW4gPj4gMjsKICBjb25zdCBzcmMzMiA9IG5ldyBVaW50MzJBcnJheShzcmMuYnVmZmVyLCBzcmNQb3MsIGxlbjMyKTsKICBpZiAoRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4pIHsKICAgIGZvciAoOyBpIDwgbGVuMzIgLSAyOyBpICs9IDMsIGRlc3RQb3MgKz0gNCkgewogICAgICBjb25zdCBzMSA9IHNyYzMyW2ldOwogICAgICBjb25zdCBzMiA9IHNyYzMyW2kgKyAxXTsKICAgICAgY29uc3QgczMgPSBzcmMzMltpICsgMl07CiAgICAgIGRlc3RbZGVzdFBvc10gPSBzMSB8IDB4ZmYwMDAwMDA7CiAgICAgIGRlc3RbZGVzdFBvcyArIDFdID0gczEgPj4+IDI0IHwgczIgPDwgOCB8IDB4ZmYwMDAwMDA7CiAgICAgIGRlc3RbZGVzdFBvcyArIDJdID0gczIgPj4+IDE2IHwgczMgPDwgMTYgfCAweGZmMDAwMDAwOwogICAgICBkZXN0W2Rlc3RQb3MgKyAzXSA9IHMzID4+PiA4IHwgMHhmZjAwMDAwMDsKICAgIH0KICAgIGZvciAobGV0IGogPSBpICogNCwgamogPSBzcmNQb3MgKyBsZW47IGogPCBqajsgaiArPSAzKSB7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tqXSB8IHNyY1tqICsgMV0gPDwgOCB8IHNyY1tqICsgMl0gPDwgMTYgfCAweGZmMDAwMDAwOwogICAgfQogIH0gZWxzZSB7CiAgICBmb3IgKDsgaSA8IGxlbjMyIC0gMjsgaSArPSAzLCBkZXN0UG9zICs9IDQpIHsKICAgICAgY29uc3QgczEgPSBzcmMzMltpXTsKICAgICAgY29uc3QgczIgPSBzcmMzMltpICsgMV07CiAgICAgIGNvbnN0IHMzID0gc3JjMzJbaSArIDJdOwogICAgICBkZXN0W2Rlc3RQb3NdID0gczEgfCAweGZmOwogICAgICBkZXN0W2Rlc3RQb3MgKyAxXSA9IHMxIDw8IDI0IHwgczIgPj4+IDggfCAweGZmOwogICAgICBkZXN0W2Rlc3RQb3MgKyAyXSA9IHMyIDw8IDE2IHwgczMgPj4+IDE2IHwgMHhmZjsKICAgICAgZGVzdFtkZXN0UG9zICsgM10gPSBzMyA8PCA4IHwgMHhmZjsKICAgIH0KICAgIGZvciAobGV0IGogPSBpICogNCwgamogPSBzcmNQb3MgKyBsZW47IGogPCBqajsgaiArPSAzKSB7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tqXSA8PCAyNCB8IHNyY1tqICsgMV0gPDwgMTYgfCBzcmNbaiArIDJdIDw8IDggfCAweGZmOwogICAgfQogIH0KICByZXR1cm4gewogICAgc3JjUG9zOiBzcmNQb3MgKyBsZW4sCiAgICBkZXN0UG9zCiAgfTsKfQpmdW5jdGlvbiBncmF5VG9SR0JBKHNyYywgZGVzdCkgewogIGlmIChGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbikgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3JjLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgZGVzdFtpXSA9IHNyY1tpXSAqIDB4MTAxMDEgfCAweGZmMDAwMDAwOwogICAgfQogIH0gZWxzZSB7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzcmMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBkZXN0W2ldID0gc3JjW2ldICogMHgxMDEwMTAwIHwgMHgwMDAwMDBmZjsKICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L2NhbnZhcy5qcwoKCgoKY29uc3QgTUlOX0ZPTlRfU0laRSA9IDE2Owpjb25zdCBNQVhfRk9OVF9TSVpFID0gMTAwOwpjb25zdCBFWEVDVVRJT05fVElNRSA9IDE1Owpjb25zdCBFWEVDVVRJT05fU1RFUFMgPSAxMDsKY29uc3QgRlVMTF9DSFVOS19IRUlHSFQgPSAxNjsKY29uc3QgU0NBTEVfTUFUUklYID0gbmV3IERPTU1hdHJpeCgpOwpjb25zdCBYWSA9IG5ldyBGbG9hdDMyQXJyYXkoMik7CmNvbnN0IE1JTl9NQVhfSU5JVCA9IG5ldyBGbG9hdDMyQXJyYXkoW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldKTsKZnVuY3Rpb24gbWlycm9yQ29udGV4dE9wZXJhdGlvbnMoY3R4LCBkZXN0Q3R4KSB7CiAgaWYgKGN0eC5fcmVtb3ZlTWlycm9yaW5nKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkNvbnRleHQgaXMgYWxyZWFkeSBmb3J3YXJkaW5nIG9wZXJhdGlvbnMuIik7CiAgfQogIGN0eC5fX29yaWdpbmFsU2F2ZSA9IGN0eC5zYXZlOwogIGN0eC5fX29yaWdpbmFsUmVzdG9yZSA9IGN0eC5yZXN0b3JlOwogIGN0eC5fX29yaWdpbmFsUm90YXRlID0gY3R4LnJvdGF0ZTsKICBjdHguX19vcmlnaW5hbFNjYWxlID0gY3R4LnNjYWxlOwogIGN0eC5fX29yaWdpbmFsVHJhbnNsYXRlID0gY3R4LnRyYW5zbGF0ZTsKICBjdHguX19vcmlnaW5hbFRyYW5zZm9ybSA9IGN0eC50cmFuc2Zvcm07CiAgY3R4Ll9fb3JpZ2luYWxTZXRUcmFuc2Zvcm0gPSBjdHguc2V0VHJhbnNmb3JtOwogIGN0eC5fX29yaWdpbmFsUmVzZXRUcmFuc2Zvcm0gPSBjdHgucmVzZXRUcmFuc2Zvcm07CiAgY3R4Ll9fb3JpZ2luYWxDbGlwID0gY3R4LmNsaXA7CiAgY3R4Ll9fb3JpZ2luYWxNb3ZlVG8gPSBjdHgubW92ZVRvOwogIGN0eC5fX29yaWdpbmFsTGluZVRvID0gY3R4LmxpbmVUbzsKICBjdHguX19vcmlnaW5hbEJlemllckN1cnZlVG8gPSBjdHguYmV6aWVyQ3VydmVUbzsKICBjdHguX19vcmlnaW5hbFJlY3QgPSBjdHgucmVjdDsKICBjdHguX19vcmlnaW5hbENsb3NlUGF0aCA9IGN0eC5jbG9zZVBhdGg7CiAgY3R4Ll9fb3JpZ2luYWxCZWdpblBhdGggPSBjdHguYmVnaW5QYXRoOwogIGN0eC5fcmVtb3ZlTWlycm9yaW5nID0gKCkgPT4gewogICAgY3R4LnNhdmUgPSBjdHguX19vcmlnaW5hbFNhdmU7CiAgICBjdHgucmVzdG9yZSA9IGN0eC5fX29yaWdpbmFsUmVzdG9yZTsKICAgIGN0eC5yb3RhdGUgPSBjdHguX19vcmlnaW5hbFJvdGF0ZTsKICAgIGN0eC5zY2FsZSA9IGN0eC5fX29yaWdpbmFsU2NhbGU7CiAgICBjdHgudHJhbnNsYXRlID0gY3R4Ll9fb3JpZ2luYWxUcmFuc2xhdGU7CiAgICBjdHgudHJhbnNmb3JtID0gY3R4Ll9fb3JpZ2luYWxUcmFuc2Zvcm07CiAgICBjdHguc2V0VHJhbnNmb3JtID0gY3R4Ll9fb3JpZ2luYWxTZXRUcmFuc2Zvcm07CiAgICBjdHgucmVzZXRUcmFuc2Zvcm0gPSBjdHguX19vcmlnaW5hbFJlc2V0VHJhbnNmb3JtOwogICAgY3R4LmNsaXAgPSBjdHguX19vcmlnaW5hbENsaXA7CiAgICBjdHgubW92ZVRvID0gY3R4Ll9fb3JpZ2luYWxNb3ZlVG87CiAgICBjdHgubGluZVRvID0gY3R4Ll9fb3JpZ2luYWxMaW5lVG87CiAgICBjdHguYmV6aWVyQ3VydmVUbyA9IGN0eC5fX29yaWdpbmFsQmV6aWVyQ3VydmVUbzsKICAgIGN0eC5yZWN0ID0gY3R4Ll9fb3JpZ2luYWxSZWN0OwogICAgY3R4LmNsb3NlUGF0aCA9IGN0eC5fX29yaWdpbmFsQ2xvc2VQYXRoOwogICAgY3R4LmJlZ2luUGF0aCA9IGN0eC5fX29yaWdpbmFsQmVnaW5QYXRoOwogICAgZGVsZXRlIGN0eC5fcmVtb3ZlTWlycm9yaW5nOwogIH07CiAgY3R4LnNhdmUgPSBmdW5jdGlvbiAoKSB7CiAgICBkZXN0Q3R4LnNhdmUoKTsKICAgIHRoaXMuX19vcmlnaW5hbFNhdmUoKTsKICB9OwogIGN0eC5yZXN0b3JlID0gZnVuY3Rpb24gKCkgewogICAgZGVzdEN0eC5yZXN0b3JlKCk7CiAgICB0aGlzLl9fb3JpZ2luYWxSZXN0b3JlKCk7CiAgfTsKICBjdHgudHJhbnNsYXRlID0gZnVuY3Rpb24gKHgsIHkpIHsKICAgIGRlc3RDdHgudHJhbnNsYXRlKHgsIHkpOwogICAgdGhpcy5fX29yaWdpbmFsVHJhbnNsYXRlKHgsIHkpOwogIH07CiAgY3R4LnNjYWxlID0gZnVuY3Rpb24gKHgsIHkpIHsKICAgIGRlc3RDdHguc2NhbGUoeCwgeSk7CiAgICB0aGlzLl9fb3JpZ2luYWxTY2FsZSh4LCB5KTsKICB9OwogIGN0eC50cmFuc2Zvcm0gPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSwgZikgewogICAgZGVzdEN0eC50cmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZik7CiAgICB0aGlzLl9fb3JpZ2luYWxUcmFuc2Zvcm0oYSwgYiwgYywgZCwgZSwgZik7CiAgfTsKICBjdHguc2V0VHJhbnNmb3JtID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgIGRlc3RDdHguc2V0VHJhbnNmb3JtKGEsIGIsIGMsIGQsIGUsIGYpOwogICAgdGhpcy5fX29yaWdpbmFsU2V0VHJhbnNmb3JtKGEsIGIsIGMsIGQsIGUsIGYpOwogIH07CiAgY3R4LnJlc2V0VHJhbnNmb3JtID0gZnVuY3Rpb24gKCkgewogICAgZGVzdEN0eC5yZXNldFRyYW5zZm9ybSgpOwogICAgdGhpcy5fX29yaWdpbmFsUmVzZXRUcmFuc2Zvcm0oKTsKICB9OwogIGN0eC5yb3RhdGUgPSBmdW5jdGlvbiAoYW5nbGUpIHsKICAgIGRlc3RDdHgucm90YXRlKGFuZ2xlKTsKICAgIHRoaXMuX19vcmlnaW5hbFJvdGF0ZShhbmdsZSk7CiAgfTsKICBjdHguY2xpcCA9IGZ1bmN0aW9uIChydWxlKSB7CiAgICBkZXN0Q3R4LmNsaXAocnVsZSk7CiAgICB0aGlzLl9fb3JpZ2luYWxDbGlwKHJ1bGUpOwogIH07CiAgY3R4Lm1vdmVUbyA9IGZ1bmN0aW9uICh4LCB5KSB7CiAgICBkZXN0Q3R4Lm1vdmVUbyh4LCB5KTsKICAgIHRoaXMuX19vcmlnaW5hbE1vdmVUbyh4LCB5KTsKICB9OwogIGN0eC5saW5lVG8gPSBmdW5jdGlvbiAoeCwgeSkgewogICAgZGVzdEN0eC5saW5lVG8oeCwgeSk7CiAgICB0aGlzLl9fb3JpZ2luYWxMaW5lVG8oeCwgeSk7CiAgfTsKICBjdHguYmV6aWVyQ3VydmVUbyA9IGZ1bmN0aW9uIChjcDF4LCBjcDF5LCBjcDJ4LCBjcDJ5LCB4LCB5KSB7CiAgICBkZXN0Q3R4LmJlemllckN1cnZlVG8oY3AxeCwgY3AxeSwgY3AyeCwgY3AyeSwgeCwgeSk7CiAgICB0aGlzLl9fb3JpZ2luYWxCZXppZXJDdXJ2ZVRvKGNwMXgsIGNwMXksIGNwMngsIGNwMnksIHgsIHkpOwogIH07CiAgY3R4LnJlY3QgPSBmdW5jdGlvbiAoeCwgeSwgd2lkdGgsIGhlaWdodCkgewogICAgZGVzdEN0eC5yZWN0KHgsIHksIHdpZHRoLCBoZWlnaHQpOwogICAgdGhpcy5fX29yaWdpbmFsUmVjdCh4LCB5LCB3aWR0aCwgaGVpZ2h0KTsKICB9OwogIGN0eC5jbG9zZVBhdGggPSBmdW5jdGlvbiAoKSB7CiAgICBkZXN0Q3R4LmNsb3NlUGF0aCgpOwogICAgdGhpcy5fX29yaWdpbmFsQ2xvc2VQYXRoKCk7CiAgfTsKICBjdHguYmVnaW5QYXRoID0gZnVuY3Rpb24gKCkgewogICAgZGVzdEN0eC5iZWdpblBhdGgoKTsKICAgIHRoaXMuX19vcmlnaW5hbEJlZ2luUGF0aCgpOwogIH07Cn0KY2xhc3MgQ2FjaGVkQ2FudmFzZXMgewogIGNvbnN0cnVjdG9yKGNhbnZhc0ZhY3RvcnkpIHsKICAgIHRoaXMuY2FudmFzRmFjdG9yeSA9IGNhbnZhc0ZhY3Rvcnk7CiAgICB0aGlzLmNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB9CiAgZ2V0Q2FudmFzKGlkLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICBsZXQgY2FudmFzRW50cnk7CiAgICBpZiAodGhpcy5jYWNoZVtpZF0gIT09IHVuZGVmaW5lZCkgewogICAgICBjYW52YXNFbnRyeSA9IHRoaXMuY2FjaGVbaWRdOwogICAgICB0aGlzLmNhbnZhc0ZhY3RvcnkucmVzZXQoY2FudmFzRW50cnksIHdpZHRoLCBoZWlnaHQpOwogICAgfSBlbHNlIHsKICAgICAgY2FudmFzRW50cnkgPSB0aGlzLmNhbnZhc0ZhY3RvcnkuY3JlYXRlKHdpZHRoLCBoZWlnaHQpOwogICAgICB0aGlzLmNhY2hlW2lkXSA9IGNhbnZhc0VudHJ5OwogICAgfQogICAgcmV0dXJuIGNhbnZhc0VudHJ5OwogIH0KICBkZWxldGUoaWQpIHsKICAgIGRlbGV0ZSB0aGlzLmNhY2hlW2lkXTsKICB9CiAgY2xlYXIoKSB7CiAgICBmb3IgKGNvbnN0IGlkIGluIHRoaXMuY2FjaGUpIHsKICAgICAgY29uc3QgY2FudmFzRW50cnkgPSB0aGlzLmNhY2hlW2lkXTsKICAgICAgdGhpcy5jYW52YXNGYWN0b3J5LmRlc3Ryb3koY2FudmFzRW50cnkpOwogICAgICBkZWxldGUgdGhpcy5jYWNoZVtpZF07CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGRyYXdJbWFnZUF0SW50ZWdlckNvb3JkcyhjdHgsIHNyY0ltZywgc3JjWCwgc3JjWSwgc3JjVywgc3JjSCwgZGVzdFgsIGRlc3RZLCBkZXN0VywgZGVzdEgpIHsKICBjb25zdCBbYSwgYiwgYywgZCwgdHgsIHR5XSA9IGdldEN1cnJlbnRUcmFuc2Zvcm0oY3R4KTsKICBpZiAoYiA9PT0gMCAmJiBjID09PSAwKSB7CiAgICBjb25zdCB0bFggPSBkZXN0WCAqIGEgKyB0eDsKICAgIGNvbnN0IHJUbFggPSBNYXRoLnJvdW5kKHRsWCk7CiAgICBjb25zdCB0bFkgPSBkZXN0WSAqIGQgKyB0eTsKICAgIGNvbnN0IHJUbFkgPSBNYXRoLnJvdW5kKHRsWSk7CiAgICBjb25zdCBiclggPSAoZGVzdFggKyBkZXN0VykgKiBhICsgdHg7CiAgICBjb25zdCByV2lkdGggPSBNYXRoLmFicyhNYXRoLnJvdW5kKGJyWCkgLSByVGxYKSB8fCAxOwogICAgY29uc3QgYnJZID0gKGRlc3RZICsgZGVzdEgpICogZCArIHR5OwogICAgY29uc3QgckhlaWdodCA9IE1hdGguYWJzKE1hdGgucm91bmQoYnJZKSAtIHJUbFkpIHx8IDE7CiAgICBjdHguc2V0VHJhbnNmb3JtKE1hdGguc2lnbihhKSwgMCwgMCwgTWF0aC5zaWduKGQpLCByVGxYLCByVGxZKTsKICAgIGN0eC5kcmF3SW1hZ2Uoc3JjSW1nLCBzcmNYLCBzcmNZLCBzcmNXLCBzcmNILCAwLCAwLCByV2lkdGgsIHJIZWlnaHQpOwogICAgY3R4LnNldFRyYW5zZm9ybShhLCBiLCBjLCBkLCB0eCwgdHkpOwogICAgcmV0dXJuIFtyV2lkdGgsIHJIZWlnaHRdOwogIH0KICBpZiAoYSA9PT0gMCAmJiBkID09PSAwKSB7CiAgICBjb25zdCB0bFggPSBkZXN0WSAqIGMgKyB0eDsKICAgIGNvbnN0IHJUbFggPSBNYXRoLnJvdW5kKHRsWCk7CiAgICBjb25zdCB0bFkgPSBkZXN0WCAqIGIgKyB0eTsKICAgIGNvbnN0IHJUbFkgPSBNYXRoLnJvdW5kKHRsWSk7CiAgICBjb25zdCBiclggPSAoZGVzdFkgKyBkZXN0SCkgKiBjICsgdHg7CiAgICBjb25zdCByV2lkdGggPSBNYXRoLmFicyhNYXRoLnJvdW5kKGJyWCkgLSByVGxYKSB8fCAxOwogICAgY29uc3QgYnJZID0gKGRlc3RYICsgZGVzdFcpICogYiArIHR5OwogICAgY29uc3QgckhlaWdodCA9IE1hdGguYWJzKE1hdGgucm91bmQoYnJZKSAtIHJUbFkpIHx8IDE7CiAgICBjdHguc2V0VHJhbnNmb3JtKDAsIE1hdGguc2lnbihiKSwgTWF0aC5zaWduKGMpLCAwLCByVGxYLCByVGxZKTsKICAgIGN0eC5kcmF3SW1hZ2Uoc3JjSW1nLCBzcmNYLCBzcmNZLCBzcmNXLCBzcmNILCAwLCAwLCBySGVpZ2h0LCByV2lkdGgpOwogICAgY3R4LnNldFRyYW5zZm9ybShhLCBiLCBjLCBkLCB0eCwgdHkpOwogICAgcmV0dXJuIFtySGVpZ2h0LCByV2lkdGhdOwogIH0KICBjdHguZHJhd0ltYWdlKHNyY0ltZywgc3JjWCwgc3JjWSwgc3JjVywgc3JjSCwgZGVzdFgsIGRlc3RZLCBkZXN0VywgZGVzdEgpOwogIGNvbnN0IHNjYWxlWCA9IE1hdGguaHlwb3QoYSwgYik7CiAgY29uc3Qgc2NhbGVZID0gTWF0aC5oeXBvdChjLCBkKTsKICByZXR1cm4gW3NjYWxlWCAqIGRlc3RXLCBzY2FsZVkgKiBkZXN0SF07Cn0KY2xhc3MgQ2FudmFzRXh0cmFTdGF0ZSB7CiAgYWxwaGFJc1NoYXBlID0gZmFsc2U7CiAgZm9udFNpemUgPSAwOwogIGZvbnRTaXplU2NhbGUgPSAxOwogIHRleHRNYXRyaXggPSBudWxsOwogIHRleHRNYXRyaXhTY2FsZSA9IDE7CiAgZm9udE1hdHJpeCA9IEZPTlRfSURFTlRJVFlfTUFUUklYOwogIGxlYWRpbmcgPSAwOwogIHggPSAwOwogIHkgPSAwOwogIGxpbmVYID0gMDsKICBsaW5lWSA9IDA7CiAgY2hhclNwYWNpbmcgPSAwOwogIHdvcmRTcGFjaW5nID0gMDsKICB0ZXh0SFNjYWxlID0gMTsKICB0ZXh0UmVuZGVyaW5nTW9kZSA9IFRleHRSZW5kZXJpbmdNb2RlLkZJTEw7CiAgdGV4dFJpc2UgPSAwOwogIGZpbGxDb2xvciA9ICIjMDAwMDAwIjsKICBzdHJva2VDb2xvciA9ICIjMDAwMDAwIjsKICBwYXR0ZXJuRmlsbCA9IGZhbHNlOwogIHBhdHRlcm5TdHJva2UgPSBmYWxzZTsKICBmaWxsQWxwaGEgPSAxOwogIHN0cm9rZUFscGhhID0gMTsKICBsaW5lV2lkdGggPSAxOwogIGFjdGl2ZVNNYXNrID0gbnVsbDsKICB0cmFuc2Zlck1hcHMgPSAibm9uZSI7CiAgY29uc3RydWN0b3Iod2lkdGgsIGhlaWdodCkgewogICAgdGhpcy5jbGlwQm94ID0gbmV3IEZsb2F0MzJBcnJheShbMCwgMCwgd2lkdGgsIGhlaWdodF0pOwogICAgdGhpcy5taW5NYXggPSBNSU5fTUFYX0lOSVQuc2xpY2UoKTsKICB9CiAgY2xvbmUoKSB7CiAgICBjb25zdCBjbG9uZSA9IE9iamVjdC5jcmVhdGUodGhpcyk7CiAgICBjbG9uZS5jbGlwQm94ID0gdGhpcy5jbGlwQm94LnNsaWNlKCk7CiAgICBjbG9uZS5taW5NYXggPSB0aGlzLm1pbk1heC5zbGljZSgpOwogICAgcmV0dXJuIGNsb25lOwogIH0KICBnZXRQYXRoQm91bmRpbmdCb3gocGF0aFR5cGUgPSBQYXRoVHlwZS5GSUxMLCB0cmFuc2Zvcm0gPSBudWxsKSB7CiAgICBjb25zdCBib3ggPSB0aGlzLm1pbk1heC5zbGljZSgpOwogICAgaWYgKHBhdGhUeXBlID09PSBQYXRoVHlwZS5TVFJPS0UpIHsKICAgICAgaWYgKCF0cmFuc2Zvcm0pIHsKICAgICAgICB1bnJlYWNoYWJsZSgiU3Ryb2tlIGJvdW5kaW5nIGJveCBtdXN0IGluY2x1ZGUgdHJhbnNmb3JtLiIpOwogICAgICB9CiAgICAgIFV0aWwuc2luZ3VsYXJWYWx1ZURlY29tcG9zZTJkU2NhbGUodHJhbnNmb3JtLCBYWSk7CiAgICAgIGNvbnN0IHhTdHJva2VQYWQgPSBYWVswXSAqIHRoaXMubGluZVdpZHRoIC8gMjsKICAgICAgY29uc3QgeVN0cm9rZVBhZCA9IFhZWzFdICogdGhpcy5saW5lV2lkdGggLyAyOwogICAgICBib3hbMF0gLT0geFN0cm9rZVBhZDsKICAgICAgYm94WzFdIC09IHlTdHJva2VQYWQ7CiAgICAgIGJveFsyXSArPSB4U3Ryb2tlUGFkOwogICAgICBib3hbM10gKz0geVN0cm9rZVBhZDsKICAgIH0KICAgIHJldHVybiBib3g7CiAgfQogIHVwZGF0ZUNsaXBGcm9tUGF0aCgpIHsKICAgIGNvbnN0IGludGVyc2VjdCA9IFV0aWwuaW50ZXJzZWN0KHRoaXMuY2xpcEJveCwgdGhpcy5nZXRQYXRoQm91bmRpbmdCb3goKSk7CiAgICB0aGlzLnN0YXJ0TmV3UGF0aEFuZENsaXBCb3goaW50ZXJzZWN0IHx8IFswLCAwLCAwLCAwXSk7CiAgfQogIGlzRW1wdHlDbGlwKCkgewogICAgcmV0dXJuIHRoaXMubWluTWF4WzBdID09PSBJbmZpbml0eTsKICB9CiAgc3RhcnROZXdQYXRoQW5kQ2xpcEJveChib3gpIHsKICAgIHRoaXMuY2xpcEJveC5zZXQoYm94LCAwKTsKICAgIHRoaXMubWluTWF4LnNldChNSU5fTUFYX0lOSVQsIDApOwogIH0KICBnZXRDbGlwcGVkUGF0aEJvdW5kaW5nQm94KHBhdGhUeXBlID0gUGF0aFR5cGUuRklMTCwgdHJhbnNmb3JtID0gbnVsbCkgewogICAgcmV0dXJuIFV0aWwuaW50ZXJzZWN0KHRoaXMuY2xpcEJveCwgdGhpcy5nZXRQYXRoQm91bmRpbmdCb3gocGF0aFR5cGUsIHRyYW5zZm9ybSkpOwogIH0KfQpmdW5jdGlvbiBwdXRCaW5hcnlJbWFnZURhdGEoY3R4LCBpbWdEYXRhKSB7CiAgaWYgKGltZ0RhdGEgaW5zdGFuY2VvZiBJbWFnZURhdGEpIHsKICAgIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgMCwgMCk7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IGhlaWdodCA9IGltZ0RhdGEuaGVpZ2h0LAogICAgd2lkdGggPSBpbWdEYXRhLndpZHRoOwogIGNvbnN0IHBhcnRpYWxDaHVua0hlaWdodCA9IGhlaWdodCAlIEZVTExfQ0hVTktfSEVJR0hUOwogIGNvbnN0IGZ1bGxDaHVua3MgPSAoaGVpZ2h0IC0gcGFydGlhbENodW5rSGVpZ2h0KSAvIEZVTExfQ0hVTktfSEVJR0hUOwogIGNvbnN0IHRvdGFsQ2h1bmtzID0gcGFydGlhbENodW5rSGVpZ2h0ID09PSAwID8gZnVsbENodW5rcyA6IGZ1bGxDaHVua3MgKyAxOwogIGNvbnN0IGNodW5rSW1nRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEod2lkdGgsIEZVTExfQ0hVTktfSEVJR0hUKTsKICBsZXQgc3JjUG9zID0gMCwKICAgIGRlc3RQb3M7CiAgY29uc3Qgc3JjID0gaW1nRGF0YS5kYXRhOwogIGNvbnN0IGRlc3QgPSBjaHVua0ltZ0RhdGEuZGF0YTsKICBsZXQgaSwgaiwgdGhpc0NodW5rSGVpZ2h0LCBlbGVtc0luVGhpc0NodW5rOwogIGlmIChpbWdEYXRhLmtpbmQgPT09IHV0aWxfSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQKSB7CiAgICBjb25zdCBzcmNMZW5ndGggPSBzcmMuYnl0ZUxlbmd0aDsKICAgIGNvbnN0IGRlc3QzMiA9IG5ldyBVaW50MzJBcnJheShkZXN0LmJ1ZmZlciwgMCwgZGVzdC5ieXRlTGVuZ3RoID4+IDIpOwogICAgY29uc3QgZGVzdDMyRGF0YUxlbmd0aCA9IGRlc3QzMi5sZW5ndGg7CiAgICBjb25zdCBmdWxsU3JjRGlmZiA9IHdpZHRoICsgNyA+PiAzOwogICAgY29uc3Qgd2hpdGUgPSAweGZmZmZmZmZmOwogICAgY29uc3QgYmxhY2sgPSB1dGlsX0ZlYXR1cmVUZXN0LmlzTGl0dGxlRW5kaWFuID8gMHhmZjAwMDAwMCA6IDB4MDAwMDAwZmY7CiAgICBmb3IgKGkgPSAwOyBpIDwgdG90YWxDaHVua3M7IGkrKykgewogICAgICB0aGlzQ2h1bmtIZWlnaHQgPSBpIDwgZnVsbENodW5rcyA/IEZVTExfQ0hVTktfSEVJR0hUIDogcGFydGlhbENodW5rSGVpZ2h0OwogICAgICBkZXN0UG9zID0gMDsKICAgICAgZm9yIChqID0gMDsgaiA8IHRoaXNDaHVua0hlaWdodDsgaisrKSB7CiAgICAgICAgY29uc3Qgc3JjRGlmZiA9IHNyY0xlbmd0aCAtIHNyY1BvczsKICAgICAgICBsZXQgayA9IDA7CiAgICAgICAgY29uc3Qga0VuZCA9IHNyY0RpZmYgPiBmdWxsU3JjRGlmZiA/IHdpZHRoIDogc3JjRGlmZiAqIDggLSA3OwogICAgICAgIGNvbnN0IGtFbmRVbnJvbGxlZCA9IGtFbmQgJiB+NzsKICAgICAgICBsZXQgbWFzayA9IDA7CiAgICAgICAgbGV0IHNyY0J5dGUgPSAwOwogICAgICAgIGZvciAoOyBrIDwga0VuZFVucm9sbGVkOyBrICs9IDgpIHsKICAgICAgICAgIHNyY0J5dGUgPSBzcmNbc3JjUG9zKytdOwogICAgICAgICAgZGVzdDMyW2Rlc3RQb3MrK10gPSBzcmNCeXRlICYgMTI4ID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIDY0ID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIDMyID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIDE2ID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIDggPyB3aGl0ZSA6IGJsYWNrOwogICAgICAgICAgZGVzdDMyW2Rlc3RQb3MrK10gPSBzcmNCeXRlICYgNCA/IHdoaXRlIDogYmxhY2s7CiAgICAgICAgICBkZXN0MzJbZGVzdFBvcysrXSA9IHNyY0J5dGUgJiAyID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gc3JjQnl0ZSAmIDEgPyB3aGl0ZSA6IGJsYWNrOwogICAgICAgIH0KICAgICAgICBmb3IgKDsgayA8IGtFbmQ7IGsrKykgewogICAgICAgICAgaWYgKG1hc2sgPT09IDApIHsKICAgICAgICAgICAgc3JjQnl0ZSA9IHNyY1tzcmNQb3MrK107CiAgICAgICAgICAgIG1hc2sgPSAxMjg7CiAgICAgICAgICB9CiAgICAgICAgICBkZXN0MzJbZGVzdFBvcysrXSA9IHNyY0J5dGUgJiBtYXNrID8gd2hpdGUgOiBibGFjazsKICAgICAgICAgIG1hc2sgPj49IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIHdoaWxlIChkZXN0UG9zIDwgZGVzdDMyRGF0YUxlbmd0aCkgewogICAgICAgIGRlc3QzMltkZXN0UG9zKytdID0gMDsKICAgICAgfQogICAgICBjdHgucHV0SW1hZ2VEYXRhKGNodW5rSW1nRGF0YSwgMCwgaSAqIEZVTExfQ0hVTktfSEVJR0hUKTsKICAgIH0KICB9IGVsc2UgaWYgKGltZ0RhdGEua2luZCA9PT0gdXRpbF9JbWFnZUtpbmQuUkdCQV8zMkJQUCkgewogICAgaiA9IDA7CiAgICBlbGVtc0luVGhpc0NodW5rID0gd2lkdGggKiBGVUxMX0NIVU5LX0hFSUdIVCAqIDQ7CiAgICBmb3IgKGkgPSAwOyBpIDwgZnVsbENodW5rczsgaSsrKSB7CiAgICAgIGRlc3Quc2V0KHNyYy5zdWJhcnJheShzcmNQb3MsIHNyY1BvcyArIGVsZW1zSW5UaGlzQ2h1bmspKTsKICAgICAgc3JjUG9zICs9IGVsZW1zSW5UaGlzQ2h1bms7CiAgICAgIGN0eC5wdXRJbWFnZURhdGEoY2h1bmtJbWdEYXRhLCAwLCBqKTsKICAgICAgaiArPSBGVUxMX0NIVU5LX0hFSUdIVDsKICAgIH0KICAgIGlmIChpIDwgdG90YWxDaHVua3MpIHsKICAgICAgZWxlbXNJblRoaXNDaHVuayA9IHdpZHRoICogcGFydGlhbENodW5rSGVpZ2h0ICogNDsKICAgICAgZGVzdC5zZXQoc3JjLnN1YmFycmF5KHNyY1Bvcywgc3JjUG9zICsgZWxlbXNJblRoaXNDaHVuaykpOwogICAgICBjdHgucHV0SW1hZ2VEYXRhKGNodW5rSW1nRGF0YSwgMCwgaik7CiAgICB9CiAgfSBlbHNlIGlmIChpbWdEYXRhLmtpbmQgPT09IHV0aWxfSW1hZ2VLaW5kLlJHQl8yNEJQUCkgewogICAgdGhpc0NodW5rSGVpZ2h0ID0gRlVMTF9DSFVOS19IRUlHSFQ7CiAgICBlbGVtc0luVGhpc0NodW5rID0gd2lkdGggKiB0aGlzQ2h1bmtIZWlnaHQ7CiAgICBmb3IgKGkgPSAwOyBpIDwgdG90YWxDaHVua3M7IGkrKykgewogICAgICBpZiAoaSA+PSBmdWxsQ2h1bmtzKSB7CiAgICAgICAgdGhpc0NodW5rSGVpZ2h0ID0gcGFydGlhbENodW5rSGVpZ2h0OwogICAgICAgIGVsZW1zSW5UaGlzQ2h1bmsgPSB3aWR0aCAqIHRoaXNDaHVua0hlaWdodDsKICAgICAgfQogICAgICBkZXN0UG9zID0gMDsKICAgICAgZm9yIChqID0gZWxlbXNJblRoaXNDaHVuazsgai0tOykgewogICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CiAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gc3JjW3NyY1BvcysrXTsKICAgICAgICBkZXN0W2Rlc3RQb3MrK10gPSBzcmNbc3JjUG9zKytdOwogICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IDI1NTsKICAgICAgfQogICAgICBjdHgucHV0SW1hZ2VEYXRhKGNodW5rSW1nRGF0YSwgMCwgaSAqIEZVTExfQ0hVTktfSEVJR0hUKTsKICAgIH0KICB9IGVsc2UgewogICAgdGhyb3cgbmV3IEVycm9yKGBiYWQgaW1hZ2Uga2luZDogJHtpbWdEYXRhLmtpbmR9YCk7CiAgfQp9CmZ1bmN0aW9uIHB1dEJpbmFyeUltYWdlTWFzayhjdHgsIGltZ0RhdGEpIHsKICBpZiAoaW1nRGF0YS5iaXRtYXApIHsKICAgIGN0eC5kcmF3SW1hZ2UoaW1nRGF0YS5iaXRtYXAsIDAsIDApOwogICAgcmV0dXJuOwogIH0KICBjb25zdCBoZWlnaHQgPSBpbWdEYXRhLmhlaWdodCwKICAgIHdpZHRoID0gaW1nRGF0YS53aWR0aDsKICBjb25zdCBwYXJ0aWFsQ2h1bmtIZWlnaHQgPSBoZWlnaHQgJSBGVUxMX0NIVU5LX0hFSUdIVDsKICBjb25zdCBmdWxsQ2h1bmtzID0gKGhlaWdodCAtIHBhcnRpYWxDaHVua0hlaWdodCkgLyBGVUxMX0NIVU5LX0hFSUdIVDsKICBjb25zdCB0b3RhbENodW5rcyA9IHBhcnRpYWxDaHVua0hlaWdodCA9PT0gMCA/IGZ1bGxDaHVua3MgOiBmdWxsQ2h1bmtzICsgMTsKICBjb25zdCBjaHVua0ltZ0RhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKHdpZHRoLCBGVUxMX0NIVU5LX0hFSUdIVCk7CiAgbGV0IHNyY1BvcyA9IDA7CiAgY29uc3Qgc3JjID0gaW1nRGF0YS5kYXRhOwogIGNvbnN0IGRlc3QgPSBjaHVua0ltZ0RhdGEuZGF0YTsKICBmb3IgKGxldCBpID0gMDsgaSA8IHRvdGFsQ2h1bmtzOyBpKyspIHsKICAgIGNvbnN0IHRoaXNDaHVua0hlaWdodCA9IGkgPCBmdWxsQ2h1bmtzID8gRlVMTF9DSFVOS19IRUlHSFQgOiBwYXJ0aWFsQ2h1bmtIZWlnaHQ7CiAgICAoewogICAgICBzcmNQb3MKICAgIH0gPSBjb252ZXJ0QmxhY2tBbmRXaGl0ZVRvUkdCQSh7CiAgICAgIHNyYywKICAgICAgc3JjUG9zLAogICAgICBkZXN0LAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0OiB0aGlzQ2h1bmtIZWlnaHQsCiAgICAgIG5vbkJsYWNrQ29sb3I6IDAKICAgIH0pKTsKICAgIGN0eC5wdXRJbWFnZURhdGEoY2h1bmtJbWdEYXRhLCAwLCBpICogRlVMTF9DSFVOS19IRUlHSFQpOwogIH0KfQpmdW5jdGlvbiBjb3B5Q3R4U3RhdGUoc291cmNlQ3R4LCBkZXN0Q3R4KSB7CiAgY29uc3QgcHJvcGVydGllcyA9IFsic3Ryb2tlU3R5bGUiLCAiZmlsbFN0eWxlIiwgImZpbGxSdWxlIiwgImdsb2JhbEFscGhhIiwgImxpbmVXaWR0aCIsICJsaW5lQ2FwIiwgImxpbmVKb2luIiwgIm1pdGVyTGltaXQiLCAiZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uIiwgImZvbnQiLCAiZmlsdGVyIl07CiAgZm9yIChjb25zdCBwcm9wZXJ0eSBvZiBwcm9wZXJ0aWVzKSB7CiAgICBpZiAoc291cmNlQ3R4W3Byb3BlcnR5XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGRlc3RDdHhbcHJvcGVydHldID0gc291cmNlQ3R4W3Byb3BlcnR5XTsKICAgIH0KICB9CiAgaWYgKHNvdXJjZUN0eC5zZXRMaW5lRGFzaCAhPT0gdW5kZWZpbmVkKSB7CiAgICBkZXN0Q3R4LnNldExpbmVEYXNoKHNvdXJjZUN0eC5nZXRMaW5lRGFzaCgpKTsKICAgIGRlc3RDdHgubGluZURhc2hPZmZzZXQgPSBzb3VyY2VDdHgubGluZURhc2hPZmZzZXQ7CiAgfQp9CmZ1bmN0aW9uIHJlc2V0Q3R4VG9EZWZhdWx0KGN0eCkgewogIGN0eC5zdHJva2VTdHlsZSA9IGN0eC5maWxsU3R5bGUgPSAiIzAwMDAwMCI7CiAgY3R4LmZpbGxSdWxlID0gIm5vbnplcm8iOwogIGN0eC5nbG9iYWxBbHBoYSA9IDE7CiAgY3R4LmxpbmVXaWR0aCA9IDE7CiAgY3R4LmxpbmVDYXAgPSAiYnV0dCI7CiAgY3R4LmxpbmVKb2luID0gIm1pdGVyIjsKICBjdHgubWl0ZXJMaW1pdCA9IDEwOwogIGN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAic291cmNlLW92ZXIiOwogIGN0eC5mb250ID0gIjEwcHggc2Fucy1zZXJpZiI7CiAgaWYgKGN0eC5zZXRMaW5lRGFzaCAhPT0gdW5kZWZpbmVkKSB7CiAgICBjdHguc2V0TGluZURhc2goW10pOwogICAgY3R4LmxpbmVEYXNoT2Zmc2V0ID0gMDsKICB9CiAgY29uc3QgewogICAgZmlsdGVyCiAgfSA9IGN0eDsKICBpZiAoZmlsdGVyICE9PSAibm9uZSIgJiYgZmlsdGVyICE9PSAiIikgewogICAgY3R4LmZpbHRlciA9ICJub25lIjsKICB9Cn0KZnVuY3Rpb24gZ2V0SW1hZ2VTbW9vdGhpbmdFbmFibGVkKHRyYW5zZm9ybSwgaW50ZXJwb2xhdGUpIHsKICBpZiAoaW50ZXJwb2xhdGUpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBVdGlsLnNpbmd1bGFyVmFsdWVEZWNvbXBvc2UyZFNjYWxlKHRyYW5zZm9ybSwgWFkpOwogIGNvbnN0IGFjdHVhbFNjYWxlID0gTWF0aC5mcm91bmQoT3V0cHV0U2NhbGUucGl4ZWxSYXRpbyAqIFBpeGVsc1BlckluY2guUERGX1RPX0NTU19VTklUUyk7CiAgcmV0dXJuIFhZWzBdIDw9IGFjdHVhbFNjYWxlICYmIFhZWzFdIDw9IGFjdHVhbFNjYWxlOwp9CmNvbnN0IExJTkVfQ0FQX1NUWUxFUyA9IFsiYnV0dCIsICJyb3VuZCIsICJzcXVhcmUiXTsKY29uc3QgTElORV9KT0lOX1NUWUxFUyA9IFsibWl0ZXIiLCAicm91bmQiLCAiYmV2ZWwiXTsKY29uc3QgTk9STUFMX0NMSVAgPSB7fTsKY29uc3QgRU9fQ0xJUCA9IHt9OwpjbGFzcyBDYW52YXNHcmFwaGljcyB7CiAgY29uc3RydWN0b3IoY2FudmFzQ3R4LCBjb21tb25PYmpzLCBvYmpzLCBjYW52YXNGYWN0b3J5LCBmaWx0ZXJGYWN0b3J5LCB7CiAgICBvcHRpb25hbENvbnRlbnRDb25maWcsCiAgICBtYXJrZWRDb250ZW50U3RhY2sgPSBudWxsCiAgfSwgYW5ub3RhdGlvbkNhbnZhc01hcCwgcGFnZUNvbG9ycykgewogICAgdGhpcy5jdHggPSBjYW52YXNDdHg7CiAgICB0aGlzLmN1cnJlbnQgPSBuZXcgQ2FudmFzRXh0cmFTdGF0ZSh0aGlzLmN0eC5jYW52YXMud2lkdGgsIHRoaXMuY3R4LmNhbnZhcy5oZWlnaHQpOwogICAgdGhpcy5zdGF0ZVN0YWNrID0gW107CiAgICB0aGlzLnBlbmRpbmdDbGlwID0gbnVsbDsKICAgIHRoaXMucGVuZGluZ0VPRmlsbCA9IGZhbHNlOwogICAgdGhpcy5yZXMgPSBudWxsOwogICAgdGhpcy54b2JqcyA9IG51bGw7CiAgICB0aGlzLmNvbW1vbk9ianMgPSBjb21tb25PYmpzOwogICAgdGhpcy5vYmpzID0gb2JqczsKICAgIHRoaXMuY2FudmFzRmFjdG9yeSA9IGNhbnZhc0ZhY3Rvcnk7CiAgICB0aGlzLmZpbHRlckZhY3RvcnkgPSBmaWx0ZXJGYWN0b3J5OwogICAgdGhpcy5ncm91cFN0YWNrID0gW107CiAgICB0aGlzLmJhc2VUcmFuc2Zvcm0gPSBudWxsOwogICAgdGhpcy5iYXNlVHJhbnNmb3JtU3RhY2sgPSBbXTsKICAgIHRoaXMuZ3JvdXBMZXZlbCA9IDA7CiAgICB0aGlzLnNtYXNrU3RhY2sgPSBbXTsKICAgIHRoaXMuc21hc2tDb3VudGVyID0gMDsKICAgIHRoaXMudGVtcFNNYXNrID0gbnVsbDsKICAgIHRoaXMuc3VzcGVuZGVkQ3R4ID0gbnVsbDsKICAgIHRoaXMuY29udGVudFZpc2libGUgPSB0cnVlOwogICAgdGhpcy5tYXJrZWRDb250ZW50U3RhY2sgPSBtYXJrZWRDb250ZW50U3RhY2sgfHwgW107CiAgICB0aGlzLm9wdGlvbmFsQ29udGVudENvbmZpZyA9IG9wdGlvbmFsQ29udGVudENvbmZpZzsKICAgIHRoaXMuY2FjaGVkQ2FudmFzZXMgPSBuZXcgQ2FjaGVkQ2FudmFzZXModGhpcy5jYW52YXNGYWN0b3J5KTsKICAgIHRoaXMuY2FjaGVkUGF0dGVybnMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLmFubm90YXRpb25DYW52YXNNYXAgPSBhbm5vdGF0aW9uQ2FudmFzTWFwOwogICAgdGhpcy52aWV3cG9ydFNjYWxlID0gMTsKICAgIHRoaXMub3V0cHV0U2NhbGVYID0gMTsKICAgIHRoaXMub3V0cHV0U2NhbGVZID0gMTsKICAgIHRoaXMucGFnZUNvbG9ycyA9IHBhZ2VDb2xvcnM7CiAgICB0aGlzLl9jYWNoZWRTY2FsZUZvclN0cm9raW5nID0gWy0xLCAwXTsKICAgIHRoaXMuX2NhY2hlZEdldFNpbmdsZVBpeGVsV2lkdGggPSBudWxsOwogICAgdGhpcy5fY2FjaGVkQml0bWFwc01hcCA9IG5ldyBNYXAoKTsKICB9CiAgZ2V0T2JqZWN0KGRhdGEsIGZhbGxiYWNrID0gbnVsbCkgewogICAgaWYgKHR5cGVvZiBkYXRhID09PSAic3RyaW5nIikgewogICAgICByZXR1cm4gZGF0YS5zdGFydHNXaXRoKCJnXyIpID8gdGhpcy5jb21tb25PYmpzLmdldChkYXRhKSA6IHRoaXMub2Jqcy5nZXQoZGF0YSk7CiAgICB9CiAgICByZXR1cm4gZmFsbGJhY2s7CiAgfQogIGJlZ2luRHJhd2luZyh7CiAgICB0cmFuc2Zvcm0sCiAgICB2aWV3cG9ydCwKICAgIHRyYW5zcGFyZW5jeSA9IGZhbHNlLAogICAgYmFja2dyb3VuZCA9IG51bGwKICB9KSB7CiAgICBjb25zdCB3aWR0aCA9IHRoaXMuY3R4LmNhbnZhcy53aWR0aDsKICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuY3R4LmNhbnZhcy5oZWlnaHQ7CiAgICBjb25zdCBzYXZlZEZpbGxTdHlsZSA9IHRoaXMuY3R4LmZpbGxTdHlsZTsKICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IGJhY2tncm91bmQgfHwgIiNmZmZmZmYiOwogICAgdGhpcy5jdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBzYXZlZEZpbGxTdHlsZTsKICAgIGlmICh0cmFuc3BhcmVuY3kpIHsKICAgICAgY29uc3QgdHJhbnNwYXJlbnRDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcygidHJhbnNwYXJlbnQiLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgdGhpcy5jb21wb3NpdGVDdHggPSB0aGlzLmN0eDsKICAgICAgdGhpcy50cmFuc3BhcmVudENhbnZhcyA9IHRyYW5zcGFyZW50Q2FudmFzLmNhbnZhczsKICAgICAgdGhpcy5jdHggPSB0cmFuc3BhcmVudENhbnZhcy5jb250ZXh0OwogICAgICB0aGlzLmN0eC5zYXZlKCk7CiAgICAgIHRoaXMuY3R4LnRyYW5zZm9ybSguLi5nZXRDdXJyZW50VHJhbnNmb3JtKHRoaXMuY29tcG9zaXRlQ3R4KSk7CiAgICB9CiAgICB0aGlzLmN0eC5zYXZlKCk7CiAgICByZXNldEN0eFRvRGVmYXVsdCh0aGlzLmN0eCk7CiAgICBpZiAodHJhbnNmb3JtKSB7CiAgICAgIHRoaXMuY3R4LnRyYW5zZm9ybSguLi50cmFuc2Zvcm0pOwogICAgICB0aGlzLm91dHB1dFNjYWxlWCA9IHRyYW5zZm9ybVswXTsKICAgICAgdGhpcy5vdXRwdXRTY2FsZVkgPSB0cmFuc2Zvcm1bMF07CiAgICB9CiAgICB0aGlzLmN0eC50cmFuc2Zvcm0oLi4udmlld3BvcnQudHJhbnNmb3JtKTsKICAgIHRoaXMudmlld3BvcnRTY2FsZSA9IHZpZXdwb3J0LnNjYWxlOwogICAgdGhpcy5iYXNlVHJhbnNmb3JtID0gZ2V0Q3VycmVudFRyYW5zZm9ybSh0aGlzLmN0eCk7CiAgfQogIGV4ZWN1dGVPcGVyYXRvckxpc3Qob3BlcmF0b3JMaXN0LCBleGVjdXRpb25TdGFydElkeCwgY29udGludWVDYWxsYmFjaywgc3RlcHBlcikgewogICAgY29uc3QgYXJnc0FycmF5ID0gb3BlcmF0b3JMaXN0LmFyZ3NBcnJheTsKICAgIGNvbnN0IGZuQXJyYXkgPSBvcGVyYXRvckxpc3QuZm5BcnJheTsKICAgIGxldCBpID0gZXhlY3V0aW9uU3RhcnRJZHggfHwgMDsKICAgIGNvbnN0IGFyZ3NBcnJheUxlbiA9IGFyZ3NBcnJheS5sZW5ndGg7CiAgICBpZiAoYXJnc0FycmF5TGVuID09PSBpKSB7CiAgICAgIHJldHVybiBpOwogICAgfQogICAgY29uc3QgY2h1bmtPcGVyYXRpb25zID0gYXJnc0FycmF5TGVuIC0gaSA+IEVYRUNVVElPTl9TVEVQUyAmJiB0eXBlb2YgY29udGludWVDYWxsYmFjayA9PT0gImZ1bmN0aW9uIjsKICAgIGNvbnN0IGVuZFRpbWUgPSBjaHVua09wZXJhdGlvbnMgPyBEYXRlLm5vdygpICsgRVhFQ1VUSU9OX1RJTUUgOiAwOwogICAgbGV0IHN0ZXBzID0gMDsKICAgIGNvbnN0IGNvbW1vbk9ianMgPSB0aGlzLmNvbW1vbk9ianM7CiAgICBjb25zdCBvYmpzID0gdGhpcy5vYmpzOwogICAgbGV0IGZuSWQ7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoc3RlcHBlciAhPT0gdW5kZWZpbmVkICYmIGkgPT09IHN0ZXBwZXIubmV4dEJyZWFrUG9pbnQpIHsKICAgICAgICBzdGVwcGVyLmJyZWFrSXQoaSwgY29udGludWVDYWxsYmFjayk7CiAgICAgICAgcmV0dXJuIGk7CiAgICAgIH0KICAgICAgZm5JZCA9IGZuQXJyYXlbaV07CiAgICAgIGlmIChmbklkICE9PSBPUFMuZGVwZW5kZW5jeSkgewogICAgICAgIHRoaXNbZm5JZF0uYXBwbHkodGhpcywgYXJnc0FycmF5W2ldKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGNvbnN0IGRlcE9iaklkIG9mIGFyZ3NBcnJheVtpXSkgewogICAgICAgICAgY29uc3Qgb2Jqc1Bvb2wgPSBkZXBPYmpJZC5zdGFydHNXaXRoKCJnXyIpID8gY29tbW9uT2JqcyA6IG9ianM7CiAgICAgICAgICBpZiAoIW9ianNQb29sLmhhcyhkZXBPYmpJZCkpIHsKICAgICAgICAgICAgb2Jqc1Bvb2wuZ2V0KGRlcE9iaklkLCBjb250aW51ZUNhbGxiYWNrKTsKICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGkrKzsKICAgICAgaWYgKGkgPT09IGFyZ3NBcnJheUxlbikgewogICAgICAgIHJldHVybiBpOwogICAgICB9CiAgICAgIGlmIChjaHVua09wZXJhdGlvbnMgJiYgKytzdGVwcyA+IEVYRUNVVElPTl9TVEVQUykgewogICAgICAgIGlmIChEYXRlLm5vdygpID4gZW5kVGltZSkgewogICAgICAgICAgY29udGludWVDYWxsYmFjaygpOwogICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgfQogICAgICAgIHN0ZXBzID0gMDsKICAgICAgfQogICAgfQogIH0KICAjcmVzdG9yZUluaXRpYWxTdGF0ZSgpIHsKICAgIHdoaWxlICh0aGlzLnN0YXRlU3RhY2subGVuZ3RoIHx8IHRoaXMuaW5TTWFza01vZGUpIHsKICAgICAgdGhpcy5yZXN0b3JlKCk7CiAgICB9CiAgICB0aGlzLmN1cnJlbnQuYWN0aXZlU01hc2sgPSBudWxsOwogICAgdGhpcy5jdHgucmVzdG9yZSgpOwogICAgaWYgKHRoaXMudHJhbnNwYXJlbnRDYW52YXMpIHsKICAgICAgdGhpcy5jdHggPSB0aGlzLmNvbXBvc2l0ZUN0eDsKICAgICAgdGhpcy5jdHguc2F2ZSgpOwogICAgICB0aGlzLmN0eC5zZXRUcmFuc2Zvcm0oMSwgMCwgMCwgMSwgMCwgMCk7CiAgICAgIHRoaXMuY3R4LmRyYXdJbWFnZSh0aGlzLnRyYW5zcGFyZW50Q2FudmFzLCAwLCAwKTsKICAgICAgdGhpcy5jdHgucmVzdG9yZSgpOwogICAgICB0aGlzLnRyYW5zcGFyZW50Q2FudmFzID0gbnVsbDsKICAgIH0KICB9CiAgZW5kRHJhd2luZygpIHsKICAgIHRoaXMuI3Jlc3RvcmVJbml0aWFsU3RhdGUoKTsKICAgIHRoaXMuY2FjaGVkQ2FudmFzZXMuY2xlYXIoKTsKICAgIHRoaXMuY2FjaGVkUGF0dGVybnMuY2xlYXIoKTsKICAgIGZvciAoY29uc3QgY2FjaGUgb2YgdGhpcy5fY2FjaGVkQml0bWFwc01hcC52YWx1ZXMoKSkgewogICAgICBmb3IgKGNvbnN0IGNhbnZhcyBvZiBjYWNoZS52YWx1ZXMoKSkgewogICAgICAgIGlmICh0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgIT09ICJ1bmRlZmluZWQiICYmIGNhbnZhcyBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50KSB7CiAgICAgICAgICBjYW52YXMud2lkdGggPSBjYW52YXMuaGVpZ2h0ID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgICAgY2FjaGUuY2xlYXIoKTsKICAgIH0KICAgIHRoaXMuX2NhY2hlZEJpdG1hcHNNYXAuY2xlYXIoKTsKICAgIHRoaXMuI2RyYXdGaWx0ZXIoKTsKICB9CiAgI2RyYXdGaWx0ZXIoKSB7CiAgICBpZiAodGhpcy5wYWdlQ29sb3JzKSB7CiAgICAgIGNvbnN0IGhjbUZpbHRlcklkID0gdGhpcy5maWx0ZXJGYWN0b3J5LmFkZEhDTUZpbHRlcih0aGlzLnBhZ2VDb2xvcnMuZm9yZWdyb3VuZCwgdGhpcy5wYWdlQ29sb3JzLmJhY2tncm91bmQpOwogICAgICBpZiAoaGNtRmlsdGVySWQgIT09ICJub25lIikgewogICAgICAgIGNvbnN0IHNhdmVkRmlsdGVyID0gdGhpcy5jdHguZmlsdGVyOwogICAgICAgIHRoaXMuY3R4LmZpbHRlciA9IGhjbUZpbHRlcklkOwogICAgICAgIHRoaXMuY3R4LmRyYXdJbWFnZSh0aGlzLmN0eC5jYW52YXMsIDAsIDApOwogICAgICAgIHRoaXMuY3R4LmZpbHRlciA9IHNhdmVkRmlsdGVyOwogICAgICB9CiAgICB9CiAgfQogIF9zY2FsZUltYWdlKGltZywgaW52ZXJzZVRyYW5zZm9ybSkgewogICAgY29uc3Qgd2lkdGggPSBpbWcud2lkdGggPz8gaW1nLmRpc3BsYXlXaWR0aDsKICAgIGNvbnN0IGhlaWdodCA9IGltZy5oZWlnaHQgPz8gaW1nLmRpc3BsYXlIZWlnaHQ7CiAgICBsZXQgd2lkdGhTY2FsZSA9IE1hdGgubWF4KE1hdGguaHlwb3QoaW52ZXJzZVRyYW5zZm9ybVswXSwgaW52ZXJzZVRyYW5zZm9ybVsxXSksIDEpOwogICAgbGV0IGhlaWdodFNjYWxlID0gTWF0aC5tYXgoTWF0aC5oeXBvdChpbnZlcnNlVHJhbnNmb3JtWzJdLCBpbnZlcnNlVHJhbnNmb3JtWzNdKSwgMSk7CiAgICBsZXQgcGFpbnRXaWR0aCA9IHdpZHRoLAogICAgICBwYWludEhlaWdodCA9IGhlaWdodDsKICAgIGxldCB0bXBDYW52YXNJZCA9ICJwcmVzY2FsZTEiOwogICAgbGV0IHRtcENhbnZhcywgdG1wQ3R4OwogICAgd2hpbGUgKHdpZHRoU2NhbGUgPiAyICYmIHBhaW50V2lkdGggPiAxIHx8IGhlaWdodFNjYWxlID4gMiAmJiBwYWludEhlaWdodCA+IDEpIHsKICAgICAgbGV0IG5ld1dpZHRoID0gcGFpbnRXaWR0aCwKICAgICAgICBuZXdIZWlnaHQgPSBwYWludEhlaWdodDsKICAgICAgaWYgKHdpZHRoU2NhbGUgPiAyICYmIHBhaW50V2lkdGggPiAxKSB7CiAgICAgICAgbmV3V2lkdGggPSBwYWludFdpZHRoID49IDE2Mzg0ID8gTWF0aC5mbG9vcihwYWludFdpZHRoIC8gMikgLSAxIHx8IDEgOiBNYXRoLmNlaWwocGFpbnRXaWR0aCAvIDIpOwogICAgICAgIHdpZHRoU2NhbGUgLz0gcGFpbnRXaWR0aCAvIG5ld1dpZHRoOwogICAgICB9CiAgICAgIGlmIChoZWlnaHRTY2FsZSA+IDIgJiYgcGFpbnRIZWlnaHQgPiAxKSB7CiAgICAgICAgbmV3SGVpZ2h0ID0gcGFpbnRIZWlnaHQgPj0gMTYzODQgPyBNYXRoLmZsb29yKHBhaW50SGVpZ2h0IC8gMikgLSAxIHx8IDEgOiBNYXRoLmNlaWwocGFpbnRIZWlnaHQpIC8gMjsKICAgICAgICBoZWlnaHRTY2FsZSAvPSBwYWludEhlaWdodCAvIG5ld0hlaWdodDsKICAgICAgfQogICAgICB0bXBDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcyh0bXBDYW52YXNJZCwgbmV3V2lkdGgsIG5ld0hlaWdodCk7CiAgICAgIHRtcEN0eCA9IHRtcENhbnZhcy5jb250ZXh0OwogICAgICB0bXBDdHguY2xlYXJSZWN0KDAsIDAsIG5ld1dpZHRoLCBuZXdIZWlnaHQpOwogICAgICB0bXBDdHguZHJhd0ltYWdlKGltZywgMCwgMCwgcGFpbnRXaWR0aCwgcGFpbnRIZWlnaHQsIDAsIDAsIG5ld1dpZHRoLCBuZXdIZWlnaHQpOwogICAgICBpbWcgPSB0bXBDYW52YXMuY2FudmFzOwogICAgICBwYWludFdpZHRoID0gbmV3V2lkdGg7CiAgICAgIHBhaW50SGVpZ2h0ID0gbmV3SGVpZ2h0OwogICAgICB0bXBDYW52YXNJZCA9IHRtcENhbnZhc0lkID09PSAicHJlc2NhbGUxIiA/ICJwcmVzY2FsZTIiIDogInByZXNjYWxlMSI7CiAgICB9CiAgICByZXR1cm4gewogICAgICBpbWcsCiAgICAgIHBhaW50V2lkdGgsCiAgICAgIHBhaW50SGVpZ2h0CiAgICB9OwogIH0KICBfY3JlYXRlTWFza0NhbnZhcyhpbWcpIHsKICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4OwogICAgY29uc3QgewogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gaW1nOwogICAgY29uc3QgZmlsbENvbG9yID0gdGhpcy5jdXJyZW50LmZpbGxDb2xvcjsKICAgIGNvbnN0IGlzUGF0dGVybkZpbGwgPSB0aGlzLmN1cnJlbnQucGF0dGVybkZpbGw7CiAgICBjb25zdCBjdXJyZW50VHJhbnNmb3JtID0gZ2V0Q3VycmVudFRyYW5zZm9ybShjdHgpOwogICAgbGV0IGNhY2hlLCBjYWNoZUtleSwgc2NhbGVkLCBtYXNrQ2FudmFzOwogICAgaWYgKChpbWcuYml0bWFwIHx8IGltZy5kYXRhKSAmJiBpbWcuY291bnQgPiAxKSB7CiAgICAgIGNvbnN0IG1haW5LZXkgPSBpbWcuYml0bWFwIHx8IGltZy5kYXRhLmJ1ZmZlcjsKICAgICAgY2FjaGVLZXkgPSBKU09OLnN0cmluZ2lmeShpc1BhdHRlcm5GaWxsID8gY3VycmVudFRyYW5zZm9ybSA6IFtjdXJyZW50VHJhbnNmb3JtLnNsaWNlKDAsIDQpLCBmaWxsQ29sb3JdKTsKICAgICAgY2FjaGUgPSB0aGlzLl9jYWNoZWRCaXRtYXBzTWFwLmdldChtYWluS2V5KTsKICAgICAgaWYgKCFjYWNoZSkgewogICAgICAgIGNhY2hlID0gbmV3IE1hcCgpOwogICAgICAgIHRoaXMuX2NhY2hlZEJpdG1hcHNNYXAuc2V0KG1haW5LZXksIGNhY2hlKTsKICAgICAgfQogICAgICBjb25zdCBjYWNoZWRJbWFnZSA9IGNhY2hlLmdldChjYWNoZUtleSk7CiAgICAgIGlmIChjYWNoZWRJbWFnZSAmJiAhaXNQYXR0ZXJuRmlsbCkgewogICAgICAgIGNvbnN0IG9mZnNldFggPSBNYXRoLnJvdW5kKE1hdGgubWluKGN1cnJlbnRUcmFuc2Zvcm1bMF0sIGN1cnJlbnRUcmFuc2Zvcm1bMl0pICsgY3VycmVudFRyYW5zZm9ybVs0XSk7CiAgICAgICAgY29uc3Qgb2Zmc2V0WSA9IE1hdGgucm91bmQoTWF0aC5taW4oY3VycmVudFRyYW5zZm9ybVsxXSwgY3VycmVudFRyYW5zZm9ybVszXSkgKyBjdXJyZW50VHJhbnNmb3JtWzVdKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgY2FudmFzOiBjYWNoZWRJbWFnZSwKICAgICAgICAgIG9mZnNldFgsCiAgICAgICAgICBvZmZzZXRZCiAgICAgICAgfTsKICAgICAgfQogICAgICBzY2FsZWQgPSBjYWNoZWRJbWFnZTsKICAgIH0KICAgIGlmICghc2NhbGVkKSB7CiAgICAgIG1hc2tDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcygibWFza0NhbnZhcyIsIHdpZHRoLCBoZWlnaHQpOwogICAgICBwdXRCaW5hcnlJbWFnZU1hc2sobWFza0NhbnZhcy5jb250ZXh0LCBpbWcpOwogICAgfQogICAgbGV0IG1hc2tUb0NhbnZhcyA9IFV0aWwudHJhbnNmb3JtKGN1cnJlbnRUcmFuc2Zvcm0sIFsxIC8gd2lkdGgsIDAsIDAsIC0xIC8gaGVpZ2h0LCAwLCAwXSk7CiAgICBtYXNrVG9DYW52YXMgPSBVdGlsLnRyYW5zZm9ybShtYXNrVG9DYW52YXMsIFsxLCAwLCAwLCAxLCAwLCAtaGVpZ2h0XSk7CiAgICBjb25zdCBtaW5NYXggPSBNSU5fTUFYX0lOSVQuc2xpY2UoKTsKICAgIFV0aWwuYXhpYWxBbGlnbmVkQm91bmRpbmdCb3goWzAsIDAsIHdpZHRoLCBoZWlnaHRdLCBtYXNrVG9DYW52YXMsIG1pbk1heCk7CiAgICBjb25zdCBbbWluWCwgbWluWSwgbWF4WCwgbWF4WV0gPSBtaW5NYXg7CiAgICBjb25zdCBkcmF3bldpZHRoID0gTWF0aC5yb3VuZChtYXhYIC0gbWluWCkgfHwgMTsKICAgIGNvbnN0IGRyYXduSGVpZ2h0ID0gTWF0aC5yb3VuZChtYXhZIC0gbWluWSkgfHwgMTsKICAgIGNvbnN0IGZpbGxDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcygiZmlsbENhbnZhcyIsIGRyYXduV2lkdGgsIGRyYXduSGVpZ2h0KTsKICAgIGNvbnN0IGZpbGxDdHggPSBmaWxsQ2FudmFzLmNvbnRleHQ7CiAgICBjb25zdCBvZmZzZXRYID0gbWluWDsKICAgIGNvbnN0IG9mZnNldFkgPSBtaW5ZOwogICAgZmlsbEN0eC50cmFuc2xhdGUoLW9mZnNldFgsIC1vZmZzZXRZKTsKICAgIGZpbGxDdHgudHJhbnNmb3JtKC4uLm1hc2tUb0NhbnZhcyk7CiAgICBpZiAoIXNjYWxlZCkgewogICAgICBzY2FsZWQgPSB0aGlzLl9zY2FsZUltYWdlKG1hc2tDYW52YXMuY2FudmFzLCBnZXRDdXJyZW50VHJhbnNmb3JtSW52ZXJzZShmaWxsQ3R4KSk7CiAgICAgIHNjYWxlZCA9IHNjYWxlZC5pbWc7CiAgICAgIGlmIChjYWNoZSAmJiBpc1BhdHRlcm5GaWxsKSB7CiAgICAgICAgY2FjaGUuc2V0KGNhY2hlS2V5LCBzY2FsZWQpOwogICAgICB9CiAgICB9CiAgICBmaWxsQ3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGdldEltYWdlU21vb3RoaW5nRW5hYmxlZChnZXRDdXJyZW50VHJhbnNmb3JtKGZpbGxDdHgpLCBpbWcuaW50ZXJwb2xhdGUpOwogICAgZHJhd0ltYWdlQXRJbnRlZ2VyQ29vcmRzKGZpbGxDdHgsIHNjYWxlZCwgMCwgMCwgc2NhbGVkLndpZHRoLCBzY2FsZWQuaGVpZ2h0LCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgIGZpbGxDdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gInNvdXJjZS1pbiI7CiAgICBjb25zdCBpbnZlcnNlID0gVXRpbC50cmFuc2Zvcm0oZ2V0Q3VycmVudFRyYW5zZm9ybUludmVyc2UoZmlsbEN0eCksIFsxLCAwLCAwLCAxLCAtb2Zmc2V0WCwgLW9mZnNldFldKTsKICAgIGZpbGxDdHguZmlsbFN0eWxlID0gaXNQYXR0ZXJuRmlsbCA/IGZpbGxDb2xvci5nZXRQYXR0ZXJuKGN0eCwgdGhpcywgaW52ZXJzZSwgUGF0aFR5cGUuRklMTCkgOiBmaWxsQ29sb3I7CiAgICBmaWxsQ3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgaWYgKGNhY2hlICYmICFpc1BhdHRlcm5GaWxsKSB7CiAgICAgIHRoaXMuY2FjaGVkQ2FudmFzZXMuZGVsZXRlKCJmaWxsQ2FudmFzIik7CiAgICAgIGNhY2hlLnNldChjYWNoZUtleSwgZmlsbENhbnZhcy5jYW52YXMpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgY2FudmFzOiBmaWxsQ2FudmFzLmNhbnZhcywKICAgICAgb2Zmc2V0WDogTWF0aC5yb3VuZChvZmZzZXRYKSwKICAgICAgb2Zmc2V0WTogTWF0aC5yb3VuZChvZmZzZXRZKQogICAgfTsKICB9CiAgc2V0TGluZVdpZHRoKHdpZHRoKSB7CiAgICBpZiAod2lkdGggIT09IHRoaXMuY3VycmVudC5saW5lV2lkdGgpIHsKICAgICAgdGhpcy5fY2FjaGVkU2NhbGVGb3JTdHJva2luZ1swXSA9IC0xOwogICAgfQogICAgdGhpcy5jdXJyZW50LmxpbmVXaWR0aCA9IHdpZHRoOwogICAgdGhpcy5jdHgubGluZVdpZHRoID0gd2lkdGg7CiAgfQogIHNldExpbmVDYXAoc3R5bGUpIHsKICAgIHRoaXMuY3R4LmxpbmVDYXAgPSBMSU5FX0NBUF9TVFlMRVNbc3R5bGVdOwogIH0KICBzZXRMaW5lSm9pbihzdHlsZSkgewogICAgdGhpcy5jdHgubGluZUpvaW4gPSBMSU5FX0pPSU5fU1RZTEVTW3N0eWxlXTsKICB9CiAgc2V0TWl0ZXJMaW1pdChsaW1pdCkgewogICAgdGhpcy5jdHgubWl0ZXJMaW1pdCA9IGxpbWl0OwogIH0KICBzZXREYXNoKGRhc2hBcnJheSwgZGFzaFBoYXNlKSB7CiAgICBjb25zdCBjdHggPSB0aGlzLmN0eDsKICAgIGlmIChjdHguc2V0TGluZURhc2ggIT09IHVuZGVmaW5lZCkgewogICAgICBjdHguc2V0TGluZURhc2goZGFzaEFycmF5KTsKICAgICAgY3R4LmxpbmVEYXNoT2Zmc2V0ID0gZGFzaFBoYXNlOwogICAgfQogIH0KICBzZXRSZW5kZXJpbmdJbnRlbnQoaW50ZW50KSB7fQogIHNldEZsYXRuZXNzKGZsYXRuZXNzKSB7fQogIHNldEdTdGF0ZShzdGF0ZXMpIHsKICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHN0YXRlcykgewogICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgIGNhc2UgIkxXIjoKICAgICAgICAgIHRoaXMuc2V0TGluZVdpZHRoKHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkxDIjoKICAgICAgICAgIHRoaXMuc2V0TGluZUNhcCh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJMSiI6CiAgICAgICAgICB0aGlzLnNldExpbmVKb2luKHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIk1MIjoKICAgICAgICAgIHRoaXMuc2V0TWl0ZXJMaW1pdCh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJEIjoKICAgICAgICAgIHRoaXMuc2V0RGFzaCh2YWx1ZVswXSwgdmFsdWVbMV0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiUkkiOgogICAgICAgICAgdGhpcy5zZXRSZW5kZXJpbmdJbnRlbnQodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRkwiOgogICAgICAgICAgdGhpcy5zZXRGbGF0bmVzcyh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJGb250IjoKICAgICAgICAgIHRoaXMuc2V0Rm9udCh2YWx1ZVswXSwgdmFsdWVbMV0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiQ0EiOgogICAgICAgICAgdGhpcy5jdXJyZW50LnN0cm9rZUFscGhhID0gdmFsdWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjYSI6CiAgICAgICAgICB0aGlzLmN0eC5nbG9iYWxBbHBoYSA9IHRoaXMuY3VycmVudC5maWxsQWxwaGEgPSB2YWx1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkJNIjoKICAgICAgICAgIHRoaXMuY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IHZhbHVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiU01hc2siOgogICAgICAgICAgdGhpcy5jdXJyZW50LmFjdGl2ZVNNYXNrID0gdmFsdWUgPyB0aGlzLnRlbXBTTWFzayA6IG51bGw7CiAgICAgICAgICB0aGlzLnRlbXBTTWFzayA9IG51bGw7CiAgICAgICAgICB0aGlzLmNoZWNrU01hc2tTdGF0ZSgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiVFIiOgogICAgICAgICAgdGhpcy5jdHguZmlsdGVyID0gdGhpcy5jdXJyZW50LnRyYW5zZmVyTWFwcyA9IHRoaXMuZmlsdGVyRmFjdG9yeS5hZGRGaWx0ZXIodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0IGluU01hc2tNb2RlKCkgewogICAgcmV0dXJuICEhdGhpcy5zdXNwZW5kZWRDdHg7CiAgfQogIGNoZWNrU01hc2tTdGF0ZSgpIHsKICAgIGNvbnN0IGluU01hc2tNb2RlID0gdGhpcy5pblNNYXNrTW9kZTsKICAgIGlmICh0aGlzLmN1cnJlbnQuYWN0aXZlU01hc2sgJiYgIWluU01hc2tNb2RlKSB7CiAgICAgIHRoaXMuYmVnaW5TTWFza01vZGUoKTsKICAgIH0gZWxzZSBpZiAoIXRoaXMuY3VycmVudC5hY3RpdmVTTWFzayAmJiBpblNNYXNrTW9kZSkgewogICAgICB0aGlzLmVuZFNNYXNrTW9kZSgpOwogICAgfQogIH0KICBiZWdpblNNYXNrTW9kZSgpIHsKICAgIGlmICh0aGlzLmluU01hc2tNb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiYmVnaW5TTWFza01vZGUgY2FsbGVkIHdoaWxlIGFscmVhZHkgaW4gc21hc2sgbW9kZSIpOwogICAgfQogICAgY29uc3QgZHJhd25XaWR0aCA9IHRoaXMuY3R4LmNhbnZhcy53aWR0aDsKICAgIGNvbnN0IGRyYXduSGVpZ2h0ID0gdGhpcy5jdHguY2FudmFzLmhlaWdodDsKICAgIGNvbnN0IGNhY2hlSWQgPSAic21hc2tHcm91cEF0IiArIHRoaXMuZ3JvdXBMZXZlbDsKICAgIGNvbnN0IHNjcmF0Y2hDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcyhjYWNoZUlkLCBkcmF3bldpZHRoLCBkcmF3bkhlaWdodCk7CiAgICB0aGlzLnN1c3BlbmRlZEN0eCA9IHRoaXMuY3R4OwogICAgY29uc3QgY3R4ID0gdGhpcy5jdHggPSBzY3JhdGNoQ2FudmFzLmNvbnRleHQ7CiAgICBjdHguc2V0VHJhbnNmb3JtKHRoaXMuc3VzcGVuZGVkQ3R4LmdldFRyYW5zZm9ybSgpKTsKICAgIGNvcHlDdHhTdGF0ZSh0aGlzLnN1c3BlbmRlZEN0eCwgY3R4KTsKICAgIG1pcnJvckNvbnRleHRPcGVyYXRpb25zKGN0eCwgdGhpcy5zdXNwZW5kZWRDdHgpOwogICAgdGhpcy5zZXRHU3RhdGUoW1siQk0iLCAic291cmNlLW92ZXIiXV0pOwogIH0KICBlbmRTTWFza01vZGUoKSB7CiAgICBpZiAoIXRoaXMuaW5TTWFza01vZGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJlbmRTTWFza01vZGUgY2FsbGVkIHdoaWxlIG5vdCBpbiBzbWFzayBtb2RlIik7CiAgICB9CiAgICB0aGlzLmN0eC5fcmVtb3ZlTWlycm9yaW5nKCk7CiAgICBjb3B5Q3R4U3RhdGUodGhpcy5jdHgsIHRoaXMuc3VzcGVuZGVkQ3R4KTsKICAgIHRoaXMuY3R4ID0gdGhpcy5zdXNwZW5kZWRDdHg7CiAgICB0aGlzLnN1c3BlbmRlZEN0eCA9IG51bGw7CiAgfQogIGNvbXBvc2UoZGlydHlCb3gpIHsKICAgIGlmICghdGhpcy5jdXJyZW50LmFjdGl2ZVNNYXNrKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghZGlydHlCb3gpIHsKICAgICAgZGlydHlCb3ggPSBbMCwgMCwgdGhpcy5jdHguY2FudmFzLndpZHRoLCB0aGlzLmN0eC5jYW52YXMuaGVpZ2h0XTsKICAgIH0gZWxzZSB7CiAgICAgIGRpcnR5Qm94WzBdID0gTWF0aC5mbG9vcihkaXJ0eUJveFswXSk7CiAgICAgIGRpcnR5Qm94WzFdID0gTWF0aC5mbG9vcihkaXJ0eUJveFsxXSk7CiAgICAgIGRpcnR5Qm94WzJdID0gTWF0aC5jZWlsKGRpcnR5Qm94WzJdKTsKICAgICAgZGlydHlCb3hbM10gPSBNYXRoLmNlaWwoZGlydHlCb3hbM10pOwogICAgfQogICAgY29uc3Qgc21hc2sgPSB0aGlzLmN1cnJlbnQuYWN0aXZlU01hc2s7CiAgICBjb25zdCBzdXNwZW5kZWRDdHggPSB0aGlzLnN1c3BlbmRlZEN0eDsKICAgIHRoaXMuY29tcG9zZVNNYXNrKHN1c3BlbmRlZEN0eCwgc21hc2ssIHRoaXMuY3R4LCBkaXJ0eUJveCk7CiAgICB0aGlzLmN0eC5zYXZlKCk7CiAgICB0aGlzLmN0eC5zZXRUcmFuc2Zvcm0oMSwgMCwgMCwgMSwgMCwgMCk7CiAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jdHguY2FudmFzLndpZHRoLCB0aGlzLmN0eC5jYW52YXMuaGVpZ2h0KTsKICAgIHRoaXMuY3R4LnJlc3RvcmUoKTsKICB9CiAgY29tcG9zZVNNYXNrKGN0eCwgc21hc2ssIGxheWVyQ3R4LCBsYXllckJveCkgewogICAgY29uc3QgbGF5ZXJPZmZzZXRYID0gbGF5ZXJCb3hbMF07CiAgICBjb25zdCBsYXllck9mZnNldFkgPSBsYXllckJveFsxXTsKICAgIGNvbnN0IGxheWVyV2lkdGggPSBsYXllckJveFsyXSAtIGxheWVyT2Zmc2V0WDsKICAgIGNvbnN0IGxheWVySGVpZ2h0ID0gbGF5ZXJCb3hbM10gLSBsYXllck9mZnNldFk7CiAgICBpZiAobGF5ZXJXaWR0aCA9PT0gMCB8fCBsYXllckhlaWdodCA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmdlbmVyaWNDb21wb3NlU01hc2soc21hc2suY29udGV4dCwgbGF5ZXJDdHgsIGxheWVyV2lkdGgsIGxheWVySGVpZ2h0LCBzbWFzay5zdWJ0eXBlLCBzbWFzay5iYWNrZHJvcCwgc21hc2sudHJhbnNmZXJNYXAsIGxheWVyT2Zmc2V0WCwgbGF5ZXJPZmZzZXRZLCBzbWFzay5vZmZzZXRYLCBzbWFzay5vZmZzZXRZKTsKICAgIGN0eC5zYXZlKCk7CiAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICJzb3VyY2Utb3ZlciI7CiAgICBjdHguc2V0VHJhbnNmb3JtKDEsIDAsIDAsIDEsIDAsIDApOwogICAgY3R4LmRyYXdJbWFnZShsYXllckN0eC5jYW52YXMsIDAsIDApOwogICAgY3R4LnJlc3RvcmUoKTsKICB9CiAgZ2VuZXJpY0NvbXBvc2VTTWFzayhtYXNrQ3R4LCBsYXllckN0eCwgd2lkdGgsIGhlaWdodCwgc3VidHlwZSwgYmFja2Ryb3AsIHRyYW5zZmVyTWFwLCBsYXllck9mZnNldFgsIGxheWVyT2Zmc2V0WSwgbWFza09mZnNldFgsIG1hc2tPZmZzZXRZKSB7CiAgICBsZXQgbWFza0NhbnZhcyA9IG1hc2tDdHguY2FudmFzOwogICAgbGV0IG1hc2tYID0gbGF5ZXJPZmZzZXRYIC0gbWFza09mZnNldFg7CiAgICBsZXQgbWFza1kgPSBsYXllck9mZnNldFkgLSBtYXNrT2Zmc2V0WTsKICAgIGlmIChiYWNrZHJvcCkgewogICAgICBpZiAobWFza1ggPCAwIHx8IG1hc2tZIDwgMCB8fCBtYXNrWCArIHdpZHRoID4gbWFza0NhbnZhcy53aWR0aCB8fCBtYXNrWSArIGhlaWdodCA+IG1hc2tDYW52YXMuaGVpZ2h0KSB7CiAgICAgICAgY29uc3QgY2FudmFzID0gdGhpcy5jYWNoZWRDYW52YXNlcy5nZXRDYW52YXMoIm1hc2tFeHRlbnNpb24iLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuY29udGV4dDsKICAgICAgICBjdHguZHJhd0ltYWdlKG1hc2tDYW52YXMsIC1tYXNrWCwgLW1hc2tZKTsKICAgICAgICBjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gImRlc3RpbmF0aW9uLWF0b3AiOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSBiYWNrZHJvcDsKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICJzb3VyY2Utb3ZlciI7CiAgICAgICAgbWFza0NhbnZhcyA9IGNhbnZhcy5jYW52YXM7CiAgICAgICAgbWFza1ggPSBtYXNrWSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWFza0N0eC5zYXZlKCk7CiAgICAgICAgbWFza0N0eC5nbG9iYWxBbHBoYSA9IDE7CiAgICAgICAgbWFza0N0eC5zZXRUcmFuc2Zvcm0oMSwgMCwgMCwgMSwgMCwgMCk7CiAgICAgICAgY29uc3QgY2xpcCA9IG5ldyBQYXRoMkQoKTsKICAgICAgICBjbGlwLnJlY3QobWFza1gsIG1hc2tZLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBtYXNrQ3R4LmNsaXAoY2xpcCk7CiAgICAgICAgbWFza0N0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAiZGVzdGluYXRpb24tYXRvcCI7CiAgICAgICAgbWFza0N0eC5maWxsU3R5bGUgPSBiYWNrZHJvcDsKICAgICAgICBtYXNrQ3R4LmZpbGxSZWN0KG1hc2tYLCBtYXNrWSwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgbWFza0N0eC5yZXN0b3JlKCk7CiAgICAgIH0KICAgIH0KICAgIGxheWVyQ3R4LnNhdmUoKTsKICAgIGxheWVyQ3R4Lmdsb2JhbEFscGhhID0gMTsKICAgIGxheWVyQ3R4LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCAwLCAwKTsKICAgIGlmIChzdWJ0eXBlID09PSAiQWxwaGEiICYmIHRyYW5zZmVyTWFwKSB7CiAgICAgIGxheWVyQ3R4LmZpbHRlciA9IHRoaXMuZmlsdGVyRmFjdG9yeS5hZGRBbHBoYUZpbHRlcih0cmFuc2Zlck1hcCk7CiAgICB9IGVsc2UgaWYgKHN1YnR5cGUgPT09ICJMdW1pbm9zaXR5IikgewogICAgICBsYXllckN0eC5maWx0ZXIgPSB0aGlzLmZpbHRlckZhY3RvcnkuYWRkTHVtaW5vc2l0eUZpbHRlcih0cmFuc2Zlck1hcCk7CiAgICB9CiAgICBjb25zdCBjbGlwID0gbmV3IFBhdGgyRCgpOwogICAgY2xpcC5yZWN0KGxheWVyT2Zmc2V0WCwgbGF5ZXJPZmZzZXRZLCB3aWR0aCwgaGVpZ2h0KTsKICAgIGxheWVyQ3R4LmNsaXAoY2xpcCk7CiAgICBsYXllckN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAiZGVzdGluYXRpb24taW4iOwogICAgbGF5ZXJDdHguZHJhd0ltYWdlKG1hc2tDYW52YXMsIG1hc2tYLCBtYXNrWSwgd2lkdGgsIGhlaWdodCwgbGF5ZXJPZmZzZXRYLCBsYXllck9mZnNldFksIHdpZHRoLCBoZWlnaHQpOwogICAgbGF5ZXJDdHgucmVzdG9yZSgpOwogIH0KICBzYXZlKCkgewogICAgaWYgKHRoaXMuaW5TTWFza01vZGUpIHsKICAgICAgY29weUN0eFN0YXRlKHRoaXMuY3R4LCB0aGlzLnN1c3BlbmRlZEN0eCk7CiAgICB9CiAgICB0aGlzLmN0eC5zYXZlKCk7CiAgICBjb25zdCBvbGQgPSB0aGlzLmN1cnJlbnQ7CiAgICB0aGlzLnN0YXRlU3RhY2sucHVzaChvbGQpOwogICAgdGhpcy5jdXJyZW50ID0gb2xkLmNsb25lKCk7CiAgfQogIHJlc3RvcmUoKSB7CiAgICBpZiAodGhpcy5zdGF0ZVN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICBpZiAodGhpcy5pblNNYXNrTW9kZSkgewogICAgICAgIHRoaXMuZW5kU01hc2tNb2RlKCk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5jdXJyZW50ID0gdGhpcy5zdGF0ZVN0YWNrLnBvcCgpOwogICAgdGhpcy5jdHgucmVzdG9yZSgpOwogICAgaWYgKHRoaXMuaW5TTWFza01vZGUpIHsKICAgICAgY29weUN0eFN0YXRlKHRoaXMuc3VzcGVuZGVkQ3R4LCB0aGlzLmN0eCk7CiAgICB9CiAgICB0aGlzLmNoZWNrU01hc2tTdGF0ZSgpOwogICAgdGhpcy5wZW5kaW5nQ2xpcCA9IG51bGw7CiAgICB0aGlzLl9jYWNoZWRTY2FsZUZvclN0cm9raW5nWzBdID0gLTE7CiAgICB0aGlzLl9jYWNoZWRHZXRTaW5nbGVQaXhlbFdpZHRoID0gbnVsbDsKICB9CiAgdHJhbnNmb3JtKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgIHRoaXMuY3R4LnRyYW5zZm9ybShhLCBiLCBjLCBkLCBlLCBmKTsKICAgIHRoaXMuX2NhY2hlZFNjYWxlRm9yU3Ryb2tpbmdbMF0gPSAtMTsKICAgIHRoaXMuX2NhY2hlZEdldFNpbmdsZVBpeGVsV2lkdGggPSBudWxsOwogIH0KICBjb25zdHJ1Y3RQYXRoKG9wLCBkYXRhLCBtaW5NYXgpIHsKICAgIGxldCBbcGF0aF0gPSBkYXRhOwogICAgaWYgKCFtaW5NYXgpIHsKICAgICAgcGF0aCB8fD0gZGF0YVswXSA9IG5ldyBQYXRoMkQoKTsKICAgICAgdGhpc1tvcF0ocGF0aCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghKHBhdGggaW5zdGFuY2VvZiBQYXRoMkQpKSB7CiAgICAgIGNvbnN0IHBhdGgyZCA9IGRhdGFbMF0gPSBuZXcgUGF0aDJEKCk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHBhdGgubGVuZ3RoOyBpIDwgaWk7KSB7CiAgICAgICAgc3dpdGNoIChwYXRoW2krK10pIHsKICAgICAgICAgIGNhc2UgRHJhd09QUy5tb3ZlVG86CiAgICAgICAgICAgIHBhdGgyZC5tb3ZlVG8ocGF0aFtpKytdLCBwYXRoW2krK10pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgRHJhd09QUy5saW5lVG86CiAgICAgICAgICAgIHBhdGgyZC5saW5lVG8ocGF0aFtpKytdLCBwYXRoW2krK10pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgRHJhd09QUy5jdXJ2ZVRvOgogICAgICAgICAgICBwYXRoMmQuYmV6aWVyQ3VydmVUbyhwYXRoW2krK10sIHBhdGhbaSsrXSwgcGF0aFtpKytdLCBwYXRoW2krK10sIHBhdGhbaSsrXSwgcGF0aFtpKytdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIERyYXdPUFMuY2xvc2VQYXRoOgogICAgICAgICAgICBwYXRoMmQuY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgd2FybihgVW5yZWNvZ25pemVkIGRyYXdpbmcgcGF0aCBvcGVyYXRvcjogJHtwYXRoW2kgLSAxXX1gKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHBhdGggPSBwYXRoMmQ7CiAgICB9CiAgICBVdGlsLmF4aWFsQWxpZ25lZEJvdW5kaW5nQm94KG1pbk1heCwgZ2V0Q3VycmVudFRyYW5zZm9ybSh0aGlzLmN0eCksIHRoaXMuY3VycmVudC5taW5NYXgpOwogICAgdGhpc1tvcF0ocGF0aCk7CiAgfQogIGNsb3NlUGF0aCgpIHsKICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpOwogIH0KICBzdHJva2UocGF0aCwgY29uc3VtZVBhdGggPSB0cnVlKSB7CiAgICBjb25zdCBjdHggPSB0aGlzLmN0eDsKICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gdGhpcy5jdXJyZW50LnN0cm9rZUNvbG9yOwogICAgY3R4Lmdsb2JhbEFscGhhID0gdGhpcy5jdXJyZW50LnN0cm9rZUFscGhhOwogICAgaWYgKHRoaXMuY29udGVudFZpc2libGUpIHsKICAgICAgaWYgKHR5cGVvZiBzdHJva2VDb2xvciA9PT0gIm9iamVjdCIgJiYgc3Ryb2tlQ29sb3I/LmdldFBhdHRlcm4pIHsKICAgICAgICBjb25zdCBiYXNlVHJhbnNmb3JtID0gc3Ryb2tlQ29sb3IuaXNNb2RpZnlpbmdDdXJyZW50VHJhbnNmb3JtKCkgPyBjdHguZ2V0VHJhbnNmb3JtKCkgOiBudWxsOwogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gc3Ryb2tlQ29sb3IuZ2V0UGF0dGVybihjdHgsIHRoaXMsIGdldEN1cnJlbnRUcmFuc2Zvcm1JbnZlcnNlKGN0eCksIFBhdGhUeXBlLlNUUk9LRSk7CiAgICAgICAgaWYgKGJhc2VUcmFuc2Zvcm0pIHsKICAgICAgICAgIGNvbnN0IG5ld1BhdGggPSBuZXcgUGF0aDJEKCk7CiAgICAgICAgICBuZXdQYXRoLmFkZFBhdGgocGF0aCwgY3R4LmdldFRyYW5zZm9ybSgpLmludmVydFNlbGYoKS5tdWx0aXBseVNlbGYoYmFzZVRyYW5zZm9ybSkpOwogICAgICAgICAgcGF0aCA9IG5ld1BhdGg7CiAgICAgICAgfQogICAgICAgIHRoaXMucmVzY2FsZUFuZFN0cm9rZShwYXRoLCBmYWxzZSk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJlc2NhbGVBbmRTdHJva2UocGF0aCwgdHJ1ZSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChjb25zdW1lUGF0aCkgewogICAgICB0aGlzLmNvbnN1bWVQYXRoKHBhdGgsIHRoaXMuY3VycmVudC5nZXRDbGlwcGVkUGF0aEJvdW5kaW5nQm94KFBhdGhUeXBlLlNUUk9LRSwgZ2V0Q3VycmVudFRyYW5zZm9ybSh0aGlzLmN0eCkpKTsKICAgIH0KICAgIGN0eC5nbG9iYWxBbHBoYSA9IHRoaXMuY3VycmVudC5maWxsQWxwaGE7CiAgfQogIGNsb3NlU3Ryb2tlKHBhdGgpIHsKICAgIHRoaXMuc3Ryb2tlKHBhdGgpOwogIH0KICBmaWxsKHBhdGgsIGNvbnN1bWVQYXRoID0gdHJ1ZSkgewogICAgY29uc3QgY3R4ID0gdGhpcy5jdHg7CiAgICBjb25zdCBmaWxsQ29sb3IgPSB0aGlzLmN1cnJlbnQuZmlsbENvbG9yOwogICAgY29uc3QgaXNQYXR0ZXJuRmlsbCA9IHRoaXMuY3VycmVudC5wYXR0ZXJuRmlsbDsKICAgIGxldCBuZWVkUmVzdG9yZSA9IGZhbHNlOwogICAgaWYgKGlzUGF0dGVybkZpbGwpIHsKICAgICAgY29uc3QgYmFzZVRyYW5zZm9ybSA9IGZpbGxDb2xvci5pc01vZGlmeWluZ0N1cnJlbnRUcmFuc2Zvcm0oKSA/IGN0eC5nZXRUcmFuc2Zvcm0oKSA6IG51bGw7CiAgICAgIGN0eC5zYXZlKCk7CiAgICAgIGN0eC5maWxsU3R5bGUgPSBmaWxsQ29sb3IuZ2V0UGF0dGVybihjdHgsIHRoaXMsIGdldEN1cnJlbnRUcmFuc2Zvcm1JbnZlcnNlKGN0eCksIFBhdGhUeXBlLkZJTEwpOwogICAgICBpZiAoYmFzZVRyYW5zZm9ybSkgewogICAgICAgIGNvbnN0IG5ld1BhdGggPSBuZXcgUGF0aDJEKCk7CiAgICAgICAgbmV3UGF0aC5hZGRQYXRoKHBhdGgsIGN0eC5nZXRUcmFuc2Zvcm0oKS5pbnZlcnRTZWxmKCkubXVsdGlwbHlTZWxmKGJhc2VUcmFuc2Zvcm0pKTsKICAgICAgICBwYXRoID0gbmV3UGF0aDsKICAgICAgfQogICAgICBuZWVkUmVzdG9yZSA9IHRydWU7CiAgICB9CiAgICBjb25zdCBpbnRlcnNlY3QgPSB0aGlzLmN1cnJlbnQuZ2V0Q2xpcHBlZFBhdGhCb3VuZGluZ0JveCgpOwogICAgaWYgKHRoaXMuY29udGVudFZpc2libGUgJiYgaW50ZXJzZWN0ICE9PSBudWxsKSB7CiAgICAgIGlmICh0aGlzLnBlbmRpbmdFT0ZpbGwpIHsKICAgICAgICBjdHguZmlsbChwYXRoLCAiZXZlbm9kZCIpOwogICAgICAgIHRoaXMucGVuZGluZ0VPRmlsbCA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIGN0eC5maWxsKHBhdGgpOwogICAgICB9CiAgICB9CiAgICBpZiAobmVlZFJlc3RvcmUpIHsKICAgICAgY3R4LnJlc3RvcmUoKTsKICAgIH0KICAgIGlmIChjb25zdW1lUGF0aCkgewogICAgICB0aGlzLmNvbnN1bWVQYXRoKHBhdGgsIGludGVyc2VjdCk7CiAgICB9CiAgfQogIGVvRmlsbChwYXRoKSB7CiAgICB0aGlzLnBlbmRpbmdFT0ZpbGwgPSB0cnVlOwogICAgdGhpcy5maWxsKHBhdGgpOwogIH0KICBmaWxsU3Ryb2tlKHBhdGgpIHsKICAgIHRoaXMuZmlsbChwYXRoLCBmYWxzZSk7CiAgICB0aGlzLnN0cm9rZShwYXRoLCBmYWxzZSk7CiAgICB0aGlzLmNvbnN1bWVQYXRoKHBhdGgpOwogIH0KICBlb0ZpbGxTdHJva2UocGF0aCkgewogICAgdGhpcy5wZW5kaW5nRU9GaWxsID0gdHJ1ZTsKICAgIHRoaXMuZmlsbFN0cm9rZShwYXRoKTsKICB9CiAgY2xvc2VGaWxsU3Ryb2tlKHBhdGgpIHsKICAgIHRoaXMuZmlsbFN0cm9rZShwYXRoKTsKICB9CiAgY2xvc2VFT0ZpbGxTdHJva2UocGF0aCkgewogICAgdGhpcy5wZW5kaW5nRU9GaWxsID0gdHJ1ZTsKICAgIHRoaXMuZmlsbFN0cm9rZShwYXRoKTsKICB9CiAgZW5kUGF0aChwYXRoKSB7CiAgICB0aGlzLmNvbnN1bWVQYXRoKHBhdGgpOwogIH0KICByYXdGaWxsUGF0aChwYXRoKSB7CiAgICB0aGlzLmN0eC5maWxsKHBhdGgpOwogIH0KICBjbGlwKCkgewogICAgdGhpcy5wZW5kaW5nQ2xpcCA9IE5PUk1BTF9DTElQOwogIH0KICBlb0NsaXAoKSB7CiAgICB0aGlzLnBlbmRpbmdDbGlwID0gRU9fQ0xJUDsKICB9CiAgYmVnaW5UZXh0KCkgewogICAgdGhpcy5jdXJyZW50LnRleHRNYXRyaXggPSBudWxsOwogICAgdGhpcy5jdXJyZW50LnRleHRNYXRyaXhTY2FsZSA9IDE7CiAgICB0aGlzLmN1cnJlbnQueCA9IHRoaXMuY3VycmVudC5saW5lWCA9IDA7CiAgICB0aGlzLmN1cnJlbnQueSA9IHRoaXMuY3VycmVudC5saW5lWSA9IDA7CiAgfQogIGVuZFRleHQoKSB7CiAgICBjb25zdCBwYXRocyA9IHRoaXMucGVuZGluZ1RleHRQYXRoczsKICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4OwogICAgaWYgKHBhdGhzID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbmV3UGF0aCA9IG5ldyBQYXRoMkQoKTsKICAgIGNvbnN0IGludlRyYW5zZiA9IGN0eC5nZXRUcmFuc2Zvcm0oKS5pbnZlcnRTZWxmKCk7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgdHJhbnNmb3JtLAogICAgICB4LAogICAgICB5LAogICAgICBmb250U2l6ZSwKICAgICAgcGF0aAogICAgfSBvZiBwYXRocykgewogICAgICBuZXdQYXRoLmFkZFBhdGgocGF0aCwgbmV3IERPTU1hdHJpeCh0cmFuc2Zvcm0pLnByZU11bHRpcGx5U2VsZihpbnZUcmFuc2YpLnRyYW5zbGF0ZSh4LCB5KS5zY2FsZShmb250U2l6ZSwgLWZvbnRTaXplKSk7CiAgICB9CiAgICBjdHguY2xpcChuZXdQYXRoKTsKICAgIGRlbGV0ZSB0aGlzLnBlbmRpbmdUZXh0UGF0aHM7CiAgfQogIHNldENoYXJTcGFjaW5nKHNwYWNpbmcpIHsKICAgIHRoaXMuY3VycmVudC5jaGFyU3BhY2luZyA9IHNwYWNpbmc7CiAgfQogIHNldFdvcmRTcGFjaW5nKHNwYWNpbmcpIHsKICAgIHRoaXMuY3VycmVudC53b3JkU3BhY2luZyA9IHNwYWNpbmc7CiAgfQogIHNldEhTY2FsZShzY2FsZSkgewogICAgdGhpcy5jdXJyZW50LnRleHRIU2NhbGUgPSBzY2FsZSAvIDEwMDsKICB9CiAgc2V0TGVhZGluZyhsZWFkaW5nKSB7CiAgICB0aGlzLmN1cnJlbnQubGVhZGluZyA9IC1sZWFkaW5nOwogIH0KICBzZXRGb250KGZvbnRSZWZOYW1lLCBzaXplKSB7CiAgICBjb25zdCBmb250T2JqID0gdGhpcy5jb21tb25PYmpzLmdldChmb250UmVmTmFtZSk7CiAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgaWYgKCFmb250T2JqKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgZmluZCBmb250IGZvciAke2ZvbnRSZWZOYW1lfWApOwogICAgfQogICAgY3VycmVudC5mb250TWF0cml4ID0gZm9udE9iai5mb250TWF0cml4IHx8IEZPTlRfSURFTlRJVFlfTUFUUklYOwogICAgaWYgKGN1cnJlbnQuZm9udE1hdHJpeFswXSA9PT0gMCB8fCBjdXJyZW50LmZvbnRNYXRyaXhbM10gPT09IDApIHsKICAgICAgd2FybigiSW52YWxpZCBmb250IG1hdHJpeCBmb3IgZm9udCAiICsgZm9udFJlZk5hbWUpOwogICAgfQogICAgaWYgKHNpemUgPCAwKSB7CiAgICAgIHNpemUgPSAtc2l6ZTsKICAgICAgY3VycmVudC5mb250RGlyZWN0aW9uID0gLTE7CiAgICB9IGVsc2UgewogICAgICBjdXJyZW50LmZvbnREaXJlY3Rpb24gPSAxOwogICAgfQogICAgdGhpcy5jdXJyZW50LmZvbnQgPSBmb250T2JqOwogICAgdGhpcy5jdXJyZW50LmZvbnRTaXplID0gc2l6ZTsKICAgIGlmIChmb250T2JqLmlzVHlwZTNGb250KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG5hbWUgPSBmb250T2JqLmxvYWRlZE5hbWUgfHwgInNhbnMtc2VyaWYiOwogICAgY29uc3QgdHlwZWZhY2UgPSBmb250T2JqLnN5c3RlbUZvbnRJbmZvPy5jc3MgfHwgYCIke25hbWV9IiwgJHtmb250T2JqLmZhbGxiYWNrTmFtZX1gOwogICAgbGV0IGJvbGQgPSAibm9ybWFsIjsKICAgIGlmIChmb250T2JqLmJsYWNrKSB7CiAgICAgIGJvbGQgPSAiOTAwIjsKICAgIH0gZWxzZSBpZiAoZm9udE9iai5ib2xkKSB7CiAgICAgIGJvbGQgPSAiYm9sZCI7CiAgICB9CiAgICBjb25zdCBpdGFsaWMgPSBmb250T2JqLml0YWxpYyA/ICJpdGFsaWMiIDogIm5vcm1hbCI7CiAgICBsZXQgYnJvd3NlckZvbnRTaXplID0gc2l6ZTsKICAgIGlmIChzaXplIDwgTUlOX0ZPTlRfU0laRSkgewogICAgICBicm93c2VyRm9udFNpemUgPSBNSU5fRk9OVF9TSVpFOwogICAgfSBlbHNlIGlmIChzaXplID4gTUFYX0ZPTlRfU0laRSkgewogICAgICBicm93c2VyRm9udFNpemUgPSBNQVhfRk9OVF9TSVpFOwogICAgfQogICAgdGhpcy5jdXJyZW50LmZvbnRTaXplU2NhbGUgPSBzaXplIC8gYnJvd3NlckZvbnRTaXplOwogICAgdGhpcy5jdHguZm9udCA9IGAke2l0YWxpY30gJHtib2xkfSAke2Jyb3dzZXJGb250U2l6ZX1weCAke3R5cGVmYWNlfWA7CiAgfQogIHNldFRleHRSZW5kZXJpbmdNb2RlKG1vZGUpIHsKICAgIHRoaXMuY3VycmVudC50ZXh0UmVuZGVyaW5nTW9kZSA9IG1vZGU7CiAgfQogIHNldFRleHRSaXNlKHJpc2UpIHsKICAgIHRoaXMuY3VycmVudC50ZXh0UmlzZSA9IHJpc2U7CiAgfQogIG1vdmVUZXh0KHgsIHkpIHsKICAgIHRoaXMuY3VycmVudC54ID0gdGhpcy5jdXJyZW50LmxpbmVYICs9IHg7CiAgICB0aGlzLmN1cnJlbnQueSA9IHRoaXMuY3VycmVudC5saW5lWSArPSB5OwogIH0KICBzZXRMZWFkaW5nTW92ZVRleHQoeCwgeSkgewogICAgdGhpcy5zZXRMZWFkaW5nKC15KTsKICAgIHRoaXMubW92ZVRleHQoeCwgeSk7CiAgfQogIHNldFRleHRNYXRyaXgobWF0cml4KSB7CiAgICBjb25zdCB7CiAgICAgIGN1cnJlbnQKICAgIH0gPSB0aGlzOwogICAgY3VycmVudC50ZXh0TWF0cml4ID0gbWF0cml4OwogICAgY3VycmVudC50ZXh0TWF0cml4U2NhbGUgPSBNYXRoLmh5cG90KG1hdHJpeFswXSwgbWF0cml4WzFdKTsKICAgIGN1cnJlbnQueCA9IGN1cnJlbnQubGluZVggPSAwOwogICAgY3VycmVudC55ID0gY3VycmVudC5saW5lWSA9IDA7CiAgfQogIG5leHRMaW5lKCkgewogICAgdGhpcy5tb3ZlVGV4dCgwLCB0aGlzLmN1cnJlbnQubGVhZGluZyk7CiAgfQogICNnZXRTY2FsZWRQYXRoKHBhdGgsIGN1cnJlbnRUcmFuc2Zvcm0sIHRyYW5zZm9ybSkgewogICAgY29uc3QgbmV3UGF0aCA9IG5ldyBQYXRoMkQoKTsKICAgIG5ld1BhdGguYWRkUGF0aChwYXRoLCBuZXcgRE9NTWF0cml4KHRyYW5zZm9ybSkuaW52ZXJ0U2VsZigpLm11bHRpcGx5U2VsZihjdXJyZW50VHJhbnNmb3JtKSk7CiAgICByZXR1cm4gbmV3UGF0aDsKICB9CiAgcGFpbnRDaGFyKGNoYXJhY3RlciwgeCwgeSwgcGF0dGVybkZpbGxUcmFuc2Zvcm0sIHBhdHRlcm5TdHJva2VUcmFuc2Zvcm0pIHsKICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4OwogICAgY29uc3QgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICAgIGNvbnN0IGZvbnQgPSBjdXJyZW50LmZvbnQ7CiAgICBjb25zdCB0ZXh0UmVuZGVyaW5nTW9kZSA9IGN1cnJlbnQudGV4dFJlbmRlcmluZ01vZGU7CiAgICBjb25zdCBmb250U2l6ZSA9IGN1cnJlbnQuZm9udFNpemUgLyBjdXJyZW50LmZvbnRTaXplU2NhbGU7CiAgICBjb25zdCBmaWxsU3Ryb2tlTW9kZSA9IHRleHRSZW5kZXJpbmdNb2RlICYgVGV4dFJlbmRlcmluZ01vZGUuRklMTF9TVFJPS0VfTUFTSzsKICAgIGNvbnN0IGlzQWRkVG9QYXRoU2V0ID0gISEodGV4dFJlbmRlcmluZ01vZGUgJiBUZXh0UmVuZGVyaW5nTW9kZS5BRERfVE9fUEFUSF9GTEFHKTsKICAgIGNvbnN0IHBhdHRlcm5GaWxsID0gY3VycmVudC5wYXR0ZXJuRmlsbCAmJiAhZm9udC5taXNzaW5nRmlsZTsKICAgIGNvbnN0IHBhdHRlcm5TdHJva2UgPSBjdXJyZW50LnBhdHRlcm5TdHJva2UgJiYgIWZvbnQubWlzc2luZ0ZpbGU7CiAgICBsZXQgcGF0aDsKICAgIGlmIChmb250LmRpc2FibGVGb250RmFjZSB8fCBpc0FkZFRvUGF0aFNldCB8fCBwYXR0ZXJuRmlsbCB8fCBwYXR0ZXJuU3Ryb2tlKSB7CiAgICAgIHBhdGggPSBmb250LmdldFBhdGhHZW5lcmF0b3IodGhpcy5jb21tb25PYmpzLCBjaGFyYWN0ZXIpOwogICAgfQogICAgaWYgKGZvbnQuZGlzYWJsZUZvbnRGYWNlIHx8IHBhdHRlcm5GaWxsIHx8IHBhdHRlcm5TdHJva2UpIHsKICAgICAgY3R4LnNhdmUoKTsKICAgICAgY3R4LnRyYW5zbGF0ZSh4LCB5KTsKICAgICAgY3R4LnNjYWxlKGZvbnRTaXplLCAtZm9udFNpemUpOwogICAgICBsZXQgY3VycmVudFRyYW5zZm9ybTsKICAgICAgaWYgKGZpbGxTdHJva2VNb2RlID09PSBUZXh0UmVuZGVyaW5nTW9kZS5GSUxMIHx8IGZpbGxTdHJva2VNb2RlID09PSBUZXh0UmVuZGVyaW5nTW9kZS5GSUxMX1NUUk9LRSkgewogICAgICAgIGlmIChwYXR0ZXJuRmlsbFRyYW5zZm9ybSkgewogICAgICAgICAgY3VycmVudFRyYW5zZm9ybSA9IGN0eC5nZXRUcmFuc2Zvcm0oKTsKICAgICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0oLi4ucGF0dGVybkZpbGxUcmFuc2Zvcm0pOwogICAgICAgICAgY3R4LmZpbGwodGhpcy4jZ2V0U2NhbGVkUGF0aChwYXRoLCBjdXJyZW50VHJhbnNmb3JtLCBwYXR0ZXJuRmlsbFRyYW5zZm9ybSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdHguZmlsbChwYXRoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGZpbGxTdHJva2VNb2RlID09PSBUZXh0UmVuZGVyaW5nTW9kZS5TVFJPS0UgfHwgZmlsbFN0cm9rZU1vZGUgPT09IFRleHRSZW5kZXJpbmdNb2RlLkZJTExfU1RST0tFKSB7CiAgICAgICAgaWYgKHBhdHRlcm5TdHJva2VUcmFuc2Zvcm0pIHsKICAgICAgICAgIGN1cnJlbnRUcmFuc2Zvcm0gfHw9IGN0eC5nZXRUcmFuc2Zvcm0oKTsKICAgICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0oLi4ucGF0dGVyblN0cm9rZVRyYW5zZm9ybSk7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIGIsCiAgICAgICAgICAgIGMsCiAgICAgICAgICAgIGQKICAgICAgICAgIH0gPSBjdXJyZW50VHJhbnNmb3JtOwogICAgICAgICAgY29uc3QgaW52UGF0dGVyblRyYW5zZm9ybSA9IFV0aWwuaW52ZXJzZVRyYW5zZm9ybShwYXR0ZXJuU3Ryb2tlVHJhbnNmb3JtKTsKICAgICAgICAgIGNvbnN0IHRyYW5zZiA9IFV0aWwudHJhbnNmb3JtKFthLCBiLCBjLCBkLCAwLCAwXSwgaW52UGF0dGVyblRyYW5zZm9ybSk7CiAgICAgICAgICBVdGlsLnNpbmd1bGFyVmFsdWVEZWNvbXBvc2UyZFNjYWxlKHRyYW5zZiwgWFkpOwogICAgICAgICAgY3R4LmxpbmVXaWR0aCAqPSBNYXRoLm1heChYWVswXSwgWFlbMV0pIC8gZm9udFNpemU7CiAgICAgICAgICBjdHguc3Ryb2tlKHRoaXMuI2dldFNjYWxlZFBhdGgocGF0aCwgY3VycmVudFRyYW5zZm9ybSwgcGF0dGVyblN0cm9rZVRyYW5zZm9ybSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdHgubGluZVdpZHRoIC89IGZvbnRTaXplOwogICAgICAgICAgY3R4LnN0cm9rZShwYXRoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY3R4LnJlc3RvcmUoKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChmaWxsU3Ryb2tlTW9kZSA9PT0gVGV4dFJlbmRlcmluZ01vZGUuRklMTCB8fCBmaWxsU3Ryb2tlTW9kZSA9PT0gVGV4dFJlbmRlcmluZ01vZGUuRklMTF9TVFJPS0UpIHsKICAgICAgICBjdHguZmlsbFRleHQoY2hhcmFjdGVyLCB4LCB5KTsKICAgICAgfQogICAgICBpZiAoZmlsbFN0cm9rZU1vZGUgPT09IFRleHRSZW5kZXJpbmdNb2RlLlNUUk9LRSB8fCBmaWxsU3Ryb2tlTW9kZSA9PT0gVGV4dFJlbmRlcmluZ01vZGUuRklMTF9TVFJPS0UpIHsKICAgICAgICBjdHguc3Ryb2tlVGV4dChjaGFyYWN0ZXIsIHgsIHkpOwogICAgICB9CiAgICB9CiAgICBpZiAoaXNBZGRUb1BhdGhTZXQpIHsKICAgICAgY29uc3QgcGF0aHMgPSB0aGlzLnBlbmRpbmdUZXh0UGF0aHMgfHw9IFtdOwogICAgICBwYXRocy5wdXNoKHsKICAgICAgICB0cmFuc2Zvcm06IGdldEN1cnJlbnRUcmFuc2Zvcm0oY3R4KSwKICAgICAgICB4LAogICAgICAgIHksCiAgICAgICAgZm9udFNpemUsCiAgICAgICAgcGF0aAogICAgICB9KTsKICAgIH0KICB9CiAgZ2V0IGlzRm9udFN1YnBpeGVsQUFFbmFibGVkKCkgewogICAgY29uc3QgewogICAgICBjb250ZXh0OiBjdHgKICAgIH0gPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcygiaXNGb250U3VicGl4ZWxBQUVuYWJsZWQiLCAxMCwgMTApOwogICAgY3R4LnNjYWxlKDEuNSwgMSk7CiAgICBjdHguZmlsbFRleHQoIkkiLCAwLCAxMCk7CiAgICBjb25zdCBkYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCAxMCwgMTApLmRhdGE7CiAgICBsZXQgZW5hYmxlZCA9IGZhbHNlOwogICAgZm9yIChsZXQgaSA9IDM7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7CiAgICAgIGlmIChkYXRhW2ldID4gMCAmJiBkYXRhW2ldIDwgMjU1KSB7CiAgICAgICAgZW5hYmxlZCA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImlzRm9udFN1YnBpeGVsQUFFbmFibGVkIiwgZW5hYmxlZCk7CiAgfQogIHNob3dUZXh0KGdseXBocykgewogICAgY29uc3QgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICAgIGNvbnN0IGZvbnQgPSBjdXJyZW50LmZvbnQ7CiAgICBpZiAoZm9udC5pc1R5cGUzRm9udCkgewogICAgICByZXR1cm4gdGhpcy5zaG93VHlwZTNUZXh0KGdseXBocyk7CiAgICB9CiAgICBjb25zdCBmb250U2l6ZSA9IGN1cnJlbnQuZm9udFNpemU7CiAgICBpZiAoZm9udFNpemUgPT09IDApIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4OwogICAgY29uc3QgZm9udFNpemVTY2FsZSA9IGN1cnJlbnQuZm9udFNpemVTY2FsZTsKICAgIGNvbnN0IGNoYXJTcGFjaW5nID0gY3VycmVudC5jaGFyU3BhY2luZzsKICAgIGNvbnN0IHdvcmRTcGFjaW5nID0gY3VycmVudC53b3JkU3BhY2luZzsKICAgIGNvbnN0IGZvbnREaXJlY3Rpb24gPSBjdXJyZW50LmZvbnREaXJlY3Rpb247CiAgICBjb25zdCB0ZXh0SFNjYWxlID0gY3VycmVudC50ZXh0SFNjYWxlICogZm9udERpcmVjdGlvbjsKICAgIGNvbnN0IGdseXBoc0xlbmd0aCA9IGdseXBocy5sZW5ndGg7CiAgICBjb25zdCB2ZXJ0aWNhbCA9IGZvbnQudmVydGljYWw7CiAgICBjb25zdCBzcGFjaW5nRGlyID0gdmVydGljYWwgPyAxIDogLTE7CiAgICBjb25zdCBkZWZhdWx0Vk1ldHJpY3MgPSBmb250LmRlZmF1bHRWTWV0cmljczsKICAgIGNvbnN0IHdpZHRoQWR2YW5jZVNjYWxlID0gZm9udFNpemUgKiBjdXJyZW50LmZvbnRNYXRyaXhbMF07CiAgICBjb25zdCBzaW1wbGVGaWxsVGV4dCA9IGN1cnJlbnQudGV4dFJlbmRlcmluZ01vZGUgPT09IFRleHRSZW5kZXJpbmdNb2RlLkZJTEwgJiYgIWZvbnQuZGlzYWJsZUZvbnRGYWNlICYmICFjdXJyZW50LnBhdHRlcm5GaWxsOwogICAgY3R4LnNhdmUoKTsKICAgIGlmIChjdXJyZW50LnRleHRNYXRyaXgpIHsKICAgICAgY3R4LnRyYW5zZm9ybSguLi5jdXJyZW50LnRleHRNYXRyaXgpOwogICAgfQogICAgY3R4LnRyYW5zbGF0ZShjdXJyZW50LngsIGN1cnJlbnQueSArIGN1cnJlbnQudGV4dFJpc2UpOwogICAgaWYgKGZvbnREaXJlY3Rpb24gPiAwKSB7CiAgICAgIGN0eC5zY2FsZSh0ZXh0SFNjYWxlLCAtMSk7CiAgICB9IGVsc2UgewogICAgICBjdHguc2NhbGUodGV4dEhTY2FsZSwgMSk7CiAgICB9CiAgICBsZXQgcGF0dGVybkZpbGxUcmFuc2Zvcm0sIHBhdHRlcm5TdHJva2VUcmFuc2Zvcm07CiAgICBpZiAoY3VycmVudC5wYXR0ZXJuRmlsbCkgewogICAgICBjdHguc2F2ZSgpOwogICAgICBjb25zdCBwYXR0ZXJuID0gY3VycmVudC5maWxsQ29sb3IuZ2V0UGF0dGVybihjdHgsIHRoaXMsIGdldEN1cnJlbnRUcmFuc2Zvcm1JbnZlcnNlKGN0eCksIFBhdGhUeXBlLkZJTEwpOwogICAgICBwYXR0ZXJuRmlsbFRyYW5zZm9ybSA9IGdldEN1cnJlbnRUcmFuc2Zvcm0oY3R4KTsKICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgY3R4LmZpbGxTdHlsZSA9IHBhdHRlcm47CiAgICB9CiAgICBpZiAoY3VycmVudC5wYXR0ZXJuU3Ryb2tlKSB7CiAgICAgIGN0eC5zYXZlKCk7CiAgICAgIGNvbnN0IHBhdHRlcm4gPSBjdXJyZW50LnN0cm9rZUNvbG9yLmdldFBhdHRlcm4oY3R4LCB0aGlzLCBnZXRDdXJyZW50VHJhbnNmb3JtSW52ZXJzZShjdHgpLCBQYXRoVHlwZS5TVFJPS0UpOwogICAgICBwYXR0ZXJuU3Ryb2tlVHJhbnNmb3JtID0gZ2V0Q3VycmVudFRyYW5zZm9ybShjdHgpOwogICAgICBjdHgucmVzdG9yZSgpOwogICAgICBjdHguc3Ryb2tlU3R5bGUgPSBwYXR0ZXJuOwogICAgfQogICAgbGV0IGxpbmVXaWR0aCA9IGN1cnJlbnQubGluZVdpZHRoOwogICAgY29uc3Qgc2NhbGUgPSBjdXJyZW50LnRleHRNYXRyaXhTY2FsZTsKICAgIGlmIChzY2FsZSA9PT0gMCB8fCBsaW5lV2lkdGggPT09IDApIHsKICAgICAgY29uc3QgZmlsbFN0cm9rZU1vZGUgPSBjdXJyZW50LnRleHRSZW5kZXJpbmdNb2RlICYgVGV4dFJlbmRlcmluZ01vZGUuRklMTF9TVFJPS0VfTUFTSzsKICAgICAgaWYgKGZpbGxTdHJva2VNb2RlID09PSBUZXh0UmVuZGVyaW5nTW9kZS5TVFJPS0UgfHwgZmlsbFN0cm9rZU1vZGUgPT09IFRleHRSZW5kZXJpbmdNb2RlLkZJTExfU1RST0tFKSB7CiAgICAgICAgbGluZVdpZHRoID0gdGhpcy5nZXRTaW5nbGVQaXhlbFdpZHRoKCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxpbmVXaWR0aCAvPSBzY2FsZTsKICAgIH0KICAgIGlmIChmb250U2l6ZVNjYWxlICE9PSAxLjApIHsKICAgICAgY3R4LnNjYWxlKGZvbnRTaXplU2NhbGUsIGZvbnRTaXplU2NhbGUpOwogICAgICBsaW5lV2lkdGggLz0gZm9udFNpemVTY2FsZTsKICAgIH0KICAgIGN0eC5saW5lV2lkdGggPSBsaW5lV2lkdGg7CiAgICBpZiAoZm9udC5pc0ludmFsaWRQREZqc0ZvbnQpIHsKICAgICAgY29uc3QgY2hhcnMgPSBbXTsKICAgICAgbGV0IHdpZHRoID0gMDsKICAgICAgZm9yIChjb25zdCBnbHlwaCBvZiBnbHlwaHMpIHsKICAgICAgICBjaGFycy5wdXNoKGdseXBoLnVuaWNvZGUpOwogICAgICAgIHdpZHRoICs9IGdseXBoLndpZHRoOwogICAgICB9CiAgICAgIGN0eC5maWxsVGV4dChjaGFycy5qb2luKCIiKSwgMCwgMCk7CiAgICAgIGN1cnJlbnQueCArPSB3aWR0aCAqIHdpZHRoQWR2YW5jZVNjYWxlICogdGV4dEhTY2FsZTsKICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgdGhpcy5jb21wb3NlKCk7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBsZXQgeCA9IDAsCiAgICAgIGk7CiAgICBmb3IgKGkgPSAwOyBpIDwgZ2x5cGhzTGVuZ3RoOyArK2kpIHsKICAgICAgY29uc3QgZ2x5cGggPSBnbHlwaHNbaV07CiAgICAgIGlmICh0eXBlb2YgZ2x5cGggPT09ICJudW1iZXIiKSB7CiAgICAgICAgeCArPSBzcGFjaW5nRGlyICogZ2x5cGggKiBmb250U2l6ZSAvIDEwMDA7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IHJlc3RvcmVOZWVkZWQgPSBmYWxzZTsKICAgICAgY29uc3Qgc3BhY2luZyA9IChnbHlwaC5pc1NwYWNlID8gd29yZFNwYWNpbmcgOiAwKSArIGNoYXJTcGFjaW5nOwogICAgICBjb25zdCBjaGFyYWN0ZXIgPSBnbHlwaC5mb250Q2hhcjsKICAgICAgY29uc3QgYWNjZW50ID0gZ2x5cGguYWNjZW50OwogICAgICBsZXQgc2NhbGVkWCwgc2NhbGVkWTsKICAgICAgbGV0IHdpZHRoID0gZ2x5cGgud2lkdGg7CiAgICAgIGlmICh2ZXJ0aWNhbCkgewogICAgICAgIGNvbnN0IHZtZXRyaWMgPSBnbHlwaC52bWV0cmljIHx8IGRlZmF1bHRWTWV0cmljczsKICAgICAgICBjb25zdCB2eCA9IC0oZ2x5cGgudm1ldHJpYyA/IHZtZXRyaWNbMV0gOiB3aWR0aCAqIDAuNSkgKiB3aWR0aEFkdmFuY2VTY2FsZTsKICAgICAgICBjb25zdCB2eSA9IHZtZXRyaWNbMl0gKiB3aWR0aEFkdmFuY2VTY2FsZTsKICAgICAgICB3aWR0aCA9IHZtZXRyaWMgPyAtdm1ldHJpY1swXSA6IHdpZHRoOwogICAgICAgIHNjYWxlZFggPSB2eCAvIGZvbnRTaXplU2NhbGU7CiAgICAgICAgc2NhbGVkWSA9ICh4ICsgdnkpIC8gZm9udFNpemVTY2FsZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzY2FsZWRYID0geCAvIGZvbnRTaXplU2NhbGU7CiAgICAgICAgc2NhbGVkWSA9IDA7CiAgICAgIH0KICAgICAgaWYgKGZvbnQucmVtZWFzdXJlICYmIHdpZHRoID4gMCkgewogICAgICAgIGNvbnN0IG1lYXN1cmVkV2lkdGggPSBjdHgubWVhc3VyZVRleHQoY2hhcmFjdGVyKS53aWR0aCAqIDEwMDAgLyBmb250U2l6ZSAqIGZvbnRTaXplU2NhbGU7CiAgICAgICAgaWYgKHdpZHRoIDwgbWVhc3VyZWRXaWR0aCAmJiB0aGlzLmlzRm9udFN1YnBpeGVsQUFFbmFibGVkKSB7CiAgICAgICAgICBjb25zdCBjaGFyYWN0ZXJTY2FsZVggPSB3aWR0aCAvIG1lYXN1cmVkV2lkdGg7CiAgICAgICAgICByZXN0b3JlTmVlZGVkID0gdHJ1ZTsKICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICBjdHguc2NhbGUoY2hhcmFjdGVyU2NhbGVYLCAxKTsKICAgICAgICAgIHNjYWxlZFggLz0gY2hhcmFjdGVyU2NhbGVYOwogICAgICAgIH0gZWxzZSBpZiAod2lkdGggIT09IG1lYXN1cmVkV2lkdGgpIHsKICAgICAgICAgIHNjYWxlZFggKz0gKHdpZHRoIC0gbWVhc3VyZWRXaWR0aCkgLyAyMDAwICogZm9udFNpemUgLyBmb250U2l6ZVNjYWxlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodGhpcy5jb250ZW50VmlzaWJsZSAmJiAoZ2x5cGguaXNJbkZvbnQgfHwgZm9udC5taXNzaW5nRmlsZSkpIHsKICAgICAgICBpZiAoc2ltcGxlRmlsbFRleHQgJiYgIWFjY2VudCkgewogICAgICAgICAgY3R4LmZpbGxUZXh0KGNoYXJhY3Rlciwgc2NhbGVkWCwgc2NhbGVkWSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMucGFpbnRDaGFyKGNoYXJhY3Rlciwgc2NhbGVkWCwgc2NhbGVkWSwgcGF0dGVybkZpbGxUcmFuc2Zvcm0sIHBhdHRlcm5TdHJva2VUcmFuc2Zvcm0pOwogICAgICAgICAgaWYgKGFjY2VudCkgewogICAgICAgICAgICBjb25zdCBzY2FsZWRBY2NlbnRYID0gc2NhbGVkWCArIGZvbnRTaXplICogYWNjZW50Lm9mZnNldC54IC8gZm9udFNpemVTY2FsZTsKICAgICAgICAgICAgY29uc3Qgc2NhbGVkQWNjZW50WSA9IHNjYWxlZFkgLSBmb250U2l6ZSAqIGFjY2VudC5vZmZzZXQueSAvIGZvbnRTaXplU2NhbGU7CiAgICAgICAgICAgIHRoaXMucGFpbnRDaGFyKGFjY2VudC5mb250Q2hhciwgc2NhbGVkQWNjZW50WCwgc2NhbGVkQWNjZW50WSwgcGF0dGVybkZpbGxUcmFuc2Zvcm0sIHBhdHRlcm5TdHJva2VUcmFuc2Zvcm0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBjaGFyV2lkdGggPSB2ZXJ0aWNhbCA/IHdpZHRoICogd2lkdGhBZHZhbmNlU2NhbGUgLSBzcGFjaW5nICogZm9udERpcmVjdGlvbiA6IHdpZHRoICogd2lkdGhBZHZhbmNlU2NhbGUgKyBzcGFjaW5nICogZm9udERpcmVjdGlvbjsKICAgICAgeCArPSBjaGFyV2lkdGg7CiAgICAgIGlmIChyZXN0b3JlTmVlZGVkKSB7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgfQogICAgfQogICAgaWYgKHZlcnRpY2FsKSB7CiAgICAgIGN1cnJlbnQueSAtPSB4OwogICAgfSBlbHNlIHsKICAgICAgY3VycmVudC54ICs9IHggKiB0ZXh0SFNjYWxlOwogICAgfQogICAgY3R4LnJlc3RvcmUoKTsKICAgIHRoaXMuY29tcG9zZSgpOwogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc2hvd1R5cGUzVGV4dChnbHlwaHMpIHsKICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4OwogICAgY29uc3QgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICAgIGNvbnN0IGZvbnQgPSBjdXJyZW50LmZvbnQ7CiAgICBjb25zdCBmb250U2l6ZSA9IGN1cnJlbnQuZm9udFNpemU7CiAgICBjb25zdCBmb250RGlyZWN0aW9uID0gY3VycmVudC5mb250RGlyZWN0aW9uOwogICAgY29uc3Qgc3BhY2luZ0RpciA9IGZvbnQudmVydGljYWwgPyAxIDogLTE7CiAgICBjb25zdCBjaGFyU3BhY2luZyA9IGN1cnJlbnQuY2hhclNwYWNpbmc7CiAgICBjb25zdCB3b3JkU3BhY2luZyA9IGN1cnJlbnQud29yZFNwYWNpbmc7CiAgICBjb25zdCB0ZXh0SFNjYWxlID0gY3VycmVudC50ZXh0SFNjYWxlICogZm9udERpcmVjdGlvbjsKICAgIGNvbnN0IGZvbnRNYXRyaXggPSBjdXJyZW50LmZvbnRNYXRyaXggfHwgRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICBjb25zdCBnbHlwaHNMZW5ndGggPSBnbHlwaHMubGVuZ3RoOwogICAgY29uc3QgaXNUZXh0SW52aXNpYmxlID0gY3VycmVudC50ZXh0UmVuZGVyaW5nTW9kZSA9PT0gVGV4dFJlbmRlcmluZ01vZGUuSU5WSVNJQkxFOwogICAgbGV0IGksIGdseXBoLCB3aWR0aCwgc3BhY2luZ0xlbmd0aDsKICAgIGlmIChpc1RleHRJbnZpc2libGUgfHwgZm9udFNpemUgPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fY2FjaGVkU2NhbGVGb3JTdHJva2luZ1swXSA9IC0xOwogICAgdGhpcy5fY2FjaGVkR2V0U2luZ2xlUGl4ZWxXaWR0aCA9IG51bGw7CiAgICBjdHguc2F2ZSgpOwogICAgaWYgKGN1cnJlbnQudGV4dE1hdHJpeCkgewogICAgICBjdHgudHJhbnNmb3JtKC4uLmN1cnJlbnQudGV4dE1hdHJpeCk7CiAgICB9CiAgICBjdHgudHJhbnNsYXRlKGN1cnJlbnQueCwgY3VycmVudC55ICsgY3VycmVudC50ZXh0UmlzZSk7CiAgICBjdHguc2NhbGUodGV4dEhTY2FsZSwgZm9udERpcmVjdGlvbik7CiAgICBmb3IgKGkgPSAwOyBpIDwgZ2x5cGhzTGVuZ3RoOyArK2kpIHsKICAgICAgZ2x5cGggPSBnbHlwaHNbaV07CiAgICAgIGlmICh0eXBlb2YgZ2x5cGggPT09ICJudW1iZXIiKSB7CiAgICAgICAgc3BhY2luZ0xlbmd0aCA9IHNwYWNpbmdEaXIgKiBnbHlwaCAqIGZvbnRTaXplIC8gMTAwMDsKICAgICAgICB0aGlzLmN0eC50cmFuc2xhdGUoc3BhY2luZ0xlbmd0aCwgMCk7CiAgICAgICAgY3VycmVudC54ICs9IHNwYWNpbmdMZW5ndGggKiB0ZXh0SFNjYWxlOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHNwYWNpbmcgPSAoZ2x5cGguaXNTcGFjZSA/IHdvcmRTcGFjaW5nIDogMCkgKyBjaGFyU3BhY2luZzsKICAgICAgY29uc3Qgb3BlcmF0b3JMaXN0ID0gZm9udC5jaGFyUHJvY09wZXJhdG9yTGlzdFtnbHlwaC5vcGVyYXRvckxpc3RJZF07CiAgICAgIGlmICghb3BlcmF0b3JMaXN0KSB7CiAgICAgICAgd2FybihgVHlwZTMgY2hhcmFjdGVyICIke2dseXBoLm9wZXJhdG9yTGlzdElkfSIgaXMgbm90IGF2YWlsYWJsZS5gKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbnRlbnRWaXNpYmxlKSB7CiAgICAgICAgdGhpcy5zYXZlKCk7CiAgICAgICAgY3R4LnNjYWxlKGZvbnRTaXplLCBmb250U2l6ZSk7CiAgICAgICAgY3R4LnRyYW5zZm9ybSguLi5mb250TWF0cml4KTsKICAgICAgICB0aGlzLmV4ZWN1dGVPcGVyYXRvckxpc3Qob3BlcmF0b3JMaXN0KTsKICAgICAgICB0aGlzLnJlc3RvcmUoKTsKICAgICAgfQogICAgICBjb25zdCBwID0gW2dseXBoLndpZHRoLCAwXTsKICAgICAgVXRpbC5hcHBseVRyYW5zZm9ybShwLCBmb250TWF0cml4KTsKICAgICAgd2lkdGggPSBwWzBdICogZm9udFNpemUgKyBzcGFjaW5nOwogICAgICBjdHgudHJhbnNsYXRlKHdpZHRoLCAwKTsKICAgICAgY3VycmVudC54ICs9IHdpZHRoICogdGV4dEhTY2FsZTsKICAgIH0KICAgIGN0eC5yZXN0b3JlKCk7CiAgfQogIHNldENoYXJXaWR0aCh4V2lkdGgsIHlXaWR0aCkge30KICBzZXRDaGFyV2lkdGhBbmRCb3VuZHMoeFdpZHRoLCB5V2lkdGgsIGxseCwgbGx5LCB1cngsIHVyeSkgewogICAgY29uc3QgY2xpcCA9IG5ldyBQYXRoMkQoKTsKICAgIGNsaXAucmVjdChsbHgsIGxseSwgdXJ4IC0gbGx4LCB1cnkgLSBsbHkpOwogICAgdGhpcy5jdHguY2xpcChjbGlwKTsKICAgIHRoaXMuZW5kUGF0aCgpOwogIH0KICBnZXRDb2xvck5fUGF0dGVybihJUikgewogICAgbGV0IHBhdHRlcm47CiAgICBpZiAoSVJbMF0gPT09ICJUaWxpbmdQYXR0ZXJuIikgewogICAgICBjb25zdCBiYXNlVHJhbnNmb3JtID0gdGhpcy5iYXNlVHJhbnNmb3JtIHx8IGdldEN1cnJlbnRUcmFuc2Zvcm0odGhpcy5jdHgpOwogICAgICBjb25zdCBjYW52YXNHcmFwaGljc0ZhY3RvcnkgPSB7CiAgICAgICAgY3JlYXRlQ2FudmFzR3JhcGhpY3M6IGN0eCA9PiBuZXcgQ2FudmFzR3JhcGhpY3MoY3R4LCB0aGlzLmNvbW1vbk9ianMsIHRoaXMub2JqcywgdGhpcy5jYW52YXNGYWN0b3J5LCB0aGlzLmZpbHRlckZhY3RvcnksIHsKICAgICAgICAgIG9wdGlvbmFsQ29udGVudENvbmZpZzogdGhpcy5vcHRpb25hbENvbnRlbnRDb25maWcsCiAgICAgICAgICBtYXJrZWRDb250ZW50U3RhY2s6IHRoaXMubWFya2VkQ29udGVudFN0YWNrCiAgICAgICAgfSkKICAgICAgfTsKICAgICAgcGF0dGVybiA9IG5ldyBUaWxpbmdQYXR0ZXJuKElSLCB0aGlzLmN0eCwgY2FudmFzR3JhcGhpY3NGYWN0b3J5LCBiYXNlVHJhbnNmb3JtKTsKICAgIH0gZWxzZSB7CiAgICAgIHBhdHRlcm4gPSB0aGlzLl9nZXRQYXR0ZXJuKElSWzFdLCBJUlsyXSk7CiAgICB9CiAgICByZXR1cm4gcGF0dGVybjsKICB9CiAgc2V0U3Ryb2tlQ29sb3JOKCkgewogICAgdGhpcy5jdXJyZW50LnN0cm9rZUNvbG9yID0gdGhpcy5nZXRDb2xvck5fUGF0dGVybihhcmd1bWVudHMpOwogICAgdGhpcy5jdXJyZW50LnBhdHRlcm5TdHJva2UgPSB0cnVlOwogIH0KICBzZXRGaWxsQ29sb3JOKCkgewogICAgdGhpcy5jdXJyZW50LmZpbGxDb2xvciA9IHRoaXMuZ2V0Q29sb3JOX1BhdHRlcm4oYXJndW1lbnRzKTsKICAgIHRoaXMuY3VycmVudC5wYXR0ZXJuRmlsbCA9IHRydWU7CiAgfQogIHNldFN0cm9rZVJHQkNvbG9yKGNvbG9yKSB7CiAgICB0aGlzLmN0eC5zdHJva2VTdHlsZSA9IHRoaXMuY3VycmVudC5zdHJva2VDb2xvciA9IGNvbG9yOwogICAgdGhpcy5jdXJyZW50LnBhdHRlcm5TdHJva2UgPSBmYWxzZTsKICB9CiAgc2V0U3Ryb2tlVHJhbnNwYXJlbnQoKSB7CiAgICB0aGlzLmN0eC5zdHJva2VTdHlsZSA9IHRoaXMuY3VycmVudC5zdHJva2VDb2xvciA9ICJ0cmFuc3BhcmVudCI7CiAgICB0aGlzLmN1cnJlbnQucGF0dGVyblN0cm9rZSA9IGZhbHNlOwogIH0KICBzZXRGaWxsUkdCQ29sb3IoY29sb3IpIHsKICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IHRoaXMuY3VycmVudC5maWxsQ29sb3IgPSBjb2xvcjsKICAgIHRoaXMuY3VycmVudC5wYXR0ZXJuRmlsbCA9IGZhbHNlOwogIH0KICBzZXRGaWxsVHJhbnNwYXJlbnQoKSB7CiAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSB0aGlzLmN1cnJlbnQuZmlsbENvbG9yID0gInRyYW5zcGFyZW50IjsKICAgIHRoaXMuY3VycmVudC5wYXR0ZXJuRmlsbCA9IGZhbHNlOwogIH0KICBfZ2V0UGF0dGVybihvYmpJZCwgbWF0cml4ID0gbnVsbCkgewogICAgbGV0IHBhdHRlcm47CiAgICBpZiAodGhpcy5jYWNoZWRQYXR0ZXJucy5oYXMob2JqSWQpKSB7CiAgICAgIHBhdHRlcm4gPSB0aGlzLmNhY2hlZFBhdHRlcm5zLmdldChvYmpJZCk7CiAgICB9IGVsc2UgewogICAgICBwYXR0ZXJuID0gZ2V0U2hhZGluZ1BhdHRlcm4odGhpcy5nZXRPYmplY3Qob2JqSWQpKTsKICAgICAgdGhpcy5jYWNoZWRQYXR0ZXJucy5zZXQob2JqSWQsIHBhdHRlcm4pOwogICAgfQogICAgaWYgKG1hdHJpeCkgewogICAgICBwYXR0ZXJuLm1hdHJpeCA9IG1hdHJpeDsKICAgIH0KICAgIHJldHVybiBwYXR0ZXJuOwogIH0KICBzaGFkaW5nRmlsbChvYmpJZCkgewogICAgaWYgKCF0aGlzLmNvbnRlbnRWaXNpYmxlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4OwogICAgdGhpcy5zYXZlKCk7CiAgICBjb25zdCBwYXR0ZXJuID0gdGhpcy5fZ2V0UGF0dGVybihvYmpJZCk7CiAgICBjdHguZmlsbFN0eWxlID0gcGF0dGVybi5nZXRQYXR0ZXJuKGN0eCwgdGhpcywgZ2V0Q3VycmVudFRyYW5zZm9ybUludmVyc2UoY3R4KSwgUGF0aFR5cGUuU0hBRElORyk7CiAgICBjb25zdCBpbnYgPSBnZXRDdXJyZW50VHJhbnNmb3JtSW52ZXJzZShjdHgpOwogICAgaWYgKGludikgewogICAgICBjb25zdCB7CiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0gPSBjdHguY2FudmFzOwogICAgICBjb25zdCBtaW5NYXggPSBNSU5fTUFYX0lOSVQuc2xpY2UoKTsKICAgICAgVXRpbC5heGlhbEFsaWduZWRCb3VuZGluZ0JveChbMCwgMCwgd2lkdGgsIGhlaWdodF0sIGludiwgbWluTWF4KTsKICAgICAgY29uc3QgW3gwLCB5MCwgeDEsIHkxXSA9IG1pbk1heDsKICAgICAgdGhpcy5jdHguZmlsbFJlY3QoeDAsIHkwLCB4MSAtIHgwLCB5MSAtIHkwKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KC0xZTEwLCAtMWUxMCwgMmUxMCwgMmUxMCk7CiAgICB9CiAgICB0aGlzLmNvbXBvc2UodGhpcy5jdXJyZW50LmdldENsaXBwZWRQYXRoQm91bmRpbmdCb3goKSk7CiAgICB0aGlzLnJlc3RvcmUoKTsKICB9CiAgYmVnaW5JbmxpbmVJbWFnZSgpIHsKICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgYmVnaW5JbmxpbmVJbWFnZSIpOwogIH0KICBiZWdpbkltYWdlRGF0YSgpIHsKICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgYmVnaW5JbWFnZURhdGEiKTsKICB9CiAgcGFpbnRGb3JtWE9iamVjdEJlZ2luKG1hdHJpeCwgYmJveCkgewogICAgaWYgKCF0aGlzLmNvbnRlbnRWaXNpYmxlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuc2F2ZSgpOwogICAgdGhpcy5iYXNlVHJhbnNmb3JtU3RhY2sucHVzaCh0aGlzLmJhc2VUcmFuc2Zvcm0pOwogICAgaWYgKG1hdHJpeCkgewogICAgICB0aGlzLnRyYW5zZm9ybSguLi5tYXRyaXgpOwogICAgfQogICAgdGhpcy5iYXNlVHJhbnNmb3JtID0gZ2V0Q3VycmVudFRyYW5zZm9ybSh0aGlzLmN0eCk7CiAgICBpZiAoYmJveCkgewogICAgICBVdGlsLmF4aWFsQWxpZ25lZEJvdW5kaW5nQm94KGJib3gsIHRoaXMuYmFzZVRyYW5zZm9ybSwgdGhpcy5jdXJyZW50Lm1pbk1heCk7CiAgICAgIGNvbnN0IFt4MCwgeTAsIHgxLCB5MV0gPSBiYm94OwogICAgICBjb25zdCBjbGlwID0gbmV3IFBhdGgyRCgpOwogICAgICBjbGlwLnJlY3QoeDAsIHkwLCB4MSAtIHgwLCB5MSAtIHkwKTsKICAgICAgdGhpcy5jdHguY2xpcChjbGlwKTsKICAgICAgdGhpcy5lbmRQYXRoKCk7CiAgICB9CiAgfQogIHBhaW50Rm9ybVhPYmplY3RFbmQoKSB7CiAgICBpZiAoIXRoaXMuY29udGVudFZpc2libGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5yZXN0b3JlKCk7CiAgICB0aGlzLmJhc2VUcmFuc2Zvcm0gPSB0aGlzLmJhc2VUcmFuc2Zvcm1TdGFjay5wb3AoKTsKICB9CiAgYmVnaW5Hcm91cChncm91cCkgewogICAgaWYgKCF0aGlzLmNvbnRlbnRWaXNpYmxlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuc2F2ZSgpOwogICAgaWYgKHRoaXMuaW5TTWFza01vZGUpIHsKICAgICAgdGhpcy5lbmRTTWFza01vZGUoKTsKICAgICAgdGhpcy5jdXJyZW50LmFjdGl2ZVNNYXNrID0gbnVsbDsKICAgIH0KICAgIGNvbnN0IGN1cnJlbnRDdHggPSB0aGlzLmN0eDsKICAgIGlmICghZ3JvdXAuaXNvbGF0ZWQpIHsKICAgICAgaW5mbygiVE9ETzogU3VwcG9ydCBub24taXNvbGF0ZWQgZ3JvdXBzLiIpOwogICAgfQogICAgaWYgKGdyb3VwLmtub2Nrb3V0KSB7CiAgICAgIHdhcm4oIktub2Nrb3V0IGdyb3VwcyBub3Qgc3VwcG9ydGVkLiIpOwogICAgfQogICAgY29uc3QgY3VycmVudFRyYW5zZm9ybSA9IGdldEN1cnJlbnRUcmFuc2Zvcm0oY3VycmVudEN0eCk7CiAgICBpZiAoZ3JvdXAubWF0cml4KSB7CiAgICAgIGN1cnJlbnRDdHgudHJhbnNmb3JtKC4uLmdyb3VwLm1hdHJpeCk7CiAgICB9CiAgICBpZiAoIWdyb3VwLmJib3gpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJCb3VuZGluZyBib3ggaXMgcmVxdWlyZWQuIik7CiAgICB9CiAgICBsZXQgYm91bmRzID0gTUlOX01BWF9JTklULnNsaWNlKCk7CiAgICBVdGlsLmF4aWFsQWxpZ25lZEJvdW5kaW5nQm94KGdyb3VwLmJib3gsIGdldEN1cnJlbnRUcmFuc2Zvcm0oY3VycmVudEN0eCksIGJvdW5kcyk7CiAgICBjb25zdCBjYW52YXNCb3VuZHMgPSBbMCwgMCwgY3VycmVudEN0eC5jYW52YXMud2lkdGgsIGN1cnJlbnRDdHguY2FudmFzLmhlaWdodF07CiAgICBib3VuZHMgPSBVdGlsLmludGVyc2VjdChib3VuZHMsIGNhbnZhc0JvdW5kcykgfHwgWzAsIDAsIDAsIDBdOwogICAgY29uc3Qgb2Zmc2V0WCA9IE1hdGguZmxvb3IoYm91bmRzWzBdKTsKICAgIGNvbnN0IG9mZnNldFkgPSBNYXRoLmZsb29yKGJvdW5kc1sxXSk7CiAgICBjb25zdCBkcmF3bldpZHRoID0gTWF0aC5tYXgoTWF0aC5jZWlsKGJvdW5kc1syXSkgLSBvZmZzZXRYLCAxKTsKICAgIGNvbnN0IGRyYXduSGVpZ2h0ID0gTWF0aC5tYXgoTWF0aC5jZWlsKGJvdW5kc1szXSkgLSBvZmZzZXRZLCAxKTsKICAgIHRoaXMuY3VycmVudC5zdGFydE5ld1BhdGhBbmRDbGlwQm94KFswLCAwLCBkcmF3bldpZHRoLCBkcmF3bkhlaWdodF0pOwogICAgbGV0IGNhY2hlSWQgPSAiZ3JvdXBBdCIgKyB0aGlzLmdyb3VwTGV2ZWw7CiAgICBpZiAoZ3JvdXAuc21hc2spIHsKICAgICAgY2FjaGVJZCArPSAiX3NtYXNrXyIgKyB0aGlzLnNtYXNrQ291bnRlcisrICUgMjsKICAgIH0KICAgIGNvbnN0IHNjcmF0Y2hDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcyhjYWNoZUlkLCBkcmF3bldpZHRoLCBkcmF3bkhlaWdodCk7CiAgICBjb25zdCBncm91cEN0eCA9IHNjcmF0Y2hDYW52YXMuY29udGV4dDsKICAgIGdyb3VwQ3R4LnRyYW5zbGF0ZSgtb2Zmc2V0WCwgLW9mZnNldFkpOwogICAgZ3JvdXBDdHgudHJhbnNmb3JtKC4uLmN1cnJlbnRUcmFuc2Zvcm0pOwogICAgbGV0IGNsaXAgPSBuZXcgUGF0aDJEKCk7CiAgICBjb25zdCBbeDAsIHkwLCB4MSwgeTFdID0gZ3JvdXAuYmJveDsKICAgIGNsaXAucmVjdCh4MCwgeTAsIHgxIC0geDAsIHkxIC0geTApOwogICAgaWYgKGdyb3VwLm1hdHJpeCkgewogICAgICBjb25zdCBwYXRoID0gbmV3IFBhdGgyRCgpOwogICAgICBwYXRoLmFkZFBhdGgoY2xpcCwgbmV3IERPTU1hdHJpeChncm91cC5tYXRyaXgpKTsKICAgICAgY2xpcCA9IHBhdGg7CiAgICB9CiAgICBncm91cEN0eC5jbGlwKGNsaXApOwogICAgaWYgKGdyb3VwLnNtYXNrKSB7CiAgICAgIHRoaXMuc21hc2tTdGFjay5wdXNoKHsKICAgICAgICBjYW52YXM6IHNjcmF0Y2hDYW52YXMuY2FudmFzLAogICAgICAgIGNvbnRleHQ6IGdyb3VwQ3R4LAogICAgICAgIG9mZnNldFgsCiAgICAgICAgb2Zmc2V0WSwKICAgICAgICBzdWJ0eXBlOiBncm91cC5zbWFzay5zdWJ0eXBlLAogICAgICAgIGJhY2tkcm9wOiBncm91cC5zbWFzay5iYWNrZHJvcCwKICAgICAgICB0cmFuc2Zlck1hcDogZ3JvdXAuc21hc2sudHJhbnNmZXJNYXAgfHwgbnVsbCwKICAgICAgICBzdGFydFRyYW5zZm9ybUludmVyc2U6IG51bGwKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBjdXJyZW50Q3R4LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCAwLCAwKTsKICAgICAgY3VycmVudEN0eC50cmFuc2xhdGUob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIGN1cnJlbnRDdHguc2F2ZSgpOwogICAgfQogICAgY29weUN0eFN0YXRlKGN1cnJlbnRDdHgsIGdyb3VwQ3R4KTsKICAgIHRoaXMuY3R4ID0gZ3JvdXBDdHg7CiAgICB0aGlzLnNldEdTdGF0ZShbWyJCTSIsICJzb3VyY2Utb3ZlciJdLCBbImNhIiwgMV0sIFsiQ0EiLCAxXV0pOwogICAgdGhpcy5ncm91cFN0YWNrLnB1c2goY3VycmVudEN0eCk7CiAgICB0aGlzLmdyb3VwTGV2ZWwrKzsKICB9CiAgZW5kR3JvdXAoZ3JvdXApIHsKICAgIGlmICghdGhpcy5jb250ZW50VmlzaWJsZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmdyb3VwTGV2ZWwtLTsKICAgIGNvbnN0IGdyb3VwQ3R4ID0gdGhpcy5jdHg7CiAgICBjb25zdCBjdHggPSB0aGlzLmdyb3VwU3RhY2sucG9wKCk7CiAgICB0aGlzLmN0eCA9IGN0eDsKICAgIHRoaXMuY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlOwogICAgaWYgKGdyb3VwLnNtYXNrKSB7CiAgICAgIHRoaXMudGVtcFNNYXNrID0gdGhpcy5zbWFza1N0YWNrLnBvcCgpOwogICAgICB0aGlzLnJlc3RvcmUoKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY3R4LnJlc3RvcmUoKTsKICAgICAgY29uc3QgY3VycmVudE10eCA9IGdldEN1cnJlbnRUcmFuc2Zvcm0odGhpcy5jdHgpOwogICAgICB0aGlzLnJlc3RvcmUoKTsKICAgICAgdGhpcy5jdHguc2F2ZSgpOwogICAgICB0aGlzLmN0eC5zZXRUcmFuc2Zvcm0oLi4uY3VycmVudE10eCk7CiAgICAgIGNvbnN0IGRpcnR5Qm94ID0gTUlOX01BWF9JTklULnNsaWNlKCk7CiAgICAgIFV0aWwuYXhpYWxBbGlnbmVkQm91bmRpbmdCb3goWzAsIDAsIGdyb3VwQ3R4LmNhbnZhcy53aWR0aCwgZ3JvdXBDdHguY2FudmFzLmhlaWdodF0sIGN1cnJlbnRNdHgsIGRpcnR5Qm94KTsKICAgICAgdGhpcy5jdHguZHJhd0ltYWdlKGdyb3VwQ3R4LmNhbnZhcywgMCwgMCk7CiAgICAgIHRoaXMuY3R4LnJlc3RvcmUoKTsKICAgICAgdGhpcy5jb21wb3NlKGRpcnR5Qm94KTsKICAgIH0KICB9CiAgYmVnaW5Bbm5vdGF0aW9uKGlkLCByZWN0LCB0cmFuc2Zvcm0sIG1hdHJpeCwgaGFzT3duQ2FudmFzKSB7CiAgICB0aGlzLiNyZXN0b3JlSW5pdGlhbFN0YXRlKCk7CiAgICByZXNldEN0eFRvRGVmYXVsdCh0aGlzLmN0eCk7CiAgICB0aGlzLmN0eC5zYXZlKCk7CiAgICB0aGlzLnNhdmUoKTsKICAgIGlmICh0aGlzLmJhc2VUcmFuc2Zvcm0pIHsKICAgICAgdGhpcy5jdHguc2V0VHJhbnNmb3JtKC4uLnRoaXMuYmFzZVRyYW5zZm9ybSk7CiAgICB9CiAgICBpZiAocmVjdCkgewogICAgICBjb25zdCB3aWR0aCA9IHJlY3RbMl0gLSByZWN0WzBdOwogICAgICBjb25zdCBoZWlnaHQgPSByZWN0WzNdIC0gcmVjdFsxXTsKICAgICAgaWYgKGhhc093bkNhbnZhcyAmJiB0aGlzLmFubm90YXRpb25DYW52YXNNYXApIHsKICAgICAgICB0cmFuc2Zvcm0gPSB0cmFuc2Zvcm0uc2xpY2UoKTsKICAgICAgICB0cmFuc2Zvcm1bNF0gLT0gcmVjdFswXTsKICAgICAgICB0cmFuc2Zvcm1bNV0gLT0gcmVjdFsxXTsKICAgICAgICByZWN0ID0gcmVjdC5zbGljZSgpOwogICAgICAgIHJlY3RbMF0gPSByZWN0WzFdID0gMDsKICAgICAgICByZWN0WzJdID0gd2lkdGg7CiAgICAgICAgcmVjdFszXSA9IGhlaWdodDsKICAgICAgICBVdGlsLnNpbmd1bGFyVmFsdWVEZWNvbXBvc2UyZFNjYWxlKGdldEN1cnJlbnRUcmFuc2Zvcm0odGhpcy5jdHgpLCBYWSk7CiAgICAgICAgY29uc3QgewogICAgICAgICAgdmlld3BvcnRTY2FsZQogICAgICAgIH0gPSB0aGlzOwogICAgICAgIGNvbnN0IGNhbnZhc1dpZHRoID0gTWF0aC5jZWlsKHdpZHRoICogdGhpcy5vdXRwdXRTY2FsZVggKiB2aWV3cG9ydFNjYWxlKTsKICAgICAgICBjb25zdCBjYW52YXNIZWlnaHQgPSBNYXRoLmNlaWwoaGVpZ2h0ICogdGhpcy5vdXRwdXRTY2FsZVkgKiB2aWV3cG9ydFNjYWxlKTsKICAgICAgICB0aGlzLmFubm90YXRpb25DYW52YXMgPSB0aGlzLmNhbnZhc0ZhY3RvcnkuY3JlYXRlKGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpOwogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGNhbnZhcywKICAgICAgICAgIGNvbnRleHQKICAgICAgICB9ID0gdGhpcy5hbm5vdGF0aW9uQ2FudmFzOwogICAgICAgIHRoaXMuYW5ub3RhdGlvbkNhbnZhc01hcC5zZXQoaWQsIGNhbnZhcyk7CiAgICAgICAgdGhpcy5hbm5vdGF0aW9uQ2FudmFzLnNhdmVkQ3R4ID0gdGhpcy5jdHg7CiAgICAgICAgdGhpcy5jdHggPSBjb250ZXh0OwogICAgICAgIHRoaXMuY3R4LnNhdmUoKTsKICAgICAgICB0aGlzLmN0eC5zZXRUcmFuc2Zvcm0oWFlbMF0sIDAsIDAsIC1YWVsxXSwgMCwgaGVpZ2h0ICogWFlbMV0pOwogICAgICAgIHJlc2V0Q3R4VG9EZWZhdWx0KHRoaXMuY3R4KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXNldEN0eFRvRGVmYXVsdCh0aGlzLmN0eCk7CiAgICAgICAgdGhpcy5lbmRQYXRoKCk7CiAgICAgICAgY29uc3QgY2xpcCA9IG5ldyBQYXRoMkQoKTsKICAgICAgICBjbGlwLnJlY3QocmVjdFswXSwgcmVjdFsxXSwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgdGhpcy5jdHguY2xpcChjbGlwKTsKICAgICAgfQogICAgfQogICAgdGhpcy5jdXJyZW50ID0gbmV3IENhbnZhc0V4dHJhU3RhdGUodGhpcy5jdHguY2FudmFzLndpZHRoLCB0aGlzLmN0eC5jYW52YXMuaGVpZ2h0KTsKICAgIHRoaXMudHJhbnNmb3JtKC4uLnRyYW5zZm9ybSk7CiAgICB0aGlzLnRyYW5zZm9ybSguLi5tYXRyaXgpOwogIH0KICBlbmRBbm5vdGF0aW9uKCkgewogICAgaWYgKHRoaXMuYW5ub3RhdGlvbkNhbnZhcykgewogICAgICB0aGlzLmN0eC5yZXN0b3JlKCk7CiAgICAgIHRoaXMuI2RyYXdGaWx0ZXIoKTsKICAgICAgdGhpcy5jdHggPSB0aGlzLmFubm90YXRpb25DYW52YXMuc2F2ZWRDdHg7CiAgICAgIGRlbGV0ZSB0aGlzLmFubm90YXRpb25DYW52YXMuc2F2ZWRDdHg7CiAgICAgIGRlbGV0ZSB0aGlzLmFubm90YXRpb25DYW52YXM7CiAgICB9CiAgfQogIHBhaW50SW1hZ2VNYXNrWE9iamVjdChpbWcpIHsKICAgIGlmICghdGhpcy5jb250ZW50VmlzaWJsZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjb3VudCA9IGltZy5jb3VudDsKICAgIGltZyA9IHRoaXMuZ2V0T2JqZWN0KGltZy5kYXRhLCBpbWcpOwogICAgaW1nLmNvdW50ID0gY291bnQ7CiAgICBjb25zdCBjdHggPSB0aGlzLmN0eDsKICAgIGNvbnN0IG1hc2sgPSB0aGlzLl9jcmVhdGVNYXNrQ2FudmFzKGltZyk7CiAgICBjb25zdCBtYXNrQ2FudmFzID0gbWFzay5jYW52YXM7CiAgICBjdHguc2F2ZSgpOwogICAgY3R4LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCAwLCAwKTsKICAgIGN0eC5kcmF3SW1hZ2UobWFza0NhbnZhcywgbWFzay5vZmZzZXRYLCBtYXNrLm9mZnNldFkpOwogICAgY3R4LnJlc3RvcmUoKTsKICAgIHRoaXMuY29tcG9zZSgpOwogIH0KICBwYWludEltYWdlTWFza1hPYmplY3RSZXBlYXQoaW1nLCBzY2FsZVgsIHNrZXdYID0gMCwgc2tld1kgPSAwLCBzY2FsZVksIHBvc2l0aW9ucykgewogICAgaWYgKCF0aGlzLmNvbnRlbnRWaXNpYmxlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGltZyA9IHRoaXMuZ2V0T2JqZWN0KGltZy5kYXRhLCBpbWcpOwogICAgY29uc3QgY3R4ID0gdGhpcy5jdHg7CiAgICBjdHguc2F2ZSgpOwogICAgY29uc3QgY3VycmVudFRyYW5zZm9ybSA9IGdldEN1cnJlbnRUcmFuc2Zvcm0oY3R4KTsKICAgIGN0eC50cmFuc2Zvcm0oc2NhbGVYLCBza2V3WCwgc2tld1ksIHNjYWxlWSwgMCwgMCk7CiAgICBjb25zdCBtYXNrID0gdGhpcy5fY3JlYXRlTWFza0NhbnZhcyhpbWcpOwogICAgY3R4LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCBtYXNrLm9mZnNldFggLSBjdXJyZW50VHJhbnNmb3JtWzRdLCBtYXNrLm9mZnNldFkgLSBjdXJyZW50VHJhbnNmb3JtWzVdKTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHBvc2l0aW9ucy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIGNvbnN0IHRyYW5zID0gVXRpbC50cmFuc2Zvcm0oY3VycmVudFRyYW5zZm9ybSwgW3NjYWxlWCwgc2tld1gsIHNrZXdZLCBzY2FsZVksIHBvc2l0aW9uc1tpXSwgcG9zaXRpb25zW2kgKyAxXV0pOwogICAgICBjdHguZHJhd0ltYWdlKG1hc2suY2FudmFzLCB0cmFuc1s0XSwgdHJhbnNbNV0pOwogICAgfQogICAgY3R4LnJlc3RvcmUoKTsKICAgIHRoaXMuY29tcG9zZSgpOwogIH0KICBwYWludEltYWdlTWFza1hPYmplY3RHcm91cChpbWFnZXMpIHsKICAgIGlmICghdGhpcy5jb250ZW50VmlzaWJsZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjdHggPSB0aGlzLmN0eDsKICAgIGNvbnN0IGZpbGxDb2xvciA9IHRoaXMuY3VycmVudC5maWxsQ29sb3I7CiAgICBjb25zdCBpc1BhdHRlcm5GaWxsID0gdGhpcy5jdXJyZW50LnBhdHRlcm5GaWxsOwogICAgZm9yIChjb25zdCBpbWFnZSBvZiBpbWFnZXMpIHsKICAgICAgY29uc3QgewogICAgICAgIGRhdGEsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0LAogICAgICAgIHRyYW5zZm9ybQogICAgICB9ID0gaW1hZ2U7CiAgICAgIGNvbnN0IG1hc2tDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcygibWFza0NhbnZhcyIsIHdpZHRoLCBoZWlnaHQpOwogICAgICBjb25zdCBtYXNrQ3R4ID0gbWFza0NhbnZhcy5jb250ZXh0OwogICAgICBtYXNrQ3R4LnNhdmUoKTsKICAgICAgY29uc3QgaW1nID0gdGhpcy5nZXRPYmplY3QoZGF0YSwgaW1hZ2UpOwogICAgICBwdXRCaW5hcnlJbWFnZU1hc2sobWFza0N0eCwgaW1nKTsKICAgICAgbWFza0N0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAic291cmNlLWluIjsKICAgICAgbWFza0N0eC5maWxsU3R5bGUgPSBpc1BhdHRlcm5GaWxsID8gZmlsbENvbG9yLmdldFBhdHRlcm4obWFza0N0eCwgdGhpcywgZ2V0Q3VycmVudFRyYW5zZm9ybUludmVyc2UoY3R4KSwgUGF0aFR5cGUuRklMTCkgOiBmaWxsQ29sb3I7CiAgICAgIG1hc2tDdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgIG1hc2tDdHgucmVzdG9yZSgpOwogICAgICBjdHguc2F2ZSgpOwogICAgICBjdHgudHJhbnNmb3JtKC4uLnRyYW5zZm9ybSk7CiAgICAgIGN0eC5zY2FsZSgxLCAtMSk7CiAgICAgIGRyYXdJbWFnZUF0SW50ZWdlckNvb3JkcyhjdHgsIG1hc2tDYW52YXMuY2FudmFzLCAwLCAwLCB3aWR0aCwgaGVpZ2h0LCAwLCAtMSwgMSwgMSk7CiAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICB9CiAgICB0aGlzLmNvbXBvc2UoKTsKICB9CiAgcGFpbnRJbWFnZVhPYmplY3Qob2JqSWQpIHsKICAgIGlmICghdGhpcy5jb250ZW50VmlzaWJsZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBpbWdEYXRhID0gdGhpcy5nZXRPYmplY3Qob2JqSWQpOwogICAgaWYgKCFpbWdEYXRhKSB7CiAgICAgIHdhcm4oIkRlcGVuZGVudCBpbWFnZSBpc24ndCByZWFkeSB5ZXQiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5wYWludElubGluZUltYWdlWE9iamVjdChpbWdEYXRhKTsKICB9CiAgcGFpbnRJbWFnZVhPYmplY3RSZXBlYXQob2JqSWQsIHNjYWxlWCwgc2NhbGVZLCBwb3NpdGlvbnMpIHsKICAgIGlmICghdGhpcy5jb250ZW50VmlzaWJsZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBpbWdEYXRhID0gdGhpcy5nZXRPYmplY3Qob2JqSWQpOwogICAgaWYgKCFpbWdEYXRhKSB7CiAgICAgIHdhcm4oIkRlcGVuZGVudCBpbWFnZSBpc24ndCByZWFkeSB5ZXQiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgd2lkdGggPSBpbWdEYXRhLndpZHRoOwogICAgY29uc3QgaGVpZ2h0ID0gaW1nRGF0YS5oZWlnaHQ7CiAgICBjb25zdCBtYXAgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHBvc2l0aW9ucy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIG1hcC5wdXNoKHsKICAgICAgICB0cmFuc2Zvcm06IFtzY2FsZVgsIDAsIDAsIHNjYWxlWSwgcG9zaXRpb25zW2ldLCBwb3NpdGlvbnNbaSArIDFdXSwKICAgICAgICB4OiAwLAogICAgICAgIHk6IDAsCiAgICAgICAgdzogd2lkdGgsCiAgICAgICAgaDogaGVpZ2h0CiAgICAgIH0pOwogICAgfQogICAgdGhpcy5wYWludElubGluZUltYWdlWE9iamVjdEdyb3VwKGltZ0RhdGEsIG1hcCk7CiAgfQogIGFwcGx5VHJhbnNmZXJNYXBzVG9DYW52YXMoY3R4KSB7CiAgICBpZiAodGhpcy5jdXJyZW50LnRyYW5zZmVyTWFwcyAhPT0gIm5vbmUiKSB7CiAgICAgIGN0eC5maWx0ZXIgPSB0aGlzLmN1cnJlbnQudHJhbnNmZXJNYXBzOwogICAgICBjdHguZHJhd0ltYWdlKGN0eC5jYW52YXMsIDAsIDApOwogICAgICBjdHguZmlsdGVyID0gIm5vbmUiOwogICAgfQogICAgcmV0dXJuIGN0eC5jYW52YXM7CiAgfQogIGFwcGx5VHJhbnNmZXJNYXBzVG9CaXRtYXAoaW1nRGF0YSkgewogICAgaWYgKHRoaXMuY3VycmVudC50cmFuc2Zlck1hcHMgPT09ICJub25lIikgewogICAgICByZXR1cm4gaW1nRGF0YS5iaXRtYXA7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGJpdG1hcCwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IGltZ0RhdGE7CiAgICBjb25zdCB0bXBDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcygiaW5saW5lSW1hZ2UiLCB3aWR0aCwgaGVpZ2h0KTsKICAgIGNvbnN0IHRtcEN0eCA9IHRtcENhbnZhcy5jb250ZXh0OwogICAgdG1wQ3R4LmZpbHRlciA9IHRoaXMuY3VycmVudC50cmFuc2Zlck1hcHM7CiAgICB0bXBDdHguZHJhd0ltYWdlKGJpdG1hcCwgMCwgMCk7CiAgICB0bXBDdHguZmlsdGVyID0gIm5vbmUiOwogICAgcmV0dXJuIHRtcENhbnZhcy5jYW52YXM7CiAgfQogIHBhaW50SW5saW5lSW1hZ2VYT2JqZWN0KGltZ0RhdGEpIHsKICAgIGlmICghdGhpcy5jb250ZW50VmlzaWJsZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB3aWR0aCA9IGltZ0RhdGEud2lkdGg7CiAgICBjb25zdCBoZWlnaHQgPSBpbWdEYXRhLmhlaWdodDsKICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4OwogICAgdGhpcy5zYXZlKCk7CiAgICBjb25zdCB7CiAgICAgIGZpbHRlcgogICAgfSA9IGN0eDsKICAgIGlmIChmaWx0ZXIgIT09ICJub25lIiAmJiBmaWx0ZXIgIT09ICIiKSB7CiAgICAgIGN0eC5maWx0ZXIgPSAibm9uZSI7CiAgICB9CiAgICBjdHguc2NhbGUoMSAvIHdpZHRoLCAtMSAvIGhlaWdodCk7CiAgICBsZXQgaW1nVG9QYWludDsKICAgIGlmIChpbWdEYXRhLmJpdG1hcCkgewogICAgICBpbWdUb1BhaW50ID0gdGhpcy5hcHBseVRyYW5zZmVyTWFwc1RvQml0bWFwKGltZ0RhdGEpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgSFRNTEVsZW1lbnQgPT09ICJmdW5jdGlvbiIgJiYgaW1nRGF0YSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50IHx8ICFpbWdEYXRhLmRhdGEpIHsKICAgICAgaW1nVG9QYWludCA9IGltZ0RhdGE7CiAgICB9IGVsc2UgewogICAgICBjb25zdCB0bXBDYW52YXMgPSB0aGlzLmNhY2hlZENhbnZhc2VzLmdldENhbnZhcygiaW5saW5lSW1hZ2UiLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgY29uc3QgdG1wQ3R4ID0gdG1wQ2FudmFzLmNvbnRleHQ7CiAgICAgIHB1dEJpbmFyeUltYWdlRGF0YSh0bXBDdHgsIGltZ0RhdGEpOwogICAgICBpbWdUb1BhaW50ID0gdGhpcy5hcHBseVRyYW5zZmVyTWFwc1RvQ2FudmFzKHRtcEN0eCk7CiAgICB9CiAgICBjb25zdCBzY2FsZWQgPSB0aGlzLl9zY2FsZUltYWdlKGltZ1RvUGFpbnQsIGdldEN1cnJlbnRUcmFuc2Zvcm1JbnZlcnNlKGN0eCkpOwogICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGdldEltYWdlU21vb3RoaW5nRW5hYmxlZChnZXRDdXJyZW50VHJhbnNmb3JtKGN0eCksIGltZ0RhdGEuaW50ZXJwb2xhdGUpOwogICAgZHJhd0ltYWdlQXRJbnRlZ2VyQ29vcmRzKGN0eCwgc2NhbGVkLmltZywgMCwgMCwgc2NhbGVkLnBhaW50V2lkdGgsIHNjYWxlZC5wYWludEhlaWdodCwgMCwgLWhlaWdodCwgd2lkdGgsIGhlaWdodCk7CiAgICB0aGlzLmNvbXBvc2UoKTsKICAgIHRoaXMucmVzdG9yZSgpOwogIH0KICBwYWludElubGluZUltYWdlWE9iamVjdEdyb3VwKGltZ0RhdGEsIG1hcCkgewogICAgaWYgKCF0aGlzLmNvbnRlbnRWaXNpYmxlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4OwogICAgbGV0IGltZ1RvUGFpbnQ7CiAgICBpZiAoaW1nRGF0YS5iaXRtYXApIHsKICAgICAgaW1nVG9QYWludCA9IGltZ0RhdGEuYml0bWFwOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgdyA9IGltZ0RhdGEud2lkdGg7CiAgICAgIGNvbnN0IGggPSBpbWdEYXRhLmhlaWdodDsKICAgICAgY29uc3QgdG1wQ2FudmFzID0gdGhpcy5jYWNoZWRDYW52YXNlcy5nZXRDYW52YXMoImlubGluZUltYWdlIiwgdywgaCk7CiAgICAgIGNvbnN0IHRtcEN0eCA9IHRtcENhbnZhcy5jb250ZXh0OwogICAgICBwdXRCaW5hcnlJbWFnZURhdGEodG1wQ3R4LCBpbWdEYXRhKTsKICAgICAgaW1nVG9QYWludCA9IHRoaXMuYXBwbHlUcmFuc2Zlck1hcHNUb0NhbnZhcyh0bXBDdHgpOwogICAgfQogICAgZm9yIChjb25zdCBlbnRyeSBvZiBtYXApIHsKICAgICAgY3R4LnNhdmUoKTsKICAgICAgY3R4LnRyYW5zZm9ybSguLi5lbnRyeS50cmFuc2Zvcm0pOwogICAgICBjdHguc2NhbGUoMSwgLTEpOwogICAgICBkcmF3SW1hZ2VBdEludGVnZXJDb29yZHMoY3R4LCBpbWdUb1BhaW50LCBlbnRyeS54LCBlbnRyeS55LCBlbnRyeS53LCBlbnRyeS5oLCAwLCAtMSwgMSwgMSk7CiAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICB9CiAgICB0aGlzLmNvbXBvc2UoKTsKICB9CiAgcGFpbnRTb2xpZENvbG9ySW1hZ2VNYXNrKCkgewogICAgaWYgKCF0aGlzLmNvbnRlbnRWaXNpYmxlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuY3R4LmZpbGxSZWN0KDAsIDAsIDEsIDEpOwogICAgdGhpcy5jb21wb3NlKCk7CiAgfQogIG1hcmtQb2ludCh0YWcpIHt9CiAgbWFya1BvaW50UHJvcHModGFnLCBwcm9wZXJ0aWVzKSB7fQogIGJlZ2luTWFya2VkQ29udGVudCh0YWcpIHsKICAgIHRoaXMubWFya2VkQ29udGVudFN0YWNrLnB1c2goewogICAgICB2aXNpYmxlOiB0cnVlCiAgICB9KTsKICB9CiAgYmVnaW5NYXJrZWRDb250ZW50UHJvcHModGFnLCBwcm9wZXJ0aWVzKSB7CiAgICBpZiAodGFnID09PSAiT0MiKSB7CiAgICAgIHRoaXMubWFya2VkQ29udGVudFN0YWNrLnB1c2goewogICAgICAgIHZpc2libGU6IHRoaXMub3B0aW9uYWxDb250ZW50Q29uZmlnLmlzVmlzaWJsZShwcm9wZXJ0aWVzKQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubWFya2VkQ29udGVudFN0YWNrLnB1c2goewogICAgICAgIHZpc2libGU6IHRydWUKICAgICAgfSk7CiAgICB9CiAgICB0aGlzLmNvbnRlbnRWaXNpYmxlID0gdGhpcy5pc0NvbnRlbnRWaXNpYmxlKCk7CiAgfQogIGVuZE1hcmtlZENvbnRlbnQoKSB7CiAgICB0aGlzLm1hcmtlZENvbnRlbnRTdGFjay5wb3AoKTsKICAgIHRoaXMuY29udGVudFZpc2libGUgPSB0aGlzLmlzQ29udGVudFZpc2libGUoKTsKICB9CiAgYmVnaW5Db21wYXQoKSB7fQogIGVuZENvbXBhdCgpIHt9CiAgY29uc3VtZVBhdGgocGF0aCwgY2xpcEJveCkgewogICAgY29uc3QgaXNFbXB0eSA9IHRoaXMuY3VycmVudC5pc0VtcHR5Q2xpcCgpOwogICAgaWYgKHRoaXMucGVuZGluZ0NsaXApIHsKICAgICAgdGhpcy5jdXJyZW50LnVwZGF0ZUNsaXBGcm9tUGF0aCgpOwogICAgfQogICAgaWYgKCF0aGlzLnBlbmRpbmdDbGlwKSB7CiAgICAgIHRoaXMuY29tcG9zZShjbGlwQm94KTsKICAgIH0KICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4OwogICAgaWYgKHRoaXMucGVuZGluZ0NsaXApIHsKICAgICAgaWYgKCFpc0VtcHR5KSB7CiAgICAgICAgaWYgKHRoaXMucGVuZGluZ0NsaXAgPT09IEVPX0NMSVApIHsKICAgICAgICAgIGN0eC5jbGlwKHBhdGgsICJldmVub2RkIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN0eC5jbGlwKHBhdGgpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBlbmRpbmdDbGlwID0gbnVsbDsKICAgIH0KICAgIHRoaXMuY3VycmVudC5zdGFydE5ld1BhdGhBbmRDbGlwQm94KHRoaXMuY3VycmVudC5jbGlwQm94KTsKICB9CiAgZ2V0U2luZ2xlUGl4ZWxXaWR0aCgpIHsKICAgIGlmICghdGhpcy5fY2FjaGVkR2V0U2luZ2xlUGl4ZWxXaWR0aCkgewogICAgICBjb25zdCBtID0gZ2V0Q3VycmVudFRyYW5zZm9ybSh0aGlzLmN0eCk7CiAgICAgIGlmIChtWzFdID09PSAwICYmIG1bMl0gPT09IDApIHsKICAgICAgICB0aGlzLl9jYWNoZWRHZXRTaW5nbGVQaXhlbFdpZHRoID0gMSAvIE1hdGgubWluKE1hdGguYWJzKG1bMF0pLCBNYXRoLmFicyhtWzNdKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYWJzRGV0ID0gTWF0aC5hYnMobVswXSAqIG1bM10gLSBtWzJdICogbVsxXSk7CiAgICAgICAgY29uc3Qgbm9ybVggPSBNYXRoLmh5cG90KG1bMF0sIG1bMl0pOwogICAgICAgIGNvbnN0IG5vcm1ZID0gTWF0aC5oeXBvdChtWzFdLCBtWzNdKTsKICAgICAgICB0aGlzLl9jYWNoZWRHZXRTaW5nbGVQaXhlbFdpZHRoID0gTWF0aC5tYXgobm9ybVgsIG5vcm1ZKSAvIGFic0RldDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMuX2NhY2hlZEdldFNpbmdsZVBpeGVsV2lkdGg7CiAgfQogIGdldFNjYWxlRm9yU3Ryb2tpbmcoKSB7CiAgICBpZiAodGhpcy5fY2FjaGVkU2NhbGVGb3JTdHJva2luZ1swXSA9PT0gLTEpIHsKICAgICAgY29uc3QgewogICAgICAgIGxpbmVXaWR0aAogICAgICB9ID0gdGhpcy5jdXJyZW50OwogICAgICBjb25zdCB7CiAgICAgICAgYSwKICAgICAgICBiLAogICAgICAgIGMsCiAgICAgICAgZAogICAgICB9ID0gdGhpcy5jdHguZ2V0VHJhbnNmb3JtKCk7CiAgICAgIGxldCBzY2FsZVgsIHNjYWxlWTsKICAgICAgaWYgKGIgPT09IDAgJiYgYyA9PT0gMCkgewogICAgICAgIGNvbnN0IG5vcm1YID0gTWF0aC5hYnMoYSk7CiAgICAgICAgY29uc3Qgbm9ybVkgPSBNYXRoLmFicyhkKTsKICAgICAgICBpZiAobm9ybVggPT09IG5vcm1ZKSB7CiAgICAgICAgICBpZiAobGluZVdpZHRoID09PSAwKSB7CiAgICAgICAgICAgIHNjYWxlWCA9IHNjYWxlWSA9IDEgLyBub3JtWDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHNjYWxlZExpbmVXaWR0aCA9IG5vcm1YICogbGluZVdpZHRoOwogICAgICAgICAgICBzY2FsZVggPSBzY2FsZVkgPSBzY2FsZWRMaW5lV2lkdGggPCAxID8gMSAvIHNjYWxlZExpbmVXaWR0aCA6IDE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChsaW5lV2lkdGggPT09IDApIHsKICAgICAgICAgIHNjYWxlWCA9IDEgLyBub3JtWDsKICAgICAgICAgIHNjYWxlWSA9IDEgLyBub3JtWTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3Qgc2NhbGVkWExpbmVXaWR0aCA9IG5vcm1YICogbGluZVdpZHRoOwogICAgICAgICAgY29uc3Qgc2NhbGVkWUxpbmVXaWR0aCA9IG5vcm1ZICogbGluZVdpZHRoOwogICAgICAgICAgc2NhbGVYID0gc2NhbGVkWExpbmVXaWR0aCA8IDEgPyAxIC8gc2NhbGVkWExpbmVXaWR0aCA6IDE7CiAgICAgICAgICBzY2FsZVkgPSBzY2FsZWRZTGluZVdpZHRoIDwgMSA/IDEgLyBzY2FsZWRZTGluZVdpZHRoIDogMTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYWJzRGV0ID0gTWF0aC5hYnMoYSAqIGQgLSBiICogYyk7CiAgICAgICAgY29uc3Qgbm9ybVggPSBNYXRoLmh5cG90KGEsIGIpOwogICAgICAgIGNvbnN0IG5vcm1ZID0gTWF0aC5oeXBvdChjLCBkKTsKICAgICAgICBpZiAobGluZVdpZHRoID09PSAwKSB7CiAgICAgICAgICBzY2FsZVggPSBub3JtWSAvIGFic0RldDsKICAgICAgICAgIHNjYWxlWSA9IG5vcm1YIC8gYWJzRGV0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBiYXNlQXJlYSA9IGxpbmVXaWR0aCAqIGFic0RldDsKICAgICAgICAgIHNjYWxlWCA9IG5vcm1ZID4gYmFzZUFyZWEgPyBub3JtWSAvIGJhc2VBcmVhIDogMTsKICAgICAgICAgIHNjYWxlWSA9IG5vcm1YID4gYmFzZUFyZWEgPyBub3JtWCAvIGJhc2VBcmVhIDogMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5fY2FjaGVkU2NhbGVGb3JTdHJva2luZ1swXSA9IHNjYWxlWDsKICAgICAgdGhpcy5fY2FjaGVkU2NhbGVGb3JTdHJva2luZ1sxXSA9IHNjYWxlWTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9jYWNoZWRTY2FsZUZvclN0cm9raW5nOwogIH0KICByZXNjYWxlQW5kU3Ryb2tlKHBhdGgsIHNhdmVSZXN0b3JlKSB7CiAgICBjb25zdCB7CiAgICAgIGN0eCwKICAgICAgY3VycmVudDogewogICAgICAgIGxpbmVXaWR0aAogICAgICB9CiAgICB9ID0gdGhpczsKICAgIGNvbnN0IFtzY2FsZVgsIHNjYWxlWV0gPSB0aGlzLmdldFNjYWxlRm9yU3Ryb2tpbmcoKTsKICAgIGlmIChzY2FsZVggPT09IHNjYWxlWSkgewogICAgICBjdHgubGluZVdpZHRoID0gKGxpbmVXaWR0aCB8fCAxKSAqIHNjYWxlWDsKICAgICAgY3R4LnN0cm9rZShwYXRoKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZGFzaGVzID0gY3R4LmdldExpbmVEYXNoKCk7CiAgICBpZiAoc2F2ZVJlc3RvcmUpIHsKICAgICAgY3R4LnNhdmUoKTsKICAgIH0KICAgIGN0eC5zY2FsZShzY2FsZVgsIHNjYWxlWSk7CiAgICBTQ0FMRV9NQVRSSVguYSA9IDEgLyBzY2FsZVg7CiAgICBTQ0FMRV9NQVRSSVguZCA9IDEgLyBzY2FsZVk7CiAgICBjb25zdCBuZXdQYXRoID0gbmV3IFBhdGgyRCgpOwogICAgbmV3UGF0aC5hZGRQYXRoKHBhdGgsIFNDQUxFX01BVFJJWCk7CiAgICBpZiAoZGFzaGVzLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3Qgc2NhbGUgPSBNYXRoLm1heChzY2FsZVgsIHNjYWxlWSk7CiAgICAgIGN0eC5zZXRMaW5lRGFzaChkYXNoZXMubWFwKHggPT4geCAvIHNjYWxlKSk7CiAgICAgIGN0eC5saW5lRGFzaE9mZnNldCAvPSBzY2FsZTsKICAgIH0KICAgIGN0eC5saW5lV2lkdGggPSBsaW5lV2lkdGggfHwgMTsKICAgIGN0eC5zdHJva2UobmV3UGF0aCk7CiAgICBpZiAoc2F2ZVJlc3RvcmUpIHsKICAgICAgY3R4LnJlc3RvcmUoKTsKICAgIH0KICB9CiAgaXNDb250ZW50VmlzaWJsZSgpIHsKICAgIGZvciAobGV0IGkgPSB0aGlzLm1hcmtlZENvbnRlbnRTdGFjay5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICBpZiAoIXRoaXMubWFya2VkQ29udGVudFN0YWNrW2ldLnZpc2libGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KfQpmb3IgKGNvbnN0IG9wIGluIE9QUykgewogIGlmIChDYW52YXNHcmFwaGljcy5wcm90b3R5cGVbb3BdICE9PSB1bmRlZmluZWQpIHsKICAgIENhbnZhc0dyYXBoaWNzLnByb3RvdHlwZVtPUFNbb3BdXSA9IENhbnZhc0dyYXBoaWNzLnByb3RvdHlwZVtvcF07CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS93b3JrZXJfb3B0aW9ucy5qcwpjbGFzcyBHbG9iYWxXb3JrZXJPcHRpb25zIHsKICBzdGF0aWMgI3BvcnQgPSBudWxsOwogIHN0YXRpYyAjc3JjID0gIiI7CiAgc3RhdGljIGdldCB3b3JrZXJQb3J0KCkgewogICAgcmV0dXJuIHRoaXMuI3BvcnQ7CiAgfQogIHN0YXRpYyBzZXQgd29ya2VyUG9ydCh2YWwpIHsKICAgIGlmICghKHR5cGVvZiBXb3JrZXIgIT09ICJ1bmRlZmluZWQiICYmIHZhbCBpbnN0YW5jZW9mIFdvcmtlcikgJiYgdmFsICE9PSBudWxsKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBgd29ya2VyUG9ydGAgdHlwZS4iKTsKICAgIH0KICAgIHRoaXMuI3BvcnQgPSB2YWw7CiAgfQogIHN0YXRpYyBnZXQgd29ya2VyU3JjKCkgewogICAgcmV0dXJuIHRoaXMuI3NyYzsKICB9CiAgc3RhdGljIHNldCB3b3JrZXJTcmModmFsKSB7CiAgICBpZiAodHlwZW9mIHZhbCAhPT0gInN0cmluZyIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGB3b3JrZXJTcmNgIHR5cGUuIik7CiAgICB9CiAgICB0aGlzLiNzcmMgPSB2YWw7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9tZXRhZGF0YS5qcwpjbGFzcyBNZXRhZGF0YSB7CiAgI21hcDsKICAjZGF0YTsKICBjb25zdHJ1Y3Rvcih7CiAgICBwYXJzZWREYXRhLAogICAgcmF3RGF0YQogIH0pIHsKICAgIHRoaXMuI21hcCA9IHBhcnNlZERhdGE7CiAgICB0aGlzLiNkYXRhID0gcmF3RGF0YTsKICB9CiAgZ2V0UmF3KCkgewogICAgcmV0dXJuIHRoaXMuI2RhdGE7CiAgfQogIGdldChuYW1lKSB7CiAgICByZXR1cm4gdGhpcy4jbWFwLmdldChuYW1lKSA/PyBudWxsOwogIH0KICBbU3ltYm9sLml0ZXJhdG9yXSgpIHsKICAgIHJldHVybiB0aGlzLiNtYXAuZW50cmllcygpOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvb3B0aW9uYWxfY29udGVudF9jb25maWcuanMKCgpjb25zdCBJTlRFUk5BTCA9IFN5bWJvbCgiSU5URVJOQUwiKTsKY2xhc3MgT3B0aW9uYWxDb250ZW50R3JvdXAgewogICNpc0Rpc3BsYXkgPSBmYWxzZTsKICAjaXNQcmludCA9IGZhbHNlOwogICN1c2VyU2V0ID0gZmFsc2U7CiAgI3Zpc2libGUgPSB0cnVlOwogIGNvbnN0cnVjdG9yKHJlbmRlcmluZ0ludGVudCwgewogICAgbmFtZSwKICAgIGludGVudCwKICAgIHVzYWdlLAogICAgcmJHcm91cHMKICB9KSB7CiAgICB0aGlzLiNpc0Rpc3BsYXkgPSAhIShyZW5kZXJpbmdJbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkRJU1BMQVkpOwogICAgdGhpcy4jaXNQcmludCA9ICEhKHJlbmRlcmluZ0ludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuUFJJTlQpOwogICAgdGhpcy5uYW1lID0gbmFtZTsKICAgIHRoaXMuaW50ZW50ID0gaW50ZW50OwogICAgdGhpcy51c2FnZSA9IHVzYWdlOwogICAgdGhpcy5yYkdyb3VwcyA9IHJiR3JvdXBzOwogIH0KICBnZXQgdmlzaWJsZSgpIHsKICAgIGlmICh0aGlzLiN1c2VyU2V0KSB7CiAgICAgIHJldHVybiB0aGlzLiN2aXNpYmxlOwogICAgfQogICAgaWYgKCF0aGlzLiN2aXNpYmxlKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgcHJpbnQsCiAgICAgIHZpZXcKICAgIH0gPSB0aGlzLnVzYWdlOwogICAgaWYgKHRoaXMuI2lzRGlzcGxheSkgewogICAgICByZXR1cm4gdmlldz8udmlld1N0YXRlICE9PSAiT0ZGIjsKICAgIH0gZWxzZSBpZiAodGhpcy4jaXNQcmludCkgewogICAgICByZXR1cm4gcHJpbnQ/LnByaW50U3RhdGUgIT09ICJPRkYiOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIF9zZXRWaXNpYmxlKGludGVybmFsLCB2aXNpYmxlLCB1c2VyU2V0ID0gZmFsc2UpIHsKICAgIGlmIChpbnRlcm5hbCAhPT0gSU5URVJOQUwpIHsKICAgICAgdW5yZWFjaGFibGUoIkludGVybmFsIG1ldGhvZCBgX3NldFZpc2libGVgIGNhbGxlZC4iKTsKICAgIH0KICAgIHRoaXMuI3VzZXJTZXQgPSB1c2VyU2V0OwogICAgdGhpcy4jdmlzaWJsZSA9IHZpc2libGU7CiAgfQp9CmNsYXNzIE9wdGlvbmFsQ29udGVudENvbmZpZyB7CiAgI2NhY2hlZEdldEhhc2ggPSBudWxsOwogICNncm91cHMgPSBuZXcgTWFwKCk7CiAgI2luaXRpYWxIYXNoID0gbnVsbDsKICAjb3JkZXIgPSBudWxsOwogIGNvbnN0cnVjdG9yKGRhdGEsIHJlbmRlcmluZ0ludGVudCA9IFJlbmRlcmluZ0ludGVudEZsYWcuRElTUExBWSkgewogICAgdGhpcy5yZW5kZXJpbmdJbnRlbnQgPSByZW5kZXJpbmdJbnRlbnQ7CiAgICB0aGlzLm5hbWUgPSBudWxsOwogICAgdGhpcy5jcmVhdG9yID0gbnVsbDsKICAgIGlmIChkYXRhID09PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMubmFtZSA9IGRhdGEubmFtZTsKICAgIHRoaXMuY3JlYXRvciA9IGRhdGEuY3JlYXRvcjsKICAgIHRoaXMuI29yZGVyID0gZGF0YS5vcmRlcjsKICAgIGZvciAoY29uc3QgZ3JvdXAgb2YgZGF0YS5ncm91cHMpIHsKICAgICAgdGhpcy4jZ3JvdXBzLnNldChncm91cC5pZCwgbmV3IE9wdGlvbmFsQ29udGVudEdyb3VwKHJlbmRlcmluZ0ludGVudCwgZ3JvdXApKTsKICAgIH0KICAgIGlmIChkYXRhLmJhc2VTdGF0ZSA9PT0gIk9GRiIpIHsKICAgICAgZm9yIChjb25zdCBncm91cCBvZiB0aGlzLiNncm91cHMudmFsdWVzKCkpIHsKICAgICAgICBncm91cC5fc2V0VmlzaWJsZShJTlRFUk5BTCwgZmFsc2UpOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IG9uIG9mIGRhdGEub24pIHsKICAgICAgdGhpcy4jZ3JvdXBzLmdldChvbikuX3NldFZpc2libGUoSU5URVJOQUwsIHRydWUpOwogICAgfQogICAgZm9yIChjb25zdCBvZmYgb2YgZGF0YS5vZmYpIHsKICAgICAgdGhpcy4jZ3JvdXBzLmdldChvZmYpLl9zZXRWaXNpYmxlKElOVEVSTkFMLCBmYWxzZSk7CiAgICB9CiAgICB0aGlzLiNpbml0aWFsSGFzaCA9IHRoaXMuZ2V0SGFzaCgpOwogIH0KICAjZXZhbHVhdGVWaXNpYmlsaXR5RXhwcmVzc2lvbihhcnJheSkgewogICAgY29uc3QgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgaWYgKGxlbmd0aCA8IDIpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBjb25zdCBvcGVyYXRvciA9IGFycmF5WzBdOwogICAgZm9yIChsZXQgaSA9IDE7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBjb25zdCBlbGVtZW50ID0gYXJyYXlbaV07CiAgICAgIGxldCBzdGF0ZTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZWxlbWVudCkpIHsKICAgICAgICBzdGF0ZSA9IHRoaXMuI2V2YWx1YXRlVmlzaWJpbGl0eUV4cHJlc3Npb24oZWxlbWVudCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy4jZ3JvdXBzLmhhcyhlbGVtZW50KSkgewogICAgICAgIHN0YXRlID0gdGhpcy4jZ3JvdXBzLmdldChlbGVtZW50KS52aXNpYmxlOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oYE9wdGlvbmFsIGNvbnRlbnQgZ3JvdXAgbm90IGZvdW5kOiAke2VsZW1lbnR9YCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChvcGVyYXRvcikgewogICAgICAgIGNhc2UgIkFuZCI6CiAgICAgICAgICBpZiAoIXN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIk9yIjoKICAgICAgICAgIGlmIChzdGF0ZSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIk5vdCI6CiAgICAgICAgICByZXR1cm4gIXN0YXRlOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG9wZXJhdG9yID09PSAiQW5kIjsKICB9CiAgaXNWaXNpYmxlKGdyb3VwKSB7CiAgICBpZiAodGhpcy4jZ3JvdXBzLnNpemUgPT09IDApIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoIWdyb3VwKSB7CiAgICAgIGluZm8oIk9wdGlvbmFsIGNvbnRlbnQgZ3JvdXAgbm90IGRlZmluZWQuIik7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKGdyb3VwLnR5cGUgPT09ICJPQ0ciKSB7CiAgICAgIGlmICghdGhpcy4jZ3JvdXBzLmhhcyhncm91cC5pZCkpIHsKICAgICAgICB3YXJuKGBPcHRpb25hbCBjb250ZW50IGdyb3VwIG5vdCBmb3VuZDogJHtncm91cC5pZH1gKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy4jZ3JvdXBzLmdldChncm91cC5pZCkudmlzaWJsZTsKICAgIH0gZWxzZSBpZiAoZ3JvdXAudHlwZSA9PT0gIk9DTUQiKSB7CiAgICAgIGlmIChncm91cC5leHByZXNzaW9uKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI2V2YWx1YXRlVmlzaWJpbGl0eUV4cHJlc3Npb24oZ3JvdXAuZXhwcmVzc2lvbik7CiAgICAgIH0KICAgICAgaWYgKCFncm91cC5wb2xpY3kgfHwgZ3JvdXAucG9saWN5ID09PSAiQW55T24iKSB7CiAgICAgICAgZm9yIChjb25zdCBpZCBvZiBncm91cC5pZHMpIHsKICAgICAgICAgIGlmICghdGhpcy4jZ3JvdXBzLmhhcyhpZCkpIHsKICAgICAgICAgICAgd2FybihgT3B0aW9uYWwgY29udGVudCBncm91cCBub3QgZm91bmQ6ICR7aWR9YCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuI2dyb3Vwcy5nZXQoaWQpLnZpc2libGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIGlmIChncm91cC5wb2xpY3kgPT09ICJBbGxPbiIpIHsKICAgICAgICBmb3IgKGNvbnN0IGlkIG9mIGdyb3VwLmlkcykgewogICAgICAgICAgaWYgKCF0aGlzLiNncm91cHMuaGFzKGlkKSkgewogICAgICAgICAgICB3YXJuKGBPcHRpb25hbCBjb250ZW50IGdyb3VwIG5vdCBmb3VuZDogJHtpZH1gKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXRoaXMuI2dyb3Vwcy5nZXQoaWQpLnZpc2libGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIGlmIChncm91cC5wb2xpY3kgPT09ICJBbnlPZmYiKSB7CiAgICAgICAgZm9yIChjb25zdCBpZCBvZiBncm91cC5pZHMpIHsKICAgICAgICAgIGlmICghdGhpcy4jZ3JvdXBzLmhhcyhpZCkpIHsKICAgICAgICAgICAgd2FybihgT3B0aW9uYWwgY29udGVudCBncm91cCBub3QgZm91bmQ6ICR7aWR9YCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCF0aGlzLiNncm91cHMuZ2V0KGlkKS52aXNpYmxlKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAoZ3JvdXAucG9saWN5ID09PSAiQWxsT2ZmIikgewogICAgICAgIGZvciAoY29uc3QgaWQgb2YgZ3JvdXAuaWRzKSB7CiAgICAgICAgICBpZiAoIXRoaXMuI2dyb3Vwcy5oYXMoaWQpKSB7CiAgICAgICAgICAgIHdhcm4oYE9wdGlvbmFsIGNvbnRlbnQgZ3JvdXAgbm90IGZvdW5kOiAke2lkfWApOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLiNncm91cHMuZ2V0KGlkKS52aXNpYmxlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgd2FybihgVW5rbm93biBvcHRpb25hbCBjb250ZW50IHBvbGljeSAke2dyb3VwLnBvbGljeX0uYCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgd2FybihgVW5rbm93biBncm91cCB0eXBlICR7Z3JvdXAudHlwZX0uYCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgc2V0VmlzaWJpbGl0eShpZCwgdmlzaWJsZSA9IHRydWUsIHByZXNlcnZlUkIgPSB0cnVlKSB7CiAgICBjb25zdCBncm91cCA9IHRoaXMuI2dyb3Vwcy5nZXQoaWQpOwogICAgaWYgKCFncm91cCkgewogICAgICB3YXJuKGBPcHRpb25hbCBjb250ZW50IGdyb3VwIG5vdCBmb3VuZDogJHtpZH1gKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHByZXNlcnZlUkIgJiYgdmlzaWJsZSAmJiBncm91cC5yYkdyb3Vwcy5sZW5ndGgpIHsKICAgICAgZm9yIChjb25zdCByYkdyb3VwIG9mIGdyb3VwLnJiR3JvdXBzKSB7CiAgICAgICAgZm9yIChjb25zdCBvdGhlcklkIG9mIHJiR3JvdXApIHsKICAgICAgICAgIGlmIChvdGhlcklkICE9PSBpZCkgewogICAgICAgICAgICB0aGlzLiNncm91cHMuZ2V0KG90aGVySWQpPy5fc2V0VmlzaWJsZShJTlRFUk5BTCwgZmFsc2UsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZ3JvdXAuX3NldFZpc2libGUoSU5URVJOQUwsICEhdmlzaWJsZSwgdHJ1ZSk7CiAgICB0aGlzLiNjYWNoZWRHZXRIYXNoID0gbnVsbDsKICB9CiAgc2V0T0NHU3RhdGUoewogICAgc3RhdGUsCiAgICBwcmVzZXJ2ZVJCCiAgfSkgewogICAgbGV0IG9wZXJhdG9yOwogICAgZm9yIChjb25zdCBlbGVtIG9mIHN0YXRlKSB7CiAgICAgIHN3aXRjaCAoZWxlbSkgewogICAgICAgIGNhc2UgIk9OIjoKICAgICAgICBjYXNlICJPRkYiOgogICAgICAgIGNhc2UgIlRvZ2dsZSI6CiAgICAgICAgICBvcGVyYXRvciA9IGVsZW07CiAgICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBncm91cCA9IHRoaXMuI2dyb3Vwcy5nZXQoZWxlbSk7CiAgICAgIGlmICghZ3JvdXApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7CiAgICAgICAgY2FzZSAiT04iOgogICAgICAgICAgdGhpcy5zZXRWaXNpYmlsaXR5KGVsZW0sIHRydWUsIHByZXNlcnZlUkIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiT0ZGIjoKICAgICAgICAgIHRoaXMuc2V0VmlzaWJpbGl0eShlbGVtLCBmYWxzZSwgcHJlc2VydmVSQik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJUb2dnbGUiOgogICAgICAgICAgdGhpcy5zZXRWaXNpYmlsaXR5KGVsZW0sICFncm91cC52aXNpYmxlLCBwcmVzZXJ2ZVJCKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICB0aGlzLiNjYWNoZWRHZXRIYXNoID0gbnVsbDsKICB9CiAgZ2V0IGhhc0luaXRpYWxWaXNpYmlsaXR5KCkgewogICAgcmV0dXJuIHRoaXMuI2luaXRpYWxIYXNoID09PSBudWxsIHx8IHRoaXMuZ2V0SGFzaCgpID09PSB0aGlzLiNpbml0aWFsSGFzaDsKICB9CiAgZ2V0T3JkZXIoKSB7CiAgICBpZiAoIXRoaXMuI2dyb3Vwcy5zaXplKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKHRoaXMuI29yZGVyKSB7CiAgICAgIHJldHVybiB0aGlzLiNvcmRlci5zbGljZSgpOwogICAgfQogICAgcmV0dXJuIFsuLi50aGlzLiNncm91cHMua2V5cygpXTsKICB9CiAgZ2V0R3JvdXAoaWQpIHsKICAgIHJldHVybiB0aGlzLiNncm91cHMuZ2V0KGlkKSB8fCBudWxsOwogIH0KICBnZXRIYXNoKCkgewogICAgaWYgKHRoaXMuI2NhY2hlZEdldEhhc2ggIT09IG51bGwpIHsKICAgICAgcmV0dXJuIHRoaXMuI2NhY2hlZEdldEhhc2g7CiAgICB9CiAgICBjb25zdCBoYXNoID0gbmV3IE11cm11ckhhc2gzXzY0KCk7CiAgICBmb3IgKGNvbnN0IFtpZCwgZ3JvdXBdIG9mIHRoaXMuI2dyb3VwcykgewogICAgICBoYXNoLnVwZGF0ZShgJHtpZH06JHtncm91cC52aXNpYmxlfWApOwogICAgfQogICAgcmV0dXJuIHRoaXMuI2NhY2hlZEdldEhhc2ggPSBoYXNoLmhleGRpZ2VzdCgpOwogIH0KICBbU3ltYm9sLml0ZXJhdG9yXSgpIHsKICAgIHJldHVybiB0aGlzLiNncm91cHMuZW50cmllcygpOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvdHJhbnNwb3J0X3N0cmVhbS5qcwoKCmNsYXNzIFBERkRhdGFUcmFuc3BvcnRTdHJlYW0gewogIGNvbnN0cnVjdG9yKHBkZkRhdGFSYW5nZVRyYW5zcG9ydCwgewogICAgZGlzYWJsZVJhbmdlID0gZmFsc2UsCiAgICBkaXNhYmxlU3RyZWFtID0gZmFsc2UKICB9KSB7CiAgICBhc3NlcnQocGRmRGF0YVJhbmdlVHJhbnNwb3J0LCAnUERGRGF0YVRyYW5zcG9ydFN0cmVhbSAtIG1pc3NpbmcgcmVxdWlyZWQgInBkZkRhdGFSYW5nZVRyYW5zcG9ydCIgYXJndW1lbnQuJyk7CiAgICBjb25zdCB7CiAgICAgIGxlbmd0aCwKICAgICAgaW5pdGlhbERhdGEsCiAgICAgIHByb2dyZXNzaXZlRG9uZSwKICAgICAgY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWUKICAgIH0gPSBwZGZEYXRhUmFuZ2VUcmFuc3BvcnQ7CiAgICB0aGlzLl9xdWV1ZWRDaHVua3MgPSBbXTsKICAgIHRoaXMuX3Byb2dyZXNzaXZlRG9uZSA9IHByb2dyZXNzaXZlRG9uZTsKICAgIHRoaXMuX2NvbnRlbnREaXNwb3NpdGlvbkZpbGVuYW1lID0gY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWU7CiAgICBpZiAoaW5pdGlhbERhdGE/Lmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgYnVmZmVyID0gaW5pdGlhbERhdGEgaW5zdGFuY2VvZiBVaW50OEFycmF5ICYmIGluaXRpYWxEYXRhLmJ5dGVMZW5ndGggPT09IGluaXRpYWxEYXRhLmJ1ZmZlci5ieXRlTGVuZ3RoID8gaW5pdGlhbERhdGEuYnVmZmVyIDogbmV3IFVpbnQ4QXJyYXkoaW5pdGlhbERhdGEpLmJ1ZmZlcjsKICAgICAgdGhpcy5fcXVldWVkQ2h1bmtzLnB1c2goYnVmZmVyKTsKICAgIH0KICAgIHRoaXMuX3BkZkRhdGFSYW5nZVRyYW5zcG9ydCA9IHBkZkRhdGFSYW5nZVRyYW5zcG9ydDsKICAgIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkID0gIWRpc2FibGVTdHJlYW07CiAgICB0aGlzLl9pc1JhbmdlU3VwcG9ydGVkID0gIWRpc2FibGVSYW5nZTsKICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBsZW5ndGg7CiAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciA9IG51bGw7CiAgICB0aGlzLl9yYW5nZVJlYWRlcnMgPSBbXTsKICAgIHBkZkRhdGFSYW5nZVRyYW5zcG9ydC5hZGRSYW5nZUxpc3RlbmVyKChiZWdpbiwgY2h1bmspID0+IHsKICAgICAgdGhpcy5fb25SZWNlaXZlRGF0YSh7CiAgICAgICAgYmVnaW4sCiAgICAgICAgY2h1bmsKICAgICAgfSk7CiAgICB9KTsKICAgIHBkZkRhdGFSYW5nZVRyYW5zcG9ydC5hZGRQcm9ncmVzc0xpc3RlbmVyKChsb2FkZWQsIHRvdGFsKSA9PiB7CiAgICAgIHRoaXMuX29uUHJvZ3Jlc3MoewogICAgICAgIGxvYWRlZCwKICAgICAgICB0b3RhbAogICAgICB9KTsKICAgIH0pOwogICAgcGRmRGF0YVJhbmdlVHJhbnNwb3J0LmFkZFByb2dyZXNzaXZlUmVhZExpc3RlbmVyKGNodW5rID0+IHsKICAgICAgdGhpcy5fb25SZWNlaXZlRGF0YSh7CiAgICAgICAgY2h1bmsKICAgICAgfSk7CiAgICB9KTsKICAgIHBkZkRhdGFSYW5nZVRyYW5zcG9ydC5hZGRQcm9ncmVzc2l2ZURvbmVMaXN0ZW5lcigoKSA9PiB7CiAgICAgIHRoaXMuX29uUHJvZ3Jlc3NpdmVEb25lKCk7CiAgICB9KTsKICAgIHBkZkRhdGFSYW5nZVRyYW5zcG9ydC50cmFuc3BvcnRSZWFkeSgpOwogIH0KICBfb25SZWNlaXZlRGF0YSh7CiAgICBiZWdpbiwKICAgIGNodW5rCiAgfSkgewogICAgY29uc3QgYnVmZmVyID0gY2h1bmsgaW5zdGFuY2VvZiBVaW50OEFycmF5ICYmIGNodW5rLmJ5dGVMZW5ndGggPT09IGNodW5rLmJ1ZmZlci5ieXRlTGVuZ3RoID8gY2h1bmsuYnVmZmVyIDogbmV3IFVpbnQ4QXJyYXkoY2h1bmspLmJ1ZmZlcjsKICAgIGlmIChiZWdpbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICh0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcikgewogICAgICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyLl9lbnF1ZXVlKGJ1ZmZlcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fcXVldWVkQ2h1bmtzLnB1c2goYnVmZmVyKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZm91bmQgPSB0aGlzLl9yYW5nZVJlYWRlcnMuc29tZShmdW5jdGlvbiAocmFuZ2VSZWFkZXIpIHsKICAgICAgICBpZiAocmFuZ2VSZWFkZXIuX2JlZ2luICE9PSBiZWdpbikgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByYW5nZVJlYWRlci5fZW5xdWV1ZShidWZmZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9KTsKICAgICAgYXNzZXJ0KGZvdW5kLCAiX29uUmVjZWl2ZURhdGEgLSBubyBgUERGRGF0YVRyYW5zcG9ydFN0cmVhbVJhbmdlUmVhZGVyYCBpbnN0YW5jZSBmb3VuZC4iKTsKICAgIH0KICB9CiAgZ2V0IF9wcm9ncmVzc2l2ZURhdGFMZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXI/Ll9sb2FkZWQgPz8gMDsKICB9CiAgX29uUHJvZ3Jlc3MoZXZ0KSB7CiAgICBpZiAoZXZ0LnRvdGFsID09PSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy5fcmFuZ2VSZWFkZXJzWzBdPy5vblByb2dyZXNzPy4oewogICAgICAgIGxvYWRlZDogZXZ0LmxvYWRlZAogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyPy5vblByb2dyZXNzPy4oewogICAgICAgIGxvYWRlZDogZXZ0LmxvYWRlZCwKICAgICAgICB0b3RhbDogZXZ0LnRvdGFsCiAgICAgIH0pOwogICAgfQogIH0KICBfb25Qcm9ncmVzc2l2ZURvbmUoKSB7CiAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcj8ucHJvZ3Jlc3NpdmVEb25lKCk7CiAgICB0aGlzLl9wcm9ncmVzc2l2ZURvbmUgPSB0cnVlOwogIH0KICBfcmVtb3ZlUmFuZ2VSZWFkZXIocmVhZGVyKSB7CiAgICBjb25zdCBpID0gdGhpcy5fcmFuZ2VSZWFkZXJzLmluZGV4T2YocmVhZGVyKTsKICAgIGlmIChpID49IDApIHsKICAgICAgdGhpcy5fcmFuZ2VSZWFkZXJzLnNwbGljZShpLCAxKTsKICAgIH0KICB9CiAgZ2V0RnVsbFJlYWRlcigpIHsKICAgIGFzc2VydCghdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIsICJQREZEYXRhVHJhbnNwb3J0U3RyZWFtLmdldEZ1bGxSZWFkZXIgY2FuIG9ubHkgYmUgY2FsbGVkIG9uY2UuIik7CiAgICBjb25zdCBxdWV1ZWRDaHVua3MgPSB0aGlzLl9xdWV1ZWRDaHVua3M7CiAgICB0aGlzLl9xdWV1ZWRDaHVua3MgPSBudWxsOwogICAgcmV0dXJuIG5ldyBQREZEYXRhVHJhbnNwb3J0U3RyZWFtUmVhZGVyKHRoaXMsIHF1ZXVlZENodW5rcywgdGhpcy5fcHJvZ3Jlc3NpdmVEb25lLCB0aGlzLl9jb250ZW50RGlzcG9zaXRpb25GaWxlbmFtZSk7CiAgfQogIGdldFJhbmdlUmVhZGVyKGJlZ2luLCBlbmQpIHsKICAgIGlmIChlbmQgPD0gdGhpcy5fcHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgcmVhZGVyID0gbmV3IFBERkRhdGFUcmFuc3BvcnRTdHJlYW1SYW5nZVJlYWRlcih0aGlzLCBiZWdpbiwgZW5kKTsKICAgIHRoaXMuX3BkZkRhdGFSYW5nZVRyYW5zcG9ydC5yZXF1ZXN0RGF0YVJhbmdlKGJlZ2luLCBlbmQpOwogICAgdGhpcy5fcmFuZ2VSZWFkZXJzLnB1c2gocmVhZGVyKTsKICAgIHJldHVybiByZWFkZXI7CiAgfQogIGNhbmNlbEFsbFJlcXVlc3RzKHJlYXNvbikgewogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXI/LmNhbmNlbChyZWFzb24pOwogICAgZm9yIChjb25zdCByZWFkZXIgb2YgdGhpcy5fcmFuZ2VSZWFkZXJzLnNsaWNlKDApKSB7CiAgICAgIHJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgIH0KICAgIHRoaXMuX3BkZkRhdGFSYW5nZVRyYW5zcG9ydC5hYm9ydCgpOwogIH0KfQpjbGFzcyBQREZEYXRhVHJhbnNwb3J0U3RyZWFtUmVhZGVyIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIHF1ZXVlZENodW5rcywgcHJvZ3Jlc3NpdmVEb25lID0gZmFsc2UsIGNvbnRlbnREaXNwb3NpdGlvbkZpbGVuYW1lID0gbnVsbCkgewogICAgdGhpcy5fc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5fZG9uZSA9IHByb2dyZXNzaXZlRG9uZSB8fCBmYWxzZTsKICAgIHRoaXMuX2ZpbGVuYW1lID0gaXNQZGZGaWxlKGNvbnRlbnREaXNwb3NpdGlvbkZpbGVuYW1lKSA/IGNvbnRlbnREaXNwb3NpdGlvbkZpbGVuYW1lIDogbnVsbDsKICAgIHRoaXMuX3F1ZXVlZENodW5rcyA9IHF1ZXVlZENodW5rcyB8fCBbXTsKICAgIHRoaXMuX2xvYWRlZCA9IDA7CiAgICBmb3IgKGNvbnN0IGNodW5rIG9mIHRoaXMuX3F1ZXVlZENodW5rcykgewogICAgICB0aGlzLl9sb2FkZWQgKz0gY2h1bmsuYnl0ZUxlbmd0aDsKICAgIH0KICAgIHRoaXMuX3JlcXVlc3RzID0gW107CiAgICB0aGlzLl9oZWFkZXJzUmVhZHkgPSBQcm9taXNlLnJlc29sdmUoKTsKICAgIHN0cmVhbS5fZnVsbFJlcXVlc3RSZWFkZXIgPSB0aGlzOwogICAgdGhpcy5vblByb2dyZXNzID0gbnVsbDsKICB9CiAgX2VucXVldWUoY2h1bmspIHsKICAgIGlmICh0aGlzLl9kb25lKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IHJlcXVlc3RDYXBhYmlsaXR5ID0gdGhpcy5fcmVxdWVzdHMuc2hpZnQoKTsKICAgICAgcmVxdWVzdENhcGFiaWxpdHkucmVzb2x2ZSh7CiAgICAgICAgdmFsdWU6IGNodW5rLAogICAgICAgIGRvbmU6IGZhbHNlCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fcXVldWVkQ2h1bmtzLnB1c2goY2h1bmspOwogICAgfQogICAgdGhpcy5fbG9hZGVkICs9IGNodW5rLmJ5dGVMZW5ndGg7CiAgfQogIGdldCBoZWFkZXJzUmVhZHkoKSB7CiAgICByZXR1cm4gdGhpcy5faGVhZGVyc1JlYWR5OwogIH0KICBnZXQgZmlsZW5hbWUoKSB7CiAgICByZXR1cm4gdGhpcy5fZmlsZW5hbWU7CiAgfQogIGdldCBpc1JhbmdlU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHRoaXMuX3N0cmVhbS5faXNSYW5nZVN1cHBvcnRlZDsKICB9CiAgZ2V0IGlzU3RyZWFtaW5nU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHRoaXMuX3N0cmVhbS5faXNTdHJlYW1pbmdTdXBwb3J0ZWQ7CiAgfQogIGdldCBjb250ZW50TGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX3N0cmVhbS5fY29udGVudExlbmd0aDsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGlmICh0aGlzLl9xdWV1ZWRDaHVua3MubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBjaHVuayA9IHRoaXMuX3F1ZXVlZENodW5rcy5zaGlmdCgpOwogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiBjaHVuaywKICAgICAgICBkb25lOiBmYWxzZQogICAgICB9OwogICAgfQogICAgaWYgKHRoaXMuX2RvbmUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgIGRvbmU6IHRydWUKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IHJlcXVlc3RDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICB0aGlzLl9yZXF1ZXN0cy5wdXNoKHJlcXVlc3RDYXBhYmlsaXR5KTsKICAgIHJldHVybiByZXF1ZXN0Q2FwYWJpbGl0eS5wcm9taXNlOwogIH0KICBjYW5jZWwocmVhc29uKSB7CiAgICB0aGlzLl9kb25lID0gdHJ1ZTsKICAgIGZvciAoY29uc3QgcmVxdWVzdENhcGFiaWxpdHkgb2YgdGhpcy5fcmVxdWVzdHMpIHsKICAgICAgcmVxdWVzdENhcGFiaWxpdHkucmVzb2x2ZSh7CiAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICBkb25lOiB0cnVlCiAgICAgIH0pOwogICAgfQogICAgdGhpcy5fcmVxdWVzdHMubGVuZ3RoID0gMDsKICB9CiAgcHJvZ3Jlc3NpdmVEb25lKCkgewogICAgaWYgKHRoaXMuX2RvbmUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fZG9uZSA9IHRydWU7CiAgfQp9CmNsYXNzIFBERkRhdGFUcmFuc3BvcnRTdHJlYW1SYW5nZVJlYWRlciB7CiAgY29uc3RydWN0b3Ioc3RyZWFtLCBiZWdpbiwgZW5kKSB7CiAgICB0aGlzLl9zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLl9iZWdpbiA9IGJlZ2luOwogICAgdGhpcy5fZW5kID0gZW5kOwogICAgdGhpcy5fcXVldWVkQ2h1bmsgPSBudWxsOwogICAgdGhpcy5fcmVxdWVzdHMgPSBbXTsKICAgIHRoaXMuX2RvbmUgPSBmYWxzZTsKICAgIHRoaXMub25Qcm9ncmVzcyA9IG51bGw7CiAgfQogIF9lbnF1ZXVlKGNodW5rKSB7CiAgICBpZiAodGhpcy5fZG9uZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5fcmVxdWVzdHMubGVuZ3RoID09PSAwKSB7CiAgICAgIHRoaXMuX3F1ZXVlZENodW5rID0gY2h1bms7CiAgICB9IGVsc2UgewogICAgICBjb25zdCByZXF1ZXN0c0NhcGFiaWxpdHkgPSB0aGlzLl9yZXF1ZXN0cy5zaGlmdCgpOwogICAgICByZXF1ZXN0c0NhcGFiaWxpdHkucmVzb2x2ZSh7CiAgICAgICAgdmFsdWU6IGNodW5rLAogICAgICAgIGRvbmU6IGZhbHNlCiAgICAgIH0pOwogICAgICBmb3IgKGNvbnN0IHJlcXVlc3RDYXBhYmlsaXR5IG9mIHRoaXMuX3JlcXVlc3RzKSB7CiAgICAgICAgcmVxdWVzdENhcGFiaWxpdHkucmVzb2x2ZSh7CiAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgICAgZG9uZTogdHJ1ZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMuX3JlcXVlc3RzLmxlbmd0aCA9IDA7CiAgICB9CiAgICB0aGlzLl9kb25lID0gdHJ1ZTsKICAgIHRoaXMuX3N0cmVhbS5fcmVtb3ZlUmFuZ2VSZWFkZXIodGhpcyk7CiAgfQogIGdldCBpc1N0cmVhbWluZ1N1cHBvcnRlZCgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGlmICh0aGlzLl9xdWV1ZWRDaHVuaykgewogICAgICBjb25zdCBjaHVuayA9IHRoaXMuX3F1ZXVlZENodW5rOwogICAgICB0aGlzLl9xdWV1ZWRDaHVuayA9IG51bGw7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IGNodW5rLAogICAgICAgIGRvbmU6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICBpZiAodGhpcy5fZG9uZSkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgZG9uZTogdHJ1ZQogICAgICB9OwogICAgfQogICAgY29uc3QgcmVxdWVzdENhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRoaXMuX3JlcXVlc3RzLnB1c2gocmVxdWVzdENhcGFiaWxpdHkpOwogICAgcmV0dXJuIHJlcXVlc3RDYXBhYmlsaXR5LnByb21pc2U7CiAgfQogIGNhbmNlbChyZWFzb24pIHsKICAgIHRoaXMuX2RvbmUgPSB0cnVlOwogICAgZm9yIChjb25zdCByZXF1ZXN0Q2FwYWJpbGl0eSBvZiB0aGlzLl9yZXF1ZXN0cykgewogICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgIGRvbmU6IHRydWUKICAgICAgfSk7CiAgICB9CiAgICB0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPSAwOwogICAgdGhpcy5fc3RyZWFtLl9yZW1vdmVSYW5nZVJlYWRlcih0aGlzKTsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L2NvbnRlbnRfZGlzcG9zaXRpb24uanMKCmZ1bmN0aW9uIGdldEZpbGVuYW1lRnJvbUNvbnRlbnREaXNwb3NpdGlvbkhlYWRlcihjb250ZW50RGlzcG9zaXRpb24pIHsKICBsZXQgbmVlZHNFbmNvZGluZ0ZpeHVwID0gdHJ1ZTsKICBsZXQgdG1wID0gdG9QYXJhbVJlZ0V4cCgiZmlsZW5hbWVcXCoiLCAiaSIpLmV4ZWMoY29udGVudERpc3Bvc2l0aW9uKTsKICBpZiAodG1wKSB7CiAgICB0bXAgPSB0bXBbMV07CiAgICBsZXQgZmlsZW5hbWUgPSByZmMyNjE2dW5xdW90ZSh0bXApOwogICAgZmlsZW5hbWUgPSB1bmVzY2FwZShmaWxlbmFtZSk7CiAgICBmaWxlbmFtZSA9IHJmYzU5ODdkZWNvZGUoZmlsZW5hbWUpOwogICAgZmlsZW5hbWUgPSByZmMyMDQ3ZGVjb2RlKGZpbGVuYW1lKTsKICAgIHJldHVybiBmaXh1cEVuY29kaW5nKGZpbGVuYW1lKTsKICB9CiAgdG1wID0gcmZjMjIzMWdldHBhcmFtKGNvbnRlbnREaXNwb3NpdGlvbik7CiAgaWYgKHRtcCkgewogICAgY29uc3QgZmlsZW5hbWUgPSByZmMyMDQ3ZGVjb2RlKHRtcCk7CiAgICByZXR1cm4gZml4dXBFbmNvZGluZyhmaWxlbmFtZSk7CiAgfQogIHRtcCA9IHRvUGFyYW1SZWdFeHAoImZpbGVuYW1lIiwgImkiKS5leGVjKGNvbnRlbnREaXNwb3NpdGlvbik7CiAgaWYgKHRtcCkgewogICAgdG1wID0gdG1wWzFdOwogICAgbGV0IGZpbGVuYW1lID0gcmZjMjYxNnVucXVvdGUodG1wKTsKICAgIGZpbGVuYW1lID0gcmZjMjA0N2RlY29kZShmaWxlbmFtZSk7CiAgICByZXR1cm4gZml4dXBFbmNvZGluZyhmaWxlbmFtZSk7CiAgfQogIGZ1bmN0aW9uIHRvUGFyYW1SZWdFeHAoYXR0cmlidXRlUGF0dGVybiwgZmxhZ3MpIHsKICAgIHJldHVybiBuZXcgUmVnRXhwKCIoPzpefDspXFxzKiIgKyBhdHRyaWJ1dGVQYXR0ZXJuICsgIlxccyo9XFxzKiIgKyAiKCIgKyAnW14iO1xcc11bXjtcXHNdKicgKyAifCIgKyAnIig/OlteIlxcXFxdfFxcXFwiPykrIj8nICsgIikiLCBmbGFncyk7CiAgfQogIGZ1bmN0aW9uIHRleHRkZWNvZGUoZW5jb2RpbmcsIHZhbHVlKSB7CiAgICBpZiAoZW5jb2RpbmcpIHsKICAgICAgaWYgKCEvXltceDAwLVx4RkZdKyQvLnRlc3QodmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcihlbmNvZGluZywgewogICAgICAgICAgZmF0YWw6IHRydWUKICAgICAgICB9KTsKICAgICAgICBjb25zdCBidWZmZXIgPSBzdHJpbmdUb0J5dGVzKHZhbHVlKTsKICAgICAgICB2YWx1ZSA9IGRlY29kZXIuZGVjb2RlKGJ1ZmZlcik7CiAgICAgICAgbmVlZHNFbmNvZGluZ0ZpeHVwID0gZmFsc2U7CiAgICAgIH0gY2F0Y2gge30KICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9CiAgZnVuY3Rpb24gZml4dXBFbmNvZGluZyh2YWx1ZSkgewogICAgaWYgKG5lZWRzRW5jb2RpbmdGaXh1cCAmJiAvW1x4ODAtXHhmZl0vLnRlc3QodmFsdWUpKSB7CiAgICAgIHZhbHVlID0gdGV4dGRlY29kZSgidXRmLTgiLCB2YWx1ZSk7CiAgICAgIGlmIChuZWVkc0VuY29kaW5nRml4dXApIHsKICAgICAgICB2YWx1ZSA9IHRleHRkZWNvZGUoImlzby04ODU5LTEiLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9CiAgZnVuY3Rpb24gcmZjMjIzMWdldHBhcmFtKGNvbnRlbnREaXNwb3NpdGlvblN0cikgewogICAgY29uc3QgbWF0Y2hlcyA9IFtdOwogICAgbGV0IG1hdGNoOwogICAgY29uc3QgaXRlciA9IHRvUGFyYW1SZWdFeHAoImZpbGVuYW1lXFwqKCg/ITBcXGQpXFxkKykoXFwqPykiLCAiaWciKTsKICAgIHdoaWxlICgobWF0Y2ggPSBpdGVyLmV4ZWMoY29udGVudERpc3Bvc2l0aW9uU3RyKSkgIT09IG51bGwpIHsKICAgICAgbGV0IFssIG4sIHF1b3QsIHBhcnRdID0gbWF0Y2g7CiAgICAgIG4gPSBwYXJzZUludChuLCAxMCk7CiAgICAgIGlmIChuIGluIG1hdGNoZXMpIHsKICAgICAgICBpZiAobiA9PT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIG1hdGNoZXNbbl0gPSBbcXVvdCwgcGFydF07CiAgICB9CiAgICBjb25zdCBwYXJ0cyA9IFtdOwogICAgZm9yIChsZXQgbiA9IDA7IG4gPCBtYXRjaGVzLmxlbmd0aDsgKytuKSB7CiAgICAgIGlmICghKG4gaW4gbWF0Y2hlcykpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBsZXQgW3F1b3QsIHBhcnRdID0gbWF0Y2hlc1tuXTsKICAgICAgcGFydCA9IHJmYzI2MTZ1bnF1b3RlKHBhcnQpOwogICAgICBpZiAocXVvdCkgewogICAgICAgIHBhcnQgPSB1bmVzY2FwZShwYXJ0KTsKICAgICAgICBpZiAobiA9PT0gMCkgewogICAgICAgICAgcGFydCA9IHJmYzU5ODdkZWNvZGUocGFydCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHBhcnRzLnB1c2gocGFydCk7CiAgICB9CiAgICByZXR1cm4gcGFydHMuam9pbigiIik7CiAgfQogIGZ1bmN0aW9uIHJmYzI2MTZ1bnF1b3RlKHZhbHVlKSB7CiAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnIicpKSB7CiAgICAgIGNvbnN0IHBhcnRzID0gdmFsdWUuc2xpY2UoMSkuc3BsaXQoJ1xcIicpOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgY29uc3QgcXVvdGluZGV4ID0gcGFydHNbaV0uaW5kZXhPZignIicpOwogICAgICAgIGlmIChxdW90aW5kZXggIT09IC0xKSB7CiAgICAgICAgICBwYXJ0c1tpXSA9IHBhcnRzW2ldLnNsaWNlKDAsIHF1b3RpbmRleCk7CiAgICAgICAgICBwYXJ0cy5sZW5ndGggPSBpICsgMTsKICAgICAgICB9CiAgICAgICAgcGFydHNbaV0gPSBwYXJ0c1tpXS5yZXBsYWNlQWxsKC9cXCguKS9nLCAiJDEiKTsKICAgICAgfQogICAgICB2YWx1ZSA9IHBhcnRzLmpvaW4oJyInKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9CiAgZnVuY3Rpb24gcmZjNTk4N2RlY29kZShleHR2YWx1ZSkgewogICAgY29uc3QgZW5jb2RpbmdlbmQgPSBleHR2YWx1ZS5pbmRleE9mKCInIik7CiAgICBpZiAoZW5jb2RpbmdlbmQgPT09IC0xKSB7CiAgICAgIHJldHVybiBleHR2YWx1ZTsKICAgIH0KICAgIGNvbnN0IGVuY29kaW5nID0gZXh0dmFsdWUuc2xpY2UoMCwgZW5jb2RpbmdlbmQpOwogICAgY29uc3QgbGFuZ3ZhbHVlID0gZXh0dmFsdWUuc2xpY2UoZW5jb2RpbmdlbmQgKyAxKTsKICAgIGNvbnN0IHZhbHVlID0gbGFuZ3ZhbHVlLnJlcGxhY2UoL15bXiddKicvLCAiIik7CiAgICByZXR1cm4gdGV4dGRlY29kZShlbmNvZGluZywgdmFsdWUpOwogIH0KICBmdW5jdGlvbiByZmMyMDQ3ZGVjb2RlKHZhbHVlKSB7CiAgICBpZiAoIXZhbHVlLnN0YXJ0c1dpdGgoIj0/IikgfHwgL1tceDAwLVx4MTlceDgwLVx4ZmZdLy50ZXN0KHZhbHVlKSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gdmFsdWUucmVwbGFjZUFsbCgvPVw/KFtcdy1dKilcPyhbUXFCYl0pXD8oKD86W14/XXxcPyg/IT0pKSopXD89L2csIGZ1bmN0aW9uIChtYXRjaGVzLCBjaGFyc2V0LCBlbmNvZGluZywgdGV4dCkgewogICAgICBpZiAoZW5jb2RpbmcgPT09ICJxIiB8fCBlbmNvZGluZyA9PT0gIlEiKSB7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZUFsbCgiXyIsICIgIik7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZUFsbCgvPShbMC05YS1mQS1GXXsyfSkvZywgZnVuY3Rpb24gKG1hdGNoLCBoZXgpIHsKICAgICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KGhleCwgMTYpKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdGV4dGRlY29kZShjaGFyc2V0LCB0ZXh0KTsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIHRleHQgPSBhdG9iKHRleHQpOwogICAgICB9IGNhdGNoIHt9CiAgICAgIHJldHVybiB0ZXh0ZGVjb2RlKGNoYXJzZXQsIHRleHQpOwogICAgfSk7CiAgfQogIHJldHVybiAiIjsKfQoKOy8vIC4vc3JjL2Rpc3BsYXkvbmV0d29ya191dGlscy5qcwoKCgpmdW5jdGlvbiBjcmVhdGVIZWFkZXJzKGlzSHR0cCwgaHR0cEhlYWRlcnMpIHsKICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTsKICBpZiAoIWlzSHR0cCB8fCAhaHR0cEhlYWRlcnMgfHwgdHlwZW9mIGh0dHBIZWFkZXJzICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIGhlYWRlcnM7CiAgfQogIGZvciAoY29uc3Qga2V5IGluIGh0dHBIZWFkZXJzKSB7CiAgICBjb25zdCB2YWwgPSBodHRwSGVhZGVyc1trZXldOwogICAgaWYgKHZhbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGhlYWRlcnMuYXBwZW5kKGtleSwgdmFsKTsKICAgIH0KICB9CiAgcmV0dXJuIGhlYWRlcnM7Cn0KZnVuY3Rpb24gZ2V0UmVzcG9uc2VPcmlnaW4odXJsKSB7CiAgcmV0dXJuIFVSTC5wYXJzZSh1cmwpPy5vcmlnaW4gPz8gbnVsbDsKfQpmdW5jdGlvbiB2YWxpZGF0ZVJhbmdlUmVxdWVzdENhcGFiaWxpdGllcyh7CiAgcmVzcG9uc2VIZWFkZXJzLAogIGlzSHR0cCwKICByYW5nZUNodW5rU2l6ZSwKICBkaXNhYmxlUmFuZ2UKfSkgewogIGNvbnN0IHJldHVyblZhbHVlcyA9IHsKICAgIGFsbG93UmFuZ2VSZXF1ZXN0czogZmFsc2UsCiAgICBzdWdnZXN0ZWRMZW5ndGg6IHVuZGVmaW5lZAogIH07CiAgY29uc3QgbGVuZ3RoID0gcGFyc2VJbnQocmVzcG9uc2VIZWFkZXJzLmdldCgiQ29udGVudC1MZW5ndGgiKSwgMTApOwogIGlmICghTnVtYmVyLmlzSW50ZWdlcihsZW5ndGgpKSB7CiAgICByZXR1cm4gcmV0dXJuVmFsdWVzOwogIH0KICByZXR1cm5WYWx1ZXMuc3VnZ2VzdGVkTGVuZ3RoID0gbGVuZ3RoOwogIGlmIChsZW5ndGggPD0gMiAqIHJhbmdlQ2h1bmtTaXplKSB7CiAgICByZXR1cm4gcmV0dXJuVmFsdWVzOwogIH0KICBpZiAoZGlzYWJsZVJhbmdlIHx8ICFpc0h0dHApIHsKICAgIHJldHVybiByZXR1cm5WYWx1ZXM7CiAgfQogIGlmIChyZXNwb25zZUhlYWRlcnMuZ2V0KCJBY2NlcHQtUmFuZ2VzIikgIT09ICJieXRlcyIpIHsKICAgIHJldHVybiByZXR1cm5WYWx1ZXM7CiAgfQogIGNvbnN0IGNvbnRlbnRFbmNvZGluZyA9IHJlc3BvbnNlSGVhZGVycy5nZXQoIkNvbnRlbnQtRW5jb2RpbmciKSB8fCAiaWRlbnRpdHkiOwogIGlmIChjb250ZW50RW5jb2RpbmcgIT09ICJpZGVudGl0eSIpIHsKICAgIHJldHVybiByZXR1cm5WYWx1ZXM7CiAgfQogIHJldHVyblZhbHVlcy5hbGxvd1JhbmdlUmVxdWVzdHMgPSB0cnVlOwogIHJldHVybiByZXR1cm5WYWx1ZXM7Cn0KZnVuY3Rpb24gZXh0cmFjdEZpbGVuYW1lRnJvbUhlYWRlcihyZXNwb25zZUhlYWRlcnMpIHsKICBjb25zdCBjb250ZW50RGlzcG9zaXRpb24gPSByZXNwb25zZUhlYWRlcnMuZ2V0KCJDb250ZW50LURpc3Bvc2l0aW9uIik7CiAgaWYgKGNvbnRlbnREaXNwb3NpdGlvbikgewogICAgbGV0IGZpbGVuYW1lID0gZ2V0RmlsZW5hbWVGcm9tQ29udGVudERpc3Bvc2l0aW9uSGVhZGVyKGNvbnRlbnREaXNwb3NpdGlvbik7CiAgICBpZiAoZmlsZW5hbWUuaW5jbHVkZXMoIiUiKSkgewogICAgICB0cnkgewogICAgICAgIGZpbGVuYW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KGZpbGVuYW1lKTsKICAgICAgfSBjYXRjaCB7fQogICAgfQogICAgaWYgKGlzUGRmRmlsZShmaWxlbmFtZSkpIHsKICAgICAgcmV0dXJuIGZpbGVuYW1lOwogICAgfQogIH0KICByZXR1cm4gbnVsbDsKfQpmdW5jdGlvbiBjcmVhdGVSZXNwb25zZUVycm9yKHN0YXR1cywgdXJsKSB7CiAgcmV0dXJuIG5ldyBSZXNwb25zZUV4Y2VwdGlvbihgVW5leHBlY3RlZCBzZXJ2ZXIgcmVzcG9uc2UgKCR7c3RhdHVzfSkgd2hpbGUgcmV0cmlldmluZyBQREYgIiR7dXJsfSIuYCwgc3RhdHVzLCBzdGF0dXMgPT09IDQwNCB8fCBzdGF0dXMgPT09IDAgJiYgdXJsLnN0YXJ0c1dpdGgoImZpbGU6IikpOwp9CmZ1bmN0aW9uIHZhbGlkYXRlUmVzcG9uc2VTdGF0dXMoc3RhdHVzKSB7CiAgcmV0dXJuIHN0YXR1cyA9PT0gMjAwIHx8IHN0YXR1cyA9PT0gMjA2Owp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9mZXRjaF9zdHJlYW0uanMKCgpmdW5jdGlvbiBjcmVhdGVGZXRjaE9wdGlvbnMoaGVhZGVycywgd2l0aENyZWRlbnRpYWxzLCBhYm9ydENvbnRyb2xsZXIpIHsKICByZXR1cm4gewogICAgbWV0aG9kOiAiR0VUIiwKICAgIGhlYWRlcnMsCiAgICBzaWduYWw6IGFib3J0Q29udHJvbGxlci5zaWduYWwsCiAgICBtb2RlOiAiY29ycyIsCiAgICBjcmVkZW50aWFsczogd2l0aENyZWRlbnRpYWxzID8gImluY2x1ZGUiIDogInNhbWUtb3JpZ2luIiwKICAgIHJlZGlyZWN0OiAiZm9sbG93IgogIH07Cn0KZnVuY3Rpb24gZ2V0QXJyYXlCdWZmZXIodmFsKSB7CiAgaWYgKHZhbCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHsKICAgIHJldHVybiB2YWwuYnVmZmVyOwogIH0KICBpZiAodmFsIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsKICAgIHJldHVybiB2YWw7CiAgfQogIHdhcm4oYGdldEFycmF5QnVmZmVyIC0gdW5leHBlY3RlZCBkYXRhIGZvcm1hdDogJHt2YWx9YCk7CiAgcmV0dXJuIG5ldyBVaW50OEFycmF5KHZhbCkuYnVmZmVyOwp9CmNsYXNzIFBERkZldGNoU3RyZWFtIHsKICBfcmVzcG9uc2VPcmlnaW4gPSBudWxsOwogIGNvbnN0cnVjdG9yKHNvdXJjZSkgewogICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICB0aGlzLmlzSHR0cCA9IC9eaHR0cHM/Oi9pLnRlc3Qoc291cmNlLnVybCk7CiAgICB0aGlzLmhlYWRlcnMgPSBjcmVhdGVIZWFkZXJzKHRoaXMuaXNIdHRwLCBzb3VyY2UuaHR0cEhlYWRlcnMpOwogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBudWxsOwogICAgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycyA9IFtdOwogIH0KICBnZXQgX3Byb2dyZXNzaXZlRGF0YUxlbmd0aCgpIHsKICAgIHJldHVybiB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcj8uX2xvYWRlZCA/PyAwOwogIH0KICBnZXRGdWxsUmVhZGVyKCkgewogICAgYXNzZXJ0KCF0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciwgIlBERkZldGNoU3RyZWFtLmdldEZ1bGxSZWFkZXIgY2FuIG9ubHkgYmUgY2FsbGVkIG9uY2UuIik7CiAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciA9IG5ldyBQREZGZXRjaFN0cmVhbVJlYWRlcih0aGlzKTsKICAgIHJldHVybiB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcjsKICB9CiAgZ2V0UmFuZ2VSZWFkZXIoYmVnaW4sIGVuZCkgewogICAgaWYgKGVuZCA8PSB0aGlzLl9wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCByZWFkZXIgPSBuZXcgUERGRmV0Y2hTdHJlYW1SYW5nZVJlYWRlcih0aGlzLCBiZWdpbiwgZW5kKTsKICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMucHVzaChyZWFkZXIpOwogICAgcmV0dXJuIHJlYWRlcjsKICB9CiAgY2FuY2VsQWxsUmVxdWVzdHMocmVhc29uKSB7CiAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcj8uY2FuY2VsKHJlYXNvbik7CiAgICBmb3IgKGNvbnN0IHJlYWRlciBvZiB0aGlzLl9yYW5nZVJlcXVlc3RSZWFkZXJzLnNsaWNlKDApKSB7CiAgICAgIHJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgIH0KICB9Cn0KY2xhc3MgUERGRmV0Y2hTdHJlYW1SZWFkZXIgewogIGNvbnN0cnVjdG9yKHN0cmVhbSkgewogICAgdGhpcy5fc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5fcmVhZGVyID0gbnVsbDsKICAgIHRoaXMuX2xvYWRlZCA9IDA7CiAgICB0aGlzLl9maWxlbmFtZSA9IG51bGw7CiAgICBjb25zdCBzb3VyY2UgPSBzdHJlYW0uc291cmNlOwogICAgdGhpcy5fd2l0aENyZWRlbnRpYWxzID0gc291cmNlLndpdGhDcmVkZW50aWFscyB8fCBmYWxzZTsKICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBzb3VyY2UubGVuZ3RoOwogICAgdGhpcy5faGVhZGVyc0NhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRoaXMuX2Rpc2FibGVSYW5nZSA9IHNvdXJjZS5kaXNhYmxlUmFuZ2UgfHwgZmFsc2U7CiAgICB0aGlzLl9yYW5nZUNodW5rU2l6ZSA9IHNvdXJjZS5yYW5nZUNodW5rU2l6ZTsKICAgIGlmICghdGhpcy5fcmFuZ2VDaHVua1NpemUgJiYgIXRoaXMuX2Rpc2FibGVSYW5nZSkgewogICAgICB0aGlzLl9kaXNhYmxlUmFuZ2UgPSB0cnVlOwogICAgfQogICAgdGhpcy5fYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQgPSAhc291cmNlLmRpc2FibGVTdHJlYW07CiAgICB0aGlzLl9pc1JhbmdlU3VwcG9ydGVkID0gIXNvdXJjZS5kaXNhYmxlUmFuZ2U7CiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoc3RyZWFtLmhlYWRlcnMpOwogICAgY29uc3QgdXJsID0gc291cmNlLnVybDsKICAgIGZldGNoKHVybCwgY3JlYXRlRmV0Y2hPcHRpb25zKGhlYWRlcnMsIHRoaXMuX3dpdGhDcmVkZW50aWFscywgdGhpcy5fYWJvcnRDb250cm9sbGVyKSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgIHN0cmVhbS5fcmVzcG9uc2VPcmlnaW4gPSBnZXRSZXNwb25zZU9yaWdpbihyZXNwb25zZS51cmwpOwogICAgICBpZiAoIXZhbGlkYXRlUmVzcG9uc2VTdGF0dXMocmVzcG9uc2Uuc3RhdHVzKSkgewogICAgICAgIHRocm93IGNyZWF0ZVJlc3BvbnNlRXJyb3IocmVzcG9uc2Uuc3RhdHVzLCB1cmwpOwogICAgICB9CiAgICAgIHRoaXMuX3JlYWRlciA9IHJlc3BvbnNlLmJvZHkuZ2V0UmVhZGVyKCk7CiAgICAgIHRoaXMuX2hlYWRlcnNDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgY29uc3QgcmVzcG9uc2VIZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVyczsKICAgICAgY29uc3QgewogICAgICAgIGFsbG93UmFuZ2VSZXF1ZXN0cywKICAgICAgICBzdWdnZXN0ZWRMZW5ndGgKICAgICAgfSA9IHZhbGlkYXRlUmFuZ2VSZXF1ZXN0Q2FwYWJpbGl0aWVzKHsKICAgICAgICByZXNwb25zZUhlYWRlcnMsCiAgICAgICAgaXNIdHRwOiBzdHJlYW0uaXNIdHRwLAogICAgICAgIHJhbmdlQ2h1bmtTaXplOiB0aGlzLl9yYW5nZUNodW5rU2l6ZSwKICAgICAgICBkaXNhYmxlUmFuZ2U6IHRoaXMuX2Rpc2FibGVSYW5nZQogICAgICB9KTsKICAgICAgdGhpcy5faXNSYW5nZVN1cHBvcnRlZCA9IGFsbG93UmFuZ2VSZXF1ZXN0czsKICAgICAgdGhpcy5fY29udGVudExlbmd0aCA9IHN1Z2dlc3RlZExlbmd0aCB8fCB0aGlzLl9jb250ZW50TGVuZ3RoOwogICAgICB0aGlzLl9maWxlbmFtZSA9IGV4dHJhY3RGaWxlbmFtZUZyb21IZWFkZXIocmVzcG9uc2VIZWFkZXJzKTsKICAgICAgaWYgKCF0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZCAmJiB0aGlzLl9pc1JhbmdlU3VwcG9ydGVkKSB7CiAgICAgICAgdGhpcy5jYW5jZWwobmV3IEFib3J0RXhjZXB0aW9uKCJTdHJlYW1pbmcgaXMgZGlzYWJsZWQuIikpOwogICAgICB9CiAgICB9KS5jYXRjaCh0aGlzLl9oZWFkZXJzQ2FwYWJpbGl0eS5yZWplY3QpOwogICAgdGhpcy5vblByb2dyZXNzID0gbnVsbDsKICB9CiAgZ2V0IGhlYWRlcnNSZWFkeSgpIHsKICAgIHJldHVybiB0aGlzLl9oZWFkZXJzQ2FwYWJpbGl0eS5wcm9taXNlOwogIH0KICBnZXQgZmlsZW5hbWUoKSB7CiAgICByZXR1cm4gdGhpcy5fZmlsZW5hbWU7CiAgfQogIGdldCBjb250ZW50TGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX2NvbnRlbnRMZW5ndGg7CiAgfQogIGdldCBpc1JhbmdlU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQ7CiAgfQogIGdldCBpc1N0cmVhbWluZ1N1cHBvcnRlZCgpIHsKICAgIHJldHVybiB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZDsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGF3YWl0IHRoaXMuX2hlYWRlcnNDYXBhYmlsaXR5LnByb21pc2U7CiAgICBjb25zdCB7CiAgICAgIHZhbHVlLAogICAgICBkb25lCiAgICB9ID0gYXdhaXQgdGhpcy5fcmVhZGVyLnJlYWQoKTsKICAgIGlmIChkb25lKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWUsCiAgICAgICAgZG9uZQogICAgICB9OwogICAgfQogICAgdGhpcy5fbG9hZGVkICs9IHZhbHVlLmJ5dGVMZW5ndGg7CiAgICB0aGlzLm9uUHJvZ3Jlc3M/Lih7CiAgICAgIGxvYWRlZDogdGhpcy5fbG9hZGVkLAogICAgICB0b3RhbDogdGhpcy5fY29udGVudExlbmd0aAogICAgfSk7CiAgICByZXR1cm4gewogICAgICB2YWx1ZTogZ2V0QXJyYXlCdWZmZXIodmFsdWUpLAogICAgICBkb25lOiBmYWxzZQogICAgfTsKICB9CiAgY2FuY2VsKHJlYXNvbikgewogICAgdGhpcy5fcmVhZGVyPy5jYW5jZWwocmVhc29uKTsKICAgIHRoaXMuX2Fib3J0Q29udHJvbGxlci5hYm9ydCgpOwogIH0KfQpjbGFzcyBQREZGZXRjaFN0cmVhbVJhbmdlUmVhZGVyIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIGJlZ2luLCBlbmQpIHsKICAgIHRoaXMuX3N0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMuX3JlYWRlciA9IG51bGw7CiAgICB0aGlzLl9sb2FkZWQgPSAwOwogICAgY29uc3Qgc291cmNlID0gc3RyZWFtLnNvdXJjZTsKICAgIHRoaXMuX3dpdGhDcmVkZW50aWFscyA9IHNvdXJjZS53aXRoQ3JlZGVudGlhbHMgfHwgZmFsc2U7CiAgICB0aGlzLl9yZWFkQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQgPSAhc291cmNlLmRpc2FibGVTdHJlYW07CiAgICB0aGlzLl9hYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoc3RyZWFtLmhlYWRlcnMpOwogICAgaGVhZGVycy5hcHBlbmQoIlJhbmdlIiwgYGJ5dGVzPSR7YmVnaW59LSR7ZW5kIC0gMX1gKTsKICAgIGNvbnN0IHVybCA9IHNvdXJjZS51cmw7CiAgICBmZXRjaCh1cmwsIGNyZWF0ZUZldGNoT3B0aW9ucyhoZWFkZXJzLCB0aGlzLl93aXRoQ3JlZGVudGlhbHMsIHRoaXMuX2Fib3J0Q29udHJvbGxlcikpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICBjb25zdCByZXNwb25zZU9yaWdpbiA9IGdldFJlc3BvbnNlT3JpZ2luKHJlc3BvbnNlLnVybCk7CiAgICAgIGlmIChyZXNwb25zZU9yaWdpbiAhPT0gc3RyZWFtLl9yZXNwb25zZU9yaWdpbikgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgcmFuZ2UgcmVzcG9uc2Utb3JpZ2luICIke3Jlc3BvbnNlT3JpZ2lufSIgdG8gbWF0Y2ggIiR7c3RyZWFtLl9yZXNwb25zZU9yaWdpbn0iLmApOwogICAgICB9CiAgICAgIGlmICghdmFsaWRhdGVSZXNwb25zZVN0YXR1cyhyZXNwb25zZS5zdGF0dXMpKSB7CiAgICAgICAgdGhyb3cgY3JlYXRlUmVzcG9uc2VFcnJvcihyZXNwb25zZS5zdGF0dXMsIHVybCk7CiAgICAgIH0KICAgICAgdGhpcy5fcmVhZENhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICB0aGlzLl9yZWFkZXIgPSByZXNwb25zZS5ib2R5LmdldFJlYWRlcigpOwogICAgfSkuY2F0Y2godGhpcy5fcmVhZENhcGFiaWxpdHkucmVqZWN0KTsKICAgIHRoaXMub25Qcm9ncmVzcyA9IG51bGw7CiAgfQogIGdldCBpc1N0cmVhbWluZ1N1cHBvcnRlZCgpIHsKICAgIHJldHVybiB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZDsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGF3YWl0IHRoaXMuX3JlYWRDYXBhYmlsaXR5LnByb21pc2U7CiAgICBjb25zdCB7CiAgICAgIHZhbHVlLAogICAgICBkb25lCiAgICB9ID0gYXdhaXQgdGhpcy5fcmVhZGVyLnJlYWQoKTsKICAgIGlmIChkb25lKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWUsCiAgICAgICAgZG9uZQogICAgICB9OwogICAgfQogICAgdGhpcy5fbG9hZGVkICs9IHZhbHVlLmJ5dGVMZW5ndGg7CiAgICB0aGlzLm9uUHJvZ3Jlc3M/Lih7CiAgICAgIGxvYWRlZDogdGhpcy5fbG9hZGVkCiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgIHZhbHVlOiBnZXRBcnJheUJ1ZmZlcih2YWx1ZSksCiAgICAgIGRvbmU6IGZhbHNlCiAgICB9OwogIH0KICBjYW5jZWwocmVhc29uKSB7CiAgICB0aGlzLl9yZWFkZXI/LmNhbmNlbChyZWFzb24pOwogICAgdGhpcy5fYWJvcnRDb250cm9sbGVyLmFib3J0KCk7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9uZXR3b3JrLmpzCgoKY29uc3QgT0tfUkVTUE9OU0UgPSAyMDA7CmNvbnN0IFBBUlRJQUxfQ09OVEVOVF9SRVNQT05TRSA9IDIwNjsKZnVuY3Rpb24gbmV0d29ya19nZXRBcnJheUJ1ZmZlcih4aHIpIHsKICBjb25zdCBkYXRhID0geGhyLnJlc3BvbnNlOwogIGlmICh0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIpIHsKICAgIHJldHVybiBkYXRhOwogIH0KICByZXR1cm4gc3RyaW5nVG9CeXRlcyhkYXRhKS5idWZmZXI7Cn0KY2xhc3MgTmV0d29ya01hbmFnZXIgewogIF9yZXNwb25zZU9yaWdpbiA9IG51bGw7CiAgY29uc3RydWN0b3IoewogICAgdXJsLAogICAgaHR0cEhlYWRlcnMsCiAgICB3aXRoQ3JlZGVudGlhbHMKICB9KSB7CiAgICB0aGlzLnVybCA9IHVybDsKICAgIHRoaXMuaXNIdHRwID0gL15odHRwcz86L2kudGVzdCh1cmwpOwogICAgdGhpcy5oZWFkZXJzID0gY3JlYXRlSGVhZGVycyh0aGlzLmlzSHR0cCwgaHR0cEhlYWRlcnMpOwogICAgdGhpcy53aXRoQ3JlZGVudGlhbHMgPSB3aXRoQ3JlZGVudGlhbHMgfHwgZmFsc2U7CiAgICB0aGlzLmN1cnJYaHJJZCA9IDA7CiAgICB0aGlzLnBlbmRpbmdSZXF1ZXN0cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgfQogIHJlcXVlc3QoYXJncykgewogICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICBjb25zdCB4aHJJZCA9IHRoaXMuY3VyclhocklkKys7CiAgICBjb25zdCBwZW5kaW5nUmVxdWVzdCA9IHRoaXMucGVuZGluZ1JlcXVlc3RzW3hocklkXSA9IHsKICAgICAgeGhyCiAgICB9OwogICAgeGhyLm9wZW4oIkdFVCIsIHRoaXMudXJsKTsKICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0aGlzLndpdGhDcmVkZW50aWFsczsKICAgIGZvciAoY29uc3QgW2tleSwgdmFsXSBvZiB0aGlzLmhlYWRlcnMpIHsKICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoa2V5LCB2YWwpOwogICAgfQogICAgaWYgKHRoaXMuaXNIdHRwICYmICJiZWdpbiIgaW4gYXJncyAmJiAiZW5kIiBpbiBhcmdzKSB7CiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCJSYW5nZSIsIGBieXRlcz0ke2FyZ3MuYmVnaW59LSR7YXJncy5lbmQgLSAxfWApOwogICAgICBwZW5kaW5nUmVxdWVzdC5leHBlY3RlZFN0YXR1cyA9IFBBUlRJQUxfQ09OVEVOVF9SRVNQT05TRTsKICAgIH0gZWxzZSB7CiAgICAgIHBlbmRpbmdSZXF1ZXN0LmV4cGVjdGVkU3RhdHVzID0gT0tfUkVTUE9OU0U7CiAgICB9CiAgICB4aHIucmVzcG9uc2VUeXBlID0gImFycmF5YnVmZmVyIjsKICAgIGFzc2VydChhcmdzLm9uRXJyb3IsICJFeHBlY3RlZCBgb25FcnJvcmAgY2FsbGJhY2sgdG8gYmUgcHJvdmlkZWQuIik7CiAgICB4aHIub25lcnJvciA9ICgpID0+IHsKICAgICAgYXJncy5vbkVycm9yKHhoci5zdGF0dXMpOwogICAgfTsKICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSB0aGlzLm9uU3RhdGVDaGFuZ2UuYmluZCh0aGlzLCB4aHJJZCk7CiAgICB4aHIub25wcm9ncmVzcyA9IHRoaXMub25Qcm9ncmVzcy5iaW5kKHRoaXMsIHhocklkKTsKICAgIHBlbmRpbmdSZXF1ZXN0Lm9uSGVhZGVyc1JlY2VpdmVkID0gYXJncy5vbkhlYWRlcnNSZWNlaXZlZDsKICAgIHBlbmRpbmdSZXF1ZXN0Lm9uRG9uZSA9IGFyZ3Mub25Eb25lOwogICAgcGVuZGluZ1JlcXVlc3Qub25FcnJvciA9IGFyZ3Mub25FcnJvcjsKICAgIHBlbmRpbmdSZXF1ZXN0Lm9uUHJvZ3Jlc3MgPSBhcmdzLm9uUHJvZ3Jlc3M7CiAgICB4aHIuc2VuZChudWxsKTsKICAgIHJldHVybiB4aHJJZDsKICB9CiAgb25Qcm9ncmVzcyh4aHJJZCwgZXZ0KSB7CiAgICBjb25zdCBwZW5kaW5nUmVxdWVzdCA9IHRoaXMucGVuZGluZ1JlcXVlc3RzW3hocklkXTsKICAgIGlmICghcGVuZGluZ1JlcXVlc3QpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgcGVuZGluZ1JlcXVlc3Qub25Qcm9ncmVzcz8uKGV2dCk7CiAgfQogIG9uU3RhdGVDaGFuZ2UoeGhySWQsIGV2dCkgewogICAgY29uc3QgcGVuZGluZ1JlcXVlc3QgPSB0aGlzLnBlbmRpbmdSZXF1ZXN0c1t4aHJJZF07CiAgICBpZiAoIXBlbmRpbmdSZXF1ZXN0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHhociA9IHBlbmRpbmdSZXF1ZXN0LnhocjsKICAgIGlmICh4aHIucmVhZHlTdGF0ZSA+PSAyICYmIHBlbmRpbmdSZXF1ZXN0Lm9uSGVhZGVyc1JlY2VpdmVkKSB7CiAgICAgIHBlbmRpbmdSZXF1ZXN0Lm9uSGVhZGVyc1JlY2VpdmVkKCk7CiAgICAgIGRlbGV0ZSBwZW5kaW5nUmVxdWVzdC5vbkhlYWRlcnNSZWNlaXZlZDsKICAgIH0KICAgIGlmICh4aHIucmVhZHlTdGF0ZSAhPT0gNCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoISh4aHJJZCBpbiB0aGlzLnBlbmRpbmdSZXF1ZXN0cykpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZGVsZXRlIHRoaXMucGVuZGluZ1JlcXVlc3RzW3hocklkXTsKICAgIGlmICh4aHIuc3RhdHVzID09PSAwICYmIHRoaXMuaXNIdHRwKSB7CiAgICAgIHBlbmRpbmdSZXF1ZXN0Lm9uRXJyb3IoeGhyLnN0YXR1cyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHhoclN0YXR1cyA9IHhoci5zdGF0dXMgfHwgT0tfUkVTUE9OU0U7CiAgICBjb25zdCBva19yZXNwb25zZV9vbl9yYW5nZV9yZXF1ZXN0ID0geGhyU3RhdHVzID09PSBPS19SRVNQT05TRSAmJiBwZW5kaW5nUmVxdWVzdC5leHBlY3RlZFN0YXR1cyA9PT0gUEFSVElBTF9DT05URU5UX1JFU1BPTlNFOwogICAgaWYgKCFva19yZXNwb25zZV9vbl9yYW5nZV9yZXF1ZXN0ICYmIHhoclN0YXR1cyAhPT0gcGVuZGluZ1JlcXVlc3QuZXhwZWN0ZWRTdGF0dXMpIHsKICAgICAgcGVuZGluZ1JlcXVlc3Qub25FcnJvcih4aHIuc3RhdHVzKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY2h1bmsgPSBuZXR3b3JrX2dldEFycmF5QnVmZmVyKHhocik7CiAgICBpZiAoeGhyU3RhdHVzID09PSBQQVJUSUFMX0NPTlRFTlRfUkVTUE9OU0UpIHsKICAgICAgY29uc3QgcmFuZ2VIZWFkZXIgPSB4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtUmFuZ2UiKTsKICAgICAgY29uc3QgbWF0Y2hlcyA9IC9ieXRlcyAoXGQrKS0oXGQrKVwvKFxkKykvLmV4ZWMocmFuZ2VIZWFkZXIpOwogICAgICBpZiAobWF0Y2hlcykgewogICAgICAgIHBlbmRpbmdSZXF1ZXN0Lm9uRG9uZSh7CiAgICAgICAgICBiZWdpbjogcGFyc2VJbnQobWF0Y2hlc1sxXSwgMTApLAogICAgICAgICAgY2h1bmsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKGBNaXNzaW5nIG9yIGludmFsaWQgIkNvbnRlbnQtUmFuZ2UiIGhlYWRlci5gKTsKICAgICAgICBwZW5kaW5nUmVxdWVzdC5vbkVycm9yKDApOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGNodW5rKSB7CiAgICAgIHBlbmRpbmdSZXF1ZXN0Lm9uRG9uZSh7CiAgICAgICAgYmVnaW46IDAsCiAgICAgICAgY2h1bmsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBwZW5kaW5nUmVxdWVzdC5vbkVycm9yKHhoci5zdGF0dXMpOwogICAgfQogIH0KICBnZXRSZXF1ZXN0WGhyKHhocklkKSB7CiAgICByZXR1cm4gdGhpcy5wZW5kaW5nUmVxdWVzdHNbeGhySWRdLnhocjsKICB9CiAgaXNQZW5kaW5nUmVxdWVzdCh4aHJJZCkgewogICAgcmV0dXJuIHhocklkIGluIHRoaXMucGVuZGluZ1JlcXVlc3RzOwogIH0KICBhYm9ydFJlcXVlc3QoeGhySWQpIHsKICAgIGNvbnN0IHhociA9IHRoaXMucGVuZGluZ1JlcXVlc3RzW3hocklkXS54aHI7CiAgICBkZWxldGUgdGhpcy5wZW5kaW5nUmVxdWVzdHNbeGhySWRdOwogICAgeGhyLmFib3J0KCk7CiAgfQp9CmNsYXNzIFBERk5ldHdvcmtTdHJlYW0gewogIGNvbnN0cnVjdG9yKHNvdXJjZSkgewogICAgdGhpcy5fc291cmNlID0gc291cmNlOwogICAgdGhpcy5fbWFuYWdlciA9IG5ldyBOZXR3b3JrTWFuYWdlcihzb3VyY2UpOwogICAgdGhpcy5fcmFuZ2VDaHVua1NpemUgPSBzb3VyY2UucmFuZ2VDaHVua1NpemU7CiAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciA9IG51bGw7CiAgICB0aGlzLl9yYW5nZVJlcXVlc3RSZWFkZXJzID0gW107CiAgfQogIF9vblJhbmdlUmVxdWVzdFJlYWRlckNsb3NlZChyZWFkZXIpIHsKICAgIGNvbnN0IGkgPSB0aGlzLl9yYW5nZVJlcXVlc3RSZWFkZXJzLmluZGV4T2YocmVhZGVyKTsKICAgIGlmIChpID49IDApIHsKICAgICAgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycy5zcGxpY2UoaSwgMSk7CiAgICB9CiAgfQogIGdldEZ1bGxSZWFkZXIoKSB7CiAgICBhc3NlcnQoIXRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyLCAiUERGTmV0d29ya1N0cmVhbS5nZXRGdWxsUmVhZGVyIGNhbiBvbmx5IGJlIGNhbGxlZCBvbmNlLiIpOwogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBuZXcgUERGTmV0d29ya1N0cmVhbUZ1bGxSZXF1ZXN0UmVhZGVyKHRoaXMuX21hbmFnZXIsIHRoaXMuX3NvdXJjZSk7CiAgICByZXR1cm4gdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXI7CiAgfQogIGdldFJhbmdlUmVhZGVyKGJlZ2luLCBlbmQpIHsKICAgIGNvbnN0IHJlYWRlciA9IG5ldyBQREZOZXR3b3JrU3RyZWFtUmFuZ2VSZXF1ZXN0UmVhZGVyKHRoaXMuX21hbmFnZXIsIGJlZ2luLCBlbmQpOwogICAgcmVhZGVyLm9uQ2xvc2VkID0gdGhpcy5fb25SYW5nZVJlcXVlc3RSZWFkZXJDbG9zZWQuYmluZCh0aGlzKTsKICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMucHVzaChyZWFkZXIpOwogICAgcmV0dXJuIHJlYWRlcjsKICB9CiAgY2FuY2VsQWxsUmVxdWVzdHMocmVhc29uKSB7CiAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcj8uY2FuY2VsKHJlYXNvbik7CiAgICBmb3IgKGNvbnN0IHJlYWRlciBvZiB0aGlzLl9yYW5nZVJlcXVlc3RSZWFkZXJzLnNsaWNlKDApKSB7CiAgICAgIHJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgIH0KICB9Cn0KY2xhc3MgUERGTmV0d29ya1N0cmVhbUZ1bGxSZXF1ZXN0UmVhZGVyIHsKICBjb25zdHJ1Y3RvcihtYW5hZ2VyLCBzb3VyY2UpIHsKICAgIHRoaXMuX21hbmFnZXIgPSBtYW5hZ2VyOwogICAgdGhpcy5fdXJsID0gc291cmNlLnVybDsKICAgIHRoaXMuX2Z1bGxSZXF1ZXN0SWQgPSBtYW5hZ2VyLnJlcXVlc3QoewogICAgICBvbkhlYWRlcnNSZWNlaXZlZDogdGhpcy5fb25IZWFkZXJzUmVjZWl2ZWQuYmluZCh0aGlzKSwKICAgICAgb25Eb25lOiB0aGlzLl9vbkRvbmUuYmluZCh0aGlzKSwKICAgICAgb25FcnJvcjogdGhpcy5fb25FcnJvci5iaW5kKHRoaXMpLAogICAgICBvblByb2dyZXNzOiB0aGlzLl9vblByb2dyZXNzLmJpbmQodGhpcykKICAgIH0pOwogICAgdGhpcy5faGVhZGVyc0NhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRoaXMuX2Rpc2FibGVSYW5nZSA9IHNvdXJjZS5kaXNhYmxlUmFuZ2UgfHwgZmFsc2U7CiAgICB0aGlzLl9jb250ZW50TGVuZ3RoID0gc291cmNlLmxlbmd0aDsKICAgIHRoaXMuX3JhbmdlQ2h1bmtTaXplID0gc291cmNlLnJhbmdlQ2h1bmtTaXplOwogICAgaWYgKCF0aGlzLl9yYW5nZUNodW5rU2l6ZSAmJiAhdGhpcy5fZGlzYWJsZVJhbmdlKSB7CiAgICAgIHRoaXMuX2Rpc2FibGVSYW5nZSA9IHRydWU7CiAgICB9CiAgICB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZCA9IGZhbHNlOwogICAgdGhpcy5faXNSYW5nZVN1cHBvcnRlZCA9IGZhbHNlOwogICAgdGhpcy5fY2FjaGVkQ2h1bmtzID0gW107CiAgICB0aGlzLl9yZXF1ZXN0cyA9IFtdOwogICAgdGhpcy5fZG9uZSA9IGZhbHNlOwogICAgdGhpcy5fc3RvcmVkRXJyb3IgPSB1bmRlZmluZWQ7CiAgICB0aGlzLl9maWxlbmFtZSA9IG51bGw7CiAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsOwogIH0KICBfb25IZWFkZXJzUmVjZWl2ZWQoKSB7CiAgICBjb25zdCBmdWxsUmVxdWVzdFhocklkID0gdGhpcy5fZnVsbFJlcXVlc3RJZDsKICAgIGNvbnN0IGZ1bGxSZXF1ZXN0WGhyID0gdGhpcy5fbWFuYWdlci5nZXRSZXF1ZXN0WGhyKGZ1bGxSZXF1ZXN0WGhySWQpOwogICAgdGhpcy5fbWFuYWdlci5fcmVzcG9uc2VPcmlnaW4gPSBnZXRSZXNwb25zZU9yaWdpbihmdWxsUmVxdWVzdFhoci5yZXNwb25zZVVSTCk7CiAgICBjb25zdCByYXdSZXNwb25zZUhlYWRlcnMgPSBmdWxsUmVxdWVzdFhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTsKICAgIGNvbnN0IHJlc3BvbnNlSGVhZGVycyA9IG5ldyBIZWFkZXJzKHJhd1Jlc3BvbnNlSGVhZGVycyA/IHJhd1Jlc3BvbnNlSGVhZGVycy50cmltU3RhcnQoKS5yZXBsYWNlKC9bXlxTIF0rJC8sICIiKS5zcGxpdCgvW1xyXG5dKy8pLm1hcCh4ID0+IHsKICAgICAgY29uc3QgW2tleSwgLi4udmFsXSA9IHguc3BsaXQoIjogIik7CiAgICAgIHJldHVybiBba2V5LCB2YWwuam9pbigiOiAiKV07CiAgICB9KSA6IFtdKTsKICAgIGNvbnN0IHsKICAgICAgYWxsb3dSYW5nZVJlcXVlc3RzLAogICAgICBzdWdnZXN0ZWRMZW5ndGgKICAgIH0gPSB2YWxpZGF0ZVJhbmdlUmVxdWVzdENhcGFiaWxpdGllcyh7CiAgICAgIHJlc3BvbnNlSGVhZGVycywKICAgICAgaXNIdHRwOiB0aGlzLl9tYW5hZ2VyLmlzSHR0cCwKICAgICAgcmFuZ2VDaHVua1NpemU6IHRoaXMuX3JhbmdlQ2h1bmtTaXplLAogICAgICBkaXNhYmxlUmFuZ2U6IHRoaXMuX2Rpc2FibGVSYW5nZQogICAgfSk7CiAgICBpZiAoYWxsb3dSYW5nZVJlcXVlc3RzKSB7CiAgICAgIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQgPSB0cnVlOwogICAgfQogICAgdGhpcy5fY29udGVudExlbmd0aCA9IHN1Z2dlc3RlZExlbmd0aCB8fCB0aGlzLl9jb250ZW50TGVuZ3RoOwogICAgdGhpcy5fZmlsZW5hbWUgPSBleHRyYWN0RmlsZW5hbWVGcm9tSGVhZGVyKHJlc3BvbnNlSGVhZGVycyk7CiAgICBpZiAodGhpcy5faXNSYW5nZVN1cHBvcnRlZCkgewogICAgICB0aGlzLl9tYW5hZ2VyLmFib3J0UmVxdWVzdChmdWxsUmVxdWVzdFhocklkKTsKICAgIH0KICAgIHRoaXMuX2hlYWRlcnNDYXBhYmlsaXR5LnJlc29sdmUoKTsKICB9CiAgX29uRG9uZShkYXRhKSB7CiAgICBpZiAoZGF0YSkgewogICAgICBpZiAodGhpcy5fcmVxdWVzdHMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IHJlcXVlc3RDYXBhYmlsaXR5ID0gdGhpcy5fcmVxdWVzdHMuc2hpZnQoKTsKICAgICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICAgIHZhbHVlOiBkYXRhLmNodW5rLAogICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9jYWNoZWRDaHVua3MucHVzaChkYXRhLmNodW5rKTsKICAgICAgfQogICAgfQogICAgdGhpcy5fZG9uZSA9IHRydWU7CiAgICBpZiAodGhpcy5fY2FjaGVkQ2h1bmtzLmxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCByZXF1ZXN0Q2FwYWJpbGl0eSBvZiB0aGlzLl9yZXF1ZXN0cykgewogICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgIGRvbmU6IHRydWUKICAgICAgfSk7CiAgICB9CiAgICB0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPSAwOwogIH0KICBfb25FcnJvcihzdGF0dXMpIHsKICAgIHRoaXMuX3N0b3JlZEVycm9yID0gY3JlYXRlUmVzcG9uc2VFcnJvcihzdGF0dXMsIHRoaXMuX3VybCk7CiAgICB0aGlzLl9oZWFkZXJzQ2FwYWJpbGl0eS5yZWplY3QodGhpcy5fc3RvcmVkRXJyb3IpOwogICAgZm9yIChjb25zdCByZXF1ZXN0Q2FwYWJpbGl0eSBvZiB0aGlzLl9yZXF1ZXN0cykgewogICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZWplY3QodGhpcy5fc3RvcmVkRXJyb3IpOwogICAgfQogICAgdGhpcy5fcmVxdWVzdHMubGVuZ3RoID0gMDsKICAgIHRoaXMuX2NhY2hlZENodW5rcy5sZW5ndGggPSAwOwogIH0KICBfb25Qcm9ncmVzcyhldnQpIHsKICAgIHRoaXMub25Qcm9ncmVzcz8uKHsKICAgICAgbG9hZGVkOiBldnQubG9hZGVkLAogICAgICB0b3RhbDogZXZ0Lmxlbmd0aENvbXB1dGFibGUgPyBldnQudG90YWwgOiB0aGlzLl9jb250ZW50TGVuZ3RoCiAgICB9KTsKICB9CiAgZ2V0IGZpbGVuYW1lKCkgewogICAgcmV0dXJuIHRoaXMuX2ZpbGVuYW1lOwogIH0KICBnZXQgaXNSYW5nZVN1cHBvcnRlZCgpIHsKICAgIHJldHVybiB0aGlzLl9pc1JhbmdlU3VwcG9ydGVkOwogIH0KICBnZXQgaXNTdHJlYW1pbmdTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQ7CiAgfQogIGdldCBjb250ZW50TGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX2NvbnRlbnRMZW5ndGg7CiAgfQogIGdldCBoZWFkZXJzUmVhZHkoKSB7CiAgICByZXR1cm4gdGhpcy5faGVhZGVyc0NhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGF3YWl0IHRoaXMuX2hlYWRlcnNDYXBhYmlsaXR5LnByb21pc2U7CiAgICBpZiAodGhpcy5fc3RvcmVkRXJyb3IpIHsKICAgICAgdGhyb3cgdGhpcy5fc3RvcmVkRXJyb3I7CiAgICB9CiAgICBpZiAodGhpcy5fY2FjaGVkQ2h1bmtzLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgY2h1bmsgPSB0aGlzLl9jYWNoZWRDaHVua3Muc2hpZnQoKTsKICAgICAgcmV0dXJuIHsKICAgICAgICB2YWx1ZTogY2h1bmssCiAgICAgICAgZG9uZTogZmFsc2UKICAgICAgfTsKICAgIH0KICAgIGlmICh0aGlzLl9kb25lKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICBkb25lOiB0cnVlCiAgICAgIH07CiAgICB9CiAgICBjb25zdCByZXF1ZXN0Q2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgdGhpcy5fcmVxdWVzdHMucHVzaChyZXF1ZXN0Q2FwYWJpbGl0eSk7CiAgICByZXR1cm4gcmVxdWVzdENhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgY2FuY2VsKHJlYXNvbikgewogICAgdGhpcy5fZG9uZSA9IHRydWU7CiAgICB0aGlzLl9oZWFkZXJzQ2FwYWJpbGl0eS5yZWplY3QocmVhc29uKTsKICAgIGZvciAoY29uc3QgcmVxdWVzdENhcGFiaWxpdHkgb2YgdGhpcy5fcmVxdWVzdHMpIHsKICAgICAgcmVxdWVzdENhcGFiaWxpdHkucmVzb2x2ZSh7CiAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICBkb25lOiB0cnVlCiAgICAgIH0pOwogICAgfQogICAgdGhpcy5fcmVxdWVzdHMubGVuZ3RoID0gMDsKICAgIGlmICh0aGlzLl9tYW5hZ2VyLmlzUGVuZGluZ1JlcXVlc3QodGhpcy5fZnVsbFJlcXVlc3RJZCkpIHsKICAgICAgdGhpcy5fbWFuYWdlci5hYm9ydFJlcXVlc3QodGhpcy5fZnVsbFJlcXVlc3RJZCk7CiAgICB9CiAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciA9IG51bGw7CiAgfQp9CmNsYXNzIFBERk5ldHdvcmtTdHJlYW1SYW5nZVJlcXVlc3RSZWFkZXIgewogIGNvbnN0cnVjdG9yKG1hbmFnZXIsIGJlZ2luLCBlbmQpIHsKICAgIHRoaXMuX21hbmFnZXIgPSBtYW5hZ2VyOwogICAgdGhpcy5fdXJsID0gbWFuYWdlci51cmw7CiAgICB0aGlzLl9yZXF1ZXN0SWQgPSBtYW5hZ2VyLnJlcXVlc3QoewogICAgICBiZWdpbiwKICAgICAgZW5kLAogICAgICBvbkhlYWRlcnNSZWNlaXZlZDogdGhpcy5fb25IZWFkZXJzUmVjZWl2ZWQuYmluZCh0aGlzKSwKICAgICAgb25Eb25lOiB0aGlzLl9vbkRvbmUuYmluZCh0aGlzKSwKICAgICAgb25FcnJvcjogdGhpcy5fb25FcnJvci5iaW5kKHRoaXMpLAogICAgICBvblByb2dyZXNzOiB0aGlzLl9vblByb2dyZXNzLmJpbmQodGhpcykKICAgIH0pOwogICAgdGhpcy5fcmVxdWVzdHMgPSBbXTsKICAgIHRoaXMuX3F1ZXVlZENodW5rID0gbnVsbDsKICAgIHRoaXMuX2RvbmUgPSBmYWxzZTsKICAgIHRoaXMuX3N0b3JlZEVycm9yID0gdW5kZWZpbmVkOwogICAgdGhpcy5vblByb2dyZXNzID0gbnVsbDsKICAgIHRoaXMub25DbG9zZWQgPSBudWxsOwogIH0KICBfb25IZWFkZXJzUmVjZWl2ZWQoKSB7CiAgICBjb25zdCByZXNwb25zZU9yaWdpbiA9IGdldFJlc3BvbnNlT3JpZ2luKHRoaXMuX21hbmFnZXIuZ2V0UmVxdWVzdFhocih0aGlzLl9yZXF1ZXN0SWQpPy5yZXNwb25zZVVSTCk7CiAgICBpZiAocmVzcG9uc2VPcmlnaW4gIT09IHRoaXMuX21hbmFnZXIuX3Jlc3BvbnNlT3JpZ2luKSB7CiAgICAgIHRoaXMuX3N0b3JlZEVycm9yID0gbmV3IEVycm9yKGBFeHBlY3RlZCByYW5nZSByZXNwb25zZS1vcmlnaW4gIiR7cmVzcG9uc2VPcmlnaW59IiB0byBtYXRjaCAiJHt0aGlzLl9tYW5hZ2VyLl9yZXNwb25zZU9yaWdpbn0iLmApOwogICAgICB0aGlzLl9vbkVycm9yKDApOwogICAgfQogIH0KICBfY2xvc2UoKSB7CiAgICB0aGlzLm9uQ2xvc2VkPy4odGhpcyk7CiAgfQogIF9vbkRvbmUoZGF0YSkgewogICAgY29uc3QgY2h1bmsgPSBkYXRhLmNodW5rOwogICAgaWYgKHRoaXMuX3JlcXVlc3RzLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgcmVxdWVzdENhcGFiaWxpdHkgPSB0aGlzLl9yZXF1ZXN0cy5zaGlmdCgpOwogICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICB2YWx1ZTogY2h1bmssCiAgICAgICAgZG9uZTogZmFsc2UKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9xdWV1ZWRDaHVuayA9IGNodW5rOwogICAgfQogICAgdGhpcy5fZG9uZSA9IHRydWU7CiAgICBmb3IgKGNvbnN0IHJlcXVlc3RDYXBhYmlsaXR5IG9mIHRoaXMuX3JlcXVlc3RzKSB7CiAgICAgIHJlcXVlc3RDYXBhYmlsaXR5LnJlc29sdmUoewogICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgZG9uZTogdHJ1ZQogICAgICB9KTsKICAgIH0KICAgIHRoaXMuX3JlcXVlc3RzLmxlbmd0aCA9IDA7CiAgICB0aGlzLl9jbG9zZSgpOwogIH0KICBfb25FcnJvcihzdGF0dXMpIHsKICAgIHRoaXMuX3N0b3JlZEVycm9yID8/PSBjcmVhdGVSZXNwb25zZUVycm9yKHN0YXR1cywgdGhpcy5fdXJsKTsKICAgIGZvciAoY29uc3QgcmVxdWVzdENhcGFiaWxpdHkgb2YgdGhpcy5fcmVxdWVzdHMpIHsKICAgICAgcmVxdWVzdENhcGFiaWxpdHkucmVqZWN0KHRoaXMuX3N0b3JlZEVycm9yKTsKICAgIH0KICAgIHRoaXMuX3JlcXVlc3RzLmxlbmd0aCA9IDA7CiAgICB0aGlzLl9xdWV1ZWRDaHVuayA9IG51bGw7CiAgfQogIF9vblByb2dyZXNzKGV2dCkgewogICAgaWYgKCF0aGlzLmlzU3RyZWFtaW5nU3VwcG9ydGVkKSB7CiAgICAgIHRoaXMub25Qcm9ncmVzcz8uKHsKICAgICAgICBsb2FkZWQ6IGV2dC5sb2FkZWQKICAgICAgfSk7CiAgICB9CiAgfQogIGdldCBpc1N0cmVhbWluZ1N1cHBvcnRlZCgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGlmICh0aGlzLl9zdG9yZWRFcnJvcikgewogICAgICB0aHJvdyB0aGlzLl9zdG9yZWRFcnJvcjsKICAgIH0KICAgIGlmICh0aGlzLl9xdWV1ZWRDaHVuayAhPT0gbnVsbCkgewogICAgICBjb25zdCBjaHVuayA9IHRoaXMuX3F1ZXVlZENodW5rOwogICAgICB0aGlzLl9xdWV1ZWRDaHVuayA9IG51bGw7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IGNodW5rLAogICAgICAgIGRvbmU6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICBpZiAodGhpcy5fZG9uZSkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgZG9uZTogdHJ1ZQogICAgICB9OwogICAgfQogICAgY29uc3QgcmVxdWVzdENhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRoaXMuX3JlcXVlc3RzLnB1c2gocmVxdWVzdENhcGFiaWxpdHkpOwogICAgcmV0dXJuIHJlcXVlc3RDYXBhYmlsaXR5LnByb21pc2U7CiAgfQogIGNhbmNlbChyZWFzb24pIHsKICAgIHRoaXMuX2RvbmUgPSB0cnVlOwogICAgZm9yIChjb25zdCByZXF1ZXN0Q2FwYWJpbGl0eSBvZiB0aGlzLl9yZXF1ZXN0cykgewogICAgICByZXF1ZXN0Q2FwYWJpbGl0eS5yZXNvbHZlKHsKICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgIGRvbmU6IHRydWUKICAgICAgfSk7CiAgICB9CiAgICB0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPSAwOwogICAgaWYgKHRoaXMuX21hbmFnZXIuaXNQZW5kaW5nUmVxdWVzdCh0aGlzLl9yZXF1ZXN0SWQpKSB7CiAgICAgIHRoaXMuX21hbmFnZXIuYWJvcnRSZXF1ZXN0KHRoaXMuX3JlcXVlc3RJZCk7CiAgICB9CiAgICB0aGlzLl9jbG9zZSgpOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvbm9kZV9zdHJlYW0uanMKCgpjb25zdCB1cmxSZWdleCA9IC9eW2Etel1bYS16MC05XC0rLl0rOi9pOwpmdW5jdGlvbiBwYXJzZVVybE9yUGF0aChzb3VyY2VVcmwpIHsKICBpZiAodXJsUmVnZXgudGVzdChzb3VyY2VVcmwpKSB7CiAgICByZXR1cm4gbmV3IFVSTChzb3VyY2VVcmwpOwogIH0KICBjb25zdCB1cmwgPSBwcm9jZXNzLmdldEJ1aWx0aW5Nb2R1bGUoInVybCIpOwogIHJldHVybiBuZXcgVVJMKHVybC5wYXRoVG9GaWxlVVJMKHNvdXJjZVVybCkpOwp9CmNsYXNzIFBERk5vZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHNvdXJjZSkgewogICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICB0aGlzLnVybCA9IHBhcnNlVXJsT3JQYXRoKHNvdXJjZS51cmwpOwogICAgYXNzZXJ0KHRoaXMudXJsLnByb3RvY29sID09PSAiZmlsZToiLCAiUERGTm9kZVN0cmVhbSBvbmx5IHN1cHBvcnRzIGZpbGU6Ly8gVVJMcy4iKTsKICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyID0gbnVsbDsKICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMgPSBbXTsKICB9CiAgZ2V0IF9wcm9ncmVzc2l2ZURhdGFMZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXI/Ll9sb2FkZWQgPz8gMDsKICB9CiAgZ2V0RnVsbFJlYWRlcigpIHsKICAgIGFzc2VydCghdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIsICJQREZOb2RlU3RyZWFtLmdldEZ1bGxSZWFkZXIgY2FuIG9ubHkgYmUgY2FsbGVkIG9uY2UuIik7CiAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciA9IG5ldyBQREZOb2RlU3RyZWFtRnNGdWxsUmVhZGVyKHRoaXMpOwogICAgcmV0dXJuIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyOwogIH0KICBnZXRSYW5nZVJlYWRlcihzdGFydCwgZW5kKSB7CiAgICBpZiAoZW5kIDw9IHRoaXMuX3Byb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHJhbmdlUmVhZGVyID0gbmV3IFBERk5vZGVTdHJlYW1Gc1JhbmdlUmVhZGVyKHRoaXMsIHN0YXJ0LCBlbmQpOwogICAgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycy5wdXNoKHJhbmdlUmVhZGVyKTsKICAgIHJldHVybiByYW5nZVJlYWRlcjsKICB9CiAgY2FuY2VsQWxsUmVxdWVzdHMocmVhc29uKSB7CiAgICB0aGlzLl9mdWxsUmVxdWVzdFJlYWRlcj8uY2FuY2VsKHJlYXNvbik7CiAgICBmb3IgKGNvbnN0IHJlYWRlciBvZiB0aGlzLl9yYW5nZVJlcXVlc3RSZWFkZXJzLnNsaWNlKDApKSB7CiAgICAgIHJlYWRlci5jYW5jZWwocmVhc29uKTsKICAgIH0KICB9Cn0KY2xhc3MgUERGTm9kZVN0cmVhbUZzRnVsbFJlYWRlciB7CiAgY29uc3RydWN0b3Ioc3RyZWFtKSB7CiAgICB0aGlzLl91cmwgPSBzdHJlYW0udXJsOwogICAgdGhpcy5fZG9uZSA9IGZhbHNlOwogICAgdGhpcy5fc3RvcmVkRXJyb3IgPSBudWxsOwogICAgdGhpcy5vblByb2dyZXNzID0gbnVsbDsKICAgIGNvbnN0IHNvdXJjZSA9IHN0cmVhbS5zb3VyY2U7CiAgICB0aGlzLl9jb250ZW50TGVuZ3RoID0gc291cmNlLmxlbmd0aDsKICAgIHRoaXMuX2xvYWRlZCA9IDA7CiAgICB0aGlzLl9maWxlbmFtZSA9IG51bGw7CiAgICB0aGlzLl9kaXNhYmxlUmFuZ2UgPSBzb3VyY2UuZGlzYWJsZVJhbmdlIHx8IGZhbHNlOwogICAgdGhpcy5fcmFuZ2VDaHVua1NpemUgPSBzb3VyY2UucmFuZ2VDaHVua1NpemU7CiAgICBpZiAoIXRoaXMuX3JhbmdlQ2h1bmtTaXplICYmICF0aGlzLl9kaXNhYmxlUmFuZ2UpIHsKICAgICAgdGhpcy5fZGlzYWJsZVJhbmdlID0gdHJ1ZTsKICAgIH0KICAgIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkID0gIXNvdXJjZS5kaXNhYmxlU3RyZWFtOwogICAgdGhpcy5faXNSYW5nZVN1cHBvcnRlZCA9ICFzb3VyY2UuZGlzYWJsZVJhbmdlOwogICAgdGhpcy5fcmVhZGFibGVTdHJlYW0gPSBudWxsOwogICAgdGhpcy5fcmVhZENhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRoaXMuX2hlYWRlcnNDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICBjb25zdCBmcyA9IHByb2Nlc3MuZ2V0QnVpbHRpbk1vZHVsZSgiZnMiKTsKICAgIGZzLnByb21pc2VzLmxzdGF0KHRoaXMuX3VybCkudGhlbihzdGF0ID0+IHsKICAgICAgdGhpcy5fY29udGVudExlbmd0aCA9IHN0YXQuc2l6ZTsKICAgICAgdGhpcy5fc2V0UmVhZGFibGVTdHJlYW0oZnMuY3JlYXRlUmVhZFN0cmVhbSh0aGlzLl91cmwpKTsKICAgICAgdGhpcy5faGVhZGVyc0NhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgfSwgZXJyb3IgPT4gewogICAgICBpZiAoZXJyb3IuY29kZSA9PT0gIkVOT0VOVCIpIHsKICAgICAgICBlcnJvciA9IGNyZWF0ZVJlc3BvbnNlRXJyb3IoMCwgdGhpcy5fdXJsLmhyZWYpOwogICAgICB9CiAgICAgIHRoaXMuX3N0b3JlZEVycm9yID0gZXJyb3I7CiAgICAgIHRoaXMuX2hlYWRlcnNDYXBhYmlsaXR5LnJlamVjdChlcnJvcik7CiAgICB9KTsKICB9CiAgZ2V0IGhlYWRlcnNSZWFkeSgpIHsKICAgIHJldHVybiB0aGlzLl9oZWFkZXJzQ2FwYWJpbGl0eS5wcm9taXNlOwogIH0KICBnZXQgZmlsZW5hbWUoKSB7CiAgICByZXR1cm4gdGhpcy5fZmlsZW5hbWU7CiAgfQogIGdldCBjb250ZW50TGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX2NvbnRlbnRMZW5ndGg7CiAgfQogIGdldCBpc1JhbmdlU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQ7CiAgfQogIGdldCBpc1N0cmVhbWluZ1N1cHBvcnRlZCgpIHsKICAgIHJldHVybiB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZDsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGF3YWl0IHRoaXMuX3JlYWRDYXBhYmlsaXR5LnByb21pc2U7CiAgICBpZiAodGhpcy5fZG9uZSkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgZG9uZTogdHJ1ZQogICAgICB9OwogICAgfQogICAgaWYgKHRoaXMuX3N0b3JlZEVycm9yKSB7CiAgICAgIHRocm93IHRoaXMuX3N0b3JlZEVycm9yOwogICAgfQogICAgY29uc3QgY2h1bmsgPSB0aGlzLl9yZWFkYWJsZVN0cmVhbS5yZWFkKCk7CiAgICBpZiAoY2h1bmsgPT09IG51bGwpIHsKICAgICAgdGhpcy5fcmVhZENhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgICAgcmV0dXJuIHRoaXMucmVhZCgpOwogICAgfQogICAgdGhpcy5fbG9hZGVkICs9IGNodW5rLmxlbmd0aDsKICAgIHRoaXMub25Qcm9ncmVzcz8uKHsKICAgICAgbG9hZGVkOiB0aGlzLl9sb2FkZWQsCiAgICAgIHRvdGFsOiB0aGlzLl9jb250ZW50TGVuZ3RoCiAgICB9KTsKICAgIGNvbnN0IGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGNodW5rKS5idWZmZXI7CiAgICByZXR1cm4gewogICAgICB2YWx1ZTogYnVmZmVyLAogICAgICBkb25lOiBmYWxzZQogICAgfTsKICB9CiAgY2FuY2VsKHJlYXNvbikgewogICAgaWYgKCF0aGlzLl9yZWFkYWJsZVN0cmVhbSkgewogICAgICB0aGlzLl9lcnJvcihyZWFzb24pOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9yZWFkYWJsZVN0cmVhbS5kZXN0cm95KHJlYXNvbik7CiAgfQogIF9lcnJvcihyZWFzb24pIHsKICAgIHRoaXMuX3N0b3JlZEVycm9yID0gcmVhc29uOwogICAgdGhpcy5fcmVhZENhcGFiaWxpdHkucmVzb2x2ZSgpOwogIH0KICBfc2V0UmVhZGFibGVTdHJlYW0ocmVhZGFibGVTdHJlYW0pIHsKICAgIHRoaXMuX3JlYWRhYmxlU3RyZWFtID0gcmVhZGFibGVTdHJlYW07CiAgICByZWFkYWJsZVN0cmVhbS5vbigicmVhZGFibGUiLCAoKSA9PiB7CiAgICAgIHRoaXMuX3JlYWRDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgIH0pOwogICAgcmVhZGFibGVTdHJlYW0ub24oImVuZCIsICgpID0+IHsKICAgICAgcmVhZGFibGVTdHJlYW0uZGVzdHJveSgpOwogICAgICB0aGlzLl9kb25lID0gdHJ1ZTsKICAgICAgdGhpcy5fcmVhZENhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgfSk7CiAgICByZWFkYWJsZVN0cmVhbS5vbigiZXJyb3IiLCByZWFzb24gPT4gewogICAgICB0aGlzLl9lcnJvcihyZWFzb24pOwogICAgfSk7CiAgICBpZiAoIXRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkICYmIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQpIHsKICAgICAgdGhpcy5fZXJyb3IobmV3IEFib3J0RXhjZXB0aW9uKCJzdHJlYW1pbmcgaXMgZGlzYWJsZWQiKSk7CiAgICB9CiAgICBpZiAodGhpcy5fc3RvcmVkRXJyb3IpIHsKICAgICAgdGhpcy5fcmVhZGFibGVTdHJlYW0uZGVzdHJveSh0aGlzLl9zdG9yZWRFcnJvcik7CiAgICB9CiAgfQp9CmNsYXNzIFBERk5vZGVTdHJlYW1Gc1JhbmdlUmVhZGVyIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIHN0YXJ0LCBlbmQpIHsKICAgIHRoaXMuX3VybCA9IHN0cmVhbS51cmw7CiAgICB0aGlzLl9kb25lID0gZmFsc2U7CiAgICB0aGlzLl9zdG9yZWRFcnJvciA9IG51bGw7CiAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsOwogICAgdGhpcy5fbG9hZGVkID0gMDsKICAgIHRoaXMuX3JlYWRhYmxlU3RyZWFtID0gbnVsbDsKICAgIHRoaXMuX3JlYWRDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICBjb25zdCBzb3VyY2UgPSBzdHJlYW0uc291cmNlOwogICAgdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQgPSAhc291cmNlLmRpc2FibGVTdHJlYW07CiAgICBjb25zdCBmcyA9IHByb2Nlc3MuZ2V0QnVpbHRpbk1vZHVsZSgiZnMiKTsKICAgIHRoaXMuX3NldFJlYWRhYmxlU3RyZWFtKGZzLmNyZWF0ZVJlYWRTdHJlYW0odGhpcy5fdXJsLCB7CiAgICAgIHN0YXJ0LAogICAgICBlbmQ6IGVuZCAtIDEKICAgIH0pKTsKICB9CiAgZ2V0IGlzU3RyZWFtaW5nU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkOwogIH0KICBhc3luYyByZWFkKCkgewogICAgYXdhaXQgdGhpcy5fcmVhZENhcGFiaWxpdHkucHJvbWlzZTsKICAgIGlmICh0aGlzLl9kb25lKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICBkb25lOiB0cnVlCiAgICAgIH07CiAgICB9CiAgICBpZiAodGhpcy5fc3RvcmVkRXJyb3IpIHsKICAgICAgdGhyb3cgdGhpcy5fc3RvcmVkRXJyb3I7CiAgICB9CiAgICBjb25zdCBjaHVuayA9IHRoaXMuX3JlYWRhYmxlU3RyZWFtLnJlYWQoKTsKICAgIGlmIChjaHVuayA9PT0gbnVsbCkgewogICAgICB0aGlzLl9yZWFkQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgICByZXR1cm4gdGhpcy5yZWFkKCk7CiAgICB9CiAgICB0aGlzLl9sb2FkZWQgKz0gY2h1bmsubGVuZ3RoOwogICAgdGhpcy5vblByb2dyZXNzPy4oewogICAgICBsb2FkZWQ6IHRoaXMuX2xvYWRlZAogICAgfSk7CiAgICBjb25zdCBidWZmZXIgPSBuZXcgVWludDhBcnJheShjaHVuaykuYnVmZmVyOwogICAgcmV0dXJuIHsKICAgICAgdmFsdWU6IGJ1ZmZlciwKICAgICAgZG9uZTogZmFsc2UKICAgIH07CiAgfQogIGNhbmNlbChyZWFzb24pIHsKICAgIGlmICghdGhpcy5fcmVhZGFibGVTdHJlYW0pIHsKICAgICAgdGhpcy5fZXJyb3IocmVhc29uKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fcmVhZGFibGVTdHJlYW0uZGVzdHJveShyZWFzb24pOwogIH0KICBfZXJyb3IocmVhc29uKSB7CiAgICB0aGlzLl9zdG9yZWRFcnJvciA9IHJlYXNvbjsKICAgIHRoaXMuX3JlYWRDYXBhYmlsaXR5LnJlc29sdmUoKTsKICB9CiAgX3NldFJlYWRhYmxlU3RyZWFtKHJlYWRhYmxlU3RyZWFtKSB7CiAgICB0aGlzLl9yZWFkYWJsZVN0cmVhbSA9IHJlYWRhYmxlU3RyZWFtOwogICAgcmVhZGFibGVTdHJlYW0ub24oInJlYWRhYmxlIiwgKCkgPT4gewogICAgICB0aGlzLl9yZWFkQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICB9KTsKICAgIHJlYWRhYmxlU3RyZWFtLm9uKCJlbmQiLCAoKSA9PiB7CiAgICAgIHJlYWRhYmxlU3RyZWFtLmRlc3Ryb3koKTsKICAgICAgdGhpcy5fZG9uZSA9IHRydWU7CiAgICAgIHRoaXMuX3JlYWRDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgIH0pOwogICAgcmVhZGFibGVTdHJlYW0ub24oImVycm9yIiwgcmVhc29uID0+IHsKICAgICAgdGhpcy5fZXJyb3IocmVhc29uKTsKICAgIH0pOwogICAgaWYgKHRoaXMuX3N0b3JlZEVycm9yKSB7CiAgICAgIHRoaXMuX3JlYWRhYmxlU3RyZWFtLmRlc3Ryb3kodGhpcy5fc3RvcmVkRXJyb3IpOwogICAgfQogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvcGRmX29iamVjdHMuanMKY29uc3QgSU5JVElBTF9EQVRBID0gU3ltYm9sKCJJTklUSUFMX0RBVEEiKTsKY2xhc3MgUERGT2JqZWN0cyB7CiAgI29ianMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICNlbnN1cmVPYmoob2JqSWQpIHsKICAgIHJldHVybiB0aGlzLiNvYmpzW29iaklkXSB8fD0gewogICAgICAuLi5Qcm9taXNlLndpdGhSZXNvbHZlcnMoKSwKICAgICAgZGF0YTogSU5JVElBTF9EQVRBCiAgICB9OwogIH0KICBnZXQob2JqSWQsIGNhbGxiYWNrID0gbnVsbCkgewogICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXMuI2Vuc3VyZU9iaihvYmpJZCk7CiAgICAgIG9iai5wcm9taXNlLnRoZW4oKCkgPT4gY2FsbGJhY2sob2JqLmRhdGEpKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBvYmogPSB0aGlzLiNvYmpzW29iaklkXTsKICAgIGlmICghb2JqIHx8IG9iai5kYXRhID09PSBJTklUSUFMX0RBVEEpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBSZXF1ZXN0aW5nIG9iamVjdCB0aGF0IGlzbid0IHJlc29sdmVkIHlldCAke29iaklkfS5gKTsKICAgIH0KICAgIHJldHVybiBvYmouZGF0YTsKICB9CiAgaGFzKG9iaklkKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLiNvYmpzW29iaklkXTsKICAgIHJldHVybiAhIW9iaiAmJiBvYmouZGF0YSAhPT0gSU5JVElBTF9EQVRBOwogIH0KICBkZWxldGUob2JqSWQpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI29ianNbb2JqSWRdOwogICAgaWYgKCFvYmogfHwgb2JqLmRhdGEgPT09IElOSVRJQUxfREFUQSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBkZWxldGUgdGhpcy4jb2Jqc1tvYmpJZF07CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcmVzb2x2ZShvYmpJZCwgZGF0YSA9IG51bGwpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2Vuc3VyZU9iaihvYmpJZCk7CiAgICBvYmouZGF0YSA9IGRhdGE7CiAgICBvYmoucmVzb2x2ZSgpOwogIH0KICBjbGVhcigpIHsKICAgIGZvciAoY29uc3Qgb2JqSWQgaW4gdGhpcy4jb2JqcykgewogICAgICBjb25zdCB7CiAgICAgICAgZGF0YQogICAgICB9ID0gdGhpcy4jb2Jqc1tvYmpJZF07CiAgICAgIGRhdGE/LmJpdG1hcD8uY2xvc2UoKTsKICAgIH0KICAgIHRoaXMuI29ianMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIH0KICAqW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICBmb3IgKGNvbnN0IG9iaklkIGluIHRoaXMuI29ianMpIHsKICAgICAgY29uc3QgewogICAgICAgIGRhdGEKICAgICAgfSA9IHRoaXMuI29ianNbb2JqSWRdOwogICAgICBpZiAoZGF0YSA9PT0gSU5JVElBTF9EQVRBKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgeWllbGQgW29iaklkLCBkYXRhXTsKICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L3RleHRfbGF5ZXIuanMKCgpjb25zdCBNQVhfVEVYVF9ESVZTX1RPX1JFTkRFUiA9IDEwMDAwMDsKY29uc3QgREVGQVVMVF9GT05UX1NJWkUgPSAzMDsKY2xhc3MgVGV4dExheWVyIHsKICAjY2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICNjb250YWluZXIgPSBudWxsOwogICNkaXNhYmxlUHJvY2Vzc0l0ZW1zID0gZmFsc2U7CiAgI2ZvbnRJbnNwZWN0b3JFbmFibGVkID0gISFnbG9iYWxUaGlzLkZvbnRJbnNwZWN0b3I/LmVuYWJsZWQ7CiAgI2xhbmcgPSBudWxsOwogICNsYXlvdXRUZXh0UGFyYW1zID0gbnVsbDsKICAjcGFnZUhlaWdodCA9IDA7CiAgI3BhZ2VXaWR0aCA9IDA7CiAgI3JlYWRlciA9IG51bGw7CiAgI3Jvb3RDb250YWluZXIgPSBudWxsOwogICNyb3RhdGlvbiA9IDA7CiAgI3NjYWxlID0gMDsKICAjc3R5bGVDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgI3RleHRDb250ZW50SXRlbXNTdHIgPSBbXTsKICAjdGV4dENvbnRlbnRTb3VyY2UgPSBudWxsOwogICN0ZXh0RGl2cyA9IFtdOwogICN0ZXh0RGl2UHJvcGVydGllcyA9IG5ldyBXZWFrTWFwKCk7CiAgI3RyYW5zZm9ybSA9IG51bGw7CiAgc3RhdGljICNhc2NlbnRDYWNoZSA9IG5ldyBNYXAoKTsKICBzdGF0aWMgI2NhbnZhc0NvbnRleHRzID0gbmV3IE1hcCgpOwogIHN0YXRpYyAjY2FudmFzQ3R4Rm9udHMgPSBuZXcgV2Vha01hcCgpOwogIHN0YXRpYyAjbWluRm9udFNpemUgPSBudWxsOwogIHN0YXRpYyAjcGVuZGluZ1RleHRMYXllcnMgPSBuZXcgU2V0KCk7CiAgY29uc3RydWN0b3IoewogICAgdGV4dENvbnRlbnRTb3VyY2UsCiAgICBjb250YWluZXIsCiAgICB2aWV3cG9ydAogIH0pIHsKICAgIGlmICh0ZXh0Q29udGVudFNvdXJjZSBpbnN0YW5jZW9mIFJlYWRhYmxlU3RyZWFtKSB7CiAgICAgIHRoaXMuI3RleHRDb250ZW50U291cmNlID0gdGV4dENvbnRlbnRTb3VyY2U7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB0ZXh0Q29udGVudFNvdXJjZSA9PT0gIm9iamVjdCIpIHsKICAgICAgdGhpcy4jdGV4dENvbnRlbnRTb3VyY2UgPSBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICAgIHN0YXJ0KGNvbnRyb2xsZXIpIHsKICAgICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZSh0ZXh0Q29udGVudFNvdXJjZSk7CiAgICAgICAgICBjb250cm9sbGVyLmNsb3NlKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gInRleHRDb250ZW50U291cmNlIiBwYXJhbWV0ZXIgc3BlY2lmaWVkLicpOwogICAgfQogICAgdGhpcy4jY29udGFpbmVyID0gdGhpcy4jcm9vdENvbnRhaW5lciA9IGNvbnRhaW5lcjsKICAgIHRoaXMuI3NjYWxlID0gdmlld3BvcnQuc2NhbGUgKiBPdXRwdXRTY2FsZS5waXhlbFJhdGlvOwogICAgdGhpcy4jcm90YXRpb24gPSB2aWV3cG9ydC5yb3RhdGlvbjsKICAgIHRoaXMuI2xheW91dFRleHRQYXJhbXMgPSB7CiAgICAgIGRpdjogbnVsbCwKICAgICAgcHJvcGVydGllczogbnVsbCwKICAgICAgY3R4OiBudWxsCiAgICB9OwogICAgY29uc3QgewogICAgICBwYWdlV2lkdGgsCiAgICAgIHBhZ2VIZWlnaHQsCiAgICAgIHBhZ2VYLAogICAgICBwYWdlWQogICAgfSA9IHZpZXdwb3J0LnJhd0RpbXM7CiAgICB0aGlzLiN0cmFuc2Zvcm0gPSBbMSwgMCwgMCwgLTEsIC1wYWdlWCwgcGFnZVkgKyBwYWdlSGVpZ2h0XTsKICAgIHRoaXMuI3BhZ2VXaWR0aCA9IHBhZ2VXaWR0aDsKICAgIHRoaXMuI3BhZ2VIZWlnaHQgPSBwYWdlSGVpZ2h0OwogICAgVGV4dExheWVyLiNlbnN1cmVNaW5Gb250U2l6ZUNvbXB1dGVkKCk7CiAgICBzZXRMYXllckRpbWVuc2lvbnMoY29udGFpbmVyLCB2aWV3cG9ydCk7CiAgICB0aGlzLiNjYXBhYmlsaXR5LnByb21pc2UuZmluYWxseSgoKSA9PiB7CiAgICAgIFRleHRMYXllci4jcGVuZGluZ1RleHRMYXllcnMuZGVsZXRlKHRoaXMpOwogICAgICB0aGlzLiNsYXlvdXRUZXh0UGFyYW1zID0gbnVsbDsKICAgICAgdGhpcy4jc3R5bGVDYWNoZSA9IG51bGw7CiAgICB9KS5jYXRjaCgoKSA9PiB7fSk7CiAgfQogIHN0YXRpYyBnZXQgZm9udEZhbWlseU1hcCgpIHsKICAgIGNvbnN0IHsKICAgICAgaXNXaW5kb3dzLAogICAgICBpc0ZpcmVmb3gKICAgIH0gPSB1dGlsX0ZlYXR1cmVUZXN0LnBsYXRmb3JtOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZm9udEZhbWlseU1hcCIsIG5ldyBNYXAoW1sic2Fucy1zZXJpZiIsIGAke2lzV2luZG93cyAmJiBpc0ZpcmVmb3ggPyAiQ2FsaWJyaSwgIiA6ICIifXNhbnMtc2VyaWZgXSwgWyJtb25vc3BhY2UiLCBgJHtpc1dpbmRvd3MgJiYgaXNGaXJlZm94ID8gIkx1Y2lkYSBDb25zb2xlLCAiIDogIiJ9bW9ub3NwYWNlYF1dKSk7CiAgfQogIHJlbmRlcigpIHsKICAgIGNvbnN0IHB1bXAgPSAoKSA9PiB7CiAgICAgIHRoaXMuI3JlYWRlci5yZWFkKCkudGhlbigoewogICAgICAgIHZhbHVlLAogICAgICAgIGRvbmUKICAgICAgfSkgPT4gewogICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICB0aGlzLiNjYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy4jbGFuZyA/Pz0gdmFsdWUubGFuZzsKICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuI3N0eWxlQ2FjaGUsIHZhbHVlLnN0eWxlcyk7CiAgICAgICAgdGhpcy4jcHJvY2Vzc0l0ZW1zKHZhbHVlLml0ZW1zKTsKICAgICAgICBwdW1wKCk7CiAgICAgIH0sIHRoaXMuI2NhcGFiaWxpdHkucmVqZWN0KTsKICAgIH07CiAgICB0aGlzLiNyZWFkZXIgPSB0aGlzLiN0ZXh0Q29udGVudFNvdXJjZS5nZXRSZWFkZXIoKTsKICAgIFRleHRMYXllci4jcGVuZGluZ1RleHRMYXllcnMuYWRkKHRoaXMpOwogICAgcHVtcCgpOwogICAgcmV0dXJuIHRoaXMuI2NhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgdXBkYXRlKHsKICAgIHZpZXdwb3J0LAogICAgb25CZWZvcmUgPSBudWxsCiAgfSkgewogICAgY29uc3Qgc2NhbGUgPSB2aWV3cG9ydC5zY2FsZSAqIE91dHB1dFNjYWxlLnBpeGVsUmF0aW87CiAgICBjb25zdCByb3RhdGlvbiA9IHZpZXdwb3J0LnJvdGF0aW9uOwogICAgaWYgKHJvdGF0aW9uICE9PSB0aGlzLiNyb3RhdGlvbikgewogICAgICBvbkJlZm9yZT8uKCk7CiAgICAgIHRoaXMuI3JvdGF0aW9uID0gcm90YXRpb247CiAgICAgIHNldExheWVyRGltZW5zaW9ucyh0aGlzLiNyb290Q29udGFpbmVyLCB7CiAgICAgICAgcm90YXRpb24KICAgICAgfSk7CiAgICB9CiAgICBpZiAoc2NhbGUgIT09IHRoaXMuI3NjYWxlKSB7CiAgICAgIG9uQmVmb3JlPy4oKTsKICAgICAgdGhpcy4jc2NhbGUgPSBzY2FsZTsKICAgICAgY29uc3QgcGFyYW1zID0gewogICAgICAgIGRpdjogbnVsbCwKICAgICAgICBwcm9wZXJ0aWVzOiBudWxsLAogICAgICAgIGN0eDogVGV4dExheWVyLiNnZXRDdHgodGhpcy4jbGFuZykKICAgICAgfTsKICAgICAgZm9yIChjb25zdCBkaXYgb2YgdGhpcy4jdGV4dERpdnMpIHsKICAgICAgICBwYXJhbXMucHJvcGVydGllcyA9IHRoaXMuI3RleHREaXZQcm9wZXJ0aWVzLmdldChkaXYpOwogICAgICAgIHBhcmFtcy5kaXYgPSBkaXY7CiAgICAgICAgdGhpcy4jbGF5b3V0KHBhcmFtcyk7CiAgICAgIH0KICAgIH0KICB9CiAgY2FuY2VsKCkgewogICAgY29uc3QgYWJvcnRFeCA9IG5ldyBBYm9ydEV4Y2VwdGlvbigiVGV4dExheWVyIHRhc2sgY2FuY2VsbGVkLiIpOwogICAgdGhpcy4jcmVhZGVyPy5jYW5jZWwoYWJvcnRFeCkuY2F0Y2goKCkgPT4ge30pOwogICAgdGhpcy4jcmVhZGVyID0gbnVsbDsKICAgIHRoaXMuI2NhcGFiaWxpdHkucmVqZWN0KGFib3J0RXgpOwogIH0KICBnZXQgdGV4dERpdnMoKSB7CiAgICByZXR1cm4gdGhpcy4jdGV4dERpdnM7CiAgfQogIGdldCB0ZXh0Q29udGVudEl0ZW1zU3RyKCkgewogICAgcmV0dXJuIHRoaXMuI3RleHRDb250ZW50SXRlbXNTdHI7CiAgfQogICNwcm9jZXNzSXRlbXMoaXRlbXMpIHsKICAgIGlmICh0aGlzLiNkaXNhYmxlUHJvY2Vzc0l0ZW1zKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2xheW91dFRleHRQYXJhbXMuY3R4ID8/PSBUZXh0TGF5ZXIuI2dldEN0eCh0aGlzLiNsYW5nKTsKICAgIGNvbnN0IHRleHREaXZzID0gdGhpcy4jdGV4dERpdnMsCiAgICAgIHRleHRDb250ZW50SXRlbXNTdHIgPSB0aGlzLiN0ZXh0Q29udGVudEl0ZW1zU3RyOwogICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7CiAgICAgIGlmICh0ZXh0RGl2cy5sZW5ndGggPiBNQVhfVEVYVF9ESVZTX1RPX1JFTkRFUikgewogICAgICAgIHdhcm4oIklnbm9yaW5nIGFkZGl0aW9uYWwgdGV4dERpdnMgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMuIik7CiAgICAgICAgdGhpcy4jZGlzYWJsZVByb2Nlc3NJdGVtcyA9IHRydWU7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChpdGVtLnN0ciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gImJlZ2luTWFya2VkQ29udGVudFByb3BzIiB8fCBpdGVtLnR5cGUgPT09ICJiZWdpbk1hcmtlZENvbnRlbnQiKSB7CiAgICAgICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLiNjb250YWluZXI7CiAgICAgICAgICB0aGlzLiNjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICAgICAgICB0aGlzLiNjb250YWluZXIuY2xhc3NMaXN0LmFkZCgibWFya2VkQ29udGVudCIpOwogICAgICAgICAgaWYgKGl0ZW0uaWQgIT09IG51bGwpIHsKICAgICAgICAgICAgdGhpcy4jY29udGFpbmVyLnNldEF0dHJpYnV0ZSgiaWQiLCBgJHtpdGVtLmlkfWApOwogICAgICAgICAgfQogICAgICAgICAgcGFyZW50LmFwcGVuZCh0aGlzLiNjb250YWluZXIpOwogICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlID09PSAiZW5kTWFya2VkQ29udGVudCIpIHsKICAgICAgICAgIHRoaXMuI2NvbnRhaW5lciA9IHRoaXMuI2NvbnRhaW5lci5wYXJlbnROb2RlOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0ZXh0Q29udGVudEl0ZW1zU3RyLnB1c2goaXRlbS5zdHIpOwogICAgICB0aGlzLiNhcHBlbmRUZXh0KGl0ZW0pOwogICAgfQogIH0KICAjYXBwZW5kVGV4dChnZW9tKSB7CiAgICBjb25zdCB0ZXh0RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgY29uc3QgdGV4dERpdlByb3BlcnRpZXMgPSB7CiAgICAgIGFuZ2xlOiAwLAogICAgICBjYW52YXNXaWR0aDogMCwKICAgICAgaGFzVGV4dDogZ2VvbS5zdHIgIT09ICIiLAogICAgICBoYXNFT0w6IGdlb20uaGFzRU9MLAogICAgICBmb250U2l6ZTogMAogICAgfTsKICAgIHRoaXMuI3RleHREaXZzLnB1c2godGV4dERpdik7CiAgICBjb25zdCB0eCA9IFV0aWwudHJhbnNmb3JtKHRoaXMuI3RyYW5zZm9ybSwgZ2VvbS50cmFuc2Zvcm0pOwogICAgbGV0IGFuZ2xlID0gTWF0aC5hdGFuMih0eFsxXSwgdHhbMF0pOwogICAgY29uc3Qgc3R5bGUgPSB0aGlzLiNzdHlsZUNhY2hlW2dlb20uZm9udE5hbWVdOwogICAgaWYgKHN0eWxlLnZlcnRpY2FsKSB7CiAgICAgIGFuZ2xlICs9IE1hdGguUEkgLyAyOwogICAgfQogICAgbGV0IGZvbnRGYW1pbHkgPSB0aGlzLiNmb250SW5zcGVjdG9yRW5hYmxlZCAmJiBzdHlsZS5mb250U3Vic3RpdHV0aW9uIHx8IHN0eWxlLmZvbnRGYW1pbHk7CiAgICBmb250RmFtaWx5ID0gVGV4dExheWVyLmZvbnRGYW1pbHlNYXAuZ2V0KGZvbnRGYW1pbHkpIHx8IGZvbnRGYW1pbHk7CiAgICBjb25zdCBmb250SGVpZ2h0ID0gTWF0aC5oeXBvdCh0eFsyXSwgdHhbM10pOwogICAgY29uc3QgZm9udEFzY2VudCA9IGZvbnRIZWlnaHQgKiBUZXh0TGF5ZXIuI2dldEFzY2VudChmb250RmFtaWx5LCBzdHlsZSwgdGhpcy4jbGFuZyk7CiAgICBsZXQgbGVmdCwgdG9wOwogICAgaWYgKGFuZ2xlID09PSAwKSB7CiAgICAgIGxlZnQgPSB0eFs0XTsKICAgICAgdG9wID0gdHhbNV0gLSBmb250QXNjZW50OwogICAgfSBlbHNlIHsKICAgICAgbGVmdCA9IHR4WzRdICsgZm9udEFzY2VudCAqIE1hdGguc2luKGFuZ2xlKTsKICAgICAgdG9wID0gdHhbNV0gLSBmb250QXNjZW50ICogTWF0aC5jb3MoYW5nbGUpOwogICAgfQogICAgY29uc3Qgc2NhbGVGYWN0b3JTdHIgPSAiY2FsYyh2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpICoiOwogICAgY29uc3QgZGl2U3R5bGUgPSB0ZXh0RGl2LnN0eWxlOwogICAgaWYgKHRoaXMuI2NvbnRhaW5lciA9PT0gdGhpcy4jcm9vdENvbnRhaW5lcikgewogICAgICBkaXZTdHlsZS5sZWZ0ID0gYCR7KDEwMCAqIGxlZnQgLyB0aGlzLiNwYWdlV2lkdGgpLnRvRml4ZWQoMil9JWA7CiAgICAgIGRpdlN0eWxlLnRvcCA9IGAkeygxMDAgKiB0b3AgLyB0aGlzLiNwYWdlSGVpZ2h0KS50b0ZpeGVkKDIpfSVgOwogICAgfSBlbHNlIHsKICAgICAgZGl2U3R5bGUubGVmdCA9IGAke3NjYWxlRmFjdG9yU3RyfSR7bGVmdC50b0ZpeGVkKDIpfXB4KWA7CiAgICAgIGRpdlN0eWxlLnRvcCA9IGAke3NjYWxlRmFjdG9yU3RyfSR7dG9wLnRvRml4ZWQoMil9cHgpYDsKICAgIH0KICAgIGRpdlN0eWxlLmZvbnRTaXplID0gYCR7c2NhbGVGYWN0b3JTdHJ9JHsoVGV4dExheWVyLiNtaW5Gb250U2l6ZSAqIGZvbnRIZWlnaHQpLnRvRml4ZWQoMil9cHgpYDsKICAgIGRpdlN0eWxlLmZvbnRGYW1pbHkgPSBmb250RmFtaWx5OwogICAgdGV4dERpdlByb3BlcnRpZXMuZm9udFNpemUgPSBmb250SGVpZ2h0OwogICAgdGV4dERpdi5zZXRBdHRyaWJ1dGUoInJvbGUiLCAicHJlc2VudGF0aW9uIik7CiAgICB0ZXh0RGl2LnRleHRDb250ZW50ID0gZ2VvbS5zdHI7CiAgICB0ZXh0RGl2LmRpciA9IGdlb20uZGlyOwogICAgaWYgKHRoaXMuI2ZvbnRJbnNwZWN0b3JFbmFibGVkKSB7CiAgICAgIHRleHREaXYuZGF0YXNldC5mb250TmFtZSA9IHN0eWxlLmZvbnRTdWJzdGl0dXRpb25Mb2FkZWROYW1lIHx8IGdlb20uZm9udE5hbWU7CiAgICB9CiAgICBpZiAoYW5nbGUgIT09IDApIHsKICAgICAgdGV4dERpdlByb3BlcnRpZXMuYW5nbGUgPSBhbmdsZSAqICgxODAgLyBNYXRoLlBJKTsKICAgIH0KICAgIGxldCBzaG91bGRTY2FsZVRleHQgPSBmYWxzZTsKICAgIGlmIChnZW9tLnN0ci5sZW5ndGggPiAxKSB7CiAgICAgIHNob3VsZFNjYWxlVGV4dCA9IHRydWU7CiAgICB9IGVsc2UgaWYgKGdlb20uc3RyICE9PSAiICIgJiYgZ2VvbS50cmFuc2Zvcm1bMF0gIT09IGdlb20udHJhbnNmb3JtWzNdKSB7CiAgICAgIGNvbnN0IGFic1NjYWxlWCA9IE1hdGguYWJzKGdlb20udHJhbnNmb3JtWzBdKSwKICAgICAgICBhYnNTY2FsZVkgPSBNYXRoLmFicyhnZW9tLnRyYW5zZm9ybVszXSk7CiAgICAgIGlmIChhYnNTY2FsZVggIT09IGFic1NjYWxlWSAmJiBNYXRoLm1heChhYnNTY2FsZVgsIGFic1NjYWxlWSkgLyBNYXRoLm1pbihhYnNTY2FsZVgsIGFic1NjYWxlWSkgPiAxLjUpIHsKICAgICAgICBzaG91bGRTY2FsZVRleHQgPSB0cnVlOwogICAgICB9CiAgICB9CiAgICBpZiAoc2hvdWxkU2NhbGVUZXh0KSB7CiAgICAgIHRleHREaXZQcm9wZXJ0aWVzLmNhbnZhc1dpZHRoID0gc3R5bGUudmVydGljYWwgPyBnZW9tLmhlaWdodCA6IGdlb20ud2lkdGg7CiAgICB9CiAgICB0aGlzLiN0ZXh0RGl2UHJvcGVydGllcy5zZXQodGV4dERpdiwgdGV4dERpdlByb3BlcnRpZXMpOwogICAgdGhpcy4jbGF5b3V0VGV4dFBhcmFtcy5kaXYgPSB0ZXh0RGl2OwogICAgdGhpcy4jbGF5b3V0VGV4dFBhcmFtcy5wcm9wZXJ0aWVzID0gdGV4dERpdlByb3BlcnRpZXM7CiAgICB0aGlzLiNsYXlvdXQodGhpcy4jbGF5b3V0VGV4dFBhcmFtcyk7CiAgICBpZiAodGV4dERpdlByb3BlcnRpZXMuaGFzVGV4dCkgewogICAgICB0aGlzLiNjb250YWluZXIuYXBwZW5kKHRleHREaXYpOwogICAgfQogICAgaWYgKHRleHREaXZQcm9wZXJ0aWVzLmhhc0VPTCkgewogICAgICBjb25zdCBiciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIik7CiAgICAgIGJyLnNldEF0dHJpYnV0ZSgicm9sZSIsICJwcmVzZW50YXRpb24iKTsKICAgICAgdGhpcy4jY29udGFpbmVyLmFwcGVuZChicik7CiAgICB9CiAgfQogICNsYXlvdXQocGFyYW1zKSB7CiAgICBjb25zdCB7CiAgICAgIGRpdiwKICAgICAgcHJvcGVydGllcywKICAgICAgY3R4CiAgICB9ID0gcGFyYW1zOwogICAgY29uc3QgewogICAgICBzdHlsZQogICAgfSA9IGRpdjsKICAgIGxldCB0cmFuc2Zvcm0gPSAiIjsKICAgIGlmIChUZXh0TGF5ZXIuI21pbkZvbnRTaXplID4gMSkgewogICAgICB0cmFuc2Zvcm0gPSBgc2NhbGUoJHsxIC8gVGV4dExheWVyLiNtaW5Gb250U2l6ZX0pYDsKICAgIH0KICAgIGlmIChwcm9wZXJ0aWVzLmNhbnZhc1dpZHRoICE9PSAwICYmIHByb3BlcnRpZXMuaGFzVGV4dCkgewogICAgICBjb25zdCB7CiAgICAgICAgZm9udEZhbWlseQogICAgICB9ID0gc3R5bGU7CiAgICAgIGNvbnN0IHsKICAgICAgICBjYW52YXNXaWR0aCwKICAgICAgICBmb250U2l6ZQogICAgICB9ID0gcHJvcGVydGllczsKICAgICAgVGV4dExheWVyLiNlbnN1cmVDdHhGb250KGN0eCwgZm9udFNpemUgKiB0aGlzLiNzY2FsZSwgZm9udEZhbWlseSk7CiAgICAgIGNvbnN0IHsKICAgICAgICB3aWR0aAogICAgICB9ID0gY3R4Lm1lYXN1cmVUZXh0KGRpdi50ZXh0Q29udGVudCk7CiAgICAgIGlmICh3aWR0aCA+IDApIHsKICAgICAgICB0cmFuc2Zvcm0gPSBgc2NhbGVYKCR7Y2FudmFzV2lkdGggKiB0aGlzLiNzY2FsZSAvIHdpZHRofSkgJHt0cmFuc2Zvcm19YDsKICAgICAgfQogICAgfQogICAgaWYgKHByb3BlcnRpZXMuYW5nbGUgIT09IDApIHsKICAgICAgdHJhbnNmb3JtID0gYHJvdGF0ZSgke3Byb3BlcnRpZXMuYW5nbGV9ZGVnKSAke3RyYW5zZm9ybX1gOwogICAgfQogICAgaWYgKHRyYW5zZm9ybS5sZW5ndGggPiAwKSB7CiAgICAgIHN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTsKICAgIH0KICB9CiAgc3RhdGljIGNsZWFudXAoKSB7CiAgICBpZiAodGhpcy4jcGVuZGluZ1RleHRMYXllcnMuc2l6ZSA+IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jYXNjZW50Q2FjaGUuY2xlYXIoKTsKICAgIGZvciAoY29uc3QgewogICAgICBjYW52YXMKICAgIH0gb2YgdGhpcy4jY2FudmFzQ29udGV4dHMudmFsdWVzKCkpIHsKICAgICAgY2FudmFzLnJlbW92ZSgpOwogICAgfQogICAgdGhpcy4jY2FudmFzQ29udGV4dHMuY2xlYXIoKTsKICB9CiAgc3RhdGljICNnZXRDdHgobGFuZyA9IG51bGwpIHsKICAgIGxldCBjdHggPSB0aGlzLiNjYW52YXNDb250ZXh0cy5nZXQobGFuZyB8fD0gIiIpOwogICAgaWYgKCFjdHgpIHsKICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICAgIGNhbnZhcy5jbGFzc05hbWUgPSAiaGlkZGVuQ2FudmFzRWxlbWVudCI7CiAgICAgIGNhbnZhcy5sYW5nID0gbGFuZzsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoY2FudmFzKTsKICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICAgIGFscGhhOiBmYWxzZSwKICAgICAgICB3aWxsUmVhZEZyZXF1ZW50bHk6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuI2NhbnZhc0NvbnRleHRzLnNldChsYW5nLCBjdHgpOwogICAgICB0aGlzLiNjYW52YXNDdHhGb250cy5zZXQoY3R4LCB7CiAgICAgICAgc2l6ZTogMCwKICAgICAgICBmYW1pbHk6ICIiCiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIGN0eDsKICB9CiAgc3RhdGljICNlbnN1cmVDdHhGb250KGN0eCwgc2l6ZSwgZmFtaWx5KSB7CiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLiNjYW52YXNDdHhGb250cy5nZXQoY3R4KTsKICAgIGlmIChzaXplID09PSBjYWNoZWQuc2l6ZSAmJiBmYW1pbHkgPT09IGNhY2hlZC5mYW1pbHkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY3R4LmZvbnQgPSBgJHtzaXplfXB4ICR7ZmFtaWx5fWA7CiAgICBjYWNoZWQuc2l6ZSA9IHNpemU7CiAgICBjYWNoZWQuZmFtaWx5ID0gZmFtaWx5OwogIH0KICBzdGF0aWMgI2Vuc3VyZU1pbkZvbnRTaXplQ29tcHV0ZWQoKSB7CiAgICBpZiAodGhpcy4jbWluRm9udFNpemUgIT09IG51bGwpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBkaXYuc3R5bGUub3BhY2l0eSA9IDA7CiAgICBkaXYuc3R5bGUubGluZUhlaWdodCA9IDE7CiAgICBkaXYuc3R5bGUuZm9udFNpemUgPSAiMXB4IjsKICAgIGRpdi5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICBkaXYudGV4dENvbnRlbnQgPSAiWCI7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZChkaXYpOwogICAgdGhpcy4jbWluRm9udFNpemUgPSBkaXYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0OwogICAgZGl2LnJlbW92ZSgpOwogIH0KICBzdGF0aWMgI2dldEFzY2VudChmb250RmFtaWx5LCBzdHlsZSwgbGFuZykgewogICAgY29uc3QgY2FjaGVkQXNjZW50ID0gdGhpcy4jYXNjZW50Q2FjaGUuZ2V0KGZvbnRGYW1pbHkpOwogICAgaWYgKGNhY2hlZEFzY2VudCkgewogICAgICByZXR1cm4gY2FjaGVkQXNjZW50OwogICAgfQogICAgY29uc3QgY3R4ID0gdGhpcy4jZ2V0Q3R4KGxhbmcpOwogICAgY3R4LmNhbnZhcy53aWR0aCA9IGN0eC5jYW52YXMuaGVpZ2h0ID0gREVGQVVMVF9GT05UX1NJWkU7CiAgICB0aGlzLiNlbnN1cmVDdHhGb250KGN0eCwgREVGQVVMVF9GT05UX1NJWkUsIGZvbnRGYW1pbHkpOwogICAgY29uc3QgbWV0cmljcyA9IGN0eC5tZWFzdXJlVGV4dCgiIik7CiAgICBjb25zdCBhc2NlbnQgPSBtZXRyaWNzLmZvbnRCb3VuZGluZ0JveEFzY2VudDsKICAgIGNvbnN0IGRlc2NlbnQgPSBNYXRoLmFicyhtZXRyaWNzLmZvbnRCb3VuZGluZ0JveERlc2NlbnQpOwogICAgY3R4LmNhbnZhcy53aWR0aCA9IGN0eC5jYW52YXMuaGVpZ2h0ID0gMDsKICAgIGxldCByYXRpbyA9IDAuODsKICAgIGlmIChhc2NlbnQpIHsKICAgICAgcmF0aW8gPSBhc2NlbnQgLyAoYXNjZW50ICsgZGVzY2VudCk7CiAgICB9IGVsc2UgewogICAgICBpZiAodXRpbF9GZWF0dXJlVGVzdC5wbGF0Zm9ybS5pc0ZpcmVmb3gpIHsKICAgICAgICB3YXJuKCJFbmFibGUgdGhlIGBkb20udGV4dE1ldHJpY3MuZm9udEJvdW5kaW5nQm94LmVuYWJsZWRgIHByZWZlcmVuY2UgIiArICJpbiBgYWJvdXQ6Y29uZmlnYCB0byBpbXByb3ZlIFRleHRMYXllciByZW5kZXJpbmcuIik7CiAgICAgIH0KICAgICAgaWYgKHN0eWxlLmFzY2VudCkgewogICAgICAgIHJhdGlvID0gc3R5bGUuYXNjZW50OwogICAgICB9IGVsc2UgaWYgKHN0eWxlLmRlc2NlbnQpIHsKICAgICAgICByYXRpbyA9IDEgKyBzdHlsZS5kZXNjZW50OwogICAgICB9CiAgICB9CiAgICB0aGlzLiNhc2NlbnRDYWNoZS5zZXQoZm9udEZhbWlseSwgcmF0aW8pOwogICAgcmV0dXJuIHJhdGlvOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkveGZhX3RleHQuanMKY2xhc3MgWGZhVGV4dCB7CiAgc3RhdGljIHRleHRDb250ZW50KHhmYSkgewogICAgY29uc3QgaXRlbXMgPSBbXTsKICAgIGNvbnN0IG91dHB1dCA9IHsKICAgICAgaXRlbXMsCiAgICAgIHN0eWxlczogT2JqZWN0LmNyZWF0ZShudWxsKQogICAgfTsKICAgIGZ1bmN0aW9uIHdhbGsobm9kZSkgewogICAgICBpZiAoIW5vZGUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbGV0IHN0ciA9IG51bGw7CiAgICAgIGNvbnN0IG5hbWUgPSBub2RlLm5hbWU7CiAgICAgIGlmIChuYW1lID09PSAiI3RleHQiKSB7CiAgICAgICAgc3RyID0gbm9kZS52YWx1ZTsKICAgICAgfSBlbHNlIGlmICghWGZhVGV4dC5zaG91bGRCdWlsZFRleHQobmFtZSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAobm9kZT8uYXR0cmlidXRlcz8udGV4dENvbnRlbnQpIHsKICAgICAgICBzdHIgPSBub2RlLmF0dHJpYnV0ZXMudGV4dENvbnRlbnQ7CiAgICAgIH0gZWxzZSBpZiAobm9kZS52YWx1ZSkgewogICAgICAgIHN0ciA9IG5vZGUudmFsdWU7CiAgICAgIH0KICAgICAgaWYgKHN0ciAhPT0gbnVsbCkgewogICAgICAgIGl0ZW1zLnB1c2goewogICAgICAgICAgc3RyCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKCFub2RlLmNoaWxkcmVuKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZS5jaGlsZHJlbikgewogICAgICAgIHdhbGsoY2hpbGQpOwogICAgICB9CiAgICB9CiAgICB3YWxrKHhmYSk7CiAgICByZXR1cm4gb3V0cHV0OwogIH0KICBzdGF0aWMgc2hvdWxkQnVpbGRUZXh0KG5hbWUpIHsKICAgIHJldHVybiAhKG5hbWUgPT09ICJ0ZXh0YXJlYSIgfHwgbmFtZSA9PT0gImlucHV0IiB8fCBuYW1lID09PSAib3B0aW9uIiB8fCBuYW1lID09PSAic2VsZWN0Iik7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9hcGkuanMKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpjb25zdCBSRU5ERVJJTkdfQ0FOQ0VMTEVEX1RJTUVPVVQgPSAxMDA7CmZ1bmN0aW9uIGdldERvY3VtZW50KHNyYyA9IHt9KSB7CiAgaWYgKHR5cGVvZiBzcmMgPT09ICJzdHJpbmciIHx8IHNyYyBpbnN0YW5jZW9mIFVSTCkgewogICAgc3JjID0gewogICAgICB1cmw6IHNyYwogICAgfTsKICB9IGVsc2UgaWYgKHNyYyBpbnN0YW5jZW9mIEFycmF5QnVmZmVyIHx8IEFycmF5QnVmZmVyLmlzVmlldyhzcmMpKSB7CiAgICBzcmMgPSB7CiAgICAgIGRhdGE6IHNyYwogICAgfTsKICB9CiAgY29uc3QgdGFzayA9IG5ldyBQREZEb2N1bWVudExvYWRpbmdUYXNrKCk7CiAgY29uc3QgewogICAgZG9jSWQKICB9ID0gdGFzazsKICBjb25zdCB1cmwgPSBzcmMudXJsID8gZ2V0VXJsUHJvcChzcmMudXJsKSA6IG51bGw7CiAgY29uc3QgZGF0YSA9IHNyYy5kYXRhID8gZ2V0RGF0YVByb3Aoc3JjLmRhdGEpIDogbnVsbDsKICBjb25zdCBodHRwSGVhZGVycyA9IHNyYy5odHRwSGVhZGVycyB8fCBudWxsOwogIGNvbnN0IHdpdGhDcmVkZW50aWFscyA9IHNyYy53aXRoQ3JlZGVudGlhbHMgPT09IHRydWU7CiAgY29uc3QgcGFzc3dvcmQgPSBzcmMucGFzc3dvcmQgPz8gbnVsbDsKICBjb25zdCByYW5nZVRyYW5zcG9ydCA9IHNyYy5yYW5nZSBpbnN0YW5jZW9mIFBERkRhdGFSYW5nZVRyYW5zcG9ydCA/IHNyYy5yYW5nZSA6IG51bGw7CiAgY29uc3QgcmFuZ2VDaHVua1NpemUgPSBOdW1iZXIuaXNJbnRlZ2VyKHNyYy5yYW5nZUNodW5rU2l6ZSkgJiYgc3JjLnJhbmdlQ2h1bmtTaXplID4gMCA/IHNyYy5yYW5nZUNodW5rU2l6ZSA6IDIgKiogMTY7CiAgbGV0IHdvcmtlciA9IHNyYy53b3JrZXIgaW5zdGFuY2VvZiBQREZXb3JrZXIgPyBzcmMud29ya2VyIDogbnVsbDsKICBjb25zdCB2ZXJib3NpdHkgPSBzcmMudmVyYm9zaXR5OwogIGNvbnN0IGRvY0Jhc2VVcmwgPSB0eXBlb2Ygc3JjLmRvY0Jhc2VVcmwgPT09ICJzdHJpbmciICYmICFpc0RhdGFTY2hlbWUoc3JjLmRvY0Jhc2VVcmwpID8gc3JjLmRvY0Jhc2VVcmwgOiBudWxsOwogIGNvbnN0IGNNYXBVcmwgPSBnZXRGYWN0b3J5VXJsUHJvcChzcmMuY01hcFVybCk7CiAgY29uc3QgY01hcFBhY2tlZCA9IHNyYy5jTWFwUGFja2VkICE9PSBmYWxzZTsKICBjb25zdCBDTWFwUmVhZGVyRmFjdG9yeSA9IHNyYy5DTWFwUmVhZGVyRmFjdG9yeSB8fCAoaXNOb2RlSlMgPyBOb2RlQ01hcFJlYWRlckZhY3RvcnkgOiBET01DTWFwUmVhZGVyRmFjdG9yeSk7CiAgY29uc3QgaWNjVXJsID0gZ2V0RmFjdG9yeVVybFByb3Aoc3JjLmljY1VybCk7CiAgY29uc3Qgc3RhbmRhcmRGb250RGF0YVVybCA9IGdldEZhY3RvcnlVcmxQcm9wKHNyYy5zdGFuZGFyZEZvbnREYXRhVXJsKTsKICBjb25zdCBTdGFuZGFyZEZvbnREYXRhRmFjdG9yeSA9IHNyYy5TdGFuZGFyZEZvbnREYXRhRmFjdG9yeSB8fCAoaXNOb2RlSlMgPyBOb2RlU3RhbmRhcmRGb250RGF0YUZhY3RvcnkgOiBET01TdGFuZGFyZEZvbnREYXRhRmFjdG9yeSk7CiAgY29uc3Qgd2FzbVVybCA9IGdldEZhY3RvcnlVcmxQcm9wKHNyYy53YXNtVXJsKTsKICBjb25zdCBXYXNtRmFjdG9yeSA9IHNyYy5XYXNtRmFjdG9yeSB8fCAoaXNOb2RlSlMgPyBOb2RlV2FzbUZhY3RvcnkgOiBET01XYXNtRmFjdG9yeSk7CiAgY29uc3QgaWdub3JlRXJyb3JzID0gc3JjLnN0b3BBdEVycm9ycyAhPT0gdHJ1ZTsKICBjb25zdCBtYXhJbWFnZVNpemUgPSBOdW1iZXIuaXNJbnRlZ2VyKHNyYy5tYXhJbWFnZVNpemUpICYmIHNyYy5tYXhJbWFnZVNpemUgPiAtMSA/IHNyYy5tYXhJbWFnZVNpemUgOiAtMTsKICBjb25zdCBpc0V2YWxTdXBwb3J0ZWQgPSBzcmMuaXNFdmFsU3VwcG9ydGVkICE9PSBmYWxzZTsKICBjb25zdCBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA9IHR5cGVvZiBzcmMuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgPT09ICJib29sZWFuIiA/IHNyYy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA6ICFpc05vZGVKUzsKICBjb25zdCBpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA9IHR5cGVvZiBzcmMuaXNJbWFnZURlY29kZXJTdXBwb3J0ZWQgPT09ICJib29sZWFuIiA/IHNyYy5pc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA6ICFpc05vZGVKUyAmJiAodXRpbF9GZWF0dXJlVGVzdC5wbGF0Zm9ybS5pc0ZpcmVmb3ggfHwgIWdsb2JhbFRoaXMuY2hyb21lKTsKICBjb25zdCBjYW52YXNNYXhBcmVhSW5CeXRlcyA9IE51bWJlci5pc0ludGVnZXIoc3JjLmNhbnZhc01heEFyZWFJbkJ5dGVzKSA/IHNyYy5jYW52YXNNYXhBcmVhSW5CeXRlcyA6IC0xOwogIGNvbnN0IGRpc2FibGVGb250RmFjZSA9IHR5cGVvZiBzcmMuZGlzYWJsZUZvbnRGYWNlID09PSAiYm9vbGVhbiIgPyBzcmMuZGlzYWJsZUZvbnRGYWNlIDogaXNOb2RlSlM7CiAgY29uc3QgZm9udEV4dHJhUHJvcGVydGllcyA9IHNyYy5mb250RXh0cmFQcm9wZXJ0aWVzID09PSB0cnVlOwogIGNvbnN0IGVuYWJsZVhmYSA9IHNyYy5lbmFibGVYZmEgPT09IHRydWU7CiAgY29uc3Qgb3duZXJEb2N1bWVudCA9IHNyYy5vd25lckRvY3VtZW50IHx8IGdsb2JhbFRoaXMuZG9jdW1lbnQ7CiAgY29uc3QgZGlzYWJsZVJhbmdlID0gc3JjLmRpc2FibGVSYW5nZSA9PT0gdHJ1ZTsKICBjb25zdCBkaXNhYmxlU3RyZWFtID0gc3JjLmRpc2FibGVTdHJlYW0gPT09IHRydWU7CiAgY29uc3QgZGlzYWJsZUF1dG9GZXRjaCA9IHNyYy5kaXNhYmxlQXV0b0ZldGNoID09PSB0cnVlOwogIGNvbnN0IHBkZkJ1ZyA9IHNyYy5wZGZCdWcgPT09IHRydWU7CiAgY29uc3QgQ2FudmFzRmFjdG9yeSA9IHNyYy5DYW52YXNGYWN0b3J5IHx8IChpc05vZGVKUyA/IE5vZGVDYW52YXNGYWN0b3J5IDogRE9NQ2FudmFzRmFjdG9yeSk7CiAgY29uc3QgRmlsdGVyRmFjdG9yeSA9IHNyYy5GaWx0ZXJGYWN0b3J5IHx8IChpc05vZGVKUyA/IE5vZGVGaWx0ZXJGYWN0b3J5IDogRE9NRmlsdGVyRmFjdG9yeSk7CiAgY29uc3QgZW5hYmxlSFdBID0gc3JjLmVuYWJsZUhXQSA9PT0gdHJ1ZTsKICBjb25zdCB1c2VXYXNtID0gc3JjLnVzZVdhc20gIT09IGZhbHNlOwogIGNvbnN0IGxlbmd0aCA9IHJhbmdlVHJhbnNwb3J0ID8gcmFuZ2VUcmFuc3BvcnQubGVuZ3RoIDogc3JjLmxlbmd0aCA/PyBOYU47CiAgY29uc3QgdXNlU3lzdGVtRm9udHMgPSB0eXBlb2Ygc3JjLnVzZVN5c3RlbUZvbnRzID09PSAiYm9vbGVhbiIgPyBzcmMudXNlU3lzdGVtRm9udHMgOiAhaXNOb2RlSlMgJiYgIWRpc2FibGVGb250RmFjZTsKICBjb25zdCB1c2VXb3JrZXJGZXRjaCA9IHR5cGVvZiBzcmMudXNlV29ya2VyRmV0Y2ggPT09ICJib29sZWFuIiA/IHNyYy51c2VXb3JrZXJGZXRjaCA6ICEhKENNYXBSZWFkZXJGYWN0b3J5ID09PSBET01DTWFwUmVhZGVyRmFjdG9yeSAmJiBTdGFuZGFyZEZvbnREYXRhRmFjdG9yeSA9PT0gRE9NU3RhbmRhcmRGb250RGF0YUZhY3RvcnkgJiYgV2FzbUZhY3RvcnkgPT09IERPTVdhc21GYWN0b3J5ICYmIGNNYXBVcmwgJiYgc3RhbmRhcmRGb250RGF0YVVybCAmJiB3YXNtVXJsICYmIGlzVmFsaWRGZXRjaFVybChjTWFwVXJsLCBkb2N1bWVudC5iYXNlVVJJKSAmJiBpc1ZhbGlkRmV0Y2hVcmwoc3RhbmRhcmRGb250RGF0YVVybCwgZG9jdW1lbnQuYmFzZVVSSSkgJiYgaXNWYWxpZEZldGNoVXJsKHdhc21VcmwsIGRvY3VtZW50LmJhc2VVUkkpKTsKICBjb25zdCBzdHlsZUVsZW1lbnQgPSBudWxsOwogIHNldFZlcmJvc2l0eUxldmVsKHZlcmJvc2l0eSk7CiAgY29uc3QgdHJhbnNwb3J0RmFjdG9yeSA9IHsKICAgIGNhbnZhc0ZhY3Rvcnk6IG5ldyBDYW52YXNGYWN0b3J5KHsKICAgICAgb3duZXJEb2N1bWVudCwKICAgICAgZW5hYmxlSFdBCiAgICB9KSwKICAgIGZpbHRlckZhY3Rvcnk6IG5ldyBGaWx0ZXJGYWN0b3J5KHsKICAgICAgZG9jSWQsCiAgICAgIG93bmVyRG9jdW1lbnQKICAgIH0pLAogICAgY01hcFJlYWRlckZhY3Rvcnk6IHVzZVdvcmtlckZldGNoID8gbnVsbCA6IG5ldyBDTWFwUmVhZGVyRmFjdG9yeSh7CiAgICAgIGJhc2VVcmw6IGNNYXBVcmwsCiAgICAgIGlzQ29tcHJlc3NlZDogY01hcFBhY2tlZAogICAgfSksCiAgICBzdGFuZGFyZEZvbnREYXRhRmFjdG9yeTogdXNlV29ya2VyRmV0Y2ggPyBudWxsIDogbmV3IFN0YW5kYXJkRm9udERhdGFGYWN0b3J5KHsKICAgICAgYmFzZVVybDogc3RhbmRhcmRGb250RGF0YVVybAogICAgfSksCiAgICB3YXNtRmFjdG9yeTogdXNlV29ya2VyRmV0Y2ggPyBudWxsIDogbmV3IFdhc21GYWN0b3J5KHsKICAgICAgYmFzZVVybDogd2FzbVVybAogICAgfSkKICB9OwogIGlmICghd29ya2VyKSB7CiAgICB3b3JrZXIgPSBQREZXb3JrZXIuY3JlYXRlKHsKICAgICAgdmVyYm9zaXR5LAogICAgICBwb3J0OiBHbG9iYWxXb3JrZXJPcHRpb25zLndvcmtlclBvcnQKICAgIH0pOwogICAgdGFzay5fd29ya2VyID0gd29ya2VyOwogIH0KICBjb25zdCBkb2NQYXJhbXMgPSB7CiAgICBkb2NJZCwKICAgIGFwaVZlcnNpb246ICI1LjMuMzEiLAogICAgZGF0YSwKICAgIHBhc3N3b3JkLAogICAgZGlzYWJsZUF1dG9GZXRjaCwKICAgIHJhbmdlQ2h1bmtTaXplLAogICAgbGVuZ3RoLAogICAgZG9jQmFzZVVybCwKICAgIGVuYWJsZVhmYSwKICAgIGV2YWx1YXRvck9wdGlvbnM6IHsKICAgICAgbWF4SW1hZ2VTaXplLAogICAgICBkaXNhYmxlRm9udEZhY2UsCiAgICAgIGlnbm9yZUVycm9ycywKICAgICAgaXNFdmFsU3VwcG9ydGVkLAogICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCwKICAgICAgaXNJbWFnZURlY29kZXJTdXBwb3J0ZWQsCiAgICAgIGNhbnZhc01heEFyZWFJbkJ5dGVzLAogICAgICBmb250RXh0cmFQcm9wZXJ0aWVzLAogICAgICB1c2VTeXN0ZW1Gb250cywKICAgICAgdXNlV2FzbSwKICAgICAgdXNlV29ya2VyRmV0Y2gsCiAgICAgIGNNYXBVcmwsCiAgICAgIGljY1VybCwKICAgICAgc3RhbmRhcmRGb250RGF0YVVybCwKICAgICAgd2FzbVVybAogICAgfQogIH07CiAgY29uc3QgdHJhbnNwb3J0UGFyYW1zID0gewogICAgb3duZXJEb2N1bWVudCwKICAgIHBkZkJ1ZywKICAgIHN0eWxlRWxlbWVudCwKICAgIGxvYWRpbmdQYXJhbXM6IHsKICAgICAgZGlzYWJsZUF1dG9GZXRjaCwKICAgICAgZW5hYmxlWGZhCiAgICB9CiAgfTsKICB3b3JrZXIucHJvbWlzZS50aGVuKGZ1bmN0aW9uICgpIHsKICAgIGlmICh0YXNrLmRlc3Ryb3llZCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkxvYWRpbmcgYWJvcnRlZCIpOwogICAgfQogICAgaWYgKHdvcmtlci5kZXN0cm95ZWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJXb3JrZXIgd2FzIGRlc3Ryb3llZCIpOwogICAgfQogICAgY29uc3Qgd29ya2VySWRQcm9taXNlID0gd29ya2VyLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiR2V0RG9jUmVxdWVzdCIsIGRvY1BhcmFtcywgZGF0YSA/IFtkYXRhLmJ1ZmZlcl0gOiBudWxsKTsKICAgIGxldCBuZXR3b3JrU3RyZWFtOwogICAgaWYgKHJhbmdlVHJhbnNwb3J0KSB7CiAgICAgIG5ldHdvcmtTdHJlYW0gPSBuZXcgUERGRGF0YVRyYW5zcG9ydFN0cmVhbShyYW5nZVRyYW5zcG9ydCwgewogICAgICAgIGRpc2FibGVSYW5nZSwKICAgICAgICBkaXNhYmxlU3RyZWFtCiAgICAgIH0pOwogICAgfSBlbHNlIGlmICghZGF0YSkgewogICAgICBpZiAoIXVybCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiZ2V0RG9jdW1lbnQgLSBubyBgdXJsYCBwYXJhbWV0ZXIgcHJvdmlkZWQuIik7CiAgICAgIH0KICAgICAgY29uc3QgTmV0d29ya1N0cmVhbSA9IGlzVmFsaWRGZXRjaFVybCh1cmwpID8gUERGRmV0Y2hTdHJlYW0gOiBpc05vZGVKUyA/IFBERk5vZGVTdHJlYW0gOiBQREZOZXR3b3JrU3RyZWFtOwogICAgICBuZXR3b3JrU3RyZWFtID0gbmV3IE5ldHdvcmtTdHJlYW0oewogICAgICAgIHVybCwKICAgICAgICBsZW5ndGgsCiAgICAgICAgaHR0cEhlYWRlcnMsCiAgICAgICAgd2l0aENyZWRlbnRpYWxzLAogICAgICAgIHJhbmdlQ2h1bmtTaXplLAogICAgICAgIGRpc2FibGVSYW5nZSwKICAgICAgICBkaXNhYmxlU3RyZWFtCiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIHdvcmtlcklkUHJvbWlzZS50aGVuKHdvcmtlcklkID0+IHsKICAgICAgaWYgKHRhc2suZGVzdHJveWVkKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJMb2FkaW5nIGFib3J0ZWQiKTsKICAgICAgfQogICAgICBpZiAod29ya2VyLmRlc3Ryb3llZCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiV29ya2VyIHdhcyBkZXN0cm95ZWQiKTsKICAgICAgfQogICAgICBjb25zdCBtZXNzYWdlSGFuZGxlciA9IG5ldyBNZXNzYWdlSGFuZGxlcihkb2NJZCwgd29ya2VySWQsIHdvcmtlci5wb3J0KTsKICAgICAgY29uc3QgdHJhbnNwb3J0ID0gbmV3IFdvcmtlclRyYW5zcG9ydChtZXNzYWdlSGFuZGxlciwgdGFzaywgbmV0d29ya1N0cmVhbSwgdHJhbnNwb3J0UGFyYW1zLCB0cmFuc3BvcnRGYWN0b3J5KTsKICAgICAgdGFzay5fdHJhbnNwb3J0ID0gdHJhbnNwb3J0OwogICAgICBtZXNzYWdlSGFuZGxlci5zZW5kKCJSZWFkeSIsIG51bGwpOwogICAgfSk7CiAgfSkuY2F0Y2godGFzay5fY2FwYWJpbGl0eS5yZWplY3QpOwogIHJldHVybiB0YXNrOwp9CmNsYXNzIFBERkRvY3VtZW50TG9hZGluZ1Rhc2sgewogIHN0YXRpYyAjZG9jSWQgPSAwOwogIF9jYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgX3RyYW5zcG9ydCA9IG51bGw7CiAgX3dvcmtlciA9IG51bGw7CiAgZG9jSWQgPSBgZCR7UERGRG9jdW1lbnRMb2FkaW5nVGFzay4jZG9jSWQrK31gOwogIGRlc3Ryb3llZCA9IGZhbHNlOwogIG9uUGFzc3dvcmQgPSBudWxsOwogIG9uUHJvZ3Jlc3MgPSBudWxsOwogIGdldCBwcm9taXNlKCkgewogICAgcmV0dXJuIHRoaXMuX2NhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgYXN5bmMgZGVzdHJveSgpIHsKICAgIHRoaXMuZGVzdHJveWVkID0gdHJ1ZTsKICAgIHRyeSB7CiAgICAgIGlmICh0aGlzLl93b3JrZXI/LnBvcnQpIHsKICAgICAgICB0aGlzLl93b3JrZXIuX3BlbmRpbmdEZXN0cm95ID0gdHJ1ZTsKICAgICAgfQogICAgICBhd2FpdCB0aGlzLl90cmFuc3BvcnQ/LmRlc3Ryb3koKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmICh0aGlzLl93b3JrZXI/LnBvcnQpIHsKICAgICAgICBkZWxldGUgdGhpcy5fd29ya2VyLl9wZW5kaW5nRGVzdHJveTsKICAgICAgfQogICAgICB0aHJvdyBleDsKICAgIH0KICAgIHRoaXMuX3RyYW5zcG9ydCA9IG51bGw7CiAgICB0aGlzLl93b3JrZXI/LmRlc3Ryb3koKTsKICAgIHRoaXMuX3dvcmtlciA9IG51bGw7CiAgfQogIGFzeW5jIGdldERhdGEoKSB7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldERhdGEoKTsKICB9Cn0KY2xhc3MgUERGRGF0YVJhbmdlVHJhbnNwb3J0IHsKICAjY2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICNwcm9ncmVzc2l2ZURvbmVMaXN0ZW5lcnMgPSBbXTsKICAjcHJvZ3Jlc3NpdmVSZWFkTGlzdGVuZXJzID0gW107CiAgI3Byb2dyZXNzTGlzdGVuZXJzID0gW107CiAgI3JhbmdlTGlzdGVuZXJzID0gW107CiAgY29uc3RydWN0b3IobGVuZ3RoLCBpbml0aWFsRGF0YSwgcHJvZ3Jlc3NpdmVEb25lID0gZmFsc2UsIGNvbnRlbnREaXNwb3NpdGlvbkZpbGVuYW1lID0gbnVsbCkgewogICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7CiAgICB0aGlzLmluaXRpYWxEYXRhID0gaW5pdGlhbERhdGE7CiAgICB0aGlzLnByb2dyZXNzaXZlRG9uZSA9IHByb2dyZXNzaXZlRG9uZTsKICAgIHRoaXMuY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWUgPSBjb250ZW50RGlzcG9zaXRpb25GaWxlbmFtZTsKICB9CiAgYWRkUmFuZ2VMaXN0ZW5lcihsaXN0ZW5lcikgewogICAgdGhpcy4jcmFuZ2VMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7CiAgfQogIGFkZFByb2dyZXNzTGlzdGVuZXIobGlzdGVuZXIpIHsKICAgIHRoaXMuI3Byb2dyZXNzTGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOwogIH0KICBhZGRQcm9ncmVzc2l2ZVJlYWRMaXN0ZW5lcihsaXN0ZW5lcikgewogICAgdGhpcy4jcHJvZ3Jlc3NpdmVSZWFkTGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOwogIH0KICBhZGRQcm9ncmVzc2l2ZURvbmVMaXN0ZW5lcihsaXN0ZW5lcikgewogICAgdGhpcy4jcHJvZ3Jlc3NpdmVEb25lTGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOwogIH0KICBvbkRhdGFSYW5nZShiZWdpbiwgY2h1bmspIHsKICAgIGZvciAoY29uc3QgbGlzdGVuZXIgb2YgdGhpcy4jcmFuZ2VMaXN0ZW5lcnMpIHsKICAgICAgbGlzdGVuZXIoYmVnaW4sIGNodW5rKTsKICAgIH0KICB9CiAgb25EYXRhUHJvZ3Jlc3MobG9hZGVkLCB0b3RhbCkgewogICAgdGhpcy4jY2FwYWJpbGl0eS5wcm9taXNlLnRoZW4oKCkgPT4gewogICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIHRoaXMuI3Byb2dyZXNzTGlzdGVuZXJzKSB7CiAgICAgICAgbGlzdGVuZXIobG9hZGVkLCB0b3RhbCk7CiAgICAgIH0KICAgIH0pOwogIH0KICBvbkRhdGFQcm9ncmVzc2l2ZVJlYWQoY2h1bmspIHsKICAgIHRoaXMuI2NhcGFiaWxpdHkucHJvbWlzZS50aGVuKCgpID0+IHsKICAgICAgZm9yIChjb25zdCBsaXN0ZW5lciBvZiB0aGlzLiNwcm9ncmVzc2l2ZVJlYWRMaXN0ZW5lcnMpIHsKICAgICAgICBsaXN0ZW5lcihjaHVuayk7CiAgICAgIH0KICAgIH0pOwogIH0KICBvbkRhdGFQcm9ncmVzc2l2ZURvbmUoKSB7CiAgICB0aGlzLiNjYXBhYmlsaXR5LnByb21pc2UudGhlbigoKSA9PiB7CiAgICAgIGZvciAoY29uc3QgbGlzdGVuZXIgb2YgdGhpcy4jcHJvZ3Jlc3NpdmVEb25lTGlzdGVuZXJzKSB7CiAgICAgICAgbGlzdGVuZXIoKTsKICAgICAgfQogICAgfSk7CiAgfQogIHRyYW5zcG9ydFJlYWR5KCkgewogICAgdGhpcy4jY2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgfQogIHJlcXVlc3REYXRhUmFuZ2UoYmVnaW4sIGVuZCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBQREZEYXRhUmFuZ2VUcmFuc3BvcnQucmVxdWVzdERhdGFSYW5nZSIpOwogIH0KICBhYm9ydCgpIHt9Cn0KY2xhc3MgUERGRG9jdW1lbnRQcm94eSB7CiAgY29uc3RydWN0b3IocGRmSW5mbywgdHJhbnNwb3J0KSB7CiAgICB0aGlzLl9wZGZJbmZvID0gcGRmSW5mbzsKICAgIHRoaXMuX3RyYW5zcG9ydCA9IHRyYW5zcG9ydDsKICB9CiAgZ2V0IGFubm90YXRpb25TdG9yYWdlKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5hbm5vdGF0aW9uU3RvcmFnZTsKICB9CiAgZ2V0IGNhbnZhc0ZhY3RvcnkoKSB7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmNhbnZhc0ZhY3Rvcnk7CiAgfQogIGdldCBmaWx0ZXJGYWN0b3J5KCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5maWx0ZXJGYWN0b3J5OwogIH0KICBnZXQgbnVtUGFnZXMoKSB7CiAgICByZXR1cm4gdGhpcy5fcGRmSW5mby5udW1QYWdlczsKICB9CiAgZ2V0IGZpbmdlcnByaW50cygpIHsKICAgIHJldHVybiB0aGlzLl9wZGZJbmZvLmZpbmdlcnByaW50czsKICB9CiAgZ2V0IGlzUHVyZVhmYSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImlzUHVyZVhmYSIsICEhdGhpcy5fdHJhbnNwb3J0Ll9odG1sRm9yWGZhKTsKICB9CiAgZ2V0IGFsbFhmYUh0bWwoKSB7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0Ll9odG1sRm9yWGZhOwogIH0KICBnZXRQYWdlKHBhZ2VOdW1iZXIpIHsKICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0UGFnZShwYWdlTnVtYmVyKTsKICB9CiAgZ2V0UGFnZUluZGV4KHJlZikgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXRQYWdlSW5kZXgocmVmKTsKICB9CiAgZ2V0RGVzdGluYXRpb25zKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXREZXN0aW5hdGlvbnMoKTsKICB9CiAgZ2V0RGVzdGluYXRpb24oaWQpIHsKICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0RGVzdGluYXRpb24oaWQpOwogIH0KICBnZXRQYWdlTGFiZWxzKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXRQYWdlTGFiZWxzKCk7CiAgfQogIGdldFBhZ2VMYXlvdXQoKSB7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldFBhZ2VMYXlvdXQoKTsKICB9CiAgZ2V0UGFnZU1vZGUoKSB7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldFBhZ2VNb2RlKCk7CiAgfQogIGdldFZpZXdlclByZWZlcmVuY2VzKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXRWaWV3ZXJQcmVmZXJlbmNlcygpOwogIH0KICBnZXRPcGVuQWN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXRPcGVuQWN0aW9uKCk7CiAgfQogIGdldEF0dGFjaG1lbnRzKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXRBdHRhY2htZW50cygpOwogIH0KICBnZXRKU0FjdGlvbnMoKSB7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldERvY0pTQWN0aW9ucygpOwogIH0KICBnZXRPdXRsaW5lKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXRPdXRsaW5lKCk7CiAgfQogIGdldE9wdGlvbmFsQ29udGVudENvbmZpZyh7CiAgICBpbnRlbnQgPSAiZGlzcGxheSIKICB9ID0ge30pIHsKICAgIGNvbnN0IHsKICAgICAgcmVuZGVyaW5nSW50ZW50CiAgICB9ID0gdGhpcy5fdHJhbnNwb3J0LmdldFJlbmRlcmluZ0ludGVudChpbnRlbnQpOwogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXRPcHRpb25hbENvbnRlbnRDb25maWcocmVuZGVyaW5nSW50ZW50KTsKICB9CiAgZ2V0UGVybWlzc2lvbnMoKSB7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldFBlcm1pc3Npb25zKCk7CiAgfQogIGdldE1ldGFkYXRhKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXRNZXRhZGF0YSgpOwogIH0KICBnZXRNYXJrSW5mbygpIHsKICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0TWFya0luZm8oKTsKICB9CiAgZ2V0RGF0YSgpIHsKICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0RGF0YSgpOwogIH0KICBzYXZlRG9jdW1lbnQoKSB7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LnNhdmVEb2N1bWVudCgpOwogIH0KICBnZXREb3dubG9hZEluZm8oKSB7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmRvd25sb2FkSW5mb0NhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgY2xlYW51cChrZWVwTG9hZGVkRm9udHMgPSBmYWxzZSkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5zdGFydENsZWFudXAoa2VlcExvYWRlZEZvbnRzIHx8IHRoaXMuaXNQdXJlWGZhKTsKICB9CiAgZGVzdHJveSgpIHsKICAgIHJldHVybiB0aGlzLmxvYWRpbmdUYXNrLmRlc3Ryb3koKTsKICB9CiAgY2FjaGVkUGFnZU51bWJlcihyZWYpIHsKICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuY2FjaGVkUGFnZU51bWJlcihyZWYpOwogIH0KICBnZXQgbG9hZGluZ1BhcmFtcygpIHsKICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQubG9hZGluZ1BhcmFtczsKICB9CiAgZ2V0IGxvYWRpbmdUYXNrKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5sb2FkaW5nVGFzazsKICB9CiAgZ2V0RmllbGRPYmplY3RzKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXRGaWVsZE9iamVjdHMoKTsKICB9CiAgaGFzSlNBY3Rpb25zKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5oYXNKU0FjdGlvbnMoKTsKICB9CiAgZ2V0Q2FsY3VsYXRpb25PcmRlcklkcygpIHsKICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0Q2FsY3VsYXRpb25PcmRlcklkcygpOwogIH0KfQpjbGFzcyBQREZQYWdlUHJveHkgewogICNwZW5kaW5nQ2xlYW51cCA9IGZhbHNlOwogIGNvbnN0cnVjdG9yKHBhZ2VJbmRleCwgcGFnZUluZm8sIHRyYW5zcG9ydCwgcGRmQnVnID0gZmFsc2UpIHsKICAgIHRoaXMuX3BhZ2VJbmRleCA9IHBhZ2VJbmRleDsKICAgIHRoaXMuX3BhZ2VJbmZvID0gcGFnZUluZm87CiAgICB0aGlzLl90cmFuc3BvcnQgPSB0cmFuc3BvcnQ7CiAgICB0aGlzLl9zdGF0cyA9IHBkZkJ1ZyA/IG5ldyBTdGF0VGltZXIoKSA6IG51bGw7CiAgICB0aGlzLl9wZGZCdWcgPSBwZGZCdWc7CiAgICB0aGlzLmNvbW1vbk9ianMgPSB0cmFuc3BvcnQuY29tbW9uT2JqczsKICAgIHRoaXMub2JqcyA9IG5ldyBQREZPYmplY3RzKCk7CiAgICB0aGlzLl9pbnRlbnRTdGF0ZXMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLmRlc3Ryb3llZCA9IGZhbHNlOwogIH0KICBnZXQgcGFnZU51bWJlcigpIHsKICAgIHJldHVybiB0aGlzLl9wYWdlSW5kZXggKyAxOwogIH0KICBnZXQgcm90YXRlKCkgewogICAgcmV0dXJuIHRoaXMuX3BhZ2VJbmZvLnJvdGF0ZTsKICB9CiAgZ2V0IHJlZigpIHsKICAgIHJldHVybiB0aGlzLl9wYWdlSW5mby5yZWY7CiAgfQogIGdldCB1c2VyVW5pdCgpIHsKICAgIHJldHVybiB0aGlzLl9wYWdlSW5mby51c2VyVW5pdDsKICB9CiAgZ2V0IHZpZXcoKSB7CiAgICByZXR1cm4gdGhpcy5fcGFnZUluZm8udmlldzsKICB9CiAgZ2V0Vmlld3BvcnQoewogICAgc2NhbGUsCiAgICByb3RhdGlvbiA9IHRoaXMucm90YXRlLAogICAgb2Zmc2V0WCA9IDAsCiAgICBvZmZzZXRZID0gMCwKICAgIGRvbnRGbGlwID0gZmFsc2UKICB9ID0ge30pIHsKICAgIHJldHVybiBuZXcgUGFnZVZpZXdwb3J0KHsKICAgICAgdmlld0JveDogdGhpcy52aWV3LAogICAgICB1c2VyVW5pdDogdGhpcy51c2VyVW5pdCwKICAgICAgc2NhbGUsCiAgICAgIHJvdGF0aW9uLAogICAgICBvZmZzZXRYLAogICAgICBvZmZzZXRZLAogICAgICBkb250RmxpcAogICAgfSk7CiAgfQogIGdldEFubm90YXRpb25zKHsKICAgIGludGVudCA9ICJkaXNwbGF5IgogIH0gPSB7fSkgewogICAgY29uc3QgewogICAgICByZW5kZXJpbmdJbnRlbnQKICAgIH0gPSB0aGlzLl90cmFuc3BvcnQuZ2V0UmVuZGVyaW5nSW50ZW50KGludGVudCk7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0LmdldEFubm90YXRpb25zKHRoaXMuX3BhZ2VJbmRleCwgcmVuZGVyaW5nSW50ZW50KTsKICB9CiAgZ2V0SlNBY3Rpb25zKCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5nZXRQYWdlSlNBY3Rpb25zKHRoaXMuX3BhZ2VJbmRleCk7CiAgfQogIGdldCBmaWx0ZXJGYWN0b3J5KCkgewogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5maWx0ZXJGYWN0b3J5OwogIH0KICBnZXQgaXNQdXJlWGZhKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNQdXJlWGZhIiwgISF0aGlzLl90cmFuc3BvcnQuX2h0bWxGb3JYZmEpOwogIH0KICBhc3luYyBnZXRYZmEoKSB7CiAgICByZXR1cm4gdGhpcy5fdHJhbnNwb3J0Ll9odG1sRm9yWGZhPy5jaGlsZHJlblt0aGlzLl9wYWdlSW5kZXhdIHx8IG51bGw7CiAgfQogIHJlbmRlcih7CiAgICBjYW52YXNDb250ZXh0LAogICAgdmlld3BvcnQsCiAgICBpbnRlbnQgPSAiZGlzcGxheSIsCiAgICBhbm5vdGF0aW9uTW9kZSA9IEFubm90YXRpb25Nb2RlLkVOQUJMRSwKICAgIHRyYW5zZm9ybSA9IG51bGwsCiAgICBiYWNrZ3JvdW5kID0gbnVsbCwKICAgIG9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UgPSBudWxsLAogICAgYW5ub3RhdGlvbkNhbnZhc01hcCA9IG51bGwsCiAgICBwYWdlQ29sb3JzID0gbnVsbCwKICAgIHByaW50QW5ub3RhdGlvblN0b3JhZ2UgPSBudWxsLAogICAgaXNFZGl0aW5nID0gZmFsc2UKICB9KSB7CiAgICB0aGlzLl9zdGF0cz8udGltZSgiT3ZlcmFsbCIpOwogICAgY29uc3QgaW50ZW50QXJncyA9IHRoaXMuX3RyYW5zcG9ydC5nZXRSZW5kZXJpbmdJbnRlbnQoaW50ZW50LCBhbm5vdGF0aW9uTW9kZSwgcHJpbnRBbm5vdGF0aW9uU3RvcmFnZSwgaXNFZGl0aW5nKTsKICAgIGNvbnN0IHsKICAgICAgcmVuZGVyaW5nSW50ZW50LAogICAgICBjYWNoZUtleQogICAgfSA9IGludGVudEFyZ3M7CiAgICB0aGlzLiNwZW5kaW5nQ2xlYW51cCA9IGZhbHNlOwogICAgb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZSB8fD0gdGhpcy5fdHJhbnNwb3J0LmdldE9wdGlvbmFsQ29udGVudENvbmZpZyhyZW5kZXJpbmdJbnRlbnQpOwogICAgbGV0IGludGVudFN0YXRlID0gdGhpcy5faW50ZW50U3RhdGVzLmdldChjYWNoZUtleSk7CiAgICBpZiAoIWludGVudFN0YXRlKSB7CiAgICAgIGludGVudFN0YXRlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgdGhpcy5faW50ZW50U3RhdGVzLnNldChjYWNoZUtleSwgaW50ZW50U3RhdGUpOwogICAgfQogICAgaWYgKGludGVudFN0YXRlLnN0cmVhbVJlYWRlckNhbmNlbFRpbWVvdXQpIHsKICAgICAgY2xlYXJUaW1lb3V0KGludGVudFN0YXRlLnN0cmVhbVJlYWRlckNhbmNlbFRpbWVvdXQpOwogICAgICBpbnRlbnRTdGF0ZS5zdHJlYW1SZWFkZXJDYW5jZWxUaW1lb3V0ID0gbnVsbDsKICAgIH0KICAgIGNvbnN0IGludGVudFByaW50ID0gISEocmVuZGVyaW5nSW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5QUklOVCk7CiAgICBpZiAoIWludGVudFN0YXRlLmRpc3BsYXlSZWFkeUNhcGFiaWxpdHkpIHsKICAgICAgaW50ZW50U3RhdGUuZGlzcGxheVJlYWR5Q2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgICBpbnRlbnRTdGF0ZS5vcGVyYXRvckxpc3QgPSB7CiAgICAgICAgZm5BcnJheTogW10sCiAgICAgICAgYXJnc0FycmF5OiBbXSwKICAgICAgICBsYXN0Q2h1bms6IGZhbHNlLAogICAgICAgIHNlcGFyYXRlQW5ub3RzOiBudWxsCiAgICAgIH07CiAgICAgIHRoaXMuX3N0YXRzPy50aW1lKCJQYWdlIFJlcXVlc3QiKTsKICAgICAgdGhpcy5fcHVtcE9wZXJhdG9yTGlzdChpbnRlbnRBcmdzKTsKICAgIH0KICAgIGNvbnN0IGNvbXBsZXRlID0gZXJyb3IgPT4gewogICAgICBpbnRlbnRTdGF0ZS5yZW5kZXJUYXNrcy5kZWxldGUoaW50ZXJuYWxSZW5kZXJUYXNrKTsKICAgICAgaWYgKGludGVudFByaW50KSB7CiAgICAgICAgdGhpcy4jcGVuZGluZ0NsZWFudXAgPSB0cnVlOwogICAgICB9CiAgICAgIHRoaXMuI3RyeUNsZWFudXAoKTsKICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgaW50ZXJuYWxSZW5kZXJUYXNrLmNhcGFiaWxpdHkucmVqZWN0KGVycm9yKTsKICAgICAgICB0aGlzLl9hYm9ydE9wZXJhdG9yTGlzdCh7CiAgICAgICAgICBpbnRlbnRTdGF0ZSwKICAgICAgICAgIHJlYXNvbjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKGVycm9yKQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGludGVybmFsUmVuZGVyVGFzay5jYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgfQogICAgICBpZiAodGhpcy5fc3RhdHMpIHsKICAgICAgICB0aGlzLl9zdGF0cy50aW1lRW5kKCJSZW5kZXJpbmciKTsKICAgICAgICB0aGlzLl9zdGF0cy50aW1lRW5kKCJPdmVyYWxsIik7CiAgICAgICAgaWYgKGdsb2JhbFRoaXMuU3RhdHM/LmVuYWJsZWQpIHsKICAgICAgICAgIGdsb2JhbFRoaXMuU3RhdHMuYWRkKHRoaXMucGFnZU51bWJlciwgdGhpcy5fc3RhdHMpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIGNvbnN0IGludGVybmFsUmVuZGVyVGFzayA9IG5ldyBJbnRlcm5hbFJlbmRlclRhc2soewogICAgICBjYWxsYmFjazogY29tcGxldGUsCiAgICAgIHBhcmFtczogewogICAgICAgIGNhbnZhc0NvbnRleHQsCiAgICAgICAgdmlld3BvcnQsCiAgICAgICAgdHJhbnNmb3JtLAogICAgICAgIGJhY2tncm91bmQKICAgICAgfSwKICAgICAgb2JqczogdGhpcy5vYmpzLAogICAgICBjb21tb25PYmpzOiB0aGlzLmNvbW1vbk9ianMsCiAgICAgIGFubm90YXRpb25DYW52YXNNYXAsCiAgICAgIG9wZXJhdG9yTGlzdDogaW50ZW50U3RhdGUub3BlcmF0b3JMaXN0LAogICAgICBwYWdlSW5kZXg6IHRoaXMuX3BhZ2VJbmRleCwKICAgICAgY2FudmFzRmFjdG9yeTogdGhpcy5fdHJhbnNwb3J0LmNhbnZhc0ZhY3RvcnksCiAgICAgIGZpbHRlckZhY3Rvcnk6IHRoaXMuX3RyYW5zcG9ydC5maWx0ZXJGYWN0b3J5LAogICAgICB1c2VSZXF1ZXN0QW5pbWF0aW9uRnJhbWU6ICFpbnRlbnRQcmludCwKICAgICAgcGRmQnVnOiB0aGlzLl9wZGZCdWcsCiAgICAgIHBhZ2VDb2xvcnMKICAgIH0pOwogICAgKGludGVudFN0YXRlLnJlbmRlclRhc2tzIHx8PSBuZXcgU2V0KCkpLmFkZChpbnRlcm5hbFJlbmRlclRhc2spOwogICAgY29uc3QgcmVuZGVyVGFzayA9IGludGVybmFsUmVuZGVyVGFzay50YXNrOwogICAgUHJvbWlzZS5hbGwoW2ludGVudFN0YXRlLmRpc3BsYXlSZWFkeUNhcGFiaWxpdHkucHJvbWlzZSwgb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZV0pLnRoZW4oKFt0cmFuc3BhcmVuY3ksIG9wdGlvbmFsQ29udGVudENvbmZpZ10pID0+IHsKICAgICAgaWYgKHRoaXMuZGVzdHJveWVkKSB7CiAgICAgICAgY29tcGxldGUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5fc3RhdHM/LnRpbWUoIlJlbmRlcmluZyIpOwogICAgICBpZiAoIShvcHRpb25hbENvbnRlbnRDb25maWcucmVuZGVyaW5nSW50ZW50ICYgcmVuZGVyaW5nSW50ZW50KSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiTXVzdCB1c2UgdGhlIHNhbWUgYGludGVudGAtYXJndW1lbnQgd2hlbiBjYWxsaW5nIHRoZSBgUERGUGFnZVByb3h5LnJlbmRlcmAgIiArICJhbmQgYFBERkRvY3VtZW50UHJveHkuZ2V0T3B0aW9uYWxDb250ZW50Q29uZmlnYCBtZXRob2RzLiIpOwogICAgICB9CiAgICAgIGludGVybmFsUmVuZGVyVGFzay5pbml0aWFsaXplR3JhcGhpY3MoewogICAgICAgIHRyYW5zcGFyZW5jeSwKICAgICAgICBvcHRpb25hbENvbnRlbnRDb25maWcKICAgICAgfSk7CiAgICAgIGludGVybmFsUmVuZGVyVGFzay5vcGVyYXRvckxpc3RDaGFuZ2VkKCk7CiAgICB9KS5jYXRjaChjb21wbGV0ZSk7CiAgICByZXR1cm4gcmVuZGVyVGFzazsKICB9CiAgZ2V0T3BlcmF0b3JMaXN0KHsKICAgIGludGVudCA9ICJkaXNwbGF5IiwKICAgIGFubm90YXRpb25Nb2RlID0gQW5ub3RhdGlvbk1vZGUuRU5BQkxFLAogICAgcHJpbnRBbm5vdGF0aW9uU3RvcmFnZSA9IG51bGwsCiAgICBpc0VkaXRpbmcgPSBmYWxzZQogIH0gPSB7fSkgewogICAgZnVuY3Rpb24gb3BlcmF0b3JMaXN0Q2hhbmdlZCgpIHsKICAgICAgaWYgKGludGVudFN0YXRlLm9wZXJhdG9yTGlzdC5sYXN0Q2h1bmspIHsKICAgICAgICBpbnRlbnRTdGF0ZS5vcExpc3RSZWFkQ2FwYWJpbGl0eS5yZXNvbHZlKGludGVudFN0YXRlLm9wZXJhdG9yTGlzdCk7CiAgICAgICAgaW50ZW50U3RhdGUucmVuZGVyVGFza3MuZGVsZXRlKG9wTGlzdFRhc2spOwogICAgICB9CiAgICB9CiAgICBjb25zdCBpbnRlbnRBcmdzID0gdGhpcy5fdHJhbnNwb3J0LmdldFJlbmRlcmluZ0ludGVudChpbnRlbnQsIGFubm90YXRpb25Nb2RlLCBwcmludEFubm90YXRpb25TdG9yYWdlLCBpc0VkaXRpbmcsIHRydWUpOwogICAgbGV0IGludGVudFN0YXRlID0gdGhpcy5faW50ZW50U3RhdGVzLmdldChpbnRlbnRBcmdzLmNhY2hlS2V5KTsKICAgIGlmICghaW50ZW50U3RhdGUpIHsKICAgICAgaW50ZW50U3RhdGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB0aGlzLl9pbnRlbnRTdGF0ZXMuc2V0KGludGVudEFyZ3MuY2FjaGVLZXksIGludGVudFN0YXRlKTsKICAgIH0KICAgIGxldCBvcExpc3RUYXNrOwogICAgaWYgKCFpbnRlbnRTdGF0ZS5vcExpc3RSZWFkQ2FwYWJpbGl0eSkgewogICAgICBvcExpc3RUYXNrID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgb3BMaXN0VGFzay5vcGVyYXRvckxpc3RDaGFuZ2VkID0gb3BlcmF0b3JMaXN0Q2hhbmdlZDsKICAgICAgaW50ZW50U3RhdGUub3BMaXN0UmVhZENhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgICAgKGludGVudFN0YXRlLnJlbmRlclRhc2tzIHx8PSBuZXcgU2V0KCkpLmFkZChvcExpc3RUYXNrKTsKICAgICAgaW50ZW50U3RhdGUub3BlcmF0b3JMaXN0ID0gewogICAgICAgIGZuQXJyYXk6IFtdLAogICAgICAgIGFyZ3NBcnJheTogW10sCiAgICAgICAgbGFzdENodW5rOiBmYWxzZSwKICAgICAgICBzZXBhcmF0ZUFubm90czogbnVsbAogICAgICB9OwogICAgICB0aGlzLl9zdGF0cz8udGltZSgiUGFnZSBSZXF1ZXN0Iik7CiAgICAgIHRoaXMuX3B1bXBPcGVyYXRvckxpc3QoaW50ZW50QXJncyk7CiAgICB9CiAgICByZXR1cm4gaW50ZW50U3RhdGUub3BMaXN0UmVhZENhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgc3RyZWFtVGV4dENvbnRlbnQoewogICAgaW5jbHVkZU1hcmtlZENvbnRlbnQgPSBmYWxzZSwKICAgIGRpc2FibGVOb3JtYWxpemF0aW9uID0gZmFsc2UKICB9ID0ge30pIHsKICAgIGNvbnN0IFRFWFRfQ09OVEVOVF9DSFVOS19TSVpFID0gMTAwOwogICAgcmV0dXJuIHRoaXMuX3RyYW5zcG9ydC5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFN0cmVhbSgiR2V0VGV4dENvbnRlbnQiLCB7CiAgICAgIHBhZ2VJbmRleDogdGhpcy5fcGFnZUluZGV4LAogICAgICBpbmNsdWRlTWFya2VkQ29udGVudDogaW5jbHVkZU1hcmtlZENvbnRlbnQgPT09IHRydWUsCiAgICAgIGRpc2FibGVOb3JtYWxpemF0aW9uOiBkaXNhYmxlTm9ybWFsaXphdGlvbiA9PT0gdHJ1ZQogICAgfSwgewogICAgICBoaWdoV2F0ZXJNYXJrOiBURVhUX0NPTlRFTlRfQ0hVTktfU0laRSwKICAgICAgc2l6ZSh0ZXh0Q29udGVudCkgewogICAgICAgIHJldHVybiB0ZXh0Q29udGVudC5pdGVtcy5sZW5ndGg7CiAgICAgIH0KICAgIH0pOwogIH0KICBnZXRUZXh0Q29udGVudChwYXJhbXMgPSB7fSkgewogICAgaWYgKHRoaXMuX3RyYW5zcG9ydC5faHRtbEZvclhmYSkgewogICAgICByZXR1cm4gdGhpcy5nZXRYZmEoKS50aGVuKHhmYSA9PiBYZmFUZXh0LnRleHRDb250ZW50KHhmYSkpOwogICAgfQogICAgY29uc3QgcmVhZGFibGVTdHJlYW0gPSB0aGlzLnN0cmVhbVRleHRDb250ZW50KHBhcmFtcyk7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICBmdW5jdGlvbiBwdW1wKCkgewogICAgICAgIHJlYWRlci5yZWFkKCkudGhlbihmdW5jdGlvbiAoewogICAgICAgICAgdmFsdWUsCiAgICAgICAgICBkb25lCiAgICAgICAgfSkgewogICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgcmVzb2x2ZSh0ZXh0Q29udGVudCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHRleHRDb250ZW50LmxhbmcgPz89IHZhbHVlLmxhbmc7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHRleHRDb250ZW50LnN0eWxlcywgdmFsdWUuc3R5bGVzKTsKICAgICAgICAgIHRleHRDb250ZW50Lml0ZW1zLnB1c2goLi4udmFsdWUuaXRlbXMpOwogICAgICAgICAgcHVtcCgpOwogICAgICAgIH0sIHJlamVjdCk7CiAgICAgIH0KICAgICAgY29uc3QgcmVhZGVyID0gcmVhZGFibGVTdHJlYW0uZ2V0UmVhZGVyKCk7CiAgICAgIGNvbnN0IHRleHRDb250ZW50ID0gewogICAgICAgIGl0ZW1zOiBbXSwKICAgICAgICBzdHlsZXM6IE9iamVjdC5jcmVhdGUobnVsbCksCiAgICAgICAgbGFuZzogbnVsbAogICAgICB9OwogICAgICBwdW1wKCk7CiAgICB9KTsKICB9CiAgZ2V0U3RydWN0VHJlZSgpIHsKICAgIHJldHVybiB0aGlzLl90cmFuc3BvcnQuZ2V0U3RydWN0VHJlZSh0aGlzLl9wYWdlSW5kZXgpOwogIH0KICBfZGVzdHJveSgpIHsKICAgIHRoaXMuZGVzdHJveWVkID0gdHJ1ZTsKICAgIGNvbnN0IHdhaXRPbiA9IFtdOwogICAgZm9yIChjb25zdCBpbnRlbnRTdGF0ZSBvZiB0aGlzLl9pbnRlbnRTdGF0ZXMudmFsdWVzKCkpIHsKICAgICAgdGhpcy5fYWJvcnRPcGVyYXRvckxpc3QoewogICAgICAgIGludGVudFN0YXRlLAogICAgICAgIHJlYXNvbjogbmV3IEVycm9yKCJQYWdlIHdhcyBkZXN0cm95ZWQuIiksCiAgICAgICAgZm9yY2U6IHRydWUKICAgICAgfSk7CiAgICAgIGlmIChpbnRlbnRTdGF0ZS5vcExpc3RSZWFkQ2FwYWJpbGl0eSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAoY29uc3QgaW50ZXJuYWxSZW5kZXJUYXNrIG9mIGludGVudFN0YXRlLnJlbmRlclRhc2tzKSB7CiAgICAgICAgd2FpdE9uLnB1c2goaW50ZXJuYWxSZW5kZXJUYXNrLmNvbXBsZXRlZCk7CiAgICAgICAgaW50ZXJuYWxSZW5kZXJUYXNrLmNhbmNlbCgpOwogICAgICB9CiAgICB9CiAgICB0aGlzLm9ianMuY2xlYXIoKTsKICAgIHRoaXMuI3BlbmRpbmdDbGVhbnVwID0gZmFsc2U7CiAgICByZXR1cm4gUHJvbWlzZS5hbGwod2FpdE9uKTsKICB9CiAgY2xlYW51cChyZXNldFN0YXRzID0gZmFsc2UpIHsKICAgIHRoaXMuI3BlbmRpbmdDbGVhbnVwID0gdHJ1ZTsKICAgIGNvbnN0IHN1Y2Nlc3MgPSB0aGlzLiN0cnlDbGVhbnVwKCk7CiAgICBpZiAocmVzZXRTdGF0cyAmJiBzdWNjZXNzKSB7CiAgICAgIHRoaXMuX3N0YXRzICYmPSBuZXcgU3RhdFRpbWVyKCk7CiAgICB9CiAgICByZXR1cm4gc3VjY2VzczsKICB9CiAgI3RyeUNsZWFudXAoKSB7CiAgICBpZiAoIXRoaXMuI3BlbmRpbmdDbGVhbnVwIHx8IHRoaXMuZGVzdHJveWVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGZvciAoY29uc3QgewogICAgICByZW5kZXJUYXNrcywKICAgICAgb3BlcmF0b3JMaXN0CiAgICB9IG9mIHRoaXMuX2ludGVudFN0YXRlcy52YWx1ZXMoKSkgewogICAgICBpZiAocmVuZGVyVGFza3Muc2l6ZSA+IDAgfHwgIW9wZXJhdG9yTGlzdC5sYXN0Q2h1bmspIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuX2ludGVudFN0YXRlcy5jbGVhcigpOwogICAgdGhpcy5vYmpzLmNsZWFyKCk7CiAgICB0aGlzLiNwZW5kaW5nQ2xlYW51cCA9IGZhbHNlOwogICAgcmV0dXJuIHRydWU7CiAgfQogIF9zdGFydFJlbmRlclBhZ2UodHJhbnNwYXJlbmN5LCBjYWNoZUtleSkgewogICAgY29uc3QgaW50ZW50U3RhdGUgPSB0aGlzLl9pbnRlbnRTdGF0ZXMuZ2V0KGNhY2hlS2V5KTsKICAgIGlmICghaW50ZW50U3RhdGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fc3RhdHM/LnRpbWVFbmQoIlBhZ2UgUmVxdWVzdCIpOwogICAgaW50ZW50U3RhdGUuZGlzcGxheVJlYWR5Q2FwYWJpbGl0eT8ucmVzb2x2ZSh0cmFuc3BhcmVuY3kpOwogIH0KICBfcmVuZGVyUGFnZUNodW5rKG9wZXJhdG9yTGlzdENodW5rLCBpbnRlbnRTdGF0ZSkgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gb3BlcmF0b3JMaXN0Q2h1bmsubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBpbnRlbnRTdGF0ZS5vcGVyYXRvckxpc3QuZm5BcnJheS5wdXNoKG9wZXJhdG9yTGlzdENodW5rLmZuQXJyYXlbaV0pOwogICAgICBpbnRlbnRTdGF0ZS5vcGVyYXRvckxpc3QuYXJnc0FycmF5LnB1c2gob3BlcmF0b3JMaXN0Q2h1bmsuYXJnc0FycmF5W2ldKTsKICAgIH0KICAgIGludGVudFN0YXRlLm9wZXJhdG9yTGlzdC5sYXN0Q2h1bmsgPSBvcGVyYXRvckxpc3RDaHVuay5sYXN0Q2h1bms7CiAgICBpbnRlbnRTdGF0ZS5vcGVyYXRvckxpc3Quc2VwYXJhdGVBbm5vdHMgPSBvcGVyYXRvckxpc3RDaHVuay5zZXBhcmF0ZUFubm90czsKICAgIGZvciAoY29uc3QgaW50ZXJuYWxSZW5kZXJUYXNrIG9mIGludGVudFN0YXRlLnJlbmRlclRhc2tzKSB7CiAgICAgIGludGVybmFsUmVuZGVyVGFzay5vcGVyYXRvckxpc3RDaGFuZ2VkKCk7CiAgICB9CiAgICBpZiAob3BlcmF0b3JMaXN0Q2h1bmsubGFzdENodW5rKSB7CiAgICAgIHRoaXMuI3RyeUNsZWFudXAoKTsKICAgIH0KICB9CiAgX3B1bXBPcGVyYXRvckxpc3QoewogICAgcmVuZGVyaW5nSW50ZW50LAogICAgY2FjaGVLZXksCiAgICBhbm5vdGF0aW9uU3RvcmFnZVNlcmlhbGl6YWJsZSwKICAgIG1vZGlmaWVkSWRzCiAgfSkgewogICAgY29uc3QgewogICAgICBtYXAsCiAgICAgIHRyYW5zZmVyCiAgICB9ID0gYW5ub3RhdGlvblN0b3JhZ2VTZXJpYWxpemFibGU7CiAgICBjb25zdCByZWFkYWJsZVN0cmVhbSA9IHRoaXMuX3RyYW5zcG9ydC5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFN0cmVhbSgiR2V0T3BlcmF0b3JMaXN0IiwgewogICAgICBwYWdlSW5kZXg6IHRoaXMuX3BhZ2VJbmRleCwKICAgICAgaW50ZW50OiByZW5kZXJpbmdJbnRlbnQsCiAgICAgIGNhY2hlS2V5LAogICAgICBhbm5vdGF0aW9uU3RvcmFnZTogbWFwLAogICAgICBtb2RpZmllZElkcwogICAgfSwgdHJhbnNmZXIpOwogICAgY29uc3QgcmVhZGVyID0gcmVhZGFibGVTdHJlYW0uZ2V0UmVhZGVyKCk7CiAgICBjb25zdCBpbnRlbnRTdGF0ZSA9IHRoaXMuX2ludGVudFN0YXRlcy5nZXQoY2FjaGVLZXkpOwogICAgaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyID0gcmVhZGVyOwogICAgY29uc3QgcHVtcCA9ICgpID0+IHsKICAgICAgcmVhZGVyLnJlYWQoKS50aGVuKCh7CiAgICAgICAgdmFsdWUsCiAgICAgICAgZG9uZQogICAgICB9KSA9PiB7CiAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgIGludGVudFN0YXRlLnN0cmVhbVJlYWRlciA9IG51bGw7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl90cmFuc3BvcnQuZGVzdHJveWVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuX3JlbmRlclBhZ2VDaHVuayh2YWx1ZSwgaW50ZW50U3RhdGUpOwogICAgICAgIHB1bXAoKTsKICAgICAgfSwgcmVhc29uID0+IHsKICAgICAgICBpbnRlbnRTdGF0ZS5zdHJlYW1SZWFkZXIgPSBudWxsOwogICAgICAgIGlmICh0aGlzLl90cmFuc3BvcnQuZGVzdHJveWVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChpbnRlbnRTdGF0ZS5vcGVyYXRvckxpc3QpIHsKICAgICAgICAgIGludGVudFN0YXRlLm9wZXJhdG9yTGlzdC5sYXN0Q2h1bmsgPSB0cnVlOwogICAgICAgICAgZm9yIChjb25zdCBpbnRlcm5hbFJlbmRlclRhc2sgb2YgaW50ZW50U3RhdGUucmVuZGVyVGFza3MpIHsKICAgICAgICAgICAgaW50ZXJuYWxSZW5kZXJUYXNrLm9wZXJhdG9yTGlzdENoYW5nZWQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuI3RyeUNsZWFudXAoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGludGVudFN0YXRlLmRpc3BsYXlSZWFkeUNhcGFiaWxpdHkpIHsKICAgICAgICAgIGludGVudFN0YXRlLmRpc3BsYXlSZWFkeUNhcGFiaWxpdHkucmVqZWN0KHJlYXNvbik7CiAgICAgICAgfSBlbHNlIGlmIChpbnRlbnRTdGF0ZS5vcExpc3RSZWFkQ2FwYWJpbGl0eSkgewogICAgICAgICAgaW50ZW50U3RhdGUub3BMaXN0UmVhZENhcGFiaWxpdHkucmVqZWN0KHJlYXNvbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICAgIHB1bXAoKTsKICB9CiAgX2Fib3J0T3BlcmF0b3JMaXN0KHsKICAgIGludGVudFN0YXRlLAogICAgcmVhc29uLAogICAgZm9yY2UgPSBmYWxzZQogIH0pIHsKICAgIGlmICghaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChpbnRlbnRTdGF0ZS5zdHJlYW1SZWFkZXJDYW5jZWxUaW1lb3V0KSB7CiAgICAgIGNsZWFyVGltZW91dChpbnRlbnRTdGF0ZS5zdHJlYW1SZWFkZXJDYW5jZWxUaW1lb3V0KTsKICAgICAgaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyQ2FuY2VsVGltZW91dCA9IG51bGw7CiAgICB9CiAgICBpZiAoIWZvcmNlKSB7CiAgICAgIGlmIChpbnRlbnRTdGF0ZS5yZW5kZXJUYXNrcy5zaXplID4gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uKSB7CiAgICAgICAgbGV0IGRlbGF5ID0gUkVOREVSSU5HX0NBTkNFTExFRF9USU1FT1VUOwogICAgICAgIGlmIChyZWFzb24uZXh0cmFEZWxheSA+IDAgJiYgcmVhc29uLmV4dHJhRGVsYXkgPCAxMDAwKSB7CiAgICAgICAgICBkZWxheSArPSByZWFzb24uZXh0cmFEZWxheTsKICAgICAgICB9CiAgICAgICAgaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyQ2FuY2VsVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgaW50ZW50U3RhdGUuc3RyZWFtUmVhZGVyQ2FuY2VsVGltZW91dCA9IG51bGw7CiAgICAgICAgICB0aGlzLl9hYm9ydE9wZXJhdG9yTGlzdCh7CiAgICAgICAgICAgIGludGVudFN0YXRlLAogICAgICAgICAgICByZWFzb24sCiAgICAgICAgICAgIGZvcmNlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9LCBkZWxheSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICBpbnRlbnRTdGF0ZS5zdHJlYW1SZWFkZXIuY2FuY2VsKG5ldyBBYm9ydEV4Y2VwdGlvbihyZWFzb24ubWVzc2FnZSkpLmNhdGNoKCgpID0+IHt9KTsKICAgIGludGVudFN0YXRlLnN0cmVhbVJlYWRlciA9IG51bGw7CiAgICBpZiAodGhpcy5fdHJhbnNwb3J0LmRlc3Ryb3llZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IFtjdXJDYWNoZUtleSwgY3VySW50ZW50U3RhdGVdIG9mIHRoaXMuX2ludGVudFN0YXRlcykgewogICAgICBpZiAoY3VySW50ZW50U3RhdGUgPT09IGludGVudFN0YXRlKSB7CiAgICAgICAgdGhpcy5faW50ZW50U3RhdGVzLmRlbGV0ZShjdXJDYWNoZUtleSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuY2xlYW51cCgpOwogIH0KICBnZXQgc3RhdHMoKSB7CiAgICByZXR1cm4gdGhpcy5fc3RhdHM7CiAgfQp9CmNsYXNzIFBERldvcmtlciB7CiAgI2NhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAjbWVzc2FnZUhhbmRsZXIgPSBudWxsOwogICNwb3J0ID0gbnVsbDsKICAjd2ViV29ya2VyID0gbnVsbDsKICBzdGF0aWMgI2Zha2VXb3JrZXJJZCA9IDA7CiAgc3RhdGljICNpc1dvcmtlckRpc2FibGVkID0gZmFsc2U7CiAgc3RhdGljICN3b3JrZXJQb3J0cyA9IG5ldyBXZWFrTWFwKCk7CiAgc3RhdGljIHsKICAgIGlmIChpc05vZGVKUykgewogICAgICB0aGlzLiNpc1dvcmtlckRpc2FibGVkID0gdHJ1ZTsKICAgICAgR2xvYmFsV29ya2VyT3B0aW9ucy53b3JrZXJTcmMgfHw9ICIuL3BkZi53b3JrZXIubWpzIjsKICAgIH0KICAgIHRoaXMuX2lzU2FtZU9yaWdpbiA9IChiYXNlVXJsLCBvdGhlclVybCkgPT4gewogICAgICBjb25zdCBiYXNlID0gVVJMLnBhcnNlKGJhc2VVcmwpOwogICAgICBpZiAoIWJhc2U/Lm9yaWdpbiB8fCBiYXNlLm9yaWdpbiA9PT0gIm51bGwiKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGNvbnN0IG90aGVyID0gbmV3IFVSTChvdGhlclVybCwgYmFzZSk7CiAgICAgIHJldHVybiBiYXNlLm9yaWdpbiA9PT0gb3RoZXIub3JpZ2luOwogICAgfTsKICAgIHRoaXMuX2NyZWF0ZUNETldyYXBwZXIgPSB1cmwgPT4gewogICAgICBjb25zdCB3cmFwcGVyID0gYGF3YWl0IGltcG9ydCgiJHt1cmx9Iik7YDsKICAgICAgcmV0dXJuIFVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW3dyYXBwZXJdLCB7CiAgICAgICAgdHlwZTogInRleHQvamF2YXNjcmlwdCIKICAgICAgfSkpOwogICAgfTsKICAgIHRoaXMuZnJvbVBvcnQgPSBwYXJhbXMgPT4gewogICAgICBkZXByZWNhdGVkKCJgUERGV29ya2VyLmZyb21Qb3J0YCAtIHBsZWFzZSB1c2UgYFBERldvcmtlci5jcmVhdGVgIGluc3RlYWQuIik7CiAgICAgIGlmICghcGFyYW1zPy5wb3J0KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQREZXb3JrZXIuZnJvbVBvcnQgLSBpbnZhbGlkIG1ldGhvZCBzaWduYXR1cmUuIik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlKHBhcmFtcyk7CiAgICB9OwogIH0KICBjb25zdHJ1Y3Rvcih7CiAgICBuYW1lID0gbnVsbCwKICAgIHBvcnQgPSBudWxsLAogICAgdmVyYm9zaXR5ID0gZ2V0VmVyYm9zaXR5TGV2ZWwoKQogIH0gPSB7fSkgewogICAgdGhpcy5uYW1lID0gbmFtZTsKICAgIHRoaXMuZGVzdHJveWVkID0gZmFsc2U7CiAgICB0aGlzLnZlcmJvc2l0eSA9IHZlcmJvc2l0eTsKICAgIGlmIChwb3J0KSB7CiAgICAgIGlmIChQREZXb3JrZXIuI3dvcmtlclBvcnRzLmhhcyhwb3J0KSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IHVzZSBtb3JlIHRoYW4gb25lIFBERldvcmtlciBwZXIgcG9ydC4iKTsKICAgICAgfQogICAgICBQREZXb3JrZXIuI3dvcmtlclBvcnRzLnNldChwb3J0LCB0aGlzKTsKICAgICAgdGhpcy4jaW5pdGlhbGl6ZUZyb21Qb3J0KHBvcnQpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy4jaW5pdGlhbGl6ZSgpOwogICAgfQogIH0KICBnZXQgcHJvbWlzZSgpIHsKICAgIHJldHVybiB0aGlzLiNjYXBhYmlsaXR5LnByb21pc2U7CiAgfQogICNyZXNvbHZlKCkgewogICAgdGhpcy4jY2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICB0aGlzLiNtZXNzYWdlSGFuZGxlci5zZW5kKCJjb25maWd1cmUiLCB7CiAgICAgIHZlcmJvc2l0eTogdGhpcy52ZXJib3NpdHkKICAgIH0pOwogIH0KICBnZXQgcG9ydCgpIHsKICAgIHJldHVybiB0aGlzLiNwb3J0OwogIH0KICBnZXQgbWVzc2FnZUhhbmRsZXIoKSB7CiAgICByZXR1cm4gdGhpcy4jbWVzc2FnZUhhbmRsZXI7CiAgfQogICNpbml0aWFsaXplRnJvbVBvcnQocG9ydCkgewogICAgdGhpcy4jcG9ydCA9IHBvcnQ7CiAgICB0aGlzLiNtZXNzYWdlSGFuZGxlciA9IG5ldyBNZXNzYWdlSGFuZGxlcigibWFpbiIsICJ3b3JrZXIiLCBwb3J0KTsKICAgIHRoaXMuI21lc3NhZ2VIYW5kbGVyLm9uKCJyZWFkeSIsICgpID0+IHt9KTsKICAgIHRoaXMuI3Jlc29sdmUoKTsKICB9CiAgI2luaXRpYWxpemUoKSB7CiAgICBpZiAoUERGV29ya2VyLiNpc1dvcmtlckRpc2FibGVkIHx8IFBERldvcmtlci4jbWFpblRocmVhZFdvcmtlck1lc3NhZ2VIYW5kbGVyKSB7CiAgICAgIHRoaXMuI3NldHVwRmFrZVdvcmtlcigpOwogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgewogICAgICB3b3JrZXJTcmMKICAgIH0gPSBQREZXb3JrZXI7CiAgICB0cnkgewogICAgICBpZiAoIVBERldvcmtlci5faXNTYW1lT3JpZ2luKHdpbmRvdy5sb2NhdGlvbiwgd29ya2VyU3JjKSkgewogICAgICAgIHdvcmtlclNyYyA9IFBERldvcmtlci5fY3JlYXRlQ0ROV3JhcHBlcihuZXcgVVJMKHdvcmtlclNyYywgd2luZG93LmxvY2F0aW9uKS5ocmVmKTsKICAgICAgfQogICAgICBjb25zdCB3b3JrZXIgPSBuZXcgV29ya2VyKHdvcmtlclNyYywgewogICAgICAgIHR5cGU6ICJtb2R1bGUiCiAgICAgIH0pOwogICAgICBjb25zdCBtZXNzYWdlSGFuZGxlciA9IG5ldyBNZXNzYWdlSGFuZGxlcigibWFpbiIsICJ3b3JrZXIiLCB3b3JrZXIpOwogICAgICBjb25zdCB0ZXJtaW5hdGVFYXJseSA9ICgpID0+IHsKICAgICAgICBhYy5hYm9ydCgpOwogICAgICAgIG1lc3NhZ2VIYW5kbGVyLmRlc3Ryb3koKTsKICAgICAgICB3b3JrZXIudGVybWluYXRlKCk7CiAgICAgICAgaWYgKHRoaXMuZGVzdHJveWVkKSB7CiAgICAgICAgICB0aGlzLiNjYXBhYmlsaXR5LnJlamVjdChuZXcgRXJyb3IoIldvcmtlciB3YXMgZGVzdHJveWVkIikpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiNzZXR1cEZha2VXb3JrZXIoKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGNvbnN0IGFjID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgICB3b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcigiZXJyb3IiLCAoKSA9PiB7CiAgICAgICAgaWYgKCF0aGlzLiN3ZWJXb3JrZXIpIHsKICAgICAgICAgIHRlcm1pbmF0ZUVhcmx5KCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgc2lnbmFsOiBhYy5zaWduYWwKICAgICAgfSk7CiAgICAgIG1lc3NhZ2VIYW5kbGVyLm9uKCJ0ZXN0IiwgZGF0YSA9PiB7CiAgICAgICAgYWMuYWJvcnQoKTsKICAgICAgICBpZiAodGhpcy5kZXN0cm95ZWQgfHwgIWRhdGEpIHsKICAgICAgICAgIHRlcm1pbmF0ZUVhcmx5KCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuI21lc3NhZ2VIYW5kbGVyID0gbWVzc2FnZUhhbmRsZXI7CiAgICAgICAgdGhpcy4jcG9ydCA9IHdvcmtlcjsKICAgICAgICB0aGlzLiN3ZWJXb3JrZXIgPSB3b3JrZXI7CiAgICAgICAgdGhpcy4jcmVzb2x2ZSgpOwogICAgICB9KTsKICAgICAgbWVzc2FnZUhhbmRsZXIub24oInJlYWR5IiwgZGF0YSA9PiB7CiAgICAgICAgYWMuYWJvcnQoKTsKICAgICAgICBpZiAodGhpcy5kZXN0cm95ZWQpIHsKICAgICAgICAgIHRlcm1pbmF0ZUVhcmx5KCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICBzZW5kVGVzdCgpOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgdGhpcy4jc2V0dXBGYWtlV29ya2VyKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgY29uc3Qgc2VuZFRlc3QgPSAoKSA9PiB7CiAgICAgICAgY29uc3QgdGVzdE9iaiA9IG5ldyBVaW50OEFycmF5KCk7CiAgICAgICAgbWVzc2FnZUhhbmRsZXIuc2VuZCgidGVzdCIsIHRlc3RPYmosIFt0ZXN0T2JqLmJ1ZmZlcl0pOwogICAgICB9OwogICAgICBzZW5kVGVzdCgpOwogICAgICByZXR1cm47CiAgICB9IGNhdGNoIHsKICAgICAgaW5mbygiVGhlIHdvcmtlciBoYXMgYmVlbiBkaXNhYmxlZC4iKTsKICAgIH0KICAgIHRoaXMuI3NldHVwRmFrZVdvcmtlcigpOwogIH0KICAjc2V0dXBGYWtlV29ya2VyKCkgewogICAgaWYgKCFQREZXb3JrZXIuI2lzV29ya2VyRGlzYWJsZWQpIHsKICAgICAgd2FybigiU2V0dGluZyB1cCBmYWtlIHdvcmtlci4iKTsKICAgICAgUERGV29ya2VyLiNpc1dvcmtlckRpc2FibGVkID0gdHJ1ZTsKICAgIH0KICAgIFBERldvcmtlci5fc2V0dXBGYWtlV29ya2VyR2xvYmFsLnRoZW4oV29ya2VyTWVzc2FnZUhhbmRsZXIgPT4gewogICAgICBpZiAodGhpcy5kZXN0cm95ZWQpIHsKICAgICAgICB0aGlzLiNjYXBhYmlsaXR5LnJlamVjdChuZXcgRXJyb3IoIldvcmtlciB3YXMgZGVzdHJveWVkIikpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBwb3J0ID0gbmV3IExvb3BiYWNrUG9ydCgpOwogICAgICB0aGlzLiNwb3J0ID0gcG9ydDsKICAgICAgY29uc3QgaWQgPSBgZmFrZSR7UERGV29ya2VyLiNmYWtlV29ya2VySWQrK31gOwogICAgICBjb25zdCB3b3JrZXJIYW5kbGVyID0gbmV3IE1lc3NhZ2VIYW5kbGVyKGlkICsgIl93b3JrZXIiLCBpZCwgcG9ydCk7CiAgICAgIFdvcmtlck1lc3NhZ2VIYW5kbGVyLnNldHVwKHdvcmtlckhhbmRsZXIsIHBvcnQpOwogICAgICB0aGlzLiNtZXNzYWdlSGFuZGxlciA9IG5ldyBNZXNzYWdlSGFuZGxlcihpZCwgaWQgKyAiX3dvcmtlciIsIHBvcnQpOwogICAgICB0aGlzLiNyZXNvbHZlKCk7CiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICB0aGlzLiNjYXBhYmlsaXR5LnJlamVjdChuZXcgRXJyb3IoYFNldHRpbmcgdXAgZmFrZSB3b3JrZXIgZmFpbGVkOiAiJHtyZWFzb24ubWVzc2FnZX0iLmApKTsKICAgIH0pOwogIH0KICBkZXN0cm95KCkgewogICAgdGhpcy5kZXN0cm95ZWQgPSB0cnVlOwogICAgdGhpcy4jd2ViV29ya2VyPy50ZXJtaW5hdGUoKTsKICAgIHRoaXMuI3dlYldvcmtlciA9IG51bGw7CiAgICBQREZXb3JrZXIuI3dvcmtlclBvcnRzLmRlbGV0ZSh0aGlzLiNwb3J0KTsKICAgIHRoaXMuI3BvcnQgPSBudWxsOwogICAgdGhpcy4jbWVzc2FnZUhhbmRsZXI/LmRlc3Ryb3koKTsKICAgIHRoaXMuI21lc3NhZ2VIYW5kbGVyID0gbnVsbDsKICB9CiAgc3RhdGljIGNyZWF0ZShwYXJhbXMpIHsKICAgIGNvbnN0IGNhY2hlZFBvcnQgPSB0aGlzLiN3b3JrZXJQb3J0cy5nZXQocGFyYW1zPy5wb3J0KTsKICAgIGlmIChjYWNoZWRQb3J0KSB7CiAgICAgIGlmIChjYWNoZWRQb3J0Ll9wZW5kaW5nRGVzdHJveSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiUERGV29ya2VyLmNyZWF0ZSAtIHRoZSB3b3JrZXIgaXMgYmVpbmcgZGVzdHJveWVkLlxuIiArICJQbGVhc2UgcmVtZW1iZXIgdG8gYXdhaXQgYFBERkRvY3VtZW50TG9hZGluZ1Rhc2suZGVzdHJveSgpYC1jYWxscy4iKTsKICAgICAgfQogICAgICByZXR1cm4gY2FjaGVkUG9ydDsKICAgIH0KICAgIHJldHVybiBuZXcgUERGV29ya2VyKHBhcmFtcyk7CiAgfQogIHN0YXRpYyBnZXQgd29ya2VyU3JjKCkgewogICAgaWYgKEdsb2JhbFdvcmtlck9wdGlvbnMud29ya2VyU3JjKSB7CiAgICAgIHJldHVybiBHbG9iYWxXb3JrZXJPcHRpb25zLndvcmtlclNyYzsKICAgIH0KICAgIHRocm93IG5ldyBFcnJvcignTm8gIkdsb2JhbFdvcmtlck9wdGlvbnMud29ya2VyU3JjIiBzcGVjaWZpZWQuJyk7CiAgfQogIHN0YXRpYyBnZXQgI21haW5UaHJlYWRXb3JrZXJNZXNzYWdlSGFuZGxlcigpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBnbG9iYWxUaGlzLnBkZmpzV29ya2VyPy5Xb3JrZXJNZXNzYWdlSGFuZGxlciB8fCBudWxsOwogICAgfSBjYXRjaCB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICBzdGF0aWMgZ2V0IF9zZXR1cEZha2VXb3JrZXJHbG9iYWwoKSB7CiAgICBjb25zdCBsb2FkZXIgPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICh0aGlzLiNtYWluVGhyZWFkV29ya2VyTWVzc2FnZUhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy4jbWFpblRocmVhZFdvcmtlck1lc3NhZ2VIYW5kbGVyOwogICAgICB9CiAgICAgIGNvbnN0IHdvcmtlciA9IGF3YWl0IGltcG9ydCgKICAgICAgLyp3ZWJwYWNrSWdub3JlOiB0cnVlKi8KICAgICAgLypAdml0ZS1pZ25vcmUqLwogICAgICB0aGlzLndvcmtlclNyYyk7CiAgICAgIHJldHVybiB3b3JrZXIuV29ya2VyTWVzc2FnZUhhbmRsZXI7CiAgICB9OwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX3NldHVwRmFrZVdvcmtlckdsb2JhbCIsIGxvYWRlcigpKTsKICB9Cn0KY2xhc3MgV29ya2VyVHJhbnNwb3J0IHsKICAjbWV0aG9kUHJvbWlzZXMgPSBuZXcgTWFwKCk7CiAgI3BhZ2VDYWNoZSA9IG5ldyBNYXAoKTsKICAjcGFnZVByb21pc2VzID0gbmV3IE1hcCgpOwogICNwYWdlUmVmQ2FjaGUgPSBuZXcgTWFwKCk7CiAgI3Bhc3N3b3JkQ2FwYWJpbGl0eSA9IG51bGw7CiAgY29uc3RydWN0b3IobWVzc2FnZUhhbmRsZXIsIGxvYWRpbmdUYXNrLCBuZXR3b3JrU3RyZWFtLCBwYXJhbXMsIGZhY3RvcnkpIHsKICAgIHRoaXMubWVzc2FnZUhhbmRsZXIgPSBtZXNzYWdlSGFuZGxlcjsKICAgIHRoaXMubG9hZGluZ1Rhc2sgPSBsb2FkaW5nVGFzazsKICAgIHRoaXMuY29tbW9uT2JqcyA9IG5ldyBQREZPYmplY3RzKCk7CiAgICB0aGlzLmZvbnRMb2FkZXIgPSBuZXcgRm9udExvYWRlcih7CiAgICAgIG93bmVyRG9jdW1lbnQ6IHBhcmFtcy5vd25lckRvY3VtZW50LAogICAgICBzdHlsZUVsZW1lbnQ6IHBhcmFtcy5zdHlsZUVsZW1lbnQKICAgIH0pOwogICAgdGhpcy5sb2FkaW5nUGFyYW1zID0gcGFyYW1zLmxvYWRpbmdQYXJhbXM7CiAgICB0aGlzLl9wYXJhbXMgPSBwYXJhbXM7CiAgICB0aGlzLmNhbnZhc0ZhY3RvcnkgPSBmYWN0b3J5LmNhbnZhc0ZhY3Rvcnk7CiAgICB0aGlzLmZpbHRlckZhY3RvcnkgPSBmYWN0b3J5LmZpbHRlckZhY3Rvcnk7CiAgICB0aGlzLmNNYXBSZWFkZXJGYWN0b3J5ID0gZmFjdG9yeS5jTWFwUmVhZGVyRmFjdG9yeTsKICAgIHRoaXMuc3RhbmRhcmRGb250RGF0YUZhY3RvcnkgPSBmYWN0b3J5LnN0YW5kYXJkRm9udERhdGFGYWN0b3J5OwogICAgdGhpcy53YXNtRmFjdG9yeSA9IGZhY3Rvcnkud2FzbUZhY3Rvcnk7CiAgICB0aGlzLmRlc3Ryb3llZCA9IGZhbHNlOwogICAgdGhpcy5kZXN0cm95Q2FwYWJpbGl0eSA9IG51bGw7CiAgICB0aGlzLl9uZXR3b3JrU3RyZWFtID0gbmV0d29ya1N0cmVhbTsKICAgIHRoaXMuX2Z1bGxSZWFkZXIgPSBudWxsOwogICAgdGhpcy5fbGFzdFByb2dyZXNzID0gbnVsbDsKICAgIHRoaXMuZG93bmxvYWRJbmZvQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgdGhpcy5zZXR1cE1lc3NhZ2VIYW5kbGVyKCk7CiAgfQogICNjYWNoZVNpbXBsZU1ldGhvZChuYW1lLCBkYXRhID0gbnVsbCkgewogICAgY29uc3QgY2FjaGVkUHJvbWlzZSA9IHRoaXMuI21ldGhvZFByb21pc2VzLmdldChuYW1lKTsKICAgIGlmIChjYWNoZWRQcm9taXNlKSB7CiAgICAgIHJldHVybiBjYWNoZWRQcm9taXNlOwogICAgfQogICAgY29uc3QgcHJvbWlzZSA9IHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKG5hbWUsIGRhdGEpOwogICAgdGhpcy4jbWV0aG9kUHJvbWlzZXMuc2V0KG5hbWUsIHByb21pc2UpOwogICAgcmV0dXJuIHByb21pc2U7CiAgfQogIGdldCBhbm5vdGF0aW9uU3RvcmFnZSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImFubm90YXRpb25TdG9yYWdlIiwgbmV3IEFubm90YXRpb25TdG9yYWdlKCkpOwogIH0KICBnZXRSZW5kZXJpbmdJbnRlbnQoaW50ZW50LCBhbm5vdGF0aW9uTW9kZSA9IEFubm90YXRpb25Nb2RlLkVOQUJMRSwgcHJpbnRBbm5vdGF0aW9uU3RvcmFnZSA9IG51bGwsIGlzRWRpdGluZyA9IGZhbHNlLCBpc09wTGlzdCA9IGZhbHNlKSB7CiAgICBsZXQgcmVuZGVyaW5nSW50ZW50ID0gUmVuZGVyaW5nSW50ZW50RmxhZy5ESVNQTEFZOwogICAgbGV0IGFubm90YXRpb25TdG9yYWdlU2VyaWFsaXphYmxlID0gU2VyaWFsaXphYmxlRW1wdHk7CiAgICBzd2l0Y2ggKGludGVudCkgewogICAgICBjYXNlICJhbnkiOgogICAgICAgIHJlbmRlcmluZ0ludGVudCA9IFJlbmRlcmluZ0ludGVudEZsYWcuQU5ZOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJkaXNwbGF5IjoKICAgICAgICBicmVhazsKICAgICAgY2FzZSAicHJpbnQiOgogICAgICAgIHJlbmRlcmluZ0ludGVudCA9IFJlbmRlcmluZ0ludGVudEZsYWcuUFJJTlQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgd2FybihgZ2V0UmVuZGVyaW5nSW50ZW50IC0gaW52YWxpZCBpbnRlbnQ6ICR7aW50ZW50fWApOwogICAgfQogICAgY29uc3QgYW5ub3RhdGlvblN0b3JhZ2UgPSByZW5kZXJpbmdJbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLlBSSU5UICYmIHByaW50QW5ub3RhdGlvblN0b3JhZ2UgaW5zdGFuY2VvZiBQcmludEFubm90YXRpb25TdG9yYWdlID8gcHJpbnRBbm5vdGF0aW9uU3RvcmFnZSA6IHRoaXMuYW5ub3RhdGlvblN0b3JhZ2U7CiAgICBzd2l0Y2ggKGFubm90YXRpb25Nb2RlKSB7CiAgICAgIGNhc2UgQW5ub3RhdGlvbk1vZGUuRElTQUJMRToKICAgICAgICByZW5kZXJpbmdJbnRlbnQgKz0gUmVuZGVyaW5nSW50ZW50RmxhZy5BTk5PVEFUSU9OU19ESVNBQkxFOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIEFubm90YXRpb25Nb2RlLkVOQUJMRToKICAgICAgICBicmVhazsKICAgICAgY2FzZSBBbm5vdGF0aW9uTW9kZS5FTkFCTEVfRk9STVM6CiAgICAgICAgcmVuZGVyaW5nSW50ZW50ICs9IFJlbmRlcmluZ0ludGVudEZsYWcuQU5OT1RBVElPTlNfRk9STVM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgQW5ub3RhdGlvbk1vZGUuRU5BQkxFX1NUT1JBR0U6CiAgICAgICAgcmVuZGVyaW5nSW50ZW50ICs9IFJlbmRlcmluZ0ludGVudEZsYWcuQU5OT1RBVElPTlNfU1RPUkFHRTsKICAgICAgICBhbm5vdGF0aW9uU3RvcmFnZVNlcmlhbGl6YWJsZSA9IGFubm90YXRpb25TdG9yYWdlLnNlcmlhbGl6YWJsZTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB3YXJuKGBnZXRSZW5kZXJpbmdJbnRlbnQgLSBpbnZhbGlkIGFubm90YXRpb25Nb2RlOiAke2Fubm90YXRpb25Nb2RlfWApOwogICAgfQogICAgaWYgKGlzRWRpdGluZykgewogICAgICByZW5kZXJpbmdJbnRlbnQgKz0gUmVuZGVyaW5nSW50ZW50RmxhZy5JU19FRElUSU5HOwogICAgfQogICAgaWYgKGlzT3BMaXN0KSB7CiAgICAgIHJlbmRlcmluZ0ludGVudCArPSBSZW5kZXJpbmdJbnRlbnRGbGFnLk9QTElTVDsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgaWRzOiBtb2RpZmllZElkcywKICAgICAgaGFzaDogbW9kaWZpZWRJZHNIYXNoCiAgICB9ID0gYW5ub3RhdGlvblN0b3JhZ2UubW9kaWZpZWRJZHM7CiAgICBjb25zdCBjYWNoZUtleUJ1ZiA9IFtyZW5kZXJpbmdJbnRlbnQsIGFubm90YXRpb25TdG9yYWdlU2VyaWFsaXphYmxlLmhhc2gsIG1vZGlmaWVkSWRzSGFzaF07CiAgICByZXR1cm4gewogICAgICByZW5kZXJpbmdJbnRlbnQsCiAgICAgIGNhY2hlS2V5OiBjYWNoZUtleUJ1Zi5qb2luKCJfIiksCiAgICAgIGFubm90YXRpb25TdG9yYWdlU2VyaWFsaXphYmxlLAogICAgICBtb2RpZmllZElkcwogICAgfTsKICB9CiAgZGVzdHJveSgpIHsKICAgIGlmICh0aGlzLmRlc3Ryb3lDYXBhYmlsaXR5KSB7CiAgICAgIHJldHVybiB0aGlzLmRlc3Ryb3lDYXBhYmlsaXR5LnByb21pc2U7CiAgICB9CiAgICB0aGlzLmRlc3Ryb3llZCA9IHRydWU7CiAgICB0aGlzLmRlc3Ryb3lDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICB0aGlzLiNwYXNzd29yZENhcGFiaWxpdHk/LnJlamVjdChuZXcgRXJyb3IoIldvcmtlciB3YXMgZGVzdHJveWVkIGR1cmluZyBvblBhc3N3b3JkIGNhbGxiYWNrIikpOwogICAgY29uc3Qgd2FpdE9uID0gW107CiAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgdGhpcy4jcGFnZUNhY2hlLnZhbHVlcygpKSB7CiAgICAgIHdhaXRPbi5wdXNoKHBhZ2UuX2Rlc3Ryb3koKSk7CiAgICB9CiAgICB0aGlzLiNwYWdlQ2FjaGUuY2xlYXIoKTsKICAgIHRoaXMuI3BhZ2VQcm9taXNlcy5jbGVhcigpOwogICAgdGhpcy4jcGFnZVJlZkNhY2hlLmNsZWFyKCk7CiAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eSgiYW5ub3RhdGlvblN0b3JhZ2UiKSkgewogICAgICB0aGlzLmFubm90YXRpb25TdG9yYWdlLnJlc2V0TW9kaWZpZWQoKTsKICAgIH0KICAgIGNvbnN0IHRlcm1pbmF0ZWQgPSB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiVGVybWluYXRlIiwgbnVsbCk7CiAgICB3YWl0T24ucHVzaCh0ZXJtaW5hdGVkKTsKICAgIFByb21pc2UuYWxsKHdhaXRPbikudGhlbigoKSA9PiB7CiAgICAgIHRoaXMuY29tbW9uT2Jqcy5jbGVhcigpOwogICAgICB0aGlzLmZvbnRMb2FkZXIuY2xlYXIoKTsKICAgICAgdGhpcy4jbWV0aG9kUHJvbWlzZXMuY2xlYXIoKTsKICAgICAgdGhpcy5maWx0ZXJGYWN0b3J5LmRlc3Ryb3koKTsKICAgICAgVGV4dExheWVyLmNsZWFudXAoKTsKICAgICAgdGhpcy5fbmV0d29ya1N0cmVhbT8uY2FuY2VsQWxsUmVxdWVzdHMobmV3IEFib3J0RXhjZXB0aW9uKCJXb3JrZXIgd2FzIHRlcm1pbmF0ZWQuIikpOwogICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyPy5kZXN0cm95KCk7CiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIgPSBudWxsOwogICAgICB0aGlzLmRlc3Ryb3lDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgIH0sIHRoaXMuZGVzdHJveUNhcGFiaWxpdHkucmVqZWN0KTsKICAgIHJldHVybiB0aGlzLmRlc3Ryb3lDYXBhYmlsaXR5LnByb21pc2U7CiAgfQogIHNldHVwTWVzc2FnZUhhbmRsZXIoKSB7CiAgICBjb25zdCB7CiAgICAgIG1lc3NhZ2VIYW5kbGVyLAogICAgICBsb2FkaW5nVGFzawogICAgfSA9IHRoaXM7CiAgICBtZXNzYWdlSGFuZGxlci5vbigiR2V0UmVhZGVyIiwgKGRhdGEsIHNpbmspID0+IHsKICAgICAgYXNzZXJ0KHRoaXMuX25ldHdvcmtTdHJlYW0sICJHZXRSZWFkZXIgLSBubyBgSVBERlN0cmVhbWAgaW5zdGFuY2UgYXZhaWxhYmxlLiIpOwogICAgICB0aGlzLl9mdWxsUmVhZGVyID0gdGhpcy5fbmV0d29ya1N0cmVhbS5nZXRGdWxsUmVhZGVyKCk7CiAgICAgIHRoaXMuX2Z1bGxSZWFkZXIub25Qcm9ncmVzcyA9IGV2dCA9PiB7CiAgICAgICAgdGhpcy5fbGFzdFByb2dyZXNzID0gewogICAgICAgICAgbG9hZGVkOiBldnQubG9hZGVkLAogICAgICAgICAgdG90YWw6IGV2dC50b3RhbAogICAgICAgIH07CiAgICAgIH07CiAgICAgIHNpbmsub25QdWxsID0gKCkgPT4gewogICAgICAgIHRoaXMuX2Z1bGxSZWFkZXIucmVhZCgpLnRoZW4oZnVuY3Rpb24gKHsKICAgICAgICAgIHZhbHVlLAogICAgICAgICAgZG9uZQogICAgICAgIH0pIHsKICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgIHNpbmsuY2xvc2UoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgYXNzZXJ0KHZhbHVlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIsICJHZXRSZWFkZXIgLSBleHBlY3RlZCBhbiBBcnJheUJ1ZmZlci4iKTsKICAgICAgICAgIHNpbmsuZW5xdWV1ZShuZXcgVWludDhBcnJheSh2YWx1ZSksIDEsIFt2YWx1ZV0pOwogICAgICAgIH0pLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgICAgICBzaW5rLmVycm9yKHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICAgIHNpbmsub25DYW5jZWwgPSByZWFzb24gPT4gewogICAgICAgIHRoaXMuX2Z1bGxSZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgICAgICAgc2luay5yZWFkeS5jYXRjaChyZWFkeVJlYXNvbiA9PiB7CiAgICAgICAgICBpZiAodGhpcy5kZXN0cm95ZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgcmVhZHlSZWFzb247CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9KTsKICAgIG1lc3NhZ2VIYW5kbGVyLm9uKCJSZWFkZXJIZWFkZXJzUmVhZHkiLCBhc3luYyBkYXRhID0+IHsKICAgICAgYXdhaXQgdGhpcy5fZnVsbFJlYWRlci5oZWFkZXJzUmVhZHk7CiAgICAgIGNvbnN0IHsKICAgICAgICBpc1N0cmVhbWluZ1N1cHBvcnRlZCwKICAgICAgICBpc1JhbmdlU3VwcG9ydGVkLAogICAgICAgIGNvbnRlbnRMZW5ndGgKICAgICAgfSA9IHRoaXMuX2Z1bGxSZWFkZXI7CiAgICAgIGlmICghaXNTdHJlYW1pbmdTdXBwb3J0ZWQgfHwgIWlzUmFuZ2VTdXBwb3J0ZWQpIHsKICAgICAgICBpZiAodGhpcy5fbGFzdFByb2dyZXNzKSB7CiAgICAgICAgICBsb2FkaW5nVGFzay5vblByb2dyZXNzPy4odGhpcy5fbGFzdFByb2dyZXNzKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fZnVsbFJlYWRlci5vblByb2dyZXNzID0gZXZ0ID0+IHsKICAgICAgICAgIGxvYWRpbmdUYXNrLm9uUHJvZ3Jlc3M/Lih7CiAgICAgICAgICAgIGxvYWRlZDogZXZ0LmxvYWRlZCwKICAgICAgICAgICAgdG90YWw6IGV2dC50b3RhbAogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIGlzU3RyZWFtaW5nU3VwcG9ydGVkLAogICAgICAgIGlzUmFuZ2VTdXBwb3J0ZWQsCiAgICAgICAgY29udGVudExlbmd0aAogICAgICB9OwogICAgfSk7CiAgICBtZXNzYWdlSGFuZGxlci5vbigiR2V0UmFuZ2VSZWFkZXIiLCAoZGF0YSwgc2luaykgPT4gewogICAgICBhc3NlcnQodGhpcy5fbmV0d29ya1N0cmVhbSwgIkdldFJhbmdlUmVhZGVyIC0gbm8gYElQREZTdHJlYW1gIGluc3RhbmNlIGF2YWlsYWJsZS4iKTsKICAgICAgY29uc3QgcmFuZ2VSZWFkZXIgPSB0aGlzLl9uZXR3b3JrU3RyZWFtLmdldFJhbmdlUmVhZGVyKGRhdGEuYmVnaW4sIGRhdGEuZW5kKTsKICAgICAgaWYgKCFyYW5nZVJlYWRlcikgewogICAgICAgIHNpbmsuY2xvc2UoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgc2luay5vblB1bGwgPSAoKSA9PiB7CiAgICAgICAgcmFuZ2VSZWFkZXIucmVhZCgpLnRoZW4oZnVuY3Rpb24gKHsKICAgICAgICAgIHZhbHVlLAogICAgICAgICAgZG9uZQogICAgICAgIH0pIHsKICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgIHNpbmsuY2xvc2UoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgYXNzZXJ0KHZhbHVlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIsICJHZXRSYW5nZVJlYWRlciAtIGV4cGVjdGVkIGFuIEFycmF5QnVmZmVyLiIpOwogICAgICAgICAgc2luay5lbnF1ZXVlKG5ldyBVaW50OEFycmF5KHZhbHVlKSwgMSwgW3ZhbHVlXSk7CiAgICAgICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgICAgIHNpbmsuZXJyb3IocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfTsKICAgICAgc2luay5vbkNhbmNlbCA9IHJlYXNvbiA9PiB7CiAgICAgICAgcmFuZ2VSZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgICAgICAgc2luay5yZWFkeS5jYXRjaChyZWFkeVJlYXNvbiA9PiB7CiAgICAgICAgICBpZiAodGhpcy5kZXN0cm95ZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgcmVhZHlSZWFzb247CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9KTsKICAgIG1lc3NhZ2VIYW5kbGVyLm9uKCJHZXREb2MiLCAoewogICAgICBwZGZJbmZvCiAgICB9KSA9PiB7CiAgICAgIHRoaXMuX251bVBhZ2VzID0gcGRmSW5mby5udW1QYWdlczsKICAgICAgdGhpcy5faHRtbEZvclhmYSA9IHBkZkluZm8uaHRtbEZvclhmYTsKICAgICAgZGVsZXRlIHBkZkluZm8uaHRtbEZvclhmYTsKICAgICAgbG9hZGluZ1Rhc2suX2NhcGFiaWxpdHkucmVzb2x2ZShuZXcgUERGRG9jdW1lbnRQcm94eShwZGZJbmZvLCB0aGlzKSk7CiAgICB9KTsKICAgIG1lc3NhZ2VIYW5kbGVyLm9uKCJEb2NFeGNlcHRpb24iLCBleCA9PiB7CiAgICAgIGxvYWRpbmdUYXNrLl9jYXBhYmlsaXR5LnJlamVjdCh3cmFwUmVhc29uKGV4KSk7CiAgICB9KTsKICAgIG1lc3NhZ2VIYW5kbGVyLm9uKCJQYXNzd29yZFJlcXVlc3QiLCBleCA9PiB7CiAgICAgIHRoaXMuI3Bhc3N3b3JkQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgICB0cnkgewogICAgICAgIGlmICghbG9hZGluZ1Rhc2sub25QYXNzd29yZCkgewogICAgICAgICAgdGhyb3cgd3JhcFJlYXNvbihleCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHVwZGF0ZVBhc3N3b3JkID0gcGFzc3dvcmQgPT4gewogICAgICAgICAgaWYgKHBhc3N3b3JkIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICAgICAgdGhpcy4jcGFzc3dvcmRDYXBhYmlsaXR5LnJlamVjdChwYXNzd29yZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLiNwYXNzd29yZENhcGFiaWxpdHkucmVzb2x2ZSh7CiAgICAgICAgICAgICAgcGFzc3dvcmQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBsb2FkaW5nVGFzay5vblBhc3N3b3JkKHVwZGF0ZVBhc3N3b3JkLCBleC5jb2RlKTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgdGhpcy4jcGFzc3dvcmRDYXBhYmlsaXR5LnJlamVjdChlcnIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLiNwYXNzd29yZENhcGFiaWxpdHkucHJvbWlzZTsKICAgIH0pOwogICAgbWVzc2FnZUhhbmRsZXIub24oIkRhdGFMb2FkZWQiLCBkYXRhID0+IHsKICAgICAgbG9hZGluZ1Rhc2sub25Qcm9ncmVzcz8uKHsKICAgICAgICBsb2FkZWQ6IGRhdGEubGVuZ3RoLAogICAgICAgIHRvdGFsOiBkYXRhLmxlbmd0aAogICAgICB9KTsKICAgICAgdGhpcy5kb3dubG9hZEluZm9DYXBhYmlsaXR5LnJlc29sdmUoZGF0YSk7CiAgICB9KTsKICAgIG1lc3NhZ2VIYW5kbGVyLm9uKCJTdGFydFJlbmRlclBhZ2UiLCBkYXRhID0+IHsKICAgICAgaWYgKHRoaXMuZGVzdHJveWVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IHBhZ2UgPSB0aGlzLiNwYWdlQ2FjaGUuZ2V0KGRhdGEucGFnZUluZGV4KTsKICAgICAgcGFnZS5fc3RhcnRSZW5kZXJQYWdlKGRhdGEudHJhbnNwYXJlbmN5LCBkYXRhLmNhY2hlS2V5KTsKICAgIH0pOwogICAgbWVzc2FnZUhhbmRsZXIub24oImNvbW1vbm9iaiIsIChbaWQsIHR5cGUsIGV4cG9ydGVkRGF0YV0pID0+IHsKICAgICAgaWYgKHRoaXMuZGVzdHJveWVkKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY29tbW9uT2Jqcy5oYXMoaWQpKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAiRm9udCI6CiAgICAgICAgICBpZiAoImVycm9yIiBpbiBleHBvcnRlZERhdGEpIHsKICAgICAgICAgICAgY29uc3QgZXhwb3J0ZWRFcnJvciA9IGV4cG9ydGVkRGF0YS5lcnJvcjsKICAgICAgICAgICAgd2FybihgRXJyb3IgZHVyaW5nIGZvbnQgbG9hZGluZzogJHtleHBvcnRlZEVycm9yfWApOwogICAgICAgICAgICB0aGlzLmNvbW1vbk9ianMucmVzb2x2ZShpZCwgZXhwb3J0ZWRFcnJvcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgaW5zcGVjdEZvbnQgPSB0aGlzLl9wYXJhbXMucGRmQnVnICYmIGdsb2JhbFRoaXMuRm9udEluc3BlY3Rvcj8uZW5hYmxlZCA/IChmb250LCB1cmwpID0+IGdsb2JhbFRoaXMuRm9udEluc3BlY3Rvci5mb250QWRkZWQoZm9udCwgdXJsKSA6IG51bGw7CiAgICAgICAgICBjb25zdCBmb250ID0gbmV3IEZvbnRGYWNlT2JqZWN0KGV4cG9ydGVkRGF0YSwgaW5zcGVjdEZvbnQpOwogICAgICAgICAgdGhpcy5mb250TG9hZGVyLmJpbmQoZm9udCkuY2F0Y2goKCkgPT4gbWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJGb250RmFsbGJhY2siLCB7CiAgICAgICAgICAgIGlkCiAgICAgICAgICB9KSkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgICAgIGlmICghZm9udC5mb250RXh0cmFQcm9wZXJ0aWVzICYmIGZvbnQuZGF0YSkgewogICAgICAgICAgICAgIGZvbnQuZGF0YSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5jb21tb25PYmpzLnJlc29sdmUoaWQsIGZvbnQpOwogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJDb3B5TG9jYWxJbWFnZSI6CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGltYWdlUmVmCiAgICAgICAgICB9ID0gZXhwb3J0ZWREYXRhOwogICAgICAgICAgYXNzZXJ0KGltYWdlUmVmLCAiVGhlIGltYWdlUmVmIG11c3QgYmUgZGVmaW5lZC4iKTsKICAgICAgICAgIGZvciAoY29uc3QgcGFnZVByb3h5IG9mIHRoaXMuI3BhZ2VDYWNoZS52YWx1ZXMoKSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IFssIGRhdGFdIG9mIHBhZ2VQcm94eS5vYmpzKSB7CiAgICAgICAgICAgICAgaWYgKGRhdGE/LnJlZiAhPT0gaW1hZ2VSZWYpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoIWRhdGEuZGF0YUxlbikgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuY29tbW9uT2Jqcy5yZXNvbHZlKGlkLCBzdHJ1Y3R1cmVkQ2xvbmUoZGF0YSkpOwogICAgICAgICAgICAgIHJldHVybiBkYXRhLmRhdGFMZW47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkZvbnRQYXRoIjoKICAgICAgICBjYXNlICJJbWFnZSI6CiAgICAgICAgY2FzZSAiUGF0dGVybiI6CiAgICAgICAgICB0aGlzLmNvbW1vbk9ianMucmVzb2x2ZShpZCwgZXhwb3J0ZWREYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEdvdCB1bmtub3duIGNvbW1vbiBvYmplY3QgdHlwZSAke3R5cGV9YCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9KTsKICAgIG1lc3NhZ2VIYW5kbGVyLm9uKCJvYmoiLCAoW2lkLCBwYWdlSW5kZXgsIHR5cGUsIGltYWdlRGF0YV0pID0+IHsKICAgICAgaWYgKHRoaXMuZGVzdHJveWVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IHBhZ2VQcm94eSA9IHRoaXMuI3BhZ2VDYWNoZS5nZXQocGFnZUluZGV4KTsKICAgICAgaWYgKHBhZ2VQcm94eS5vYmpzLmhhcyhpZCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHBhZ2VQcm94eS5faW50ZW50U3RhdGVzLnNpemUgPT09IDApIHsKICAgICAgICBpbWFnZURhdGE/LmJpdG1hcD8uY2xvc2UoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAiSW1hZ2UiOgogICAgICAgIGNhc2UgIlBhdHRlcm4iOgogICAgICAgICAgcGFnZVByb3h5Lm9ianMucmVzb2x2ZShpZCwgaW1hZ2VEYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEdvdCB1bmtub3duIG9iamVjdCB0eXBlICR7dHlwZX1gKTsKICAgICAgfQogICAgfSk7CiAgICBtZXNzYWdlSGFuZGxlci5vbigiRG9jUHJvZ3Jlc3MiLCBkYXRhID0+IHsKICAgICAgaWYgKHRoaXMuZGVzdHJveWVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxvYWRpbmdUYXNrLm9uUHJvZ3Jlc3M/Lih7CiAgICAgICAgbG9hZGVkOiBkYXRhLmxvYWRlZCwKICAgICAgICB0b3RhbDogZGF0YS50b3RhbAogICAgICB9KTsKICAgIH0pOwogICAgbWVzc2FnZUhhbmRsZXIub24oIkZldGNoQmluYXJ5RGF0YSIsIGFzeW5jIGRhdGEgPT4gewogICAgICBpZiAodGhpcy5kZXN0cm95ZWQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldvcmtlciB3YXMgZGVzdHJveWVkLiIpOwogICAgICB9CiAgICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzW2RhdGEudHlwZV07CiAgICAgIGlmICghZmFjdG9yeSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgJHtkYXRhLnR5cGV9IG5vdCBpbml0aWFsaXplZCwgc2VlIHRoZSBcYHVzZVdvcmtlckZldGNoXGAgcGFyYW1ldGVyLmApOwogICAgICB9CiAgICAgIHJldHVybiBmYWN0b3J5LmZldGNoKGRhdGEpOwogICAgfSk7CiAgfQogIGdldERhdGEoKSB7CiAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldERhdGEiLCBudWxsKTsKICB9CiAgc2F2ZURvY3VtZW50KCkgewogICAgaWYgKHRoaXMuYW5ub3RhdGlvblN0b3JhZ2Uuc2l6ZSA8PSAwKSB7CiAgICAgIHdhcm4oInNhdmVEb2N1bWVudCBjYWxsZWQgd2hpbGUgYGFubm90YXRpb25TdG9yYWdlYCBpcyBlbXB0eSwgIiArICJwbGVhc2UgdXNlIHRoZSBnZXREYXRhLW1ldGhvZCBpbnN0ZWFkLiIpOwogICAgfQogICAgY29uc3QgewogICAgICBtYXAsCiAgICAgIHRyYW5zZmVyCiAgICB9ID0gdGhpcy5hbm5vdGF0aW9uU3RvcmFnZS5zZXJpYWxpemFibGU7CiAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIlNhdmVEb2N1bWVudCIsIHsKICAgICAgaXNQdXJlWGZhOiAhIXRoaXMuX2h0bWxGb3JYZmEsCiAgICAgIG51bVBhZ2VzOiB0aGlzLl9udW1QYWdlcywKICAgICAgYW5ub3RhdGlvblN0b3JhZ2U6IG1hcCwKICAgICAgZmlsZW5hbWU6IHRoaXMuX2Z1bGxSZWFkZXI/LmZpbGVuYW1lID8/IG51bGwKICAgIH0sIHRyYW5zZmVyKS5maW5hbGx5KCgpID0+IHsKICAgICAgdGhpcy5hbm5vdGF0aW9uU3RvcmFnZS5yZXNldE1vZGlmaWVkKCk7CiAgICB9KTsKICB9CiAgZ2V0UGFnZShwYWdlTnVtYmVyKSB7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIocGFnZU51bWJlcikgfHwgcGFnZU51bWJlciA8PSAwIHx8IHBhZ2VOdW1iZXIgPiB0aGlzLl9udW1QYWdlcykgewogICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCJJbnZhbGlkIHBhZ2UgcmVxdWVzdC4iKSk7CiAgICB9CiAgICBjb25zdCBwYWdlSW5kZXggPSBwYWdlTnVtYmVyIC0gMSwKICAgICAgY2FjaGVkUHJvbWlzZSA9IHRoaXMuI3BhZ2VQcm9taXNlcy5nZXQocGFnZUluZGV4KTsKICAgIGlmIChjYWNoZWRQcm9taXNlKSB7CiAgICAgIHJldHVybiBjYWNoZWRQcm9taXNlOwogICAgfQogICAgY29uc3QgcHJvbWlzZSA9IHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRQYWdlIiwgewogICAgICBwYWdlSW5kZXgKICAgIH0pLnRoZW4ocGFnZUluZm8gPT4gewogICAgICBpZiAodGhpcy5kZXN0cm95ZWQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRyYW5zcG9ydCBkZXN0cm95ZWQiKTsKICAgICAgfQogICAgICBpZiAocGFnZUluZm8ucmVmU3RyKSB7CiAgICAgICAgdGhpcy4jcGFnZVJlZkNhY2hlLnNldChwYWdlSW5mby5yZWZTdHIsIHBhZ2VOdW1iZXIpOwogICAgICB9CiAgICAgIGNvbnN0IHBhZ2UgPSBuZXcgUERGUGFnZVByb3h5KHBhZ2VJbmRleCwgcGFnZUluZm8sIHRoaXMsIHRoaXMuX3BhcmFtcy5wZGZCdWcpOwogICAgICB0aGlzLiNwYWdlQ2FjaGUuc2V0KHBhZ2VJbmRleCwgcGFnZSk7CiAgICAgIHJldHVybiBwYWdlOwogICAgfSk7CiAgICB0aGlzLiNwYWdlUHJvbWlzZXMuc2V0KHBhZ2VJbmRleCwgcHJvbWlzZSk7CiAgICByZXR1cm4gcHJvbWlzZTsKICB9CiAgZ2V0UGFnZUluZGV4KHJlZikgewogICAgaWYgKCFpc1JlZlByb3h5KHJlZikpIHsKICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcigiSW52YWxpZCBwYWdlSW5kZXggcmVxdWVzdC4iKSk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldFBhZ2VJbmRleCIsIHsKICAgICAgbnVtOiByZWYubnVtLAogICAgICBnZW46IHJlZi5nZW4KICAgIH0pOwogIH0KICBnZXRBbm5vdGF0aW9ucyhwYWdlSW5kZXgsIGludGVudCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRBbm5vdGF0aW9ucyIsIHsKICAgICAgcGFnZUluZGV4LAogICAgICBpbnRlbnQKICAgIH0pOwogIH0KICBnZXRGaWVsZE9iamVjdHMoKSB7CiAgICByZXR1cm4gdGhpcy4jY2FjaGVTaW1wbGVNZXRob2QoIkdldEZpZWxkT2JqZWN0cyIpOwogIH0KICBoYXNKU0FjdGlvbnMoKSB7CiAgICByZXR1cm4gdGhpcy4jY2FjaGVTaW1wbGVNZXRob2QoIkhhc0pTQWN0aW9ucyIpOwogIH0KICBnZXRDYWxjdWxhdGlvbk9yZGVySWRzKCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRDYWxjdWxhdGlvbk9yZGVySWRzIiwgbnVsbCk7CiAgfQogIGdldERlc3RpbmF0aW9ucygpIHsKICAgIHJldHVybiB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiR2V0RGVzdGluYXRpb25zIiwgbnVsbCk7CiAgfQogIGdldERlc3RpbmF0aW9uKGlkKSB7CiAgICBpZiAodHlwZW9mIGlkICE9PSAic3RyaW5nIikgewogICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCJJbnZhbGlkIGRlc3RpbmF0aW9uIHJlcXVlc3QuIikpOwogICAgfQogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXREZXN0aW5hdGlvbiIsIHsKICAgICAgaWQKICAgIH0pOwogIH0KICBnZXRQYWdlTGFiZWxzKCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRQYWdlTGFiZWxzIiwgbnVsbCk7CiAgfQogIGdldFBhZ2VMYXlvdXQoKSB7CiAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldFBhZ2VMYXlvdXQiLCBudWxsKTsKICB9CiAgZ2V0UGFnZU1vZGUoKSB7CiAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkdldFBhZ2VNb2RlIiwgbnVsbCk7CiAgfQogIGdldFZpZXdlclByZWZlcmVuY2VzKCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRWaWV3ZXJQcmVmZXJlbmNlcyIsIG51bGwpOwogIH0KICBnZXRPcGVuQWN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRPcGVuQWN0aW9uIiwgbnVsbCk7CiAgfQogIGdldEF0dGFjaG1lbnRzKCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRBdHRhY2htZW50cyIsIG51bGwpOwogIH0KICBnZXREb2NKU0FjdGlvbnMoKSB7CiAgICByZXR1cm4gdGhpcy4jY2FjaGVTaW1wbGVNZXRob2QoIkdldERvY0pTQWN0aW9ucyIpOwogIH0KICBnZXRQYWdlSlNBY3Rpb25zKHBhZ2VJbmRleCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRQYWdlSlNBY3Rpb25zIiwgewogICAgICBwYWdlSW5kZXgKICAgIH0pOwogIH0KICBnZXRTdHJ1Y3RUcmVlKHBhZ2VJbmRleCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRTdHJ1Y3RUcmVlIiwgewogICAgICBwYWdlSW5kZXgKICAgIH0pOwogIH0KICBnZXRPdXRsaW5lKCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRPdXRsaW5lIiwgbnVsbCk7CiAgfQogIGdldE9wdGlvbmFsQ29udGVudENvbmZpZyhyZW5kZXJpbmdJbnRlbnQpIHsKICAgIHJldHVybiB0aGlzLiNjYWNoZVNpbXBsZU1ldGhvZCgiR2V0T3B0aW9uYWxDb250ZW50Q29uZmlnIikudGhlbihkYXRhID0+IG5ldyBPcHRpb25hbENvbnRlbnRDb25maWcoZGF0YSwgcmVuZGVyaW5nSW50ZW50KSk7CiAgfQogIGdldFBlcm1pc3Npb25zKCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRQZXJtaXNzaW9ucyIsIG51bGwpOwogIH0KICBnZXRNZXRhZGF0YSgpIHsKICAgIGNvbnN0IG5hbWUgPSAiR2V0TWV0YWRhdGEiLAogICAgICBjYWNoZWRQcm9taXNlID0gdGhpcy4jbWV0aG9kUHJvbWlzZXMuZ2V0KG5hbWUpOwogICAgaWYgKGNhY2hlZFByb21pc2UpIHsKICAgICAgcmV0dXJuIGNhY2hlZFByb21pc2U7CiAgICB9CiAgICBjb25zdCBwcm9taXNlID0gdGhpcy5tZXNzYWdlSGFuZGxlci5zZW5kV2l0aFByb21pc2UobmFtZSwgbnVsbCkudGhlbihyZXN1bHRzID0+ICh7CiAgICAgIGluZm86IHJlc3VsdHNbMF0sCiAgICAgIG1ldGFkYXRhOiByZXN1bHRzWzFdID8gbmV3IE1ldGFkYXRhKHJlc3VsdHNbMV0pIDogbnVsbCwKICAgICAgY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWU6IHRoaXMuX2Z1bGxSZWFkZXI/LmZpbGVuYW1lID8/IG51bGwsCiAgICAgIGNvbnRlbnRMZW5ndGg6IHRoaXMuX2Z1bGxSZWFkZXI/LmNvbnRlbnRMZW5ndGggPz8gbnVsbAogICAgfSkpOwogICAgdGhpcy4jbWV0aG9kUHJvbWlzZXMuc2V0KG5hbWUsIHByb21pc2UpOwogICAgcmV0dXJuIHByb21pc2U7CiAgfQogIGdldE1hcmtJbmZvKCkgewogICAgcmV0dXJuIHRoaXMubWVzc2FnZUhhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJHZXRNYXJrSW5mbyIsIG51bGwpOwogIH0KICBhc3luYyBzdGFydENsZWFudXAoa2VlcExvYWRlZEZvbnRzID0gZmFsc2UpIHsKICAgIGlmICh0aGlzLmRlc3Ryb3llZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBhd2FpdCB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiQ2xlYW51cCIsIG51bGwpOwogICAgZm9yIChjb25zdCBwYWdlIG9mIHRoaXMuI3BhZ2VDYWNoZS52YWx1ZXMoKSkgewogICAgICBjb25zdCBjbGVhbnVwU3VjY2Vzc2Z1bCA9IHBhZ2UuY2xlYW51cCgpOwogICAgICBpZiAoIWNsZWFudXBTdWNjZXNzZnVsKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBzdGFydENsZWFudXA6IFBhZ2UgJHtwYWdlLnBhZ2VOdW1iZXJ9IGlzIGN1cnJlbnRseSByZW5kZXJpbmcuYCk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuY29tbW9uT2Jqcy5jbGVhcigpOwogICAgaWYgKCFrZWVwTG9hZGVkRm9udHMpIHsKICAgICAgdGhpcy5mb250TG9hZGVyLmNsZWFyKCk7CiAgICB9CiAgICB0aGlzLiNtZXRob2RQcm9taXNlcy5jbGVhcigpOwogICAgdGhpcy5maWx0ZXJGYWN0b3J5LmRlc3Ryb3kodHJ1ZSk7CiAgICBUZXh0TGF5ZXIuY2xlYW51cCgpOwogIH0KICBjYWNoZWRQYWdlTnVtYmVyKHJlZikgewogICAgaWYgKCFpc1JlZlByb3h5KHJlZikpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCByZWZTdHIgPSByZWYuZ2VuID09PSAwID8gYCR7cmVmLm51bX1SYCA6IGAke3JlZi5udW19UiR7cmVmLmdlbn1gOwogICAgcmV0dXJuIHRoaXMuI3BhZ2VSZWZDYWNoZS5nZXQocmVmU3RyKSA/PyBudWxsOwogIH0KfQpjbGFzcyBSZW5kZXJUYXNrIHsKICAjaW50ZXJuYWxSZW5kZXJUYXNrID0gbnVsbDsKICBvbkNvbnRpbnVlID0gbnVsbDsKICBvbkVycm9yID0gbnVsbDsKICBjb25zdHJ1Y3RvcihpbnRlcm5hbFJlbmRlclRhc2spIHsKICAgIHRoaXMuI2ludGVybmFsUmVuZGVyVGFzayA9IGludGVybmFsUmVuZGVyVGFzazsKICB9CiAgZ2V0IHByb21pc2UoKSB7CiAgICByZXR1cm4gdGhpcy4jaW50ZXJuYWxSZW5kZXJUYXNrLmNhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgY2FuY2VsKGV4dHJhRGVsYXkgPSAwKSB7CiAgICB0aGlzLiNpbnRlcm5hbFJlbmRlclRhc2suY2FuY2VsKG51bGwsIGV4dHJhRGVsYXkpOwogIH0KICBnZXQgc2VwYXJhdGVBbm5vdHMoKSB7CiAgICBjb25zdCB7CiAgICAgIHNlcGFyYXRlQW5ub3RzCiAgICB9ID0gdGhpcy4jaW50ZXJuYWxSZW5kZXJUYXNrLm9wZXJhdG9yTGlzdDsKICAgIGlmICghc2VwYXJhdGVBbm5vdHMpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgewogICAgICBhbm5vdGF0aW9uQ2FudmFzTWFwCiAgICB9ID0gdGhpcy4jaW50ZXJuYWxSZW5kZXJUYXNrOwogICAgcmV0dXJuIHNlcGFyYXRlQW5ub3RzLmZvcm0gfHwgc2VwYXJhdGVBbm5vdHMuY2FudmFzICYmIGFubm90YXRpb25DYW52YXNNYXA/LnNpemUgPiAwOwogIH0KfQpjbGFzcyBJbnRlcm5hbFJlbmRlclRhc2sgewogICNyQUYgPSBudWxsOwogIHN0YXRpYyAjY2FudmFzSW5Vc2UgPSBuZXcgV2Vha1NldCgpOwogIGNvbnN0cnVjdG9yKHsKICAgIGNhbGxiYWNrLAogICAgcGFyYW1zLAogICAgb2JqcywKICAgIGNvbW1vbk9ianMsCiAgICBhbm5vdGF0aW9uQ2FudmFzTWFwLAogICAgb3BlcmF0b3JMaXN0LAogICAgcGFnZUluZGV4LAogICAgY2FudmFzRmFjdG9yeSwKICAgIGZpbHRlckZhY3RvcnksCiAgICB1c2VSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBmYWxzZSwKICAgIHBkZkJ1ZyA9IGZhbHNlLAogICAgcGFnZUNvbG9ycyA9IG51bGwKICB9KSB7CiAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICB0aGlzLnBhcmFtcyA9IHBhcmFtczsKICAgIHRoaXMub2JqcyA9IG9ianM7CiAgICB0aGlzLmNvbW1vbk9ianMgPSBjb21tb25PYmpzOwogICAgdGhpcy5hbm5vdGF0aW9uQ2FudmFzTWFwID0gYW5ub3RhdGlvbkNhbnZhc01hcDsKICAgIHRoaXMub3BlcmF0b3JMaXN0SWR4ID0gbnVsbDsKICAgIHRoaXMub3BlcmF0b3JMaXN0ID0gb3BlcmF0b3JMaXN0OwogICAgdGhpcy5fcGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgdGhpcy5jYW52YXNGYWN0b3J5ID0gY2FudmFzRmFjdG9yeTsKICAgIHRoaXMuZmlsdGVyRmFjdG9yeSA9IGZpbHRlckZhY3Rvcnk7CiAgICB0aGlzLl9wZGZCdWcgPSBwZGZCdWc7CiAgICB0aGlzLnBhZ2VDb2xvcnMgPSBwYWdlQ29sb3JzOwogICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7CiAgICB0aGlzLmdyYXBoaWNzUmVhZHlDYWxsYmFjayA9IG51bGw7CiAgICB0aGlzLmdyYXBoaWNzUmVhZHkgPSBmYWxzZTsKICAgIHRoaXMuX3VzZVJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHVzZVJlcXVlc3RBbmltYXRpb25GcmFtZSA9PT0gdHJ1ZSAmJiB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIjsKICAgIHRoaXMuY2FuY2VsbGVkID0gZmFsc2U7CiAgICB0aGlzLmNhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRoaXMudGFzayA9IG5ldyBSZW5kZXJUYXNrKHRoaXMpOwogICAgdGhpcy5fY2FuY2VsQm91bmQgPSB0aGlzLmNhbmNlbC5iaW5kKHRoaXMpOwogICAgdGhpcy5fY29udGludWVCb3VuZCA9IHRoaXMuX2NvbnRpbnVlLmJpbmQodGhpcyk7CiAgICB0aGlzLl9zY2hlZHVsZU5leHRCb3VuZCA9IHRoaXMuX3NjaGVkdWxlTmV4dC5iaW5kKHRoaXMpOwogICAgdGhpcy5fbmV4dEJvdW5kID0gdGhpcy5fbmV4dC5iaW5kKHRoaXMpOwogICAgdGhpcy5fY2FudmFzID0gcGFyYW1zLmNhbnZhc0NvbnRleHQuY2FudmFzOwogIH0KICBnZXQgY29tcGxldGVkKCkgewogICAgcmV0dXJuIHRoaXMuY2FwYWJpbGl0eS5wcm9taXNlLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTsKICB9CiAgaW5pdGlhbGl6ZUdyYXBoaWNzKHsKICAgIHRyYW5zcGFyZW5jeSA9IGZhbHNlLAogICAgb3B0aW9uYWxDb250ZW50Q29uZmlnCiAgfSkgewogICAgaWYgKHRoaXMuY2FuY2VsbGVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9jYW52YXMpIHsKICAgICAgaWYgKEludGVybmFsUmVuZGVyVGFzay4jY2FudmFzSW5Vc2UuaGFzKHRoaXMuX2NhbnZhcykpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCB1c2UgdGhlIHNhbWUgY2FudmFzIGR1cmluZyBtdWx0aXBsZSByZW5kZXIoKSBvcGVyYXRpb25zLiAiICsgIlVzZSBkaWZmZXJlbnQgY2FudmFzIG9yIGVuc3VyZSBwcmV2aW91cyBvcGVyYXRpb25zIHdlcmUgIiArICJjYW5jZWxsZWQgb3IgY29tcGxldGVkLiIpOwogICAgICB9CiAgICAgIEludGVybmFsUmVuZGVyVGFzay4jY2FudmFzSW5Vc2UuYWRkKHRoaXMuX2NhbnZhcyk7CiAgICB9CiAgICBpZiAodGhpcy5fcGRmQnVnICYmIGdsb2JhbFRoaXMuU3RlcHBlck1hbmFnZXI/LmVuYWJsZWQpIHsKICAgICAgdGhpcy5zdGVwcGVyID0gZ2xvYmFsVGhpcy5TdGVwcGVyTWFuYWdlci5jcmVhdGUodGhpcy5fcGFnZUluZGV4KTsKICAgICAgdGhpcy5zdGVwcGVyLmluaXQodGhpcy5vcGVyYXRvckxpc3QpOwogICAgICB0aGlzLnN0ZXBwZXIubmV4dEJyZWFrUG9pbnQgPSB0aGlzLnN0ZXBwZXIuZ2V0TmV4dEJyZWFrUG9pbnQoKTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgY2FudmFzQ29udGV4dCwKICAgICAgdmlld3BvcnQsCiAgICAgIHRyYW5zZm9ybSwKICAgICAgYmFja2dyb3VuZAogICAgfSA9IHRoaXMucGFyYW1zOwogICAgdGhpcy5nZnggPSBuZXcgQ2FudmFzR3JhcGhpY3MoY2FudmFzQ29udGV4dCwgdGhpcy5jb21tb25PYmpzLCB0aGlzLm9ianMsIHRoaXMuY2FudmFzRmFjdG9yeSwgdGhpcy5maWx0ZXJGYWN0b3J5LCB7CiAgICAgIG9wdGlvbmFsQ29udGVudENvbmZpZwogICAgfSwgdGhpcy5hbm5vdGF0aW9uQ2FudmFzTWFwLCB0aGlzLnBhZ2VDb2xvcnMpOwogICAgdGhpcy5nZnguYmVnaW5EcmF3aW5nKHsKICAgICAgdHJhbnNmb3JtLAogICAgICB2aWV3cG9ydCwKICAgICAgdHJhbnNwYXJlbmN5LAogICAgICBiYWNrZ3JvdW5kCiAgICB9KTsKICAgIHRoaXMub3BlcmF0b3JMaXN0SWR4ID0gMDsKICAgIHRoaXMuZ3JhcGhpY3NSZWFkeSA9IHRydWU7CiAgICB0aGlzLmdyYXBoaWNzUmVhZHlDYWxsYmFjaz8uKCk7CiAgfQogIGNhbmNlbChlcnJvciA9IG51bGwsIGV4dHJhRGVsYXkgPSAwKSB7CiAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTsKICAgIHRoaXMuY2FuY2VsbGVkID0gdHJ1ZTsKICAgIHRoaXMuZ2Z4Py5lbmREcmF3aW5nKCk7CiAgICBpZiAodGhpcy4jckFGKSB7CiAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLiNyQUYpOwogICAgICB0aGlzLiNyQUYgPSBudWxsOwogICAgfQogICAgSW50ZXJuYWxSZW5kZXJUYXNrLiNjYW52YXNJblVzZS5kZWxldGUodGhpcy5fY2FudmFzKTsKICAgIGVycm9yIHx8PSBuZXcgUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uKGBSZW5kZXJpbmcgY2FuY2VsbGVkLCBwYWdlICR7dGhpcy5fcGFnZUluZGV4ICsgMX1gLCBleHRyYURlbGF5KTsKICAgIHRoaXMuY2FsbGJhY2soZXJyb3IpOwogICAgdGhpcy50YXNrLm9uRXJyb3I/LihlcnJvcik7CiAgfQogIG9wZXJhdG9yTGlzdENoYW5nZWQoKSB7CiAgICBpZiAoIXRoaXMuZ3JhcGhpY3NSZWFkeSkgewogICAgICB0aGlzLmdyYXBoaWNzUmVhZHlDYWxsYmFjayB8fD0gdGhpcy5fY29udGludWVCb3VuZDsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5zdGVwcGVyPy51cGRhdGVPcGVyYXRvckxpc3QodGhpcy5vcGVyYXRvckxpc3QpOwogICAgaWYgKHRoaXMucnVubmluZykgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9jb250aW51ZSgpOwogIH0KICBfY29udGludWUoKSB7CiAgICB0aGlzLnJ1bm5pbmcgPSB0cnVlOwogICAgaWYgKHRoaXMuY2FuY2VsbGVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLnRhc2sub25Db250aW51ZSkgewogICAgICB0aGlzLnRhc2sub25Db250aW51ZSh0aGlzLl9zY2hlZHVsZU5leHRCb3VuZCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9zY2hlZHVsZU5leHQoKTsKICAgIH0KICB9CiAgX3NjaGVkdWxlTmV4dCgpIHsKICAgIGlmICh0aGlzLl91c2VSZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHsKICAgICAgdGhpcy4jckFGID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7CiAgICAgICAgdGhpcy4jckFGID0gbnVsbDsKICAgICAgICB0aGlzLl9uZXh0Qm91bmQoKS5jYXRjaCh0aGlzLl9jYW5jZWxCb3VuZCk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbih0aGlzLl9uZXh0Qm91bmQpLmNhdGNoKHRoaXMuX2NhbmNlbEJvdW5kKTsKICAgIH0KICB9CiAgYXN5bmMgX25leHQoKSB7CiAgICBpZiAodGhpcy5jYW5jZWxsZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5vcGVyYXRvckxpc3RJZHggPSB0aGlzLmdmeC5leGVjdXRlT3BlcmF0b3JMaXN0KHRoaXMub3BlcmF0b3JMaXN0LCB0aGlzLm9wZXJhdG9yTGlzdElkeCwgdGhpcy5fY29udGludWVCb3VuZCwgdGhpcy5zdGVwcGVyKTsKICAgIGlmICh0aGlzLm9wZXJhdG9yTGlzdElkeCA9PT0gdGhpcy5vcGVyYXRvckxpc3QuYXJnc0FycmF5Lmxlbmd0aCkgewogICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTsKICAgICAgaWYgKHRoaXMub3BlcmF0b3JMaXN0Lmxhc3RDaHVuaykgewogICAgICAgIHRoaXMuZ2Z4LmVuZERyYXdpbmcoKTsKICAgICAgICBJbnRlcm5hbFJlbmRlclRhc2suI2NhbnZhc0luVXNlLmRlbGV0ZSh0aGlzLl9jYW52YXMpOwogICAgICAgIHRoaXMuY2FsbGJhY2soKTsKICAgICAgfQogICAgfQogIH0KfQpjb25zdCB2ZXJzaW9uID0gIjUuMy4zMSI7CmNvbnN0IGJ1aWxkID0gIjQ3YWQ4MjBkOSI7Cgo7Ly8gLi9zcmMvc2hhcmVkL3NjcmlwdGluZ191dGlscy5qcwpmdW5jdGlvbiBtYWtlQ29sb3JDb21wKG4pIHsKICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBuKSkgKiAyNTUpLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpOwp9CmZ1bmN0aW9uIHNjYWxlQW5kQ2xhbXAoeCkgewogIHJldHVybiBNYXRoLm1heCgwLCBNYXRoLm1pbigyNTUsIDI1NSAqIHgpKTsKfQpjbGFzcyBDb2xvckNvbnZlcnRlcnMgewogIHN0YXRpYyBDTVlLX0coW2MsIHksIG0sIGtdKSB7CiAgICByZXR1cm4gWyJHIiwgMSAtIE1hdGgubWluKDEsIDAuMyAqIGMgKyAwLjU5ICogbSArIDAuMTEgKiB5ICsgayldOwogIH0KICBzdGF0aWMgR19DTVlLKFtnXSkgewogICAgcmV0dXJuIFsiQ01ZSyIsIDAsIDAsIDAsIDEgLSBnXTsKICB9CiAgc3RhdGljIEdfUkdCKFtnXSkgewogICAgcmV0dXJuIFsiUkdCIiwgZywgZywgZ107CiAgfQogIHN0YXRpYyBHX3JnYihbZ10pIHsKICAgIGcgPSBzY2FsZUFuZENsYW1wKGcpOwogICAgcmV0dXJuIFtnLCBnLCBnXTsKICB9CiAgc3RhdGljIEdfSFRNTChbZ10pIHsKICAgIGNvbnN0IEcgPSBtYWtlQ29sb3JDb21wKGcpOwogICAgcmV0dXJuIGAjJHtHfSR7R30ke0d9YDsKICB9CiAgc3RhdGljIFJHQl9HKFtyLCBnLCBiXSkgewogICAgcmV0dXJuIFsiRyIsIDAuMyAqIHIgKyAwLjU5ICogZyArIDAuMTEgKiBiXTsKICB9CiAgc3RhdGljIFJHQl9yZ2IoY29sb3IpIHsKICAgIHJldHVybiBjb2xvci5tYXAoc2NhbGVBbmRDbGFtcCk7CiAgfQogIHN0YXRpYyBSR0JfSFRNTChjb2xvcikgewogICAgcmV0dXJuIGAjJHtjb2xvci5tYXAobWFrZUNvbG9yQ29tcCkuam9pbigiIil9YDsKICB9CiAgc3RhdGljIFRfSFRNTCgpIHsKICAgIHJldHVybiAiIzAwMDAwMDAwIjsKICB9CiAgc3RhdGljIFRfcmdiKCkgewogICAgcmV0dXJuIFtudWxsXTsKICB9CiAgc3RhdGljIENNWUtfUkdCKFtjLCB5LCBtLCBrXSkgewogICAgcmV0dXJuIFsiUkdCIiwgMSAtIE1hdGgubWluKDEsIGMgKyBrKSwgMSAtIE1hdGgubWluKDEsIG0gKyBrKSwgMSAtIE1hdGgubWluKDEsIHkgKyBrKV07CiAgfQogIHN0YXRpYyBDTVlLX3JnYihbYywgeSwgbSwga10pIHsKICAgIHJldHVybiBbc2NhbGVBbmRDbGFtcCgxIC0gTWF0aC5taW4oMSwgYyArIGspKSwgc2NhbGVBbmRDbGFtcCgxIC0gTWF0aC5taW4oMSwgbSArIGspKSwgc2NhbGVBbmRDbGFtcCgxIC0gTWF0aC5taW4oMSwgeSArIGspKV07CiAgfQogIHN0YXRpYyBDTVlLX0hUTUwoY29tcG9uZW50cykgewogICAgY29uc3QgcmdiID0gdGhpcy5DTVlLX1JHQihjb21wb25lbnRzKS5zbGljZSgxKTsKICAgIHJldHVybiB0aGlzLlJHQl9IVE1MKHJnYik7CiAgfQogIHN0YXRpYyBSR0JfQ01ZSyhbciwgZywgYl0pIHsKICAgIGNvbnN0IGMgPSAxIC0gcjsKICAgIGNvbnN0IG0gPSAxIC0gZzsKICAgIGNvbnN0IHkgPSAxIC0gYjsKICAgIGNvbnN0IGsgPSBNYXRoLm1pbihjLCBtLCB5KTsKICAgIHJldHVybiBbIkNNWUsiLCBjLCBtLCB5LCBrXTsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L3N2Z19mYWN0b3J5LmpzCgoKY2xhc3MgQmFzZVNWR0ZhY3RvcnkgewogIGNyZWF0ZSh3aWR0aCwgaGVpZ2h0LCBza2lwRGltZW5zaW9ucyA9IGZhbHNlKSB7CiAgICBpZiAod2lkdGggPD0gMCB8fCBoZWlnaHQgPD0gMCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgU1ZHIGRpbWVuc2lvbnMiKTsKICAgIH0KICAgIGNvbnN0IHN2ZyA9IHRoaXMuX2NyZWF0ZVNWRygic3ZnOnN2ZyIpOwogICAgc3ZnLnNldEF0dHJpYnV0ZSgidmVyc2lvbiIsICIxLjEiKTsKICAgIGlmICghc2tpcERpbWVuc2lvbnMpIHsKICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgid2lkdGgiLCBgJHt3aWR0aH1weGApOwogICAgICBzdmcuc2V0QXR0cmlidXRlKCJoZWlnaHQiLCBgJHtoZWlnaHR9cHhgKTsKICAgIH0KICAgIHN2Zy5zZXRBdHRyaWJ1dGUoInByZXNlcnZlQXNwZWN0UmF0aW8iLCAibm9uZSIpOwogICAgc3ZnLnNldEF0dHJpYnV0ZSgidmlld0JveCIsIGAwIDAgJHt3aWR0aH0gJHtoZWlnaHR9YCk7CiAgICByZXR1cm4gc3ZnOwogIH0KICBjcmVhdGVFbGVtZW50KHR5cGUpIHsKICAgIGlmICh0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIFNWRyBlbGVtZW50IHR5cGUiKTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9jcmVhdGVTVkcodHlwZSk7CiAgfQogIF9jcmVhdGVTVkcodHlwZSkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgX2NyZWF0ZVNWR2AgY2FsbGVkLiIpOwogIH0KfQpjbGFzcyBET01TVkdGYWN0b3J5IGV4dGVuZHMgQmFzZVNWR0ZhY3RvcnkgewogIF9jcmVhdGVTVkcodHlwZSkgewogICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhTVkdfTlMsIHR5cGUpOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkveGZhX2xheWVyLmpzCgpjbGFzcyBYZmFMYXllciB7CiAgc3RhdGljIHNldHVwU3RvcmFnZShodG1sLCBpZCwgZWxlbWVudCwgc3RvcmFnZSwgaW50ZW50KSB7CiAgICBjb25zdCBzdG9yZWREYXRhID0gc3RvcmFnZS5nZXRWYWx1ZShpZCwgewogICAgICB2YWx1ZTogbnVsbAogICAgfSk7CiAgICBzd2l0Y2ggKGVsZW1lbnQubmFtZSkgewogICAgICBjYXNlICJ0ZXh0YXJlYSI6CiAgICAgICAgaWYgKHN0b3JlZERhdGEudmFsdWUgIT09IG51bGwpIHsKICAgICAgICAgIGh0bWwudGV4dENvbnRlbnQgPSBzdG9yZWREYXRhLnZhbHVlOwogICAgICAgIH0KICAgICAgICBpZiAoaW50ZW50ID09PSAicHJpbnQiKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaHRtbC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIGV2ZW50ID0+IHsKICAgICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgICAgdmFsdWU6IGV2ZW50LnRhcmdldC52YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImlucHV0IjoKICAgICAgICBpZiAoZWxlbWVudC5hdHRyaWJ1dGVzLnR5cGUgPT09ICJyYWRpbyIgfHwgZWxlbWVudC5hdHRyaWJ1dGVzLnR5cGUgPT09ICJjaGVja2JveCIpIHsKICAgICAgICAgIGlmIChzdG9yZWREYXRhLnZhbHVlID09PSBlbGVtZW50LmF0dHJpYnV0ZXMueGZhT24pIHsKICAgICAgICAgICAgaHRtbC5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgIH0gZWxzZSBpZiAoc3RvcmVkRGF0YS52YWx1ZSA9PT0gZWxlbWVudC5hdHRyaWJ1dGVzLnhmYU9mZikgewogICAgICAgICAgICBodG1sLnJlbW92ZUF0dHJpYnV0ZSgiY2hlY2tlZCIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGludGVudCA9PT0gInByaW50IikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGh0bWwuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZXZlbnQgPT4gewogICAgICAgICAgICBzdG9yYWdlLnNldFZhbHVlKGlkLCB7CiAgICAgICAgICAgICAgdmFsdWU6IGV2ZW50LnRhcmdldC5jaGVja2VkID8gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgieGZhT24iKSA6IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoInhmYU9mZiIpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChzdG9yZWREYXRhLnZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgICAgIGh0bWwuc2V0QXR0cmlidXRlKCJ2YWx1ZSIsIHN0b3JlZERhdGEudmFsdWUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGludGVudCA9PT0gInByaW50IikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGh0bWwuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCBldmVudCA9PiB7CiAgICAgICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgICAgICB2YWx1ZTogZXZlbnQudGFyZ2V0LnZhbHVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJzZWxlY3QiOgogICAgICAgIGlmIChzdG9yZWREYXRhLnZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgICBodG1sLnNldEF0dHJpYnV0ZSgidmFsdWUiLCBzdG9yZWREYXRhLnZhbHVlKTsKICAgICAgICAgIGZvciAoY29uc3Qgb3B0aW9uIG9mIGVsZW1lbnQuY2hpbGRyZW4pIHsKICAgICAgICAgICAgaWYgKG9wdGlvbi5hdHRyaWJ1dGVzLnZhbHVlID09PSBzdG9yZWREYXRhLnZhbHVlKSB7CiAgICAgICAgICAgICAgb3B0aW9uLmF0dHJpYnV0ZXMuc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbi5hdHRyaWJ1dGVzLmhhc093blByb3BlcnR5KCJzZWxlY3RlZCIpKSB7CiAgICAgICAgICAgICAgZGVsZXRlIG9wdGlvbi5hdHRyaWJ1dGVzLnNlbGVjdGVkOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGh0bWwuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCBldmVudCA9PiB7CiAgICAgICAgICBjb25zdCBvcHRpb25zID0gZXZlbnQudGFyZ2V0Lm9wdGlvbnM7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IG9wdGlvbnMuc2VsZWN0ZWRJbmRleCA9PT0gLTEgPyAiIiA6IG9wdGlvbnNbb3B0aW9ucy5zZWxlY3RlZEluZGV4XS52YWx1ZTsKICAgICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgICAgdmFsdWUKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KICBzdGF0aWMgc2V0QXR0cmlidXRlcyh7CiAgICBodG1sLAogICAgZWxlbWVudCwKICAgIHN0b3JhZ2UgPSBudWxsLAogICAgaW50ZW50LAogICAgbGlua1NlcnZpY2UKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIGF0dHJpYnV0ZXMKICAgIH0gPSBlbGVtZW50OwogICAgY29uc3QgaXNIVE1MQW5jaG9yRWxlbWVudCA9IGh0bWwgaW5zdGFuY2VvZiBIVE1MQW5jaG9yRWxlbWVudDsKICAgIGlmIChhdHRyaWJ1dGVzLnR5cGUgPT09ICJyYWRpbyIpIHsKICAgICAgYXR0cmlidXRlcy5uYW1lID0gYCR7YXR0cmlidXRlcy5uYW1lfS0ke2ludGVudH1gOwogICAgfQogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoYXR0cmlidXRlcykpIHsKICAgICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgIGNhc2UgImNsYXNzIjoKICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGgpIHsKICAgICAgICAgICAgaHRtbC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZS5qb2luKCIgIikpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGF0YUlkIjoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImlkIjoKICAgICAgICAgIGh0bWwuc2V0QXR0cmlidXRlKCJkYXRhLWVsZW1lbnQtaWQiLCB2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzdHlsZSI6CiAgICAgICAgICBPYmplY3QuYXNzaWduKGh0bWwuc3R5bGUsIHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInRleHRDb250ZW50IjoKICAgICAgICAgIGh0bWwudGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpZiAoIWlzSFRNTEFuY2hvckVsZW1lbnQgfHwga2V5ICE9PSAiaHJlZiIgJiYga2V5ICE9PSAibmV3V2luZG93IikgewogICAgICAgICAgICBodG1sLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGlzSFRNTEFuY2hvckVsZW1lbnQpIHsKICAgICAgbGlua1NlcnZpY2UuYWRkTGlua0F0dHJpYnV0ZXMoaHRtbCwgYXR0cmlidXRlcy5ocmVmLCBhdHRyaWJ1dGVzLm5ld1dpbmRvdyk7CiAgICB9CiAgICBpZiAoc3RvcmFnZSAmJiBhdHRyaWJ1dGVzLmRhdGFJZCkgewogICAgICB0aGlzLnNldHVwU3RvcmFnZShodG1sLCBhdHRyaWJ1dGVzLmRhdGFJZCwgZWxlbWVudCwgc3RvcmFnZSk7CiAgICB9CiAgfQogIHN0YXRpYyByZW5kZXIocGFyYW1ldGVycykgewogICAgY29uc3Qgc3RvcmFnZSA9IHBhcmFtZXRlcnMuYW5ub3RhdGlvblN0b3JhZ2U7CiAgICBjb25zdCBsaW5rU2VydmljZSA9IHBhcmFtZXRlcnMubGlua1NlcnZpY2U7CiAgICBjb25zdCByb290ID0gcGFyYW1ldGVycy54ZmFIdG1sOwogICAgY29uc3QgaW50ZW50ID0gcGFyYW1ldGVycy5pbnRlbnQgfHwgImRpc3BsYXkiOwogICAgY29uc3Qgcm9vdEh0bWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHJvb3QubmFtZSk7CiAgICBpZiAocm9vdC5hdHRyaWJ1dGVzKSB7CiAgICAgIHRoaXMuc2V0QXR0cmlidXRlcyh7CiAgICAgICAgaHRtbDogcm9vdEh0bWwsCiAgICAgICAgZWxlbWVudDogcm9vdCwKICAgICAgICBpbnRlbnQsCiAgICAgICAgbGlua1NlcnZpY2UKICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBpc05vdEZvclJpY2hUZXh0ID0gaW50ZW50ICE9PSAicmljaFRleHQiOwogICAgY29uc3Qgcm9vdERpdiA9IHBhcmFtZXRlcnMuZGl2OwogICAgcm9vdERpdi5hcHBlbmQocm9vdEh0bWwpOwogICAgaWYgKHBhcmFtZXRlcnMudmlld3BvcnQpIHsKICAgICAgY29uc3QgdHJhbnNmb3JtID0gYG1hdHJpeCgke3BhcmFtZXRlcnMudmlld3BvcnQudHJhbnNmb3JtLmpvaW4oIiwiKX0pYDsKICAgICAgcm9vdERpdi5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2Zvcm07CiAgICB9CiAgICBpZiAoaXNOb3RGb3JSaWNoVGV4dCkgewogICAgICByb290RGl2LnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAieGZhTGF5ZXIgeGZhRm9udCIpOwogICAgfQogICAgY29uc3QgdGV4dERpdnMgPSBbXTsKICAgIGlmIChyb290LmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgewogICAgICBpZiAocm9vdC52YWx1ZSkgewogICAgICAgIGNvbnN0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShyb290LnZhbHVlKTsKICAgICAgICByb290SHRtbC5hcHBlbmQobm9kZSk7CiAgICAgICAgaWYgKGlzTm90Rm9yUmljaFRleHQgJiYgWGZhVGV4dC5zaG91bGRCdWlsZFRleHQocm9vdC5uYW1lKSkgewogICAgICAgICAgdGV4dERpdnMucHVzaChub2RlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICB0ZXh0RGl2cwogICAgICB9OwogICAgfQogICAgY29uc3Qgc3RhY2sgPSBbW3Jvb3QsIC0xLCByb290SHRtbF1dOwogICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgW3BhcmVudCwgaSwgaHRtbF0gPSBzdGFjay5hdCgtMSk7CiAgICAgIGlmIChpICsgMSA9PT0gcGFyZW50LmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGNoaWxkID0gcGFyZW50LmNoaWxkcmVuWysrc3RhY2suYXQoLTEpWzFdXTsKICAgICAgaWYgKGNoaWxkID09PSBudWxsKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgewogICAgICAgIG5hbWUKICAgICAgfSA9IGNoaWxkOwogICAgICBpZiAobmFtZSA9PT0gIiN0ZXh0IikgewogICAgICAgIGNvbnN0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjaGlsZC52YWx1ZSk7CiAgICAgICAgdGV4dERpdnMucHVzaChub2RlKTsKICAgICAgICBodG1sLmFwcGVuZChub2RlKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBjaGlsZEh0bWwgPSBjaGlsZD8uYXR0cmlidXRlcz8ueG1sbnMgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoY2hpbGQuYXR0cmlidXRlcy54bWxucywgbmFtZSkgOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG5hbWUpOwogICAgICBodG1sLmFwcGVuZChjaGlsZEh0bWwpOwogICAgICBpZiAoY2hpbGQuYXR0cmlidXRlcykgewogICAgICAgIHRoaXMuc2V0QXR0cmlidXRlcyh7CiAgICAgICAgICBodG1sOiBjaGlsZEh0bWwsCiAgICAgICAgICBlbGVtZW50OiBjaGlsZCwKICAgICAgICAgIHN0b3JhZ2UsCiAgICAgICAgICBpbnRlbnQsCiAgICAgICAgICBsaW5rU2VydmljZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChjaGlsZC5jaGlsZHJlbj8ubGVuZ3RoID4gMCkgewogICAgICAgIHN0YWNrLnB1c2goW2NoaWxkLCAtMSwgY2hpbGRIdG1sXSk7CiAgICAgIH0gZWxzZSBpZiAoY2hpbGQudmFsdWUpIHsKICAgICAgICBjb25zdCBub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY2hpbGQudmFsdWUpOwogICAgICAgIGlmIChpc05vdEZvclJpY2hUZXh0ICYmIFhmYVRleHQuc2hvdWxkQnVpbGRUZXh0KG5hbWUpKSB7CiAgICAgICAgICB0ZXh0RGl2cy5wdXNoKG5vZGUpOwogICAgICAgIH0KICAgICAgICBjaGlsZEh0bWwuYXBwZW5kKG5vZGUpOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IGVsIG9mIHJvb3REaXYucXVlcnlTZWxlY3RvckFsbCgiLnhmYU5vbkludGVyYWN0aXZlIGlucHV0LCAueGZhTm9uSW50ZXJhY3RpdmUgdGV4dGFyZWEiKSkgewogICAgICBlbC5zZXRBdHRyaWJ1dGUoInJlYWRPbmx5IiwgdHJ1ZSk7CiAgICB9CiAgICByZXR1cm4gewogICAgICB0ZXh0RGl2cwogICAgfTsKICB9CiAgc3RhdGljIHVwZGF0ZShwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCB0cmFuc2Zvcm0gPSBgbWF0cml4KCR7cGFyYW1ldGVycy52aWV3cG9ydC50cmFuc2Zvcm0uam9pbigiLCIpfSlgOwogICAgcGFyYW1ldGVycy5kaXYuc3R5bGUudHJhbnNmb3JtID0gdHJhbnNmb3JtOwogICAgcGFyYW1ldGVycy5kaXYuaGlkZGVuID0gZmFsc2U7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9hbm5vdGF0aW9uX2xheWVyLmpzCgoKCgoKCmNvbnN0IERFRkFVTFRfVEFCX0lOREVYID0gMTAwMDsKY29uc3QgYW5ub3RhdGlvbl9sYXllcl9ERUZBVUxUX0ZPTlRfU0laRSA9IDk7CmNvbnN0IEdldEVsZW1lbnRzQnlOYW1lU2V0ID0gbmV3IFdlYWtTZXQoKTsKY2xhc3MgQW5ub3RhdGlvbkVsZW1lbnRGYWN0b3J5IHsKICBzdGF0aWMgY3JlYXRlKHBhcmFtZXRlcnMpIHsKICAgIGNvbnN0IHN1YnR5cGUgPSBwYXJhbWV0ZXJzLmRhdGEuYW5ub3RhdGlvblR5cGU7CiAgICBzd2l0Y2ggKHN1YnR5cGUpIHsKICAgICAgY2FzZSBBbm5vdGF0aW9uVHlwZS5MSU5LOgogICAgICAgIHJldHVybiBuZXcgTGlua0Fubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgICBjYXNlIEFubm90YXRpb25UeXBlLlRFWFQ6CiAgICAgICAgcmV0dXJuIG5ldyBUZXh0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgQW5ub3RhdGlvblR5cGUuV0lER0VUOgogICAgICAgIGNvbnN0IGZpZWxkVHlwZSA9IHBhcmFtZXRlcnMuZGF0YS5maWVsZFR5cGU7CiAgICAgICAgc3dpdGNoIChmaWVsZFR5cGUpIHsKICAgICAgICAgIGNhc2UgIlR4IjoKICAgICAgICAgICAgcmV0dXJuIG5ldyBUZXh0V2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CiAgICAgICAgICBjYXNlICJCdG4iOgogICAgICAgICAgICBpZiAocGFyYW1ldGVycy5kYXRhLnJhZGlvQnV0dG9uKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSYWRpb0J1dHRvbldpZGdldEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFtZXRlcnMuZGF0YS5jaGVja0JveCkgewogICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hlY2tib3hXaWRnZXRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IFB1c2hCdXR0b25XaWRnZXRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKICAgICAgICAgIGNhc2UgIkNoIjoKICAgICAgICAgICAgcmV0dXJuIG5ldyBDaG9pY2VXaWRnZXRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKICAgICAgICAgIGNhc2UgIlNpZyI6CiAgICAgICAgICAgIHJldHVybiBuZXcgU2lnbmF0dXJlV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgQW5ub3RhdGlvblR5cGUuUE9QVVA6CiAgICAgICAgcmV0dXJuIG5ldyBQb3B1cEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgICBjYXNlIEFubm90YXRpb25UeXBlLkZSRUVURVhUOgogICAgICAgIHJldHVybiBuZXcgRnJlZVRleHRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSBBbm5vdGF0aW9uVHlwZS5MSU5FOgogICAgICAgIHJldHVybiBuZXcgTGluZUFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgICBjYXNlIEFubm90YXRpb25UeXBlLlNRVUFSRToKICAgICAgICByZXR1cm4gbmV3IFNxdWFyZUFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgICBjYXNlIEFubm90YXRpb25UeXBlLkNJUkNMRToKICAgICAgICByZXR1cm4gbmV3IENpcmNsZUFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgICBjYXNlIEFubm90YXRpb25UeXBlLlBPTFlMSU5FOgogICAgICAgIHJldHVybiBuZXcgUG9seWxpbmVBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSBBbm5vdGF0aW9uVHlwZS5DQVJFVDoKICAgICAgICByZXR1cm4gbmV3IENhcmV0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgQW5ub3RhdGlvblR5cGUuSU5LOgogICAgICAgIHJldHVybiBuZXcgSW5rQW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgQW5ub3RhdGlvblR5cGUuUE9MWUdPTjoKICAgICAgICByZXR1cm4gbmV3IFBvbHlnb25Bbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSBBbm5vdGF0aW9uVHlwZS5ISUdITElHSFQ6CiAgICAgICAgcmV0dXJuIG5ldyBIaWdobGlnaHRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSBBbm5vdGF0aW9uVHlwZS5VTkRFUkxJTkU6CiAgICAgICAgcmV0dXJuIG5ldyBVbmRlcmxpbmVBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSBBbm5vdGF0aW9uVHlwZS5TUVVJR0dMWToKICAgICAgICByZXR1cm4gbmV3IFNxdWlnZ2x5QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgQW5ub3RhdGlvblR5cGUuU1RSSUtFT1VUOgogICAgICAgIHJldHVybiBuZXcgU3RyaWtlT3V0QW5ub3RhdGlvbkVsZW1lbnQocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgQW5ub3RhdGlvblR5cGUuU1RBTVA6CiAgICAgICAgcmV0dXJuIG5ldyBTdGFtcEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgICBjYXNlIEFubm90YXRpb25UeXBlLkZJTEVBVFRBQ0hNRU5UOgogICAgICAgIHJldHVybiBuZXcgRmlsZUF0dGFjaG1lbnRBbm5vdGF0aW9uRWxlbWVudChwYXJhbWV0ZXJzKTsKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gbmV3IEFubm90YXRpb25FbGVtZW50KHBhcmFtZXRlcnMpOwogICAgfQogIH0KfQpjbGFzcyBBbm5vdGF0aW9uRWxlbWVudCB7CiAgI3VwZGF0ZXMgPSBudWxsOwogICNoYXNCb3JkZXIgPSBmYWxzZTsKICAjcG9wdXBFbGVtZW50ID0gbnVsbDsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzLCB7CiAgICBpc1JlbmRlcmFibGUgPSBmYWxzZSwKICAgIGlnbm9yZUJvcmRlciA9IGZhbHNlLAogICAgY3JlYXRlUXVhZHJpbGF0ZXJhbHMgPSBmYWxzZQogIH0gPSB7fSkgewogICAgdGhpcy5pc1JlbmRlcmFibGUgPSBpc1JlbmRlcmFibGU7CiAgICB0aGlzLmRhdGEgPSBwYXJhbWV0ZXJzLmRhdGE7CiAgICB0aGlzLmxheWVyID0gcGFyYW1ldGVycy5sYXllcjsKICAgIHRoaXMubGlua1NlcnZpY2UgPSBwYXJhbWV0ZXJzLmxpbmtTZXJ2aWNlOwogICAgdGhpcy5kb3dubG9hZE1hbmFnZXIgPSBwYXJhbWV0ZXJzLmRvd25sb2FkTWFuYWdlcjsKICAgIHRoaXMuaW1hZ2VSZXNvdXJjZXNQYXRoID0gcGFyYW1ldGVycy5pbWFnZVJlc291cmNlc1BhdGg7CiAgICB0aGlzLnJlbmRlckZvcm1zID0gcGFyYW1ldGVycy5yZW5kZXJGb3JtczsKICAgIHRoaXMuc3ZnRmFjdG9yeSA9IHBhcmFtZXRlcnMuc3ZnRmFjdG9yeTsKICAgIHRoaXMuYW5ub3RhdGlvblN0b3JhZ2UgPSBwYXJhbWV0ZXJzLmFubm90YXRpb25TdG9yYWdlOwogICAgdGhpcy5lbmFibGVTY3JpcHRpbmcgPSBwYXJhbWV0ZXJzLmVuYWJsZVNjcmlwdGluZzsKICAgIHRoaXMuaGFzSlNBY3Rpb25zID0gcGFyYW1ldGVycy5oYXNKU0FjdGlvbnM7CiAgICB0aGlzLl9maWVsZE9iamVjdHMgPSBwYXJhbWV0ZXJzLmZpZWxkT2JqZWN0czsKICAgIHRoaXMucGFyZW50ID0gcGFyYW1ldGVycy5wYXJlbnQ7CiAgICBpZiAoaXNSZW5kZXJhYmxlKSB7CiAgICAgIHRoaXMuY29udGFpbmVyID0gdGhpcy5fY3JlYXRlQ29udGFpbmVyKGlnbm9yZUJvcmRlcik7CiAgICB9CiAgICBpZiAoY3JlYXRlUXVhZHJpbGF0ZXJhbHMpIHsKICAgICAgdGhpcy5fY3JlYXRlUXVhZHJpbGF0ZXJhbHMoKTsKICAgIH0KICB9CiAgc3RhdGljIF9oYXNQb3B1cERhdGEoewogICAgdGl0bGVPYmosCiAgICBjb250ZW50c09iaiwKICAgIHJpY2hUZXh0CiAgfSkgewogICAgcmV0dXJuICEhKHRpdGxlT2JqPy5zdHIgfHwgY29udGVudHNPYmo/LnN0ciB8fCByaWNoVGV4dD8uc3RyKTsKICB9CiAgZ2V0IF9pc0VkaXRhYmxlKCkgewogICAgcmV0dXJuIHRoaXMuZGF0YS5pc0VkaXRhYmxlOwogIH0KICBnZXQgaGFzUG9wdXBEYXRhKCkgewogICAgcmV0dXJuIEFubm90YXRpb25FbGVtZW50Ll9oYXNQb3B1cERhdGEodGhpcy5kYXRhKTsKICB9CiAgdXBkYXRlRWRpdGVkKHBhcmFtcykgewogICAgaWYgKCF0aGlzLmNvbnRhaW5lcikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiN1cGRhdGVzIHx8PSB7CiAgICAgIHJlY3Q6IHRoaXMuZGF0YS5yZWN0LnNsaWNlKDApCiAgICB9OwogICAgY29uc3QgewogICAgICByZWN0CiAgICB9ID0gcGFyYW1zOwogICAgaWYgKHJlY3QpIHsKICAgICAgdGhpcy4jc2V0UmVjdEVkaXRlZChyZWN0KTsKICAgIH0KICAgIHRoaXMuI3BvcHVwRWxlbWVudD8ucG9wdXAudXBkYXRlRWRpdGVkKHBhcmFtcyk7CiAgfQogIHJlc2V0RWRpdGVkKCkgewogICAgaWYgKCF0aGlzLiN1cGRhdGVzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI3NldFJlY3RFZGl0ZWQodGhpcy4jdXBkYXRlcy5yZWN0KTsKICAgIHRoaXMuI3BvcHVwRWxlbWVudD8ucG9wdXAucmVzZXRFZGl0ZWQoKTsKICAgIHRoaXMuI3VwZGF0ZXMgPSBudWxsOwogIH0KICAjc2V0UmVjdEVkaXRlZChyZWN0KSB7CiAgICBjb25zdCB7CiAgICAgIGNvbnRhaW5lcjogewogICAgICAgIHN0eWxlCiAgICAgIH0sCiAgICAgIGRhdGE6IHsKICAgICAgICByZWN0OiBjdXJyZW50UmVjdCwKICAgICAgICByb3RhdGlvbgogICAgICB9LAogICAgICBwYXJlbnQ6IHsKICAgICAgICB2aWV3cG9ydDogewogICAgICAgICAgcmF3RGltczogewogICAgICAgICAgICBwYWdlV2lkdGgsCiAgICAgICAgICAgIHBhZ2VIZWlnaHQsCiAgICAgICAgICAgIHBhZ2VYLAogICAgICAgICAgICBwYWdlWQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSA9IHRoaXM7CiAgICBjdXJyZW50UmVjdD8uc3BsaWNlKDAsIDQsIC4uLnJlY3QpOwogICAgc3R5bGUubGVmdCA9IGAkezEwMCAqIChyZWN0WzBdIC0gcGFnZVgpIC8gcGFnZVdpZHRofSVgOwogICAgc3R5bGUudG9wID0gYCR7MTAwICogKHBhZ2VIZWlnaHQgLSByZWN0WzNdICsgcGFnZVkpIC8gcGFnZUhlaWdodH0lYDsKICAgIGlmIChyb3RhdGlvbiA9PT0gMCkgewogICAgICBzdHlsZS53aWR0aCA9IGAkezEwMCAqIChyZWN0WzJdIC0gcmVjdFswXSkgLyBwYWdlV2lkdGh9JWA7CiAgICAgIHN0eWxlLmhlaWdodCA9IGAkezEwMCAqIChyZWN0WzNdIC0gcmVjdFsxXSkgLyBwYWdlSGVpZ2h0fSVgOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5zZXRSb3RhdGlvbihyb3RhdGlvbik7CiAgICB9CiAgfQogIF9jcmVhdGVDb250YWluZXIoaWdub3JlQm9yZGVyKSB7CiAgICBjb25zdCB7CiAgICAgIGRhdGEsCiAgICAgIHBhcmVudDogewogICAgICAgIHBhZ2UsCiAgICAgICAgdmlld3BvcnQKICAgICAgfQogICAgfSA9IHRoaXM7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWN0aW9uIik7CiAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCJkYXRhLWFubm90YXRpb24taWQiLCBkYXRhLmlkKTsKICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCkpIHsKICAgICAgY29udGFpbmVyLnRhYkluZGV4ID0gREVGQVVMVF9UQUJfSU5ERVg7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHN0eWxlCiAgICB9ID0gY29udGFpbmVyOwogICAgc3R5bGUuekluZGV4ID0gdGhpcy5wYXJlbnQuekluZGV4Kys7CiAgICBpZiAoZGF0YS5hbHRlcm5hdGl2ZVRleHQpIHsKICAgICAgY29udGFpbmVyLnRpdGxlID0gZGF0YS5hbHRlcm5hdGl2ZVRleHQ7CiAgICB9CiAgICBpZiAoZGF0YS5ub1JvdGF0ZSkgewogICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgibm9yb3RhdGUiKTsKICAgIH0KICAgIGlmICghZGF0YS5yZWN0IHx8IHRoaXMgaW5zdGFuY2VvZiBQb3B1cEFubm90YXRpb25FbGVtZW50KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICByb3RhdGlvbgogICAgICB9ID0gZGF0YTsKICAgICAgaWYgKCFkYXRhLmhhc093bkNhbnZhcyAmJiByb3RhdGlvbiAhPT0gMCkgewogICAgICAgIHRoaXMuc2V0Um90YXRpb24ocm90YXRpb24sIGNvbnRhaW5lcik7CiAgICAgIH0KICAgICAgcmV0dXJuIGNvbnRhaW5lcjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IHRoaXM7CiAgICBpZiAoIWlnbm9yZUJvcmRlciAmJiBkYXRhLmJvcmRlclN0eWxlLndpZHRoID4gMCkgewogICAgICBzdHlsZS5ib3JkZXJXaWR0aCA9IGAke2RhdGEuYm9yZGVyU3R5bGUud2lkdGh9cHhgOwogICAgICBjb25zdCBob3Jpem9udGFsUmFkaXVzID0gZGF0YS5ib3JkZXJTdHlsZS5ob3Jpem9udGFsQ29ybmVyUmFkaXVzOwogICAgICBjb25zdCB2ZXJ0aWNhbFJhZGl1cyA9IGRhdGEuYm9yZGVyU3R5bGUudmVydGljYWxDb3JuZXJSYWRpdXM7CiAgICAgIGlmIChob3Jpem9udGFsUmFkaXVzID4gMCB8fCB2ZXJ0aWNhbFJhZGl1cyA+IDApIHsKICAgICAgICBjb25zdCByYWRpdXMgPSBgY2FsYygke2hvcml6b250YWxSYWRpdXN9cHggKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKSAvIGNhbGMoJHt2ZXJ0aWNhbFJhZGl1c31weCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpYDsKICAgICAgICBzdHlsZS5ib3JkZXJSYWRpdXMgPSByYWRpdXM7CiAgICAgIH0gZWxzZSBpZiAodGhpcyBpbnN0YW5jZW9mIFJhZGlvQnV0dG9uV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQpIHsKICAgICAgICBjb25zdCByYWRpdXMgPSBgY2FsYygke3dpZHRofXB4ICogdmFyKC0tdG90YWwtc2NhbGUtZmFjdG9yKSkgLyBjYWxjKCR7aGVpZ2h0fXB4ICogdmFyKC0tdG90YWwtc2NhbGUtZmFjdG9yKSlgOwogICAgICAgIHN0eWxlLmJvcmRlclJhZGl1cyA9IHJhZGl1czsKICAgICAgfQogICAgICBzd2l0Y2ggKGRhdGEuYm9yZGVyU3R5bGUuc3R5bGUpIHsKICAgICAgICBjYXNlIEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuU09MSUQ6CiAgICAgICAgICBzdHlsZS5ib3JkZXJTdHlsZSA9ICJzb2xpZCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuREFTSEVEOgogICAgICAgICAgc3R5bGUuYm9yZGVyU3R5bGUgPSAiZGFzaGVkIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5CRVZFTEVEOgogICAgICAgICAgd2FybigiVW5pbXBsZW1lbnRlZCBib3JkZXIgc3R5bGU6IGJldmVsZWQiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5JTlNFVDoKICAgICAgICAgIHdhcm4oIlVuaW1wbGVtZW50ZWQgYm9yZGVyIHN0eWxlOiBpbnNldCIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLlVOREVSTElORToKICAgICAgICAgIHN0eWxlLmJvcmRlckJvdHRvbVN0eWxlID0gInNvbGlkIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjb25zdCBib3JkZXJDb2xvciA9IGRhdGEuYm9yZGVyQ29sb3IgfHwgbnVsbDsKICAgICAgaWYgKGJvcmRlckNvbG9yKSB7CiAgICAgICAgdGhpcy4jaGFzQm9yZGVyID0gdHJ1ZTsKICAgICAgICBzdHlsZS5ib3JkZXJDb2xvciA9IFV0aWwubWFrZUhleENvbG9yKGJvcmRlckNvbG9yWzBdIHwgMCwgYm9yZGVyQ29sb3JbMV0gfCAwLCBib3JkZXJDb2xvclsyXSB8IDApOwogICAgICB9IGVsc2UgewogICAgICAgIHN0eWxlLmJvcmRlcldpZHRoID0gMDsKICAgICAgfQogICAgfQogICAgY29uc3QgcmVjdCA9IFV0aWwubm9ybWFsaXplUmVjdChbZGF0YS5yZWN0WzBdLCBwYWdlLnZpZXdbM10gLSBkYXRhLnJlY3RbMV0gKyBwYWdlLnZpZXdbMV0sIGRhdGEucmVjdFsyXSwgcGFnZS52aWV3WzNdIC0gZGF0YS5yZWN0WzNdICsgcGFnZS52aWV3WzFdXSk7CiAgICBjb25zdCB7CiAgICAgIHBhZ2VXaWR0aCwKICAgICAgcGFnZUhlaWdodCwKICAgICAgcGFnZVgsCiAgICAgIHBhZ2VZCiAgICB9ID0gdmlld3BvcnQucmF3RGltczsKICAgIHN0eWxlLmxlZnQgPSBgJHsxMDAgKiAocmVjdFswXSAtIHBhZ2VYKSAvIHBhZ2VXaWR0aH0lYDsKICAgIHN0eWxlLnRvcCA9IGAkezEwMCAqIChyZWN0WzFdIC0gcGFnZVkpIC8gcGFnZUhlaWdodH0lYDsKICAgIGNvbnN0IHsKICAgICAgcm90YXRpb24KICAgIH0gPSBkYXRhOwogICAgaWYgKGRhdGEuaGFzT3duQ2FudmFzIHx8IHJvdGF0aW9uID09PSAwKSB7CiAgICAgIHN0eWxlLndpZHRoID0gYCR7MTAwICogd2lkdGggLyBwYWdlV2lkdGh9JWA7CiAgICAgIHN0eWxlLmhlaWdodCA9IGAkezEwMCAqIGhlaWdodCAvIHBhZ2VIZWlnaHR9JWA7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnNldFJvdGF0aW9uKHJvdGF0aW9uLCBjb250YWluZXIpOwogICAgfQogICAgcmV0dXJuIGNvbnRhaW5lcjsKICB9CiAgc2V0Um90YXRpb24oYW5nbGUsIGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyKSB7CiAgICBpZiAoIXRoaXMuZGF0YS5yZWN0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgcGFnZVdpZHRoLAogICAgICBwYWdlSGVpZ2h0CiAgICB9ID0gdGhpcy5wYXJlbnQudmlld3BvcnQucmF3RGltczsKICAgIGxldCB7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSB0aGlzOwogICAgaWYgKGFuZ2xlICUgMTgwICE9PSAwKSB7CiAgICAgIFt3aWR0aCwgaGVpZ2h0XSA9IFtoZWlnaHQsIHdpZHRoXTsKICAgIH0KICAgIGNvbnRhaW5lci5zdHlsZS53aWR0aCA9IGAkezEwMCAqIHdpZHRoIC8gcGFnZVdpZHRofSVgOwogICAgY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGAkezEwMCAqIGhlaWdodCAvIHBhZ2VIZWlnaHR9JWA7CiAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCJkYXRhLW1haW4tcm90YXRpb24iLCAoMzYwIC0gYW5nbGUpICUgMzYwKTsKICB9CiAgZ2V0IF9jb21tb25BY3Rpb25zKCkgewogICAgY29uc3Qgc2V0Q29sb3IgPSAoanNOYW1lLCBzdHlsZU5hbWUsIGV2ZW50KSA9PiB7CiAgICAgIGNvbnN0IGNvbG9yID0gZXZlbnQuZGV0YWlsW2pzTmFtZV07CiAgICAgIGNvbnN0IGNvbG9yVHlwZSA9IGNvbG9yWzBdOwogICAgICBjb25zdCBjb2xvckFycmF5ID0gY29sb3Iuc2xpY2UoMSk7CiAgICAgIGV2ZW50LnRhcmdldC5zdHlsZVtzdHlsZU5hbWVdID0gQ29sb3JDb252ZXJ0ZXJzW2Ake2NvbG9yVHlwZX1fSFRNTGBdKGNvbG9yQXJyYXkpOwogICAgICB0aGlzLmFubm90YXRpb25TdG9yYWdlLnNldFZhbHVlKHRoaXMuZGF0YS5pZCwgewogICAgICAgIFtzdHlsZU5hbWVdOiBDb2xvckNvbnZlcnRlcnNbYCR7Y29sb3JUeXBlfV9yZ2JgXShjb2xvckFycmF5KQogICAgICB9KTsKICAgIH07CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfY29tbW9uQWN0aW9ucyIsIHsKICAgICAgZGlzcGxheTogZXZlbnQgPT4gewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGRpc3BsYXkKICAgICAgICB9ID0gZXZlbnQuZGV0YWlsOwogICAgICAgIGNvbnN0IGhpZGRlbiA9IGRpc3BsYXkgJSAyID09PSAxOwogICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBoaWRkZW4gPyAiaGlkZGVuIiA6ICJ2aXNpYmxlIjsKICAgICAgICB0aGlzLmFubm90YXRpb25TdG9yYWdlLnNldFZhbHVlKHRoaXMuZGF0YS5pZCwgewogICAgICAgICAgbm9WaWV3OiBoaWRkZW4sCiAgICAgICAgICBub1ByaW50OiBkaXNwbGF5ID09PSAxIHx8IGRpc3BsYXkgPT09IDIKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgcHJpbnQ6IGV2ZW50ID0+IHsKICAgICAgICB0aGlzLmFubm90YXRpb25TdG9yYWdlLnNldFZhbHVlKHRoaXMuZGF0YS5pZCwgewogICAgICAgICAgbm9QcmludDogIWV2ZW50LmRldGFpbC5wcmludAogICAgICAgIH0pOwogICAgICB9LAogICAgICBoaWRkZW46IGV2ZW50ID0+IHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBoaWRkZW4KICAgICAgICB9ID0gZXZlbnQuZGV0YWlsOwogICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBoaWRkZW4gPyAiaGlkZGVuIiA6ICJ2aXNpYmxlIjsKICAgICAgICB0aGlzLmFubm90YXRpb25TdG9yYWdlLnNldFZhbHVlKHRoaXMuZGF0YS5pZCwgewogICAgICAgICAgbm9QcmludDogaGlkZGVuLAogICAgICAgICAgbm9WaWV3OiBoaWRkZW4KICAgICAgICB9KTsKICAgICAgfSwKICAgICAgZm9jdXM6IGV2ZW50ID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGV2ZW50LnRhcmdldC5mb2N1cyh7CiAgICAgICAgICBwcmV2ZW50U2Nyb2xsOiBmYWxzZQogICAgICAgIH0pLCAwKTsKICAgICAgfSwKICAgICAgdXNlck5hbWU6IGV2ZW50ID0+IHsKICAgICAgICBldmVudC50YXJnZXQudGl0bGUgPSBldmVudC5kZXRhaWwudXNlck5hbWU7CiAgICAgIH0sCiAgICAgIHJlYWRvbmx5OiBldmVudCA9PiB7CiAgICAgICAgZXZlbnQudGFyZ2V0LmRpc2FibGVkID0gZXZlbnQuZGV0YWlsLnJlYWRvbmx5OwogICAgICB9LAogICAgICByZXF1aXJlZDogZXZlbnQgPT4gewogICAgICAgIHRoaXMuX3NldFJlcXVpcmVkKGV2ZW50LnRhcmdldCwgZXZlbnQuZGV0YWlsLnJlcXVpcmVkKTsKICAgICAgfSwKICAgICAgYmdDb2xvcjogZXZlbnQgPT4gewogICAgICAgIHNldENvbG9yKCJiZ0NvbG9yIiwgImJhY2tncm91bmRDb2xvciIsIGV2ZW50KTsKICAgICAgfSwKICAgICAgZmlsbENvbG9yOiBldmVudCA9PiB7CiAgICAgICAgc2V0Q29sb3IoImZpbGxDb2xvciIsICJiYWNrZ3JvdW5kQ29sb3IiLCBldmVudCk7CiAgICAgIH0sCiAgICAgIGZnQ29sb3I6IGV2ZW50ID0+IHsKICAgICAgICBzZXRDb2xvcigiZmdDb2xvciIsICJjb2xvciIsIGV2ZW50KTsKICAgICAgfSwKICAgICAgdGV4dENvbG9yOiBldmVudCA9PiB7CiAgICAgICAgc2V0Q29sb3IoInRleHRDb2xvciIsICJjb2xvciIsIGV2ZW50KTsKICAgICAgfSwKICAgICAgYm9yZGVyQ29sb3I6IGV2ZW50ID0+IHsKICAgICAgICBzZXRDb2xvcigiYm9yZGVyQ29sb3IiLCAiYm9yZGVyQ29sb3IiLCBldmVudCk7CiAgICAgIH0sCiAgICAgIHN0cm9rZUNvbG9yOiBldmVudCA9PiB7CiAgICAgICAgc2V0Q29sb3IoInN0cm9rZUNvbG9yIiwgImJvcmRlckNvbG9yIiwgZXZlbnQpOwogICAgICB9LAogICAgICByb3RhdGlvbjogZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGFuZ2xlID0gZXZlbnQuZGV0YWlsLnJvdGF0aW9uOwogICAgICAgIHRoaXMuc2V0Um90YXRpb24oYW5nbGUpOwogICAgICAgIHRoaXMuYW5ub3RhdGlvblN0b3JhZ2Uuc2V0VmFsdWUodGhpcy5kYXRhLmlkLCB7CiAgICAgICAgICByb3RhdGlvbjogYW5nbGUKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfQogIF9kaXNwYXRjaEV2ZW50RnJvbVNhbmRib3goYWN0aW9ucywganNFdmVudCkgewogICAgY29uc3QgY29tbW9uQWN0aW9ucyA9IHRoaXMuX2NvbW1vbkFjdGlvbnM7CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmtleXMoanNFdmVudC5kZXRhaWwpKSB7CiAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbnNbbmFtZV0gfHwgY29tbW9uQWN0aW9uc1tuYW1lXTsKICAgICAgYWN0aW9uPy4oanNFdmVudCk7CiAgICB9CiAgfQogIF9zZXREZWZhdWx0UHJvcGVydGllc0Zyb21KUyhlbGVtZW50KSB7CiAgICBpZiAoIXRoaXMuZW5hYmxlU2NyaXB0aW5nKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHN0b3JlZERhdGEgPSB0aGlzLmFubm90YXRpb25TdG9yYWdlLmdldFJhd1ZhbHVlKHRoaXMuZGF0YS5pZCk7CiAgICBpZiAoIXN0b3JlZERhdGEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY29tbW9uQWN0aW9ucyA9IHRoaXMuX2NvbW1vbkFjdGlvbnM7CiAgICBmb3IgKGNvbnN0IFthY3Rpb25OYW1lLCBkZXRhaWxdIG9mIE9iamVjdC5lbnRyaWVzKHN0b3JlZERhdGEpKSB7CiAgICAgIGNvbnN0IGFjdGlvbiA9IGNvbW1vbkFjdGlvbnNbYWN0aW9uTmFtZV07CiAgICAgIGlmIChhY3Rpb24pIHsKICAgICAgICBjb25zdCBldmVudFByb3h5ID0gewogICAgICAgICAgZGV0YWlsOiB7CiAgICAgICAgICAgIFthY3Rpb25OYW1lXTogZGV0YWlsCiAgICAgICAgICB9LAogICAgICAgICAgdGFyZ2V0OiBlbGVtZW50CiAgICAgICAgfTsKICAgICAgICBhY3Rpb24oZXZlbnRQcm94eSk7CiAgICAgICAgZGVsZXRlIHN0b3JlZERhdGFbYWN0aW9uTmFtZV07CiAgICAgIH0KICAgIH0KICB9CiAgX2NyZWF0ZVF1YWRyaWxhdGVyYWxzKCkgewogICAgaWYgKCF0aGlzLmNvbnRhaW5lcikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHF1YWRQb2ludHMKICAgIH0gPSB0aGlzLmRhdGE7CiAgICBpZiAoIXF1YWRQb2ludHMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgW3JlY3RCbFgsIHJlY3RCbFksIHJlY3RUclgsIHJlY3RUclldID0gdGhpcy5kYXRhLnJlY3QubWFwKHggPT4gTWF0aC5mcm91bmQoeCkpOwogICAgaWYgKHF1YWRQb2ludHMubGVuZ3RoID09PSA4KSB7CiAgICAgIGNvbnN0IFt0clgsIHRyWSwgYmxYLCBibFldID0gcXVhZFBvaW50cy5zdWJhcnJheSgyLCA2KTsKICAgICAgaWYgKHJlY3RUclggPT09IHRyWCAmJiByZWN0VHJZID09PSB0clkgJiYgcmVjdEJsWCA9PT0gYmxYICYmIHJlY3RCbFkgPT09IGJsWSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgY29uc3QgewogICAgICBzdHlsZQogICAgfSA9IHRoaXMuY29udGFpbmVyOwogICAgbGV0IHN2Z0J1ZmZlcjsKICAgIGlmICh0aGlzLiNoYXNCb3JkZXIpIHsKICAgICAgY29uc3QgewogICAgICAgIGJvcmRlckNvbG9yLAogICAgICAgIGJvcmRlcldpZHRoCiAgICAgIH0gPSBzdHlsZTsKICAgICAgc3R5bGUuYm9yZGVyV2lkdGggPSAwOwogICAgICBzdmdCdWZmZXIgPSBbInVybCgnZGF0YTppbWFnZS9zdmcreG1sO3V0ZjgsIiwgYDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnImAsIGAgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgdmlld0JveD0iMCAwIDEgMSI+YCwgYDxnIGZpbGw9InRyYW5zcGFyZW50IiBzdHJva2U9IiR7Ym9yZGVyQ29sb3J9IiBzdHJva2Utd2lkdGg9IiR7Ym9yZGVyV2lkdGh9Ij5gXTsKICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgiaGFzQm9yZGVyIik7CiAgICB9CiAgICBjb25zdCB3aWR0aCA9IHJlY3RUclggLSByZWN0QmxYOwogICAgY29uc3QgaGVpZ2h0ID0gcmVjdFRyWSAtIHJlY3RCbFk7CiAgICBjb25zdCB7CiAgICAgIHN2Z0ZhY3RvcnkKICAgIH0gPSB0aGlzOwogICAgY29uc3Qgc3ZnID0gc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmciKTsKICAgIHN2Zy5jbGFzc0xpc3QuYWRkKCJxdWFkcmlsYXRlcmFsc0NvbnRhaW5lciIpOwogICAgc3ZnLnNldEF0dHJpYnV0ZSgid2lkdGgiLCAwKTsKICAgIHN2Zy5zZXRBdHRyaWJ1dGUoImhlaWdodCIsIDApOwogICAgY29uc3QgZGVmcyA9IHN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgiZGVmcyIpOwogICAgc3ZnLmFwcGVuZChkZWZzKTsKICAgIGNvbnN0IGNsaXBQYXRoID0gc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJjbGlwUGF0aCIpOwogICAgY29uc3QgaWQgPSBgY2xpcHBhdGhfJHt0aGlzLmRhdGEuaWR9YDsKICAgIGNsaXBQYXRoLnNldEF0dHJpYnV0ZSgiaWQiLCBpZCk7CiAgICBjbGlwUGF0aC5zZXRBdHRyaWJ1dGUoImNsaXBQYXRoVW5pdHMiLCAib2JqZWN0Qm91bmRpbmdCb3giKTsKICAgIGRlZnMuYXBwZW5kKGNsaXBQYXRoKTsKICAgIGZvciAobGV0IGkgPSAyLCBpaSA9IHF1YWRQb2ludHMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gOCkgewogICAgICBjb25zdCB0clggPSBxdWFkUG9pbnRzW2ldOwogICAgICBjb25zdCB0clkgPSBxdWFkUG9pbnRzW2kgKyAxXTsKICAgICAgY29uc3QgYmxYID0gcXVhZFBvaW50c1tpICsgMl07CiAgICAgIGNvbnN0IGJsWSA9IHF1YWRQb2ludHNbaSArIDNdOwogICAgICBjb25zdCByZWN0ID0gc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJyZWN0Iik7CiAgICAgIGNvbnN0IHggPSAoYmxYIC0gcmVjdEJsWCkgLyB3aWR0aDsKICAgICAgY29uc3QgeSA9IChyZWN0VHJZIC0gdHJZKSAvIGhlaWdodDsKICAgICAgY29uc3QgcmVjdFdpZHRoID0gKHRyWCAtIGJsWCkgLyB3aWR0aDsKICAgICAgY29uc3QgcmVjdEhlaWdodCA9ICh0clkgLSBibFkpIC8gaGVpZ2h0OwogICAgICByZWN0LnNldEF0dHJpYnV0ZSgieCIsIHgpOwogICAgICByZWN0LnNldEF0dHJpYnV0ZSgieSIsIHkpOwogICAgICByZWN0LnNldEF0dHJpYnV0ZSgid2lkdGgiLCByZWN0V2lkdGgpOwogICAgICByZWN0LnNldEF0dHJpYnV0ZSgiaGVpZ2h0IiwgcmVjdEhlaWdodCk7CiAgICAgIGNsaXBQYXRoLmFwcGVuZChyZWN0KTsKICAgICAgc3ZnQnVmZmVyPy5wdXNoKGA8cmVjdCB2ZWN0b3ItZWZmZWN0PSJub24tc2NhbGluZy1zdHJva2UiIHg9IiR7eH0iIHk9IiR7eX0iIHdpZHRoPSIke3JlY3RXaWR0aH0iIGhlaWdodD0iJHtyZWN0SGVpZ2h0fSIvPmApOwogICAgfQogICAgaWYgKHRoaXMuI2hhc0JvcmRlcikgewogICAgICBzdmdCdWZmZXIucHVzaChgPC9nPjwvc3ZnPicpYCk7CiAgICAgIHN0eWxlLmJhY2tncm91bmRJbWFnZSA9IHN2Z0J1ZmZlci5qb2luKCIiKTsKICAgIH0KICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZChzdmcpOwogICAgdGhpcy5jb250YWluZXIuc3R5bGUuY2xpcFBhdGggPSBgdXJsKCMke2lkfSlgOwogIH0KICBfY3JlYXRlUG9wdXAoKSB7CiAgICBjb25zdCB7CiAgICAgIGRhdGEKICAgIH0gPSB0aGlzOwogICAgY29uc3QgcG9wdXAgPSB0aGlzLiNwb3B1cEVsZW1lbnQgPSBuZXcgUG9wdXBBbm5vdGF0aW9uRWxlbWVudCh7CiAgICAgIGRhdGE6IHsKICAgICAgICBjb2xvcjogZGF0YS5jb2xvciwKICAgICAgICB0aXRsZU9iajogZGF0YS50aXRsZU9iaiwKICAgICAgICBtb2RpZmljYXRpb25EYXRlOiBkYXRhLm1vZGlmaWNhdGlvbkRhdGUsCiAgICAgICAgY29udGVudHNPYmo6IGRhdGEuY29udGVudHNPYmosCiAgICAgICAgcmljaFRleHQ6IGRhdGEucmljaFRleHQsCiAgICAgICAgcGFyZW50UmVjdDogZGF0YS5yZWN0LAogICAgICAgIGJvcmRlclN0eWxlOiAwLAogICAgICAgIGlkOiBgcG9wdXBfJHtkYXRhLmlkfWAsCiAgICAgICAgcm90YXRpb246IGRhdGEucm90YXRpb24KICAgICAgfSwKICAgICAgcGFyZW50OiB0aGlzLnBhcmVudCwKICAgICAgZWxlbWVudHM6IFt0aGlzXQogICAgfSk7CiAgICB0aGlzLnBhcmVudC5kaXYuYXBwZW5kKHBvcHVwLnJlbmRlcigpKTsKICB9CiAgcmVuZGVyKCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgQW5ub3RhdGlvbkVsZW1lbnQucmVuZGVyYCBjYWxsZWQiKTsKICB9CiAgX2dldEVsZW1lbnRzQnlOYW1lKG5hbWUsIHNraXBJZCA9IG51bGwpIHsKICAgIGNvbnN0IGZpZWxkcyA9IFtdOwogICAgaWYgKHRoaXMuX2ZpZWxkT2JqZWN0cykgewogICAgICBjb25zdCBmaWVsZE9iaiA9IHRoaXMuX2ZpZWxkT2JqZWN0c1tuYW1lXTsKICAgICAgaWYgKGZpZWxkT2JqKSB7CiAgICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgICBwYWdlLAogICAgICAgICAgaWQsCiAgICAgICAgICBleHBvcnRWYWx1ZXMKICAgICAgICB9IG9mIGZpZWxkT2JqKSB7CiAgICAgICAgICBpZiAocGFnZSA9PT0gLTEpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaWQgPT09IHNraXBJZCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGV4cG9ydFZhbHVlID0gdHlwZW9mIGV4cG9ydFZhbHVlcyA9PT0gInN0cmluZyIgPyBleHBvcnRWYWx1ZXMgOiBudWxsOwogICAgICAgICAgY29uc3QgZG9tRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWVsZW1lbnQtaWQ9IiR7aWR9Il1gKTsKICAgICAgICAgIGlmIChkb21FbGVtZW50ICYmICFHZXRFbGVtZW50c0J5TmFtZVNldC5oYXMoZG9tRWxlbWVudCkpIHsKICAgICAgICAgICAgd2FybihgX2dldEVsZW1lbnRzQnlOYW1lIC0gZWxlbWVudCBub3QgYWxsb3dlZDogJHtpZH1gKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBmaWVsZHMucHVzaCh7CiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBleHBvcnRWYWx1ZSwKICAgICAgICAgICAgZG9tRWxlbWVudAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmaWVsZHM7CiAgICB9CiAgICBmb3IgKGNvbnN0IGRvbUVsZW1lbnQgb2YgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUobmFtZSkpIHsKICAgICAgY29uc3QgewogICAgICAgIGV4cG9ydFZhbHVlCiAgICAgIH0gPSBkb21FbGVtZW50OwogICAgICBjb25zdCBpZCA9IGRvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKCJkYXRhLWVsZW1lbnQtaWQiKTsKICAgICAgaWYgKGlkID09PSBza2lwSWQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIUdldEVsZW1lbnRzQnlOYW1lU2V0Lmhhcyhkb21FbGVtZW50KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZpZWxkcy5wdXNoKHsKICAgICAgICBpZCwKICAgICAgICBleHBvcnRWYWx1ZSwKICAgICAgICBkb21FbGVtZW50CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIGZpZWxkczsKICB9CiAgc2hvdygpIHsKICAgIGlmICh0aGlzLmNvbnRhaW5lcikgewogICAgICB0aGlzLmNvbnRhaW5lci5oaWRkZW4gPSBmYWxzZTsKICAgIH0KICAgIHRoaXMucG9wdXA/Lm1heWJlU2hvdygpOwogIH0KICBoaWRlKCkgewogICAgaWYgKHRoaXMuY29udGFpbmVyKSB7CiAgICAgIHRoaXMuY29udGFpbmVyLmhpZGRlbiA9IHRydWU7CiAgICB9CiAgICB0aGlzLnBvcHVwPy5mb3JjZUhpZGUoKTsKICB9CiAgZ2V0RWxlbWVudHNUb1RyaWdnZXJQb3B1cCgpIHsKICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICB9CiAgYWRkSGlnaGxpZ2h0QXJlYSgpIHsKICAgIGNvbnN0IHRyaWdnZXJzID0gdGhpcy5nZXRFbGVtZW50c1RvVHJpZ2dlclBvcHVwKCk7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh0cmlnZ2VycykpIHsKICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIHRyaWdnZXJzKSB7CiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJoaWdobGlnaHRBcmVhIik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRyaWdnZXJzLmNsYXNzTGlzdC5hZGQoImhpZ2hsaWdodEFyZWEiKTsKICAgIH0KICB9CiAgX2VkaXRPbkRvdWJsZUNsaWNrKCkgewogICAgaWYgKCF0aGlzLl9pc0VkaXRhYmxlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgYW5ub3RhdGlvbkVkaXRvclR5cGU6IG1vZGUsCiAgICAgIGRhdGE6IHsKICAgICAgICBpZDogZWRpdElkCiAgICAgIH0KICAgIH0gPSB0aGlzOwogICAgdGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCAoKSA9PiB7CiAgICAgIHRoaXMubGlua1NlcnZpY2UuZXZlbnRCdXM/LmRpc3BhdGNoKCJzd2l0Y2hhbm5vdGF0aW9uZWRpdG9ybW9kZSIsIHsKICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgbW9kZSwKICAgICAgICBlZGl0SWQKICAgICAgfSk7CiAgICB9KTsKICB9CiAgZ2V0IHdpZHRoKCkgewogICAgcmV0dXJuIHRoaXMuZGF0YS5yZWN0WzJdIC0gdGhpcy5kYXRhLnJlY3RbMF07CiAgfQogIGdldCBoZWlnaHQoKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhLnJlY3RbM10gLSB0aGlzLmRhdGEucmVjdFsxXTsKICB9Cn0KY2xhc3MgTGlua0Fubm90YXRpb25FbGVtZW50IGV4dGVuZHMgQW5ub3RhdGlvbkVsZW1lbnQgewogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMsIG9wdGlvbnMgPSBudWxsKSB7CiAgICBzdXBlcihwYXJhbWV0ZXJzLCB7CiAgICAgIGlzUmVuZGVyYWJsZTogdHJ1ZSwKICAgICAgaWdub3JlQm9yZGVyOiAhIW9wdGlvbnM/Lmlnbm9yZUJvcmRlciwKICAgICAgY3JlYXRlUXVhZHJpbGF0ZXJhbHM6IHRydWUKICAgIH0pOwogICAgdGhpcy5pc1Rvb2x0aXBPbmx5ID0gcGFyYW1ldGVycy5kYXRhLmlzVG9vbHRpcE9ubHk7CiAgfQogIHJlbmRlcigpIHsKICAgIGNvbnN0IHsKICAgICAgZGF0YSwKICAgICAgbGlua1NlcnZpY2UKICAgIH0gPSB0aGlzOwogICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgIGxpbmsuc2V0QXR0cmlidXRlKCJkYXRhLWVsZW1lbnQtaWQiLCBkYXRhLmlkKTsKICAgIGxldCBpc0JvdW5kID0gZmFsc2U7CiAgICBpZiAoZGF0YS51cmwpIHsKICAgICAgbGlua1NlcnZpY2UuYWRkTGlua0F0dHJpYnV0ZXMobGluaywgZGF0YS51cmwsIGRhdGEubmV3V2luZG93KTsKICAgICAgaXNCb3VuZCA9IHRydWU7CiAgICB9IGVsc2UgaWYgKGRhdGEuYWN0aW9uKSB7CiAgICAgIHRoaXMuX2JpbmROYW1lZEFjdGlvbihsaW5rLCBkYXRhLmFjdGlvbik7CiAgICAgIGlzQm91bmQgPSB0cnVlOwogICAgfSBlbHNlIGlmIChkYXRhLmF0dGFjaG1lbnQpIHsKICAgICAgdGhpcy4jYmluZEF0dGFjaG1lbnQobGluaywgZGF0YS5hdHRhY2htZW50LCBkYXRhLmF0dGFjaG1lbnREZXN0KTsKICAgICAgaXNCb3VuZCA9IHRydWU7CiAgICB9IGVsc2UgaWYgKGRhdGEuc2V0T0NHU3RhdGUpIHsKICAgICAgdGhpcy4jYmluZFNldE9DR1N0YXRlKGxpbmssIGRhdGEuc2V0T0NHU3RhdGUpOwogICAgICBpc0JvdW5kID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAoZGF0YS5kZXN0KSB7CiAgICAgIHRoaXMuX2JpbmRMaW5rKGxpbmssIGRhdGEuZGVzdCk7CiAgICAgIGlzQm91bmQgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGRhdGEuYWN0aW9ucyAmJiAoZGF0YS5hY3Rpb25zLkFjdGlvbiB8fCBkYXRhLmFjdGlvbnNbIk1vdXNlIFVwIl0gfHwgZGF0YS5hY3Rpb25zWyJNb3VzZSBEb3duIl0pICYmIHRoaXMuZW5hYmxlU2NyaXB0aW5nICYmIHRoaXMuaGFzSlNBY3Rpb25zKSB7CiAgICAgICAgdGhpcy5fYmluZEpTQWN0aW9uKGxpbmssIGRhdGEpOwogICAgICAgIGlzQm91bmQgPSB0cnVlOwogICAgICB9CiAgICAgIGlmIChkYXRhLnJlc2V0Rm9ybSkgewogICAgICAgIHRoaXMuX2JpbmRSZXNldEZvcm1BY3Rpb24obGluaywgZGF0YS5yZXNldEZvcm0pOwogICAgICAgIGlzQm91bmQgPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNUb29sdGlwT25seSAmJiAhaXNCb3VuZCkgewogICAgICAgIHRoaXMuX2JpbmRMaW5rKGxpbmssICIiKTsKICAgICAgICBpc0JvdW5kID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgibGlua0Fubm90YXRpb24iKTsKICAgIGlmIChpc0JvdW5kKSB7CiAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZChsaW5rKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICB9CiAgI3NldEludGVybmFsTGluaygpIHsKICAgIHRoaXMuY29udGFpbmVyLnNldEF0dHJpYnV0ZSgiZGF0YS1pbnRlcm5hbC1saW5rIiwgIiIpOwogIH0KICBfYmluZExpbmsobGluaywgZGVzdGluYXRpb24pIHsKICAgIGxpbmsuaHJlZiA9IHRoaXMubGlua1NlcnZpY2UuZ2V0RGVzdGluYXRpb25IYXNoKGRlc3RpbmF0aW9uKTsKICAgIGxpbmsub25jbGljayA9ICgpID0+IHsKICAgICAgaWYgKGRlc3RpbmF0aW9uKSB7CiAgICAgICAgdGhpcy5saW5rU2VydmljZS5nb1RvRGVzdGluYXRpb24oZGVzdGluYXRpb24pOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICBpZiAoZGVzdGluYXRpb24gfHwgZGVzdGluYXRpb24gPT09ICIiKSB7CiAgICAgIHRoaXMuI3NldEludGVybmFsTGluaygpOwogICAgfQogIH0KICBfYmluZE5hbWVkQWN0aW9uKGxpbmssIGFjdGlvbikgewogICAgbGluay5ocmVmID0gdGhpcy5saW5rU2VydmljZS5nZXRBbmNob3JVcmwoIiIpOwogICAgbGluay5vbmNsaWNrID0gKCkgPT4gewogICAgICB0aGlzLmxpbmtTZXJ2aWNlLmV4ZWN1dGVOYW1lZEFjdGlvbihhY3Rpb24pOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwogICAgdGhpcy4jc2V0SW50ZXJuYWxMaW5rKCk7CiAgfQogICNiaW5kQXR0YWNobWVudChsaW5rLCBhdHRhY2htZW50LCBkZXN0ID0gbnVsbCkgewogICAgbGluay5ocmVmID0gdGhpcy5saW5rU2VydmljZS5nZXRBbmNob3JVcmwoIiIpOwogICAgaWYgKGF0dGFjaG1lbnQuZGVzY3JpcHRpb24pIHsKICAgICAgbGluay50aXRsZSA9IGF0dGFjaG1lbnQuZGVzY3JpcHRpb247CiAgICB9CiAgICBsaW5rLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgIHRoaXMuZG93bmxvYWRNYW5hZ2VyPy5vcGVuT3JEb3dubG9hZERhdGEoYXR0YWNobWVudC5jb250ZW50LCBhdHRhY2htZW50LmZpbGVuYW1lLCBkZXN0KTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKICAgIHRoaXMuI3NldEludGVybmFsTGluaygpOwogIH0KICAjYmluZFNldE9DR1N0YXRlKGxpbmssIGFjdGlvbikgewogICAgbGluay5ocmVmID0gdGhpcy5saW5rU2VydmljZS5nZXRBbmNob3JVcmwoIiIpOwogICAgbGluay5vbmNsaWNrID0gKCkgPT4gewogICAgICB0aGlzLmxpbmtTZXJ2aWNlLmV4ZWN1dGVTZXRPQ0dTdGF0ZShhY3Rpb24pOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwogICAgdGhpcy4jc2V0SW50ZXJuYWxMaW5rKCk7CiAgfQogIF9iaW5kSlNBY3Rpb24obGluaywgZGF0YSkgewogICAgbGluay5ocmVmID0gdGhpcy5saW5rU2VydmljZS5nZXRBbmNob3JVcmwoIiIpOwogICAgY29uc3QgbWFwID0gbmV3IE1hcChbWyJBY3Rpb24iLCAib25jbGljayJdLCBbIk1vdXNlIFVwIiwgIm9ubW91c2V1cCJdLCBbIk1vdXNlIERvd24iLCAib25tb3VzZWRvd24iXV0pOwogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5rZXlzKGRhdGEuYWN0aW9ucykpIHsKICAgICAgY29uc3QganNOYW1lID0gbWFwLmdldChuYW1lKTsKICAgICAgaWYgKCFqc05hbWUpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsaW5rW2pzTmFtZV0gPSAoKSA9PiB7CiAgICAgICAgdGhpcy5saW5rU2VydmljZS5ldmVudEJ1cz8uZGlzcGF0Y2goImRpc3BhdGNoZXZlbnRpbnNhbmRib3giLCB7CiAgICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgICBkZXRhaWw6IHsKICAgICAgICAgICAgaWQ6IGRhdGEuaWQsCiAgICAgICAgICAgIG5hbWUKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH07CiAgICB9CiAgICBpZiAoIWxpbmsub25jbGljaykgewogICAgICBsaW5rLm9uY2xpY2sgPSAoKSA9PiBmYWxzZTsKICAgIH0KICAgIHRoaXMuI3NldEludGVybmFsTGluaygpOwogIH0KICBfYmluZFJlc2V0Rm9ybUFjdGlvbihsaW5rLCByZXNldEZvcm0pIHsKICAgIGNvbnN0IG90aGVyQ2xpY2tBY3Rpb24gPSBsaW5rLm9uY2xpY2s7CiAgICBpZiAoIW90aGVyQ2xpY2tBY3Rpb24pIHsKICAgICAgbGluay5ocmVmID0gdGhpcy5saW5rU2VydmljZS5nZXRBbmNob3JVcmwoIiIpOwogICAgfQogICAgdGhpcy4jc2V0SW50ZXJuYWxMaW5rKCk7CiAgICBpZiAoIXRoaXMuX2ZpZWxkT2JqZWN0cykgewogICAgICB3YXJuKGBfYmluZFJlc2V0Rm9ybUFjdGlvbiAtICJyZXNldEZvcm0iIGFjdGlvbiBub3Qgc3VwcG9ydGVkLCBgICsgImVuc3VyZSB0aGF0IHRoZSBgZmllbGRPYmplY3RzYCBwYXJhbWV0ZXIgaXMgcHJvdmlkZWQuIik7CiAgICAgIGlmICghb3RoZXJDbGlja0FjdGlvbikgewogICAgICAgIGxpbmsub25jbGljayA9ICgpID0+IGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxpbmsub25jbGljayA9ICgpID0+IHsKICAgICAgb3RoZXJDbGlja0FjdGlvbj8uKCk7CiAgICAgIGNvbnN0IHsKICAgICAgICBmaWVsZHM6IHJlc2V0Rm9ybUZpZWxkcywKICAgICAgICByZWZzOiByZXNldEZvcm1SZWZzLAogICAgICAgIGluY2x1ZGUKICAgICAgfSA9IHJlc2V0Rm9ybTsKICAgICAgY29uc3QgYWxsRmllbGRzID0gW107CiAgICAgIGlmIChyZXNldEZvcm1GaWVsZHMubGVuZ3RoICE9PSAwIHx8IHJlc2V0Rm9ybVJlZnMubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgY29uc3QgZmllbGRJZHMgPSBuZXcgU2V0KHJlc2V0Rm9ybVJlZnMpOwogICAgICAgIGZvciAoY29uc3QgZmllbGROYW1lIG9mIHJlc2V0Rm9ybUZpZWxkcykgewogICAgICAgICAgY29uc3QgZmllbGRzID0gdGhpcy5fZmllbGRPYmplY3RzW2ZpZWxkTmFtZV0gfHwgW107CiAgICAgICAgICBmb3IgKGNvbnN0IHsKICAgICAgICAgICAgaWQKICAgICAgICAgIH0gb2YgZmllbGRzKSB7CiAgICAgICAgICAgIGZpZWxkSWRzLmFkZChpZCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3QgZmllbGRzIG9mIE9iamVjdC52YWx1ZXModGhpcy5fZmllbGRPYmplY3RzKSkgewogICAgICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiBmaWVsZHMpIHsKICAgICAgICAgICAgaWYgKGZpZWxkSWRzLmhhcyhmaWVsZC5pZCkgPT09IGluY2x1ZGUpIHsKICAgICAgICAgICAgICBhbGxGaWVsZHMucHVzaChmaWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjb25zdCBmaWVsZHMgb2YgT2JqZWN0LnZhbHVlcyh0aGlzLl9maWVsZE9iamVjdHMpKSB7CiAgICAgICAgICBhbGxGaWVsZHMucHVzaCguLi5maWVsZHMpOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBzdG9yYWdlID0gdGhpcy5hbm5vdGF0aW9uU3RvcmFnZTsKICAgICAgY29uc3QgYWxsSWRzID0gW107CiAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgYWxsRmllbGRzKSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgaWQKICAgICAgICB9ID0gZmllbGQ7CiAgICAgICAgYWxsSWRzLnB1c2goaWQpOwogICAgICAgIHN3aXRjaCAoZmllbGQudHlwZSkgewogICAgICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGZpZWxkLmRlZmF1bHRWYWx1ZSB8fCAiIjsKICAgICAgICAgICAgICBzdG9yYWdlLnNldFZhbHVlKGlkLCB7CiAgICAgICAgICAgICAgICB2YWx1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlICJjaGVja2JveCI6CiAgICAgICAgICBjYXNlICJyYWRpb2J1dHRvbiI6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGZpZWxkLmRlZmF1bHRWYWx1ZSA9PT0gZmllbGQuZXhwb3J0VmFsdWVzOwogICAgICAgICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgICAgICAgIHZhbHVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgImNvbWJvYm94IjoKICAgICAgICAgIGNhc2UgImxpc3Rib3giOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBmaWVsZC5kZWZhdWx0VmFsdWUgfHwgIiI7CiAgICAgICAgICAgICAgc3RvcmFnZS5zZXRWYWx1ZShpZCwgewogICAgICAgICAgICAgICAgdmFsdWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRvbUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1lbGVtZW50LWlkPSIke2lkfSJdYCk7CiAgICAgICAgaWYgKCFkb21FbGVtZW50KSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IGVsc2UgaWYgKCFHZXRFbGVtZW50c0J5TmFtZVNldC5oYXMoZG9tRWxlbWVudCkpIHsKICAgICAgICAgIHdhcm4oYF9iaW5kUmVzZXRGb3JtQWN0aW9uIC0gZWxlbWVudCBub3QgYWxsb3dlZDogJHtpZH1gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBkb21FbGVtZW50LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJyZXNldGZvcm0iKSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZW5hYmxlU2NyaXB0aW5nKSB7CiAgICAgICAgdGhpcy5saW5rU2VydmljZS5ldmVudEJ1cz8uZGlzcGF0Y2goImRpc3BhdGNoZXZlbnRpbnNhbmRib3giLCB7CiAgICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgICBkZXRhaWw6IHsKICAgICAgICAgICAgaWQ6ICJhcHAiLAogICAgICAgICAgICBpZHM6IGFsbElkcywKICAgICAgICAgICAgbmFtZTogIlJlc2V0Rm9ybSIKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwogIH0KfQpjbGFzcyBUZXh0QW5ub3RhdGlvbkVsZW1lbnQgZXh0ZW5kcyBBbm5vdGF0aW9uRWxlbWVudCB7CiAgY29uc3RydWN0b3IocGFyYW1ldGVycykgewogICAgc3VwZXIocGFyYW1ldGVycywgewogICAgICBpc1JlbmRlcmFibGU6IHRydWUKICAgIH0pOwogIH0KICByZW5kZXIoKSB7CiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJ0ZXh0QW5ub3RhdGlvbiIpOwogICAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICAgIGltYWdlLnNyYyA9IHRoaXMuaW1hZ2VSZXNvdXJjZXNQYXRoICsgImFubm90YXRpb24tIiArIHRoaXMuZGF0YS5uYW1lLnRvTG93ZXJDYXNlKCkgKyAiLnN2ZyI7CiAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsICJwZGZqcy10ZXh0LWFubm90YXRpb24tdHlwZSIpOwogICAgaW1hZ2Uuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4tYXJncyIsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgdHlwZTogdGhpcy5kYXRhLm5hbWUKICAgIH0pKTsKICAgIGlmICghdGhpcy5kYXRhLnBvcHVwUmVmICYmIHRoaXMuaGFzUG9wdXBEYXRhKSB7CiAgICAgIHRoaXMuX2NyZWF0ZVBvcHVwKCk7CiAgICB9CiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoaW1hZ2UpOwogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogIH0KfQpjbGFzcyBXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCBleHRlbmRzIEFubm90YXRpb25FbGVtZW50IHsKICByZW5kZXIoKSB7CiAgICByZXR1cm4gdGhpcy5jb250YWluZXI7CiAgfQogIHNob3dFbGVtZW50QW5kSGlkZUNhbnZhcyhlbGVtZW50KSB7CiAgICBpZiAodGhpcy5kYXRhLmhhc093bkNhbnZhcykgewogICAgICBpZiAoZWxlbWVudC5wcmV2aW91c1NpYmxpbmc/Lm5vZGVOYW1lID09PSAiQ0FOVkFTIikgewogICAgICAgIGVsZW1lbnQucHJldmlvdXNTaWJsaW5nLmhpZGRlbiA9IHRydWU7CiAgICAgIH0KICAgICAgZWxlbWVudC5oaWRkZW4gPSBmYWxzZTsKICAgIH0KICB9CiAgX2dldEtleU1vZGlmaWVyKGV2ZW50KSB7CiAgICByZXR1cm4gdXRpbF9GZWF0dXJlVGVzdC5wbGF0Zm9ybS5pc01hYyA/IGV2ZW50Lm1ldGFLZXkgOiBldmVudC5jdHJsS2V5OwogIH0KICBfc2V0RXZlbnRMaXN0ZW5lcihlbGVtZW50LCBlbGVtZW50RGF0YSwgYmFzZU5hbWUsIGV2ZW50TmFtZSwgdmFsdWVHZXR0ZXIpIHsKICAgIGlmIChiYXNlTmFtZS5pbmNsdWRlcygibW91c2UiKSkgewogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoYmFzZU5hbWUsIGV2ZW50ID0+IHsKICAgICAgICB0aGlzLmxpbmtTZXJ2aWNlLmV2ZW50QnVzPy5kaXNwYXRjaCgiZGlzcGF0Y2hldmVudGluc2FuZGJveCIsIHsKICAgICAgICAgIHNvdXJjZTogdGhpcywKICAgICAgICAgIGRldGFpbDogewogICAgICAgICAgICBpZDogdGhpcy5kYXRhLmlkLAogICAgICAgICAgICBuYW1lOiBldmVudE5hbWUsCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZUdldHRlcihldmVudCksCiAgICAgICAgICAgIHNoaWZ0OiBldmVudC5zaGlmdEtleSwKICAgICAgICAgICAgbW9kaWZpZXI6IHRoaXMuX2dldEtleU1vZGlmaWVyKGV2ZW50KQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihiYXNlTmFtZSwgZXZlbnQgPT4gewogICAgICAgIGlmIChiYXNlTmFtZSA9PT0gImJsdXIiKSB7CiAgICAgICAgICBpZiAoIWVsZW1lbnREYXRhLmZvY3VzZWQgfHwgIWV2ZW50LnJlbGF0ZWRUYXJnZXQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgZWxlbWVudERhdGEuZm9jdXNlZCA9IGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAoYmFzZU5hbWUgPT09ICJmb2N1cyIpIHsKICAgICAgICAgIGlmIChlbGVtZW50RGF0YS5mb2N1c2VkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGVsZW1lbnREYXRhLmZvY3VzZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIXZhbHVlR2V0dGVyKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMubGlua1NlcnZpY2UuZXZlbnRCdXM/LmRpc3BhdGNoKCJkaXNwYXRjaGV2ZW50aW5zYW5kYm94IiwgewogICAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgICAgZGV0YWlsOiB7CiAgICAgICAgICAgIGlkOiB0aGlzLmRhdGEuaWQsCiAgICAgICAgICAgIG5hbWU6IGV2ZW50TmFtZSwKICAgICAgICAgICAgdmFsdWU6IHZhbHVlR2V0dGVyKGV2ZW50KQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9CiAgX3NldEV2ZW50TGlzdGVuZXJzKGVsZW1lbnQsIGVsZW1lbnREYXRhLCBuYW1lcywgZ2V0dGVyKSB7CiAgICBmb3IgKGNvbnN0IFtiYXNlTmFtZSwgZXZlbnROYW1lXSBvZiBuYW1lcykgewogICAgICBpZiAoZXZlbnROYW1lID09PSAiQWN0aW9uIiB8fCB0aGlzLmRhdGEuYWN0aW9ucz8uW2V2ZW50TmFtZV0pIHsKICAgICAgICBpZiAoZXZlbnROYW1lID09PSAiRm9jdXMiIHx8IGV2ZW50TmFtZSA9PT0gIkJsdXIiKSB7CiAgICAgICAgICBlbGVtZW50RGF0YSB8fD0gewogICAgICAgICAgICBmb2N1c2VkOiBmYWxzZQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcihlbGVtZW50LCBlbGVtZW50RGF0YSwgYmFzZU5hbWUsIGV2ZW50TmFtZSwgZ2V0dGVyKTsKICAgICAgICBpZiAoZXZlbnROYW1lID09PSAiRm9jdXMiICYmICF0aGlzLmRhdGEuYWN0aW9ucz8uQmx1cikgewogICAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcihlbGVtZW50LCBlbGVtZW50RGF0YSwgImJsdXIiLCAiQmx1ciIsIG51bGwpOwogICAgICAgIH0gZWxzZSBpZiAoZXZlbnROYW1lID09PSAiQmx1ciIgJiYgIXRoaXMuZGF0YS5hY3Rpb25zPy5Gb2N1cykgewogICAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcihlbGVtZW50LCBlbGVtZW50RGF0YSwgImZvY3VzIiwgIkZvY3VzIiwgbnVsbCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIF9zZXRCYWNrZ3JvdW5kQ29sb3IoZWxlbWVudCkgewogICAgY29uc3QgY29sb3IgPSB0aGlzLmRhdGEuYmFja2dyb3VuZENvbG9yIHx8IG51bGw7CiAgICBlbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yID09PSBudWxsID8gInRyYW5zcGFyZW50IiA6IFV0aWwubWFrZUhleENvbG9yKGNvbG9yWzBdLCBjb2xvclsxXSwgY29sb3JbMl0pOwogIH0KICBfc2V0VGV4dFN0eWxlKGVsZW1lbnQpIHsKICAgIGNvbnN0IFRFWFRfQUxJR05NRU5UID0gWyJsZWZ0IiwgImNlbnRlciIsICJyaWdodCJdOwogICAgY29uc3QgewogICAgICBmb250Q29sb3IKICAgIH0gPSB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhOwogICAgY29uc3QgZm9udFNpemUgPSB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhLmZvbnRTaXplIHx8IGFubm90YXRpb25fbGF5ZXJfREVGQVVMVF9GT05UX1NJWkU7CiAgICBjb25zdCBzdHlsZSA9IGVsZW1lbnQuc3R5bGU7CiAgICBsZXQgY29tcHV0ZWRGb250U2l6ZTsKICAgIGNvbnN0IEJPUkRFUl9TSVpFID0gMjsKICAgIGNvbnN0IHJvdW5kVG9PbmVEZWNpbWFsID0geCA9PiBNYXRoLnJvdW5kKDEwICogeCkgLyAxMDsKICAgIGlmICh0aGlzLmRhdGEubXVsdGlMaW5lKSB7CiAgICAgIGNvbnN0IGhlaWdodCA9IE1hdGguYWJzKHRoaXMuZGF0YS5yZWN0WzNdIC0gdGhpcy5kYXRhLnJlY3RbMV0gLSBCT1JERVJfU0laRSk7CiAgICAgIGNvbnN0IG51bWJlck9mTGluZXMgPSBNYXRoLnJvdW5kKGhlaWdodCAvIChMSU5FX0ZBQ1RPUiAqIGZvbnRTaXplKSkgfHwgMTsKICAgICAgY29uc3QgbGluZUhlaWdodCA9IGhlaWdodCAvIG51bWJlck9mTGluZXM7CiAgICAgIGNvbXB1dGVkRm9udFNpemUgPSBNYXRoLm1pbihmb250U2l6ZSwgcm91bmRUb09uZURlY2ltYWwobGluZUhlaWdodCAvIExJTkVfRkFDVE9SKSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBoZWlnaHQgPSBNYXRoLmFicyh0aGlzLmRhdGEucmVjdFszXSAtIHRoaXMuZGF0YS5yZWN0WzFdIC0gQk9SREVSX1NJWkUpOwogICAgICBjb21wdXRlZEZvbnRTaXplID0gTWF0aC5taW4oZm9udFNpemUsIHJvdW5kVG9PbmVEZWNpbWFsKGhlaWdodCAvIExJTkVfRkFDVE9SKSk7CiAgICB9CiAgICBzdHlsZS5mb250U2l6ZSA9IGBjYWxjKCR7Y29tcHV0ZWRGb250U2l6ZX1weCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpYDsKICAgIHN0eWxlLmNvbG9yID0gVXRpbC5tYWtlSGV4Q29sb3IoZm9udENvbG9yWzBdLCBmb250Q29sb3JbMV0sIGZvbnRDb2xvclsyXSk7CiAgICBpZiAodGhpcy5kYXRhLnRleHRBbGlnbm1lbnQgIT09IG51bGwpIHsKICAgICAgc3R5bGUudGV4dEFsaWduID0gVEVYVF9BTElHTk1FTlRbdGhpcy5kYXRhLnRleHRBbGlnbm1lbnRdOwogICAgfQogIH0KICBfc2V0UmVxdWlyZWQoZWxlbWVudCwgaXNSZXF1aXJlZCkgewogICAgaWYgKGlzUmVxdWlyZWQpIHsKICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoInJlcXVpcmVkIiwgdHJ1ZSk7CiAgICB9IGVsc2UgewogICAgICBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgicmVxdWlyZWQiKTsKICAgIH0KICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCJhcmlhLXJlcXVpcmVkIiwgaXNSZXF1aXJlZCk7CiAgfQp9CmNsYXNzIFRleHRXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCBleHRlbmRzIFdpZGdldEFubm90YXRpb25FbGVtZW50IHsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpc1JlbmRlcmFibGUgPSBwYXJhbWV0ZXJzLnJlbmRlckZvcm1zIHx8IHBhcmFtZXRlcnMuZGF0YS5oYXNPd25DYW52YXMgfHwgIXBhcmFtZXRlcnMuZGF0YS5oYXNBcHBlYXJhbmNlICYmICEhcGFyYW1ldGVycy5kYXRhLmZpZWxkVmFsdWU7CiAgICBzdXBlcihwYXJhbWV0ZXJzLCB7CiAgICAgIGlzUmVuZGVyYWJsZQogICAgfSk7CiAgfQogIHNldFByb3BlcnR5T25TaWJsaW5ncyhiYXNlLCBrZXksIHZhbHVlLCBrZXlJblN0b3JhZ2UpIHsKICAgIGNvbnN0IHN0b3JhZ2UgPSB0aGlzLmFubm90YXRpb25TdG9yYWdlOwogICAgZm9yIChjb25zdCBlbGVtZW50IG9mIHRoaXMuX2dldEVsZW1lbnRzQnlOYW1lKGJhc2UubmFtZSwgYmFzZS5pZCkpIHsKICAgICAgaWYgKGVsZW1lbnQuZG9tRWxlbWVudCkgewogICAgICAgIGVsZW1lbnQuZG9tRWxlbWVudFtrZXldID0gdmFsdWU7CiAgICAgIH0KICAgICAgc3RvcmFnZS5zZXRWYWx1ZShlbGVtZW50LmlkLCB7CiAgICAgICAgW2tleUluU3RvcmFnZV06IHZhbHVlCiAgICAgIH0pOwogICAgfQogIH0KICByZW5kZXIoKSB7CiAgICBjb25zdCBzdG9yYWdlID0gdGhpcy5hbm5vdGF0aW9uU3RvcmFnZTsKICAgIGNvbnN0IGlkID0gdGhpcy5kYXRhLmlkOwogICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgidGV4dFdpZGdldEFubm90YXRpb24iKTsKICAgIGxldCBlbGVtZW50ID0gbnVsbDsKICAgIGlmICh0aGlzLnJlbmRlckZvcm1zKSB7CiAgICAgIGNvbnN0IHN0b3JlZERhdGEgPSBzdG9yYWdlLmdldFZhbHVlKGlkLCB7CiAgICAgICAgdmFsdWU6IHRoaXMuZGF0YS5maWVsZFZhbHVlCiAgICAgIH0pOwogICAgICBsZXQgdGV4dENvbnRlbnQgPSBzdG9yZWREYXRhLnZhbHVlIHx8ICIiOwogICAgICBjb25zdCBtYXhMZW4gPSBzdG9yYWdlLmdldFZhbHVlKGlkLCB7CiAgICAgICAgY2hhckxpbWl0OiB0aGlzLmRhdGEubWF4TGVuCiAgICAgIH0pLmNoYXJMaW1pdDsKICAgICAgaWYgKG1heExlbiAmJiB0ZXh0Q29udGVudC5sZW5ndGggPiBtYXhMZW4pIHsKICAgICAgICB0ZXh0Q29udGVudCA9IHRleHRDb250ZW50LnNsaWNlKDAsIG1heExlbik7CiAgICAgIH0KICAgICAgbGV0IGZpZWxkRm9ybWF0dGVkVmFsdWVzID0gc3RvcmVkRGF0YS5mb3JtYXR0ZWRWYWx1ZSB8fCB0aGlzLmRhdGEudGV4dENvbnRlbnQ/LmpvaW4oIlxuIikgfHwgbnVsbDsKICAgICAgaWYgKGZpZWxkRm9ybWF0dGVkVmFsdWVzICYmIHRoaXMuZGF0YS5jb21iKSB7CiAgICAgICAgZmllbGRGb3JtYXR0ZWRWYWx1ZXMgPSBmaWVsZEZvcm1hdHRlZFZhbHVlcy5yZXBsYWNlQWxsKC9ccysvZywgIiIpOwogICAgICB9CiAgICAgIGNvbnN0IGVsZW1lbnREYXRhID0gewogICAgICAgIHVzZXJWYWx1ZTogdGV4dENvbnRlbnQsCiAgICAgICAgZm9ybWF0dGVkVmFsdWU6IGZpZWxkRm9ybWF0dGVkVmFsdWVzLAogICAgICAgIGxhc3RDb21taXR0ZWRWYWx1ZTogbnVsbCwKICAgICAgICBjb21taXRLZXk6IDEsCiAgICAgICAgZm9jdXNlZDogZmFsc2UKICAgICAgfTsKICAgICAgaWYgKHRoaXMuZGF0YS5tdWx0aUxpbmUpIHsKICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGV4dGFyZWEiKTsKICAgICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gZmllbGRGb3JtYXR0ZWRWYWx1ZXMgPz8gdGV4dENvbnRlbnQ7CiAgICAgICAgaWYgKHRoaXMuZGF0YS5kb05vdFNjcm9sbCkgewogICAgICAgICAgZWxlbWVudC5zdHlsZS5vdmVyZmxvd1kgPSAiaGlkZGVuIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICAgICAgZWxlbWVudC50eXBlID0gdGhpcy5kYXRhLnBhc3N3b3JkID8gInBhc3N3b3JkIiA6ICJ0ZXh0IjsKICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgidmFsdWUiLCBmaWVsZEZvcm1hdHRlZFZhbHVlcyA/PyB0ZXh0Q29udGVudCk7CiAgICAgICAgaWYgKHRoaXMuZGF0YS5kb05vdFNjcm9sbCkgewogICAgICAgICAgZWxlbWVudC5zdHlsZS5vdmVyZmxvd1ggPSAiaGlkZGVuIjsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZGF0YS5oYXNPd25DYW52YXMpIHsKICAgICAgICBlbGVtZW50LmhpZGRlbiA9IHRydWU7CiAgICAgIH0KICAgICAgR2V0RWxlbWVudHNCeU5hbWVTZXQuYWRkKGVsZW1lbnQpOwogICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1lbGVtZW50LWlkIiwgaWQpOwogICAgICBlbGVtZW50LmRpc2FibGVkID0gdGhpcy5kYXRhLnJlYWRPbmx5OwogICAgICBlbGVtZW50Lm5hbWUgPSB0aGlzLmRhdGEuZmllbGROYW1lOwogICAgICBlbGVtZW50LnRhYkluZGV4ID0gREVGQVVMVF9UQUJfSU5ERVg7CiAgICAgIHRoaXMuX3NldFJlcXVpcmVkKGVsZW1lbnQsIHRoaXMuZGF0YS5yZXF1aXJlZCk7CiAgICAgIGlmIChtYXhMZW4pIHsKICAgICAgICBlbGVtZW50Lm1heExlbmd0aCA9IG1heExlbjsKICAgICAgfQogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgZXZlbnQgPT4gewogICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgIHZhbHVlOiBldmVudC50YXJnZXQudmFsdWUKICAgICAgICB9KTsKICAgICAgICB0aGlzLnNldFByb3BlcnR5T25TaWJsaW5ncyhlbGVtZW50LCAidmFsdWUiLCBldmVudC50YXJnZXQudmFsdWUsICJ2YWx1ZSIpOwogICAgICAgIGVsZW1lbnREYXRhLmZvcm1hdHRlZFZhbHVlID0gbnVsbDsKICAgICAgfSk7CiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigicmVzZXRmb3JtIiwgZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSA/PyAiIjsKICAgICAgICBlbGVtZW50LnZhbHVlID0gZWxlbWVudERhdGEudXNlclZhbHVlID0gZGVmYXVsdFZhbHVlOwogICAgICAgIGVsZW1lbnREYXRhLmZvcm1hdHRlZFZhbHVlID0gbnVsbDsKICAgICAgfSk7CiAgICAgIGxldCBibHVyTGlzdGVuZXIgPSBldmVudCA9PiB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgZm9ybWF0dGVkVmFsdWUKICAgICAgICB9ID0gZWxlbWVudERhdGE7CiAgICAgICAgaWYgKGZvcm1hdHRlZFZhbHVlICE9PSBudWxsICYmIGZvcm1hdHRlZFZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9IGZvcm1hdHRlZFZhbHVlOwogICAgICAgIH0KICAgICAgICBldmVudC50YXJnZXQuc2Nyb2xsTGVmdCA9IDA7CiAgICAgIH07CiAgICAgIGlmICh0aGlzLmVuYWJsZVNjcmlwdGluZyAmJiB0aGlzLmhhc0pTQWN0aW9ucykgewogICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiZm9jdXMiLCBldmVudCA9PiB7CiAgICAgICAgICBpZiAoZWxlbWVudERhdGEuZm9jdXNlZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIHRhcmdldAogICAgICAgICAgfSA9IGV2ZW50OwogICAgICAgICAgaWYgKGVsZW1lbnREYXRhLnVzZXJWYWx1ZSkgewogICAgICAgICAgICB0YXJnZXQudmFsdWUgPSBlbGVtZW50RGF0YS51c2VyVmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBlbGVtZW50RGF0YS5sYXN0Q29tbWl0dGVkVmFsdWUgPSB0YXJnZXQudmFsdWU7CiAgICAgICAgICBlbGVtZW50RGF0YS5jb21taXRLZXkgPSAxOwogICAgICAgICAgaWYgKCF0aGlzLmRhdGEuYWN0aW9ucz8uRm9jdXMpIHsKICAgICAgICAgICAgZWxlbWVudERhdGEuZm9jdXNlZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJ1cGRhdGVmcm9tc2FuZGJveCIsIGpzRXZlbnQgPT4gewogICAgICAgICAgdGhpcy5zaG93RWxlbWVudEFuZEhpZGVDYW52YXMoanNFdmVudC50YXJnZXQpOwogICAgICAgICAgY29uc3QgYWN0aW9ucyA9IHsKICAgICAgICAgICAgdmFsdWUoZXZlbnQpIHsKICAgICAgICAgICAgICBlbGVtZW50RGF0YS51c2VyVmFsdWUgPSBldmVudC5kZXRhaWwudmFsdWUgPz8gIiI7CiAgICAgICAgICAgICAgc3RvcmFnZS5zZXRWYWx1ZShpZCwgewogICAgICAgICAgICAgICAgdmFsdWU6IGVsZW1lbnREYXRhLnVzZXJWYWx1ZS50b1N0cmluZygpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gZWxlbWVudERhdGEudXNlclZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBmb3JtYXR0ZWRWYWx1ZShldmVudCkgewogICAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgIGZvcm1hdHRlZFZhbHVlCiAgICAgICAgICAgICAgfSA9IGV2ZW50LmRldGFpbDsKICAgICAgICAgICAgICBlbGVtZW50RGF0YS5mb3JtYXR0ZWRWYWx1ZSA9IGZvcm1hdHRlZFZhbHVlOwogICAgICAgICAgICAgIGlmIChmb3JtYXR0ZWRWYWx1ZSAhPT0gbnVsbCAmJiBmb3JtYXR0ZWRWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIGV2ZW50LnRhcmdldCAhPT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgewogICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gZm9ybWF0dGVkVmFsdWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgICAgICAgIGZvcm1hdHRlZFZhbHVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNlbFJhbmdlKGV2ZW50KSB7CiAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnNldFNlbGVjdGlvblJhbmdlKC4uLmV2ZW50LmRldGFpbC5zZWxSYW5nZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNoYXJMaW1pdDogZXZlbnQgPT4gewogICAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgIGNoYXJMaW1pdAogICAgICAgICAgICAgIH0gPSBldmVudC5kZXRhaWw7CiAgICAgICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgICAgdGFyZ2V0CiAgICAgICAgICAgICAgfSA9IGV2ZW50OwogICAgICAgICAgICAgIGlmIChjaGFyTGltaXQgPT09IDApIHsKICAgICAgICAgICAgICAgIHRhcmdldC5yZW1vdmVBdHRyaWJ1dGUoIm1heExlbmd0aCIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0YXJnZXQuc2V0QXR0cmlidXRlKCJtYXhMZW5ndGgiLCBjaGFyTGltaXQpOwogICAgICAgICAgICAgIGxldCB2YWx1ZSA9IGVsZW1lbnREYXRhLnVzZXJWYWx1ZTsKICAgICAgICAgICAgICBpZiAoIXZhbHVlIHx8IHZhbHVlLmxlbmd0aCA8PSBjaGFyTGltaXQpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5zbGljZSgwLCBjaGFyTGltaXQpOwogICAgICAgICAgICAgIHRhcmdldC52YWx1ZSA9IGVsZW1lbnREYXRhLnVzZXJWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgICAgICAgIHZhbHVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy5saW5rU2VydmljZS5ldmVudEJ1cz8uZGlzcGF0Y2goImRpc3BhdGNoZXZlbnRpbnNhbmRib3giLCB7CiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgICAgICAgICBkZXRhaWw6IHsKICAgICAgICAgICAgICAgICAgaWQsCiAgICAgICAgICAgICAgICAgIG5hbWU6ICJLZXlzdHJva2UiLAogICAgICAgICAgICAgICAgICB2YWx1ZSwKICAgICAgICAgICAgICAgICAgd2lsbENvbW1pdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgY29tbWl0S2V5OiAxLAogICAgICAgICAgICAgICAgICBzZWxTdGFydDogdGFyZ2V0LnNlbGVjdGlvblN0YXJ0LAogICAgICAgICAgICAgICAgICBzZWxFbmQ6IHRhcmdldC5zZWxlY3Rpb25FbmQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoRXZlbnRGcm9tU2FuZGJveChhY3Rpb25zLCBqc0V2ZW50KTsKICAgICAgICB9KTsKICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBldmVudCA9PiB7CiAgICAgICAgICBlbGVtZW50RGF0YS5jb21taXRLZXkgPSAxOwogICAgICAgICAgbGV0IGNvbW1pdEtleSA9IC0xOwogICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gIkVzY2FwZSIpIHsKICAgICAgICAgICAgY29tbWl0S2V5ID0gMDsKICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5ID09PSAiRW50ZXIiICYmICF0aGlzLmRhdGEubXVsdGlMaW5lKSB7CiAgICAgICAgICAgIGNvbW1pdEtleSA9IDI7CiAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gIlRhYiIpIHsKICAgICAgICAgICAgZWxlbWVudERhdGEuY29tbWl0S2V5ID0gMzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjb21taXRLZXkgPT09IC0xKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgdmFsdWUKICAgICAgICAgIH0gPSBldmVudC50YXJnZXQ7CiAgICAgICAgICBpZiAoZWxlbWVudERhdGEubGFzdENvbW1pdHRlZFZhbHVlID09PSB2YWx1ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBlbGVtZW50RGF0YS5sYXN0Q29tbWl0dGVkVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgIGVsZW1lbnREYXRhLnVzZXJWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgdGhpcy5saW5rU2VydmljZS5ldmVudEJ1cz8uZGlzcGF0Y2goImRpc3BhdGNoZXZlbnRpbnNhbmRib3giLCB7CiAgICAgICAgICAgIHNvdXJjZTogdGhpcywKICAgICAgICAgICAgZGV0YWlsOiB7CiAgICAgICAgICAgICAgaWQsCiAgICAgICAgICAgICAgbmFtZTogIktleXN0cm9rZSIsCiAgICAgICAgICAgICAgdmFsdWUsCiAgICAgICAgICAgICAgd2lsbENvbW1pdDogdHJ1ZSwKICAgICAgICAgICAgICBjb21taXRLZXksCiAgICAgICAgICAgICAgc2VsU3RhcnQ6IGV2ZW50LnRhcmdldC5zZWxlY3Rpb25TdGFydCwKICAgICAgICAgICAgICBzZWxFbmQ6IGV2ZW50LnRhcmdldC5zZWxlY3Rpb25FbmQKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgX2JsdXJMaXN0ZW5lciA9IGJsdXJMaXN0ZW5lcjsKICAgICAgICBibHVyTGlzdGVuZXIgPSBudWxsOwogICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiYmx1ciIsIGV2ZW50ID0+IHsKICAgICAgICAgIGlmICghZWxlbWVudERhdGEuZm9jdXNlZCB8fCAhZXZlbnQucmVsYXRlZFRhcmdldCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXRoaXMuZGF0YS5hY3Rpb25zPy5CbHVyKSB7CiAgICAgICAgICAgIGVsZW1lbnREYXRhLmZvY3VzZWQgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgdmFsdWUKICAgICAgICAgIH0gPSBldmVudC50YXJnZXQ7CiAgICAgICAgICBlbGVtZW50RGF0YS51c2VyVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgIGlmIChlbGVtZW50RGF0YS5sYXN0Q29tbWl0dGVkVmFsdWUgIT09IHZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMubGlua1NlcnZpY2UuZXZlbnRCdXM/LmRpc3BhdGNoKCJkaXNwYXRjaGV2ZW50aW5zYW5kYm94IiwgewogICAgICAgICAgICAgIHNvdXJjZTogdGhpcywKICAgICAgICAgICAgICBkZXRhaWw6IHsKICAgICAgICAgICAgICAgIGlkLAogICAgICAgICAgICAgICAgbmFtZTogIktleXN0cm9rZSIsCiAgICAgICAgICAgICAgICB2YWx1ZSwKICAgICAgICAgICAgICAgIHdpbGxDb21taXQ6IHRydWUsCiAgICAgICAgICAgICAgICBjb21taXRLZXk6IGVsZW1lbnREYXRhLmNvbW1pdEtleSwKICAgICAgICAgICAgICAgIHNlbFN0YXJ0OiBldmVudC50YXJnZXQuc2VsZWN0aW9uU3RhcnQsCiAgICAgICAgICAgICAgICBzZWxFbmQ6IGV2ZW50LnRhcmdldC5zZWxlY3Rpb25FbmQKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgX2JsdXJMaXN0ZW5lcihldmVudCk7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKHRoaXMuZGF0YS5hY3Rpb25zPy5LZXlzdHJva2UpIHsKICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JlaW5wdXQiLCBldmVudCA9PiB7CiAgICAgICAgICAgIGVsZW1lbnREYXRhLmxhc3RDb21taXR0ZWRWYWx1ZSA9IG51bGw7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICBkYXRhLAogICAgICAgICAgICAgIHRhcmdldAogICAgICAgICAgICB9ID0gZXZlbnQ7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICB2YWx1ZSwKICAgICAgICAgICAgICBzZWxlY3Rpb25TdGFydCwKICAgICAgICAgICAgICBzZWxlY3Rpb25FbmQKICAgICAgICAgICAgfSA9IHRhcmdldDsKICAgICAgICAgICAgbGV0IHNlbFN0YXJ0ID0gc2VsZWN0aW9uU3RhcnQsCiAgICAgICAgICAgICAgc2VsRW5kID0gc2VsZWN0aW9uRW5kOwogICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmlucHV0VHlwZSkgewogICAgICAgICAgICAgIGNhc2UgImRlbGV0ZVdvcmRCYWNrd2FyZCI6CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gdmFsdWUuc3Vic3RyaW5nKDAsIHNlbGVjdGlvblN0YXJ0KS5tYXRjaCgvXHcqW15cd10qJC8pOwogICAgICAgICAgICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgICAgICAgICAgICBzZWxTdGFydCAtPSBtYXRjaFswXS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FzZSAiZGVsZXRlV29yZEZvcndhcmQiOgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IHZhbHVlLnN1YnN0cmluZyhzZWxlY3Rpb25TdGFydCkubWF0Y2goL15bXlx3XSpcdyovKTsKICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsRW5kICs9IG1hdGNoWzBdLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlICJkZWxldGVDb250ZW50QmFja3dhcmQiOgogICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvblN0YXJ0ID09PSBzZWxlY3Rpb25FbmQpIHsKICAgICAgICAgICAgICAgICAgc2VsU3RhcnQgLT0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgImRlbGV0ZUNvbnRlbnRGb3J3YXJkIjoKICAgICAgICAgICAgICAgIGlmIChzZWxlY3Rpb25TdGFydCA9PT0gc2VsZWN0aW9uRW5kKSB7CiAgICAgICAgICAgICAgICAgIHNlbEVuZCArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdGhpcy5saW5rU2VydmljZS5ldmVudEJ1cz8uZGlzcGF0Y2goImRpc3BhdGNoZXZlbnRpbnNhbmRib3giLCB7CiAgICAgICAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgICAgICAgIGRldGFpbDogewogICAgICAgICAgICAgICAgaWQsCiAgICAgICAgICAgICAgICBuYW1lOiAiS2V5c3Ryb2tlIiwKICAgICAgICAgICAgICAgIHZhbHVlLAogICAgICAgICAgICAgICAgY2hhbmdlOiBkYXRhIHx8ICIiLAogICAgICAgICAgICAgICAgd2lsbENvbW1pdDogZmFsc2UsCiAgICAgICAgICAgICAgICBzZWxTdGFydCwKICAgICAgICAgICAgICAgIHNlbEVuZAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoZWxlbWVudCwgZWxlbWVudERhdGEsIFtbImZvY3VzIiwgIkZvY3VzIl0sIFsiYmx1ciIsICJCbHVyIl0sIFsibW91c2Vkb3duIiwgIk1vdXNlIERvd24iXSwgWyJtb3VzZWVudGVyIiwgIk1vdXNlIEVudGVyIl0sIFsibW91c2VsZWF2ZSIsICJNb3VzZSBFeGl0Il0sIFsibW91c2V1cCIsICJNb3VzZSBVcCJdXSwgZXZlbnQgPT4gZXZlbnQudGFyZ2V0LnZhbHVlKTsKICAgICAgfQogICAgICBpZiAoYmx1ckxpc3RlbmVyKSB7CiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJibHVyIiwgYmx1ckxpc3RlbmVyKTsKICAgICAgfQogICAgICBpZiAodGhpcy5kYXRhLmNvbWIpIHsKICAgICAgICBjb25zdCBmaWVsZFdpZHRoID0gdGhpcy5kYXRhLnJlY3RbMl0gLSB0aGlzLmRhdGEucmVjdFswXTsKICAgICAgICBjb25zdCBjb21iV2lkdGggPSBmaWVsZFdpZHRoIC8gbWF4TGVuOwogICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgiY29tYiIpOwogICAgICAgIGVsZW1lbnQuc3R5bGUubGV0dGVyU3BhY2luZyA9IGBjYWxjKCR7Y29tYldpZHRofXB4ICogdmFyKC0tdG90YWwtc2NhbGUtZmFjdG9yKSAtIDFjaClgOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZTsKICAgICAgZWxlbWVudC5zdHlsZS52ZXJ0aWNhbEFsaWduID0gIm1pZGRsZSI7CiAgICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICJ0YWJsZS1jZWxsIjsKICAgICAgaWYgKHRoaXMuZGF0YS5oYXNPd25DYW52YXMpIHsKICAgICAgICBlbGVtZW50LmhpZGRlbiA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuX3NldFRleHRTdHlsZShlbGVtZW50KTsKICAgIHRoaXMuX3NldEJhY2tncm91bmRDb2xvcihlbGVtZW50KTsKICAgIHRoaXMuX3NldERlZmF1bHRQcm9wZXJ0aWVzRnJvbUpTKGVsZW1lbnQpOwogICAgdGhpcy5jb250YWluZXIuYXBwZW5kKGVsZW1lbnQpOwogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogIH0KfQpjbGFzcyBTaWduYXR1cmVXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCBleHRlbmRzIFdpZGdldEFubm90YXRpb25FbGVtZW50IHsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICBzdXBlcihwYXJhbWV0ZXJzLCB7CiAgICAgIGlzUmVuZGVyYWJsZTogISFwYXJhbWV0ZXJzLmRhdGEuaGFzT3duQ2FudmFzCiAgICB9KTsKICB9Cn0KY2xhc3MgQ2hlY2tib3hXaWRnZXRBbm5vdGF0aW9uRWxlbWVudCBleHRlbmRzIFdpZGdldEFubm90YXRpb25FbGVtZW50IHsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICBzdXBlcihwYXJhbWV0ZXJzLCB7CiAgICAgIGlzUmVuZGVyYWJsZTogcGFyYW1ldGVycy5yZW5kZXJGb3JtcwogICAgfSk7CiAgfQogIHJlbmRlcigpIHsKICAgIGNvbnN0IHN0b3JhZ2UgPSB0aGlzLmFubm90YXRpb25TdG9yYWdlOwogICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgIGNvbnN0IGlkID0gZGF0YS5pZDsKICAgIGxldCB2YWx1ZSA9IHN0b3JhZ2UuZ2V0VmFsdWUoaWQsIHsKICAgICAgdmFsdWU6IGRhdGEuZXhwb3J0VmFsdWUgPT09IGRhdGEuZmllbGRWYWx1ZQogICAgfSkudmFsdWU7CiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIikgewogICAgICB2YWx1ZSA9IHZhbHVlICE9PSAiT2ZmIjsKICAgICAgc3RvcmFnZS5zZXRWYWx1ZShpZCwgewogICAgICAgIHZhbHVlCiAgICAgIH0pOwogICAgfQogICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgiYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbiIsICJjaGVja0JveCIpOwogICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICBHZXRFbGVtZW50c0J5TmFtZVNldC5hZGQoZWxlbWVudCk7CiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1lbGVtZW50LWlkIiwgaWQpOwogICAgZWxlbWVudC5kaXNhYmxlZCA9IGRhdGEucmVhZE9ubHk7CiAgICB0aGlzLl9zZXRSZXF1aXJlZChlbGVtZW50LCB0aGlzLmRhdGEucmVxdWlyZWQpOwogICAgZWxlbWVudC50eXBlID0gImNoZWNrYm94IjsKICAgIGVsZW1lbnQubmFtZSA9IGRhdGEuZmllbGROYW1lOwogICAgaWYgKHZhbHVlKSB7CiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICB9CiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgiZXhwb3J0VmFsdWUiLCBkYXRhLmV4cG9ydFZhbHVlKTsKICAgIGVsZW1lbnQudGFiSW5kZXggPSBERUZBVUxUX1RBQl9JTkRFWDsKICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZXZlbnQgPT4gewogICAgICBjb25zdCB7CiAgICAgICAgbmFtZSwKICAgICAgICBjaGVja2VkCiAgICAgIH0gPSBldmVudC50YXJnZXQ7CiAgICAgIGZvciAoY29uc3QgY2hlY2tib3ggb2YgdGhpcy5fZ2V0RWxlbWVudHNCeU5hbWUobmFtZSwgaWQpKSB7CiAgICAgICAgY29uc3QgY3VyQ2hlY2tlZCA9IGNoZWNrZWQgJiYgY2hlY2tib3guZXhwb3J0VmFsdWUgPT09IGRhdGEuZXhwb3J0VmFsdWU7CiAgICAgICAgaWYgKGNoZWNrYm94LmRvbUVsZW1lbnQpIHsKICAgICAgICAgIGNoZWNrYm94LmRvbUVsZW1lbnQuY2hlY2tlZCA9IGN1ckNoZWNrZWQ7CiAgICAgICAgfQogICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoY2hlY2tib3guaWQsIHsKICAgICAgICAgIHZhbHVlOiBjdXJDaGVja2VkCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgc3RvcmFnZS5zZXRWYWx1ZShpZCwgewogICAgICAgIHZhbHVlOiBjaGVja2VkCiAgICAgIH0pOwogICAgfSk7CiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoInJlc2V0Zm9ybSIsIGV2ZW50ID0+IHsKICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0gZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSB8fCAiT2ZmIjsKICAgICAgZXZlbnQudGFyZ2V0LmNoZWNrZWQgPSBkZWZhdWx0VmFsdWUgPT09IGRhdGEuZXhwb3J0VmFsdWU7CiAgICB9KTsKICAgIGlmICh0aGlzLmVuYWJsZVNjcmlwdGluZyAmJiB0aGlzLmhhc0pTQWN0aW9ucykgewogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoInVwZGF0ZWZyb21zYW5kYm94IiwganNFdmVudCA9PiB7CiAgICAgICAgY29uc3QgYWN0aW9ucyA9IHsKICAgICAgICAgIHZhbHVlKGV2ZW50KSB7CiAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jaGVja2VkID0gZXZlbnQuZGV0YWlsLnZhbHVlICE9PSAiT2ZmIjsKICAgICAgICAgICAgc3RvcmFnZS5zZXRWYWx1ZShpZCwgewogICAgICAgICAgICAgIHZhbHVlOiBldmVudC50YXJnZXQuY2hlY2tlZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHRoaXMuX2Rpc3BhdGNoRXZlbnRGcm9tU2FuZGJveChhY3Rpb25zLCBqc0V2ZW50KTsKICAgICAgfSk7CiAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKGVsZW1lbnQsIG51bGwsIFtbImNoYW5nZSIsICJWYWxpZGF0ZSJdLCBbImNoYW5nZSIsICJBY3Rpb24iXSwgWyJmb2N1cyIsICJGb2N1cyJdLCBbImJsdXIiLCAiQmx1ciJdLCBbIm1vdXNlZG93biIsICJNb3VzZSBEb3duIl0sIFsibW91c2VlbnRlciIsICJNb3VzZSBFbnRlciJdLCBbIm1vdXNlbGVhdmUiLCAiTW91c2UgRXhpdCJdLCBbIm1vdXNldXAiLCAiTW91c2UgVXAiXV0sIGV2ZW50ID0+IGV2ZW50LnRhcmdldC5jaGVja2VkKTsKICAgIH0KICAgIHRoaXMuX3NldEJhY2tncm91bmRDb2xvcihlbGVtZW50KTsKICAgIHRoaXMuX3NldERlZmF1bHRQcm9wZXJ0aWVzRnJvbUpTKGVsZW1lbnQpOwogICAgdGhpcy5jb250YWluZXIuYXBwZW5kKGVsZW1lbnQpOwogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogIH0KfQpjbGFzcyBSYWRpb0J1dHRvbldpZGdldEFubm90YXRpb25FbGVtZW50IGV4dGVuZHMgV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQgewogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgIHN1cGVyKHBhcmFtZXRlcnMsIHsKICAgICAgaXNSZW5kZXJhYmxlOiBwYXJhbWV0ZXJzLnJlbmRlckZvcm1zCiAgICB9KTsKICB9CiAgcmVuZGVyKCkgewogICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgiYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbiIsICJyYWRpb0J1dHRvbiIpOwogICAgY29uc3Qgc3RvcmFnZSA9IHRoaXMuYW5ub3RhdGlvblN0b3JhZ2U7CiAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgY29uc3QgaWQgPSBkYXRhLmlkOwogICAgbGV0IHZhbHVlID0gc3RvcmFnZS5nZXRWYWx1ZShpZCwgewogICAgICB2YWx1ZTogZGF0YS5maWVsZFZhbHVlID09PSBkYXRhLmJ1dHRvblZhbHVlCiAgICB9KS52YWx1ZTsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgIHZhbHVlID0gdmFsdWUgIT09IGRhdGEuYnV0dG9uVmFsdWU7CiAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICB2YWx1ZQogICAgICB9KTsKICAgIH0KICAgIGlmICh2YWx1ZSkgewogICAgICBmb3IgKGNvbnN0IHJhZGlvIG9mIHRoaXMuX2dldEVsZW1lbnRzQnlOYW1lKGRhdGEuZmllbGROYW1lLCBpZCkpIHsKICAgICAgICBzdG9yYWdlLnNldFZhbHVlKHJhZGlvLmlkLCB7CiAgICAgICAgICB2YWx1ZTogZmFsc2UKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICBHZXRFbGVtZW50c0J5TmFtZVNldC5hZGQoZWxlbWVudCk7CiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1lbGVtZW50LWlkIiwgaWQpOwogICAgZWxlbWVudC5kaXNhYmxlZCA9IGRhdGEucmVhZE9ubHk7CiAgICB0aGlzLl9zZXRSZXF1aXJlZChlbGVtZW50LCB0aGlzLmRhdGEucmVxdWlyZWQpOwogICAgZWxlbWVudC50eXBlID0gInJhZGlvIjsKICAgIGVsZW1lbnQubmFtZSA9IGRhdGEuZmllbGROYW1lOwogICAgaWYgKHZhbHVlKSB7CiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICB9CiAgICBlbGVtZW50LnRhYkluZGV4ID0gREVGQVVMVF9UQUJfSU5ERVg7CiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGV2ZW50ID0+IHsKICAgICAgY29uc3QgewogICAgICAgIG5hbWUsCiAgICAgICAgY2hlY2tlZAogICAgICB9ID0gZXZlbnQudGFyZ2V0OwogICAgICBmb3IgKGNvbnN0IHJhZGlvIG9mIHRoaXMuX2dldEVsZW1lbnRzQnlOYW1lKG5hbWUsIGlkKSkgewogICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUocmFkaW8uaWQsIHsKICAgICAgICAgIHZhbHVlOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICB2YWx1ZTogY2hlY2tlZAogICAgICB9KTsKICAgIH0pOwogICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJyZXNldGZvcm0iLCBldmVudCA9PiB7CiAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IGRhdGEuZGVmYXVsdEZpZWxkVmFsdWU7CiAgICAgIGV2ZW50LnRhcmdldC5jaGVja2VkID0gZGVmYXVsdFZhbHVlICE9PSBudWxsICYmIGRlZmF1bHRWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIGRlZmF1bHRWYWx1ZSA9PT0gZGF0YS5idXR0b25WYWx1ZTsKICAgIH0pOwogICAgaWYgKHRoaXMuZW5hYmxlU2NyaXB0aW5nICYmIHRoaXMuaGFzSlNBY3Rpb25zKSB7CiAgICAgIGNvbnN0IHBkZkJ1dHRvblZhbHVlID0gZGF0YS5idXR0b25WYWx1ZTsKICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJ1cGRhdGVmcm9tc2FuZGJveCIsIGpzRXZlbnQgPT4gewogICAgICAgIGNvbnN0IGFjdGlvbnMgPSB7CiAgICAgICAgICB2YWx1ZTogZXZlbnQgPT4gewogICAgICAgICAgICBjb25zdCBjaGVja2VkID0gcGRmQnV0dG9uVmFsdWUgPT09IGV2ZW50LmRldGFpbC52YWx1ZTsKICAgICAgICAgICAgZm9yIChjb25zdCByYWRpbyBvZiB0aGlzLl9nZXRFbGVtZW50c0J5TmFtZShldmVudC50YXJnZXQubmFtZSkpIHsKICAgICAgICAgICAgICBjb25zdCBjdXJDaGVja2VkID0gY2hlY2tlZCAmJiByYWRpby5pZCA9PT0gaWQ7CiAgICAgICAgICAgICAgaWYgKHJhZGlvLmRvbUVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIHJhZGlvLmRvbUVsZW1lbnQuY2hlY2tlZCA9IGN1ckNoZWNrZWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUocmFkaW8uaWQsIHsKICAgICAgICAgICAgICAgIHZhbHVlOiBjdXJDaGVja2VkCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHRoaXMuX2Rpc3BhdGNoRXZlbnRGcm9tU2FuZGJveChhY3Rpb25zLCBqc0V2ZW50KTsKICAgICAgfSk7CiAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKGVsZW1lbnQsIG51bGwsIFtbImNoYW5nZSIsICJWYWxpZGF0ZSJdLCBbImNoYW5nZSIsICJBY3Rpb24iXSwgWyJmb2N1cyIsICJGb2N1cyJdLCBbImJsdXIiLCAiQmx1ciJdLCBbIm1vdXNlZG93biIsICJNb3VzZSBEb3duIl0sIFsibW91c2VlbnRlciIsICJNb3VzZSBFbnRlciJdLCBbIm1vdXNlbGVhdmUiLCAiTW91c2UgRXhpdCJdLCBbIm1vdXNldXAiLCAiTW91c2UgVXAiXV0sIGV2ZW50ID0+IGV2ZW50LnRhcmdldC5jaGVja2VkKTsKICAgIH0KICAgIHRoaXMuX3NldEJhY2tncm91bmRDb2xvcihlbGVtZW50KTsKICAgIHRoaXMuX3NldERlZmF1bHRQcm9wZXJ0aWVzRnJvbUpTKGVsZW1lbnQpOwogICAgdGhpcy5jb250YWluZXIuYXBwZW5kKGVsZW1lbnQpOwogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogIH0KfQpjbGFzcyBQdXNoQnV0dG9uV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQgZXh0ZW5kcyBMaW5rQW5ub3RhdGlvbkVsZW1lbnQgewogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgIHN1cGVyKHBhcmFtZXRlcnMsIHsKICAgICAgaWdub3JlQm9yZGVyOiBwYXJhbWV0ZXJzLmRhdGEuaGFzQXBwZWFyYW5jZQogICAgfSk7CiAgfQogIHJlbmRlcigpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IHN1cGVyLnJlbmRlcigpOwogICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImJ1dHRvbldpZGdldEFubm90YXRpb24iLCAicHVzaEJ1dHRvbiIpOwogICAgY29uc3QgbGlua0VsZW1lbnQgPSBjb250YWluZXIubGFzdENoaWxkOwogICAgaWYgKHRoaXMuZW5hYmxlU2NyaXB0aW5nICYmIHRoaXMuaGFzSlNBY3Rpb25zICYmIGxpbmtFbGVtZW50KSB7CiAgICAgIHRoaXMuX3NldERlZmF1bHRQcm9wZXJ0aWVzRnJvbUpTKGxpbmtFbGVtZW50KTsKICAgICAgbGlua0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigidXBkYXRlZnJvbXNhbmRib3giLCBqc0V2ZW50ID0+IHsKICAgICAgICB0aGlzLl9kaXNwYXRjaEV2ZW50RnJvbVNhbmRib3goe30sIGpzRXZlbnQpOwogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBjb250YWluZXI7CiAgfQp9CmNsYXNzIENob2ljZVdpZGdldEFubm90YXRpb25FbGVtZW50IGV4dGVuZHMgV2lkZ2V0QW5ub3RhdGlvbkVsZW1lbnQgewogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgIHN1cGVyKHBhcmFtZXRlcnMsIHsKICAgICAgaXNSZW5kZXJhYmxlOiBwYXJhbWV0ZXJzLnJlbmRlckZvcm1zCiAgICB9KTsKICB9CiAgcmVuZGVyKCkgewogICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgiY2hvaWNlV2lkZ2V0QW5ub3RhdGlvbiIpOwogICAgY29uc3Qgc3RvcmFnZSA9IHRoaXMuYW5ub3RhdGlvblN0b3JhZ2U7CiAgICBjb25zdCBpZCA9IHRoaXMuZGF0YS5pZDsKICAgIGNvbnN0IHN0b3JlZERhdGEgPSBzdG9yYWdlLmdldFZhbHVlKGlkLCB7CiAgICAgIHZhbHVlOiB0aGlzLmRhdGEuZmllbGRWYWx1ZQogICAgfSk7CiAgICBjb25zdCBzZWxlY3RFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2VsZWN0Iik7CiAgICBHZXRFbGVtZW50c0J5TmFtZVNldC5hZGQoc2VsZWN0RWxlbWVudCk7CiAgICBzZWxlY3RFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1lbGVtZW50LWlkIiwgaWQpOwogICAgc2VsZWN0RWxlbWVudC5kaXNhYmxlZCA9IHRoaXMuZGF0YS5yZWFkT25seTsKICAgIHRoaXMuX3NldFJlcXVpcmVkKHNlbGVjdEVsZW1lbnQsIHRoaXMuZGF0YS5yZXF1aXJlZCk7CiAgICBzZWxlY3RFbGVtZW50Lm5hbWUgPSB0aGlzLmRhdGEuZmllbGROYW1lOwogICAgc2VsZWN0RWxlbWVudC50YWJJbmRleCA9IERFRkFVTFRfVEFCX0lOREVYOwogICAgbGV0IGFkZEFuRW1wdHlFbnRyeSA9IHRoaXMuZGF0YS5jb21ibyAmJiB0aGlzLmRhdGEub3B0aW9ucy5sZW5ndGggPiAwOwogICAgaWYgKCF0aGlzLmRhdGEuY29tYm8pIHsKICAgICAgc2VsZWN0RWxlbWVudC5zaXplID0gdGhpcy5kYXRhLm9wdGlvbnMubGVuZ3RoOwogICAgICBpZiAodGhpcy5kYXRhLm11bHRpU2VsZWN0KSB7CiAgICAgICAgc2VsZWN0RWxlbWVudC5tdWx0aXBsZSA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIHNlbGVjdEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigicmVzZXRmb3JtIiwgZXZlbnQgPT4gewogICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSB0aGlzLmRhdGEuZGVmYXVsdEZpZWxkVmFsdWU7CiAgICAgIGZvciAoY29uc3Qgb3B0aW9uIG9mIHNlbGVjdEVsZW1lbnQub3B0aW9ucykgewogICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG9wdGlvbi52YWx1ZSA9PT0gZGVmYXVsdFZhbHVlOwogICAgICB9CiAgICB9KTsKICAgIGZvciAoY29uc3Qgb3B0aW9uIG9mIHRoaXMuZGF0YS5vcHRpb25zKSB7CiAgICAgIGNvbnN0IG9wdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKICAgICAgb3B0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IG9wdGlvbi5kaXNwbGF5VmFsdWU7CiAgICAgIG9wdGlvbkVsZW1lbnQudmFsdWUgPSBvcHRpb24uZXhwb3J0VmFsdWU7CiAgICAgIGlmIChzdG9yZWREYXRhLnZhbHVlLmluY2x1ZGVzKG9wdGlvbi5leHBvcnRWYWx1ZSkpIHsKICAgICAgICBvcHRpb25FbGVtZW50LnNldEF0dHJpYnV0ZSgic2VsZWN0ZWQiLCB0cnVlKTsKICAgICAgICBhZGRBbkVtcHR5RW50cnkgPSBmYWxzZTsKICAgICAgfQogICAgICBzZWxlY3RFbGVtZW50LmFwcGVuZChvcHRpb25FbGVtZW50KTsKICAgIH0KICAgIGxldCByZW1vdmVFbXB0eUVudHJ5ID0gbnVsbDsKICAgIGlmIChhZGRBbkVtcHR5RW50cnkpIHsKICAgICAgY29uc3Qgbm9uZU9wdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKICAgICAgbm9uZU9wdGlvbkVsZW1lbnQudmFsdWUgPSAiICI7CiAgICAgIG5vbmVPcHRpb25FbGVtZW50LnNldEF0dHJpYnV0ZSgiaGlkZGVuIiwgdHJ1ZSk7CiAgICAgIG5vbmVPcHRpb25FbGVtZW50LnNldEF0dHJpYnV0ZSgic2VsZWN0ZWQiLCB0cnVlKTsKICAgICAgc2VsZWN0RWxlbWVudC5wcmVwZW5kKG5vbmVPcHRpb25FbGVtZW50KTsKICAgICAgcmVtb3ZlRW1wdHlFbnRyeSA9ICgpID0+IHsKICAgICAgICBub25lT3B0aW9uRWxlbWVudC5yZW1vdmUoKTsKICAgICAgICBzZWxlY3RFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImlucHV0IiwgcmVtb3ZlRW1wdHlFbnRyeSk7CiAgICAgICAgcmVtb3ZlRW1wdHlFbnRyeSA9IG51bGw7CiAgICAgIH07CiAgICAgIHNlbGVjdEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCByZW1vdmVFbXB0eUVudHJ5KTsKICAgIH0KICAgIGNvbnN0IGdldFZhbHVlID0gaXNFeHBvcnQgPT4gewogICAgICBjb25zdCBuYW1lID0gaXNFeHBvcnQgPyAidmFsdWUiIDogInRleHRDb250ZW50IjsKICAgICAgY29uc3QgewogICAgICAgIG9wdGlvbnMsCiAgICAgICAgbXVsdGlwbGUKICAgICAgfSA9IHNlbGVjdEVsZW1lbnQ7CiAgICAgIGlmICghbXVsdGlwbGUpIHsKICAgICAgICByZXR1cm4gb3B0aW9ucy5zZWxlY3RlZEluZGV4ID09PSAtMSA/IG51bGwgOiBvcHRpb25zW29wdGlvbnMuc2VsZWN0ZWRJbmRleF1bbmFtZV07CiAgICAgIH0KICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5maWx0ZXIuY2FsbChvcHRpb25zLCBvcHRpb24gPT4gb3B0aW9uLnNlbGVjdGVkKS5tYXAob3B0aW9uID0+IG9wdGlvbltuYW1lXSk7CiAgICB9OwogICAgbGV0IHNlbGVjdGVkVmFsdWVzID0gZ2V0VmFsdWUoZmFsc2UpOwogICAgY29uc3QgZ2V0SXRlbXMgPSBldmVudCA9PiB7CiAgICAgIGNvbnN0IG9wdGlvbnMgPSBldmVudC50YXJnZXQub3B0aW9uczsKICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5tYXAuY2FsbChvcHRpb25zLCBvcHRpb24gPT4gKHsKICAgICAgICBkaXNwbGF5VmFsdWU6IG9wdGlvbi50ZXh0Q29udGVudCwKICAgICAgICBleHBvcnRWYWx1ZTogb3B0aW9uLnZhbHVlCiAgICAgIH0pKTsKICAgIH07CiAgICBpZiAodGhpcy5lbmFibGVTY3JpcHRpbmcgJiYgdGhpcy5oYXNKU0FjdGlvbnMpIHsKICAgICAgc2VsZWN0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJ1cGRhdGVmcm9tc2FuZGJveCIsIGpzRXZlbnQgPT4gewogICAgICAgIGNvbnN0IGFjdGlvbnMgPSB7CiAgICAgICAgICB2YWx1ZShldmVudCkgewogICAgICAgICAgICByZW1vdmVFbXB0eUVudHJ5Py4oKTsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBldmVudC5kZXRhaWwudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IG5ldyBTZXQoQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFt2YWx1ZV0pOwogICAgICAgICAgICBmb3IgKGNvbnN0IG9wdGlvbiBvZiBzZWxlY3RFbGVtZW50Lm9wdGlvbnMpIHsKICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSB2YWx1ZXMuaGFzKG9wdGlvbi52YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RvcmFnZS5zZXRWYWx1ZShpZCwgewogICAgICAgICAgICAgIHZhbHVlOiBnZXRWYWx1ZSh0cnVlKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2VsZWN0ZWRWYWx1ZXMgPSBnZXRWYWx1ZShmYWxzZSk7CiAgICAgICAgICB9LAogICAgICAgICAgbXVsdGlwbGVTZWxlY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgc2VsZWN0RWxlbWVudC5tdWx0aXBsZSA9IHRydWU7CiAgICAgICAgICB9LAogICAgICAgICAgcmVtb3ZlKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBzZWxlY3RFbGVtZW50Lm9wdGlvbnM7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZXZlbnQuZGV0YWlsLnJlbW92ZTsKICAgICAgICAgICAgb3B0aW9uc1tpbmRleF0uc2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgc2VsZWN0RWxlbWVudC5yZW1vdmUoaW5kZXgpOwogICAgICAgICAgICBpZiAob3B0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgY29uc3QgaSA9IEFycmF5LnByb3RvdHlwZS5maW5kSW5kZXguY2FsbChvcHRpb25zLCBvcHRpb24gPT4gb3B0aW9uLnNlbGVjdGVkKTsKICAgICAgICAgICAgICBpZiAoaSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnNbMF0uc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBzdG9yYWdlLnNldFZhbHVlKGlkLCB7CiAgICAgICAgICAgICAgdmFsdWU6IGdldFZhbHVlKHRydWUpLAogICAgICAgICAgICAgIGl0ZW1zOiBnZXRJdGVtcyhldmVudCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGVjdGVkVmFsdWVzID0gZ2V0VmFsdWUoZmFsc2UpOwogICAgICAgICAgfSwKICAgICAgICAgIGNsZWFyKGV2ZW50KSB7CiAgICAgICAgICAgIHdoaWxlIChzZWxlY3RFbGVtZW50Lmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQucmVtb3ZlKDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgICAgICB2YWx1ZTogbnVsbCwKICAgICAgICAgICAgICBpdGVtczogW10KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGVjdGVkVmFsdWVzID0gZ2V0VmFsdWUoZmFsc2UpOwogICAgICAgICAgfSwKICAgICAgICAgIGluc2VydChldmVudCkgewogICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgaW5kZXgsCiAgICAgICAgICAgICAgZGlzcGxheVZhbHVlLAogICAgICAgICAgICAgIGV4cG9ydFZhbHVlCiAgICAgICAgICAgIH0gPSBldmVudC5kZXRhaWwuaW5zZXJ0OwogICAgICAgICAgICBjb25zdCBzZWxlY3RDaGlsZCA9IHNlbGVjdEVsZW1lbnQuY2hpbGRyZW5baW5kZXhdOwogICAgICAgICAgICBjb25zdCBvcHRpb25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CiAgICAgICAgICAgIG9wdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBkaXNwbGF5VmFsdWU7CiAgICAgICAgICAgIG9wdGlvbkVsZW1lbnQudmFsdWUgPSBleHBvcnRWYWx1ZTsKICAgICAgICAgICAgaWYgKHNlbGVjdENoaWxkKSB7CiAgICAgICAgICAgICAgc2VsZWN0Q2hpbGQuYmVmb3JlKG9wdGlvbkVsZW1lbnQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQuYXBwZW5kKG9wdGlvbkVsZW1lbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgICAgICB2YWx1ZTogZ2V0VmFsdWUodHJ1ZSksCiAgICAgICAgICAgICAgaXRlbXM6IGdldEl0ZW1zKGV2ZW50KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2VsZWN0ZWRWYWx1ZXMgPSBnZXRWYWx1ZShmYWxzZSk7CiAgICAgICAgICB9LAogICAgICAgICAgaXRlbXMoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgIGl0ZW1zCiAgICAgICAgICAgIH0gPSBldmVudC5kZXRhaWw7CiAgICAgICAgICAgIHdoaWxlIChzZWxlY3RFbGVtZW50Lmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQucmVtb3ZlKDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykgewogICAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZSwKICAgICAgICAgICAgICAgIGV4cG9ydFZhbHVlCiAgICAgICAgICAgICAgfSA9IGl0ZW07CiAgICAgICAgICAgICAgY29uc3Qgb3B0aW9uRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpOwogICAgICAgICAgICAgIG9wdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBkaXNwbGF5VmFsdWU7CiAgICAgICAgICAgICAgb3B0aW9uRWxlbWVudC52YWx1ZSA9IGV4cG9ydFZhbHVlOwogICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQuYXBwZW5kKG9wdGlvbkVsZW1lbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzZWxlY3RFbGVtZW50Lm9wdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHNlbGVjdEVsZW1lbnQub3B0aW9uc1swXS5zZWxlY3RlZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RvcmFnZS5zZXRWYWx1ZShpZCwgewogICAgICAgICAgICAgIHZhbHVlOiBnZXRWYWx1ZSh0cnVlKSwKICAgICAgICAgICAgICBpdGVtczogZ2V0SXRlbXMoZXZlbnQpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxlY3RlZFZhbHVlcyA9IGdldFZhbHVlKGZhbHNlKTsKICAgICAgICAgIH0sCiAgICAgICAgICBpbmRpY2VzKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGluZGljZXMgPSBuZXcgU2V0KGV2ZW50LmRldGFpbC5pbmRpY2VzKTsKICAgICAgICAgICAgZm9yIChjb25zdCBvcHRpb24gb2YgZXZlbnQudGFyZ2V0Lm9wdGlvbnMpIHsKICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBpbmRpY2VzLmhhcyhvcHRpb24uaW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgICAgICB2YWx1ZTogZ2V0VmFsdWUodHJ1ZSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGVjdGVkVmFsdWVzID0gZ2V0VmFsdWUoZmFsc2UpOwogICAgICAgICAgfSwKICAgICAgICAgIGVkaXRhYmxlKGV2ZW50KSB7CiAgICAgICAgICAgIGV2ZW50LnRhcmdldC5kaXNhYmxlZCA9ICFldmVudC5kZXRhaWwuZWRpdGFibGU7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB0aGlzLl9kaXNwYXRjaEV2ZW50RnJvbVNhbmRib3goYWN0aW9ucywganNFdmVudCk7CiAgICAgIH0pOwogICAgICBzZWxlY3RFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGV4cG9ydFZhbHVlID0gZ2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgY29uc3QgY2hhbmdlID0gZ2V0VmFsdWUoZmFsc2UpOwogICAgICAgIHN0b3JhZ2Uuc2V0VmFsdWUoaWQsIHsKICAgICAgICAgIHZhbHVlOiBleHBvcnRWYWx1ZQogICAgICAgIH0pOwogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdGhpcy5saW5rU2VydmljZS5ldmVudEJ1cz8uZGlzcGF0Y2goImRpc3BhdGNoZXZlbnRpbnNhbmRib3giLCB7CiAgICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgICBkZXRhaWw6IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIG5hbWU6ICJLZXlzdHJva2UiLAogICAgICAgICAgICB2YWx1ZTogc2VsZWN0ZWRWYWx1ZXMsCiAgICAgICAgICAgIGNoYW5nZSwKICAgICAgICAgICAgY2hhbmdlRXg6IGV4cG9ydFZhbHVlLAogICAgICAgICAgICB3aWxsQ29tbWl0OiBmYWxzZSwKICAgICAgICAgICAgY29tbWl0S2V5OiAxLAogICAgICAgICAgICBrZXlEb3duOiBmYWxzZQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoc2VsZWN0RWxlbWVudCwgbnVsbCwgW1siZm9jdXMiLCAiRm9jdXMiXSwgWyJibHVyIiwgIkJsdXIiXSwgWyJtb3VzZWRvd24iLCAiTW91c2UgRG93biJdLCBbIm1vdXNlZW50ZXIiLCAiTW91c2UgRW50ZXIiXSwgWyJtb3VzZWxlYXZlIiwgIk1vdXNlIEV4aXQiXSwgWyJtb3VzZXVwIiwgIk1vdXNlIFVwIl0sIFsiaW5wdXQiLCAiQWN0aW9uIl0sIFsiaW5wdXQiLCAiVmFsaWRhdGUiXV0sIGV2ZW50ID0+IGV2ZW50LnRhcmdldC52YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICBzZWxlY3RFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgc3RvcmFnZS5zZXRWYWx1ZShpZCwgewogICAgICAgICAgdmFsdWU6IGdldFZhbHVlKHRydWUpCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgaWYgKHRoaXMuZGF0YS5jb21ibykgewogICAgICB0aGlzLl9zZXRUZXh0U3R5bGUoc2VsZWN0RWxlbWVudCk7CiAgICB9IGVsc2Uge30KICAgIHRoaXMuX3NldEJhY2tncm91bmRDb2xvcihzZWxlY3RFbGVtZW50KTsKICAgIHRoaXMuX3NldERlZmF1bHRQcm9wZXJ0aWVzRnJvbUpTKHNlbGVjdEVsZW1lbnQpOwogICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHNlbGVjdEVsZW1lbnQpOwogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogIH0KfQpjbGFzcyBQb3B1cEFubm90YXRpb25FbGVtZW50IGV4dGVuZHMgQW5ub3RhdGlvbkVsZW1lbnQgewogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgIGNvbnN0IHsKICAgICAgZGF0YSwKICAgICAgZWxlbWVudHMKICAgIH0gPSBwYXJhbWV0ZXJzOwogICAgc3VwZXIocGFyYW1ldGVycywgewogICAgICBpc1JlbmRlcmFibGU6IEFubm90YXRpb25FbGVtZW50Ll9oYXNQb3B1cERhdGEoZGF0YSkKICAgIH0pOwogICAgdGhpcy5lbGVtZW50cyA9IGVsZW1lbnRzOwogICAgdGhpcy5wb3B1cCA9IG51bGw7CiAgfQogIHJlbmRlcigpIHsKICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoInBvcHVwQW5ub3RhdGlvbiIpOwogICAgY29uc3QgcG9wdXAgPSB0aGlzLnBvcHVwID0gbmV3IFBvcHVwRWxlbWVudCh7CiAgICAgIGNvbnRhaW5lcjogdGhpcy5jb250YWluZXIsCiAgICAgIGNvbG9yOiB0aGlzLmRhdGEuY29sb3IsCiAgICAgIHRpdGxlT2JqOiB0aGlzLmRhdGEudGl0bGVPYmosCiAgICAgIG1vZGlmaWNhdGlvbkRhdGU6IHRoaXMuZGF0YS5tb2RpZmljYXRpb25EYXRlLAogICAgICBjb250ZW50c09iajogdGhpcy5kYXRhLmNvbnRlbnRzT2JqLAogICAgICByaWNoVGV4dDogdGhpcy5kYXRhLnJpY2hUZXh0LAogICAgICByZWN0OiB0aGlzLmRhdGEucmVjdCwKICAgICAgcGFyZW50UmVjdDogdGhpcy5kYXRhLnBhcmVudFJlY3QgfHwgbnVsbCwKICAgICAgcGFyZW50OiB0aGlzLnBhcmVudCwKICAgICAgZWxlbWVudHM6IHRoaXMuZWxlbWVudHMsCiAgICAgIG9wZW46IHRoaXMuZGF0YS5vcGVuCiAgICB9KTsKICAgIGNvbnN0IGVsZW1lbnRJZHMgPSBbXTsKICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiB0aGlzLmVsZW1lbnRzKSB7CiAgICAgIGVsZW1lbnQucG9wdXAgPSBwb3B1cDsKICAgICAgZWxlbWVudC5jb250YWluZXIuYXJpYUhhc1BvcHVwID0gImRpYWxvZyI7CiAgICAgIGVsZW1lbnRJZHMucHVzaChlbGVtZW50LmRhdGEuaWQpOwogICAgICBlbGVtZW50LmFkZEhpZ2hsaWdodEFyZWEoKTsKICAgIH0KICAgIHRoaXMuY29udGFpbmVyLnNldEF0dHJpYnV0ZSgiYXJpYS1jb250cm9scyIsIGVsZW1lbnRJZHMubWFwKGlkID0+IGAke0Fubm90YXRpb25QcmVmaXh9JHtpZH1gKS5qb2luKCIsIikpOwogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogIH0KfQpjbGFzcyBQb3B1cEVsZW1lbnQgewogICNib3VuZEtleURvd24gPSB0aGlzLiNrZXlEb3duLmJpbmQodGhpcyk7CiAgI2JvdW5kSGlkZSA9IHRoaXMuI2hpZGUuYmluZCh0aGlzKTsKICAjYm91bmRTaG93ID0gdGhpcy4jc2hvdy5iaW5kKHRoaXMpOwogICNib3VuZFRvZ2dsZSA9IHRoaXMuI3RvZ2dsZS5iaW5kKHRoaXMpOwogICNjb2xvciA9IG51bGw7CiAgI2NvbnRhaW5lciA9IG51bGw7CiAgI2NvbnRlbnRzT2JqID0gbnVsbDsKICAjZGF0ZU9iaiA9IG51bGw7CiAgI2VsZW1lbnRzID0gbnVsbDsKICAjcGFyZW50ID0gbnVsbDsKICAjcGFyZW50UmVjdCA9IG51bGw7CiAgI3Bpbm5lZCA9IGZhbHNlOwogICNwb3B1cCA9IG51bGw7CiAgI3Bvc2l0aW9uID0gbnVsbDsKICAjcmVjdCA9IG51bGw7CiAgI3JpY2hUZXh0ID0gbnVsbDsKICAjdGl0bGVPYmogPSBudWxsOwogICN1cGRhdGVzID0gbnVsbDsKICAjd2FzVmlzaWJsZSA9IGZhbHNlOwogIGNvbnN0cnVjdG9yKHsKICAgIGNvbnRhaW5lciwKICAgIGNvbG9yLAogICAgZWxlbWVudHMsCiAgICB0aXRsZU9iaiwKICAgIG1vZGlmaWNhdGlvbkRhdGUsCiAgICBjb250ZW50c09iaiwKICAgIHJpY2hUZXh0LAogICAgcGFyZW50LAogICAgcmVjdCwKICAgIHBhcmVudFJlY3QsCiAgICBvcGVuCiAgfSkgewogICAgdGhpcy4jY29udGFpbmVyID0gY29udGFpbmVyOwogICAgdGhpcy4jdGl0bGVPYmogPSB0aXRsZU9iajsKICAgIHRoaXMuI2NvbnRlbnRzT2JqID0gY29udGVudHNPYmo7CiAgICB0aGlzLiNyaWNoVGV4dCA9IHJpY2hUZXh0OwogICAgdGhpcy4jcGFyZW50ID0gcGFyZW50OwogICAgdGhpcy4jY29sb3IgPSBjb2xvcjsKICAgIHRoaXMuI3JlY3QgPSByZWN0OwogICAgdGhpcy4jcGFyZW50UmVjdCA9IHBhcmVudFJlY3Q7CiAgICB0aGlzLiNlbGVtZW50cyA9IGVsZW1lbnRzOwogICAgdGhpcy4jZGF0ZU9iaiA9IFBERkRhdGVTdHJpbmcudG9EYXRlT2JqZWN0KG1vZGlmaWNhdGlvbkRhdGUpOwogICAgdGhpcy50cmlnZ2VyID0gZWxlbWVudHMuZmxhdE1hcChlID0+IGUuZ2V0RWxlbWVudHNUb1RyaWdnZXJQb3B1cCgpKTsKICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiB0aGlzLnRyaWdnZXIpIHsKICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuI2JvdW5kVG9nZ2xlKTsKICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWVudGVyIiwgdGhpcy4jYm91bmRTaG93KTsKICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWxlYXZlIiwgdGhpcy4jYm91bmRIaWRlKTsKICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJwb3B1cFRyaWdnZXJBcmVhIik7CiAgICB9CiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHsKICAgICAgZWxlbWVudC5jb250YWluZXI/LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCB0aGlzLiNib3VuZEtleURvd24pOwogICAgfQogICAgdGhpcy4jY29udGFpbmVyLmhpZGRlbiA9IHRydWU7CiAgICBpZiAob3BlbikgewogICAgICB0aGlzLiN0b2dnbGUoKTsKICAgIH0KICB9CiAgcmVuZGVyKCkgewogICAgaWYgKHRoaXMuI3BvcHVwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBvcHVwID0gdGhpcy4jcG9wdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIHBvcHVwLmNsYXNzTmFtZSA9ICJwb3B1cCI7CiAgICBpZiAodGhpcy4jY29sb3IpIHsKICAgICAgY29uc3QgYmFzZUNvbG9yID0gcG9wdXAuc3R5bGUub3V0bGluZUNvbG9yID0gVXRpbC5tYWtlSGV4Q29sb3IoLi4udGhpcy4jY29sb3IpOwogICAgICBwb3B1cC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBgY29sb3ItbWl4KGluIHNyZ2IsICR7YmFzZUNvbG9yfSAzMCUsIHdoaXRlKWA7CiAgICB9CiAgICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICBoZWFkZXIuY2xhc3NOYW1lID0gImhlYWRlciI7CiAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImgxIik7CiAgICBoZWFkZXIuYXBwZW5kKHRpdGxlKTsKICAgICh7CiAgICAgIGRpcjogdGl0bGUuZGlyLAogICAgICBzdHI6IHRpdGxlLnRleHRDb250ZW50CiAgICB9ID0gdGhpcy4jdGl0bGVPYmopOwogICAgcG9wdXAuYXBwZW5kKGhlYWRlcik7CiAgICBpZiAodGhpcy4jZGF0ZU9iaikgewogICAgICBjb25zdCBtb2RpZmljYXRpb25EYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgICBtb2RpZmljYXRpb25EYXRlLmNsYXNzTGlzdC5hZGQoInBvcHVwRGF0ZSIpOwogICAgICBtb2RpZmljYXRpb25EYXRlLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgInBkZmpzLWFubm90YXRpb24tZGF0ZS10aW1lLXN0cmluZyIpOwogICAgICBtb2RpZmljYXRpb25EYXRlLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWFyZ3MiLCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgZGF0ZU9iajogdGhpcy4jZGF0ZU9iai52YWx1ZU9mKCkKICAgICAgfSkpOwogICAgICBoZWFkZXIuYXBwZW5kKG1vZGlmaWNhdGlvbkRhdGUpOwogICAgfQogICAgY29uc3QgaHRtbCA9IHRoaXMuI2h0bWw7CiAgICBpZiAoaHRtbCkgewogICAgICBYZmFMYXllci5yZW5kZXIoewogICAgICAgIHhmYUh0bWw6IGh0bWwsCiAgICAgICAgaW50ZW50OiAicmljaFRleHQiLAogICAgICAgIGRpdjogcG9wdXAKICAgICAgfSk7CiAgICAgIHBvcHVwLmxhc3RDaGlsZC5jbGFzc0xpc3QuYWRkKCJyaWNoVGV4dCIsICJwb3B1cENvbnRlbnQiKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGNvbnRlbnRzID0gdGhpcy5fZm9ybWF0Q29udGVudHModGhpcy4jY29udGVudHNPYmopOwogICAgICBwb3B1cC5hcHBlbmQoY29udGVudHMpOwogICAgfQogICAgdGhpcy4jY29udGFpbmVyLmFwcGVuZChwb3B1cCk7CiAgfQogIGdldCAjaHRtbCgpIHsKICAgIGNvbnN0IHJpY2hUZXh0ID0gdGhpcy4jcmljaFRleHQ7CiAgICBjb25zdCBjb250ZW50c09iaiA9IHRoaXMuI2NvbnRlbnRzT2JqOwogICAgaWYgKHJpY2hUZXh0Py5zdHIgJiYgKCFjb250ZW50c09iaj8uc3RyIHx8IGNvbnRlbnRzT2JqLnN0ciA9PT0gcmljaFRleHQuc3RyKSkgewogICAgICByZXR1cm4gdGhpcy4jcmljaFRleHQuaHRtbCB8fCBudWxsOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGdldCAjZm9udFNpemUoKSB7CiAgICByZXR1cm4gdGhpcy4jaHRtbD8uYXR0cmlidXRlcz8uc3R5bGU/LmZvbnRTaXplIHx8IDA7CiAgfQogIGdldCAjZm9udENvbG9yKCkgewogICAgcmV0dXJuIHRoaXMuI2h0bWw/LmF0dHJpYnV0ZXM/LnN0eWxlPy5jb2xvciB8fCBudWxsOwogIH0KICAjbWFrZVBvcHVwQ29udGVudCh0ZXh0KSB7CiAgICBjb25zdCBwb3B1cExpbmVzID0gW107CiAgICBjb25zdCBwb3B1cENvbnRlbnQgPSB7CiAgICAgIHN0cjogdGV4dCwKICAgICAgaHRtbDogewogICAgICAgIG5hbWU6ICJkaXYiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGRpcjogImF1dG8iCiAgICAgICAgfSwKICAgICAgICBjaGlsZHJlbjogW3sKICAgICAgICAgIG5hbWU6ICJwIiwKICAgICAgICAgIGNoaWxkcmVuOiBwb3B1cExpbmVzCiAgICAgICAgfV0KICAgICAgfQogICAgfTsKICAgIGNvbnN0IGxpbmVBdHRyaWJ1dGVzID0gewogICAgICBzdHlsZTogewogICAgICAgIGNvbG9yOiB0aGlzLiNmb250Q29sb3IsCiAgICAgICAgZm9udFNpemU6IHRoaXMuI2ZvbnRTaXplID8gYGNhbGMoJHt0aGlzLiNmb250U2l6ZX1weCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpYCA6ICIiCiAgICAgIH0KICAgIH07CiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgdGV4dC5zcGxpdCgiXG4iKSkgewogICAgICBwb3B1cExpbmVzLnB1c2goewogICAgICAgIG5hbWU6ICJzcGFuIiwKICAgICAgICB2YWx1ZTogbGluZSwKICAgICAgICBhdHRyaWJ1dGVzOiBsaW5lQXR0cmlidXRlcwogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBwb3B1cENvbnRlbnQ7CiAgfQogIF9mb3JtYXRDb250ZW50cyh7CiAgICBzdHIsCiAgICBkaXIKICB9KSB7CiAgICBjb25zdCBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgcC5jbGFzc0xpc3QuYWRkKCJwb3B1cENvbnRlbnQiKTsKICAgIHAuZGlyID0gZGlyOwogICAgY29uc3QgbGluZXMgPSBzdHIuc3BsaXQoLyg/OlxyXG4/fFxuKS8pOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gbGluZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBsaW5lID0gbGluZXNbaV07CiAgICAgIHAuYXBwZW5kKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpbmUpKTsKICAgICAgaWYgKGkgPCBpaSAtIDEpIHsKICAgICAgICBwLmFwcGVuZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHA7CiAgfQogICNrZXlEb3duKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQuYWx0S2V5IHx8IGV2ZW50LnNoaWZ0S2V5IHx8IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoZXZlbnQua2V5ID09PSAiRW50ZXIiIHx8IGV2ZW50LmtleSA9PT0gIkVzY2FwZSIgJiYgdGhpcy4jcGlubmVkKSB7CiAgICAgIHRoaXMuI3RvZ2dsZSgpOwogICAgfQogIH0KICB1cGRhdGVFZGl0ZWQoewogICAgcmVjdCwKICAgIHBvcHVwQ29udGVudAogIH0pIHsKICAgIHRoaXMuI3VwZGF0ZXMgfHw9IHsKICAgICAgY29udGVudHNPYmo6IHRoaXMuI2NvbnRlbnRzT2JqLAogICAgICByaWNoVGV4dDogdGhpcy4jcmljaFRleHQKICAgIH07CiAgICBpZiAocmVjdCkgewogICAgICB0aGlzLiNwb3NpdGlvbiA9IG51bGw7CiAgICB9CiAgICBpZiAocG9wdXBDb250ZW50KSB7CiAgICAgIHRoaXMuI3JpY2hUZXh0ID0gdGhpcy4jbWFrZVBvcHVwQ29udGVudChwb3B1cENvbnRlbnQpOwogICAgICB0aGlzLiNjb250ZW50c09iaiA9IG51bGw7CiAgICB9CiAgICB0aGlzLiNwb3B1cD8ucmVtb3ZlKCk7CiAgICB0aGlzLiNwb3B1cCA9IG51bGw7CiAgfQogIHJlc2V0RWRpdGVkKCkgewogICAgaWYgKCF0aGlzLiN1cGRhdGVzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgICh7CiAgICAgIGNvbnRlbnRzT2JqOiB0aGlzLiNjb250ZW50c09iaiwKICAgICAgcmljaFRleHQ6IHRoaXMuI3JpY2hUZXh0CiAgICB9ID0gdGhpcy4jdXBkYXRlcyk7CiAgICB0aGlzLiN1cGRhdGVzID0gbnVsbDsKICAgIHRoaXMuI3BvcHVwPy5yZW1vdmUoKTsKICAgIHRoaXMuI3BvcHVwID0gbnVsbDsKICAgIHRoaXMuI3Bvc2l0aW9uID0gbnVsbDsKICB9CiAgI3NldFBvc2l0aW9uKCkgewogICAgaWYgKHRoaXMuI3Bvc2l0aW9uICE9PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgcGFnZTogewogICAgICAgIHZpZXcKICAgICAgfSwKICAgICAgdmlld3BvcnQ6IHsKICAgICAgICByYXdEaW1zOiB7CiAgICAgICAgICBwYWdlV2lkdGgsCiAgICAgICAgICBwYWdlSGVpZ2h0LAogICAgICAgICAgcGFnZVgsCiAgICAgICAgICBwYWdlWQogICAgICAgIH0KICAgICAgfQogICAgfSA9IHRoaXMuI3BhcmVudDsKICAgIGxldCB1c2VQYXJlbnRSZWN0ID0gISF0aGlzLiNwYXJlbnRSZWN0OwogICAgbGV0IHJlY3QgPSB1c2VQYXJlbnRSZWN0ID8gdGhpcy4jcGFyZW50UmVjdCA6IHRoaXMuI3JlY3Q7CiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgdGhpcy4jZWxlbWVudHMpIHsKICAgICAgaWYgKCFyZWN0IHx8IFV0aWwuaW50ZXJzZWN0KGVsZW1lbnQuZGF0YS5yZWN0LCByZWN0KSAhPT0gbnVsbCkgewogICAgICAgIHJlY3QgPSBlbGVtZW50LmRhdGEucmVjdDsKICAgICAgICB1c2VQYXJlbnRSZWN0ID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgY29uc3Qgbm9ybWFsaXplZFJlY3QgPSBVdGlsLm5vcm1hbGl6ZVJlY3QoW3JlY3RbMF0sIHZpZXdbM10gLSByZWN0WzFdICsgdmlld1sxXSwgcmVjdFsyXSwgdmlld1szXSAtIHJlY3RbM10gKyB2aWV3WzFdXSk7CiAgICBjb25zdCBIT1JJWk9OVEFMX1NQQUNFX0FGVEVSX0FOTk9UQVRJT04gPSA1OwogICAgY29uc3QgcGFyZW50V2lkdGggPSB1c2VQYXJlbnRSZWN0ID8gcmVjdFsyXSAtIHJlY3RbMF0gKyBIT1JJWk9OVEFMX1NQQUNFX0FGVEVSX0FOTk9UQVRJT04gOiAwOwogICAgY29uc3QgcG9wdXBMZWZ0ID0gbm9ybWFsaXplZFJlY3RbMF0gKyBwYXJlbnRXaWR0aDsKICAgIGNvbnN0IHBvcHVwVG9wID0gbm9ybWFsaXplZFJlY3RbMV07CiAgICB0aGlzLiNwb3NpdGlvbiA9IFsxMDAgKiAocG9wdXBMZWZ0IC0gcGFnZVgpIC8gcGFnZVdpZHRoLCAxMDAgKiAocG9wdXBUb3AgLSBwYWdlWSkgLyBwYWdlSGVpZ2h0XTsKICAgIGNvbnN0IHsKICAgICAgc3R5bGUKICAgIH0gPSB0aGlzLiNjb250YWluZXI7CiAgICBzdHlsZS5sZWZ0ID0gYCR7dGhpcy4jcG9zaXRpb25bMF19JWA7CiAgICBzdHlsZS50b3AgPSBgJHt0aGlzLiNwb3NpdGlvblsxXX0lYDsKICB9CiAgI3RvZ2dsZSgpIHsKICAgIHRoaXMuI3Bpbm5lZCA9ICF0aGlzLiNwaW5uZWQ7CiAgICBpZiAodGhpcy4jcGlubmVkKSB7CiAgICAgIHRoaXMuI3Nob3coKTsKICAgICAgdGhpcy4jY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy4jYm91bmRUb2dnbGUpOwogICAgICB0aGlzLiNjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIHRoaXMuI2JvdW5kS2V5RG93bik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLiNoaWRlKCk7CiAgICAgIHRoaXMuI2NvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuI2JvdW5kVG9nZ2xlKTsKICAgICAgdGhpcy4jY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleWRvd24iLCB0aGlzLiNib3VuZEtleURvd24pOwogICAgfQogIH0KICAjc2hvdygpIHsKICAgIGlmICghdGhpcy4jcG9wdXApIHsKICAgICAgdGhpcy5yZW5kZXIoKTsKICAgIH0KICAgIGlmICghdGhpcy5pc1Zpc2libGUpIHsKICAgICAgdGhpcy4jc2V0UG9zaXRpb24oKTsKICAgICAgdGhpcy4jY29udGFpbmVyLmhpZGRlbiA9IGZhbHNlOwogICAgICB0aGlzLiNjb250YWluZXIuc3R5bGUuekluZGV4ID0gcGFyc2VJbnQodGhpcy4jY29udGFpbmVyLnN0eWxlLnpJbmRleCkgKyAxMDAwOwogICAgfSBlbHNlIGlmICh0aGlzLiNwaW5uZWQpIHsKICAgICAgdGhpcy4jY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImZvY3VzZWQiKTsKICAgIH0KICB9CiAgI2hpZGUoKSB7CiAgICB0aGlzLiNjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgiZm9jdXNlZCIpOwogICAgaWYgKHRoaXMuI3Bpbm5lZCB8fCAhdGhpcy5pc1Zpc2libGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jY29udGFpbmVyLmhpZGRlbiA9IHRydWU7CiAgICB0aGlzLiNjb250YWluZXIuc3R5bGUuekluZGV4ID0gcGFyc2VJbnQodGhpcy4jY29udGFpbmVyLnN0eWxlLnpJbmRleCkgLSAxMDAwOwogIH0KICBmb3JjZUhpZGUoKSB7CiAgICB0aGlzLiN3YXNWaXNpYmxlID0gdGhpcy5pc1Zpc2libGU7CiAgICBpZiAoIXRoaXMuI3dhc1Zpc2libGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jY29udGFpbmVyLmhpZGRlbiA9IHRydWU7CiAgfQogIG1heWJlU2hvdygpIHsKICAgIGlmICghdGhpcy4jd2FzVmlzaWJsZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXMuI3BvcHVwKSB7CiAgICAgIHRoaXMuI3Nob3coKTsKICAgIH0KICAgIHRoaXMuI3dhc1Zpc2libGUgPSBmYWxzZTsKICAgIHRoaXMuI2NvbnRhaW5lci5oaWRkZW4gPSBmYWxzZTsKICB9CiAgZ2V0IGlzVmlzaWJsZSgpIHsKICAgIHJldHVybiB0aGlzLiNjb250YWluZXIuaGlkZGVuID09PSBmYWxzZTsKICB9Cn0KY2xhc3MgRnJlZVRleHRBbm5vdGF0aW9uRWxlbWVudCBleHRlbmRzIEFubm90YXRpb25FbGVtZW50IHsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICBzdXBlcihwYXJhbWV0ZXJzLCB7CiAgICAgIGlzUmVuZGVyYWJsZTogdHJ1ZSwKICAgICAgaWdub3JlQm9yZGVyOiB0cnVlCiAgICB9KTsKICAgIHRoaXMudGV4dENvbnRlbnQgPSBwYXJhbWV0ZXJzLmRhdGEudGV4dENvbnRlbnQ7CiAgICB0aGlzLnRleHRQb3NpdGlvbiA9IHBhcmFtZXRlcnMuZGF0YS50ZXh0UG9zaXRpb247CiAgICB0aGlzLmFubm90YXRpb25FZGl0b3JUeXBlID0gQW5ub3RhdGlvbkVkaXRvclR5cGUuRlJFRVRFWFQ7CiAgfQogIHJlbmRlcigpIHsKICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImZyZWVUZXh0QW5ub3RhdGlvbiIpOwogICAgaWYgKHRoaXMudGV4dENvbnRlbnQpIHsKICAgICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBjb250ZW50LmNsYXNzTGlzdC5hZGQoImFubm90YXRpb25UZXh0Q29udGVudCIpOwogICAgICBjb250ZW50LnNldEF0dHJpYnV0ZSgicm9sZSIsICJjb21tZW50Iik7CiAgICAgIGZvciAoY29uc3QgbGluZSBvZiB0aGlzLnRleHRDb250ZW50KSB7CiAgICAgICAgY29uc3QgbGluZVNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICAgICAgbGluZVNwYW4udGV4dENvbnRlbnQgPSBsaW5lOwogICAgICAgIGNvbnRlbnQuYXBwZW5kKGxpbmVTcGFuKTsKICAgICAgfQogICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoY29udGVudCk7CiAgICB9CiAgICBpZiAoIXRoaXMuZGF0YS5wb3B1cFJlZiAmJiB0aGlzLmhhc1BvcHVwRGF0YSkgewogICAgICB0aGlzLl9jcmVhdGVQb3B1cCgpOwogICAgfQogICAgdGhpcy5fZWRpdE9uRG91YmxlQ2xpY2soKTsKICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICB9Cn0KY2xhc3MgTGluZUFubm90YXRpb25FbGVtZW50IGV4dGVuZHMgQW5ub3RhdGlvbkVsZW1lbnQgewogICNsaW5lID0gbnVsbDsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICBzdXBlcihwYXJhbWV0ZXJzLCB7CiAgICAgIGlzUmVuZGVyYWJsZTogdHJ1ZSwKICAgICAgaWdub3JlQm9yZGVyOiB0cnVlCiAgICB9KTsKICB9CiAgcmVuZGVyKCkgewogICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgibGluZUFubm90YXRpb24iKTsKICAgIGNvbnN0IHsKICAgICAgZGF0YSwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IHRoaXM7CiAgICBjb25zdCBzdmcgPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlKHdpZHRoLCBoZWlnaHQsIHRydWUpOwogICAgY29uc3QgbGluZSA9IHRoaXMuI2xpbmUgPSB0aGlzLnN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgic3ZnOmxpbmUiKTsKICAgIGxpbmUuc2V0QXR0cmlidXRlKCJ4MSIsIGRhdGEucmVjdFsyXSAtIGRhdGEubGluZUNvb3JkaW5hdGVzWzBdKTsKICAgIGxpbmUuc2V0QXR0cmlidXRlKCJ5MSIsIGRhdGEucmVjdFszXSAtIGRhdGEubGluZUNvb3JkaW5hdGVzWzFdKTsKICAgIGxpbmUuc2V0QXR0cmlidXRlKCJ4MiIsIGRhdGEucmVjdFsyXSAtIGRhdGEubGluZUNvb3JkaW5hdGVzWzJdKTsKICAgIGxpbmUuc2V0QXR0cmlidXRlKCJ5MiIsIGRhdGEucmVjdFszXSAtIGRhdGEubGluZUNvb3JkaW5hdGVzWzNdKTsKICAgIGxpbmUuc2V0QXR0cmlidXRlKCJzdHJva2Utd2lkdGgiLCBkYXRhLmJvcmRlclN0eWxlLndpZHRoIHx8IDEpOwogICAgbGluZS5zZXRBdHRyaWJ1dGUoInN0cm9rZSIsICJ0cmFuc3BhcmVudCIpOwogICAgbGluZS5zZXRBdHRyaWJ1dGUoImZpbGwiLCAidHJhbnNwYXJlbnQiKTsKICAgIHN2Zy5hcHBlbmQobGluZSk7CiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoc3ZnKTsKICAgIGlmICghZGF0YS5wb3B1cFJlZiAmJiB0aGlzLmhhc1BvcHVwRGF0YSkgewogICAgICB0aGlzLl9jcmVhdGVQb3B1cCgpOwogICAgfQogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogIH0KICBnZXRFbGVtZW50c1RvVHJpZ2dlclBvcHVwKCkgewogICAgcmV0dXJuIHRoaXMuI2xpbmU7CiAgfQogIGFkZEhpZ2hsaWdodEFyZWEoKSB7CiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJoaWdobGlnaHRBcmVhIik7CiAgfQp9CmNsYXNzIFNxdWFyZUFubm90YXRpb25FbGVtZW50IGV4dGVuZHMgQW5ub3RhdGlvbkVsZW1lbnQgewogICNzcXVhcmUgPSBudWxsOwogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgIHN1cGVyKHBhcmFtZXRlcnMsIHsKICAgICAgaXNSZW5kZXJhYmxlOiB0cnVlLAogICAgICBpZ25vcmVCb3JkZXI6IHRydWUKICAgIH0pOwogIH0KICByZW5kZXIoKSB7CiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJzcXVhcmVBbm5vdGF0aW9uIik7CiAgICBjb25zdCB7CiAgICAgIGRhdGEsCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSB0aGlzOwogICAgY29uc3Qgc3ZnID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZSh3aWR0aCwgaGVpZ2h0LCB0cnVlKTsKICAgIGNvbnN0IGJvcmRlcldpZHRoID0gZGF0YS5ib3JkZXJTdHlsZS53aWR0aDsKICAgIGNvbnN0IHNxdWFyZSA9IHRoaXMuI3NxdWFyZSA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6cmVjdCIpOwogICAgc3F1YXJlLnNldEF0dHJpYnV0ZSgieCIsIGJvcmRlcldpZHRoIC8gMik7CiAgICBzcXVhcmUuc2V0QXR0cmlidXRlKCJ5IiwgYm9yZGVyV2lkdGggLyAyKTsKICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoIndpZHRoIiwgd2lkdGggLSBib3JkZXJXaWR0aCk7CiAgICBzcXVhcmUuc2V0QXR0cmlidXRlKCJoZWlnaHQiLCBoZWlnaHQgLSBib3JkZXJXaWR0aCk7CiAgICBzcXVhcmUuc2V0QXR0cmlidXRlKCJzdHJva2Utd2lkdGgiLCBib3JkZXJXaWR0aCB8fCAxKTsKICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoInN0cm9rZSIsICJ0cmFuc3BhcmVudCIpOwogICAgc3F1YXJlLnNldEF0dHJpYnV0ZSgiZmlsbCIsICJ0cmFuc3BhcmVudCIpOwogICAgc3ZnLmFwcGVuZChzcXVhcmUpOwogICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHN2Zyk7CiAgICBpZiAoIWRhdGEucG9wdXBSZWYgJiYgdGhpcy5oYXNQb3B1cERhdGEpIHsKICAgICAgdGhpcy5fY3JlYXRlUG9wdXAoKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICB9CiAgZ2V0RWxlbWVudHNUb1RyaWdnZXJQb3B1cCgpIHsKICAgIHJldHVybiB0aGlzLiNzcXVhcmU7CiAgfQogIGFkZEhpZ2hsaWdodEFyZWEoKSB7CiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJoaWdobGlnaHRBcmVhIik7CiAgfQp9CmNsYXNzIENpcmNsZUFubm90YXRpb25FbGVtZW50IGV4dGVuZHMgQW5ub3RhdGlvbkVsZW1lbnQgewogICNjaXJjbGUgPSBudWxsOwogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgIHN1cGVyKHBhcmFtZXRlcnMsIHsKICAgICAgaXNSZW5kZXJhYmxlOiB0cnVlLAogICAgICBpZ25vcmVCb3JkZXI6IHRydWUKICAgIH0pOwogIH0KICByZW5kZXIoKSB7CiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJjaXJjbGVBbm5vdGF0aW9uIik7CiAgICBjb25zdCB7CiAgICAgIGRhdGEsCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSB0aGlzOwogICAgY29uc3Qgc3ZnID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZSh3aWR0aCwgaGVpZ2h0LCB0cnVlKTsKICAgIGNvbnN0IGJvcmRlcldpZHRoID0gZGF0YS5ib3JkZXJTdHlsZS53aWR0aDsKICAgIGNvbnN0IGNpcmNsZSA9IHRoaXMuI2NpcmNsZSA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJzdmc6ZWxsaXBzZSIpOwogICAgY2lyY2xlLnNldEF0dHJpYnV0ZSgiY3giLCB3aWR0aCAvIDIpOwogICAgY2lyY2xlLnNldEF0dHJpYnV0ZSgiY3kiLCBoZWlnaHQgLyAyKTsKICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoInJ4Iiwgd2lkdGggLyAyIC0gYm9yZGVyV2lkdGggLyAyKTsKICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoInJ5IiwgaGVpZ2h0IC8gMiAtIGJvcmRlcldpZHRoIC8gMik7CiAgICBjaXJjbGUuc2V0QXR0cmlidXRlKCJzdHJva2Utd2lkdGgiLCBib3JkZXJXaWR0aCB8fCAxKTsKICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoInN0cm9rZSIsICJ0cmFuc3BhcmVudCIpOwogICAgY2lyY2xlLnNldEF0dHJpYnV0ZSgiZmlsbCIsICJ0cmFuc3BhcmVudCIpOwogICAgc3ZnLmFwcGVuZChjaXJjbGUpOwogICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHN2Zyk7CiAgICBpZiAoIWRhdGEucG9wdXBSZWYgJiYgdGhpcy5oYXNQb3B1cERhdGEpIHsKICAgICAgdGhpcy5fY3JlYXRlUG9wdXAoKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICB9CiAgZ2V0RWxlbWVudHNUb1RyaWdnZXJQb3B1cCgpIHsKICAgIHJldHVybiB0aGlzLiNjaXJjbGU7CiAgfQogIGFkZEhpZ2hsaWdodEFyZWEoKSB7CiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJoaWdobGlnaHRBcmVhIik7CiAgfQp9CmNsYXNzIFBvbHlsaW5lQW5ub3RhdGlvbkVsZW1lbnQgZXh0ZW5kcyBBbm5vdGF0aW9uRWxlbWVudCB7CiAgI3BvbHlsaW5lID0gbnVsbDsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICBzdXBlcihwYXJhbWV0ZXJzLCB7CiAgICAgIGlzUmVuZGVyYWJsZTogdHJ1ZSwKICAgICAgaWdub3JlQm9yZGVyOiB0cnVlCiAgICB9KTsKICAgIHRoaXMuY29udGFpbmVyQ2xhc3NOYW1lID0gInBvbHlsaW5lQW5ub3RhdGlvbiI7CiAgICB0aGlzLnN2Z0VsZW1lbnROYW1lID0gInN2Zzpwb2x5bGluZSI7CiAgfQogIHJlbmRlcigpIHsKICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQodGhpcy5jb250YWluZXJDbGFzc05hbWUpOwogICAgY29uc3QgewogICAgICBkYXRhOiB7CiAgICAgICAgcmVjdCwKICAgICAgICB2ZXJ0aWNlcywKICAgICAgICBib3JkZXJTdHlsZSwKICAgICAgICBwb3B1cFJlZgogICAgICB9LAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gdGhpczsKICAgIGlmICghdmVydGljZXMpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogICAgfQogICAgY29uc3Qgc3ZnID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZSh3aWR0aCwgaGVpZ2h0LCB0cnVlKTsKICAgIGxldCBwb2ludHMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHZlcnRpY2VzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgY29uc3QgeCA9IHZlcnRpY2VzW2ldIC0gcmVjdFswXTsKICAgICAgY29uc3QgeSA9IHJlY3RbM10gLSB2ZXJ0aWNlc1tpICsgMV07CiAgICAgIHBvaW50cy5wdXNoKGAke3h9LCR7eX1gKTsKICAgIH0KICAgIHBvaW50cyA9IHBvaW50cy5qb2luKCIgIik7CiAgICBjb25zdCBwb2x5bGluZSA9IHRoaXMuI3BvbHlsaW5lID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQodGhpcy5zdmdFbGVtZW50TmFtZSk7CiAgICBwb2x5bGluZS5zZXRBdHRyaWJ1dGUoInBvaW50cyIsIHBvaW50cyk7CiAgICBwb2x5bGluZS5zZXRBdHRyaWJ1dGUoInN0cm9rZS13aWR0aCIsIGJvcmRlclN0eWxlLndpZHRoIHx8IDEpOwogICAgcG9seWxpbmUuc2V0QXR0cmlidXRlKCJzdHJva2UiLCAidHJhbnNwYXJlbnQiKTsKICAgIHBvbHlsaW5lLnNldEF0dHJpYnV0ZSgiZmlsbCIsICJ0cmFuc3BhcmVudCIpOwogICAgc3ZnLmFwcGVuZChwb2x5bGluZSk7CiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoc3ZnKTsKICAgIGlmICghcG9wdXBSZWYgJiYgdGhpcy5oYXNQb3B1cERhdGEpIHsKICAgICAgdGhpcy5fY3JlYXRlUG9wdXAoKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICB9CiAgZ2V0RWxlbWVudHNUb1RyaWdnZXJQb3B1cCgpIHsKICAgIHJldHVybiB0aGlzLiNwb2x5bGluZTsKICB9CiAgYWRkSGlnaGxpZ2h0QXJlYSgpIHsKICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImhpZ2hsaWdodEFyZWEiKTsKICB9Cn0KY2xhc3MgUG9seWdvbkFubm90YXRpb25FbGVtZW50IGV4dGVuZHMgUG9seWxpbmVBbm5vdGF0aW9uRWxlbWVudCB7CiAgY29uc3RydWN0b3IocGFyYW1ldGVycykgewogICAgc3VwZXIocGFyYW1ldGVycyk7CiAgICB0aGlzLmNvbnRhaW5lckNsYXNzTmFtZSA9ICJwb2x5Z29uQW5ub3RhdGlvbiI7CiAgICB0aGlzLnN2Z0VsZW1lbnROYW1lID0gInN2Zzpwb2x5Z29uIjsKICB9Cn0KY2xhc3MgQ2FyZXRBbm5vdGF0aW9uRWxlbWVudCBleHRlbmRzIEFubm90YXRpb25FbGVtZW50IHsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICBzdXBlcihwYXJhbWV0ZXJzLCB7CiAgICAgIGlzUmVuZGVyYWJsZTogdHJ1ZSwKICAgICAgaWdub3JlQm9yZGVyOiB0cnVlCiAgICB9KTsKICB9CiAgcmVuZGVyKCkgewogICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgiY2FyZXRBbm5vdGF0aW9uIik7CiAgICBpZiAoIXRoaXMuZGF0YS5wb3B1cFJlZiAmJiB0aGlzLmhhc1BvcHVwRGF0YSkgewogICAgICB0aGlzLl9jcmVhdGVQb3B1cCgpOwogICAgfQogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogIH0KfQpjbGFzcyBJbmtBbm5vdGF0aW9uRWxlbWVudCBleHRlbmRzIEFubm90YXRpb25FbGVtZW50IHsKICAjcG9seWxpbmVzR3JvdXBFbGVtZW50ID0gbnVsbDsKICAjcG9seWxpbmVzID0gW107CiAgY29uc3RydWN0b3IocGFyYW1ldGVycykgewogICAgc3VwZXIocGFyYW1ldGVycywgewogICAgICBpc1JlbmRlcmFibGU6IHRydWUsCiAgICAgIGlnbm9yZUJvcmRlcjogdHJ1ZQogICAgfSk7CiAgICB0aGlzLmNvbnRhaW5lckNsYXNzTmFtZSA9ICJpbmtBbm5vdGF0aW9uIjsKICAgIHRoaXMuc3ZnRWxlbWVudE5hbWUgPSAic3ZnOnBvbHlsaW5lIjsKICAgIHRoaXMuYW5ub3RhdGlvbkVkaXRvclR5cGUgPSB0aGlzLmRhdGEuaXQgPT09ICJJbmtIaWdobGlnaHQiID8gQW5ub3RhdGlvbkVkaXRvclR5cGUuSElHSExJR0hUIDogQW5ub3RhdGlvbkVkaXRvclR5cGUuSU5LOwogIH0KICAjZ2V0VHJhbnNmb3JtKHJvdGF0aW9uLCByZWN0KSB7CiAgICBzd2l0Y2ggKHJvdGF0aW9uKSB7CiAgICAgIGNhc2UgOTA6CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRyYW5zZm9ybTogYHJvdGF0ZSg5MCkgdHJhbnNsYXRlKCR7LXJlY3RbMF19LCR7cmVjdFsxXX0pIHNjYWxlKDEsLTEpYCwKICAgICAgICAgIHdpZHRoOiByZWN0WzNdIC0gcmVjdFsxXSwKICAgICAgICAgIGhlaWdodDogcmVjdFsyXSAtIHJlY3RbMF0KICAgICAgICB9OwogICAgICBjYXNlIDE4MDoKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHJhbnNmb3JtOiBgcm90YXRlKDE4MCkgdHJhbnNsYXRlKCR7LXJlY3RbMl19LCR7cmVjdFsxXX0pIHNjYWxlKDEsLTEpYCwKICAgICAgICAgIHdpZHRoOiByZWN0WzJdIC0gcmVjdFswXSwKICAgICAgICAgIGhlaWdodDogcmVjdFszXSAtIHJlY3RbMV0KICAgICAgICB9OwogICAgICBjYXNlIDI3MDoKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHJhbnNmb3JtOiBgcm90YXRlKDI3MCkgdHJhbnNsYXRlKCR7LXJlY3RbMl19LCR7cmVjdFszXX0pIHNjYWxlKDEsLTEpYCwKICAgICAgICAgIHdpZHRoOiByZWN0WzNdIC0gcmVjdFsxXSwKICAgICAgICAgIGhlaWdodDogcmVjdFsyXSAtIHJlY3RbMF0KICAgICAgICB9OwogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGUoJHstcmVjdFswXX0sJHtyZWN0WzNdfSkgc2NhbGUoMSwtMSlgLAogICAgICAgICAgd2lkdGg6IHJlY3RbMl0gLSByZWN0WzBdLAogICAgICAgICAgaGVpZ2h0OiByZWN0WzNdIC0gcmVjdFsxXQogICAgICAgIH07CiAgICB9CiAgfQogIHJlbmRlcigpIHsKICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQodGhpcy5jb250YWluZXJDbGFzc05hbWUpOwogICAgY29uc3QgewogICAgICBkYXRhOiB7CiAgICAgICAgcmVjdCwKICAgICAgICByb3RhdGlvbiwKICAgICAgICBpbmtMaXN0cywKICAgICAgICBib3JkZXJTdHlsZSwKICAgICAgICBwb3B1cFJlZgogICAgICB9CiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHsKICAgICAgdHJhbnNmb3JtLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gdGhpcy4jZ2V0VHJhbnNmb3JtKHJvdGF0aW9uLCByZWN0KTsKICAgIGNvbnN0IHN2ZyA9IHRoaXMuc3ZnRmFjdG9yeS5jcmVhdGUod2lkdGgsIGhlaWdodCwgdHJ1ZSk7CiAgICBjb25zdCBnID0gdGhpcy4jcG9seWxpbmVzR3JvdXBFbGVtZW50ID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZzpnIik7CiAgICBzdmcuYXBwZW5kKGcpOwogICAgZy5zZXRBdHRyaWJ1dGUoInN0cm9rZS13aWR0aCIsIGJvcmRlclN0eWxlLndpZHRoIHx8IDEpOwogICAgZy5zZXRBdHRyaWJ1dGUoInN0cm9rZS1saW5lY2FwIiwgInJvdW5kIik7CiAgICBnLnNldEF0dHJpYnV0ZSgic3Ryb2tlLWxpbmVqb2luIiwgInJvdW5kIik7CiAgICBnLnNldEF0dHJpYnV0ZSgic3Ryb2tlLW1pdGVybGltaXQiLCAxMCk7CiAgICBnLnNldEF0dHJpYnV0ZSgic3Ryb2tlIiwgInRyYW5zcGFyZW50Iik7CiAgICBnLnNldEF0dHJpYnV0ZSgiZmlsbCIsICJ0cmFuc3BhcmVudCIpOwogICAgZy5zZXRBdHRyaWJ1dGUoInRyYW5zZm9ybSIsIHRyYW5zZm9ybSk7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpbmtMaXN0cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHBvbHlsaW5lID0gdGhpcy5zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQodGhpcy5zdmdFbGVtZW50TmFtZSk7CiAgICAgIHRoaXMuI3BvbHlsaW5lcy5wdXNoKHBvbHlsaW5lKTsKICAgICAgcG9seWxpbmUuc2V0QXR0cmlidXRlKCJwb2ludHMiLCBpbmtMaXN0c1tpXS5qb2luKCIsIikpOwogICAgICBnLmFwcGVuZChwb2x5bGluZSk7CiAgICB9CiAgICBpZiAoIXBvcHVwUmVmICYmIHRoaXMuaGFzUG9wdXBEYXRhKSB7CiAgICAgIHRoaXMuX2NyZWF0ZVBvcHVwKCk7CiAgICB9CiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoc3ZnKTsKICAgIHRoaXMuX2VkaXRPbkRvdWJsZUNsaWNrKCk7CiAgICByZXR1cm4gdGhpcy5jb250YWluZXI7CiAgfQogIHVwZGF0ZUVkaXRlZChwYXJhbXMpIHsKICAgIHN1cGVyLnVwZGF0ZUVkaXRlZChwYXJhbXMpOwogICAgY29uc3QgewogICAgICB0aGlja25lc3MsCiAgICAgIHBvaW50cywKICAgICAgcmVjdAogICAgfSA9IHBhcmFtczsKICAgIGNvbnN0IGcgPSB0aGlzLiNwb2x5bGluZXNHcm91cEVsZW1lbnQ7CiAgICBpZiAodGhpY2tuZXNzID49IDApIHsKICAgICAgZy5zZXRBdHRyaWJ1dGUoInN0cm9rZS13aWR0aCIsIHRoaWNrbmVzcyB8fCAxKTsKICAgIH0KICAgIGlmIChwb2ludHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy4jcG9seWxpbmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICB0aGlzLiNwb2x5bGluZXNbaV0uc2V0QXR0cmlidXRlKCJwb2ludHMiLCBwb2ludHNbaV0uam9pbigiLCIpKTsKICAgICAgfQogICAgfQogICAgaWYgKHJlY3QpIHsKICAgICAgY29uc3QgewogICAgICAgIHRyYW5zZm9ybSwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQKICAgICAgfSA9IHRoaXMuI2dldFRyYW5zZm9ybSh0aGlzLmRhdGEucm90YXRpb24sIHJlY3QpOwogICAgICBjb25zdCByb290ID0gZy5wYXJlbnRFbGVtZW50OwogICAgICByb290LnNldEF0dHJpYnV0ZSgidmlld0JveCIsIGAwIDAgJHt3aWR0aH0gJHtoZWlnaHR9YCk7CiAgICAgIGcuc2V0QXR0cmlidXRlKCJ0cmFuc2Zvcm0iLCB0cmFuc2Zvcm0pOwogICAgfQogIH0KICBnZXRFbGVtZW50c1RvVHJpZ2dlclBvcHVwKCkgewogICAgcmV0dXJuIHRoaXMuI3BvbHlsaW5lczsKICB9CiAgYWRkSGlnaGxpZ2h0QXJlYSgpIHsKICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImhpZ2hsaWdodEFyZWEiKTsKICB9Cn0KY2xhc3MgSGlnaGxpZ2h0QW5ub3RhdGlvbkVsZW1lbnQgZXh0ZW5kcyBBbm5vdGF0aW9uRWxlbWVudCB7CiAgY29uc3RydWN0b3IocGFyYW1ldGVycykgewogICAgc3VwZXIocGFyYW1ldGVycywgewogICAgICBpc1JlbmRlcmFibGU6IHRydWUsCiAgICAgIGlnbm9yZUJvcmRlcjogdHJ1ZSwKICAgICAgY3JlYXRlUXVhZHJpbGF0ZXJhbHM6IHRydWUKICAgIH0pOwogICAgdGhpcy5hbm5vdGF0aW9uRWRpdG9yVHlwZSA9IEFubm90YXRpb25FZGl0b3JUeXBlLkhJR0hMSUdIVDsKICB9CiAgcmVuZGVyKCkgewogICAgaWYgKCF0aGlzLmRhdGEucG9wdXBSZWYgJiYgdGhpcy5oYXNQb3B1cERhdGEpIHsKICAgICAgdGhpcy5fY3JlYXRlUG9wdXAoKTsKICAgIH0KICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImhpZ2hsaWdodEFubm90YXRpb24iKTsKICAgIHRoaXMuX2VkaXRPbkRvdWJsZUNsaWNrKCk7CiAgICByZXR1cm4gdGhpcy5jb250YWluZXI7CiAgfQp9CmNsYXNzIFVuZGVybGluZUFubm90YXRpb25FbGVtZW50IGV4dGVuZHMgQW5ub3RhdGlvbkVsZW1lbnQgewogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgIHN1cGVyKHBhcmFtZXRlcnMsIHsKICAgICAgaXNSZW5kZXJhYmxlOiB0cnVlLAogICAgICBpZ25vcmVCb3JkZXI6IHRydWUsCiAgICAgIGNyZWF0ZVF1YWRyaWxhdGVyYWxzOiB0cnVlCiAgICB9KTsKICB9CiAgcmVuZGVyKCkgewogICAgaWYgKCF0aGlzLmRhdGEucG9wdXBSZWYgJiYgdGhpcy5oYXNQb3B1cERhdGEpIHsKICAgICAgdGhpcy5fY3JlYXRlUG9wdXAoKTsKICAgIH0KICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoInVuZGVybGluZUFubm90YXRpb24iKTsKICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICB9Cn0KY2xhc3MgU3F1aWdnbHlBbm5vdGF0aW9uRWxlbWVudCBleHRlbmRzIEFubm90YXRpb25FbGVtZW50IHsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICBzdXBlcihwYXJhbWV0ZXJzLCB7CiAgICAgIGlzUmVuZGVyYWJsZTogdHJ1ZSwKICAgICAgaWdub3JlQm9yZGVyOiB0cnVlLAogICAgICBjcmVhdGVRdWFkcmlsYXRlcmFsczogdHJ1ZQogICAgfSk7CiAgfQogIHJlbmRlcigpIHsKICAgIGlmICghdGhpcy5kYXRhLnBvcHVwUmVmICYmIHRoaXMuaGFzUG9wdXBEYXRhKSB7CiAgICAgIHRoaXMuX2NyZWF0ZVBvcHVwKCk7CiAgICB9CiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJzcXVpZ2dseUFubm90YXRpb24iKTsKICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjsKICB9Cn0KY2xhc3MgU3RyaWtlT3V0QW5ub3RhdGlvbkVsZW1lbnQgZXh0ZW5kcyBBbm5vdGF0aW9uRWxlbWVudCB7CiAgY29uc3RydWN0b3IocGFyYW1ldGVycykgewogICAgc3VwZXIocGFyYW1ldGVycywgewogICAgICBpc1JlbmRlcmFibGU6IHRydWUsCiAgICAgIGlnbm9yZUJvcmRlcjogdHJ1ZSwKICAgICAgY3JlYXRlUXVhZHJpbGF0ZXJhbHM6IHRydWUKICAgIH0pOwogIH0KICByZW5kZXIoKSB7CiAgICBpZiAoIXRoaXMuZGF0YS5wb3B1cFJlZiAmJiB0aGlzLmhhc1BvcHVwRGF0YSkgewogICAgICB0aGlzLl9jcmVhdGVQb3B1cCgpOwogICAgfQogICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgic3RyaWtlb3V0QW5ub3RhdGlvbiIpOwogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogIH0KfQpjbGFzcyBTdGFtcEFubm90YXRpb25FbGVtZW50IGV4dGVuZHMgQW5ub3RhdGlvbkVsZW1lbnQgewogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgIHN1cGVyKHBhcmFtZXRlcnMsIHsKICAgICAgaXNSZW5kZXJhYmxlOiB0cnVlLAogICAgICBpZ25vcmVCb3JkZXI6IHRydWUKICAgIH0pOwogICAgdGhpcy5hbm5vdGF0aW9uRWRpdG9yVHlwZSA9IEFubm90YXRpb25FZGl0b3JUeXBlLlNUQU1QOwogIH0KICByZW5kZXIoKSB7CiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJzdGFtcEFubm90YXRpb24iKTsKICAgIHRoaXMuY29udGFpbmVyLnNldEF0dHJpYnV0ZSgicm9sZSIsICJpbWciKTsKICAgIGlmICghdGhpcy5kYXRhLnBvcHVwUmVmICYmIHRoaXMuaGFzUG9wdXBEYXRhKSB7CiAgICAgIHRoaXMuX2NyZWF0ZVBvcHVwKCk7CiAgICB9CiAgICB0aGlzLl9lZGl0T25Eb3VibGVDbGljaygpOwogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyOwogIH0KfQpjbGFzcyBGaWxlQXR0YWNobWVudEFubm90YXRpb25FbGVtZW50IGV4dGVuZHMgQW5ub3RhdGlvbkVsZW1lbnQgewogICN0cmlnZ2VyID0gbnVsbDsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICBzdXBlcihwYXJhbWV0ZXJzLCB7CiAgICAgIGlzUmVuZGVyYWJsZTogdHJ1ZQogICAgfSk7CiAgICBjb25zdCB7CiAgICAgIGZpbGUKICAgIH0gPSB0aGlzLmRhdGE7CiAgICB0aGlzLmZpbGVuYW1lID0gZmlsZS5maWxlbmFtZTsKICAgIHRoaXMuY29udGVudCA9IGZpbGUuY29udGVudDsKICAgIHRoaXMubGlua1NlcnZpY2UuZXZlbnRCdXM/LmRpc3BhdGNoKCJmaWxlYXR0YWNobWVudGFubm90YXRpb24iLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgLi4uZmlsZQogICAgfSk7CiAgfQogIHJlbmRlcigpIHsKICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImZpbGVBdHRhY2htZW50QW5ub3RhdGlvbiIpOwogICAgY29uc3QgewogICAgICBjb250YWluZXIsCiAgICAgIGRhdGEKICAgIH0gPSB0aGlzOwogICAgbGV0IHRyaWdnZXI7CiAgICBpZiAoZGF0YS5oYXNBcHBlYXJhbmNlIHx8IGRhdGEuZmlsbEFscGhhID09PSAwKSB7CiAgICAgIHRyaWdnZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIH0gZWxzZSB7CiAgICAgIHRyaWdnZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICAgICAgdHJpZ2dlci5zcmMgPSBgJHt0aGlzLmltYWdlUmVzb3VyY2VzUGF0aH1hbm5vdGF0aW9uLSR7L3BhcGVyY2xpcC9pLnRlc3QoZGF0YS5uYW1lKSA/ICJwYXBlcmNsaXAiIDogInB1c2hwaW4ifS5zdmdgOwogICAgICBpZiAoZGF0YS5maWxsQWxwaGEgJiYgZGF0YS5maWxsQWxwaGEgPCAxKSB7CiAgICAgICAgdHJpZ2dlci5zdHlsZSA9IGBmaWx0ZXI6IG9wYWNpdHkoJHtNYXRoLnJvdW5kKGRhdGEuZmlsbEFscGhhICogMTAwKX0lKTtgOwogICAgICB9CiAgICB9CiAgICB0cmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgdGhpcy4jZG93bmxvYWQuYmluZCh0aGlzKSk7CiAgICB0aGlzLiN0cmlnZ2VyID0gdHJpZ2dlcjsKICAgIGNvbnN0IHsKICAgICAgaXNNYWMKICAgIH0gPSB1dGlsX0ZlYXR1cmVUZXN0LnBsYXRmb3JtOwogICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBldnQgPT4gewogICAgICBpZiAoZXZ0LmtleSA9PT0gIkVudGVyIiAmJiAoaXNNYWMgPyBldnQubWV0YUtleSA6IGV2dC5jdHJsS2V5KSkgewogICAgICAgIHRoaXMuI2Rvd25sb2FkKCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFkYXRhLnBvcHVwUmVmICYmIHRoaXMuaGFzUG9wdXBEYXRhKSB7CiAgICAgIHRoaXMuX2NyZWF0ZVBvcHVwKCk7CiAgICB9IGVsc2UgewogICAgICB0cmlnZ2VyLmNsYXNzTGlzdC5hZGQoInBvcHVwVHJpZ2dlckFyZWEiKTsKICAgIH0KICAgIGNvbnRhaW5lci5hcHBlbmQodHJpZ2dlcik7CiAgICByZXR1cm4gY29udGFpbmVyOwogIH0KICBnZXRFbGVtZW50c1RvVHJpZ2dlclBvcHVwKCkgewogICAgcmV0dXJuIHRoaXMuI3RyaWdnZXI7CiAgfQogIGFkZEhpZ2hsaWdodEFyZWEoKSB7CiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJoaWdobGlnaHRBcmVhIik7CiAgfQogICNkb3dubG9hZCgpIHsKICAgIHRoaXMuZG93bmxvYWRNYW5hZ2VyPy5vcGVuT3JEb3dubG9hZERhdGEodGhpcy5jb250ZW50LCB0aGlzLmZpbGVuYW1lKTsKICB9Cn0KY2xhc3MgQW5ub3RhdGlvbkxheWVyIHsKICAjYWNjZXNzaWJpbGl0eU1hbmFnZXIgPSBudWxsOwogICNhbm5vdGF0aW9uQ2FudmFzTWFwID0gbnVsbDsKICAjZWRpdGFibGVBbm5vdGF0aW9ucyA9IG5ldyBNYXAoKTsKICAjc3RydWN0VHJlZUxheWVyID0gbnVsbDsKICBjb25zdHJ1Y3Rvcih7CiAgICBkaXYsCiAgICBhY2Nlc3NpYmlsaXR5TWFuYWdlciwKICAgIGFubm90YXRpb25DYW52YXNNYXAsCiAgICBhbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyLAogICAgcGFnZSwKICAgIHZpZXdwb3J0LAogICAgc3RydWN0VHJlZUxheWVyCiAgfSkgewogICAgdGhpcy5kaXYgPSBkaXY7CiAgICB0aGlzLiNhY2Nlc3NpYmlsaXR5TWFuYWdlciA9IGFjY2Vzc2liaWxpdHlNYW5hZ2VyOwogICAgdGhpcy4jYW5ub3RhdGlvbkNhbnZhc01hcCA9IGFubm90YXRpb25DYW52YXNNYXA7CiAgICB0aGlzLiNzdHJ1Y3RUcmVlTGF5ZXIgPSBzdHJ1Y3RUcmVlTGF5ZXIgfHwgbnVsbDsKICAgIHRoaXMucGFnZSA9IHBhZ2U7CiAgICB0aGlzLnZpZXdwb3J0ID0gdmlld3BvcnQ7CiAgICB0aGlzLnpJbmRleCA9IDA7CiAgICB0aGlzLl9hbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyID0gYW5ub3RhdGlvbkVkaXRvclVJTWFuYWdlcjsKICB9CiAgaGFzRWRpdGFibGVBbm5vdGF0aW9ucygpIHsKICAgIHJldHVybiB0aGlzLiNlZGl0YWJsZUFubm90YXRpb25zLnNpemUgPiAwOwogIH0KICBhc3luYyAjYXBwZW5kRWxlbWVudChlbGVtZW50LCBpZCkgewogICAgY29uc3QgY29udGVudEVsZW1lbnQgPSBlbGVtZW50LmZpcnN0Q2hpbGQgfHwgZWxlbWVudDsKICAgIGNvbnN0IGFubm90YXRpb25JZCA9IGNvbnRlbnRFbGVtZW50LmlkID0gYCR7QW5ub3RhdGlvblByZWZpeH0ke2lkfWA7CiAgICBjb25zdCBhcmlhQXR0cmlidXRlcyA9IGF3YWl0IHRoaXMuI3N0cnVjdFRyZWVMYXllcj8uZ2V0QXJpYUF0dHJpYnV0ZXMoYW5ub3RhdGlvbklkKTsKICAgIGlmIChhcmlhQXR0cmlidXRlcykgewogICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBhcmlhQXR0cmlidXRlcykgewogICAgICAgIGNvbnRlbnRFbGVtZW50LnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTsKICAgICAgfQogICAgfQogICAgdGhpcy5kaXYuYXBwZW5kKGVsZW1lbnQpOwogICAgdGhpcy4jYWNjZXNzaWJpbGl0eU1hbmFnZXI/Lm1vdmVFbGVtZW50SW5ET00odGhpcy5kaXYsIGVsZW1lbnQsIGNvbnRlbnRFbGVtZW50LCBmYWxzZSk7CiAgfQogIGFzeW5jIHJlbmRlcihwYXJhbXMpIHsKICAgIGNvbnN0IHsKICAgICAgYW5ub3RhdGlvbnMKICAgIH0gPSBwYXJhbXM7CiAgICBjb25zdCBsYXllciA9IHRoaXMuZGl2OwogICAgc2V0TGF5ZXJEaW1lbnNpb25zKGxheWVyLCB0aGlzLnZpZXdwb3J0KTsKICAgIGNvbnN0IHBvcHVwVG9FbGVtZW50cyA9IG5ldyBNYXAoKTsKICAgIGNvbnN0IGVsZW1lbnRQYXJhbXMgPSB7CiAgICAgIGRhdGE6IG51bGwsCiAgICAgIGxheWVyLAogICAgICBsaW5rU2VydmljZTogcGFyYW1zLmxpbmtTZXJ2aWNlLAogICAgICBkb3dubG9hZE1hbmFnZXI6IHBhcmFtcy5kb3dubG9hZE1hbmFnZXIsCiAgICAgIGltYWdlUmVzb3VyY2VzUGF0aDogcGFyYW1zLmltYWdlUmVzb3VyY2VzUGF0aCB8fCAiIiwKICAgICAgcmVuZGVyRm9ybXM6IHBhcmFtcy5yZW5kZXJGb3JtcyAhPT0gZmFsc2UsCiAgICAgIHN2Z0ZhY3Rvcnk6IG5ldyBET01TVkdGYWN0b3J5KCksCiAgICAgIGFubm90YXRpb25TdG9yYWdlOiBwYXJhbXMuYW5ub3RhdGlvblN0b3JhZ2UgfHwgbmV3IEFubm90YXRpb25TdG9yYWdlKCksCiAgICAgIGVuYWJsZVNjcmlwdGluZzogcGFyYW1zLmVuYWJsZVNjcmlwdGluZyA9PT0gdHJ1ZSwKICAgICAgaGFzSlNBY3Rpb25zOiBwYXJhbXMuaGFzSlNBY3Rpb25zLAogICAgICBmaWVsZE9iamVjdHM6IHBhcmFtcy5maWVsZE9iamVjdHMsCiAgICAgIHBhcmVudDogdGhpcywKICAgICAgZWxlbWVudHM6IG51bGwKICAgIH07CiAgICBmb3IgKGNvbnN0IGRhdGEgb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKGRhdGEubm9IVE1MKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaXNQb3B1cEFubm90YXRpb24gPSBkYXRhLmFubm90YXRpb25UeXBlID09PSBBbm5vdGF0aW9uVHlwZS5QT1BVUDsKICAgICAgaWYgKCFpc1BvcHVwQW5ub3RhdGlvbikgewogICAgICAgIGlmIChkYXRhLnJlY3RbMl0gPT09IGRhdGEucmVjdFswXSB8fCBkYXRhLnJlY3RbM10gPT09IGRhdGEucmVjdFsxXSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGVsZW1lbnRzID0gcG9wdXBUb0VsZW1lbnRzLmdldChkYXRhLmlkKTsKICAgICAgICBpZiAoIWVsZW1lbnRzKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgZWxlbWVudFBhcmFtcy5lbGVtZW50cyA9IGVsZW1lbnRzOwogICAgICB9CiAgICAgIGVsZW1lbnRQYXJhbXMuZGF0YSA9IGRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSBBbm5vdGF0aW9uRWxlbWVudEZhY3RvcnkuY3JlYXRlKGVsZW1lbnRQYXJhbXMpOwogICAgICBpZiAoIWVsZW1lbnQuaXNSZW5kZXJhYmxlKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFpc1BvcHVwQW5ub3RhdGlvbiAmJiBkYXRhLnBvcHVwUmVmKSB7CiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBwb3B1cFRvRWxlbWVudHMuZ2V0KGRhdGEucG9wdXBSZWYpOwogICAgICAgIGlmICghZWxlbWVudHMpIHsKICAgICAgICAgIHBvcHVwVG9FbGVtZW50cy5zZXQoZGF0YS5wb3B1cFJlZiwgW2VsZW1lbnRdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZWxlbWVudHMucHVzaChlbGVtZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgcmVuZGVyZWQgPSBlbGVtZW50LnJlbmRlcigpOwogICAgICBpZiAoZGF0YS5oaWRkZW4pIHsKICAgICAgICByZW5kZXJlZC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgIH0KICAgICAgYXdhaXQgdGhpcy4jYXBwZW5kRWxlbWVudChyZW5kZXJlZCwgZGF0YS5pZCk7CiAgICAgIGlmIChlbGVtZW50Ll9pc0VkaXRhYmxlKSB7CiAgICAgICAgdGhpcy4jZWRpdGFibGVBbm5vdGF0aW9ucy5zZXQoZWxlbWVudC5kYXRhLmlkLCBlbGVtZW50KTsKICAgICAgICB0aGlzLl9hbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyPy5yZW5kZXJBbm5vdGF0aW9uRWxlbWVudChlbGVtZW50KTsKICAgICAgfQogICAgfQogICAgdGhpcy4jc2V0QW5ub3RhdGlvbkNhbnZhc01hcCgpOwogIH0KICBhc3luYyBhZGRMaW5rQW5ub3RhdGlvbnMoYW5ub3RhdGlvbnMsIGxpbmtTZXJ2aWNlKSB7CiAgICBjb25zdCBlbGVtZW50UGFyYW1zID0gewogICAgICBkYXRhOiBudWxsLAogICAgICBsYXllcjogdGhpcy5kaXYsCiAgICAgIGxpbmtTZXJ2aWNlLAogICAgICBzdmdGYWN0b3J5OiBuZXcgRE9NU1ZHRmFjdG9yeSgpLAogICAgICBwYXJlbnQ6IHRoaXMKICAgIH07CiAgICBmb3IgKGNvbnN0IGRhdGEgb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgZGF0YS5ib3JkZXJTdHlsZSB8fD0gQW5ub3RhdGlvbkxheWVyLl9kZWZhdWx0Qm9yZGVyU3R5bGU7CiAgICAgIGVsZW1lbnRQYXJhbXMuZGF0YSA9IGRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSBBbm5vdGF0aW9uRWxlbWVudEZhY3RvcnkuY3JlYXRlKGVsZW1lbnRQYXJhbXMpOwogICAgICBpZiAoIWVsZW1lbnQuaXNSZW5kZXJhYmxlKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgcmVuZGVyZWQgPSBlbGVtZW50LnJlbmRlcigpOwogICAgICBhd2FpdCB0aGlzLiNhcHBlbmRFbGVtZW50KHJlbmRlcmVkLCBkYXRhLmlkKTsKICAgIH0KICB9CiAgdXBkYXRlKHsKICAgIHZpZXdwb3J0CiAgfSkgewogICAgY29uc3QgbGF5ZXIgPSB0aGlzLmRpdjsKICAgIHRoaXMudmlld3BvcnQgPSB2aWV3cG9ydDsKICAgIHNldExheWVyRGltZW5zaW9ucyhsYXllciwgewogICAgICByb3RhdGlvbjogdmlld3BvcnQucm90YXRpb24KICAgIH0pOwogICAgdGhpcy4jc2V0QW5ub3RhdGlvbkNhbnZhc01hcCgpOwogICAgbGF5ZXIuaGlkZGVuID0gZmFsc2U7CiAgfQogICNzZXRBbm5vdGF0aW9uQ2FudmFzTWFwKCkgewogICAgaWYgKCF0aGlzLiNhbm5vdGF0aW9uQ2FudmFzTWFwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGxheWVyID0gdGhpcy5kaXY7CiAgICBmb3IgKGNvbnN0IFtpZCwgY2FudmFzXSBvZiB0aGlzLiNhbm5vdGF0aW9uQ2FudmFzTWFwKSB7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSBsYXllci5xdWVyeVNlbGVjdG9yKGBbZGF0YS1hbm5vdGF0aW9uLWlkPSIke2lkfSJdYCk7CiAgICAgIGlmICghZWxlbWVudCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNhbnZhcy5jbGFzc05hbWUgPSAiYW5ub3RhdGlvbkNvbnRlbnQiOwogICAgICBjb25zdCB7CiAgICAgICAgZmlyc3RDaGlsZAogICAgICB9ID0gZWxlbWVudDsKICAgICAgaWYgKCFmaXJzdENoaWxkKSB7CiAgICAgICAgZWxlbWVudC5hcHBlbmQoY2FudmFzKTsKICAgICAgfSBlbHNlIGlmIChmaXJzdENoaWxkLm5vZGVOYW1lID09PSAiQ0FOVkFTIikgewogICAgICAgIGZpcnN0Q2hpbGQucmVwbGFjZVdpdGgoY2FudmFzKTsKICAgICAgfSBlbHNlIGlmICghZmlyc3RDaGlsZC5jbGFzc0xpc3QuY29udGFpbnMoImFubm90YXRpb25Db250ZW50IikpIHsKICAgICAgICBmaXJzdENoaWxkLmJlZm9yZShjYW52YXMpOwogICAgICB9IGVsc2UgewogICAgICAgIGZpcnN0Q2hpbGQuYWZ0ZXIoY2FudmFzKTsKICAgICAgfQogICAgICBjb25zdCBlZGl0YWJsZUFubm90YXRpb24gPSB0aGlzLiNlZGl0YWJsZUFubm90YXRpb25zLmdldChpZCk7CiAgICAgIGlmICghZWRpdGFibGVBbm5vdGF0aW9uKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGVkaXRhYmxlQW5ub3RhdGlvbi5faGFzTm9DYW52YXMpIHsKICAgICAgICB0aGlzLl9hbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyPy5zZXRNaXNzaW5nQ2FudmFzKGlkLCBlbGVtZW50LmlkLCBjYW52YXMpOwogICAgICAgIGVkaXRhYmxlQW5ub3RhdGlvbi5faGFzTm9DYW52YXMgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlZGl0YWJsZUFubm90YXRpb24uY2FudmFzID0gY2FudmFzOwogICAgICB9CiAgICB9CiAgICB0aGlzLiNhbm5vdGF0aW9uQ2FudmFzTWFwLmNsZWFyKCk7CiAgfQogIGdldEVkaXRhYmxlQW5ub3RhdGlvbnMoKSB7CiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLiNlZGl0YWJsZUFubm90YXRpb25zLnZhbHVlcygpKTsKICB9CiAgZ2V0RWRpdGFibGVBbm5vdGF0aW9uKGlkKSB7CiAgICByZXR1cm4gdGhpcy4jZWRpdGFibGVBbm5vdGF0aW9ucy5nZXQoaWQpOwogIH0KICBzdGF0aWMgZ2V0IF9kZWZhdWx0Qm9yZGVyU3R5bGUoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfZGVmYXVsdEJvcmRlclN0eWxlIiwgT2JqZWN0LmZyZWV6ZSh7CiAgICAgIHdpZHRoOiAxLAogICAgICByYXdXaWR0aDogMSwKICAgICAgc3R5bGU6IEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuU09MSUQsCiAgICAgIGRhc2hBcnJheTogWzNdLAogICAgICBob3Jpem9udGFsQ29ybmVyUmFkaXVzOiAwLAogICAgICB2ZXJ0aWNhbENvcm5lclJhZGl1czogMAogICAgfSkpOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvZWRpdG9yL2ZyZWV0ZXh0LmpzCgoKCgpjb25zdCBFT0xfUEFUVEVSTiA9IC9cclxuP3xcbi9nOwpjbGFzcyBGcmVlVGV4dEVkaXRvciBleHRlbmRzIEFubm90YXRpb25FZGl0b3IgewogICNjb2xvcjsKICAjY29udGVudCA9ICIiOwogICNlZGl0b3JEaXZJZCA9IGAke3RoaXMuaWR9LWVkaXRvcmA7CiAgI2VkaXRNb2RlQUMgPSBudWxsOwogICNmb250U2l6ZTsKICBzdGF0aWMgX2ZyZWVUZXh0RGVmYXVsdENvbnRlbnQgPSAiIjsKICBzdGF0aWMgX2ludGVybmFsUGFkZGluZyA9IDA7CiAgc3RhdGljIF9kZWZhdWx0Q29sb3IgPSBudWxsOwogIHN0YXRpYyBfZGVmYXVsdEZvbnRTaXplID0gMTA7CiAgc3RhdGljIGdldCBfa2V5Ym9hcmRNYW5hZ2VyKCkgewogICAgY29uc3QgcHJvdG8gPSBGcmVlVGV4dEVkaXRvci5wcm90b3R5cGU7CiAgICBjb25zdCBhcnJvd0NoZWNrZXIgPSBzZWxmID0+IHNlbGYuaXNFbXB0eSgpOwogICAgY29uc3Qgc21hbGwgPSBBbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyLlRSQU5TTEFURV9TTUFMTDsKICAgIGNvbnN0IGJpZyA9IEFubm90YXRpb25FZGl0b3JVSU1hbmFnZXIuVFJBTlNMQVRFX0JJRzsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9rZXlib2FyZE1hbmFnZXIiLCBuZXcgS2V5Ym9hcmRNYW5hZ2VyKFtbWyJjdHJsK3MiLCAibWFjK21ldGErcyIsICJjdHJsK3AiLCAibWFjK21ldGErcCJdLCBwcm90by5jb21taXRPclJlbW92ZSwgewogICAgICBidWJibGVzOiB0cnVlCiAgICB9XSwgW1siY3RybCtFbnRlciIsICJtYWMrbWV0YStFbnRlciIsICJFc2NhcGUiLCAibWFjK0VzY2FwZSJdLCBwcm90by5jb21taXRPclJlbW92ZV0sIFtbIkFycm93TGVmdCIsICJtYWMrQXJyb3dMZWZ0Il0sIHByb3RvLl90cmFuc2xhdGVFbXB0eSwgewogICAgICBhcmdzOiBbLXNtYWxsLCAwXSwKICAgICAgY2hlY2tlcjogYXJyb3dDaGVja2VyCiAgICB9XSwgW1siY3RybCtBcnJvd0xlZnQiLCAibWFjK3NoaWZ0K0Fycm93TGVmdCJdLCBwcm90by5fdHJhbnNsYXRlRW1wdHksIHsKICAgICAgYXJnczogWy1iaWcsIDBdLAogICAgICBjaGVja2VyOiBhcnJvd0NoZWNrZXIKICAgIH1dLCBbWyJBcnJvd1JpZ2h0IiwgIm1hYytBcnJvd1JpZ2h0Il0sIHByb3RvLl90cmFuc2xhdGVFbXB0eSwgewogICAgICBhcmdzOiBbc21hbGwsIDBdLAogICAgICBjaGVja2VyOiBhcnJvd0NoZWNrZXIKICAgIH1dLCBbWyJjdHJsK0Fycm93UmlnaHQiLCAibWFjK3NoaWZ0K0Fycm93UmlnaHQiXSwgcHJvdG8uX3RyYW5zbGF0ZUVtcHR5LCB7CiAgICAgIGFyZ3M6IFtiaWcsIDBdLAogICAgICBjaGVja2VyOiBhcnJvd0NoZWNrZXIKICAgIH1dLCBbWyJBcnJvd1VwIiwgIm1hYytBcnJvd1VwIl0sIHByb3RvLl90cmFuc2xhdGVFbXB0eSwgewogICAgICBhcmdzOiBbMCwgLXNtYWxsXSwKICAgICAgY2hlY2tlcjogYXJyb3dDaGVja2VyCiAgICB9XSwgW1siY3RybCtBcnJvd1VwIiwgIm1hYytzaGlmdCtBcnJvd1VwIl0sIHByb3RvLl90cmFuc2xhdGVFbXB0eSwgewogICAgICBhcmdzOiBbMCwgLWJpZ10sCiAgICAgIGNoZWNrZXI6IGFycm93Q2hlY2tlcgogICAgfV0sIFtbIkFycm93RG93biIsICJtYWMrQXJyb3dEb3duIl0sIHByb3RvLl90cmFuc2xhdGVFbXB0eSwgewogICAgICBhcmdzOiBbMCwgc21hbGxdLAogICAgICBjaGVja2VyOiBhcnJvd0NoZWNrZXIKICAgIH1dLCBbWyJjdHJsK0Fycm93RG93biIsICJtYWMrc2hpZnQrQXJyb3dEb3duIl0sIHByb3RvLl90cmFuc2xhdGVFbXB0eSwgewogICAgICBhcmdzOiBbMCwgYmlnXSwKICAgICAgY2hlY2tlcjogYXJyb3dDaGVja2VyCiAgICB9XV0pKTsKICB9CiAgc3RhdGljIF90eXBlID0gImZyZWV0ZXh0IjsKICBzdGF0aWMgX2VkaXRvclR5cGUgPSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5GUkVFVEVYVDsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHsKICAgICAgLi4ucGFyYW1zLAogICAgICBuYW1lOiAiZnJlZVRleHRFZGl0b3IiCiAgICB9KTsKICAgIHRoaXMuI2NvbG9yID0gcGFyYW1zLmNvbG9yIHx8IEZyZWVUZXh0RWRpdG9yLl9kZWZhdWx0Q29sb3IgfHwgQW5ub3RhdGlvbkVkaXRvci5fZGVmYXVsdExpbmVDb2xvcjsKICAgIHRoaXMuI2ZvbnRTaXplID0gcGFyYW1zLmZvbnRTaXplIHx8IEZyZWVUZXh0RWRpdG9yLl9kZWZhdWx0Rm9udFNpemU7CiAgfQogIHN0YXRpYyBpbml0aWFsaXplKGwxMG4sIHVpTWFuYWdlcikgewogICAgQW5ub3RhdGlvbkVkaXRvci5pbml0aWFsaXplKGwxMG4sIHVpTWFuYWdlcik7CiAgICBjb25zdCBzdHlsZSA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KTsKICAgIHRoaXMuX2ludGVybmFsUGFkZGluZyA9IHBhcnNlRmxvYXQoc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgiLS1mcmVldGV4dC1wYWRkaW5nIikpOwogIH0KICBzdGF0aWMgdXBkYXRlRGVmYXVsdFBhcmFtcyh0eXBlLCB2YWx1ZSkgewogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuRlJFRVRFWFRfU0laRToKICAgICAgICBGcmVlVGV4dEVkaXRvci5fZGVmYXVsdEZvbnRTaXplID0gdmFsdWU7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuRlJFRVRFWFRfQ09MT1I6CiAgICAgICAgRnJlZVRleHRFZGl0b3IuX2RlZmF1bHRDb2xvciA9IHZhbHVlOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KICB1cGRhdGVQYXJhbXModHlwZSwgdmFsdWUpIHsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLkZSRUVURVhUX1NJWkU6CiAgICAgICAgdGhpcy4jdXBkYXRlRm9udFNpemUodmFsdWUpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLkZSRUVURVhUX0NPTE9SOgogICAgICAgIHRoaXMuI3VwZGF0ZUNvbG9yKHZhbHVlKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CiAgc3RhdGljIGdldCBkZWZhdWx0UHJvcGVydGllc1RvVXBkYXRlKCkgewogICAgcmV0dXJuIFtbQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuRlJFRVRFWFRfU0laRSwgRnJlZVRleHRFZGl0b3IuX2RlZmF1bHRGb250U2l6ZV0sIFtBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5GUkVFVEVYVF9DT0xPUiwgRnJlZVRleHRFZGl0b3IuX2RlZmF1bHRDb2xvciB8fCBBbm5vdGF0aW9uRWRpdG9yLl9kZWZhdWx0TGluZUNvbG9yXV07CiAgfQogIGdldCBwcm9wZXJ0aWVzVG9VcGRhdGUoKSB7CiAgICByZXR1cm4gW1tBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5GUkVFVEVYVF9TSVpFLCB0aGlzLiNmb250U2l6ZV0sIFtBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5GUkVFVEVYVF9DT0xPUiwgdGhpcy4jY29sb3JdXTsKICB9CiAgI3VwZGF0ZUZvbnRTaXplKGZvbnRTaXplKSB7CiAgICBjb25zdCBzZXRGb250c2l6ZSA9IHNpemUgPT4gewogICAgICB0aGlzLmVkaXRvckRpdi5zdHlsZS5mb250U2l6ZSA9IGBjYWxjKCR7c2l6ZX1weCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpYDsKICAgICAgdGhpcy50cmFuc2xhdGUoMCwgLShzaXplIC0gdGhpcy4jZm9udFNpemUpICogdGhpcy5wYXJlbnRTY2FsZSk7CiAgICAgIHRoaXMuI2ZvbnRTaXplID0gc2l6ZTsKICAgICAgdGhpcy4jc2V0RWRpdG9yRGltZW5zaW9ucygpOwogICAgfTsKICAgIGNvbnN0IHNhdmVkRm9udHNpemUgPSB0aGlzLiNmb250U2l6ZTsKICAgIHRoaXMuYWRkQ29tbWFuZHMoewogICAgICBjbWQ6IHNldEZvbnRzaXplLmJpbmQodGhpcywgZm9udFNpemUpLAogICAgICB1bmRvOiBzZXRGb250c2l6ZS5iaW5kKHRoaXMsIHNhdmVkRm9udHNpemUpLAogICAgICBwb3N0OiB0aGlzLl91aU1hbmFnZXIudXBkYXRlVUkuYmluZCh0aGlzLl91aU1hbmFnZXIsIHRoaXMpLAogICAgICBtdXN0RXhlYzogdHJ1ZSwKICAgICAgdHlwZTogQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuRlJFRVRFWFRfU0laRSwKICAgICAgb3ZlcndyaXRlSWZTYW1lVHlwZTogdHJ1ZSwKICAgICAga2VlcFVuZG86IHRydWUKICAgIH0pOwogIH0KICAjdXBkYXRlQ29sb3IoY29sb3IpIHsKICAgIGNvbnN0IHNldENvbG9yID0gY29sID0+IHsKICAgICAgdGhpcy4jY29sb3IgPSB0aGlzLmVkaXRvckRpdi5zdHlsZS5jb2xvciA9IGNvbDsKICAgIH07CiAgICBjb25zdCBzYXZlZENvbG9yID0gdGhpcy4jY29sb3I7CiAgICB0aGlzLmFkZENvbW1hbmRzKHsKICAgICAgY21kOiBzZXRDb2xvci5iaW5kKHRoaXMsIGNvbG9yKSwKICAgICAgdW5kbzogc2V0Q29sb3IuYmluZCh0aGlzLCBzYXZlZENvbG9yKSwKICAgICAgcG9zdDogdGhpcy5fdWlNYW5hZ2VyLnVwZGF0ZVVJLmJpbmQodGhpcy5fdWlNYW5hZ2VyLCB0aGlzKSwKICAgICAgbXVzdEV4ZWM6IHRydWUsCiAgICAgIHR5cGU6IEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLkZSRUVURVhUX0NPTE9SLAogICAgICBvdmVyd3JpdGVJZlNhbWVUeXBlOiB0cnVlLAogICAgICBrZWVwVW5kbzogdHJ1ZQogICAgfSk7CiAgfQogIF90cmFuc2xhdGVFbXB0eSh4LCB5KSB7CiAgICB0aGlzLl91aU1hbmFnZXIudHJhbnNsYXRlU2VsZWN0ZWRFZGl0b3JzKHgsIHksIHRydWUpOwogIH0KICBnZXRJbml0aWFsVHJhbnNsYXRpb24oKSB7CiAgICBjb25zdCBzY2FsZSA9IHRoaXMucGFyZW50U2NhbGU7CiAgICByZXR1cm4gWy1GcmVlVGV4dEVkaXRvci5faW50ZXJuYWxQYWRkaW5nICogc2NhbGUsIC0oRnJlZVRleHRFZGl0b3IuX2ludGVybmFsUGFkZGluZyArIHRoaXMuI2ZvbnRTaXplKSAqIHNjYWxlXTsKICB9CiAgcmVidWlsZCgpIHsKICAgIGlmICghdGhpcy5wYXJlbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3VwZXIucmVidWlsZCgpOwogICAgaWYgKHRoaXMuZGl2ID09PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpcy5pc0F0dGFjaGVkVG9ET00pIHsKICAgICAgdGhpcy5wYXJlbnQuYWRkKHRoaXMpOwogICAgfQogIH0KICBlbmFibGVFZGl0TW9kZSgpIHsKICAgIGlmICghc3VwZXIuZW5hYmxlRWRpdE1vZGUoKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0aGlzLm92ZXJsYXlEaXYuY2xhc3NMaXN0LnJlbW92ZSgiZW5hYmxlZCIpOwogICAgdGhpcy5lZGl0b3JEaXYuY29udGVudEVkaXRhYmxlID0gdHJ1ZTsKICAgIHRoaXMuX2lzRHJhZ2dhYmxlID0gZmFsc2U7CiAgICB0aGlzLmRpdi5yZW1vdmVBdHRyaWJ1dGUoImFyaWEtYWN0aXZlZGVzY2VuZGFudCIpOwogICAgdGhpcy4jZWRpdE1vZGVBQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuX3VpTWFuYWdlci5jb21iaW5lZFNpZ25hbCh0aGlzLiNlZGl0TW9kZUFDKTsKICAgIHRoaXMuZWRpdG9yRGl2LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCB0aGlzLmVkaXRvckRpdktleWRvd24uYmluZCh0aGlzKSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgdGhpcy5lZGl0b3JEaXYuYWRkRXZlbnRMaXN0ZW5lcigiZm9jdXMiLCB0aGlzLmVkaXRvckRpdkZvY3VzLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHRoaXMuZWRpdG9yRGl2LmFkZEV2ZW50TGlzdGVuZXIoImJsdXIiLCB0aGlzLmVkaXRvckRpdkJsdXIuYmluZCh0aGlzKSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgdGhpcy5lZGl0b3JEaXYuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCB0aGlzLmVkaXRvckRpdklucHV0LmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHRoaXMuZWRpdG9yRGl2LmFkZEV2ZW50TGlzdGVuZXIoInBhc3RlIiwgdGhpcy5lZGl0b3JEaXZQYXN0ZS5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZGlzYWJsZUVkaXRNb2RlKCkgewogICAgaWYgKCFzdXBlci5kaXNhYmxlRWRpdE1vZGUoKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0aGlzLm92ZXJsYXlEaXYuY2xhc3NMaXN0LmFkZCgiZW5hYmxlZCIpOwogICAgdGhpcy5lZGl0b3JEaXYuY29udGVudEVkaXRhYmxlID0gZmFsc2U7CiAgICB0aGlzLmRpdi5zZXRBdHRyaWJ1dGUoImFyaWEtYWN0aXZlZGVzY2VuZGFudCIsIHRoaXMuI2VkaXRvckRpdklkKTsKICAgIHRoaXMuX2lzRHJhZ2dhYmxlID0gdHJ1ZTsKICAgIHRoaXMuI2VkaXRNb2RlQUM/LmFib3J0KCk7CiAgICB0aGlzLiNlZGl0TW9kZUFDID0gbnVsbDsKICAgIHRoaXMuZGl2LmZvY3VzKHsKICAgICAgcHJldmVudFNjcm9sbDogdHJ1ZQogICAgfSk7CiAgICB0aGlzLmlzRWRpdGluZyA9IGZhbHNlOwogICAgdGhpcy5wYXJlbnQuZGl2LmNsYXNzTGlzdC5hZGQoImZyZWV0ZXh0RWRpdGluZyIpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIGZvY3VzaW4oZXZlbnQpIHsKICAgIGlmICghdGhpcy5fZm9jdXNFdmVudHNBbGxvd2VkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN1cGVyLmZvY3VzaW4oZXZlbnQpOwogICAgaWYgKGV2ZW50LnRhcmdldCAhPT0gdGhpcy5lZGl0b3JEaXYpIHsKICAgICAgdGhpcy5lZGl0b3JEaXYuZm9jdXMoKTsKICAgIH0KICB9CiAgb25jZUFkZGVkKGZvY3VzKSB7CiAgICBpZiAodGhpcy53aWR0aCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmVuYWJsZUVkaXRNb2RlKCk7CiAgICBpZiAoZm9jdXMpIHsKICAgICAgdGhpcy5lZGl0b3JEaXYuZm9jdXMoKTsKICAgIH0KICAgIGlmICh0aGlzLl9pbml0aWFsT3B0aW9ucz8uaXNDZW50ZXJlZCkgewogICAgICB0aGlzLmNlbnRlcigpOwogICAgfQogICAgdGhpcy5faW5pdGlhbE9wdGlvbnMgPSBudWxsOwogIH0KICBpc0VtcHR5KCkgewogICAgcmV0dXJuICF0aGlzLmVkaXRvckRpdiB8fCB0aGlzLmVkaXRvckRpdi5pbm5lclRleHQudHJpbSgpID09PSAiIjsKICB9CiAgcmVtb3ZlKCkgewogICAgdGhpcy5pc0VkaXRpbmcgPSBmYWxzZTsKICAgIGlmICh0aGlzLnBhcmVudCkgewogICAgICB0aGlzLnBhcmVudC5zZXRFZGl0aW5nU3RhdGUodHJ1ZSk7CiAgICAgIHRoaXMucGFyZW50LmRpdi5jbGFzc0xpc3QuYWRkKCJmcmVldGV4dEVkaXRpbmciKTsKICAgIH0KICAgIHN1cGVyLnJlbW92ZSgpOwogIH0KICAjZXh0cmFjdFRleHQoKSB7CiAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgIHRoaXMuZWRpdG9yRGl2Lm5vcm1hbGl6ZSgpOwogICAgbGV0IHByZXZDaGlsZCA9IG51bGw7CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMuZWRpdG9yRGl2LmNoaWxkTm9kZXMpIHsKICAgICAgaWYgKHByZXZDaGlsZD8ubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFICYmIGNoaWxkLm5vZGVOYW1lID09PSAiQlIiKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goRnJlZVRleHRFZGl0b3IuI2dldE5vZGVDb250ZW50KGNoaWxkKSk7CiAgICAgIHByZXZDaGlsZCA9IGNoaWxkOwogICAgfQogICAgcmV0dXJuIGJ1ZmZlci5qb2luKCJcbiIpOwogIH0KICAjc2V0RWRpdG9yRGltZW5zaW9ucygpIHsKICAgIGNvbnN0IFtwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0XSA9IHRoaXMucGFyZW50RGltZW5zaW9uczsKICAgIGxldCByZWN0OwogICAgaWYgKHRoaXMuaXNBdHRhY2hlZFRvRE9NKSB7CiAgICAgIHJlY3QgPSB0aGlzLmRpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBjdXJyZW50TGF5ZXIsCiAgICAgICAgZGl2CiAgICAgIH0gPSB0aGlzOwogICAgICBjb25zdCBzYXZlZERpc3BsYXkgPSBkaXYuc3R5bGUuZGlzcGxheTsKICAgICAgY29uc3Qgc2F2ZWRWaXNpYmlsaXR5ID0gZGl2LmNsYXNzTGlzdC5jb250YWlucygiaGlkZGVuIik7CiAgICAgIGRpdi5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKICAgICAgZGl2LnN0eWxlLmRpc3BsYXkgPSAiaGlkZGVuIjsKICAgICAgY3VycmVudExheWVyLmRpdi5hcHBlbmQodGhpcy5kaXYpOwogICAgICByZWN0ID0gZGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICBkaXYucmVtb3ZlKCk7CiAgICAgIGRpdi5zdHlsZS5kaXNwbGF5ID0gc2F2ZWREaXNwbGF5OwogICAgICBkaXYuY2xhc3NMaXN0LnRvZ2dsZSgiaGlkZGVuIiwgc2F2ZWRWaXNpYmlsaXR5KTsKICAgIH0KICAgIGlmICh0aGlzLnJvdGF0aW9uICUgMTgwID09PSB0aGlzLnBhcmVudFJvdGF0aW9uICUgMTgwKSB7CiAgICAgIHRoaXMud2lkdGggPSByZWN0LndpZHRoIC8gcGFyZW50V2lkdGg7CiAgICAgIHRoaXMuaGVpZ2h0ID0gcmVjdC5oZWlnaHQgLyBwYXJlbnRIZWlnaHQ7CiAgICB9IGVsc2UgewogICAgICB0aGlzLndpZHRoID0gcmVjdC5oZWlnaHQgLyBwYXJlbnRXaWR0aDsKICAgICAgdGhpcy5oZWlnaHQgPSByZWN0LndpZHRoIC8gcGFyZW50SGVpZ2h0OwogICAgfQogICAgdGhpcy5maXhBbmRTZXRQb3NpdGlvbigpOwogIH0KICBjb21taXQoKSB7CiAgICBpZiAoIXRoaXMuaXNJbkVkaXRNb2RlKCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3VwZXIuY29tbWl0KCk7CiAgICB0aGlzLmRpc2FibGVFZGl0TW9kZSgpOwogICAgY29uc3Qgc2F2ZWRUZXh0ID0gdGhpcy4jY29udGVudDsKICAgIGNvbnN0IG5ld1RleHQgPSB0aGlzLiNjb250ZW50ID0gdGhpcy4jZXh0cmFjdFRleHQoKS50cmltRW5kKCk7CiAgICBpZiAoc2F2ZWRUZXh0ID09PSBuZXdUZXh0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHNldFRleHQgPSB0ZXh0ID0+IHsKICAgICAgdGhpcy4jY29udGVudCA9IHRleHQ7CiAgICAgIGlmICghdGV4dCkgewogICAgICAgIHRoaXMucmVtb3ZlKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuI3NldENvbnRlbnQoKTsKICAgICAgdGhpcy5fdWlNYW5hZ2VyLnJlYnVpbGQodGhpcyk7CiAgICAgIHRoaXMuI3NldEVkaXRvckRpbWVuc2lvbnMoKTsKICAgIH07CiAgICB0aGlzLmFkZENvbW1hbmRzKHsKICAgICAgY21kOiAoKSA9PiB7CiAgICAgICAgc2V0VGV4dChuZXdUZXh0KTsKICAgICAgfSwKICAgICAgdW5kbzogKCkgPT4gewogICAgICAgIHNldFRleHQoc2F2ZWRUZXh0KTsKICAgICAgfSwKICAgICAgbXVzdEV4ZWM6IGZhbHNlCiAgICB9KTsKICAgIHRoaXMuI3NldEVkaXRvckRpbWVuc2lvbnMoKTsKICB9CiAgc2hvdWxkR2V0S2V5Ym9hcmRFdmVudHMoKSB7CiAgICByZXR1cm4gdGhpcy5pc0luRWRpdE1vZGUoKTsKICB9CiAgZW50ZXJJbkVkaXRNb2RlKCkgewogICAgdGhpcy5lbmFibGVFZGl0TW9kZSgpOwogICAgdGhpcy5lZGl0b3JEaXYuZm9jdXMoKTsKICB9CiAga2V5ZG93bihldmVudCkgewogICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gdGhpcy5kaXYgJiYgZXZlbnQua2V5ID09PSAiRW50ZXIiKSB7CiAgICAgIHRoaXMuZW50ZXJJbkVkaXRNb2RlKCk7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICB9CiAgfQogIGVkaXRvckRpdktleWRvd24oZXZlbnQpIHsKICAgIEZyZWVUZXh0RWRpdG9yLl9rZXlib2FyZE1hbmFnZXIuZXhlYyh0aGlzLCBldmVudCk7CiAgfQogIGVkaXRvckRpdkZvY3VzKGV2ZW50KSB7CiAgICB0aGlzLmlzRWRpdGluZyA9IHRydWU7CiAgfQogIGVkaXRvckRpdkJsdXIoZXZlbnQpIHsKICAgIHRoaXMuaXNFZGl0aW5nID0gZmFsc2U7CiAgfQogIGVkaXRvckRpdklucHV0KGV2ZW50KSB7CiAgICB0aGlzLnBhcmVudC5kaXYuY2xhc3NMaXN0LnRvZ2dsZSgiZnJlZXRleHRFZGl0aW5nIiwgdGhpcy5pc0VtcHR5KCkpOwogIH0KICBkaXNhYmxlRWRpdGluZygpIHsKICAgIHRoaXMuZWRpdG9yRGl2LnNldEF0dHJpYnV0ZSgicm9sZSIsICJjb21tZW50Iik7CiAgICB0aGlzLmVkaXRvckRpdi5yZW1vdmVBdHRyaWJ1dGUoImFyaWEtbXVsdGlsaW5lIik7CiAgfQogIGVuYWJsZUVkaXRpbmcoKSB7CiAgICB0aGlzLmVkaXRvckRpdi5zZXRBdHRyaWJ1dGUoInJvbGUiLCAidGV4dGJveCIpOwogICAgdGhpcy5lZGl0b3JEaXYuc2V0QXR0cmlidXRlKCJhcmlhLW11bHRpbGluZSIsIHRydWUpOwogIH0KICBnZXQgY2FuQ2hhbmdlQ29udGVudCgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICByZW5kZXIoKSB7CiAgICBpZiAodGhpcy5kaXYpIHsKICAgICAgcmV0dXJuIHRoaXMuZGl2OwogICAgfQogICAgbGV0IGJhc2VYLCBiYXNlWTsKICAgIGlmICh0aGlzLl9pc0NvcHkgfHwgdGhpcy5hbm5vdGF0aW9uRWxlbWVudElkKSB7CiAgICAgIGJhc2VYID0gdGhpcy54OwogICAgICBiYXNlWSA9IHRoaXMueTsKICAgIH0KICAgIHN1cGVyLnJlbmRlcigpOwogICAgdGhpcy5lZGl0b3JEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIHRoaXMuZWRpdG9yRGl2LmNsYXNzTmFtZSA9ICJpbnRlcm5hbCI7CiAgICB0aGlzLmVkaXRvckRpdi5zZXRBdHRyaWJ1dGUoImlkIiwgdGhpcy4jZWRpdG9yRGl2SWQpOwogICAgdGhpcy5lZGl0b3JEaXYuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCAicGRmanMtZnJlZS10ZXh0MiIpOwogICAgdGhpcy5lZGl0b3JEaXYuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4tYXR0cnMiLCAiZGVmYXVsdC1jb250ZW50Iik7CiAgICB0aGlzLmVuYWJsZUVkaXRpbmcoKTsKICAgIHRoaXMuZWRpdG9yRGl2LmNvbnRlbnRFZGl0YWJsZSA9IHRydWU7CiAgICBjb25zdCB7CiAgICAgIHN0eWxlCiAgICB9ID0gdGhpcy5lZGl0b3JEaXY7CiAgICBzdHlsZS5mb250U2l6ZSA9IGBjYWxjKCR7dGhpcy4jZm9udFNpemV9cHggKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKWA7CiAgICBzdHlsZS5jb2xvciA9IHRoaXMuI2NvbG9yOwogICAgdGhpcy5kaXYuYXBwZW5kKHRoaXMuZWRpdG9yRGl2KTsKICAgIHRoaXMub3ZlcmxheURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgdGhpcy5vdmVybGF5RGl2LmNsYXNzTGlzdC5hZGQoIm92ZXJsYXkiLCAiZW5hYmxlZCIpOwogICAgdGhpcy5kaXYuYXBwZW5kKHRoaXMub3ZlcmxheURpdik7CiAgICBpZiAodGhpcy5faXNDb3B5IHx8IHRoaXMuYW5ub3RhdGlvbkVsZW1lbnRJZCkgewogICAgICBjb25zdCBbcGFyZW50V2lkdGgsIHBhcmVudEhlaWdodF0gPSB0aGlzLnBhcmVudERpbWVuc2lvbnM7CiAgICAgIGlmICh0aGlzLmFubm90YXRpb25FbGVtZW50SWQpIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBwb3NpdGlvbgogICAgICAgIH0gPSB0aGlzLl9pbml0aWFsRGF0YTsKICAgICAgICBsZXQgW3R4LCB0eV0gPSB0aGlzLmdldEluaXRpYWxUcmFuc2xhdGlvbigpOwogICAgICAgIFt0eCwgdHldID0gdGhpcy5wYWdlVHJhbnNsYXRpb25Ub1NjcmVlbih0eCwgdHkpOwogICAgICAgIGNvbnN0IFtwYWdlV2lkdGgsIHBhZ2VIZWlnaHRdID0gdGhpcy5wYWdlRGltZW5zaW9uczsKICAgICAgICBjb25zdCBbcGFnZVgsIHBhZ2VZXSA9IHRoaXMucGFnZVRyYW5zbGF0aW9uOwogICAgICAgIGxldCBwb3NYLCBwb3NZOwogICAgICAgIHN3aXRjaCAodGhpcy5yb3RhdGlvbikgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBwb3NYID0gYmFzZVggKyAocG9zaXRpb25bMF0gLSBwYWdlWCkgLyBwYWdlV2lkdGg7CiAgICAgICAgICAgIHBvc1kgPSBiYXNlWSArIHRoaXMuaGVpZ2h0IC0gKHBvc2l0aW9uWzFdIC0gcGFnZVkpIC8gcGFnZUhlaWdodDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDkwOgogICAgICAgICAgICBwb3NYID0gYmFzZVggKyAocG9zaXRpb25bMF0gLSBwYWdlWCkgLyBwYWdlV2lkdGg7CiAgICAgICAgICAgIHBvc1kgPSBiYXNlWSAtIChwb3NpdGlvblsxXSAtIHBhZ2VZKSAvIHBhZ2VIZWlnaHQ7CiAgICAgICAgICAgIFt0eCwgdHldID0gW3R5LCAtdHhdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTgwOgogICAgICAgICAgICBwb3NYID0gYmFzZVggLSB0aGlzLndpZHRoICsgKHBvc2l0aW9uWzBdIC0gcGFnZVgpIC8gcGFnZVdpZHRoOwogICAgICAgICAgICBwb3NZID0gYmFzZVkgLSAocG9zaXRpb25bMV0gLSBwYWdlWSkgLyBwYWdlSGVpZ2h0OwogICAgICAgICAgICBbdHgsIHR5XSA9IFstdHgsIC10eV07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyNzA6CiAgICAgICAgICAgIHBvc1ggPSBiYXNlWCArIChwb3NpdGlvblswXSAtIHBhZ2VYIC0gdGhpcy5oZWlnaHQgKiBwYWdlSGVpZ2h0KSAvIHBhZ2VXaWR0aDsKICAgICAgICAgICAgcG9zWSA9IGJhc2VZICsgKHBvc2l0aW9uWzFdIC0gcGFnZVkgLSB0aGlzLndpZHRoICogcGFnZVdpZHRoKSAvIHBhZ2VIZWlnaHQ7CiAgICAgICAgICAgIFt0eCwgdHldID0gWy10eSwgdHhdOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgdGhpcy5zZXRBdChwb3NYICogcGFyZW50V2lkdGgsIHBvc1kgKiBwYXJlbnRIZWlnaHQsIHR4LCB0eSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fbW92ZUFmdGVyUGFzdGUoYmFzZVgsIGJhc2VZKTsKICAgICAgfQogICAgICB0aGlzLiNzZXRDb250ZW50KCk7CiAgICAgIHRoaXMuX2lzRHJhZ2dhYmxlID0gdHJ1ZTsKICAgICAgdGhpcy5lZGl0b3JEaXYuY29udGVudEVkaXRhYmxlID0gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9pc0RyYWdnYWJsZSA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRvckRpdi5jb250ZW50RWRpdGFibGUgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIHRoaXMuZGl2OwogIH0KICBzdGF0aWMgI2dldE5vZGVDb250ZW50KG5vZGUpIHsKICAgIHJldHVybiAobm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUgPyBub2RlLm5vZGVWYWx1ZSA6IG5vZGUuaW5uZXJUZXh0KS5yZXBsYWNlQWxsKEVPTF9QQVRURVJOLCAiIik7CiAgfQogIGVkaXRvckRpdlBhc3RlKGV2ZW50KSB7CiAgICBjb25zdCBjbGlwYm9hcmREYXRhID0gZXZlbnQuY2xpcGJvYXJkRGF0YSB8fCB3aW5kb3cuY2xpcGJvYXJkRGF0YTsKICAgIGNvbnN0IHsKICAgICAgdHlwZXMKICAgIH0gPSBjbGlwYm9hcmREYXRhOwogICAgaWYgKHR5cGVzLmxlbmd0aCA9PT0gMSAmJiB0eXBlc1swXSA9PT0gInRleHQvcGxhaW4iKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCBwYXN0ZSA9IEZyZWVUZXh0RWRpdG9yLiNkZXNlcmlhbGl6ZUNvbnRlbnQoY2xpcGJvYXJkRGF0YS5nZXREYXRhKCJ0ZXh0IikgfHwgIiIpLnJlcGxhY2VBbGwoRU9MX1BBVFRFUk4sICJcbiIpOwogICAgaWYgKCFwYXN0ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7CiAgICBpZiAoIXNlbGVjdGlvbi5yYW5nZUNvdW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZWRpdG9yRGl2Lm5vcm1hbGl6ZSgpOwogICAgc2VsZWN0aW9uLmRlbGV0ZUZyb21Eb2N1bWVudCgpOwogICAgY29uc3QgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKTsKICAgIGlmICghcGFzdGUuaW5jbHVkZXMoIlxuIikpIHsKICAgICAgcmFuZ2UuaW5zZXJ0Tm9kZShkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShwYXN0ZSkpOwogICAgICB0aGlzLmVkaXRvckRpdi5ub3JtYWxpemUoKTsKICAgICAgc2VsZWN0aW9uLmNvbGxhcHNlVG9TdGFydCgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHN0YXJ0Q29udGFpbmVyLAogICAgICBzdGFydE9mZnNldAogICAgfSA9IHJhbmdlOwogICAgY29uc3QgYnVmZmVyQmVmb3JlID0gW107CiAgICBjb25zdCBidWZmZXJBZnRlciA9IFtdOwogICAgaWYgKHN0YXJ0Q29udGFpbmVyLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSkgewogICAgICBjb25zdCBwYXJlbnQgPSBzdGFydENvbnRhaW5lci5wYXJlbnRFbGVtZW50OwogICAgICBidWZmZXJBZnRlci5wdXNoKHN0YXJ0Q29udGFpbmVyLm5vZGVWYWx1ZS5zbGljZShzdGFydE9mZnNldCkucmVwbGFjZUFsbChFT0xfUEFUVEVSTiwgIiIpKTsKICAgICAgaWYgKHBhcmVudCAhPT0gdGhpcy5lZGl0b3JEaXYpIHsKICAgICAgICBsZXQgYnVmZmVyID0gYnVmZmVyQmVmb3JlOwogICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy5lZGl0b3JEaXYuY2hpbGROb2RlcykgewogICAgICAgICAgaWYgKGNoaWxkID09PSBwYXJlbnQpIHsKICAgICAgICAgICAgYnVmZmVyID0gYnVmZmVyQWZ0ZXI7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgYnVmZmVyLnB1c2goRnJlZVRleHRFZGl0b3IuI2dldE5vZGVDb250ZW50KGNoaWxkKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGJ1ZmZlckJlZm9yZS5wdXNoKHN0YXJ0Q29udGFpbmVyLm5vZGVWYWx1ZS5zbGljZSgwLCBzdGFydE9mZnNldCkucmVwbGFjZUFsbChFT0xfUEFUVEVSTiwgIiIpKTsKICAgIH0gZWxzZSBpZiAoc3RhcnRDb250YWluZXIgPT09IHRoaXMuZWRpdG9yRGl2KSB7CiAgICAgIGxldCBidWZmZXIgPSBidWZmZXJCZWZvcmU7CiAgICAgIGxldCBpID0gMDsKICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLmVkaXRvckRpdi5jaGlsZE5vZGVzKSB7CiAgICAgICAgaWYgKGkrKyA9PT0gc3RhcnRPZmZzZXQpIHsKICAgICAgICAgIGJ1ZmZlciA9IGJ1ZmZlckFmdGVyOwogICAgICAgIH0KICAgICAgICBidWZmZXIucHVzaChGcmVlVGV4dEVkaXRvci4jZ2V0Tm9kZUNvbnRlbnQoY2hpbGQpKTsKICAgICAgfQogICAgfQogICAgdGhpcy4jY29udGVudCA9IGAke2J1ZmZlckJlZm9yZS5qb2luKCJcbiIpfSR7cGFzdGV9JHtidWZmZXJBZnRlci5qb2luKCJcbiIpfWA7CiAgICB0aGlzLiNzZXRDb250ZW50KCk7CiAgICBjb25zdCBuZXdSYW5nZSA9IG5ldyBSYW5nZSgpOwogICAgbGV0IGJlZm9yZUxlbmd0aCA9IE1hdGguc3VtUHJlY2lzZShidWZmZXJCZWZvcmUubWFwKGxpbmUgPT4gbGluZS5sZW5ndGgpKTsKICAgIGZvciAoY29uc3QgewogICAgICBmaXJzdENoaWxkCiAgICB9IG9mIHRoaXMuZWRpdG9yRGl2LmNoaWxkTm9kZXMpIHsKICAgICAgaWYgKGZpcnN0Q2hpbGQubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFKSB7CiAgICAgICAgY29uc3QgbGVuZ3RoID0gZmlyc3RDaGlsZC5ub2RlVmFsdWUubGVuZ3RoOwogICAgICAgIGlmIChiZWZvcmVMZW5ndGggPD0gbGVuZ3RoKSB7CiAgICAgICAgICBuZXdSYW5nZS5zZXRTdGFydChmaXJzdENoaWxkLCBiZWZvcmVMZW5ndGgpOwogICAgICAgICAgbmV3UmFuZ2Uuc2V0RW5kKGZpcnN0Q2hpbGQsIGJlZm9yZUxlbmd0aCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgYmVmb3JlTGVuZ3RoIC09IGxlbmd0aDsKICAgICAgfQogICAgfQogICAgc2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpOwogICAgc2VsZWN0aW9uLmFkZFJhbmdlKG5ld1JhbmdlKTsKICB9CiAgI3NldENvbnRlbnQoKSB7CiAgICB0aGlzLmVkaXRvckRpdi5yZXBsYWNlQ2hpbGRyZW4oKTsKICAgIGlmICghdGhpcy4jY29udGVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgdGhpcy4jY29udGVudC5zcGxpdCgiXG4iKSkgewogICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgZGl2LmFwcGVuZChsaW5lID8gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobGluZSkgOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsKICAgICAgdGhpcy5lZGl0b3JEaXYuYXBwZW5kKGRpdik7CiAgICB9CiAgfQogICNzZXJpYWxpemVDb250ZW50KCkgewogICAgcmV0dXJuIHRoaXMuI2NvbnRlbnQucmVwbGFjZUFsbCgiXHhhMCIsICIgIik7CiAgfQogIHN0YXRpYyAjZGVzZXJpYWxpemVDb250ZW50KGNvbnRlbnQpIHsKICAgIHJldHVybiBjb250ZW50LnJlcGxhY2VBbGwoIiAiLCAiXHhhMCIpOwogIH0KICBnZXQgY29udGVudERpdigpIHsKICAgIHJldHVybiB0aGlzLmVkaXRvckRpdjsKICB9CiAgc3RhdGljIGFzeW5jIGRlc2VyaWFsaXplKGRhdGEsIHBhcmVudCwgdWlNYW5hZ2VyKSB7CiAgICBsZXQgaW5pdGlhbERhdGEgPSBudWxsOwogICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBGcmVlVGV4dEFubm90YXRpb25FbGVtZW50KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBkZWZhdWx0QXBwZWFyYW5jZURhdGE6IHsKICAgICAgICAgICAgZm9udFNpemUsCiAgICAgICAgICAgIGZvbnRDb2xvcgogICAgICAgICAgfSwKICAgICAgICAgIHJlY3QsCiAgICAgICAgICByb3RhdGlvbiwKICAgICAgICAgIGlkLAogICAgICAgICAgcG9wdXBSZWYKICAgICAgICB9LAogICAgICAgIHRleHRDb250ZW50LAogICAgICAgIHRleHRQb3NpdGlvbiwKICAgICAgICBwYXJlbnQ6IHsKICAgICAgICAgIHBhZ2U6IHsKICAgICAgICAgICAgcGFnZU51bWJlcgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSA9IGRhdGE7CiAgICAgIGlmICghdGV4dENvbnRlbnQgfHwgdGV4dENvbnRlbnQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaW5pdGlhbERhdGEgPSBkYXRhID0gewogICAgICAgIGFubm90YXRpb25UeXBlOiBBbm5vdGF0aW9uRWRpdG9yVHlwZS5GUkVFVEVYVCwKICAgICAgICBjb2xvcjogQXJyYXkuZnJvbShmb250Q29sb3IpLAogICAgICAgIGZvbnRTaXplLAogICAgICAgIHZhbHVlOiB0ZXh0Q29udGVudC5qb2luKCJcbiIpLAogICAgICAgIHBvc2l0aW9uOiB0ZXh0UG9zaXRpb24sCiAgICAgICAgcGFnZUluZGV4OiBwYWdlTnVtYmVyIC0gMSwKICAgICAgICByZWN0OiByZWN0LnNsaWNlKDApLAogICAgICAgIHJvdGF0aW9uLAogICAgICAgIGlkLAogICAgICAgIGRlbGV0ZWQ6IGZhbHNlLAogICAgICAgIHBvcHVwUmVmCiAgICAgIH07CiAgICB9CiAgICBjb25zdCBlZGl0b3IgPSBhd2FpdCBzdXBlci5kZXNlcmlhbGl6ZShkYXRhLCBwYXJlbnQsIHVpTWFuYWdlcik7CiAgICBlZGl0b3IuI2ZvbnRTaXplID0gZGF0YS5mb250U2l6ZTsKICAgIGVkaXRvci4jY29sb3IgPSBVdGlsLm1ha2VIZXhDb2xvciguLi5kYXRhLmNvbG9yKTsKICAgIGVkaXRvci4jY29udGVudCA9IEZyZWVUZXh0RWRpdG9yLiNkZXNlcmlhbGl6ZUNvbnRlbnQoZGF0YS52YWx1ZSk7CiAgICBlZGl0b3IuYW5ub3RhdGlvbkVsZW1lbnRJZCA9IGRhdGEuaWQgfHwgbnVsbDsKICAgIGVkaXRvci5faW5pdGlhbERhdGEgPSBpbml0aWFsRGF0YTsKICAgIHJldHVybiBlZGl0b3I7CiAgfQogIHNlcmlhbGl6ZShpc0ZvckNvcHlpbmcgPSBmYWxzZSkgewogICAgaWYgKHRoaXMuaXNFbXB0eSgpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKHRoaXMuZGVsZXRlZCkgewogICAgICByZXR1cm4gdGhpcy5zZXJpYWxpemVEZWxldGVkKCk7CiAgICB9CiAgICBjb25zdCBwYWRkaW5nID0gRnJlZVRleHRFZGl0b3IuX2ludGVybmFsUGFkZGluZyAqIHRoaXMucGFyZW50U2NhbGU7CiAgICBjb25zdCByZWN0ID0gdGhpcy5nZXRSZWN0KHBhZGRpbmcsIHBhZGRpbmcpOwogICAgY29uc3QgY29sb3IgPSBBbm5vdGF0aW9uRWRpdG9yLl9jb2xvck1hbmFnZXIuY29udmVydCh0aGlzLmlzQXR0YWNoZWRUb0RPTSA/IGdldENvbXB1dGVkU3R5bGUodGhpcy5lZGl0b3JEaXYpLmNvbG9yIDogdGhpcy4jY29sb3IpOwogICAgY29uc3Qgc2VyaWFsaXplZCA9IHsKICAgICAgYW5ub3RhdGlvblR5cGU6IEFubm90YXRpb25FZGl0b3JUeXBlLkZSRUVURVhULAogICAgICBjb2xvciwKICAgICAgZm9udFNpemU6IHRoaXMuI2ZvbnRTaXplLAogICAgICB2YWx1ZTogdGhpcy4jc2VyaWFsaXplQ29udGVudCgpLAogICAgICBwYWdlSW5kZXg6IHRoaXMucGFnZUluZGV4LAogICAgICByZWN0LAogICAgICByb3RhdGlvbjogdGhpcy5yb3RhdGlvbiwKICAgICAgc3RydWN0VHJlZVBhcmVudElkOiB0aGlzLl9zdHJ1Y3RUcmVlUGFyZW50SWQKICAgIH07CiAgICBpZiAoaXNGb3JDb3B5aW5nKSB7CiAgICAgIHNlcmlhbGl6ZWQuaXNDb3B5ID0gdHJ1ZTsKICAgICAgcmV0dXJuIHNlcmlhbGl6ZWQ7CiAgICB9CiAgICBpZiAodGhpcy5hbm5vdGF0aW9uRWxlbWVudElkICYmICF0aGlzLiNoYXNFbGVtZW50Q2hhbmdlZChzZXJpYWxpemVkKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHNlcmlhbGl6ZWQuaWQgPSB0aGlzLmFubm90YXRpb25FbGVtZW50SWQ7CiAgICByZXR1cm4gc2VyaWFsaXplZDsKICB9CiAgI2hhc0VsZW1lbnRDaGFuZ2VkKHNlcmlhbGl6ZWQpIHsKICAgIGNvbnN0IHsKICAgICAgdmFsdWUsCiAgICAgIGZvbnRTaXplLAogICAgICBjb2xvciwKICAgICAgcGFnZUluZGV4CiAgICB9ID0gdGhpcy5faW5pdGlhbERhdGE7CiAgICByZXR1cm4gdGhpcy5faGFzQmVlbk1vdmVkIHx8IHNlcmlhbGl6ZWQudmFsdWUgIT09IHZhbHVlIHx8IHNlcmlhbGl6ZWQuZm9udFNpemUgIT09IGZvbnRTaXplIHx8IHNlcmlhbGl6ZWQuY29sb3Iuc29tZSgoYywgaSkgPT4gYyAhPT0gY29sb3JbaV0pIHx8IHNlcmlhbGl6ZWQucGFnZUluZGV4ICE9PSBwYWdlSW5kZXg7CiAgfQogIHJlbmRlckFubm90YXRpb25FbGVtZW50KGFubm90YXRpb24pIHsKICAgIGNvbnN0IGNvbnRlbnQgPSBzdXBlci5yZW5kZXJBbm5vdGF0aW9uRWxlbWVudChhbm5vdGF0aW9uKTsKICAgIGlmICh0aGlzLmRlbGV0ZWQpIHsKICAgICAgcmV0dXJuIGNvbnRlbnQ7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHN0eWxlCiAgICB9ID0gY29udGVudDsKICAgIHN0eWxlLmZvbnRTaXplID0gYGNhbGMoJHt0aGlzLiNmb250U2l6ZX1weCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpYDsKICAgIHN0eWxlLmNvbG9yID0gdGhpcy4jY29sb3I7CiAgICBjb250ZW50LnJlcGxhY2VDaGlsZHJlbigpOwogICAgZm9yIChjb25zdCBsaW5lIG9mIHRoaXMuI2NvbnRlbnQuc3BsaXQoIlxuIikpIHsKICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGRpdi5hcHBlbmQobGluZSA/IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpbmUpIDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7CiAgICAgIGNvbnRlbnQuYXBwZW5kKGRpdik7CiAgICB9CiAgICBjb25zdCBwYWRkaW5nID0gRnJlZVRleHRFZGl0b3IuX2ludGVybmFsUGFkZGluZyAqIHRoaXMucGFyZW50U2NhbGU7CiAgICBhbm5vdGF0aW9uLnVwZGF0ZUVkaXRlZCh7CiAgICAgIHJlY3Q6IHRoaXMuZ2V0UmVjdChwYWRkaW5nLCBwYWRkaW5nKSwKICAgICAgcG9wdXBDb250ZW50OiB0aGlzLiNjb250ZW50CiAgICB9KTsKICAgIHJldHVybiBjb250ZW50OwogIH0KICByZXNldEFubm90YXRpb25FbGVtZW50KGFubm90YXRpb24pIHsKICAgIHN1cGVyLnJlc2V0QW5ub3RhdGlvbkVsZW1lbnQoYW5ub3RhdGlvbik7CiAgICBhbm5vdGF0aW9uLnJlc2V0RWRpdGVkKCk7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9lZGl0b3IvZHJhd2Vycy9vdXRsaW5lLmpzCgpjbGFzcyBPdXRsaW5lIHsKICBzdGF0aWMgUFJFQ0lTSU9OID0gMWUtNDsKICB0b1NWR1BhdGgoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGB0b1NWR1BhdGhgIG11c3QgYmUgaW1wbGVtZW50ZWQuIik7CiAgfQogIGdldCBib3goKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgZ2V0dGVyIGBib3hgIG11c3QgYmUgaW1wbGVtZW50ZWQuIik7CiAgfQogIHNlcmlhbGl6ZShfYmJveCwgX3JvdGF0aW9uKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBzZXJpYWxpemVgIG11c3QgYmUgaW1wbGVtZW50ZWQuIik7CiAgfQogIHN0YXRpYyBfcmVzY2FsZShzcmMsIHR4LCB0eSwgc3gsIHN5LCBkZXN0KSB7CiAgICBkZXN0IHx8PSBuZXcgRmxvYXQzMkFycmF5KHNyYy5sZW5ndGgpOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3JjLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgZGVzdFtpXSA9IHR4ICsgc3JjW2ldICogc3g7CiAgICAgIGRlc3RbaSArIDFdID0gdHkgKyBzcmNbaSArIDFdICogc3k7CiAgICB9CiAgICByZXR1cm4gZGVzdDsKICB9CiAgc3RhdGljIF9yZXNjYWxlQW5kU3dhcChzcmMsIHR4LCB0eSwgc3gsIHN5LCBkZXN0KSB7CiAgICBkZXN0IHx8PSBuZXcgRmxvYXQzMkFycmF5KHNyYy5sZW5ndGgpOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3JjLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgZGVzdFtpXSA9IHR4ICsgc3JjW2kgKyAxXSAqIHN4OwogICAgICBkZXN0W2kgKyAxXSA9IHR5ICsgc3JjW2ldICogc3k7CiAgICB9CiAgICByZXR1cm4gZGVzdDsKICB9CiAgc3RhdGljIF90cmFuc2xhdGUoc3JjLCB0eCwgdHksIGRlc3QpIHsKICAgIGRlc3QgfHw9IG5ldyBGbG9hdDMyQXJyYXkoc3JjLmxlbmd0aCk7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzcmMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICBkZXN0W2ldID0gdHggKyBzcmNbaV07CiAgICAgIGRlc3RbaSArIDFdID0gdHkgKyBzcmNbaSArIDFdOwogICAgfQogICAgcmV0dXJuIGRlc3Q7CiAgfQogIHN0YXRpYyBzdmdSb3VuZCh4KSB7CiAgICByZXR1cm4gTWF0aC5yb3VuZCh4ICogMTAwMDApOwogIH0KICBzdGF0aWMgX25vcm1hbGl6ZVBvaW50KHgsIHksIHBhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHQsIHJvdGF0aW9uKSB7CiAgICBzd2l0Y2ggKHJvdGF0aW9uKSB7CiAgICAgIGNhc2UgOTA6CiAgICAgICAgcmV0dXJuIFsxIC0geSAvIHBhcmVudFdpZHRoLCB4IC8gcGFyZW50SGVpZ2h0XTsKICAgICAgY2FzZSAxODA6CiAgICAgICAgcmV0dXJuIFsxIC0geCAvIHBhcmVudFdpZHRoLCAxIC0geSAvIHBhcmVudEhlaWdodF07CiAgICAgIGNhc2UgMjcwOgogICAgICAgIHJldHVybiBbeSAvIHBhcmVudFdpZHRoLCAxIC0geCAvIHBhcmVudEhlaWdodF07CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIFt4IC8gcGFyZW50V2lkdGgsIHkgLyBwYXJlbnRIZWlnaHRdOwogICAgfQogIH0KICBzdGF0aWMgX25vcm1hbGl6ZVBhZ2VQb2ludCh4LCB5LCByb3RhdGlvbikgewogICAgc3dpdGNoIChyb3RhdGlvbikgewogICAgICBjYXNlIDkwOgogICAgICAgIHJldHVybiBbMSAtIHksIHhdOwogICAgICBjYXNlIDE4MDoKICAgICAgICByZXR1cm4gWzEgLSB4LCAxIC0geV07CiAgICAgIGNhc2UgMjcwOgogICAgICAgIHJldHVybiBbeSwgMSAtIHhdOwogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiBbeCwgeV07CiAgICB9CiAgfQogIHN0YXRpYyBjcmVhdGVCZXppZXJQb2ludHMoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykgewogICAgcmV0dXJuIFsoeDEgKyA1ICogeDIpIC8gNiwgKHkxICsgNSAqIHkyKSAvIDYsICg1ICogeDIgKyB4MykgLyA2LCAoNSAqIHkyICsgeTMpIC8gNiwgKHgyICsgeDMpIC8gMiwgKHkyICsgeTMpIC8gMl07CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9lZGl0b3IvZHJhd2Vycy9mcmVlZHJhdy5qcwoKCmNsYXNzIEZyZWVEcmF3T3V0bGluZXIgewogICNib3g7CiAgI2JvdHRvbSA9IFtdOwogICNpbm5lck1hcmdpbjsKICAjaXNMVFI7CiAgI3RvcCA9IFtdOwogICNsYXN0ID0gbmV3IEZsb2F0MzJBcnJheSgxOCk7CiAgI2xhc3RYOwogICNsYXN0WTsKICAjbWluOwogICNtaW5fZGlzdDsKICAjc2NhbGVGYWN0b3I7CiAgI3RoaWNrbmVzczsKICAjcG9pbnRzID0gW107CiAgc3RhdGljICNNSU5fRElTVCA9IDg7CiAgc3RhdGljICNNSU5fRElGRiA9IDI7CiAgc3RhdGljICNNSU4gPSBGcmVlRHJhd091dGxpbmVyLiNNSU5fRElTVCArIEZyZWVEcmF3T3V0bGluZXIuI01JTl9ESUZGOwogIGNvbnN0cnVjdG9yKHsKICAgIHgsCiAgICB5CiAgfSwgYm94LCBzY2FsZUZhY3RvciwgdGhpY2tuZXNzLCBpc0xUUiwgaW5uZXJNYXJnaW4gPSAwKSB7CiAgICB0aGlzLiNib3ggPSBib3g7CiAgICB0aGlzLiN0aGlja25lc3MgPSB0aGlja25lc3MgKiBzY2FsZUZhY3RvcjsKICAgIHRoaXMuI2lzTFRSID0gaXNMVFI7CiAgICB0aGlzLiNsYXN0LnNldChbTmFOLCBOYU4sIE5hTiwgTmFOLCB4LCB5XSwgNik7CiAgICB0aGlzLiNpbm5lck1hcmdpbiA9IGlubmVyTWFyZ2luOwogICAgdGhpcy4jbWluX2Rpc3QgPSBGcmVlRHJhd091dGxpbmVyLiNNSU5fRElTVCAqIHNjYWxlRmFjdG9yOwogICAgdGhpcy4jbWluID0gRnJlZURyYXdPdXRsaW5lci4jTUlOICogc2NhbGVGYWN0b3I7CiAgICB0aGlzLiNzY2FsZUZhY3RvciA9IHNjYWxlRmFjdG9yOwogICAgdGhpcy4jcG9pbnRzLnB1c2goeCwgeSk7CiAgfQogIGlzRW1wdHkoKSB7CiAgICByZXR1cm4gaXNOYU4odGhpcy4jbGFzdFs4XSk7CiAgfQogICNnZXRMYXN0Q29vcmRzKCkgewogICAgY29uc3QgbGFzdFRvcCA9IHRoaXMuI2xhc3Quc3ViYXJyYXkoNCwgNik7CiAgICBjb25zdCBsYXN0Qm90dG9tID0gdGhpcy4jbGFzdC5zdWJhcnJheSgxNiwgMTgpOwogICAgY29uc3QgW3gsIHksIHdpZHRoLCBoZWlnaHRdID0gdGhpcy4jYm94OwogICAgcmV0dXJuIFsodGhpcy4jbGFzdFggKyAobGFzdFRvcFswXSAtIGxhc3RCb3R0b21bMF0pIC8gMiAtIHgpIC8gd2lkdGgsICh0aGlzLiNsYXN0WSArIChsYXN0VG9wWzFdIC0gbGFzdEJvdHRvbVsxXSkgLyAyIC0geSkgLyBoZWlnaHQsICh0aGlzLiNsYXN0WCArIChsYXN0Qm90dG9tWzBdIC0gbGFzdFRvcFswXSkgLyAyIC0geCkgLyB3aWR0aCwgKHRoaXMuI2xhc3RZICsgKGxhc3RCb3R0b21bMV0gLSBsYXN0VG9wWzFdKSAvIDIgLSB5KSAvIGhlaWdodF07CiAgfQogIGFkZCh7CiAgICB4LAogICAgeQogIH0pIHsKICAgIHRoaXMuI2xhc3RYID0geDsKICAgIHRoaXMuI2xhc3RZID0geTsKICAgIGNvbnN0IFtsYXllclgsIGxheWVyWSwgbGF5ZXJXaWR0aCwgbGF5ZXJIZWlnaHRdID0gdGhpcy4jYm94OwogICAgbGV0IFt4MSwgeTEsIHgyLCB5Ml0gPSB0aGlzLiNsYXN0LnN1YmFycmF5KDgsIDEyKTsKICAgIGNvbnN0IGRpZmZYID0geCAtIHgyOwogICAgY29uc3QgZGlmZlkgPSB5IC0geTI7CiAgICBjb25zdCBkID0gTWF0aC5oeXBvdChkaWZmWCwgZGlmZlkpOwogICAgaWYgKGQgPCB0aGlzLiNtaW4pIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgZGlmZkQgPSBkIC0gdGhpcy4jbWluX2Rpc3Q7CiAgICBjb25zdCBLID0gZGlmZkQgLyBkOwogICAgY29uc3Qgc2hpZnRYID0gSyAqIGRpZmZYOwogICAgY29uc3Qgc2hpZnRZID0gSyAqIGRpZmZZOwogICAgbGV0IHgwID0geDE7CiAgICBsZXQgeTAgPSB5MTsKICAgIHgxID0geDI7CiAgICB5MSA9IHkyOwogICAgeDIgKz0gc2hpZnRYOwogICAgeTIgKz0gc2hpZnRZOwogICAgdGhpcy4jcG9pbnRzPy5wdXNoKHgsIHkpOwogICAgY29uc3QgblggPSAtc2hpZnRZIC8gZGlmZkQ7CiAgICBjb25zdCBuWSA9IHNoaWZ0WCAvIGRpZmZEOwogICAgY29uc3QgdGhYID0gblggKiB0aGlzLiN0aGlja25lc3M7CiAgICBjb25zdCB0aFkgPSBuWSAqIHRoaXMuI3RoaWNrbmVzczsKICAgIHRoaXMuI2xhc3Quc2V0KHRoaXMuI2xhc3Quc3ViYXJyYXkoMiwgOCksIDApOwogICAgdGhpcy4jbGFzdC5zZXQoW3gyICsgdGhYLCB5MiArIHRoWV0sIDQpOwogICAgdGhpcy4jbGFzdC5zZXQodGhpcy4jbGFzdC5zdWJhcnJheSgxNCwgMTgpLCAxMik7CiAgICB0aGlzLiNsYXN0LnNldChbeDIgLSB0aFgsIHkyIC0gdGhZXSwgMTYpOwogICAgaWYgKGlzTmFOKHRoaXMuI2xhc3RbNl0pKSB7CiAgICAgIGlmICh0aGlzLiN0b3AubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy4jbGFzdC5zZXQoW3gxICsgdGhYLCB5MSArIHRoWV0sIDIpOwogICAgICAgIHRoaXMuI3RvcC5wdXNoKE5hTiwgTmFOLCBOYU4sIE5hTiwgKHgxICsgdGhYIC0gbGF5ZXJYKSAvIGxheWVyV2lkdGgsICh5MSArIHRoWSAtIGxheWVyWSkgLyBsYXllckhlaWdodCk7CiAgICAgICAgdGhpcy4jbGFzdC5zZXQoW3gxIC0gdGhYLCB5MSAtIHRoWV0sIDE0KTsKICAgICAgICB0aGlzLiNib3R0b20ucHVzaChOYU4sIE5hTiwgTmFOLCBOYU4sICh4MSAtIHRoWCAtIGxheWVyWCkgLyBsYXllcldpZHRoLCAoeTEgLSB0aFkgLSBsYXllclkpIC8gbGF5ZXJIZWlnaHQpOwogICAgICB9CiAgICAgIHRoaXMuI2xhc3Quc2V0KFt4MCwgeTAsIHgxLCB5MSwgeDIsIHkyXSwgNik7CiAgICAgIHJldHVybiAhdGhpcy5pc0VtcHR5KCk7CiAgICB9CiAgICB0aGlzLiNsYXN0LnNldChbeDAsIHkwLCB4MSwgeTEsIHgyLCB5Ml0sIDYpOwogICAgY29uc3QgYW5nbGUgPSBNYXRoLmFicyhNYXRoLmF0YW4yKHkwIC0geTEsIHgwIC0geDEpIC0gTWF0aC5hdGFuMihzaGlmdFksIHNoaWZ0WCkpOwogICAgaWYgKGFuZ2xlIDwgTWF0aC5QSSAvIDIpIHsKICAgICAgW3gxLCB5MSwgeDIsIHkyXSA9IHRoaXMuI2xhc3Quc3ViYXJyYXkoMiwgNik7CiAgICAgIHRoaXMuI3RvcC5wdXNoKE5hTiwgTmFOLCBOYU4sIE5hTiwgKCh4MSArIHgyKSAvIDIgLSBsYXllclgpIC8gbGF5ZXJXaWR0aCwgKCh5MSArIHkyKSAvIDIgLSBsYXllclkpIC8gbGF5ZXJIZWlnaHQpOwogICAgICBbeDEsIHkxLCB4MCwgeTBdID0gdGhpcy4jbGFzdC5zdWJhcnJheSgxNCwgMTgpOwogICAgICB0aGlzLiNib3R0b20ucHVzaChOYU4sIE5hTiwgTmFOLCBOYU4sICgoeDAgKyB4MSkgLyAyIC0gbGF5ZXJYKSAvIGxheWVyV2lkdGgsICgoeTAgKyB5MSkgLyAyIC0gbGF5ZXJZKSAvIGxheWVySGVpZ2h0KTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBbeDAsIHkwLCB4MSwgeTEsIHgyLCB5Ml0gPSB0aGlzLiNsYXN0LnN1YmFycmF5KDAsIDYpOwogICAgdGhpcy4jdG9wLnB1c2goKCh4MCArIDUgKiB4MSkgLyA2IC0gbGF5ZXJYKSAvIGxheWVyV2lkdGgsICgoeTAgKyA1ICogeTEpIC8gNiAtIGxheWVyWSkgLyBsYXllckhlaWdodCwgKCg1ICogeDEgKyB4MikgLyA2IC0gbGF5ZXJYKSAvIGxheWVyV2lkdGgsICgoNSAqIHkxICsgeTIpIC8gNiAtIGxheWVyWSkgLyBsYXllckhlaWdodCwgKCh4MSArIHgyKSAvIDIgLSBsYXllclgpIC8gbGF5ZXJXaWR0aCwgKCh5MSArIHkyKSAvIDIgLSBsYXllclkpIC8gbGF5ZXJIZWlnaHQpOwogICAgW3gyLCB5MiwgeDEsIHkxLCB4MCwgeTBdID0gdGhpcy4jbGFzdC5zdWJhcnJheSgxMiwgMTgpOwogICAgdGhpcy4jYm90dG9tLnB1c2goKCh4MCArIDUgKiB4MSkgLyA2IC0gbGF5ZXJYKSAvIGxheWVyV2lkdGgsICgoeTAgKyA1ICogeTEpIC8gNiAtIGxheWVyWSkgLyBsYXllckhlaWdodCwgKCg1ICogeDEgKyB4MikgLyA2IC0gbGF5ZXJYKSAvIGxheWVyV2lkdGgsICgoNSAqIHkxICsgeTIpIC8gNiAtIGxheWVyWSkgLyBsYXllckhlaWdodCwgKCh4MSArIHgyKSAvIDIgLSBsYXllclgpIC8gbGF5ZXJXaWR0aCwgKCh5MSArIHkyKSAvIDIgLSBsYXllclkpIC8gbGF5ZXJIZWlnaHQpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIHRvU1ZHUGF0aCgpIHsKICAgIGlmICh0aGlzLmlzRW1wdHkoKSkgewogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBjb25zdCB0b3AgPSB0aGlzLiN0b3A7CiAgICBjb25zdCBib3R0b20gPSB0aGlzLiNib3R0b207CiAgICBpZiAoaXNOYU4odGhpcy4jbGFzdFs2XSkgJiYgIXRoaXMuaXNFbXB0eSgpKSB7CiAgICAgIHJldHVybiB0aGlzLiN0b1NWR1BhdGhUd29Qb2ludHMoKTsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlciA9IFtdOwogICAgYnVmZmVyLnB1c2goYE0ke3RvcFs0XX0gJHt0b3BbNV19YCk7CiAgICBmb3IgKGxldCBpID0gNjsgaSA8IHRvcC5sZW5ndGg7IGkgKz0gNikgewogICAgICBpZiAoaXNOYU4odG9wW2ldKSkgewogICAgICAgIGJ1ZmZlci5wdXNoKGBMJHt0b3BbaSArIDRdfSAke3RvcFtpICsgNV19YCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnVmZmVyLnB1c2goYEMke3RvcFtpXX0gJHt0b3BbaSArIDFdfSAke3RvcFtpICsgMl19ICR7dG9wW2kgKyAzXX0gJHt0b3BbaSArIDRdfSAke3RvcFtpICsgNV19YCk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuI3RvU1ZHUGF0aEVuZChidWZmZXIpOwogICAgZm9yIChsZXQgaSA9IGJvdHRvbS5sZW5ndGggLSA2OyBpID49IDY7IGkgLT0gNikgewogICAgICBpZiAoaXNOYU4oYm90dG9tW2ldKSkgewogICAgICAgIGJ1ZmZlci5wdXNoKGBMJHtib3R0b21baSArIDRdfSAke2JvdHRvbVtpICsgNV19YCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnVmZmVyLnB1c2goYEMke2JvdHRvbVtpXX0gJHtib3R0b21baSArIDFdfSAke2JvdHRvbVtpICsgMl19ICR7Ym90dG9tW2kgKyAzXX0gJHtib3R0b21baSArIDRdfSAke2JvdHRvbVtpICsgNV19YCk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuI3RvU1ZHUGF0aFN0YXJ0KGJ1ZmZlcik7CiAgICByZXR1cm4gYnVmZmVyLmpvaW4oIiAiKTsKICB9CiAgI3RvU1ZHUGF0aFR3b1BvaW50cygpIHsKICAgIGNvbnN0IFt4LCB5LCB3aWR0aCwgaGVpZ2h0XSA9IHRoaXMuI2JveDsKICAgIGNvbnN0IFtsYXN0VG9wWCwgbGFzdFRvcFksIGxhc3RCb3R0b21YLCBsYXN0Qm90dG9tWV0gPSB0aGlzLiNnZXRMYXN0Q29vcmRzKCk7CiAgICByZXR1cm4gYE0keyh0aGlzLiNsYXN0WzJdIC0geCkgLyB3aWR0aH0gJHsodGhpcy4jbGFzdFszXSAtIHkpIC8gaGVpZ2h0fSBMJHsodGhpcy4jbGFzdFs0XSAtIHgpIC8gd2lkdGh9ICR7KHRoaXMuI2xhc3RbNV0gLSB5KSAvIGhlaWdodH0gTCR7bGFzdFRvcFh9ICR7bGFzdFRvcFl9IEwke2xhc3RCb3R0b21YfSAke2xhc3RCb3R0b21ZfSBMJHsodGhpcy4jbGFzdFsxNl0gLSB4KSAvIHdpZHRofSAkeyh0aGlzLiNsYXN0WzE3XSAtIHkpIC8gaGVpZ2h0fSBMJHsodGhpcy4jbGFzdFsxNF0gLSB4KSAvIHdpZHRofSAkeyh0aGlzLiNsYXN0WzE1XSAtIHkpIC8gaGVpZ2h0fSBaYDsKICB9CiAgI3RvU1ZHUGF0aFN0YXJ0KGJ1ZmZlcikgewogICAgY29uc3QgYm90dG9tID0gdGhpcy4jYm90dG9tOwogICAgYnVmZmVyLnB1c2goYEwke2JvdHRvbVs0XX0gJHtib3R0b21bNV19IFpgKTsKICB9CiAgI3RvU1ZHUGF0aEVuZChidWZmZXIpIHsKICAgIGNvbnN0IFt4LCB5LCB3aWR0aCwgaGVpZ2h0XSA9IHRoaXMuI2JveDsKICAgIGNvbnN0IGxhc3RUb3AgPSB0aGlzLiNsYXN0LnN1YmFycmF5KDQsIDYpOwogICAgY29uc3QgbGFzdEJvdHRvbSA9IHRoaXMuI2xhc3Quc3ViYXJyYXkoMTYsIDE4KTsKICAgIGNvbnN0IFtsYXN0VG9wWCwgbGFzdFRvcFksIGxhc3RCb3R0b21YLCBsYXN0Qm90dG9tWV0gPSB0aGlzLiNnZXRMYXN0Q29vcmRzKCk7CiAgICBidWZmZXIucHVzaChgTCR7KGxhc3RUb3BbMF0gLSB4KSAvIHdpZHRofSAkeyhsYXN0VG9wWzFdIC0geSkgLyBoZWlnaHR9IEwke2xhc3RUb3BYfSAke2xhc3RUb3BZfSBMJHtsYXN0Qm90dG9tWH0gJHtsYXN0Qm90dG9tWX0gTCR7KGxhc3RCb3R0b21bMF0gLSB4KSAvIHdpZHRofSAkeyhsYXN0Qm90dG9tWzFdIC0geSkgLyBoZWlnaHR9YCk7CiAgfQogIG5ld0ZyZWVEcmF3T3V0bGluZShvdXRsaW5lLCBwb2ludHMsIGJveCwgc2NhbGVGYWN0b3IsIGlubmVyTWFyZ2luLCBpc0xUUikgewogICAgcmV0dXJuIG5ldyBGcmVlRHJhd091dGxpbmUob3V0bGluZSwgcG9pbnRzLCBib3gsIHNjYWxlRmFjdG9yLCBpbm5lck1hcmdpbiwgaXNMVFIpOwogIH0KICBnZXRPdXRsaW5lcygpIHsKICAgIGNvbnN0IHRvcCA9IHRoaXMuI3RvcDsKICAgIGNvbnN0IGJvdHRvbSA9IHRoaXMuI2JvdHRvbTsKICAgIGNvbnN0IGxhc3QgPSB0aGlzLiNsYXN0OwogICAgY29uc3QgW2xheWVyWCwgbGF5ZXJZLCBsYXllcldpZHRoLCBsYXllckhlaWdodF0gPSB0aGlzLiNib3g7CiAgICBjb25zdCBwb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KCh0aGlzLiNwb2ludHM/Lmxlbmd0aCA/PyAwKSArIDIpOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcG9pbnRzLmxlbmd0aCAtIDI7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIHBvaW50c1tpXSA9ICh0aGlzLiNwb2ludHNbaV0gLSBsYXllclgpIC8gbGF5ZXJXaWR0aDsKICAgICAgcG9pbnRzW2kgKyAxXSA9ICh0aGlzLiNwb2ludHNbaSArIDFdIC0gbGF5ZXJZKSAvIGxheWVySGVpZ2h0OwogICAgfQogICAgcG9pbnRzW3BvaW50cy5sZW5ndGggLSAyXSA9ICh0aGlzLiNsYXN0WCAtIGxheWVyWCkgLyBsYXllcldpZHRoOwogICAgcG9pbnRzW3BvaW50cy5sZW5ndGggLSAxXSA9ICh0aGlzLiNsYXN0WSAtIGxheWVyWSkgLyBsYXllckhlaWdodDsKICAgIGlmIChpc05hTihsYXN0WzZdKSAmJiAhdGhpcy5pc0VtcHR5KCkpIHsKICAgICAgcmV0dXJuIHRoaXMuI2dldE91dGxpbmVUd29Qb2ludHMocG9pbnRzKTsKICAgIH0KICAgIGNvbnN0IG91dGxpbmUgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMuI3RvcC5sZW5ndGggKyAyNCArIHRoaXMuI2JvdHRvbS5sZW5ndGgpOwogICAgbGV0IE4gPSB0b3AubGVuZ3RoOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOOyBpICs9IDIpIHsKICAgICAgaWYgKGlzTmFOKHRvcFtpXSkpIHsKICAgICAgICBvdXRsaW5lW2ldID0gb3V0bGluZVtpICsgMV0gPSBOYU47CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgb3V0bGluZVtpXSA9IHRvcFtpXTsKICAgICAgb3V0bGluZVtpICsgMV0gPSB0b3BbaSArIDFdOwogICAgfQogICAgTiA9IHRoaXMuI2dldE91dGxpbmVFbmQob3V0bGluZSwgTik7CiAgICBmb3IgKGxldCBpID0gYm90dG9tLmxlbmd0aCAtIDY7IGkgPj0gNjsgaSAtPSA2KSB7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNjsgaiArPSAyKSB7CiAgICAgICAgaWYgKGlzTmFOKGJvdHRvbVtpICsgal0pKSB7CiAgICAgICAgICBvdXRsaW5lW05dID0gb3V0bGluZVtOICsgMV0gPSBOYU47CiAgICAgICAgICBOICs9IDI7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgb3V0bGluZVtOXSA9IGJvdHRvbVtpICsgal07CiAgICAgICAgb3V0bGluZVtOICsgMV0gPSBib3R0b21baSArIGogKyAxXTsKICAgICAgICBOICs9IDI7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuI2dldE91dGxpbmVTdGFydChvdXRsaW5lLCBOKTsKICAgIHJldHVybiB0aGlzLm5ld0ZyZWVEcmF3T3V0bGluZShvdXRsaW5lLCBwb2ludHMsIHRoaXMuI2JveCwgdGhpcy4jc2NhbGVGYWN0b3IsIHRoaXMuI2lubmVyTWFyZ2luLCB0aGlzLiNpc0xUUik7CiAgfQogICNnZXRPdXRsaW5lVHdvUG9pbnRzKHBvaW50cykgewogICAgY29uc3QgbGFzdCA9IHRoaXMuI2xhc3Q7CiAgICBjb25zdCBbbGF5ZXJYLCBsYXllclksIGxheWVyV2lkdGgsIGxheWVySGVpZ2h0XSA9IHRoaXMuI2JveDsKICAgIGNvbnN0IFtsYXN0VG9wWCwgbGFzdFRvcFksIGxhc3RCb3R0b21YLCBsYXN0Qm90dG9tWV0gPSB0aGlzLiNnZXRMYXN0Q29vcmRzKCk7CiAgICBjb25zdCBvdXRsaW5lID0gbmV3IEZsb2F0MzJBcnJheSgzNik7CiAgICBvdXRsaW5lLnNldChbTmFOLCBOYU4sIE5hTiwgTmFOLCAobGFzdFsyXSAtIGxheWVyWCkgLyBsYXllcldpZHRoLCAobGFzdFszXSAtIGxheWVyWSkgLyBsYXllckhlaWdodCwgTmFOLCBOYU4sIE5hTiwgTmFOLCAobGFzdFs0XSAtIGxheWVyWCkgLyBsYXllcldpZHRoLCAobGFzdFs1XSAtIGxheWVyWSkgLyBsYXllckhlaWdodCwgTmFOLCBOYU4sIE5hTiwgTmFOLCBsYXN0VG9wWCwgbGFzdFRvcFksIE5hTiwgTmFOLCBOYU4sIE5hTiwgbGFzdEJvdHRvbVgsIGxhc3RCb3R0b21ZLCBOYU4sIE5hTiwgTmFOLCBOYU4sIChsYXN0WzE2XSAtIGxheWVyWCkgLyBsYXllcldpZHRoLCAobGFzdFsxN10gLSBsYXllclkpIC8gbGF5ZXJIZWlnaHQsIE5hTiwgTmFOLCBOYU4sIE5hTiwgKGxhc3RbMTRdIC0gbGF5ZXJYKSAvIGxheWVyV2lkdGgsIChsYXN0WzE1XSAtIGxheWVyWSkgLyBsYXllckhlaWdodF0sIDApOwogICAgcmV0dXJuIHRoaXMubmV3RnJlZURyYXdPdXRsaW5lKG91dGxpbmUsIHBvaW50cywgdGhpcy4jYm94LCB0aGlzLiNzY2FsZUZhY3RvciwgdGhpcy4jaW5uZXJNYXJnaW4sIHRoaXMuI2lzTFRSKTsKICB9CiAgI2dldE91dGxpbmVTdGFydChvdXRsaW5lLCBwb3MpIHsKICAgIGNvbnN0IGJvdHRvbSA9IHRoaXMuI2JvdHRvbTsKICAgIG91dGxpbmUuc2V0KFtOYU4sIE5hTiwgTmFOLCBOYU4sIGJvdHRvbVs0XSwgYm90dG9tWzVdXSwgcG9zKTsKICAgIHJldHVybiBwb3MgKz0gNjsKICB9CiAgI2dldE91dGxpbmVFbmQob3V0bGluZSwgcG9zKSB7CiAgICBjb25zdCBsYXN0VG9wID0gdGhpcy4jbGFzdC5zdWJhcnJheSg0LCA2KTsKICAgIGNvbnN0IGxhc3RCb3R0b20gPSB0aGlzLiNsYXN0LnN1YmFycmF5KDE2LCAxOCk7CiAgICBjb25zdCBbbGF5ZXJYLCBsYXllclksIGxheWVyV2lkdGgsIGxheWVySGVpZ2h0XSA9IHRoaXMuI2JveDsKICAgIGNvbnN0IFtsYXN0VG9wWCwgbGFzdFRvcFksIGxhc3RCb3R0b21YLCBsYXN0Qm90dG9tWV0gPSB0aGlzLiNnZXRMYXN0Q29vcmRzKCk7CiAgICBvdXRsaW5lLnNldChbTmFOLCBOYU4sIE5hTiwgTmFOLCAobGFzdFRvcFswXSAtIGxheWVyWCkgLyBsYXllcldpZHRoLCAobGFzdFRvcFsxXSAtIGxheWVyWSkgLyBsYXllckhlaWdodCwgTmFOLCBOYU4sIE5hTiwgTmFOLCBsYXN0VG9wWCwgbGFzdFRvcFksIE5hTiwgTmFOLCBOYU4sIE5hTiwgbGFzdEJvdHRvbVgsIGxhc3RCb3R0b21ZLCBOYU4sIE5hTiwgTmFOLCBOYU4sIChsYXN0Qm90dG9tWzBdIC0gbGF5ZXJYKSAvIGxheWVyV2lkdGgsIChsYXN0Qm90dG9tWzFdIC0gbGF5ZXJZKSAvIGxheWVySGVpZ2h0XSwgcG9zKTsKICAgIHJldHVybiBwb3MgKz0gMjQ7CiAgfQp9CmNsYXNzIEZyZWVEcmF3T3V0bGluZSBleHRlbmRzIE91dGxpbmUgewogICNib3g7CiAgI2Jib3ggPSBuZXcgRmxvYXQzMkFycmF5KDQpOwogICNpbm5lck1hcmdpbjsKICAjaXNMVFI7CiAgI3BvaW50czsKICAjc2NhbGVGYWN0b3I7CiAgI291dGxpbmU7CiAgY29uc3RydWN0b3Iob3V0bGluZSwgcG9pbnRzLCBib3gsIHNjYWxlRmFjdG9yLCBpbm5lck1hcmdpbiwgaXNMVFIpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLiNvdXRsaW5lID0gb3V0bGluZTsKICAgIHRoaXMuI3BvaW50cyA9IHBvaW50czsKICAgIHRoaXMuI2JveCA9IGJveDsKICAgIHRoaXMuI3NjYWxlRmFjdG9yID0gc2NhbGVGYWN0b3I7CiAgICB0aGlzLiNpbm5lck1hcmdpbiA9IGlubmVyTWFyZ2luOwogICAgdGhpcy4jaXNMVFIgPSBpc0xUUjsKICAgIHRoaXMubGFzdFBvaW50ID0gW05hTiwgTmFOXTsKICAgIHRoaXMuI2NvbXB1dGVNaW5NYXgoaXNMVFIpOwogICAgY29uc3QgW3gsIHksIHdpZHRoLCBoZWlnaHRdID0gdGhpcy4jYmJveDsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IG91dGxpbmUubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICBvdXRsaW5lW2ldID0gKG91dGxpbmVbaV0gLSB4KSAvIHdpZHRoOwogICAgICBvdXRsaW5lW2kgKyAxXSA9IChvdXRsaW5lW2kgKyAxXSAtIHkpIC8gaGVpZ2h0OwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcG9pbnRzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgcG9pbnRzW2ldID0gKHBvaW50c1tpXSAtIHgpIC8gd2lkdGg7CiAgICAgIHBvaW50c1tpICsgMV0gPSAocG9pbnRzW2kgKyAxXSAtIHkpIC8gaGVpZ2h0OwogICAgfQogIH0KICB0b1NWR1BhdGgoKSB7CiAgICBjb25zdCBidWZmZXIgPSBbYE0ke3RoaXMuI291dGxpbmVbNF19ICR7dGhpcy4jb3V0bGluZVs1XX1gXTsKICAgIGZvciAobGV0IGkgPSA2LCBpaSA9IHRoaXMuI291dGxpbmUubGVuZ3RoOyBpIDwgaWk7IGkgKz0gNikgewogICAgICBpZiAoaXNOYU4odGhpcy4jb3V0bGluZVtpXSkpIHsKICAgICAgICBidWZmZXIucHVzaChgTCR7dGhpcy4jb3V0bGluZVtpICsgNF19ICR7dGhpcy4jb3V0bGluZVtpICsgNV19YCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goYEMke3RoaXMuI291dGxpbmVbaV19ICR7dGhpcy4jb3V0bGluZVtpICsgMV19ICR7dGhpcy4jb3V0bGluZVtpICsgMl19ICR7dGhpcy4jb3V0bGluZVtpICsgM119ICR7dGhpcy4jb3V0bGluZVtpICsgNF19ICR7dGhpcy4jb3V0bGluZVtpICsgNV19YCk7CiAgICB9CiAgICBidWZmZXIucHVzaCgiWiIpOwogICAgcmV0dXJuIGJ1ZmZlci5qb2luKCIgIik7CiAgfQogIHNlcmlhbGl6ZShbYmxYLCBibFksIHRyWCwgdHJZXSwgcm90YXRpb24pIHsKICAgIGNvbnN0IHdpZHRoID0gdHJYIC0gYmxYOwogICAgY29uc3QgaGVpZ2h0ID0gdHJZIC0gYmxZOwogICAgbGV0IG91dGxpbmU7CiAgICBsZXQgcG9pbnRzOwogICAgc3dpdGNoIChyb3RhdGlvbikgewogICAgICBjYXNlIDA6CiAgICAgICAgb3V0bGluZSA9IE91dGxpbmUuX3Jlc2NhbGUodGhpcy4jb3V0bGluZSwgYmxYLCB0clksIHdpZHRoLCAtaGVpZ2h0KTsKICAgICAgICBwb2ludHMgPSBPdXRsaW5lLl9yZXNjYWxlKHRoaXMuI3BvaW50cywgYmxYLCB0clksIHdpZHRoLCAtaGVpZ2h0KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSA5MDoKICAgICAgICBvdXRsaW5lID0gT3V0bGluZS5fcmVzY2FsZUFuZFN3YXAodGhpcy4jb3V0bGluZSwgYmxYLCBibFksIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIHBvaW50cyA9IE91dGxpbmUuX3Jlc2NhbGVBbmRTd2FwKHRoaXMuI3BvaW50cywgYmxYLCBibFksIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDE4MDoKICAgICAgICBvdXRsaW5lID0gT3V0bGluZS5fcmVzY2FsZSh0aGlzLiNvdXRsaW5lLCB0clgsIGJsWSwgLXdpZHRoLCBoZWlnaHQpOwogICAgICAgIHBvaW50cyA9IE91dGxpbmUuX3Jlc2NhbGUodGhpcy4jcG9pbnRzLCB0clgsIGJsWSwgLXdpZHRoLCBoZWlnaHQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI3MDoKICAgICAgICBvdXRsaW5lID0gT3V0bGluZS5fcmVzY2FsZUFuZFN3YXAodGhpcy4jb3V0bGluZSwgdHJYLCB0clksIC13aWR0aCwgLWhlaWdodCk7CiAgICAgICAgcG9pbnRzID0gT3V0bGluZS5fcmVzY2FsZUFuZFN3YXAodGhpcy4jcG9pbnRzLCB0clgsIHRyWSwgLXdpZHRoLCAtaGVpZ2h0KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIG91dGxpbmU6IEFycmF5LmZyb20ob3V0bGluZSksCiAgICAgIHBvaW50czogW0FycmF5LmZyb20ocG9pbnRzKV0KICAgIH07CiAgfQogICNjb21wdXRlTWluTWF4KGlzTFRSKSB7CiAgICBjb25zdCBvdXRsaW5lID0gdGhpcy4jb3V0bGluZTsKICAgIGxldCBsYXN0WCA9IG91dGxpbmVbNF07CiAgICBsZXQgbGFzdFkgPSBvdXRsaW5lWzVdOwogICAgY29uc3QgbWluTWF4ID0gW2xhc3RYLCBsYXN0WSwgbGFzdFgsIGxhc3RZXTsKICAgIGxldCBsYXN0UG9pbnRYID0gbGFzdFg7CiAgICBsZXQgbGFzdFBvaW50WSA9IGxhc3RZOwogICAgY29uc3QgbHRyQ2FsbGJhY2sgPSBpc0xUUiA/IE1hdGgubWF4IDogTWF0aC5taW47CiAgICBmb3IgKGxldCBpID0gNiwgaWkgPSBvdXRsaW5lLmxlbmd0aDsgaSA8IGlpOyBpICs9IDYpIHsKICAgICAgY29uc3QgeCA9IG91dGxpbmVbaSArIDRdLAogICAgICAgIHkgPSBvdXRsaW5lW2kgKyA1XTsKICAgICAgaWYgKGlzTmFOKG91dGxpbmVbaV0pKSB7CiAgICAgICAgVXRpbC5wb2ludEJvdW5kaW5nQm94KHgsIHksIG1pbk1heCk7CiAgICAgICAgaWYgKGxhc3RQb2ludFkgPCB5KSB7CiAgICAgICAgICBsYXN0UG9pbnRYID0geDsKICAgICAgICAgIGxhc3RQb2ludFkgPSB5OwogICAgICAgIH0gZWxzZSBpZiAobGFzdFBvaW50WSA9PT0geSkgewogICAgICAgICAgbGFzdFBvaW50WCA9IGx0ckNhbGxiYWNrKGxhc3RQb2ludFgsIHgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBiYm94ID0gW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldOwogICAgICAgIFV0aWwuYmV6aWVyQm91bmRpbmdCb3gobGFzdFgsIGxhc3RZLCAuLi5vdXRsaW5lLnNsaWNlKGksIGkgKyA2KSwgYmJveCk7CiAgICAgICAgVXRpbC5yZWN0Qm91bmRpbmdCb3goLi4uYmJveCwgbWluTWF4KTsKICAgICAgICBpZiAobGFzdFBvaW50WSA8IGJib3hbM10pIHsKICAgICAgICAgIGxhc3RQb2ludFggPSBiYm94WzJdOwogICAgICAgICAgbGFzdFBvaW50WSA9IGJib3hbM107CiAgICAgICAgfSBlbHNlIGlmIChsYXN0UG9pbnRZID09PSBiYm94WzNdKSB7CiAgICAgICAgICBsYXN0UG9pbnRYID0gbHRyQ2FsbGJhY2sobGFzdFBvaW50WCwgYmJveFsyXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxhc3RYID0geDsKICAgICAgbGFzdFkgPSB5OwogICAgfQogICAgY29uc3QgYmJveCA9IHRoaXMuI2Jib3g7CiAgICBiYm94WzBdID0gbWluTWF4WzBdIC0gdGhpcy4jaW5uZXJNYXJnaW47CiAgICBiYm94WzFdID0gbWluTWF4WzFdIC0gdGhpcy4jaW5uZXJNYXJnaW47CiAgICBiYm94WzJdID0gbWluTWF4WzJdIC0gbWluTWF4WzBdICsgMiAqIHRoaXMuI2lubmVyTWFyZ2luOwogICAgYmJveFszXSA9IG1pbk1heFszXSAtIG1pbk1heFsxXSArIDIgKiB0aGlzLiNpbm5lck1hcmdpbjsKICAgIHRoaXMubGFzdFBvaW50ID0gW2xhc3RQb2ludFgsIGxhc3RQb2ludFldOwogIH0KICBnZXQgYm94KCkgewogICAgcmV0dXJuIHRoaXMuI2Jib3g7CiAgfQogIG5ld091dGxpbmVyKHBvaW50LCBib3gsIHNjYWxlRmFjdG9yLCB0aGlja25lc3MsIGlzTFRSLCBpbm5lck1hcmdpbiA9IDApIHsKICAgIHJldHVybiBuZXcgRnJlZURyYXdPdXRsaW5lcihwb2ludCwgYm94LCBzY2FsZUZhY3RvciwgdGhpY2tuZXNzLCBpc0xUUiwgaW5uZXJNYXJnaW4pOwogIH0KICBnZXROZXdPdXRsaW5lKHRoaWNrbmVzcywgaW5uZXJNYXJnaW4pIHsKICAgIGNvbnN0IFt4LCB5LCB3aWR0aCwgaGVpZ2h0XSA9IHRoaXMuI2Jib3g7CiAgICBjb25zdCBbbGF5ZXJYLCBsYXllclksIGxheWVyV2lkdGgsIGxheWVySGVpZ2h0XSA9IHRoaXMuI2JveDsKICAgIGNvbnN0IHN4ID0gd2lkdGggKiBsYXllcldpZHRoOwogICAgY29uc3Qgc3kgPSBoZWlnaHQgKiBsYXllckhlaWdodDsKICAgIGNvbnN0IHR4ID0geCAqIGxheWVyV2lkdGggKyBsYXllclg7CiAgICBjb25zdCB0eSA9IHkgKiBsYXllckhlaWdodCArIGxheWVyWTsKICAgIGNvbnN0IG91dGxpbmVyID0gdGhpcy5uZXdPdXRsaW5lcih7CiAgICAgIHg6IHRoaXMuI3BvaW50c1swXSAqIHN4ICsgdHgsCiAgICAgIHk6IHRoaXMuI3BvaW50c1sxXSAqIHN5ICsgdHkKICAgIH0sIHRoaXMuI2JveCwgdGhpcy4jc2NhbGVGYWN0b3IsIHRoaWNrbmVzcywgdGhpcy4jaXNMVFIsIGlubmVyTWFyZ2luID8/IHRoaXMuI2lubmVyTWFyZ2luKTsKICAgIGZvciAobGV0IGkgPSAyOyBpIDwgdGhpcy4jcG9pbnRzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIG91dGxpbmVyLmFkZCh7CiAgICAgICAgeDogdGhpcy4jcG9pbnRzW2ldICogc3ggKyB0eCwKICAgICAgICB5OiB0aGlzLiNwb2ludHNbaSArIDFdICogc3kgKyB0eQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBvdXRsaW5lci5nZXRPdXRsaW5lcygpOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvZWRpdG9yL2RyYXdlcnMvaGlnaGxpZ2h0LmpzCgoKCmNsYXNzIEhpZ2hsaWdodE91dGxpbmVyIHsKICAjYm94OwogICNsYXN0UG9pbnQ7CiAgI3ZlcnRpY2FsRWRnZXMgPSBbXTsKICAjaW50ZXJ2YWxzID0gW107CiAgY29uc3RydWN0b3IoYm94ZXMsIGJvcmRlcldpZHRoID0gMCwgaW5uZXJNYXJnaW4gPSAwLCBpc0xUUiA9IHRydWUpIHsKICAgIGNvbnN0IG1pbk1heCA9IFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XTsKICAgIGNvbnN0IE5VTUJFUl9PRl9ESUdJVFMgPSA0OwogICAgY29uc3QgRVBTSUxPTiA9IDEwICoqIC1OVU1CRVJfT0ZfRElHSVRTOwogICAgZm9yIChjb25zdCB7CiAgICAgIHgsCiAgICAgIHksCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gb2YgYm94ZXMpIHsKICAgICAgY29uc3QgeDEgPSBNYXRoLmZsb29yKCh4IC0gYm9yZGVyV2lkdGgpIC8gRVBTSUxPTikgKiBFUFNJTE9OOwogICAgICBjb25zdCB4MiA9IE1hdGguY2VpbCgoeCArIHdpZHRoICsgYm9yZGVyV2lkdGgpIC8gRVBTSUxPTikgKiBFUFNJTE9OOwogICAgICBjb25zdCB5MSA9IE1hdGguZmxvb3IoKHkgLSBib3JkZXJXaWR0aCkgLyBFUFNJTE9OKSAqIEVQU0lMT047CiAgICAgIGNvbnN0IHkyID0gTWF0aC5jZWlsKCh5ICsgaGVpZ2h0ICsgYm9yZGVyV2lkdGgpIC8gRVBTSUxPTikgKiBFUFNJTE9OOwogICAgICBjb25zdCBsZWZ0ID0gW3gxLCB5MSwgeTIsIHRydWVdOwogICAgICBjb25zdCByaWdodCA9IFt4MiwgeTEsIHkyLCBmYWxzZV07CiAgICAgIHRoaXMuI3ZlcnRpY2FsRWRnZXMucHVzaChsZWZ0LCByaWdodCk7CiAgICAgIFV0aWwucmVjdEJvdW5kaW5nQm94KHgxLCB5MSwgeDIsIHkyLCBtaW5NYXgpOwogICAgfQogICAgY29uc3QgYmJveFdpZHRoID0gbWluTWF4WzJdIC0gbWluTWF4WzBdICsgMiAqIGlubmVyTWFyZ2luOwogICAgY29uc3QgYmJveEhlaWdodCA9IG1pbk1heFszXSAtIG1pbk1heFsxXSArIDIgKiBpbm5lck1hcmdpbjsKICAgIGNvbnN0IHNoaWZ0ZWRNaW5YID0gbWluTWF4WzBdIC0gaW5uZXJNYXJnaW47CiAgICBjb25zdCBzaGlmdGVkTWluWSA9IG1pbk1heFsxXSAtIGlubmVyTWFyZ2luOwogICAgY29uc3QgbGFzdEVkZ2UgPSB0aGlzLiN2ZXJ0aWNhbEVkZ2VzLmF0KGlzTFRSID8gLTEgOiAtMik7CiAgICBjb25zdCBsYXN0UG9pbnQgPSBbbGFzdEVkZ2VbMF0sIGxhc3RFZGdlWzJdXTsKICAgIGZvciAoY29uc3QgZWRnZSBvZiB0aGlzLiN2ZXJ0aWNhbEVkZ2VzKSB7CiAgICAgIGNvbnN0IFt4LCB5MSwgeTJdID0gZWRnZTsKICAgICAgZWRnZVswXSA9ICh4IC0gc2hpZnRlZE1pblgpIC8gYmJveFdpZHRoOwogICAgICBlZGdlWzFdID0gKHkxIC0gc2hpZnRlZE1pblkpIC8gYmJveEhlaWdodDsKICAgICAgZWRnZVsyXSA9ICh5MiAtIHNoaWZ0ZWRNaW5ZKSAvIGJib3hIZWlnaHQ7CiAgICB9CiAgICB0aGlzLiNib3ggPSBuZXcgRmxvYXQzMkFycmF5KFtzaGlmdGVkTWluWCwgc2hpZnRlZE1pblksIGJib3hXaWR0aCwgYmJveEhlaWdodF0pOwogICAgdGhpcy4jbGFzdFBvaW50ID0gbGFzdFBvaW50OwogIH0KICBnZXRPdXRsaW5lcygpIHsKICAgIHRoaXMuI3ZlcnRpY2FsRWRnZXMuc29ydCgoYSwgYikgPT4gYVswXSAtIGJbMF0gfHwgYVsxXSAtIGJbMV0gfHwgYVsyXSAtIGJbMl0pOwogICAgY29uc3Qgb3V0bGluZVZlcnRpY2FsRWRnZXMgPSBbXTsKICAgIGZvciAoY29uc3QgZWRnZSBvZiB0aGlzLiN2ZXJ0aWNhbEVkZ2VzKSB7CiAgICAgIGlmIChlZGdlWzNdKSB7CiAgICAgICAgb3V0bGluZVZlcnRpY2FsRWRnZXMucHVzaCguLi50aGlzLiNicmVha0VkZ2UoZWRnZSkpOwogICAgICAgIHRoaXMuI2luc2VydChlZGdlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiNyZW1vdmUoZWRnZSk7CiAgICAgICAgb3V0bGluZVZlcnRpY2FsRWRnZXMucHVzaCguLi50aGlzLiNicmVha0VkZ2UoZWRnZSkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy4jZ2V0T3V0bGluZXMob3V0bGluZVZlcnRpY2FsRWRnZXMpOwogIH0KICAjZ2V0T3V0bGluZXMob3V0bGluZVZlcnRpY2FsRWRnZXMpIHsKICAgIGNvbnN0IGVkZ2VzID0gW107CiAgICBjb25zdCBhbGxFZGdlcyA9IG5ldyBTZXQoKTsKICAgIGZvciAoY29uc3QgZWRnZSBvZiBvdXRsaW5lVmVydGljYWxFZGdlcykgewogICAgICBjb25zdCBbeCwgeTEsIHkyXSA9IGVkZ2U7CiAgICAgIGVkZ2VzLnB1c2goW3gsIHkxLCBlZGdlXSwgW3gsIHkyLCBlZGdlXSk7CiAgICB9CiAgICBlZGdlcy5zb3J0KChhLCBiKSA9PiBhWzFdIC0gYlsxXSB8fCBhWzBdIC0gYlswXSk7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBlZGdlcy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIGNvbnN0IGVkZ2UxID0gZWRnZXNbaV1bMl07CiAgICAgIGNvbnN0IGVkZ2UyID0gZWRnZXNbaSArIDFdWzJdOwogICAgICBlZGdlMS5wdXNoKGVkZ2UyKTsKICAgICAgZWRnZTIucHVzaChlZGdlMSk7CiAgICAgIGFsbEVkZ2VzLmFkZChlZGdlMSk7CiAgICAgIGFsbEVkZ2VzLmFkZChlZGdlMik7CiAgICB9CiAgICBjb25zdCBvdXRsaW5lcyA9IFtdOwogICAgbGV0IG91dGxpbmU7CiAgICB3aGlsZSAoYWxsRWRnZXMuc2l6ZSA+IDApIHsKICAgICAgY29uc3QgZWRnZSA9IGFsbEVkZ2VzLnZhbHVlcygpLm5leHQoKS52YWx1ZTsKICAgICAgbGV0IFt4LCB5MSwgeTIsIGVkZ2UxLCBlZGdlMl0gPSBlZGdlOwogICAgICBhbGxFZGdlcy5kZWxldGUoZWRnZSk7CiAgICAgIGxldCBsYXN0UG9pbnRYID0geDsKICAgICAgbGV0IGxhc3RQb2ludFkgPSB5MTsKICAgICAgb3V0bGluZSA9IFt4LCB5Ml07CiAgICAgIG91dGxpbmVzLnB1c2gob3V0bGluZSk7CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgbGV0IGU7CiAgICAgICAgaWYgKGFsbEVkZ2VzLmhhcyhlZGdlMSkpIHsKICAgICAgICAgIGUgPSBlZGdlMTsKICAgICAgICB9IGVsc2UgaWYgKGFsbEVkZ2VzLmhhcyhlZGdlMikpIHsKICAgICAgICAgIGUgPSBlZGdlMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGFsbEVkZ2VzLmRlbGV0ZShlKTsKICAgICAgICBbeCwgeTEsIHkyLCBlZGdlMSwgZWRnZTJdID0gZTsKICAgICAgICBpZiAobGFzdFBvaW50WCAhPT0geCkgewogICAgICAgICAgb3V0bGluZS5wdXNoKGxhc3RQb2ludFgsIGxhc3RQb2ludFksIHgsIGxhc3RQb2ludFkgPT09IHkxID8geTEgOiB5Mik7CiAgICAgICAgICBsYXN0UG9pbnRYID0geDsKICAgICAgICB9CiAgICAgICAgbGFzdFBvaW50WSA9IGxhc3RQb2ludFkgPT09IHkxID8geTIgOiB5MTsKICAgICAgfQogICAgICBvdXRsaW5lLnB1c2gobGFzdFBvaW50WCwgbGFzdFBvaW50WSk7CiAgICB9CiAgICByZXR1cm4gbmV3IEhpZ2hsaWdodE91dGxpbmUob3V0bGluZXMsIHRoaXMuI2JveCwgdGhpcy4jbGFzdFBvaW50KTsKICB9CiAgI2JpbmFyeVNlYXJjaCh5KSB7CiAgICBjb25zdCBhcnJheSA9IHRoaXMuI2ludGVydmFsczsKICAgIGxldCBzdGFydCA9IDA7CiAgICBsZXQgZW5kID0gYXJyYXkubGVuZ3RoIC0gMTsKICAgIHdoaWxlIChzdGFydCA8PSBlbmQpIHsKICAgICAgY29uc3QgbWlkZGxlID0gc3RhcnQgKyBlbmQgPj4gMTsKICAgICAgY29uc3QgeTEgPSBhcnJheVttaWRkbGVdWzBdOwogICAgICBpZiAoeTEgPT09IHkpIHsKICAgICAgICByZXR1cm4gbWlkZGxlOwogICAgICB9CiAgICAgIGlmICh5MSA8IHkpIHsKICAgICAgICBzdGFydCA9IG1pZGRsZSArIDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZW5kID0gbWlkZGxlIC0gMTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGVuZCArIDE7CiAgfQogICNpbnNlcnQoWywgeTEsIHkyXSkgewogICAgY29uc3QgaW5kZXggPSB0aGlzLiNiaW5hcnlTZWFyY2goeTEpOwogICAgdGhpcy4jaW50ZXJ2YWxzLnNwbGljZShpbmRleCwgMCwgW3kxLCB5Ml0pOwogIH0KICAjcmVtb3ZlKFssIHkxLCB5Ml0pIHsKICAgIGNvbnN0IGluZGV4ID0gdGhpcy4jYmluYXJ5U2VhcmNoKHkxKTsKICAgIGZvciAobGV0IGkgPSBpbmRleDsgaSA8IHRoaXMuI2ludGVydmFscy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBbc3RhcnQsIGVuZF0gPSB0aGlzLiNpbnRlcnZhbHNbaV07CiAgICAgIGlmIChzdGFydCAhPT0geTEpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoc3RhcnQgPT09IHkxICYmIGVuZCA9PT0geTIpIHsKICAgICAgICB0aGlzLiNpbnRlcnZhbHMuc3BsaWNlKGksIDEpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgZm9yIChsZXQgaSA9IGluZGV4IC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgY29uc3QgW3N0YXJ0LCBlbmRdID0gdGhpcy4jaW50ZXJ2YWxzW2ldOwogICAgICBpZiAoc3RhcnQgIT09IHkxKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHN0YXJ0ID09PSB5MSAmJiBlbmQgPT09IHkyKSB7CiAgICAgICAgdGhpcy4jaW50ZXJ2YWxzLnNwbGljZShpLCAxKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICB9CiAgI2JyZWFrRWRnZShlZGdlKSB7CiAgICBjb25zdCBbeCwgeTEsIHkyXSA9IGVkZ2U7CiAgICBjb25zdCByZXN1bHRzID0gW1t4LCB5MSwgeTJdXTsKICAgIGNvbnN0IGluZGV4ID0gdGhpcy4jYmluYXJ5U2VhcmNoKHkyKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kZXg7IGkrKykgewogICAgICBjb25zdCBbc3RhcnQsIGVuZF0gPSB0aGlzLiNpbnRlcnZhbHNbaV07CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHJlc3VsdHMubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgIGNvbnN0IFssIHkzLCB5NF0gPSByZXN1bHRzW2pdOwogICAgICAgIGlmIChlbmQgPD0geTMgfHwgeTQgPD0gc3RhcnQpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoeTMgPj0gc3RhcnQpIHsKICAgICAgICAgIGlmICh5NCA+IGVuZCkgewogICAgICAgICAgICByZXN1bHRzW2pdWzFdID0gZW5kOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGpqID09PSAxKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc3VsdHMuc3BsaWNlKGosIDEpOwogICAgICAgICAgICBqLS07CiAgICAgICAgICAgIGpqLS07CiAgICAgICAgICB9CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0c1tqXVsyXSA9IHN0YXJ0OwogICAgICAgIGlmICh5NCA+IGVuZCkgewogICAgICAgICAgcmVzdWx0cy5wdXNoKFt4LCBlbmQsIHk0XSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9Cn0KY2xhc3MgSGlnaGxpZ2h0T3V0bGluZSBleHRlbmRzIE91dGxpbmUgewogICNib3g7CiAgI291dGxpbmVzOwogIGNvbnN0cnVjdG9yKG91dGxpbmVzLCBib3gsIGxhc3RQb2ludCkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuI291dGxpbmVzID0gb3V0bGluZXM7CiAgICB0aGlzLiNib3ggPSBib3g7CiAgICB0aGlzLmxhc3RQb2ludCA9IGxhc3RQb2ludDsKICB9CiAgdG9TVkdQYXRoKCkgewogICAgY29uc3QgYnVmZmVyID0gW107CiAgICBmb3IgKGNvbnN0IHBvbHlnb24gb2YgdGhpcy4jb3V0bGluZXMpIHsKICAgICAgbGV0IFtwcmV2WCwgcHJldlldID0gcG9seWdvbjsKICAgICAgYnVmZmVyLnB1c2goYE0ke3ByZXZYfSAke3ByZXZZfWApOwogICAgICBmb3IgKGxldCBpID0gMjsgaSA8IHBvbHlnb24ubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICBjb25zdCB4ID0gcG9seWdvbltpXTsKICAgICAgICBjb25zdCB5ID0gcG9seWdvbltpICsgMV07CiAgICAgICAgaWYgKHggPT09IHByZXZYKSB7CiAgICAgICAgICBidWZmZXIucHVzaChgViR7eX1gKTsKICAgICAgICAgIHByZXZZID0geTsKICAgICAgICB9IGVsc2UgaWYgKHkgPT09IHByZXZZKSB7CiAgICAgICAgICBidWZmZXIucHVzaChgSCR7eH1gKTsKICAgICAgICAgIHByZXZYID0geDsKICAgICAgICB9CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goIloiKTsKICAgIH0KICAgIHJldHVybiBidWZmZXIuam9pbigiICIpOwogIH0KICBzZXJpYWxpemUoW2JsWCwgYmxZLCB0clgsIHRyWV0sIF9yb3RhdGlvbikgewogICAgY29uc3Qgb3V0bGluZXMgPSBbXTsKICAgIGNvbnN0IHdpZHRoID0gdHJYIC0gYmxYOwogICAgY29uc3QgaGVpZ2h0ID0gdHJZIC0gYmxZOwogICAgZm9yIChjb25zdCBvdXRsaW5lIG9mIHRoaXMuI291dGxpbmVzKSB7CiAgICAgIGNvbnN0IHBvaW50cyA9IG5ldyBBcnJheShvdXRsaW5lLmxlbmd0aCk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3V0bGluZS5sZW5ndGg7IGkgKz0gMikgewogICAgICAgIHBvaW50c1tpXSA9IGJsWCArIG91dGxpbmVbaV0gKiB3aWR0aDsKICAgICAgICBwb2ludHNbaSArIDFdID0gdHJZIC0gb3V0bGluZVtpICsgMV0gKiBoZWlnaHQ7CiAgICAgIH0KICAgICAgb3V0bGluZXMucHVzaChwb2ludHMpOwogICAgfQogICAgcmV0dXJuIG91dGxpbmVzOwogIH0KICBnZXQgYm94KCkgewogICAgcmV0dXJuIHRoaXMuI2JveDsKICB9CiAgZ2V0IGNsYXNzTmFtZXNGb3JPdXRsaW5pbmcoKSB7CiAgICByZXR1cm4gWyJoaWdobGlnaHRPdXRsaW5lIl07CiAgfQp9CmNsYXNzIEZyZWVIaWdobGlnaHRPdXRsaW5lciBleHRlbmRzIEZyZWVEcmF3T3V0bGluZXIgewogIG5ld0ZyZWVEcmF3T3V0bGluZShvdXRsaW5lLCBwb2ludHMsIGJveCwgc2NhbGVGYWN0b3IsIGlubmVyTWFyZ2luLCBpc0xUUikgewogICAgcmV0dXJuIG5ldyBGcmVlSGlnaGxpZ2h0T3V0bGluZShvdXRsaW5lLCBwb2ludHMsIGJveCwgc2NhbGVGYWN0b3IsIGlubmVyTWFyZ2luLCBpc0xUUik7CiAgfQp9CmNsYXNzIEZyZWVIaWdobGlnaHRPdXRsaW5lIGV4dGVuZHMgRnJlZURyYXdPdXRsaW5lIHsKICBuZXdPdXRsaW5lcihwb2ludCwgYm94LCBzY2FsZUZhY3RvciwgdGhpY2tuZXNzLCBpc0xUUiwgaW5uZXJNYXJnaW4gPSAwKSB7CiAgICByZXR1cm4gbmV3IEZyZWVIaWdobGlnaHRPdXRsaW5lcihwb2ludCwgYm94LCBzY2FsZUZhY3RvciwgdGhpY2tuZXNzLCBpc0xUUiwgaW5uZXJNYXJnaW4pOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvZWRpdG9yL2NvbG9yX3BpY2tlci5qcwoKCgpjbGFzcyBDb2xvclBpY2tlciB7CiAgI2J1dHRvbiA9IG51bGw7CiAgI2J1dHRvblN3YXRjaCA9IG51bGw7CiAgI2RlZmF1bHRDb2xvcjsKICAjZHJvcGRvd24gPSBudWxsOwogICNkcm9wZG93bldhc0Zyb21LZXlib2FyZCA9IGZhbHNlOwogICNpc01haW5Db2xvclBpY2tlciA9IGZhbHNlOwogICNlZGl0b3IgPSBudWxsOwogICNldmVudEJ1czsKICAjb3BlbkRyb3Bkb3duQUMgPSBudWxsOwogICN1aU1hbmFnZXIgPSBudWxsOwogICN0eXBlOwogIHN0YXRpYyAjbDEwbkNvbG9yID0gbnVsbDsKICBzdGF0aWMgZ2V0IF9rZXlib2FyZE1hbmFnZXIoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfa2V5Ym9hcmRNYW5hZ2VyIiwgbmV3IEtleWJvYXJkTWFuYWdlcihbW1siRXNjYXBlIiwgIm1hYytFc2NhcGUiXSwgQ29sb3JQaWNrZXIucHJvdG90eXBlLl9oaWRlRHJvcGRvd25Gcm9tS2V5Ym9hcmRdLCBbWyIgIiwgIm1hYysgIl0sIENvbG9yUGlja2VyLnByb3RvdHlwZS5fY29sb3JTZWxlY3RGcm9tS2V5Ym9hcmRdLCBbWyJBcnJvd0Rvd24iLCAiQXJyb3dSaWdodCIsICJtYWMrQXJyb3dEb3duIiwgIm1hYytBcnJvd1JpZ2h0Il0sIENvbG9yUGlja2VyLnByb3RvdHlwZS5fbW92ZVRvTmV4dF0sIFtbIkFycm93VXAiLCAiQXJyb3dMZWZ0IiwgIm1hYytBcnJvd1VwIiwgIm1hYytBcnJvd0xlZnQiXSwgQ29sb3JQaWNrZXIucHJvdG90eXBlLl9tb3ZlVG9QcmV2aW91c10sIFtbIkhvbWUiLCAibWFjK0hvbWUiXSwgQ29sb3JQaWNrZXIucHJvdG90eXBlLl9tb3ZlVG9CZWdpbm5pbmddLCBbWyJFbmQiLCAibWFjK0VuZCJdLCBDb2xvclBpY2tlci5wcm90b3R5cGUuX21vdmVUb0VuZF1dKSk7CiAgfQogIGNvbnN0cnVjdG9yKHsKICAgIGVkaXRvciA9IG51bGwsCiAgICB1aU1hbmFnZXIgPSBudWxsCiAgfSkgewogICAgaWYgKGVkaXRvcikgewogICAgICB0aGlzLiNpc01haW5Db2xvclBpY2tlciA9IGZhbHNlOwogICAgICB0aGlzLiN0eXBlID0gQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX0NPTE9SOwogICAgICB0aGlzLiNlZGl0b3IgPSBlZGl0b3I7CiAgICB9IGVsc2UgewogICAgICB0aGlzLiNpc01haW5Db2xvclBpY2tlciA9IHRydWU7CiAgICAgIHRoaXMuI3R5cGUgPSBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5ISUdITElHSFRfREVGQVVMVF9DT0xPUjsKICAgIH0KICAgIHRoaXMuI3VpTWFuYWdlciA9IGVkaXRvcj8uX3VpTWFuYWdlciB8fCB1aU1hbmFnZXI7CiAgICB0aGlzLiNldmVudEJ1cyA9IHRoaXMuI3VpTWFuYWdlci5fZXZlbnRCdXM7CiAgICB0aGlzLiNkZWZhdWx0Q29sb3IgPSBlZGl0b3I/LmNvbG9yIHx8IHRoaXMuI3VpTWFuYWdlcj8uaGlnaGxpZ2h0Q29sb3JzLnZhbHVlcygpLm5leHQoKS52YWx1ZSB8fCAiI0ZGRkY5OCI7CiAgICBDb2xvclBpY2tlci4jbDEwbkNvbG9yIHx8PSBPYmplY3QuZnJlZXplKHsKICAgICAgYmx1ZTogInBkZmpzLWVkaXRvci1jb2xvcnBpY2tlci1ibHVlIiwKICAgICAgZ3JlZW46ICJwZGZqcy1lZGl0b3ItY29sb3JwaWNrZXItZ3JlZW4iLAogICAgICBwaW5rOiAicGRmanMtZWRpdG9yLWNvbG9ycGlja2VyLXBpbmsiLAogICAgICByZWQ6ICJwZGZqcy1lZGl0b3ItY29sb3JwaWNrZXItcmVkIiwKICAgICAgeWVsbG93OiAicGRmanMtZWRpdG9yLWNvbG9ycGlja2VyLXllbGxvdyIKICAgIH0pOwogIH0KICByZW5kZXJCdXR0b24oKSB7CiAgICBjb25zdCBidXR0b24gPSB0aGlzLiNidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgIGJ1dHRvbi5jbGFzc05hbWUgPSAiY29sb3JQaWNrZXIiOwogICAgYnV0dG9uLnRhYkluZGV4ID0gIjAiOwogICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgInBkZmpzLWVkaXRvci1jb2xvcnBpY2tlci1idXR0b24iKTsKICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtaGFzcG9wdXAiLCB0cnVlKTsKICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuI3VpTWFuYWdlci5fc2lnbmFsOwogICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy4jb3BlbkRyb3Bkb3duLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgdGhpcy4ja2V5RG93bi5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICBjb25zdCBzd2F0Y2ggPSB0aGlzLiNidXR0b25Td2F0Y2ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICBzd2F0Y2guY2xhc3NOYW1lID0gInN3YXRjaCI7CiAgICBzd2F0Y2guc2V0QXR0cmlidXRlKCJhcmlhLWhpZGRlbiIsIHRydWUpOwogICAgc3dhdGNoLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHRoaXMuI2RlZmF1bHRDb2xvcjsKICAgIGJ1dHRvbi5hcHBlbmQoc3dhdGNoKTsKICAgIHJldHVybiBidXR0b247CiAgfQogIHJlbmRlck1haW5Ecm9wZG93bigpIHsKICAgIGNvbnN0IGRyb3Bkb3duID0gdGhpcy4jZHJvcGRvd24gPSB0aGlzLiNnZXREcm9wZG93blJvb3QoKTsKICAgIGRyb3Bkb3duLnNldEF0dHJpYnV0ZSgiYXJpYS1vcmllbnRhdGlvbiIsICJob3Jpem9udGFsIik7CiAgICBkcm9wZG93bi5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWxsZWRieSIsICJoaWdobGlnaHRDb2xvclBpY2tlckxhYmVsIik7CiAgICByZXR1cm4gZHJvcGRvd247CiAgfQogICNnZXREcm9wZG93blJvb3QoKSB7CiAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuI3VpTWFuYWdlci5fc2lnbmFsOwogICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51Iiwgbm9Db250ZXh0TWVudSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgZGl2LmNsYXNzTmFtZSA9ICJkcm9wZG93biI7CiAgICBkaXYucm9sZSA9ICJsaXN0Ym94IjsKICAgIGRpdi5zZXRBdHRyaWJ1dGUoImFyaWEtbXVsdGlzZWxlY3RhYmxlIiwgZmFsc2UpOwogICAgZGl2LnNldEF0dHJpYnV0ZSgiYXJpYS1vcmllbnRhdGlvbiIsICJ2ZXJ0aWNhbCIpOwogICAgZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgInBkZmpzLWVkaXRvci1jb2xvcnBpY2tlci1kcm9wZG93biIpOwogICAgZm9yIChjb25zdCBbbmFtZSwgY29sb3JdIG9mIHRoaXMuI3VpTWFuYWdlci5oaWdobGlnaHRDb2xvcnMpIHsKICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICAgIGJ1dHRvbi50YWJJbmRleCA9ICIwIjsKICAgICAgYnV0dG9uLnJvbGUgPSAib3B0aW9uIjsKICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS1jb2xvciIsIGNvbG9yKTsKICAgICAgYnV0dG9uLnRpdGxlID0gbmFtZTsKICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgQ29sb3JQaWNrZXIuI2wxMG5Db2xvcltuYW1lXSk7CiAgICAgIGNvbnN0IHN3YXRjaCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgYnV0dG9uLmFwcGVuZChzd2F0Y2gpOwogICAgICBzd2F0Y2guY2xhc3NOYW1lID0gInN3YXRjaCI7CiAgICAgIHN3YXRjaC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjsKICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1zZWxlY3RlZCIsIGNvbG9yID09PSB0aGlzLiNkZWZhdWx0Q29sb3IpOwogICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLiNjb2xvclNlbGVjdC5iaW5kKHRoaXMsIGNvbG9yKSwgewogICAgICAgIHNpZ25hbAogICAgICB9KTsKICAgICAgZGl2LmFwcGVuZChidXR0b24pOwogICAgfQogICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCB0aGlzLiNrZXlEb3duLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHJldHVybiBkaXY7CiAgfQogICNjb2xvclNlbGVjdChjb2xvciwgZXZlbnQpIHsKICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgdGhpcy4jZXZlbnRCdXMuZGlzcGF0Y2goInN3aXRjaGFubm90YXRpb25lZGl0b3JwYXJhbXMiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgdHlwZTogdGhpcy4jdHlwZSwKICAgICAgdmFsdWU6IGNvbG9yCiAgICB9KTsKICB9CiAgX2NvbG9yU2VsZWN0RnJvbUtleWJvYXJkKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSB0aGlzLiNidXR0b24pIHsKICAgICAgdGhpcy4jb3BlbkRyb3Bkb3duKGV2ZW50KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY29sb3IgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJkYXRhLWNvbG9yIik7CiAgICBpZiAoIWNvbG9yKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2NvbG9yU2VsZWN0KGNvbG9yLCBldmVudCk7CiAgfQogIF9tb3ZlVG9OZXh0KGV2ZW50KSB7CiAgICBpZiAoIXRoaXMuI2lzRHJvcGRvd25WaXNpYmxlKSB7CiAgICAgIHRoaXMuI29wZW5Ecm9wZG93bihldmVudCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChldmVudC50YXJnZXQgPT09IHRoaXMuI2J1dHRvbikgewogICAgICB0aGlzLiNkcm9wZG93bi5maXJzdENoaWxkPy5mb2N1cygpOwogICAgICByZXR1cm47CiAgICB9CiAgICBldmVudC50YXJnZXQubmV4dFNpYmxpbmc/LmZvY3VzKCk7CiAgfQogIF9tb3ZlVG9QcmV2aW91cyhldmVudCkgewogICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gdGhpcy4jZHJvcGRvd24/LmZpcnN0Q2hpbGQgfHwgZXZlbnQudGFyZ2V0ID09PSB0aGlzLiNidXR0b24pIHsKICAgICAgaWYgKHRoaXMuI2lzRHJvcGRvd25WaXNpYmxlKSB7CiAgICAgICAgdGhpcy5faGlkZURyb3Bkb3duRnJvbUtleWJvYXJkKCk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzLiNpc0Ryb3Bkb3duVmlzaWJsZSkgewogICAgICB0aGlzLiNvcGVuRHJvcGRvd24oZXZlbnQpOwogICAgfQogICAgZXZlbnQudGFyZ2V0LnByZXZpb3VzU2libGluZz8uZm9jdXMoKTsKICB9CiAgX21vdmVUb0JlZ2lubmluZyhldmVudCkgewogICAgaWYgKCF0aGlzLiNpc0Ryb3Bkb3duVmlzaWJsZSkgewogICAgICB0aGlzLiNvcGVuRHJvcGRvd24oZXZlbnQpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNkcm9wZG93bi5maXJzdENoaWxkPy5mb2N1cygpOwogIH0KICBfbW92ZVRvRW5kKGV2ZW50KSB7CiAgICBpZiAoIXRoaXMuI2lzRHJvcGRvd25WaXNpYmxlKSB7CiAgICAgIHRoaXMuI29wZW5Ecm9wZG93bihldmVudCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2Ryb3Bkb3duLmxhc3RDaGlsZD8uZm9jdXMoKTsKICB9CiAgI2tleURvd24oZXZlbnQpIHsKICAgIENvbG9yUGlja2VyLl9rZXlib2FyZE1hbmFnZXIuZXhlYyh0aGlzLCBldmVudCk7CiAgfQogICNvcGVuRHJvcGRvd24oZXZlbnQpIHsKICAgIGlmICh0aGlzLiNpc0Ryb3Bkb3duVmlzaWJsZSkgewogICAgICB0aGlzLmhpZGVEcm9wZG93bigpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNkcm9wZG93bldhc0Zyb21LZXlib2FyZCA9IGV2ZW50LmRldGFpbCA9PT0gMDsKICAgIGlmICghdGhpcy4jb3BlbkRyb3Bkb3duQUMpIHsKICAgICAgdGhpcy4jb3BlbkRyb3Bkb3duQUMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIHRoaXMuI3BvaW50ZXJEb3duLmJpbmQodGhpcyksIHsKICAgICAgICBzaWduYWw6IHRoaXMuI3VpTWFuYWdlci5jb21iaW5lZFNpZ25hbCh0aGlzLiNvcGVuRHJvcGRvd25BQykKICAgICAgfSk7CiAgICB9CiAgICBpZiAodGhpcy4jZHJvcGRvd24pIHsKICAgICAgdGhpcy4jZHJvcGRvd24uY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHJvb3QgPSB0aGlzLiNkcm9wZG93biA9IHRoaXMuI2dldERyb3Bkb3duUm9vdCgpOwogICAgdGhpcy4jYnV0dG9uLmFwcGVuZChyb290KTsKICB9CiAgI3BvaW50ZXJEb3duKGV2ZW50KSB7CiAgICBpZiAodGhpcy4jZHJvcGRvd24/LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5oaWRlRHJvcGRvd24oKTsKICB9CiAgaGlkZURyb3Bkb3duKCkgewogICAgdGhpcy4jZHJvcGRvd24/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgdGhpcy4jb3BlbkRyb3Bkb3duQUM/LmFib3J0KCk7CiAgICB0aGlzLiNvcGVuRHJvcGRvd25BQyA9IG51bGw7CiAgfQogIGdldCAjaXNEcm9wZG93blZpc2libGUoKSB7CiAgICByZXR1cm4gdGhpcy4jZHJvcGRvd24gJiYgIXRoaXMuI2Ryb3Bkb3duLmNsYXNzTGlzdC5jb250YWlucygiaGlkZGVuIik7CiAgfQogIF9oaWRlRHJvcGRvd25Gcm9tS2V5Ym9hcmQoKSB7CiAgICBpZiAodGhpcy4jaXNNYWluQ29sb3JQaWNrZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzLiNpc0Ryb3Bkb3duVmlzaWJsZSkgewogICAgICB0aGlzLiNlZGl0b3I/LnVuc2VsZWN0KCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuaGlkZURyb3Bkb3duKCk7CiAgICB0aGlzLiNidXR0b24uZm9jdXMoewogICAgICBwcmV2ZW50U2Nyb2xsOiB0cnVlLAogICAgICBmb2N1c1Zpc2libGU6IHRoaXMuI2Ryb3Bkb3duV2FzRnJvbUtleWJvYXJkCiAgICB9KTsKICB9CiAgdXBkYXRlQ29sb3IoY29sb3IpIHsKICAgIGlmICh0aGlzLiNidXR0b25Td2F0Y2gpIHsKICAgICAgdGhpcy4jYnV0dG9uU3dhdGNoLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yOwogICAgfQogICAgaWYgKCF0aGlzLiNkcm9wZG93bikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBpID0gdGhpcy4jdWlNYW5hZ2VyLmhpZ2hsaWdodENvbG9ycy52YWx1ZXMoKTsKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy4jZHJvcGRvd24uY2hpbGRyZW4pIHsKICAgICAgY2hpbGQuc2V0QXR0cmlidXRlKCJhcmlhLXNlbGVjdGVkIiwgaS5uZXh0KCkudmFsdWUgPT09IGNvbG9yKTsKICAgIH0KICB9CiAgZGVzdHJveSgpIHsKICAgIHRoaXMuI2J1dHRvbj8ucmVtb3ZlKCk7CiAgICB0aGlzLiNidXR0b24gPSBudWxsOwogICAgdGhpcy4jYnV0dG9uU3dhdGNoID0gbnVsbDsKICAgIHRoaXMuI2Ryb3Bkb3duPy5yZW1vdmUoKTsKICAgIHRoaXMuI2Ryb3Bkb3duID0gbnVsbDsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L2VkaXRvci9oaWdobGlnaHQuanMKCgoKCgoKCmNsYXNzIEhpZ2hsaWdodEVkaXRvciBleHRlbmRzIEFubm90YXRpb25FZGl0b3IgewogICNhbmNob3JOb2RlID0gbnVsbDsKICAjYW5jaG9yT2Zmc2V0ID0gMDsKICAjYm94ZXM7CiAgI2NsaXBQYXRoSWQgPSBudWxsOwogICNjb2xvclBpY2tlciA9IG51bGw7CiAgI2ZvY3VzT3V0bGluZXMgPSBudWxsOwogICNmb2N1c05vZGUgPSBudWxsOwogICNmb2N1c09mZnNldCA9IDA7CiAgI2hpZ2hsaWdodERpdiA9IG51bGw7CiAgI2hpZ2hsaWdodE91dGxpbmVzID0gbnVsbDsKICAjaWQgPSBudWxsOwogICNpc0ZyZWVIaWdobGlnaHQgPSBmYWxzZTsKICAjbGFzdFBvaW50ID0gbnVsbDsKICAjb3BhY2l0eTsKICAjb3V0bGluZUlkID0gbnVsbDsKICAjdGV4dCA9ICIiOwogICN0aGlja25lc3M7CiAgI21ldGhvZE9mQ3JlYXRpb24gPSAiIjsKICBzdGF0aWMgX2RlZmF1bHRDb2xvciA9IG51bGw7CiAgc3RhdGljIF9kZWZhdWx0T3BhY2l0eSA9IDE7CiAgc3RhdGljIF9kZWZhdWx0VGhpY2tuZXNzID0gMTI7CiAgc3RhdGljIF90eXBlID0gImhpZ2hsaWdodCI7CiAgc3RhdGljIF9lZGl0b3JUeXBlID0gQW5ub3RhdGlvbkVkaXRvclR5cGUuSElHSExJR0hUOwogIHN0YXRpYyBfZnJlZUhpZ2hsaWdodElkID0gLTE7CiAgc3RhdGljIF9mcmVlSGlnaGxpZ2h0ID0gbnVsbDsKICBzdGF0aWMgX2ZyZWVIaWdobGlnaHRDbGlwSWQgPSAiIjsKICBzdGF0aWMgZ2V0IF9rZXlib2FyZE1hbmFnZXIoKSB7CiAgICBjb25zdCBwcm90byA9IEhpZ2hsaWdodEVkaXRvci5wcm90b3R5cGU7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfa2V5Ym9hcmRNYW5hZ2VyIiwgbmV3IEtleWJvYXJkTWFuYWdlcihbW1siQXJyb3dMZWZ0IiwgIm1hYytBcnJvd0xlZnQiXSwgcHJvdG8uX21vdmVDYXJldCwgewogICAgICBhcmdzOiBbMF0KICAgIH1dLCBbWyJBcnJvd1JpZ2h0IiwgIm1hYytBcnJvd1JpZ2h0Il0sIHByb3RvLl9tb3ZlQ2FyZXQsIHsKICAgICAgYXJnczogWzFdCiAgICB9XSwgW1siQXJyb3dVcCIsICJtYWMrQXJyb3dVcCJdLCBwcm90by5fbW92ZUNhcmV0LCB7CiAgICAgIGFyZ3M6IFsyXQogICAgfV0sIFtbIkFycm93RG93biIsICJtYWMrQXJyb3dEb3duIl0sIHByb3RvLl9tb3ZlQ2FyZXQsIHsKICAgICAgYXJnczogWzNdCiAgICB9XV0pKTsKICB9CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcih7CiAgICAgIC4uLnBhcmFtcywKICAgICAgbmFtZTogImhpZ2hsaWdodEVkaXRvciIKICAgIH0pOwogICAgdGhpcy5jb2xvciA9IHBhcmFtcy5jb2xvciB8fCBIaWdobGlnaHRFZGl0b3IuX2RlZmF1bHRDb2xvcjsKICAgIHRoaXMuI3RoaWNrbmVzcyA9IHBhcmFtcy50aGlja25lc3MgfHwgSGlnaGxpZ2h0RWRpdG9yLl9kZWZhdWx0VGhpY2tuZXNzOwogICAgdGhpcy4jb3BhY2l0eSA9IHBhcmFtcy5vcGFjaXR5IHx8IEhpZ2hsaWdodEVkaXRvci5fZGVmYXVsdE9wYWNpdHk7CiAgICB0aGlzLiNib3hlcyA9IHBhcmFtcy5ib3hlcyB8fCBudWxsOwogICAgdGhpcy4jbWV0aG9kT2ZDcmVhdGlvbiA9IHBhcmFtcy5tZXRob2RPZkNyZWF0aW9uIHx8ICIiOwogICAgdGhpcy4jdGV4dCA9IHBhcmFtcy50ZXh0IHx8ICIiOwogICAgdGhpcy5faXNEcmFnZ2FibGUgPSBmYWxzZTsKICAgIHRoaXMuZGVmYXVsdEwxMG5JZCA9ICJwZGZqcy1lZGl0b3ItaGlnaGxpZ2h0LWVkaXRvciI7CiAgICBpZiAocGFyYW1zLmhpZ2hsaWdodElkID4gLTEpIHsKICAgICAgdGhpcy4jaXNGcmVlSGlnaGxpZ2h0ID0gdHJ1ZTsKICAgICAgdGhpcy4jY3JlYXRlRnJlZU91dGxpbmVzKHBhcmFtcyk7CiAgICAgIHRoaXMuI2FkZFRvRHJhd0xheWVyKCk7CiAgICB9IGVsc2UgaWYgKHRoaXMuI2JveGVzKSB7CiAgICAgIHRoaXMuI2FuY2hvck5vZGUgPSBwYXJhbXMuYW5jaG9yTm9kZTsKICAgICAgdGhpcy4jYW5jaG9yT2Zmc2V0ID0gcGFyYW1zLmFuY2hvck9mZnNldDsKICAgICAgdGhpcy4jZm9jdXNOb2RlID0gcGFyYW1zLmZvY3VzTm9kZTsKICAgICAgdGhpcy4jZm9jdXNPZmZzZXQgPSBwYXJhbXMuZm9jdXNPZmZzZXQ7CiAgICAgIHRoaXMuI2NyZWF0ZU91dGxpbmVzKCk7CiAgICAgIHRoaXMuI2FkZFRvRHJhd0xheWVyKCk7CiAgICAgIHRoaXMucm90YXRlKHRoaXMucm90YXRpb24pOwogICAgfQogIH0KICBnZXQgdGVsZW1ldHJ5SW5pdGlhbERhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBhY3Rpb246ICJhZGRlZCIsCiAgICAgIHR5cGU6IHRoaXMuI2lzRnJlZUhpZ2hsaWdodCA/ICJmcmVlX2hpZ2hsaWdodCIgOiAiaGlnaGxpZ2h0IiwKICAgICAgY29sb3I6IHRoaXMuX3VpTWFuYWdlci5oaWdobGlnaHRDb2xvck5hbWVzLmdldCh0aGlzLmNvbG9yKSwKICAgICAgdGhpY2tuZXNzOiB0aGlzLiN0aGlja25lc3MsCiAgICAgIG1ldGhvZE9mQ3JlYXRpb246IHRoaXMuI21ldGhvZE9mQ3JlYXRpb24KICAgIH07CiAgfQogIGdldCB0ZWxlbWV0cnlGaW5hbERhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB0eXBlOiAiaGlnaGxpZ2h0IiwKICAgICAgY29sb3I6IHRoaXMuX3VpTWFuYWdlci5oaWdobGlnaHRDb2xvck5hbWVzLmdldCh0aGlzLmNvbG9yKQogICAgfTsKICB9CiAgc3RhdGljIGNvbXB1dGVUZWxlbWV0cnlGaW5hbERhdGEoZGF0YSkgewogICAgcmV0dXJuIHsKICAgICAgbnVtYmVyT2ZDb2xvcnM6IGRhdGEuZ2V0KCJjb2xvciIpLnNpemUKICAgIH07CiAgfQogICNjcmVhdGVPdXRsaW5lcygpIHsKICAgIGNvbnN0IG91dGxpbmVyID0gbmV3IEhpZ2hsaWdodE91dGxpbmVyKHRoaXMuI2JveGVzLCAwLjAwMSk7CiAgICB0aGlzLiNoaWdobGlnaHRPdXRsaW5lcyA9IG91dGxpbmVyLmdldE91dGxpbmVzKCk7CiAgICBbdGhpcy54LCB0aGlzLnksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0XSA9IHRoaXMuI2hpZ2hsaWdodE91dGxpbmVzLmJveDsKICAgIGNvbnN0IG91dGxpbmVyRm9yT3V0bGluZSA9IG5ldyBIaWdobGlnaHRPdXRsaW5lcih0aGlzLiNib3hlcywgMC4wMDI1LCAwLjAwMSwgdGhpcy5fdWlNYW5hZ2VyLmRpcmVjdGlvbiA9PT0gImx0ciIpOwogICAgdGhpcy4jZm9jdXNPdXRsaW5lcyA9IG91dGxpbmVyRm9yT3V0bGluZS5nZXRPdXRsaW5lcygpOwogICAgY29uc3QgewogICAgICBsYXN0UG9pbnQKICAgIH0gPSB0aGlzLiNmb2N1c091dGxpbmVzOwogICAgdGhpcy4jbGFzdFBvaW50ID0gWyhsYXN0UG9pbnRbMF0gLSB0aGlzLngpIC8gdGhpcy53aWR0aCwgKGxhc3RQb2ludFsxXSAtIHRoaXMueSkgLyB0aGlzLmhlaWdodF07CiAgfQogICNjcmVhdGVGcmVlT3V0bGluZXMoewogICAgaGlnaGxpZ2h0T3V0bGluZXMsCiAgICBoaWdobGlnaHRJZCwKICAgIGNsaXBQYXRoSWQKICB9KSB7CiAgICB0aGlzLiNoaWdobGlnaHRPdXRsaW5lcyA9IGhpZ2hsaWdodE91dGxpbmVzOwogICAgY29uc3QgZXh0cmFUaGlja25lc3MgPSAxLjU7CiAgICB0aGlzLiNmb2N1c091dGxpbmVzID0gaGlnaGxpZ2h0T3V0bGluZXMuZ2V0TmV3T3V0bGluZSh0aGlzLiN0aGlja25lc3MgLyAyICsgZXh0cmFUaGlja25lc3MsIDAuMDAyNSk7CiAgICBpZiAoaGlnaGxpZ2h0SWQgPj0gMCkgewogICAgICB0aGlzLiNpZCA9IGhpZ2hsaWdodElkOwogICAgICB0aGlzLiNjbGlwUGF0aElkID0gY2xpcFBhdGhJZDsKICAgICAgdGhpcy5wYXJlbnQuZHJhd0xheWVyLmZpbmFsaXplRHJhdyhoaWdobGlnaHRJZCwgewogICAgICAgIGJib3g6IGhpZ2hsaWdodE91dGxpbmVzLmJveCwKICAgICAgICBwYXRoOiB7CiAgICAgICAgICBkOiBoaWdobGlnaHRPdXRsaW5lcy50b1NWR1BhdGgoKQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuI291dGxpbmVJZCA9IHRoaXMucGFyZW50LmRyYXdMYXllci5kcmF3T3V0bGluZSh7CiAgICAgICAgcm9vdENsYXNzOiB7CiAgICAgICAgICBoaWdobGlnaHRPdXRsaW5lOiB0cnVlLAogICAgICAgICAgZnJlZTogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgYmJveDogdGhpcy4jZm9jdXNPdXRsaW5lcy5ib3gsCiAgICAgICAgcGF0aDogewogICAgICAgICAgZDogdGhpcy4jZm9jdXNPdXRsaW5lcy50b1NWR1BhdGgoKQogICAgICAgIH0KICAgICAgfSwgdHJ1ZSk7CiAgICB9IGVsc2UgaWYgKHRoaXMucGFyZW50KSB7CiAgICAgIGNvbnN0IGFuZ2xlID0gdGhpcy5wYXJlbnQudmlld3BvcnQucm90YXRpb247CiAgICAgIHRoaXMucGFyZW50LmRyYXdMYXllci51cGRhdGVQcm9wZXJ0aWVzKHRoaXMuI2lkLCB7CiAgICAgICAgYmJveDogSGlnaGxpZ2h0RWRpdG9yLiNyb3RhdGVCYm94KHRoaXMuI2hpZ2hsaWdodE91dGxpbmVzLmJveCwgKGFuZ2xlIC0gdGhpcy5yb3RhdGlvbiArIDM2MCkgJSAzNjApLAogICAgICAgIHBhdGg6IHsKICAgICAgICAgIGQ6IGhpZ2hsaWdodE91dGxpbmVzLnRvU1ZHUGF0aCgpCiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5wYXJlbnQuZHJhd0xheWVyLnVwZGF0ZVByb3BlcnRpZXModGhpcy4jb3V0bGluZUlkLCB7CiAgICAgICAgYmJveDogSGlnaGxpZ2h0RWRpdG9yLiNyb3RhdGVCYm94KHRoaXMuI2ZvY3VzT3V0bGluZXMuYm94LCBhbmdsZSksCiAgICAgICAgcGF0aDogewogICAgICAgICAgZDogdGhpcy4jZm9jdXNPdXRsaW5lcy50b1NWR1BhdGgoKQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBbeCwgeSwgd2lkdGgsIGhlaWdodF0gPSBoaWdobGlnaHRPdXRsaW5lcy5ib3g7CiAgICBzd2l0Y2ggKHRoaXMucm90YXRpb24pIHsKICAgICAgY2FzZSAwOgogICAgICAgIHRoaXMueCA9IHg7CiAgICAgICAgdGhpcy55ID0geTsKICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgOTA6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW3BhZ2VXaWR0aCwgcGFnZUhlaWdodF0gPSB0aGlzLnBhcmVudERpbWVuc2lvbnM7CiAgICAgICAgICB0aGlzLnggPSB5OwogICAgICAgICAgdGhpcy55ID0gMSAtIHg7CiAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGggKiBwYWdlSGVpZ2h0IC8gcGFnZVdpZHRoOwogICAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQgKiBwYWdlV2lkdGggLyBwYWdlSGVpZ2h0OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIDE4MDoKICAgICAgICB0aGlzLnggPSAxIC0geDsKICAgICAgICB0aGlzLnkgPSAxIC0geTsKICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjcwOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFtwYWdlV2lkdGgsIHBhZ2VIZWlnaHRdID0gdGhpcy5wYXJlbnREaW1lbnNpb25zOwogICAgICAgICAgdGhpcy54ID0gMSAtIHk7CiAgICAgICAgICB0aGlzLnkgPSB4OwogICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoICogcGFnZUhlaWdodCAvIHBhZ2VXaWR0aDsKICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0ICogcGFnZVdpZHRoIC8gcGFnZUhlaWdodDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICAgIGNvbnN0IHsKICAgICAgbGFzdFBvaW50CiAgICB9ID0gdGhpcy4jZm9jdXNPdXRsaW5lczsKICAgIHRoaXMuI2xhc3RQb2ludCA9IFsobGFzdFBvaW50WzBdIC0geCkgLyB3aWR0aCwgKGxhc3RQb2ludFsxXSAtIHkpIC8gaGVpZ2h0XTsKICB9CiAgc3RhdGljIGluaXRpYWxpemUobDEwbiwgdWlNYW5hZ2VyKSB7CiAgICBBbm5vdGF0aW9uRWRpdG9yLmluaXRpYWxpemUobDEwbiwgdWlNYW5hZ2VyKTsKICAgIEhpZ2hsaWdodEVkaXRvci5fZGVmYXVsdENvbG9yIHx8PSB1aU1hbmFnZXIuaGlnaGxpZ2h0Q29sb3JzPy52YWx1ZXMoKS5uZXh0KCkudmFsdWUgfHwgIiNmZmYwNjYiOwogIH0KICBzdGF0aWMgdXBkYXRlRGVmYXVsdFBhcmFtcyh0eXBlLCB2YWx1ZSkgewogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX0RFRkFVTFRfQ09MT1I6CiAgICAgICAgSGlnaGxpZ2h0RWRpdG9yLl9kZWZhdWx0Q29sb3IgPSB2YWx1ZTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5ISUdITElHSFRfVEhJQ0tORVNTOgogICAgICAgIEhpZ2hsaWdodEVkaXRvci5fZGVmYXVsdFRoaWNrbmVzcyA9IHZhbHVlOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KICB0cmFuc2xhdGVJblBhZ2UoeCwgeSkge30KICBnZXQgdG9vbGJhclBvc2l0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuI2xhc3RQb2ludDsKICB9CiAgdXBkYXRlUGFyYW1zKHR5cGUsIHZhbHVlKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5ISUdITElHSFRfQ09MT1I6CiAgICAgICAgdGhpcy4jdXBkYXRlQ29sb3IodmFsdWUpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLkhJR0hMSUdIVF9USElDS05FU1M6CiAgICAgICAgdGhpcy4jdXBkYXRlVGhpY2tuZXNzKHZhbHVlKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CiAgc3RhdGljIGdldCBkZWZhdWx0UHJvcGVydGllc1RvVXBkYXRlKCkgewogICAgcmV0dXJuIFtbQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX0RFRkFVTFRfQ09MT1IsIEhpZ2hsaWdodEVkaXRvci5fZGVmYXVsdENvbG9yXSwgW0Fubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLkhJR0hMSUdIVF9USElDS05FU1MsIEhpZ2hsaWdodEVkaXRvci5fZGVmYXVsdFRoaWNrbmVzc11dOwogIH0KICBnZXQgcHJvcGVydGllc1RvVXBkYXRlKCkgewogICAgcmV0dXJuIFtbQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX0NPTE9SLCB0aGlzLmNvbG9yIHx8IEhpZ2hsaWdodEVkaXRvci5fZGVmYXVsdENvbG9yXSwgW0Fubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLkhJR0hMSUdIVF9USElDS05FU1MsIHRoaXMuI3RoaWNrbmVzcyB8fCBIaWdobGlnaHRFZGl0b3IuX2RlZmF1bHRUaGlja25lc3NdLCBbQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX0ZSRUUsIHRoaXMuI2lzRnJlZUhpZ2hsaWdodF1dOwogIH0KICAjdXBkYXRlQ29sb3IoY29sb3IpIHsKICAgIGNvbnN0IHNldENvbG9yQW5kT3BhY2l0eSA9IChjb2wsIG9wYSkgPT4gewogICAgICB0aGlzLmNvbG9yID0gY29sOwogICAgICB0aGlzLiNvcGFjaXR5ID0gb3BhOwogICAgICB0aGlzLnBhcmVudD8uZHJhd0xheWVyLnVwZGF0ZVByb3BlcnRpZXModGhpcy4jaWQsIHsKICAgICAgICByb290OiB7CiAgICAgICAgICBmaWxsOiBjb2wsCiAgICAgICAgICAiZmlsbC1vcGFjaXR5Ijogb3BhCiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy4jY29sb3JQaWNrZXI/LnVwZGF0ZUNvbG9yKGNvbCk7CiAgICB9OwogICAgY29uc3Qgc2F2ZWRDb2xvciA9IHRoaXMuY29sb3I7CiAgICBjb25zdCBzYXZlZE9wYWNpdHkgPSB0aGlzLiNvcGFjaXR5OwogICAgdGhpcy5hZGRDb21tYW5kcyh7CiAgICAgIGNtZDogc2V0Q29sb3JBbmRPcGFjaXR5LmJpbmQodGhpcywgY29sb3IsIEhpZ2hsaWdodEVkaXRvci5fZGVmYXVsdE9wYWNpdHkpLAogICAgICB1bmRvOiBzZXRDb2xvckFuZE9wYWNpdHkuYmluZCh0aGlzLCBzYXZlZENvbG9yLCBzYXZlZE9wYWNpdHkpLAogICAgICBwb3N0OiB0aGlzLl91aU1hbmFnZXIudXBkYXRlVUkuYmluZCh0aGlzLl91aU1hbmFnZXIsIHRoaXMpLAogICAgICBtdXN0RXhlYzogdHJ1ZSwKICAgICAgdHlwZTogQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX0NPTE9SLAogICAgICBvdmVyd3JpdGVJZlNhbWVUeXBlOiB0cnVlLAogICAgICBrZWVwVW5kbzogdHJ1ZQogICAgfSk7CiAgICB0aGlzLl9yZXBvcnRUZWxlbWV0cnkoewogICAgICBhY3Rpb246ICJjb2xvcl9jaGFuZ2VkIiwKICAgICAgY29sb3I6IHRoaXMuX3VpTWFuYWdlci5oaWdobGlnaHRDb2xvck5hbWVzLmdldChjb2xvcikKICAgIH0sIHRydWUpOwogIH0KICAjdXBkYXRlVGhpY2tuZXNzKHRoaWNrbmVzcykgewogICAgY29uc3Qgc2F2ZWRUaGlja25lc3MgPSB0aGlzLiN0aGlja25lc3M7CiAgICBjb25zdCBzZXRUaGlja25lc3MgPSB0aCA9PiB7CiAgICAgIHRoaXMuI3RoaWNrbmVzcyA9IHRoOwogICAgICB0aGlzLiNjaGFuZ2VUaGlja25lc3ModGgpOwogICAgfTsKICAgIHRoaXMuYWRkQ29tbWFuZHMoewogICAgICBjbWQ6IHNldFRoaWNrbmVzcy5iaW5kKHRoaXMsIHRoaWNrbmVzcyksCiAgICAgIHVuZG86IHNldFRoaWNrbmVzcy5iaW5kKHRoaXMsIHNhdmVkVGhpY2tuZXNzKSwKICAgICAgcG9zdDogdGhpcy5fdWlNYW5hZ2VyLnVwZGF0ZVVJLmJpbmQodGhpcy5fdWlNYW5hZ2VyLCB0aGlzKSwKICAgICAgbXVzdEV4ZWM6IHRydWUsCiAgICAgIHR5cGU6IEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLklOS19USElDS05FU1MsCiAgICAgIG92ZXJ3cml0ZUlmU2FtZVR5cGU6IHRydWUsCiAgICAgIGtlZXBVbmRvOiB0cnVlCiAgICB9KTsKICAgIHRoaXMuX3JlcG9ydFRlbGVtZXRyeSh7CiAgICAgIGFjdGlvbjogInRoaWNrbmVzc19jaGFuZ2VkIiwKICAgICAgdGhpY2tuZXNzCiAgICB9LCB0cnVlKTsKICB9CiAgYXN5bmMgYWRkRWRpdFRvb2xiYXIoKSB7CiAgICBjb25zdCB0b29sYmFyID0gYXdhaXQgc3VwZXIuYWRkRWRpdFRvb2xiYXIoKTsKICAgIGlmICghdG9vbGJhcikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLl91aU1hbmFnZXIuaGlnaGxpZ2h0Q29sb3JzKSB7CiAgICAgIHRoaXMuI2NvbG9yUGlja2VyID0gbmV3IENvbG9yUGlja2VyKHsKICAgICAgICBlZGl0b3I6IHRoaXMKICAgICAgfSk7CiAgICAgIHRvb2xiYXIuYWRkQ29sb3JQaWNrZXIodGhpcy4jY29sb3JQaWNrZXIpOwogICAgfQogICAgcmV0dXJuIHRvb2xiYXI7CiAgfQogIGRpc2FibGVFZGl0aW5nKCkgewogICAgc3VwZXIuZGlzYWJsZUVkaXRpbmcoKTsKICAgIHRoaXMuZGl2LmNsYXNzTGlzdC50b2dnbGUoImRpc2FibGVkIiwgdHJ1ZSk7CiAgfQogIGVuYWJsZUVkaXRpbmcoKSB7CiAgICBzdXBlci5lbmFibGVFZGl0aW5nKCk7CiAgICB0aGlzLmRpdi5jbGFzc0xpc3QudG9nZ2xlKCJkaXNhYmxlZCIsIGZhbHNlKTsKICB9CiAgZml4QW5kU2V0UG9zaXRpb24oKSB7CiAgICByZXR1cm4gc3VwZXIuZml4QW5kU2V0UG9zaXRpb24odGhpcy4jZ2V0Um90YXRpb24oKSk7CiAgfQogIGdldEJhc2VUcmFuc2xhdGlvbigpIHsKICAgIHJldHVybiBbMCwgMF07CiAgfQogIGdldFJlY3QodHgsIHR5KSB7CiAgICByZXR1cm4gc3VwZXIuZ2V0UmVjdCh0eCwgdHksIHRoaXMuI2dldFJvdGF0aW9uKCkpOwogIH0KICBvbmNlQWRkZWQoZm9jdXMpIHsKICAgIGlmICghdGhpcy5hbm5vdGF0aW9uRWxlbWVudElkKSB7CiAgICAgIHRoaXMucGFyZW50LmFkZFVuZG9hYmxlRWRpdG9yKHRoaXMpOwogICAgfQogICAgaWYgKGZvY3VzKSB7CiAgICAgIHRoaXMuZGl2LmZvY3VzKCk7CiAgICB9CiAgfQogIHJlbW92ZSgpIHsKICAgIHRoaXMuI2NsZWFuRHJhd0xheWVyKCk7CiAgICB0aGlzLl9yZXBvcnRUZWxlbWV0cnkoewogICAgICBhY3Rpb246ICJkZWxldGVkIgogICAgfSk7CiAgICBzdXBlci5yZW1vdmUoKTsKICB9CiAgcmVidWlsZCgpIHsKICAgIGlmICghdGhpcy5wYXJlbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3VwZXIucmVidWlsZCgpOwogICAgaWYgKHRoaXMuZGl2ID09PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2FkZFRvRHJhd0xheWVyKCk7CiAgICBpZiAoIXRoaXMuaXNBdHRhY2hlZFRvRE9NKSB7CiAgICAgIHRoaXMucGFyZW50LmFkZCh0aGlzKTsKICAgIH0KICB9CiAgc2V0UGFyZW50KHBhcmVudCkgewogICAgbGV0IG11c3RCZVNlbGVjdGVkID0gZmFsc2U7CiAgICBpZiAodGhpcy5wYXJlbnQgJiYgIXBhcmVudCkgewogICAgICB0aGlzLiNjbGVhbkRyYXdMYXllcigpOwogICAgfSBlbHNlIGlmIChwYXJlbnQpIHsKICAgICAgdGhpcy4jYWRkVG9EcmF3TGF5ZXIocGFyZW50KTsKICAgICAgbXVzdEJlU2VsZWN0ZWQgPSAhdGhpcy5wYXJlbnQgJiYgdGhpcy5kaXY/LmNsYXNzTGlzdC5jb250YWlucygic2VsZWN0ZWRFZGl0b3IiKTsKICAgIH0KICAgIHN1cGVyLnNldFBhcmVudChwYXJlbnQpOwogICAgdGhpcy5zaG93KHRoaXMuX2lzVmlzaWJsZSk7CiAgICBpZiAobXVzdEJlU2VsZWN0ZWQpIHsKICAgICAgdGhpcy5zZWxlY3QoKTsKICAgIH0KICB9CiAgI2NoYW5nZVRoaWNrbmVzcyh0aGlja25lc3MpIHsKICAgIGlmICghdGhpcy4jaXNGcmVlSGlnaGxpZ2h0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2NyZWF0ZUZyZWVPdXRsaW5lcyh7CiAgICAgIGhpZ2hsaWdodE91dGxpbmVzOiB0aGlzLiNoaWdobGlnaHRPdXRsaW5lcy5nZXROZXdPdXRsaW5lKHRoaWNrbmVzcyAvIDIpCiAgICB9KTsKICAgIHRoaXMuZml4QW5kU2V0UG9zaXRpb24oKTsKICAgIGNvbnN0IFtwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0XSA9IHRoaXMucGFyZW50RGltZW5zaW9uczsKICAgIHRoaXMuc2V0RGltcyh0aGlzLndpZHRoICogcGFyZW50V2lkdGgsIHRoaXMuaGVpZ2h0ICogcGFyZW50SGVpZ2h0KTsKICB9CiAgI2NsZWFuRHJhd0xheWVyKCkgewogICAgaWYgKHRoaXMuI2lkID09PSBudWxsIHx8ICF0aGlzLnBhcmVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnBhcmVudC5kcmF3TGF5ZXIucmVtb3ZlKHRoaXMuI2lkKTsKICAgIHRoaXMuI2lkID0gbnVsbDsKICAgIHRoaXMucGFyZW50LmRyYXdMYXllci5yZW1vdmUodGhpcy4jb3V0bGluZUlkKTsKICAgIHRoaXMuI291dGxpbmVJZCA9IG51bGw7CiAgfQogICNhZGRUb0RyYXdMYXllcihwYXJlbnQgPSB0aGlzLnBhcmVudCkgewogICAgaWYgKHRoaXMuI2lkICE9PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgICh7CiAgICAgIGlkOiB0aGlzLiNpZCwKICAgICAgY2xpcFBhdGhJZDogdGhpcy4jY2xpcFBhdGhJZAogICAgfSA9IHBhcmVudC5kcmF3TGF5ZXIuZHJhdyh7CiAgICAgIGJib3g6IHRoaXMuI2hpZ2hsaWdodE91dGxpbmVzLmJveCwKICAgICAgcm9vdDogewogICAgICAgIHZpZXdCb3g6ICIwIDAgMSAxIiwKICAgICAgICBmaWxsOiB0aGlzLmNvbG9yLAogICAgICAgICJmaWxsLW9wYWNpdHkiOiB0aGlzLiNvcGFjaXR5CiAgICAgIH0sCiAgICAgIHJvb3RDbGFzczogewogICAgICAgIGhpZ2hsaWdodDogdHJ1ZSwKICAgICAgICBmcmVlOiB0aGlzLiNpc0ZyZWVIaWdobGlnaHQKICAgICAgfSwKICAgICAgcGF0aDogewogICAgICAgIGQ6IHRoaXMuI2hpZ2hsaWdodE91dGxpbmVzLnRvU1ZHUGF0aCgpCiAgICAgIH0KICAgIH0sIGZhbHNlLCB0cnVlKSk7CiAgICB0aGlzLiNvdXRsaW5lSWQgPSBwYXJlbnQuZHJhd0xheWVyLmRyYXdPdXRsaW5lKHsKICAgICAgcm9vdENsYXNzOiB7CiAgICAgICAgaGlnaGxpZ2h0T3V0bGluZTogdHJ1ZSwKICAgICAgICBmcmVlOiB0aGlzLiNpc0ZyZWVIaWdobGlnaHQKICAgICAgfSwKICAgICAgYmJveDogdGhpcy4jZm9jdXNPdXRsaW5lcy5ib3gsCiAgICAgIHBhdGg6IHsKICAgICAgICBkOiB0aGlzLiNmb2N1c091dGxpbmVzLnRvU1ZHUGF0aCgpCiAgICAgIH0KICAgIH0sIHRoaXMuI2lzRnJlZUhpZ2hsaWdodCk7CiAgICBpZiAodGhpcy4jaGlnaGxpZ2h0RGl2KSB7CiAgICAgIHRoaXMuI2hpZ2hsaWdodERpdi5zdHlsZS5jbGlwUGF0aCA9IHRoaXMuI2NsaXBQYXRoSWQ7CiAgICB9CiAgfQogIHN0YXRpYyAjcm90YXRlQmJveChbeCwgeSwgd2lkdGgsIGhlaWdodF0sIGFuZ2xlKSB7CiAgICBzd2l0Y2ggKGFuZ2xlKSB7CiAgICAgIGNhc2UgOTA6CiAgICAgICAgcmV0dXJuIFsxIC0geSAtIGhlaWdodCwgeCwgaGVpZ2h0LCB3aWR0aF07CiAgICAgIGNhc2UgMTgwOgogICAgICAgIHJldHVybiBbMSAtIHggLSB3aWR0aCwgMSAtIHkgLSBoZWlnaHQsIHdpZHRoLCBoZWlnaHRdOwogICAgICBjYXNlIDI3MDoKICAgICAgICByZXR1cm4gW3ksIDEgLSB4IC0gd2lkdGgsIGhlaWdodCwgd2lkdGhdOwogICAgfQogICAgcmV0dXJuIFt4LCB5LCB3aWR0aCwgaGVpZ2h0XTsKICB9CiAgcm90YXRlKGFuZ2xlKSB7CiAgICBjb25zdCB7CiAgICAgIGRyYXdMYXllcgogICAgfSA9IHRoaXMucGFyZW50OwogICAgbGV0IGJveDsKICAgIGlmICh0aGlzLiNpc0ZyZWVIaWdobGlnaHQpIHsKICAgICAgYW5nbGUgPSAoYW5nbGUgLSB0aGlzLnJvdGF0aW9uICsgMzYwKSAlIDM2MDsKICAgICAgYm94ID0gSGlnaGxpZ2h0RWRpdG9yLiNyb3RhdGVCYm94KHRoaXMuI2hpZ2hsaWdodE91dGxpbmVzLmJveCwgYW5nbGUpOwogICAgfSBlbHNlIHsKICAgICAgYm94ID0gSGlnaGxpZ2h0RWRpdG9yLiNyb3RhdGVCYm94KFt0aGlzLngsIHRoaXMueSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHRdLCBhbmdsZSk7CiAgICB9CiAgICBkcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLiNpZCwgewogICAgICBiYm94OiBib3gsCiAgICAgIHJvb3Q6IHsKICAgICAgICAiZGF0YS1tYWluLXJvdGF0aW9uIjogYW5nbGUKICAgICAgfQogICAgfSk7CiAgICBkcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLiNvdXRsaW5lSWQsIHsKICAgICAgYmJveDogSGlnaGxpZ2h0RWRpdG9yLiNyb3RhdGVCYm94KHRoaXMuI2ZvY3VzT3V0bGluZXMuYm94LCBhbmdsZSksCiAgICAgIHJvb3Q6IHsKICAgICAgICAiZGF0YS1tYWluLXJvdGF0aW9uIjogYW5nbGUKICAgICAgfQogICAgfSk7CiAgfQogIHJlbmRlcigpIHsKICAgIGlmICh0aGlzLmRpdikgewogICAgICByZXR1cm4gdGhpcy5kaXY7CiAgICB9CiAgICBjb25zdCBkaXYgPSBzdXBlci5yZW5kZXIoKTsKICAgIGlmICh0aGlzLiN0ZXh0KSB7CiAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiLCB0aGlzLiN0ZXh0KTsKICAgICAgZGl2LnNldEF0dHJpYnV0ZSgicm9sZSIsICJtYXJrIik7CiAgICB9CiAgICBpZiAodGhpcy4jaXNGcmVlSGlnaGxpZ2h0KSB7CiAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKCJmcmVlIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmRpdi5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgdGhpcy4ja2V5ZG93bi5iaW5kKHRoaXMpLCB7CiAgICAgICAgc2lnbmFsOiB0aGlzLl91aU1hbmFnZXIuX3NpZ25hbAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IGhpZ2hsaWdodERpdiA9IHRoaXMuI2hpZ2hsaWdodERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgZGl2LmFwcGVuZChoaWdobGlnaHREaXYpOwogICAgaGlnaGxpZ2h0RGl2LnNldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iLCAidHJ1ZSIpOwogICAgaGlnaGxpZ2h0RGl2LmNsYXNzTmFtZSA9ICJpbnRlcm5hbCI7CiAgICBoaWdobGlnaHREaXYuc3R5bGUuY2xpcFBhdGggPSB0aGlzLiNjbGlwUGF0aElkOwogICAgY29uc3QgW3BhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHRdID0gdGhpcy5wYXJlbnREaW1lbnNpb25zOwogICAgdGhpcy5zZXREaW1zKHRoaXMud2lkdGggKiBwYXJlbnRXaWR0aCwgdGhpcy5oZWlnaHQgKiBwYXJlbnRIZWlnaHQpOwogICAgYmluZEV2ZW50cyh0aGlzLCB0aGlzLiNoaWdobGlnaHREaXYsIFsicG9pbnRlcm92ZXIiLCAicG9pbnRlcmxlYXZlIl0pOwogICAgdGhpcy5lbmFibGVFZGl0aW5nKCk7CiAgICByZXR1cm4gZGl2OwogIH0KICBwb2ludGVyb3ZlcigpIHsKICAgIGlmICghdGhpcy5pc1NlbGVjdGVkKSB7CiAgICAgIHRoaXMucGFyZW50Py5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLiNvdXRsaW5lSWQsIHsKICAgICAgICByb290Q2xhc3M6IHsKICAgICAgICAgIGhvdmVyZWQ6IHRydWUKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KICBwb2ludGVybGVhdmUoKSB7CiAgICBpZiAoIXRoaXMuaXNTZWxlY3RlZCkgewogICAgICB0aGlzLnBhcmVudD8uZHJhd0xheWVyLnVwZGF0ZVByb3BlcnRpZXModGhpcy4jb3V0bGluZUlkLCB7CiAgICAgICAgcm9vdENsYXNzOiB7CiAgICAgICAgICBob3ZlcmVkOiBmYWxzZQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQogICNrZXlkb3duKGV2ZW50KSB7CiAgICBIaWdobGlnaHRFZGl0b3IuX2tleWJvYXJkTWFuYWdlci5leGVjKHRoaXMsIGV2ZW50KTsKICB9CiAgX21vdmVDYXJldChkaXJlY3Rpb24pIHsKICAgIHRoaXMucGFyZW50LnVuc2VsZWN0KHRoaXMpOwogICAgc3dpdGNoIChkaXJlY3Rpb24pIHsKICAgICAgY2FzZSAwOgogICAgICBjYXNlIDI6CiAgICAgICAgdGhpcy4jc2V0Q2FyZXQodHJ1ZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMToKICAgICAgY2FzZSAzOgogICAgICAgIHRoaXMuI3NldENhcmV0KGZhbHNlKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CiAgI3NldENhcmV0KHN0YXJ0KSB7CiAgICBpZiAoIXRoaXMuI2FuY2hvck5vZGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpOwogICAgaWYgKHN0YXJ0KSB7CiAgICAgIHNlbGVjdGlvbi5zZXRQb3NpdGlvbih0aGlzLiNhbmNob3JOb2RlLCB0aGlzLiNhbmNob3JPZmZzZXQpOwogICAgfSBlbHNlIHsKICAgICAgc2VsZWN0aW9uLnNldFBvc2l0aW9uKHRoaXMuI2ZvY3VzTm9kZSwgdGhpcy4jZm9jdXNPZmZzZXQpOwogICAgfQogIH0KICBzZWxlY3QoKSB7CiAgICBzdXBlci5zZWxlY3QoKTsKICAgIGlmICghdGhpcy4jb3V0bGluZUlkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMucGFyZW50Py5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLiNvdXRsaW5lSWQsIHsKICAgICAgcm9vdENsYXNzOiB7CiAgICAgICAgaG92ZXJlZDogZmFsc2UsCiAgICAgICAgc2VsZWN0ZWQ6IHRydWUKICAgICAgfQogICAgfSk7CiAgfQogIHVuc2VsZWN0KCkgewogICAgc3VwZXIudW5zZWxlY3QoKTsKICAgIGlmICghdGhpcy4jb3V0bGluZUlkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMucGFyZW50Py5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLiNvdXRsaW5lSWQsIHsKICAgICAgcm9vdENsYXNzOiB7CiAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlCiAgICAgIH0KICAgIH0pOwogICAgaWYgKCF0aGlzLiNpc0ZyZWVIaWdobGlnaHQpIHsKICAgICAgdGhpcy4jc2V0Q2FyZXQoZmFsc2UpOwogICAgfQogIH0KICBnZXQgX211c3RGaXhQb3NpdGlvbigpIHsKICAgIHJldHVybiAhdGhpcy4jaXNGcmVlSGlnaGxpZ2h0OwogIH0KICBzaG93KHZpc2libGUgPSB0aGlzLl9pc1Zpc2libGUpIHsKICAgIHN1cGVyLnNob3codmlzaWJsZSk7CiAgICBpZiAodGhpcy5wYXJlbnQpIHsKICAgICAgdGhpcy5wYXJlbnQuZHJhd0xheWVyLnVwZGF0ZVByb3BlcnRpZXModGhpcy4jaWQsIHsKICAgICAgICByb290Q2xhc3M6IHsKICAgICAgICAgIGhpZGRlbjogIXZpc2libGUKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnBhcmVudC5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLiNvdXRsaW5lSWQsIHsKICAgICAgICByb290Q2xhc3M6IHsKICAgICAgICAgIGhpZGRlbjogIXZpc2libGUKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KICAjZ2V0Um90YXRpb24oKSB7CiAgICByZXR1cm4gdGhpcy4jaXNGcmVlSGlnaGxpZ2h0ID8gdGhpcy5yb3RhdGlvbiA6IDA7CiAgfQogICNzZXJpYWxpemVCb3hlcygpIHsKICAgIGlmICh0aGlzLiNpc0ZyZWVIaWdobGlnaHQpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBbcGFnZVdpZHRoLCBwYWdlSGVpZ2h0XSA9IHRoaXMucGFnZURpbWVuc2lvbnM7CiAgICBjb25zdCBbcGFnZVgsIHBhZ2VZXSA9IHRoaXMucGFnZVRyYW5zbGF0aW9uOwogICAgY29uc3QgYm94ZXMgPSB0aGlzLiNib3hlczsKICAgIGNvbnN0IHF1YWRQb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KGJveGVzLmxlbmd0aCAqIDgpOwogICAgbGV0IGkgPSAwOwogICAgZm9yIChjb25zdCB7CiAgICAgIHgsCiAgICAgIHksCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gb2YgYm94ZXMpIHsKICAgICAgY29uc3Qgc3ggPSB4ICogcGFnZVdpZHRoICsgcGFnZVg7CiAgICAgIGNvbnN0IHN5ID0gKDEgLSB5KSAqIHBhZ2VIZWlnaHQgKyBwYWdlWTsKICAgICAgcXVhZFBvaW50c1tpXSA9IHF1YWRQb2ludHNbaSArIDRdID0gc3g7CiAgICAgIHF1YWRQb2ludHNbaSArIDFdID0gcXVhZFBvaW50c1tpICsgM10gPSBzeTsKICAgICAgcXVhZFBvaW50c1tpICsgMl0gPSBxdWFkUG9pbnRzW2kgKyA2XSA9IHN4ICsgd2lkdGggKiBwYWdlV2lkdGg7CiAgICAgIHF1YWRQb2ludHNbaSArIDVdID0gcXVhZFBvaW50c1tpICsgN10gPSBzeSAtIGhlaWdodCAqIHBhZ2VIZWlnaHQ7CiAgICAgIGkgKz0gODsKICAgIH0KICAgIHJldHVybiBxdWFkUG9pbnRzOwogIH0KICAjc2VyaWFsaXplT3V0bGluZXMocmVjdCkgewogICAgcmV0dXJuIHRoaXMuI2hpZ2hsaWdodE91dGxpbmVzLnNlcmlhbGl6ZShyZWN0LCB0aGlzLiNnZXRSb3RhdGlvbigpKTsKICB9CiAgc3RhdGljIHN0YXJ0SGlnaGxpZ2h0aW5nKHBhcmVudCwgaXNMVFIsIHsKICAgIHRhcmdldDogdGV4dExheWVyLAogICAgeCwKICAgIHkKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIHg6IGxheWVyWCwKICAgICAgeTogbGF5ZXJZLAogICAgICB3aWR0aDogcGFyZW50V2lkdGgsCiAgICAgIGhlaWdodDogcGFyZW50SGVpZ2h0CiAgICB9ID0gdGV4dExheWVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgY29uc3QgYWMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBjb25zdCBzaWduYWwgPSBwYXJlbnQuY29tYmluZWRTaWduYWwoYWMpOwogICAgY29uc3QgcG9pbnRlclVwQ2FsbGJhY2sgPSBlID0+IHsKICAgICAgYWMuYWJvcnQoKTsKICAgICAgdGhpcy4jZW5kSGlnaGxpZ2h0KHBhcmVudCwgZSk7CiAgICB9OwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJsdXIiLCBwb2ludGVyVXBDYWxsYmFjaywgewogICAgICBzaWduYWwKICAgIH0pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIHBvaW50ZXJVcENhbGxiYWNrLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBzdG9wRXZlbnQsIHsKICAgICAgY2FwdHVyZTogdHJ1ZSwKICAgICAgcGFzc2l2ZTogZmFsc2UsCiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiY29udGV4dG1lbnUiLCBub0NvbnRleHRNZW51LCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB0ZXh0TGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCB0aGlzLiNoaWdobGlnaHRNb3ZlLmJpbmQodGhpcywgcGFyZW50KSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgdGhpcy5fZnJlZUhpZ2hsaWdodCA9IG5ldyBGcmVlSGlnaGxpZ2h0T3V0bGluZXIoewogICAgICB4LAogICAgICB5CiAgICB9LCBbbGF5ZXJYLCBsYXllclksIHBhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHRdLCBwYXJlbnQuc2NhbGUsIHRoaXMuX2RlZmF1bHRUaGlja25lc3MgLyAyLCBpc0xUUiwgMC4wMDEpOwogICAgKHsKICAgICAgaWQ6IHRoaXMuX2ZyZWVIaWdobGlnaHRJZCwKICAgICAgY2xpcFBhdGhJZDogdGhpcy5fZnJlZUhpZ2hsaWdodENsaXBJZAogICAgfSA9IHBhcmVudC5kcmF3TGF5ZXIuZHJhdyh7CiAgICAgIGJib3g6IFswLCAwLCAxLCAxXSwKICAgICAgcm9vdDogewogICAgICAgIHZpZXdCb3g6ICIwIDAgMSAxIiwKICAgICAgICBmaWxsOiB0aGlzLl9kZWZhdWx0Q29sb3IsCiAgICAgICAgImZpbGwtb3BhY2l0eSI6IHRoaXMuX2RlZmF1bHRPcGFjaXR5CiAgICAgIH0sCiAgICAgIHJvb3RDbGFzczogewogICAgICAgIGhpZ2hsaWdodDogdHJ1ZSwKICAgICAgICBmcmVlOiB0cnVlCiAgICAgIH0sCiAgICAgIHBhdGg6IHsKICAgICAgICBkOiB0aGlzLl9mcmVlSGlnaGxpZ2h0LnRvU1ZHUGF0aCgpCiAgICAgIH0KICAgIH0sIHRydWUsIHRydWUpKTsKICB9CiAgc3RhdGljICNoaWdobGlnaHRNb3ZlKHBhcmVudCwgZXZlbnQpIHsKICAgIGlmICh0aGlzLl9mcmVlSGlnaGxpZ2h0LmFkZChldmVudCkpIHsKICAgICAgcGFyZW50LmRyYXdMYXllci51cGRhdGVQcm9wZXJ0aWVzKHRoaXMuX2ZyZWVIaWdobGlnaHRJZCwgewogICAgICAgIHBhdGg6IHsKICAgICAgICAgIGQ6IHRoaXMuX2ZyZWVIaWdobGlnaHQudG9TVkdQYXRoKCkKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KICBzdGF0aWMgI2VuZEhpZ2hsaWdodChwYXJlbnQsIGV2ZW50KSB7CiAgICBpZiAoIXRoaXMuX2ZyZWVIaWdobGlnaHQuaXNFbXB0eSgpKSB7CiAgICAgIHBhcmVudC5jcmVhdGVBbmRBZGROZXdFZGl0b3IoZXZlbnQsIGZhbHNlLCB7CiAgICAgICAgaGlnaGxpZ2h0SWQ6IHRoaXMuX2ZyZWVIaWdobGlnaHRJZCwKICAgICAgICBoaWdobGlnaHRPdXRsaW5lczogdGhpcy5fZnJlZUhpZ2hsaWdodC5nZXRPdXRsaW5lcygpLAogICAgICAgIGNsaXBQYXRoSWQ6IHRoaXMuX2ZyZWVIaWdobGlnaHRDbGlwSWQsCiAgICAgICAgbWV0aG9kT2ZDcmVhdGlvbjogIm1haW5fdG9vbGJhciIKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBwYXJlbnQuZHJhd0xheWVyLnJlbW92ZSh0aGlzLl9mcmVlSGlnaGxpZ2h0SWQpOwogICAgfQogICAgdGhpcy5fZnJlZUhpZ2hsaWdodElkID0gLTE7CiAgICB0aGlzLl9mcmVlSGlnaGxpZ2h0ID0gbnVsbDsKICAgIHRoaXMuX2ZyZWVIaWdobGlnaHRDbGlwSWQgPSAiIjsKICB9CiAgc3RhdGljIGFzeW5jIGRlc2VyaWFsaXplKGRhdGEsIHBhcmVudCwgdWlNYW5hZ2VyKSB7CiAgICBsZXQgaW5pdGlhbERhdGEgPSBudWxsOwogICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBIaWdobGlnaHRBbm5vdGF0aW9uRWxlbWVudCkgewogICAgICBjb25zdCB7CiAgICAgICAgZGF0YTogewogICAgICAgICAgcXVhZFBvaW50cywKICAgICAgICAgIHJlY3QsCiAgICAgICAgICByb3RhdGlvbiwKICAgICAgICAgIGlkLAogICAgICAgICAgY29sb3IsCiAgICAgICAgICBvcGFjaXR5LAogICAgICAgICAgcG9wdXBSZWYKICAgICAgICB9LAogICAgICAgIHBhcmVudDogewogICAgICAgICAgcGFnZTogewogICAgICAgICAgICBwYWdlTnVtYmVyCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9ID0gZGF0YTsKICAgICAgaW5pdGlhbERhdGEgPSBkYXRhID0gewogICAgICAgIGFubm90YXRpb25UeXBlOiBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ISUdITElHSFQsCiAgICAgICAgY29sb3I6IEFycmF5LmZyb20oY29sb3IpLAogICAgICAgIG9wYWNpdHksCiAgICAgICAgcXVhZFBvaW50cywKICAgICAgICBib3hlczogbnVsbCwKICAgICAgICBwYWdlSW5kZXg6IHBhZ2VOdW1iZXIgLSAxLAogICAgICAgIHJlY3Q6IHJlY3Quc2xpY2UoMCksCiAgICAgICAgcm90YXRpb24sCiAgICAgICAgaWQsCiAgICAgICAgZGVsZXRlZDogZmFsc2UsCiAgICAgICAgcG9wdXBSZWYKICAgICAgfTsKICAgIH0gZWxzZSBpZiAoZGF0YSBpbnN0YW5jZW9mIElua0Fubm90YXRpb25FbGVtZW50KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBpbmtMaXN0cywKICAgICAgICAgIHJlY3QsCiAgICAgICAgICByb3RhdGlvbiwKICAgICAgICAgIGlkLAogICAgICAgICAgY29sb3IsCiAgICAgICAgICBib3JkZXJTdHlsZTogewogICAgICAgICAgICByYXdXaWR0aDogdGhpY2tuZXNzCiAgICAgICAgICB9LAogICAgICAgICAgcG9wdXBSZWYKICAgICAgICB9LAogICAgICAgIHBhcmVudDogewogICAgICAgICAgcGFnZTogewogICAgICAgICAgICBwYWdlTnVtYmVyCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9ID0gZGF0YTsKICAgICAgaW5pdGlhbERhdGEgPSBkYXRhID0gewogICAgICAgIGFubm90YXRpb25UeXBlOiBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ISUdITElHSFQsCiAgICAgICAgY29sb3I6IEFycmF5LmZyb20oY29sb3IpLAogICAgICAgIHRoaWNrbmVzcywKICAgICAgICBpbmtMaXN0cywKICAgICAgICBib3hlczogbnVsbCwKICAgICAgICBwYWdlSW5kZXg6IHBhZ2VOdW1iZXIgLSAxLAogICAgICAgIHJlY3Q6IHJlY3Quc2xpY2UoMCksCiAgICAgICAgcm90YXRpb24sCiAgICAgICAgaWQsCiAgICAgICAgZGVsZXRlZDogZmFsc2UsCiAgICAgICAgcG9wdXBSZWYKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgY29sb3IsCiAgICAgIHF1YWRQb2ludHMsCiAgICAgIGlua0xpc3RzLAogICAgICBvcGFjaXR5CiAgICB9ID0gZGF0YTsKICAgIGNvbnN0IGVkaXRvciA9IGF3YWl0IHN1cGVyLmRlc2VyaWFsaXplKGRhdGEsIHBhcmVudCwgdWlNYW5hZ2VyKTsKICAgIGVkaXRvci5jb2xvciA9IFV0aWwubWFrZUhleENvbG9yKC4uLmNvbG9yKTsKICAgIGVkaXRvci4jb3BhY2l0eSA9IG9wYWNpdHkgfHwgMTsKICAgIGlmIChpbmtMaXN0cykgewogICAgICBlZGl0b3IuI3RoaWNrbmVzcyA9IGRhdGEudGhpY2tuZXNzOwogICAgfQogICAgZWRpdG9yLmFubm90YXRpb25FbGVtZW50SWQgPSBkYXRhLmlkIHx8IG51bGw7CiAgICBlZGl0b3IuX2luaXRpYWxEYXRhID0gaW5pdGlhbERhdGE7CiAgICBjb25zdCBbcGFnZVdpZHRoLCBwYWdlSGVpZ2h0XSA9IGVkaXRvci5wYWdlRGltZW5zaW9uczsKICAgIGNvbnN0IFtwYWdlWCwgcGFnZVldID0gZWRpdG9yLnBhZ2VUcmFuc2xhdGlvbjsKICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgIGNvbnN0IGJveGVzID0gZWRpdG9yLiNib3hlcyA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1YWRQb2ludHMubGVuZ3RoOyBpICs9IDgpIHsKICAgICAgICBib3hlcy5wdXNoKHsKICAgICAgICAgIHg6IChxdWFkUG9pbnRzW2ldIC0gcGFnZVgpIC8gcGFnZVdpZHRoLAogICAgICAgICAgeTogMSAtIChxdWFkUG9pbnRzW2kgKyAxXSAtIHBhZ2VZKSAvIHBhZ2VIZWlnaHQsCiAgICAgICAgICB3aWR0aDogKHF1YWRQb2ludHNbaSArIDJdIC0gcXVhZFBvaW50c1tpXSkgLyBwYWdlV2lkdGgsCiAgICAgICAgICBoZWlnaHQ6IChxdWFkUG9pbnRzW2kgKyAxXSAtIHF1YWRQb2ludHNbaSArIDVdKSAvIHBhZ2VIZWlnaHQKICAgICAgICB9KTsKICAgICAgfQogICAgICBlZGl0b3IuI2NyZWF0ZU91dGxpbmVzKCk7CiAgICAgIGVkaXRvci4jYWRkVG9EcmF3TGF5ZXIoKTsKICAgICAgZWRpdG9yLnJvdGF0ZShlZGl0b3Iucm90YXRpb24pOwogICAgfSBlbHNlIGlmIChpbmtMaXN0cykgewogICAgICBlZGl0b3IuI2lzRnJlZUhpZ2hsaWdodCA9IHRydWU7CiAgICAgIGNvbnN0IHBvaW50cyA9IGlua0xpc3RzWzBdOwogICAgICBjb25zdCBwb2ludCA9IHsKICAgICAgICB4OiBwb2ludHNbMF0gLSBwYWdlWCwKICAgICAgICB5OiBwYWdlSGVpZ2h0IC0gKHBvaW50c1sxXSAtIHBhZ2VZKQogICAgICB9OwogICAgICBjb25zdCBvdXRsaW5lciA9IG5ldyBGcmVlSGlnaGxpZ2h0T3V0bGluZXIocG9pbnQsIFswLCAwLCBwYWdlV2lkdGgsIHBhZ2VIZWlnaHRdLCAxLCBlZGl0b3IuI3RoaWNrbmVzcyAvIDIsIHRydWUsIDAuMDAxKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcG9pbnRzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICBwb2ludC54ID0gcG9pbnRzW2ldIC0gcGFnZVg7CiAgICAgICAgcG9pbnQueSA9IHBhZ2VIZWlnaHQgLSAocG9pbnRzW2kgKyAxXSAtIHBhZ2VZKTsKICAgICAgICBvdXRsaW5lci5hZGQocG9pbnQpOwogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBpZCwKICAgICAgICBjbGlwUGF0aElkCiAgICAgIH0gPSBwYXJlbnQuZHJhd0xheWVyLmRyYXcoewogICAgICAgIGJib3g6IFswLCAwLCAxLCAxXSwKICAgICAgICByb290OiB7CiAgICAgICAgICB2aWV3Qm94OiAiMCAwIDEgMSIsCiAgICAgICAgICBmaWxsOiBlZGl0b3IuY29sb3IsCiAgICAgICAgICAiZmlsbC1vcGFjaXR5IjogZWRpdG9yLl9kZWZhdWx0T3BhY2l0eQogICAgICAgIH0sCiAgICAgICAgcm9vdENsYXNzOiB7CiAgICAgICAgICBoaWdobGlnaHQ6IHRydWUsCiAgICAgICAgICBmcmVlOiB0cnVlCiAgICAgICAgfSwKICAgICAgICBwYXRoOiB7CiAgICAgICAgICBkOiBvdXRsaW5lci50b1NWR1BhdGgoKQogICAgICAgIH0KICAgICAgfSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgIGVkaXRvci4jY3JlYXRlRnJlZU91dGxpbmVzKHsKICAgICAgICBoaWdobGlnaHRPdXRsaW5lczogb3V0bGluZXIuZ2V0T3V0bGluZXMoKSwKICAgICAgICBoaWdobGlnaHRJZDogaWQsCiAgICAgICAgY2xpcFBhdGhJZAogICAgICB9KTsKICAgICAgZWRpdG9yLiNhZGRUb0RyYXdMYXllcigpOwogICAgICBlZGl0b3Iucm90YXRlKGVkaXRvci5wYXJlbnRSb3RhdGlvbik7CiAgICB9CiAgICByZXR1cm4gZWRpdG9yOwogIH0KICBzZXJpYWxpemUoaXNGb3JDb3B5aW5nID0gZmFsc2UpIHsKICAgIGlmICh0aGlzLmlzRW1wdHkoKSB8fCBpc0ZvckNvcHlpbmcpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAodGhpcy5kZWxldGVkKSB7CiAgICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZURlbGV0ZWQoKTsKICAgIH0KICAgIGNvbnN0IHJlY3QgPSB0aGlzLmdldFJlY3QoMCwgMCk7CiAgICBjb25zdCBjb2xvciA9IEFubm90YXRpb25FZGl0b3IuX2NvbG9yTWFuYWdlci5jb252ZXJ0KHRoaXMuY29sb3IpOwogICAgY29uc3Qgc2VyaWFsaXplZCA9IHsKICAgICAgYW5ub3RhdGlvblR5cGU6IEFubm90YXRpb25FZGl0b3JUeXBlLkhJR0hMSUdIVCwKICAgICAgY29sb3IsCiAgICAgIG9wYWNpdHk6IHRoaXMuI29wYWNpdHksCiAgICAgIHRoaWNrbmVzczogdGhpcy4jdGhpY2tuZXNzLAogICAgICBxdWFkUG9pbnRzOiB0aGlzLiNzZXJpYWxpemVCb3hlcygpLAogICAgICBvdXRsaW5lczogdGhpcy4jc2VyaWFsaXplT3V0bGluZXMocmVjdCksCiAgICAgIHBhZ2VJbmRleDogdGhpcy5wYWdlSW5kZXgsCiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uOiB0aGlzLiNnZXRSb3RhdGlvbigpLAogICAgICBzdHJ1Y3RUcmVlUGFyZW50SWQ6IHRoaXMuX3N0cnVjdFRyZWVQYXJlbnRJZAogICAgfTsKICAgIGlmICh0aGlzLmFubm90YXRpb25FbGVtZW50SWQgJiYgIXRoaXMuI2hhc0VsZW1lbnRDaGFuZ2VkKHNlcmlhbGl6ZWQpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgc2VyaWFsaXplZC5pZCA9IHRoaXMuYW5ub3RhdGlvbkVsZW1lbnRJZDsKICAgIHJldHVybiBzZXJpYWxpemVkOwogIH0KICAjaGFzRWxlbWVudENoYW5nZWQoc2VyaWFsaXplZCkgewogICAgY29uc3QgewogICAgICBjb2xvcgogICAgfSA9IHRoaXMuX2luaXRpYWxEYXRhOwogICAgcmV0dXJuIHNlcmlhbGl6ZWQuY29sb3Iuc29tZSgoYywgaSkgPT4gYyAhPT0gY29sb3JbaV0pOwogIH0KICByZW5kZXJBbm5vdGF0aW9uRWxlbWVudChhbm5vdGF0aW9uKSB7CiAgICBhbm5vdGF0aW9uLnVwZGF0ZUVkaXRlZCh7CiAgICAgIHJlY3Q6IHRoaXMuZ2V0UmVjdCgwLCAwKQogICAgfSk7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgc3RhdGljIGNhbkNyZWF0ZU5ld0VtcHR5RWRpdG9yKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvZWRpdG9yL2RyYXcuanMKCgoKY2xhc3MgRHJhd2luZ09wdGlvbnMgewogICNzdmdQcm9wZXJ0aWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB1cGRhdGVQcm9wZXJ0eShuYW1lLCB2YWx1ZSkgewogICAgdGhpc1tuYW1lXSA9IHZhbHVlOwogICAgdGhpcy51cGRhdGVTVkdQcm9wZXJ0eShuYW1lLCB2YWx1ZSk7CiAgfQogIHVwZGF0ZVByb3BlcnRpZXMocHJvcGVydGllcykgewogICAgaWYgKCFwcm9wZXJ0aWVzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhwcm9wZXJ0aWVzKSkgewogICAgICBpZiAoIW5hbWUuc3RhcnRzV2l0aCgiXyIpKSB7CiAgICAgICAgdGhpcy51cGRhdGVQcm9wZXJ0eShuYW1lLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KICB9CiAgdXBkYXRlU1ZHUHJvcGVydHkobmFtZSwgdmFsdWUpIHsKICAgIHRoaXMuI3N2Z1Byb3BlcnRpZXNbbmFtZV0gPSB2YWx1ZTsKICB9CiAgdG9TVkdQcm9wZXJ0aWVzKCkgewogICAgY29uc3Qgcm9vdCA9IHRoaXMuI3N2Z1Byb3BlcnRpZXM7CiAgICB0aGlzLiNzdmdQcm9wZXJ0aWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHJldHVybiB7CiAgICAgIHJvb3QKICAgIH07CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy4jc3ZnUHJvcGVydGllcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgfQogIHVwZGF0ZUFsbChvcHRpb25zID0gdGhpcykgewogICAgdGhpcy51cGRhdGVQcm9wZXJ0aWVzKG9wdGlvbnMpOwogIH0KICBjbG9uZSgpIHsKICAgIHVucmVhY2hhYmxlKCJOb3QgaW1wbGVtZW50ZWQiKTsKICB9Cn0KY2xhc3MgRHJhd2luZ0VkaXRvciBleHRlbmRzIEFubm90YXRpb25FZGl0b3IgewogICNkcmF3T3V0bGluZXMgPSBudWxsOwogICNtdXN0QmVDb21taXR0ZWQ7CiAgX2RyYXdJZCA9IG51bGw7CiAgc3RhdGljIF9jdXJyZW50RHJhd0lkID0gLTE7CiAgc3RhdGljIF9jdXJyZW50UGFyZW50ID0gbnVsbDsKICBzdGF0aWMgI2N1cnJlbnREcmF3ID0gbnVsbDsKICBzdGF0aWMgI2N1cnJlbnREcmF3aW5nQUMgPSBudWxsOwogIHN0YXRpYyAjY3VycmVudERyYXdpbmdPcHRpb25zID0gbnVsbDsKICBzdGF0aWMgI2N1cnJlbnRQb2ludGVySWQgPSBOYU47CiAgc3RhdGljICNjdXJyZW50UG9pbnRlclR5cGUgPSBudWxsOwogIHN0YXRpYyAjY3VycmVudFBvaW50ZXJJZHMgPSBudWxsOwogIHN0YXRpYyAjY3VycmVudE1vdmVUaW1lc3RhbXAgPSBOYU47CiAgc3RhdGljIF9JTk5FUl9NQVJHSU4gPSAzOwogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuI211c3RCZUNvbW1pdHRlZCA9IHBhcmFtcy5tdXN0QmVDb21taXR0ZWQgfHwgZmFsc2U7CiAgICB0aGlzLl9hZGRPdXRsaW5lcyhwYXJhbXMpOwogIH0KICBfYWRkT3V0bGluZXMocGFyYW1zKSB7CiAgICBpZiAocGFyYW1zLmRyYXdPdXRsaW5lcykgewogICAgICB0aGlzLiNjcmVhdGVEcmF3T3V0bGluZXMocGFyYW1zKTsKICAgICAgdGhpcy4jYWRkVG9EcmF3TGF5ZXIoKTsKICAgIH0KICB9CiAgI2NyZWF0ZURyYXdPdXRsaW5lcyh7CiAgICBkcmF3T3V0bGluZXMsCiAgICBkcmF3SWQsCiAgICBkcmF3aW5nT3B0aW9ucwogIH0pIHsKICAgIHRoaXMuI2RyYXdPdXRsaW5lcyA9IGRyYXdPdXRsaW5lczsKICAgIHRoaXMuX2RyYXdpbmdPcHRpb25zIHx8PSBkcmF3aW5nT3B0aW9uczsKICAgIGlmIChkcmF3SWQgPj0gMCkgewogICAgICB0aGlzLl9kcmF3SWQgPSBkcmF3SWQ7CiAgICAgIHRoaXMucGFyZW50LmRyYXdMYXllci5maW5hbGl6ZURyYXcoZHJhd0lkLCBkcmF3T3V0bGluZXMuZGVmYXVsdFByb3BlcnRpZXMpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fZHJhd0lkID0gdGhpcy4jY3JlYXRlRHJhd2luZyhkcmF3T3V0bGluZXMsIHRoaXMucGFyZW50KTsKICAgIH0KICAgIHRoaXMuI3VwZGF0ZUJib3goZHJhd091dGxpbmVzLmJveCk7CiAgfQogICNjcmVhdGVEcmF3aW5nKGRyYXdPdXRsaW5lcywgcGFyZW50KSB7CiAgICBjb25zdCB7CiAgICAgIGlkCiAgICB9ID0gcGFyZW50LmRyYXdMYXllci5kcmF3KERyYXdpbmdFZGl0b3IuX21lcmdlU1ZHUHJvcGVydGllcyh0aGlzLl9kcmF3aW5nT3B0aW9ucy50b1NWR1Byb3BlcnRpZXMoKSwgZHJhd091dGxpbmVzLmRlZmF1bHRTVkdQcm9wZXJ0aWVzKSwgZmFsc2UsIGZhbHNlKTsKICAgIHJldHVybiBpZDsKICB9CiAgc3RhdGljIF9tZXJnZVNWR1Byb3BlcnRpZXMocDEsIHAyKSB7CiAgICBjb25zdCBwMUtleXMgPSBuZXcgU2V0KE9iamVjdC5rZXlzKHAxKSk7CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhwMikpIHsKICAgICAgaWYgKHAxS2V5cy5oYXMoa2V5KSkgewogICAgICAgIE9iamVjdC5hc3NpZ24ocDFba2V5XSwgdmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHAxW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHAxOwogIH0KICBzdGF0aWMgZ2V0RGVmYXVsdERyYXdpbmdPcHRpb25zKF9vcHRpb25zKSB7CiAgICB1bnJlYWNoYWJsZSgiTm90IGltcGxlbWVudGVkIik7CiAgfQogIHN0YXRpYyBnZXQgdHlwZXNNYXAoKSB7CiAgICB1bnJlYWNoYWJsZSgiTm90IGltcGxlbWVudGVkIik7CiAgfQogIHN0YXRpYyBnZXQgaXNEcmF3ZXIoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgc3RhdGljIGdldCBzdXBwb3J0TXVsdGlwbGVEcmF3aW5ncygpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgc3RhdGljIHVwZGF0ZURlZmF1bHRQYXJhbXModHlwZSwgdmFsdWUpIHsKICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHRoaXMudHlwZXNNYXAuZ2V0KHR5cGUpOwogICAgaWYgKHByb3BlcnR5TmFtZSkgewogICAgICB0aGlzLl9kZWZhdWx0RHJhd2luZ09wdGlvbnMudXBkYXRlUHJvcGVydHkocHJvcGVydHlOYW1lLCB2YWx1ZSk7CiAgICB9CiAgICBpZiAodGhpcy5fY3VycmVudFBhcmVudCkgewogICAgICBEcmF3aW5nRWRpdG9yLiNjdXJyZW50RHJhdy51cGRhdGVQcm9wZXJ0eShwcm9wZXJ0eU5hbWUsIHZhbHVlKTsKICAgICAgdGhpcy5fY3VycmVudFBhcmVudC5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLl9jdXJyZW50RHJhd0lkLCB0aGlzLl9kZWZhdWx0RHJhd2luZ09wdGlvbnMudG9TVkdQcm9wZXJ0aWVzKCkpOwogICAgfQogIH0KICB1cGRhdGVQYXJhbXModHlwZSwgdmFsdWUpIHsKICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHRoaXMuY29uc3RydWN0b3IudHlwZXNNYXAuZ2V0KHR5cGUpOwogICAgaWYgKHByb3BlcnR5TmFtZSkgewogICAgICB0aGlzLl91cGRhdGVQcm9wZXJ0eSh0eXBlLCBwcm9wZXJ0eU5hbWUsIHZhbHVlKTsKICAgIH0KICB9CiAgc3RhdGljIGdldCBkZWZhdWx0UHJvcGVydGllc1RvVXBkYXRlKCkgewogICAgY29uc3QgcHJvcGVydGllcyA9IFtdOwogICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuX2RlZmF1bHREcmF3aW5nT3B0aW9uczsKICAgIGZvciAoY29uc3QgW3R5cGUsIG5hbWVdIG9mIHRoaXMudHlwZXNNYXApIHsKICAgICAgcHJvcGVydGllcy5wdXNoKFt0eXBlLCBvcHRpb25zW25hbWVdXSk7CiAgICB9CiAgICByZXR1cm4gcHJvcGVydGllczsKICB9CiAgZ2V0IHByb3BlcnRpZXNUb1VwZGF0ZSgpIHsKICAgIGNvbnN0IHByb3BlcnRpZXMgPSBbXTsKICAgIGNvbnN0IHsKICAgICAgX2RyYXdpbmdPcHRpb25zCiAgICB9ID0gdGhpczsKICAgIGZvciAoY29uc3QgW3R5cGUsIG5hbWVdIG9mIHRoaXMuY29uc3RydWN0b3IudHlwZXNNYXApIHsKICAgICAgcHJvcGVydGllcy5wdXNoKFt0eXBlLCBfZHJhd2luZ09wdGlvbnNbbmFtZV1dKTsKICAgIH0KICAgIHJldHVybiBwcm9wZXJ0aWVzOwogIH0KICBfdXBkYXRlUHJvcGVydHkodHlwZSwgbmFtZSwgdmFsdWUpIHsKICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLl9kcmF3aW5nT3B0aW9uczsKICAgIGNvbnN0IHNhdmVkVmFsdWUgPSBvcHRpb25zW25hbWVdOwogICAgY29uc3Qgc2V0dGVyID0gdmFsID0+IHsKICAgICAgb3B0aW9ucy51cGRhdGVQcm9wZXJ0eShuYW1lLCB2YWwpOwogICAgICBjb25zdCBiYm94ID0gdGhpcy4jZHJhd091dGxpbmVzLnVwZGF0ZVByb3BlcnR5KG5hbWUsIHZhbCk7CiAgICAgIGlmIChiYm94KSB7CiAgICAgICAgdGhpcy4jdXBkYXRlQmJveChiYm94KTsKICAgICAgfQogICAgICB0aGlzLnBhcmVudD8uZHJhd0xheWVyLnVwZGF0ZVByb3BlcnRpZXModGhpcy5fZHJhd0lkLCBvcHRpb25zLnRvU1ZHUHJvcGVydGllcygpKTsKICAgIH07CiAgICB0aGlzLmFkZENvbW1hbmRzKHsKICAgICAgY21kOiBzZXR0ZXIuYmluZCh0aGlzLCB2YWx1ZSksCiAgICAgIHVuZG86IHNldHRlci5iaW5kKHRoaXMsIHNhdmVkVmFsdWUpLAogICAgICBwb3N0OiB0aGlzLl91aU1hbmFnZXIudXBkYXRlVUkuYmluZCh0aGlzLl91aU1hbmFnZXIsIHRoaXMpLAogICAgICBtdXN0RXhlYzogdHJ1ZSwKICAgICAgdHlwZSwKICAgICAgb3ZlcndyaXRlSWZTYW1lVHlwZTogdHJ1ZSwKICAgICAga2VlcFVuZG86IHRydWUKICAgIH0pOwogIH0KICBfb25SZXNpemluZygpIHsKICAgIHRoaXMucGFyZW50Py5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLl9kcmF3SWQsIERyYXdpbmdFZGl0b3IuX21lcmdlU1ZHUHJvcGVydGllcyh0aGlzLiNkcmF3T3V0bGluZXMuZ2V0UGF0aFJlc2l6aW5nU1ZHUHJvcGVydGllcyh0aGlzLiNjb252ZXJ0VG9EcmF3U3BhY2UoKSksIHsKICAgICAgYmJveDogdGhpcy4jcm90YXRlQm94KCkKICAgIH0pKTsKICB9CiAgX29uUmVzaXplZCgpIHsKICAgIHRoaXMucGFyZW50Py5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLl9kcmF3SWQsIERyYXdpbmdFZGl0b3IuX21lcmdlU1ZHUHJvcGVydGllcyh0aGlzLiNkcmF3T3V0bGluZXMuZ2V0UGF0aFJlc2l6ZWRTVkdQcm9wZXJ0aWVzKHRoaXMuI2NvbnZlcnRUb0RyYXdTcGFjZSgpKSwgewogICAgICBiYm94OiB0aGlzLiNyb3RhdGVCb3goKQogICAgfSkpOwogIH0KICBfb25UcmFuc2xhdGluZyhfeCwgX3kpIHsKICAgIHRoaXMucGFyZW50Py5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLl9kcmF3SWQsIHsKICAgICAgYmJveDogdGhpcy4jcm90YXRlQm94KCkKICAgIH0pOwogIH0KICBfb25UcmFuc2xhdGVkKCkgewogICAgdGhpcy5wYXJlbnQ/LmRyYXdMYXllci51cGRhdGVQcm9wZXJ0aWVzKHRoaXMuX2RyYXdJZCwgRHJhd2luZ0VkaXRvci5fbWVyZ2VTVkdQcm9wZXJ0aWVzKHRoaXMuI2RyYXdPdXRsaW5lcy5nZXRQYXRoVHJhbnNsYXRlZFNWR1Byb3BlcnRpZXModGhpcy4jY29udmVydFRvRHJhd1NwYWNlKCksIHRoaXMucGFyZW50RGltZW5zaW9ucyksIHsKICAgICAgYmJveDogdGhpcy4jcm90YXRlQm94KCkKICAgIH0pKTsKICB9CiAgX29uU3RhcnREcmFnZ2luZygpIHsKICAgIHRoaXMucGFyZW50Py5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLl9kcmF3SWQsIHsKICAgICAgcm9vdENsYXNzOiB7CiAgICAgICAgbW92aW5nOiB0cnVlCiAgICAgIH0KICAgIH0pOwogIH0KICBfb25TdG9wRHJhZ2dpbmcoKSB7CiAgICB0aGlzLnBhcmVudD8uZHJhd0xheWVyLnVwZGF0ZVByb3BlcnRpZXModGhpcy5fZHJhd0lkLCB7CiAgICAgIHJvb3RDbGFzczogewogICAgICAgIG1vdmluZzogZmFsc2UKICAgICAgfQogICAgfSk7CiAgfQogIGNvbW1pdCgpIHsKICAgIHN1cGVyLmNvbW1pdCgpOwogICAgdGhpcy5kaXNhYmxlRWRpdE1vZGUoKTsKICAgIHRoaXMuZGlzYWJsZUVkaXRpbmcoKTsKICB9CiAgZGlzYWJsZUVkaXRpbmcoKSB7CiAgICBzdXBlci5kaXNhYmxlRWRpdGluZygpOwogICAgdGhpcy5kaXYuY2xhc3NMaXN0LnRvZ2dsZSgiZGlzYWJsZWQiLCB0cnVlKTsKICB9CiAgZW5hYmxlRWRpdGluZygpIHsKICAgIHN1cGVyLmVuYWJsZUVkaXRpbmcoKTsKICAgIHRoaXMuZGl2LmNsYXNzTGlzdC50b2dnbGUoImRpc2FibGVkIiwgZmFsc2UpOwogIH0KICBnZXRCYXNlVHJhbnNsYXRpb24oKSB7CiAgICByZXR1cm4gWzAsIDBdOwogIH0KICBnZXQgaXNSZXNpemFibGUoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgb25jZUFkZGVkKGZvY3VzKSB7CiAgICBpZiAoIXRoaXMuYW5ub3RhdGlvbkVsZW1lbnRJZCkgewogICAgICB0aGlzLnBhcmVudC5hZGRVbmRvYWJsZUVkaXRvcih0aGlzKTsKICAgIH0KICAgIHRoaXMuX2lzRHJhZ2dhYmxlID0gdHJ1ZTsKICAgIGlmICh0aGlzLiNtdXN0QmVDb21taXR0ZWQpIHsKICAgICAgdGhpcy4jbXVzdEJlQ29tbWl0dGVkID0gZmFsc2U7CiAgICAgIHRoaXMuY29tbWl0KCk7CiAgICAgIHRoaXMucGFyZW50LnNldFNlbGVjdGVkKHRoaXMpOwogICAgICBpZiAoZm9jdXMgJiYgdGhpcy5pc09uU2NyZWVuKSB7CiAgICAgICAgdGhpcy5kaXYuZm9jdXMoKTsKICAgICAgfQogICAgfQogIH0KICByZW1vdmUoKSB7CiAgICB0aGlzLiNjbGVhbkRyYXdMYXllcigpOwogICAgc3VwZXIucmVtb3ZlKCk7CiAgfQogIHJlYnVpbGQoKSB7CiAgICBpZiAoIXRoaXMucGFyZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN1cGVyLnJlYnVpbGQoKTsKICAgIGlmICh0aGlzLmRpdiA9PT0gbnVsbCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNhZGRUb0RyYXdMYXllcigpOwogICAgdGhpcy4jdXBkYXRlQmJveCh0aGlzLiNkcmF3T3V0bGluZXMuYm94KTsKICAgIGlmICghdGhpcy5pc0F0dGFjaGVkVG9ET00pIHsKICAgICAgdGhpcy5wYXJlbnQuYWRkKHRoaXMpOwogICAgfQogIH0KICBzZXRQYXJlbnQocGFyZW50KSB7CiAgICBsZXQgbXVzdEJlU2VsZWN0ZWQgPSBmYWxzZTsKICAgIGlmICh0aGlzLnBhcmVudCAmJiAhcGFyZW50KSB7CiAgICAgIHRoaXMuX3VpTWFuYWdlci5yZW1vdmVTaG91bGRSZXNjYWxlKHRoaXMpOwogICAgICB0aGlzLiNjbGVhbkRyYXdMYXllcigpOwogICAgfSBlbHNlIGlmIChwYXJlbnQpIHsKICAgICAgdGhpcy5fdWlNYW5hZ2VyLmFkZFNob3VsZFJlc2NhbGUodGhpcyk7CiAgICAgIHRoaXMuI2FkZFRvRHJhd0xheWVyKHBhcmVudCk7CiAgICAgIG11c3RCZVNlbGVjdGVkID0gIXRoaXMucGFyZW50ICYmIHRoaXMuZGl2Py5jbGFzc0xpc3QuY29udGFpbnMoInNlbGVjdGVkRWRpdG9yIik7CiAgICB9CiAgICBzdXBlci5zZXRQYXJlbnQocGFyZW50KTsKICAgIGlmIChtdXN0QmVTZWxlY3RlZCkgewogICAgICB0aGlzLnNlbGVjdCgpOwogICAgfQogIH0KICAjY2xlYW5EcmF3TGF5ZXIoKSB7CiAgICBpZiAodGhpcy5fZHJhd0lkID09PSBudWxsIHx8ICF0aGlzLnBhcmVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnBhcmVudC5kcmF3TGF5ZXIucmVtb3ZlKHRoaXMuX2RyYXdJZCk7CiAgICB0aGlzLl9kcmF3SWQgPSBudWxsOwogICAgdGhpcy5fZHJhd2luZ09wdGlvbnMucmVzZXQoKTsKICB9CiAgI2FkZFRvRHJhd0xheWVyKHBhcmVudCA9IHRoaXMucGFyZW50KSB7CiAgICBpZiAodGhpcy5fZHJhd0lkICE9PSBudWxsICYmIHRoaXMucGFyZW50ID09PSBwYXJlbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX2RyYXdJZCAhPT0gbnVsbCkgewogICAgICB0aGlzLnBhcmVudC5kcmF3TGF5ZXIudXBkYXRlUGFyZW50KHRoaXMuX2RyYXdJZCwgcGFyZW50LmRyYXdMYXllcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2RyYXdpbmdPcHRpb25zLnVwZGF0ZUFsbCgpOwogICAgdGhpcy5fZHJhd0lkID0gdGhpcy4jY3JlYXRlRHJhd2luZyh0aGlzLiNkcmF3T3V0bGluZXMsIHBhcmVudCk7CiAgfQogICNjb252ZXJ0VG9QYXJlbnRTcGFjZShbeCwgeSwgd2lkdGgsIGhlaWdodF0pIHsKICAgIGNvbnN0IHsKICAgICAgcGFyZW50RGltZW5zaW9uczogW3BXLCBwSF0sCiAgICAgIHJvdGF0aW9uCiAgICB9ID0gdGhpczsKICAgIHN3aXRjaCAocm90YXRpb24pIHsKICAgICAgY2FzZSA5MDoKICAgICAgICByZXR1cm4gW3ksIDEgLSB4LCB3aWR0aCAqIChwSCAvIHBXKSwgaGVpZ2h0ICogKHBXIC8gcEgpXTsKICAgICAgY2FzZSAxODA6CiAgICAgICAgcmV0dXJuIFsxIC0geCwgMSAtIHksIHdpZHRoLCBoZWlnaHRdOwogICAgICBjYXNlIDI3MDoKICAgICAgICByZXR1cm4gWzEgLSB5LCB4LCB3aWR0aCAqIChwSCAvIHBXKSwgaGVpZ2h0ICogKHBXIC8gcEgpXTsKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gW3gsIHksIHdpZHRoLCBoZWlnaHRdOwogICAgfQogIH0KICAjY29udmVydFRvRHJhd1NwYWNlKCkgewogICAgY29uc3QgewogICAgICB4LAogICAgICB5LAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBwYXJlbnREaW1lbnNpb25zOiBbcFcsIHBIXSwKICAgICAgcm90YXRpb24KICAgIH0gPSB0aGlzOwogICAgc3dpdGNoIChyb3RhdGlvbikgewogICAgICBjYXNlIDkwOgogICAgICAgIHJldHVybiBbMSAtIHksIHgsIHdpZHRoICogKHBXIC8gcEgpLCBoZWlnaHQgKiAocEggLyBwVyldOwogICAgICBjYXNlIDE4MDoKICAgICAgICByZXR1cm4gWzEgLSB4LCAxIC0geSwgd2lkdGgsIGhlaWdodF07CiAgICAgIGNhc2UgMjcwOgogICAgICAgIHJldHVybiBbeSwgMSAtIHgsIHdpZHRoICogKHBXIC8gcEgpLCBoZWlnaHQgKiAocEggLyBwVyldOwogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiBbeCwgeSwgd2lkdGgsIGhlaWdodF07CiAgICB9CiAgfQogICN1cGRhdGVCYm94KGJib3gpIHsKICAgIFt0aGlzLngsIHRoaXMueSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHRdID0gdGhpcy4jY29udmVydFRvUGFyZW50U3BhY2UoYmJveCk7CiAgICBpZiAodGhpcy5kaXYpIHsKICAgICAgdGhpcy5maXhBbmRTZXRQb3NpdGlvbigpOwogICAgICBjb25zdCBbcGFyZW50V2lkdGgsIHBhcmVudEhlaWdodF0gPSB0aGlzLnBhcmVudERpbWVuc2lvbnM7CiAgICAgIHRoaXMuc2V0RGltcyh0aGlzLndpZHRoICogcGFyZW50V2lkdGgsIHRoaXMuaGVpZ2h0ICogcGFyZW50SGVpZ2h0KTsKICAgIH0KICAgIHRoaXMuX29uUmVzaXplZCgpOwogIH0KICAjcm90YXRlQm94KCkgewogICAgY29uc3QgewogICAgICB4LAogICAgICB5LAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICByb3RhdGlvbiwKICAgICAgcGFyZW50Um90YXRpb24sCiAgICAgIHBhcmVudERpbWVuc2lvbnM6IFtwVywgcEhdCiAgICB9ID0gdGhpczsKICAgIHN3aXRjaCAoKHJvdGF0aW9uICogNCArIHBhcmVudFJvdGF0aW9uKSAvIDkwKSB7CiAgICAgIGNhc2UgMToKICAgICAgICByZXR1cm4gWzEgLSB5IC0gaGVpZ2h0LCB4LCBoZWlnaHQsIHdpZHRoXTsKICAgICAgY2FzZSAyOgogICAgICAgIHJldHVybiBbMSAtIHggLSB3aWR0aCwgMSAtIHkgLSBoZWlnaHQsIHdpZHRoLCBoZWlnaHRdOwogICAgICBjYXNlIDM6CiAgICAgICAgcmV0dXJuIFt5LCAxIC0geCAtIHdpZHRoLCBoZWlnaHQsIHdpZHRoXTsKICAgICAgY2FzZSA0OgogICAgICAgIHJldHVybiBbeCwgeSAtIHdpZHRoICogKHBXIC8gcEgpLCBoZWlnaHQgKiAocEggLyBwVyksIHdpZHRoICogKHBXIC8gcEgpXTsKICAgICAgY2FzZSA1OgogICAgICAgIHJldHVybiBbMSAtIHksIHgsIHdpZHRoICogKHBXIC8gcEgpLCBoZWlnaHQgKiAocEggLyBwVyldOwogICAgICBjYXNlIDY6CiAgICAgICAgcmV0dXJuIFsxIC0geCAtIGhlaWdodCAqIChwSCAvIHBXKSwgMSAtIHksIGhlaWdodCAqIChwSCAvIHBXKSwgd2lkdGggKiAocFcgLyBwSCldOwogICAgICBjYXNlIDc6CiAgICAgICAgcmV0dXJuIFt5IC0gd2lkdGggKiAocFcgLyBwSCksIDEgLSB4IC0gaGVpZ2h0ICogKHBIIC8gcFcpLCB3aWR0aCAqIChwVyAvIHBIKSwgaGVpZ2h0ICogKHBIIC8gcFcpXTsKICAgICAgY2FzZSA4OgogICAgICAgIHJldHVybiBbeCAtIHdpZHRoLCB5IC0gaGVpZ2h0LCB3aWR0aCwgaGVpZ2h0XTsKICAgICAgY2FzZSA5OgogICAgICAgIHJldHVybiBbMSAtIHksIHggLSB3aWR0aCwgaGVpZ2h0LCB3aWR0aF07CiAgICAgIGNhc2UgMTA6CiAgICAgICAgcmV0dXJuIFsxIC0geCwgMSAtIHksIHdpZHRoLCBoZWlnaHRdOwogICAgICBjYXNlIDExOgogICAgICAgIHJldHVybiBbeSAtIGhlaWdodCwgMSAtIHgsIGhlaWdodCwgd2lkdGhdOwogICAgICBjYXNlIDEyOgogICAgICAgIHJldHVybiBbeCAtIGhlaWdodCAqIChwSCAvIHBXKSwgeSwgaGVpZ2h0ICogKHBIIC8gcFcpLCB3aWR0aCAqIChwVyAvIHBIKV07CiAgICAgIGNhc2UgMTM6CiAgICAgICAgcmV0dXJuIFsxIC0geSAtIHdpZHRoICogKHBXIC8gcEgpLCB4IC0gaGVpZ2h0ICogKHBIIC8gcFcpLCB3aWR0aCAqIChwVyAvIHBIKSwgaGVpZ2h0ICogKHBIIC8gcFcpXTsKICAgICAgY2FzZSAxNDoKICAgICAgICByZXR1cm4gWzEgLSB4LCAxIC0geSAtIHdpZHRoICogKHBXIC8gcEgpLCBoZWlnaHQgKiAocEggLyBwVyksIHdpZHRoICogKHBXIC8gcEgpXTsKICAgICAgY2FzZSAxNToKICAgICAgICByZXR1cm4gW3ksIDEgLSB4LCB3aWR0aCAqIChwVyAvIHBIKSwgaGVpZ2h0ICogKHBIIC8gcFcpXTsKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gW3gsIHksIHdpZHRoLCBoZWlnaHRdOwogICAgfQogIH0KICByb3RhdGUoKSB7CiAgICBpZiAoIXRoaXMucGFyZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMucGFyZW50LmRyYXdMYXllci51cGRhdGVQcm9wZXJ0aWVzKHRoaXMuX2RyYXdJZCwgRHJhd2luZ0VkaXRvci5fbWVyZ2VTVkdQcm9wZXJ0aWVzKHsKICAgICAgYmJveDogdGhpcy4jcm90YXRlQm94KCkKICAgIH0sIHRoaXMuI2RyYXdPdXRsaW5lcy51cGRhdGVSb3RhdGlvbigodGhpcy5wYXJlbnRSb3RhdGlvbiAtIHRoaXMucm90YXRpb24gKyAzNjApICUgMzYwKSkpOwogIH0KICBvblNjYWxlQ2hhbmdpbmcoKSB7CiAgICBpZiAoIXRoaXMucGFyZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI3VwZGF0ZUJib3godGhpcy4jZHJhd091dGxpbmVzLnVwZGF0ZVBhcmVudERpbWVuc2lvbnModGhpcy5wYXJlbnREaW1lbnNpb25zLCB0aGlzLnBhcmVudC5zY2FsZSkpOwogIH0KICBzdGF0aWMgb25TY2FsZUNoYW5naW5nV2hlbkRyYXdpbmcoKSB7fQogIHJlbmRlcigpIHsKICAgIGlmICh0aGlzLmRpdikgewogICAgICByZXR1cm4gdGhpcy5kaXY7CiAgICB9CiAgICBsZXQgYmFzZVgsIGJhc2VZOwogICAgaWYgKHRoaXMuX2lzQ29weSkgewogICAgICBiYXNlWCA9IHRoaXMueDsKICAgICAgYmFzZVkgPSB0aGlzLnk7CiAgICB9CiAgICBjb25zdCBkaXYgPSBzdXBlci5yZW5kZXIoKTsKICAgIGRpdi5jbGFzc0xpc3QuYWRkKCJkcmF3Iik7CiAgICBjb25zdCBkcmF3RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBkaXYuYXBwZW5kKGRyYXdEaXYpOwogICAgZHJhd0Rpdi5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgInRydWUiKTsKICAgIGRyYXdEaXYuY2xhc3NOYW1lID0gImludGVybmFsIjsKICAgIGNvbnN0IFtwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0XSA9IHRoaXMucGFyZW50RGltZW5zaW9uczsKICAgIHRoaXMuc2V0RGltcyh0aGlzLndpZHRoICogcGFyZW50V2lkdGgsIHRoaXMuaGVpZ2h0ICogcGFyZW50SGVpZ2h0KTsKICAgIHRoaXMuX3VpTWFuYWdlci5hZGRTaG91bGRSZXNjYWxlKHRoaXMpOwogICAgdGhpcy5kaXNhYmxlRWRpdGluZygpOwogICAgaWYgKHRoaXMuX2lzQ29weSkgewogICAgICB0aGlzLl9tb3ZlQWZ0ZXJQYXN0ZShiYXNlWCwgYmFzZVkpOwogICAgfQogICAgcmV0dXJuIGRpdjsKICB9CiAgc3RhdGljIGNyZWF0ZURyYXdlckluc3RhbmNlKF94LCBfeSwgX3BhcmVudFdpZHRoLCBfcGFyZW50SGVpZ2h0LCBfcm90YXRpb24pIHsKICAgIHVucmVhY2hhYmxlKCJOb3QgaW1wbGVtZW50ZWQiKTsKICB9CiAgc3RhdGljIHN0YXJ0RHJhd2luZyhwYXJlbnQsIHVpTWFuYWdlciwgX2lzTFRSLCBldmVudCkgewogICAgY29uc3QgewogICAgICB0YXJnZXQsCiAgICAgIG9mZnNldFg6IHgsCiAgICAgIG9mZnNldFk6IHksCiAgICAgIHBvaW50ZXJJZCwKICAgICAgcG9pbnRlclR5cGUKICAgIH0gPSBldmVudDsKICAgIGlmIChEcmF3aW5nRWRpdG9yLiNjdXJyZW50UG9pbnRlclR5cGUgJiYgRHJhd2luZ0VkaXRvci4jY3VycmVudFBvaW50ZXJUeXBlICE9PSBwb2ludGVyVHlwZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHZpZXdwb3J0OiB7CiAgICAgICAgcm90YXRpb24KICAgICAgfQogICAgfSA9IHBhcmVudDsKICAgIGNvbnN0IHsKICAgICAgd2lkdGg6IHBhcmVudFdpZHRoLAogICAgICBoZWlnaHQ6IHBhcmVudEhlaWdodAogICAgfSA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGNvbnN0IGFjID0gRHJhd2luZ0VkaXRvci4jY3VycmVudERyYXdpbmdBQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGNvbnN0IHNpZ25hbCA9IHBhcmVudC5jb21iaW5lZFNpZ25hbChhYyk7CiAgICBEcmF3aW5nRWRpdG9yLiNjdXJyZW50UG9pbnRlcklkIHx8PSBwb2ludGVySWQ7CiAgICBEcmF3aW5nRWRpdG9yLiNjdXJyZW50UG9pbnRlclR5cGUgPz89IHBvaW50ZXJUeXBlOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIGUgPT4gewogICAgICBpZiAoRHJhd2luZ0VkaXRvci4jY3VycmVudFBvaW50ZXJJZCA9PT0gZS5wb2ludGVySWQpIHsKICAgICAgICB0aGlzLl9lbmREcmF3KGUpOwogICAgICB9IGVsc2UgewogICAgICAgIERyYXdpbmdFZGl0b3IuI2N1cnJlbnRQb2ludGVySWRzPy5kZWxldGUoZS5wb2ludGVySWQpOwogICAgICB9CiAgICB9LCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmNhbmNlbCIsIGUgPT4gewogICAgICBpZiAoRHJhd2luZ0VkaXRvci4jY3VycmVudFBvaW50ZXJJZCA9PT0gZS5wb2ludGVySWQpIHsKICAgICAgICB0aGlzLl9jdXJyZW50UGFyZW50LmVuZERyYXdpbmdTZXNzaW9uKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgRHJhd2luZ0VkaXRvci4jY3VycmVudFBvaW50ZXJJZHM/LmRlbGV0ZShlLnBvaW50ZXJJZCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIGUgPT4gewogICAgICBpZiAoRHJhd2luZ0VkaXRvci4jY3VycmVudFBvaW50ZXJUeXBlICE9PSBlLnBvaW50ZXJUeXBlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIChEcmF3aW5nRWRpdG9yLiNjdXJyZW50UG9pbnRlcklkcyB8fD0gbmV3IFNldCgpKS5hZGQoZS5wb2ludGVySWQpOwogICAgICBpZiAoRHJhd2luZ0VkaXRvci4jY3VycmVudERyYXcuaXNDYW5jZWxsYWJsZSgpKSB7CiAgICAgICAgRHJhd2luZ0VkaXRvci4jY3VycmVudERyYXcucmVtb3ZlTGFzdEVsZW1lbnQoKTsKICAgICAgICBpZiAoRHJhd2luZ0VkaXRvci4jY3VycmVudERyYXcuaXNFbXB0eSgpKSB7CiAgICAgICAgICB0aGlzLl9jdXJyZW50UGFyZW50LmVuZERyYXdpbmdTZXNzaW9uKHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLl9lbmREcmF3KG51bGwpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBjYXB0dXJlOiB0cnVlLAogICAgICBwYXNzaXZlOiBmYWxzZSwKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJjb250ZXh0bWVudSIsIG5vQ29udGV4dE1lbnUsIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIHRoaXMuX2RyYXdNb3ZlLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaG1vdmUiLCBlID0+IHsKICAgICAgaWYgKGUudGltZVN0YW1wID09PSBEcmF3aW5nRWRpdG9yLiNjdXJyZW50TW92ZVRpbWVzdGFtcCkgewogICAgICAgIHN0b3BFdmVudChlKTsKICAgICAgfQogICAgfSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgcGFyZW50LnRvZ2dsZURyYXdpbmcoKTsKICAgIHVpTWFuYWdlci5fZWRpdG9yVW5kb0Jhcj8uaGlkZSgpOwogICAgaWYgKERyYXdpbmdFZGl0b3IuI2N1cnJlbnREcmF3KSB7CiAgICAgIHBhcmVudC5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyh0aGlzLl9jdXJyZW50RHJhd0lkLCBEcmF3aW5nRWRpdG9yLiNjdXJyZW50RHJhdy5zdGFydE5ldyh4LCB5LCBwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0LCByb3RhdGlvbikpOwogICAgICByZXR1cm47CiAgICB9CiAgICB1aU1hbmFnZXIudXBkYXRlVUlGb3JEZWZhdWx0UHJvcGVydGllcyh0aGlzKTsKICAgIERyYXdpbmdFZGl0b3IuI2N1cnJlbnREcmF3ID0gdGhpcy5jcmVhdGVEcmF3ZXJJbnN0YW5jZSh4LCB5LCBwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0LCByb3RhdGlvbik7CiAgICBEcmF3aW5nRWRpdG9yLiNjdXJyZW50RHJhd2luZ09wdGlvbnMgPSB0aGlzLmdldERlZmF1bHREcmF3aW5nT3B0aW9ucygpOwogICAgdGhpcy5fY3VycmVudFBhcmVudCA9IHBhcmVudDsKICAgICh7CiAgICAgIGlkOiB0aGlzLl9jdXJyZW50RHJhd0lkCiAgICB9ID0gcGFyZW50LmRyYXdMYXllci5kcmF3KHRoaXMuX21lcmdlU1ZHUHJvcGVydGllcyhEcmF3aW5nRWRpdG9yLiNjdXJyZW50RHJhd2luZ09wdGlvbnMudG9TVkdQcm9wZXJ0aWVzKCksIERyYXdpbmdFZGl0b3IuI2N1cnJlbnREcmF3LmRlZmF1bHRTVkdQcm9wZXJ0aWVzKSwgdHJ1ZSwgZmFsc2UpKTsKICB9CiAgc3RhdGljIF9kcmF3TW92ZShldmVudCkgewogICAgRHJhd2luZ0VkaXRvci4jY3VycmVudE1vdmVUaW1lc3RhbXAgPSAtMTsKICAgIGlmICghRHJhd2luZ0VkaXRvci4jY3VycmVudERyYXcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgewogICAgICBvZmZzZXRYLAogICAgICBvZmZzZXRZLAogICAgICBwb2ludGVySWQKICAgIH0gPSBldmVudDsKICAgIGlmIChEcmF3aW5nRWRpdG9yLiNjdXJyZW50UG9pbnRlcklkICE9PSBwb2ludGVySWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKERyYXdpbmdFZGl0b3IuI2N1cnJlbnRQb2ludGVySWRzPy5zaXplID49IDEpIHsKICAgICAgdGhpcy5fZW5kRHJhdyhldmVudCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2N1cnJlbnRQYXJlbnQuZHJhd0xheWVyLnVwZGF0ZVByb3BlcnRpZXModGhpcy5fY3VycmVudERyYXdJZCwgRHJhd2luZ0VkaXRvci4jY3VycmVudERyYXcuYWRkKG9mZnNldFgsIG9mZnNldFkpKTsKICAgIERyYXdpbmdFZGl0b3IuI2N1cnJlbnRNb3ZlVGltZXN0YW1wID0gZXZlbnQudGltZVN0YW1wOwogICAgc3RvcEV2ZW50KGV2ZW50KTsKICB9CiAgc3RhdGljIF9jbGVhbnVwKGFsbCkgewogICAgaWYgKGFsbCkgewogICAgICB0aGlzLl9jdXJyZW50RHJhd0lkID0gLTE7CiAgICAgIHRoaXMuX2N1cnJlbnRQYXJlbnQgPSBudWxsOwogICAgICBEcmF3aW5nRWRpdG9yLiNjdXJyZW50RHJhdyA9IG51bGw7CiAgICAgIERyYXdpbmdFZGl0b3IuI2N1cnJlbnREcmF3aW5nT3B0aW9ucyA9IG51bGw7CiAgICAgIERyYXdpbmdFZGl0b3IuI2N1cnJlbnRQb2ludGVyVHlwZSA9IG51bGw7CiAgICAgIERyYXdpbmdFZGl0b3IuI2N1cnJlbnRNb3ZlVGltZXN0YW1wID0gTmFOOwogICAgfQogICAgaWYgKERyYXdpbmdFZGl0b3IuI2N1cnJlbnREcmF3aW5nQUMpIHsKICAgICAgRHJhd2luZ0VkaXRvci4jY3VycmVudERyYXdpbmdBQy5hYm9ydCgpOwogICAgICBEcmF3aW5nRWRpdG9yLiNjdXJyZW50RHJhd2luZ0FDID0gbnVsbDsKICAgICAgRHJhd2luZ0VkaXRvci4jY3VycmVudFBvaW50ZXJJZCA9IE5hTjsKICAgICAgRHJhd2luZ0VkaXRvci4jY3VycmVudFBvaW50ZXJJZHMgPSBudWxsOwogICAgfQogIH0KICBzdGF0aWMgX2VuZERyYXcoZXZlbnQpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuX2N1cnJlbnRQYXJlbnQ7CiAgICBpZiAoIXBhcmVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBwYXJlbnQudG9nZ2xlRHJhd2luZyh0cnVlKTsKICAgIHRoaXMuX2NsZWFudXAoZmFsc2UpOwogICAgaWYgKGV2ZW50Py50YXJnZXQgPT09IHBhcmVudC5kaXYpIHsKICAgICAgcGFyZW50LmRyYXdMYXllci51cGRhdGVQcm9wZXJ0aWVzKHRoaXMuX2N1cnJlbnREcmF3SWQsIERyYXdpbmdFZGl0b3IuI2N1cnJlbnREcmF3LmVuZChldmVudC5vZmZzZXRYLCBldmVudC5vZmZzZXRZKSk7CiAgICB9CiAgICBpZiAodGhpcy5zdXBwb3J0TXVsdGlwbGVEcmF3aW5ncykgewogICAgICBjb25zdCBkcmF3ID0gRHJhd2luZ0VkaXRvci4jY3VycmVudERyYXc7CiAgICAgIGNvbnN0IGRyYXdJZCA9IHRoaXMuX2N1cnJlbnREcmF3SWQ7CiAgICAgIGNvbnN0IGxhc3RFbGVtZW50ID0gZHJhdy5nZXRMYXN0RWxlbWVudCgpOwogICAgICBwYXJlbnQuYWRkQ29tbWFuZHMoewogICAgICAgIGNtZDogKCkgPT4gewogICAgICAgICAgcGFyZW50LmRyYXdMYXllci51cGRhdGVQcm9wZXJ0aWVzKGRyYXdJZCwgZHJhdy5zZXRMYXN0RWxlbWVudChsYXN0RWxlbWVudCkpOwogICAgICAgIH0sCiAgICAgICAgdW5kbzogKCkgPT4gewogICAgICAgICAgcGFyZW50LmRyYXdMYXllci51cGRhdGVQcm9wZXJ0aWVzKGRyYXdJZCwgZHJhdy5yZW1vdmVMYXN0RWxlbWVudCgpKTsKICAgICAgICB9LAogICAgICAgIG11c3RFeGVjOiBmYWxzZSwKICAgICAgICB0eXBlOiBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5EUkFXX1NURVAKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZW5kRHJhd2luZyhmYWxzZSk7CiAgfQogIHN0YXRpYyBlbmREcmF3aW5nKGlzQWJvcnRlZCkgewogICAgY29uc3QgcGFyZW50ID0gdGhpcy5fY3VycmVudFBhcmVudDsKICAgIGlmICghcGFyZW50KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcGFyZW50LnRvZ2dsZURyYXdpbmcodHJ1ZSk7CiAgICBwYXJlbnQuY2xlYW5VbmRvU3RhY2soQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuRFJBV19TVEVQKTsKICAgIGlmICghRHJhd2luZ0VkaXRvci4jY3VycmVudERyYXcuaXNFbXB0eSgpKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBwYWdlRGltZW5zaW9uczogW3BhZ2VXaWR0aCwgcGFnZUhlaWdodF0sCiAgICAgICAgc2NhbGUKICAgICAgfSA9IHBhcmVudDsKICAgICAgY29uc3QgZWRpdG9yID0gcGFyZW50LmNyZWF0ZUFuZEFkZE5ld0VkaXRvcih7CiAgICAgICAgb2Zmc2V0WDogMCwKICAgICAgICBvZmZzZXRZOiAwCiAgICAgIH0sIGZhbHNlLCB7CiAgICAgICAgZHJhd0lkOiB0aGlzLl9jdXJyZW50RHJhd0lkLAogICAgICAgIGRyYXdPdXRsaW5lczogRHJhd2luZ0VkaXRvci4jY3VycmVudERyYXcuZ2V0T3V0bGluZXMocGFnZVdpZHRoICogc2NhbGUsIHBhZ2VIZWlnaHQgKiBzY2FsZSwgc2NhbGUsIHRoaXMuX0lOTkVSX01BUkdJTiksCiAgICAgICAgZHJhd2luZ09wdGlvbnM6IERyYXdpbmdFZGl0b3IuI2N1cnJlbnREcmF3aW5nT3B0aW9ucywKICAgICAgICBtdXN0QmVDb21taXR0ZWQ6ICFpc0Fib3J0ZWQKICAgICAgfSk7CiAgICAgIHRoaXMuX2NsZWFudXAodHJ1ZSk7CiAgICAgIHJldHVybiBlZGl0b3I7CiAgICB9CiAgICBwYXJlbnQuZHJhd0xheWVyLnJlbW92ZSh0aGlzLl9jdXJyZW50RHJhd0lkKTsKICAgIHRoaXMuX2NsZWFudXAodHJ1ZSk7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY3JlYXRlRHJhd2luZ09wdGlvbnMoX2RhdGEpIHt9CiAgc3RhdGljIGRlc2VyaWFsaXplRHJhdyhfcGFnZVgsIF9wYWdlWSwgX3BhZ2VXaWR0aCwgX3BhZ2VIZWlnaHQsIF9pbm5lcldpZHRoLCBfZGF0YSkgewogICAgdW5yZWFjaGFibGUoIk5vdCBpbXBsZW1lbnRlZCIpOwogIH0KICBzdGF0aWMgYXN5bmMgZGVzZXJpYWxpemUoZGF0YSwgcGFyZW50LCB1aU1hbmFnZXIpIHsKICAgIGNvbnN0IHsKICAgICAgcmF3RGltczogewogICAgICAgIHBhZ2VXaWR0aCwKICAgICAgICBwYWdlSGVpZ2h0LAogICAgICAgIHBhZ2VYLAogICAgICAgIHBhZ2VZCiAgICAgIH0KICAgIH0gPSBwYXJlbnQudmlld3BvcnQ7CiAgICBjb25zdCBkcmF3T3V0bGluZXMgPSB0aGlzLmRlc2VyaWFsaXplRHJhdyhwYWdlWCwgcGFnZVksIHBhZ2VXaWR0aCwgcGFnZUhlaWdodCwgdGhpcy5fSU5ORVJfTUFSR0lOLCBkYXRhKTsKICAgIGNvbnN0IGVkaXRvciA9IGF3YWl0IHN1cGVyLmRlc2VyaWFsaXplKGRhdGEsIHBhcmVudCwgdWlNYW5hZ2VyKTsKICAgIGVkaXRvci5jcmVhdGVEcmF3aW5nT3B0aW9ucyhkYXRhKTsKICAgIGVkaXRvci4jY3JlYXRlRHJhd091dGxpbmVzKHsKICAgICAgZHJhd091dGxpbmVzCiAgICB9KTsKICAgIGVkaXRvci4jYWRkVG9EcmF3TGF5ZXIoKTsKICAgIGVkaXRvci5vblNjYWxlQ2hhbmdpbmcoKTsKICAgIGVkaXRvci5yb3RhdGUoKTsKICAgIHJldHVybiBlZGl0b3I7CiAgfQogIHNlcmlhbGl6ZURyYXcoaXNGb3JDb3B5aW5nKSB7CiAgICBjb25zdCBbcGFnZVgsIHBhZ2VZXSA9IHRoaXMucGFnZVRyYW5zbGF0aW9uOwogICAgY29uc3QgW3BhZ2VXaWR0aCwgcGFnZUhlaWdodF0gPSB0aGlzLnBhZ2VEaW1lbnNpb25zOwogICAgcmV0dXJuIHRoaXMuI2RyYXdPdXRsaW5lcy5zZXJpYWxpemUoW3BhZ2VYLCBwYWdlWSwgcGFnZVdpZHRoLCBwYWdlSGVpZ2h0XSwgaXNGb3JDb3B5aW5nKTsKICB9CiAgcmVuZGVyQW5ub3RhdGlvbkVsZW1lbnQoYW5ub3RhdGlvbikgewogICAgYW5ub3RhdGlvbi51cGRhdGVFZGl0ZWQoewogICAgICByZWN0OiB0aGlzLmdldFJlY3QoMCwgMCkKICAgIH0pOwogICAgcmV0dXJuIG51bGw7CiAgfQogIHN0YXRpYyBjYW5DcmVhdGVOZXdFbXB0eUVkaXRvcigpIHsKICAgIHJldHVybiBmYWxzZTsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L2VkaXRvci9kcmF3ZXJzL2lua2RyYXcuanMKCgpjbGFzcyBJbmtEcmF3T3V0bGluZXIgewogICNsYXN0ID0gbmV3IEZsb2F0NjRBcnJheSg2KTsKICAjbGluZTsKICAjbGluZXM7CiAgI3JvdGF0aW9uOwogICN0aGlja25lc3M7CiAgI3BvaW50czsKICAjbGFzdFNWR1BhdGggPSAiIjsKICAjbGFzdEluZGV4ID0gMDsKICAjb3V0bGluZXMgPSBuZXcgSW5rRHJhd091dGxpbmUoKTsKICAjcGFyZW50V2lkdGg7CiAgI3BhcmVudEhlaWdodDsKICBjb25zdHJ1Y3Rvcih4LCB5LCBwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0LCByb3RhdGlvbiwgdGhpY2tuZXNzKSB7CiAgICB0aGlzLiNwYXJlbnRXaWR0aCA9IHBhcmVudFdpZHRoOwogICAgdGhpcy4jcGFyZW50SGVpZ2h0ID0gcGFyZW50SGVpZ2h0OwogICAgdGhpcy4jcm90YXRpb24gPSByb3RhdGlvbjsKICAgIHRoaXMuI3RoaWNrbmVzcyA9IHRoaWNrbmVzczsKICAgIFt4LCB5XSA9IHRoaXMuI25vcm1hbGl6ZVBvaW50KHgsIHkpOwogICAgY29uc3QgbGluZSA9IHRoaXMuI2xpbmUgPSBbTmFOLCBOYU4sIE5hTiwgTmFOLCB4LCB5XTsKICAgIHRoaXMuI3BvaW50cyA9IFt4LCB5XTsKICAgIHRoaXMuI2xpbmVzID0gW3sKICAgICAgbGluZSwKICAgICAgcG9pbnRzOiB0aGlzLiNwb2ludHMKICAgIH1dOwogICAgdGhpcy4jbGFzdC5zZXQobGluZSwgMCk7CiAgfQogIHVwZGF0ZVByb3BlcnR5KG5hbWUsIHZhbHVlKSB7CiAgICBpZiAobmFtZSA9PT0gInN0cm9rZS13aWR0aCIpIHsKICAgICAgdGhpcy4jdGhpY2tuZXNzID0gdmFsdWU7CiAgICB9CiAgfQogICNub3JtYWxpemVQb2ludCh4LCB5KSB7CiAgICByZXR1cm4gT3V0bGluZS5fbm9ybWFsaXplUG9pbnQoeCwgeSwgdGhpcy4jcGFyZW50V2lkdGgsIHRoaXMuI3BhcmVudEhlaWdodCwgdGhpcy4jcm90YXRpb24pOwogIH0KICBpc0VtcHR5KCkgewogICAgcmV0dXJuICF0aGlzLiNsaW5lcyB8fCB0aGlzLiNsaW5lcy5sZW5ndGggPT09IDA7CiAgfQogIGlzQ2FuY2VsbGFibGUoKSB7CiAgICByZXR1cm4gdGhpcy4jcG9pbnRzLmxlbmd0aCA8PSAxMDsKICB9CiAgYWRkKHgsIHkpIHsKICAgIFt4LCB5XSA9IHRoaXMuI25vcm1hbGl6ZVBvaW50KHgsIHkpOwogICAgY29uc3QgW3gxLCB5MSwgeDIsIHkyXSA9IHRoaXMuI2xhc3Quc3ViYXJyYXkoMiwgNik7CiAgICBjb25zdCBkaWZmWCA9IHggLSB4MjsKICAgIGNvbnN0IGRpZmZZID0geSAtIHkyOwogICAgY29uc3QgZCA9IE1hdGguaHlwb3QodGhpcy4jcGFyZW50V2lkdGggKiBkaWZmWCwgdGhpcy4jcGFyZW50SGVpZ2h0ICogZGlmZlkpOwogICAgaWYgKGQgPD0gMikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHRoaXMuI3BvaW50cy5wdXNoKHgsIHkpOwogICAgaWYgKGlzTmFOKHgxKSkgewogICAgICB0aGlzLiNsYXN0LnNldChbeDIsIHkyLCB4LCB5XSwgMik7CiAgICAgIHRoaXMuI2xpbmUucHVzaChOYU4sIE5hTiwgTmFOLCBOYU4sIHgsIHkpOwogICAgICByZXR1cm4gewogICAgICAgIHBhdGg6IHsKICAgICAgICAgIGQ6IHRoaXMudG9TVkdQYXRoKCkKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICBpZiAoaXNOYU4odGhpcy4jbGFzdFswXSkpIHsKICAgICAgdGhpcy4jbGluZS5zcGxpY2UoNiwgNik7CiAgICB9CiAgICB0aGlzLiNsYXN0LnNldChbeDEsIHkxLCB4MiwgeTIsIHgsIHldLCAwKTsKICAgIHRoaXMuI2xpbmUucHVzaCguLi5PdXRsaW5lLmNyZWF0ZUJlemllclBvaW50cyh4MSwgeTEsIHgyLCB5MiwgeCwgeSkpOwogICAgcmV0dXJuIHsKICAgICAgcGF0aDogewogICAgICAgIGQ6IHRoaXMudG9TVkdQYXRoKCkKICAgICAgfQogICAgfTsKICB9CiAgZW5kKHgsIHkpIHsKICAgIGNvbnN0IGNoYW5nZSA9IHRoaXMuYWRkKHgsIHkpOwogICAgaWYgKGNoYW5nZSkgewogICAgICByZXR1cm4gY2hhbmdlOwogICAgfQogICAgaWYgKHRoaXMuI3BvaW50cy5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBwYXRoOiB7CiAgICAgICAgICBkOiB0aGlzLnRvU1ZHUGF0aCgpCiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIHN0YXJ0TmV3KHgsIHksIHBhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHQsIHJvdGF0aW9uKSB7CiAgICB0aGlzLiNwYXJlbnRXaWR0aCA9IHBhcmVudFdpZHRoOwogICAgdGhpcy4jcGFyZW50SGVpZ2h0ID0gcGFyZW50SGVpZ2h0OwogICAgdGhpcy4jcm90YXRpb24gPSByb3RhdGlvbjsKICAgIFt4LCB5XSA9IHRoaXMuI25vcm1hbGl6ZVBvaW50KHgsIHkpOwogICAgY29uc3QgbGluZSA9IHRoaXMuI2xpbmUgPSBbTmFOLCBOYU4sIE5hTiwgTmFOLCB4LCB5XTsKICAgIHRoaXMuI3BvaW50cyA9IFt4LCB5XTsKICAgIGNvbnN0IGxhc3QgPSB0aGlzLiNsaW5lcy5hdCgtMSk7CiAgICBpZiAobGFzdCkgewogICAgICBsYXN0LmxpbmUgPSBuZXcgRmxvYXQzMkFycmF5KGxhc3QubGluZSk7CiAgICAgIGxhc3QucG9pbnRzID0gbmV3IEZsb2F0MzJBcnJheShsYXN0LnBvaW50cyk7CiAgICB9CiAgICB0aGlzLiNsaW5lcy5wdXNoKHsKICAgICAgbGluZSwKICAgICAgcG9pbnRzOiB0aGlzLiNwb2ludHMKICAgIH0pOwogICAgdGhpcy4jbGFzdC5zZXQobGluZSwgMCk7CiAgICB0aGlzLiNsYXN0SW5kZXggPSAwOwogICAgdGhpcy50b1NWR1BhdGgoKTsKICAgIHJldHVybiBudWxsOwogIH0KICBnZXRMYXN0RWxlbWVudCgpIHsKICAgIHJldHVybiB0aGlzLiNsaW5lcy5hdCgtMSk7CiAgfQogIHNldExhc3RFbGVtZW50KGVsZW1lbnQpIHsKICAgIGlmICghdGhpcy4jbGluZXMpIHsKICAgICAgcmV0dXJuIHRoaXMuI291dGxpbmVzLnNldExhc3RFbGVtZW50KGVsZW1lbnQpOwogICAgfQogICAgdGhpcy4jbGluZXMucHVzaChlbGVtZW50KTsKICAgIHRoaXMuI2xpbmUgPSBlbGVtZW50LmxpbmU7CiAgICB0aGlzLiNwb2ludHMgPSBlbGVtZW50LnBvaW50czsKICAgIHRoaXMuI2xhc3RJbmRleCA9IDA7CiAgICByZXR1cm4gewogICAgICBwYXRoOiB7CiAgICAgICAgZDogdGhpcy50b1NWR1BhdGgoKQogICAgICB9CiAgICB9OwogIH0KICByZW1vdmVMYXN0RWxlbWVudCgpIHsKICAgIGlmICghdGhpcy4jbGluZXMpIHsKICAgICAgcmV0dXJuIHRoaXMuI291dGxpbmVzLnJlbW92ZUxhc3RFbGVtZW50KCk7CiAgICB9CiAgICB0aGlzLiNsaW5lcy5wb3AoKTsKICAgIHRoaXMuI2xhc3RTVkdQYXRoID0gIiI7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB0aGlzLiNsaW5lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBsaW5lLAogICAgICAgIHBvaW50cwogICAgICB9ID0gdGhpcy4jbGluZXNbaV07CiAgICAgIHRoaXMuI2xpbmUgPSBsaW5lOwogICAgICB0aGlzLiNwb2ludHMgPSBwb2ludHM7CiAgICAgIHRoaXMuI2xhc3RJbmRleCA9IDA7CiAgICAgIHRoaXMudG9TVkdQYXRoKCk7CiAgICB9CiAgICByZXR1cm4gewogICAgICBwYXRoOiB7CiAgICAgICAgZDogdGhpcy4jbGFzdFNWR1BhdGgKICAgICAgfQogICAgfTsKICB9CiAgdG9TVkdQYXRoKCkgewogICAgY29uc3QgZmlyc3RYID0gT3V0bGluZS5zdmdSb3VuZCh0aGlzLiNsaW5lWzRdKTsKICAgIGNvbnN0IGZpcnN0WSA9IE91dGxpbmUuc3ZnUm91bmQodGhpcy4jbGluZVs1XSk7CiAgICBpZiAodGhpcy4jcG9pbnRzLmxlbmd0aCA9PT0gMikgewogICAgICB0aGlzLiNsYXN0U1ZHUGF0aCA9IGAke3RoaXMuI2xhc3RTVkdQYXRofSBNICR7Zmlyc3RYfSAke2ZpcnN0WX0gWmA7CiAgICAgIHJldHVybiB0aGlzLiNsYXN0U1ZHUGF0aDsKICAgIH0KICAgIGlmICh0aGlzLiNwb2ludHMubGVuZ3RoIDw9IDYpIHsKICAgICAgY29uc3QgaSA9IHRoaXMuI2xhc3RTVkdQYXRoLmxhc3RJbmRleE9mKCJNIik7CiAgICAgIHRoaXMuI2xhc3RTVkdQYXRoID0gYCR7dGhpcy4jbGFzdFNWR1BhdGguc2xpY2UoMCwgaSl9IE0gJHtmaXJzdFh9ICR7Zmlyc3RZfWA7CiAgICAgIHRoaXMuI2xhc3RJbmRleCA9IDY7CiAgICB9CiAgICBpZiAodGhpcy4jcG9pbnRzLmxlbmd0aCA9PT0gNCkgewogICAgICBjb25zdCBzZWNvbmRYID0gT3V0bGluZS5zdmdSb3VuZCh0aGlzLiNsaW5lWzEwXSk7CiAgICAgIGNvbnN0IHNlY29uZFkgPSBPdXRsaW5lLnN2Z1JvdW5kKHRoaXMuI2xpbmVbMTFdKTsKICAgICAgdGhpcy4jbGFzdFNWR1BhdGggPSBgJHt0aGlzLiNsYXN0U1ZHUGF0aH0gTCAke3NlY29uZFh9ICR7c2Vjb25kWX1gOwogICAgICB0aGlzLiNsYXN0SW5kZXggPSAxMjsKICAgICAgcmV0dXJuIHRoaXMuI2xhc3RTVkdQYXRoOwogICAgfQogICAgY29uc3QgYnVmZmVyID0gW107CiAgICBpZiAodGhpcy4jbGFzdEluZGV4ID09PSAwKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGBNICR7Zmlyc3RYfSAke2ZpcnN0WX1gKTsKICAgICAgdGhpcy4jbGFzdEluZGV4ID0gNjsKICAgIH0KICAgIGZvciAobGV0IGkgPSB0aGlzLiNsYXN0SW5kZXgsIGlpID0gdGhpcy4jbGluZS5sZW5ndGg7IGkgPCBpaTsgaSArPSA2KSB7CiAgICAgIGNvbnN0IFtjMXgsIGMxeSwgYzJ4LCBjMnksIHgsIHldID0gdGhpcy4jbGluZS5zbGljZShpLCBpICsgNikubWFwKE91dGxpbmUuc3ZnUm91bmQpOwogICAgICBidWZmZXIucHVzaChgQyR7YzF4fSAke2MxeX0gJHtjMnh9ICR7YzJ5fSAke3h9ICR7eX1gKTsKICAgIH0KICAgIHRoaXMuI2xhc3RTVkdQYXRoICs9IGJ1ZmZlci5qb2luKCIgIik7CiAgICB0aGlzLiNsYXN0SW5kZXggPSB0aGlzLiNsaW5lLmxlbmd0aDsKICAgIHJldHVybiB0aGlzLiNsYXN0U1ZHUGF0aDsKICB9CiAgZ2V0T3V0bGluZXMocGFyZW50V2lkdGgsIHBhcmVudEhlaWdodCwgc2NhbGUsIGlubmVyTWFyZ2luKSB7CiAgICBjb25zdCBsYXN0ID0gdGhpcy4jbGluZXMuYXQoLTEpOwogICAgbGFzdC5saW5lID0gbmV3IEZsb2F0MzJBcnJheShsYXN0LmxpbmUpOwogICAgbGFzdC5wb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KGxhc3QucG9pbnRzKTsKICAgIHRoaXMuI291dGxpbmVzLmJ1aWxkKHRoaXMuI2xpbmVzLCBwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0LCBzY2FsZSwgdGhpcy4jcm90YXRpb24sIHRoaXMuI3RoaWNrbmVzcywgaW5uZXJNYXJnaW4pOwogICAgdGhpcy4jbGFzdCA9IG51bGw7CiAgICB0aGlzLiNsaW5lID0gbnVsbDsKICAgIHRoaXMuI2xpbmVzID0gbnVsbDsKICAgIHRoaXMuI2xhc3RTVkdQYXRoID0gbnVsbDsKICAgIHJldHVybiB0aGlzLiNvdXRsaW5lczsKICB9CiAgZ2V0IGRlZmF1bHRTVkdQcm9wZXJ0aWVzKCkgewogICAgcmV0dXJuIHsKICAgICAgcm9vdDogewogICAgICAgIHZpZXdCb3g6ICIwIDAgMTAwMDAgMTAwMDAiCiAgICAgIH0sCiAgICAgIHJvb3RDbGFzczogewogICAgICAgIGRyYXc6IHRydWUKICAgICAgfSwKICAgICAgYmJveDogWzAsIDAsIDEsIDFdCiAgICB9OwogIH0KfQpjbGFzcyBJbmtEcmF3T3V0bGluZSBleHRlbmRzIE91dGxpbmUgewogICNiYm94OwogICNjdXJyZW50Um90YXRpb24gPSAwOwogICNpbm5lck1hcmdpbjsKICAjbGluZXM7CiAgI3BhcmVudFdpZHRoOwogICNwYXJlbnRIZWlnaHQ7CiAgI3BhcmVudFNjYWxlOwogICNyb3RhdGlvbjsKICAjdGhpY2tuZXNzOwogIGJ1aWxkKGxpbmVzLCBwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0LCBwYXJlbnRTY2FsZSwgcm90YXRpb24sIHRoaWNrbmVzcywgaW5uZXJNYXJnaW4pIHsKICAgIHRoaXMuI3BhcmVudFdpZHRoID0gcGFyZW50V2lkdGg7CiAgICB0aGlzLiNwYXJlbnRIZWlnaHQgPSBwYXJlbnRIZWlnaHQ7CiAgICB0aGlzLiNwYXJlbnRTY2FsZSA9IHBhcmVudFNjYWxlOwogICAgdGhpcy4jcm90YXRpb24gPSByb3RhdGlvbjsKICAgIHRoaXMuI3RoaWNrbmVzcyA9IHRoaWNrbmVzczsKICAgIHRoaXMuI2lubmVyTWFyZ2luID0gaW5uZXJNYXJnaW4gPz8gMDsKICAgIHRoaXMuI2xpbmVzID0gbGluZXM7CiAgICB0aGlzLiNjb21wdXRlQmJveCgpOwogIH0KICBnZXQgdGhpY2tuZXNzKCkgewogICAgcmV0dXJuIHRoaXMuI3RoaWNrbmVzczsKICB9CiAgc2V0TGFzdEVsZW1lbnQoZWxlbWVudCkgewogICAgdGhpcy4jbGluZXMucHVzaChlbGVtZW50KTsKICAgIHJldHVybiB7CiAgICAgIHBhdGg6IHsKICAgICAgICBkOiB0aGlzLnRvU1ZHUGF0aCgpCiAgICAgIH0KICAgIH07CiAgfQogIHJlbW92ZUxhc3RFbGVtZW50KCkgewogICAgdGhpcy4jbGluZXMucG9wKCk7CiAgICByZXR1cm4gewogICAgICBwYXRoOiB7CiAgICAgICAgZDogdGhpcy50b1NWR1BhdGgoKQogICAgICB9CiAgICB9OwogIH0KICB0b1NWR1BhdGgoKSB7CiAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgIGZvciAoY29uc3QgewogICAgICBsaW5lCiAgICB9IG9mIHRoaXMuI2xpbmVzKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGBNJHtPdXRsaW5lLnN2Z1JvdW5kKGxpbmVbNF0pfSAke091dGxpbmUuc3ZnUm91bmQobGluZVs1XSl9YCk7CiAgICAgIGlmIChsaW5lLmxlbmd0aCA9PT0gNikgewogICAgICAgIGJ1ZmZlci5wdXNoKCJaIik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGxpbmUubGVuZ3RoID09PSAxMiAmJiBpc05hTihsaW5lWzZdKSkgewogICAgICAgIGJ1ZmZlci5wdXNoKGBMJHtPdXRsaW5lLnN2Z1JvdW5kKGxpbmVbMTBdKX0gJHtPdXRsaW5lLnN2Z1JvdW5kKGxpbmVbMTFdKX1gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGxldCBpID0gNiwgaWkgPSBsaW5lLmxlbmd0aDsgaSA8IGlpOyBpICs9IDYpIHsKICAgICAgICBjb25zdCBbYzF4LCBjMXksIGMyeCwgYzJ5LCB4LCB5XSA9IGxpbmUuc3ViYXJyYXkoaSwgaSArIDYpLm1hcChPdXRsaW5lLnN2Z1JvdW5kKTsKICAgICAgICBidWZmZXIucHVzaChgQyR7YzF4fSAke2MxeX0gJHtjMnh9ICR7YzJ5fSAke3h9ICR7eX1gKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGJ1ZmZlci5qb2luKCIiKTsKICB9CiAgc2VyaWFsaXplKFtwYWdlWCwgcGFnZVksIHBhZ2VXaWR0aCwgcGFnZUhlaWdodF0sIGlzRm9yQ29weWluZykgewogICAgY29uc3Qgc2VyaWFsaXplZExpbmVzID0gW107CiAgICBjb25zdCBzZXJpYWxpemVkUG9pbnRzID0gW107CiAgICBjb25zdCBbeCwgeSwgd2lkdGgsIGhlaWdodF0gPSB0aGlzLiNnZXRCQm94V2l0aE5vTWFyZ2luKCk7CiAgICBsZXQgdHgsIHR5LCBzeCwgc3ksIHgxLCB5MSwgeDIsIHkyLCByZXNjYWxlRm47CiAgICBzd2l0Y2ggKHRoaXMuI3JvdGF0aW9uKSB7CiAgICAgIGNhc2UgMDoKICAgICAgICByZXNjYWxlRm4gPSBPdXRsaW5lLl9yZXNjYWxlOwogICAgICAgIHR4ID0gcGFnZVg7CiAgICAgICAgdHkgPSBwYWdlWSArIHBhZ2VIZWlnaHQ7CiAgICAgICAgc3ggPSBwYWdlV2lkdGg7CiAgICAgICAgc3kgPSAtcGFnZUhlaWdodDsKICAgICAgICB4MSA9IHBhZ2VYICsgeCAqIHBhZ2VXaWR0aDsKICAgICAgICB5MSA9IHBhZ2VZICsgKDEgLSB5IC0gaGVpZ2h0KSAqIHBhZ2VIZWlnaHQ7CiAgICAgICAgeDIgPSBwYWdlWCArICh4ICsgd2lkdGgpICogcGFnZVdpZHRoOwogICAgICAgIHkyID0gcGFnZVkgKyAoMSAtIHkpICogcGFnZUhlaWdodDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSA5MDoKICAgICAgICByZXNjYWxlRm4gPSBPdXRsaW5lLl9yZXNjYWxlQW5kU3dhcDsKICAgICAgICB0eCA9IHBhZ2VYOwogICAgICAgIHR5ID0gcGFnZVk7CiAgICAgICAgc3ggPSBwYWdlV2lkdGg7CiAgICAgICAgc3kgPSBwYWdlSGVpZ2h0OwogICAgICAgIHgxID0gcGFnZVggKyB5ICogcGFnZVdpZHRoOwogICAgICAgIHkxID0gcGFnZVkgKyB4ICogcGFnZUhlaWdodDsKICAgICAgICB4MiA9IHBhZ2VYICsgKHkgKyBoZWlnaHQpICogcGFnZVdpZHRoOwogICAgICAgIHkyID0gcGFnZVkgKyAoeCArIHdpZHRoKSAqIHBhZ2VIZWlnaHQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMTgwOgogICAgICAgIHJlc2NhbGVGbiA9IE91dGxpbmUuX3Jlc2NhbGU7CiAgICAgICAgdHggPSBwYWdlWCArIHBhZ2VXaWR0aDsKICAgICAgICB0eSA9IHBhZ2VZOwogICAgICAgIHN4ID0gLXBhZ2VXaWR0aDsKICAgICAgICBzeSA9IHBhZ2VIZWlnaHQ7CiAgICAgICAgeDEgPSBwYWdlWCArICgxIC0geCAtIHdpZHRoKSAqIHBhZ2VXaWR0aDsKICAgICAgICB5MSA9IHBhZ2VZICsgeSAqIHBhZ2VIZWlnaHQ7CiAgICAgICAgeDIgPSBwYWdlWCArICgxIC0geCkgKiBwYWdlV2lkdGg7CiAgICAgICAgeTIgPSBwYWdlWSArICh5ICsgaGVpZ2h0KSAqIHBhZ2VIZWlnaHQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjcwOgogICAgICAgIHJlc2NhbGVGbiA9IE91dGxpbmUuX3Jlc2NhbGVBbmRTd2FwOwogICAgICAgIHR4ID0gcGFnZVggKyBwYWdlV2lkdGg7CiAgICAgICAgdHkgPSBwYWdlWSArIHBhZ2VIZWlnaHQ7CiAgICAgICAgc3ggPSAtcGFnZVdpZHRoOwogICAgICAgIHN5ID0gLXBhZ2VIZWlnaHQ7CiAgICAgICAgeDEgPSBwYWdlWCArICgxIC0geSAtIGhlaWdodCkgKiBwYWdlV2lkdGg7CiAgICAgICAgeTEgPSBwYWdlWSArICgxIC0geCAtIHdpZHRoKSAqIHBhZ2VIZWlnaHQ7CiAgICAgICAgeDIgPSBwYWdlWCArICgxIC0geSkgKiBwYWdlV2lkdGg7CiAgICAgICAgeTIgPSBwYWdlWSArICgxIC0geCkgKiBwYWdlSGVpZ2h0OwogICAgICAgIGJyZWFrOwogICAgfQogICAgZm9yIChjb25zdCB7CiAgICAgIGxpbmUsCiAgICAgIHBvaW50cwogICAgfSBvZiB0aGlzLiNsaW5lcykgewogICAgICBzZXJpYWxpemVkTGluZXMucHVzaChyZXNjYWxlRm4obGluZSwgdHgsIHR5LCBzeCwgc3ksIGlzRm9yQ29weWluZyA/IG5ldyBBcnJheShsaW5lLmxlbmd0aCkgOiBudWxsKSk7CiAgICAgIHNlcmlhbGl6ZWRQb2ludHMucHVzaChyZXNjYWxlRm4ocG9pbnRzLCB0eCwgdHksIHN4LCBzeSwgaXNGb3JDb3B5aW5nID8gbmV3IEFycmF5KHBvaW50cy5sZW5ndGgpIDogbnVsbCkpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgbGluZXM6IHNlcmlhbGl6ZWRMaW5lcywKICAgICAgcG9pbnRzOiBzZXJpYWxpemVkUG9pbnRzLAogICAgICByZWN0OiBbeDEsIHkxLCB4MiwgeTJdCiAgICB9OwogIH0KICBzdGF0aWMgZGVzZXJpYWxpemUocGFnZVgsIHBhZ2VZLCBwYWdlV2lkdGgsIHBhZ2VIZWlnaHQsIGlubmVyTWFyZ2luLCB7CiAgICBwYXRoczogewogICAgICBsaW5lcywKICAgICAgcG9pbnRzCiAgICB9LAogICAgcm90YXRpb24sCiAgICB0aGlja25lc3MKICB9KSB7CiAgICBjb25zdCBuZXdMaW5lcyA9IFtdOwogICAgbGV0IHR4LCB0eSwgc3gsIHN5LCByZXNjYWxlRm47CiAgICBzd2l0Y2ggKHJvdGF0aW9uKSB7CiAgICAgIGNhc2UgMDoKICAgICAgICByZXNjYWxlRm4gPSBPdXRsaW5lLl9yZXNjYWxlOwogICAgICAgIHR4ID0gLXBhZ2VYIC8gcGFnZVdpZHRoOwogICAgICAgIHR5ID0gcGFnZVkgLyBwYWdlSGVpZ2h0ICsgMTsKICAgICAgICBzeCA9IDEgLyBwYWdlV2lkdGg7CiAgICAgICAgc3kgPSAtMSAvIHBhZ2VIZWlnaHQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgOTA6CiAgICAgICAgcmVzY2FsZUZuID0gT3V0bGluZS5fcmVzY2FsZUFuZFN3YXA7CiAgICAgICAgdHggPSAtcGFnZVkgLyBwYWdlSGVpZ2h0OwogICAgICAgIHR5ID0gLXBhZ2VYIC8gcGFnZVdpZHRoOwogICAgICAgIHN4ID0gMSAvIHBhZ2VIZWlnaHQ7CiAgICAgICAgc3kgPSAxIC8gcGFnZVdpZHRoOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDE4MDoKICAgICAgICByZXNjYWxlRm4gPSBPdXRsaW5lLl9yZXNjYWxlOwogICAgICAgIHR4ID0gcGFnZVggLyBwYWdlV2lkdGggKyAxOwogICAgICAgIHR5ID0gLXBhZ2VZIC8gcGFnZUhlaWdodDsKICAgICAgICBzeCA9IC0xIC8gcGFnZVdpZHRoOwogICAgICAgIHN5ID0gMSAvIHBhZ2VIZWlnaHQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjcwOgogICAgICAgIHJlc2NhbGVGbiA9IE91dGxpbmUuX3Jlc2NhbGVBbmRTd2FwOwogICAgICAgIHR4ID0gcGFnZVkgLyBwYWdlSGVpZ2h0ICsgMTsKICAgICAgICB0eSA9IHBhZ2VYIC8gcGFnZVdpZHRoICsgMTsKICAgICAgICBzeCA9IC0xIC8gcGFnZUhlaWdodDsKICAgICAgICBzeSA9IC0xIC8gcGFnZVdpZHRoOwogICAgICAgIGJyZWFrOwogICAgfQogICAgaWYgKCFsaW5lcykgewogICAgICBsaW5lcyA9IFtdOwogICAgICBmb3IgKGNvbnN0IHBvaW50IG9mIHBvaW50cykgewogICAgICAgIGNvbnN0IGxlbiA9IHBvaW50Lmxlbmd0aDsKICAgICAgICBpZiAobGVuID09PSAyKSB7CiAgICAgICAgICBsaW5lcy5wdXNoKG5ldyBGbG9hdDMyQXJyYXkoW05hTiwgTmFOLCBOYU4sIE5hTiwgcG9pbnRbMF0sIHBvaW50WzFdXSkpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gPT09IDQpIHsKICAgICAgICAgIGxpbmVzLnB1c2gobmV3IEZsb2F0MzJBcnJheShbTmFOLCBOYU4sIE5hTiwgTmFOLCBwb2ludFswXSwgcG9pbnRbMV0sIE5hTiwgTmFOLCBOYU4sIE5hTiwgcG9pbnRbMl0sIHBvaW50WzNdXSkpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGxpbmUgPSBuZXcgRmxvYXQzMkFycmF5KDMgKiAobGVuIC0gMikpOwogICAgICAgIGxpbmVzLnB1c2gobGluZSk7CiAgICAgICAgbGV0IFt4MSwgeTEsIHgyLCB5Ml0gPSBwb2ludC5zdWJhcnJheSgwLCA0KTsKICAgICAgICBsaW5lLnNldChbTmFOLCBOYU4sIE5hTiwgTmFOLCB4MSwgeTFdLCAwKTsKICAgICAgICBmb3IgKGxldCBpID0gNDsgaSA8IGxlbjsgaSArPSAyKSB7CiAgICAgICAgICBjb25zdCB4ID0gcG9pbnRbaV07CiAgICAgICAgICBjb25zdCB5ID0gcG9pbnRbaSArIDFdOwogICAgICAgICAgbGluZS5zZXQoT3V0bGluZS5jcmVhdGVCZXppZXJQb2ludHMoeDEsIHkxLCB4MiwgeTIsIHgsIHkpLCAoaSAtIDIpICogMyk7CiAgICAgICAgICBbeDEsIHkxLCB4MiwgeTJdID0gW3gyLCB5MiwgeCwgeV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBsaW5lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIG5ld0xpbmVzLnB1c2goewogICAgICAgIGxpbmU6IHJlc2NhbGVGbihsaW5lc1tpXS5tYXAoeCA9PiB4ID8/IE5hTiksIHR4LCB0eSwgc3gsIHN5KSwKICAgICAgICBwb2ludHM6IHJlc2NhbGVGbihwb2ludHNbaV0ubWFwKHggPT4geCA/PyBOYU4pLCB0eCwgdHksIHN4LCBzeSkKICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBvdXRsaW5lcyA9IG5ldyB0aGlzLnByb3RvdHlwZS5jb25zdHJ1Y3RvcigpOwogICAgb3V0bGluZXMuYnVpbGQobmV3TGluZXMsIHBhZ2VXaWR0aCwgcGFnZUhlaWdodCwgMSwgcm90YXRpb24sIHRoaWNrbmVzcywgaW5uZXJNYXJnaW4pOwogICAgcmV0dXJuIG91dGxpbmVzOwogIH0KICAjZ2V0TWFyZ2luQ29tcG9uZW50cyh0aGlja25lc3MgPSB0aGlzLiN0aGlja25lc3MpIHsKICAgIGNvbnN0IG1hcmdpbiA9IHRoaXMuI2lubmVyTWFyZ2luICsgdGhpY2tuZXNzIC8gMiAqIHRoaXMuI3BhcmVudFNjYWxlOwogICAgcmV0dXJuIHRoaXMuI3JvdGF0aW9uICUgMTgwID09PSAwID8gW21hcmdpbiAvIHRoaXMuI3BhcmVudFdpZHRoLCBtYXJnaW4gLyB0aGlzLiNwYXJlbnRIZWlnaHRdIDogW21hcmdpbiAvIHRoaXMuI3BhcmVudEhlaWdodCwgbWFyZ2luIC8gdGhpcy4jcGFyZW50V2lkdGhdOwogIH0KICAjZ2V0QkJveFdpdGhOb01hcmdpbigpIHsKICAgIGNvbnN0IFt4LCB5LCB3aWR0aCwgaGVpZ2h0XSA9IHRoaXMuI2Jib3g7CiAgICBjb25zdCBbbWFyZ2luWCwgbWFyZ2luWV0gPSB0aGlzLiNnZXRNYXJnaW5Db21wb25lbnRzKDApOwogICAgcmV0dXJuIFt4ICsgbWFyZ2luWCwgeSArIG1hcmdpblksIHdpZHRoIC0gMiAqIG1hcmdpblgsIGhlaWdodCAtIDIgKiBtYXJnaW5ZXTsKICB9CiAgI2NvbXB1dGVCYm94KCkgewogICAgY29uc3QgYmJveCA9IHRoaXMuI2Jib3ggPSBuZXcgRmxvYXQzMkFycmF5KFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XSk7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgbGluZQogICAgfSBvZiB0aGlzLiNsaW5lcykgewogICAgICBpZiAobGluZS5sZW5ndGggPD0gMTIpIHsKICAgICAgICBmb3IgKGxldCBpID0gNCwgaWkgPSBsaW5lLmxlbmd0aDsgaSA8IGlpOyBpICs9IDYpIHsKICAgICAgICAgIFV0aWwucG9pbnRCb3VuZGluZ0JveChsaW5lW2ldLCBsaW5lW2kgKyAxXSwgYmJveCk7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxldCBsYXN0WCA9IGxpbmVbNF0sCiAgICAgICAgbGFzdFkgPSBsaW5lWzVdOwogICAgICBmb3IgKGxldCBpID0gNiwgaWkgPSBsaW5lLmxlbmd0aDsgaSA8IGlpOyBpICs9IDYpIHsKICAgICAgICBjb25zdCBbYzF4LCBjMXksIGMyeCwgYzJ5LCB4LCB5XSA9IGxpbmUuc3ViYXJyYXkoaSwgaSArIDYpOwogICAgICAgIFV0aWwuYmV6aWVyQm91bmRpbmdCb3gobGFzdFgsIGxhc3RZLCBjMXgsIGMxeSwgYzJ4LCBjMnksIHgsIHksIGJib3gpOwogICAgICAgIGxhc3RYID0geDsKICAgICAgICBsYXN0WSA9IHk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IFttYXJnaW5YLCBtYXJnaW5ZXSA9IHRoaXMuI2dldE1hcmdpbkNvbXBvbmVudHMoKTsKICAgIGJib3hbMF0gPSBNYXRoQ2xhbXAoYmJveFswXSAtIG1hcmdpblgsIDAsIDEpOwogICAgYmJveFsxXSA9IE1hdGhDbGFtcChiYm94WzFdIC0gbWFyZ2luWSwgMCwgMSk7CiAgICBiYm94WzJdID0gTWF0aENsYW1wKGJib3hbMl0gKyBtYXJnaW5YLCAwLCAxKTsKICAgIGJib3hbM10gPSBNYXRoQ2xhbXAoYmJveFszXSArIG1hcmdpblksIDAsIDEpOwogICAgYmJveFsyXSAtPSBiYm94WzBdOwogICAgYmJveFszXSAtPSBiYm94WzFdOwogIH0KICBnZXQgYm94KCkgewogICAgcmV0dXJuIHRoaXMuI2Jib3g7CiAgfQogIHVwZGF0ZVByb3BlcnR5KG5hbWUsIHZhbHVlKSB7CiAgICBpZiAobmFtZSA9PT0gInN0cm9rZS13aWR0aCIpIHsKICAgICAgcmV0dXJuIHRoaXMuI3VwZGF0ZVRoaWNrbmVzcyh2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgI3VwZGF0ZVRoaWNrbmVzcyh0aGlja25lc3MpIHsKICAgIGNvbnN0IFtvbGRNYXJnaW5YLCBvbGRNYXJnaW5ZXSA9IHRoaXMuI2dldE1hcmdpbkNvbXBvbmVudHMoKTsKICAgIHRoaXMuI3RoaWNrbmVzcyA9IHRoaWNrbmVzczsKICAgIGNvbnN0IFtuZXdNYXJnaW5YLCBuZXdNYXJnaW5ZXSA9IHRoaXMuI2dldE1hcmdpbkNvbXBvbmVudHMoKTsKICAgIGNvbnN0IFtkaWZmTWFyZ2luWCwgZGlmZk1hcmdpblldID0gW25ld01hcmdpblggLSBvbGRNYXJnaW5YLCBuZXdNYXJnaW5ZIC0gb2xkTWFyZ2luWV07CiAgICBjb25zdCBiYm94ID0gdGhpcy4jYmJveDsKICAgIGJib3hbMF0gLT0gZGlmZk1hcmdpblg7CiAgICBiYm94WzFdIC09IGRpZmZNYXJnaW5ZOwogICAgYmJveFsyXSArPSAyICogZGlmZk1hcmdpblg7CiAgICBiYm94WzNdICs9IDIgKiBkaWZmTWFyZ2luWTsKICAgIHJldHVybiBiYm94OwogIH0KICB1cGRhdGVQYXJlbnREaW1lbnNpb25zKFt3aWR0aCwgaGVpZ2h0XSwgc2NhbGUpIHsKICAgIGNvbnN0IFtvbGRNYXJnaW5YLCBvbGRNYXJnaW5ZXSA9IHRoaXMuI2dldE1hcmdpbkNvbXBvbmVudHMoKTsKICAgIHRoaXMuI3BhcmVudFdpZHRoID0gd2lkdGg7CiAgICB0aGlzLiNwYXJlbnRIZWlnaHQgPSBoZWlnaHQ7CiAgICB0aGlzLiNwYXJlbnRTY2FsZSA9IHNjYWxlOwogICAgY29uc3QgW25ld01hcmdpblgsIG5ld01hcmdpblldID0gdGhpcy4jZ2V0TWFyZ2luQ29tcG9uZW50cygpOwogICAgY29uc3QgZGlmZk1hcmdpblggPSBuZXdNYXJnaW5YIC0gb2xkTWFyZ2luWDsKICAgIGNvbnN0IGRpZmZNYXJnaW5ZID0gbmV3TWFyZ2luWSAtIG9sZE1hcmdpblk7CiAgICBjb25zdCBiYm94ID0gdGhpcy4jYmJveDsKICAgIGJib3hbMF0gLT0gZGlmZk1hcmdpblg7CiAgICBiYm94WzFdIC09IGRpZmZNYXJnaW5ZOwogICAgYmJveFsyXSArPSAyICogZGlmZk1hcmdpblg7CiAgICBiYm94WzNdICs9IDIgKiBkaWZmTWFyZ2luWTsKICAgIHJldHVybiBiYm94OwogIH0KICB1cGRhdGVSb3RhdGlvbihyb3RhdGlvbikgewogICAgdGhpcy4jY3VycmVudFJvdGF0aW9uID0gcm90YXRpb247CiAgICByZXR1cm4gewogICAgICBwYXRoOiB7CiAgICAgICAgdHJhbnNmb3JtOiB0aGlzLnJvdGF0aW9uVHJhbnNmb3JtCiAgICAgIH0KICAgIH07CiAgfQogIGdldCB2aWV3Qm94KCkgewogICAgcmV0dXJuIHRoaXMuI2Jib3gubWFwKE91dGxpbmUuc3ZnUm91bmQpLmpvaW4oIiAiKTsKICB9CiAgZ2V0IGRlZmF1bHRQcm9wZXJ0aWVzKCkgewogICAgY29uc3QgW3gsIHldID0gdGhpcy4jYmJveDsKICAgIHJldHVybiB7CiAgICAgIHJvb3Q6IHsKICAgICAgICB2aWV3Qm94OiB0aGlzLnZpZXdCb3gKICAgICAgfSwKICAgICAgcGF0aDogewogICAgICAgICJ0cmFuc2Zvcm0tb3JpZ2luIjogYCR7T3V0bGluZS5zdmdSb3VuZCh4KX0gJHtPdXRsaW5lLnN2Z1JvdW5kKHkpfWAKICAgICAgfQogICAgfTsKICB9CiAgZ2V0IHJvdGF0aW9uVHJhbnNmb3JtKCkgewogICAgY29uc3QgWywsIHdpZHRoLCBoZWlnaHRdID0gdGhpcy4jYmJveDsKICAgIGxldCBhID0gMCwKICAgICAgYiA9IDAsCiAgICAgIGMgPSAwLAogICAgICBkID0gMCwKICAgICAgZSA9IDAsCiAgICAgIGYgPSAwOwogICAgc3dpdGNoICh0aGlzLiNjdXJyZW50Um90YXRpb24pIHsKICAgICAgY2FzZSA5MDoKICAgICAgICBiID0gaGVpZ2h0IC8gd2lkdGg7CiAgICAgICAgYyA9IC13aWR0aCAvIGhlaWdodDsKICAgICAgICBlID0gd2lkdGg7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMTgwOgogICAgICAgIGEgPSAtMTsKICAgICAgICBkID0gLTE7CiAgICAgICAgZSA9IHdpZHRoOwogICAgICAgIGYgPSBoZWlnaHQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjcwOgogICAgICAgIGIgPSAtaGVpZ2h0IC8gd2lkdGg7CiAgICAgICAgYyA9IHdpZHRoIC8gaGVpZ2h0OwogICAgICAgIGYgPSBoZWlnaHQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuICIiOwogICAgfQogICAgcmV0dXJuIGBtYXRyaXgoJHthfSAke2J9ICR7Y30gJHtkfSAke091dGxpbmUuc3ZnUm91bmQoZSl9ICR7T3V0bGluZS5zdmdSb3VuZChmKX0pYDsKICB9CiAgZ2V0UGF0aFJlc2l6aW5nU1ZHUHJvcGVydGllcyhbbmV3WCwgbmV3WSwgbmV3V2lkdGgsIG5ld0hlaWdodF0pIHsKICAgIGNvbnN0IFttYXJnaW5YLCBtYXJnaW5ZXSA9IHRoaXMuI2dldE1hcmdpbkNvbXBvbmVudHMoKTsKICAgIGNvbnN0IFt4LCB5LCB3aWR0aCwgaGVpZ2h0XSA9IHRoaXMuI2Jib3g7CiAgICBpZiAoTWF0aC5hYnMod2lkdGggLSBtYXJnaW5YKSA8PSBPdXRsaW5lLlBSRUNJU0lPTiB8fCBNYXRoLmFicyhoZWlnaHQgLSBtYXJnaW5ZKSA8PSBPdXRsaW5lLlBSRUNJU0lPTikgewogICAgICBjb25zdCB0eCA9IG5ld1ggKyBuZXdXaWR0aCAvIDIgLSAoeCArIHdpZHRoIC8gMik7CiAgICAgIGNvbnN0IHR5ID0gbmV3WSArIG5ld0hlaWdodCAvIDIgLSAoeSArIGhlaWdodCAvIDIpOwogICAgICByZXR1cm4gewogICAgICAgIHBhdGg6IHsKICAgICAgICAgICJ0cmFuc2Zvcm0tb3JpZ2luIjogYCR7T3V0bGluZS5zdmdSb3VuZChuZXdYKX0gJHtPdXRsaW5lLnN2Z1JvdW5kKG5ld1kpfWAsCiAgICAgICAgICB0cmFuc2Zvcm06IGAke3RoaXMucm90YXRpb25UcmFuc2Zvcm19IHRyYW5zbGF0ZSgke3R4fSAke3R5fSlgCiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgY29uc3QgczF4ID0gKG5ld1dpZHRoIC0gMiAqIG1hcmdpblgpIC8gKHdpZHRoIC0gMiAqIG1hcmdpblgpOwogICAgY29uc3QgczF5ID0gKG5ld0hlaWdodCAtIDIgKiBtYXJnaW5ZKSAvIChoZWlnaHQgLSAyICogbWFyZ2luWSk7CiAgICBjb25zdCBzMnggPSB3aWR0aCAvIG5ld1dpZHRoOwogICAgY29uc3QgczJ5ID0gaGVpZ2h0IC8gbmV3SGVpZ2h0OwogICAgcmV0dXJuIHsKICAgICAgcGF0aDogewogICAgICAgICJ0cmFuc2Zvcm0tb3JpZ2luIjogYCR7T3V0bGluZS5zdmdSb3VuZCh4KX0gJHtPdXRsaW5lLnN2Z1JvdW5kKHkpfWAsCiAgICAgICAgdHJhbnNmb3JtOiBgJHt0aGlzLnJvdGF0aW9uVHJhbnNmb3JtfSBzY2FsZSgke3MyeH0gJHtzMnl9KSBgICsgYHRyYW5zbGF0ZSgke091dGxpbmUuc3ZnUm91bmQobWFyZ2luWCl9ICR7T3V0bGluZS5zdmdSb3VuZChtYXJnaW5ZKX0pIHNjYWxlKCR7czF4fSAke3MxeX0pIGAgKyBgdHJhbnNsYXRlKCR7T3V0bGluZS5zdmdSb3VuZCgtbWFyZ2luWCl9ICR7T3V0bGluZS5zdmdSb3VuZCgtbWFyZ2luWSl9KWAKICAgICAgfQogICAgfTsKICB9CiAgZ2V0UGF0aFJlc2l6ZWRTVkdQcm9wZXJ0aWVzKFtuZXdYLCBuZXdZLCBuZXdXaWR0aCwgbmV3SGVpZ2h0XSkgewogICAgY29uc3QgW21hcmdpblgsIG1hcmdpblldID0gdGhpcy4jZ2V0TWFyZ2luQ29tcG9uZW50cygpOwogICAgY29uc3QgYmJveCA9IHRoaXMuI2Jib3g7CiAgICBjb25zdCBbeCwgeSwgd2lkdGgsIGhlaWdodF0gPSBiYm94OwogICAgYmJveFswXSA9IG5ld1g7CiAgICBiYm94WzFdID0gbmV3WTsKICAgIGJib3hbMl0gPSBuZXdXaWR0aDsKICAgIGJib3hbM10gPSBuZXdIZWlnaHQ7CiAgICBpZiAoTWF0aC5hYnMod2lkdGggLSBtYXJnaW5YKSA8PSBPdXRsaW5lLlBSRUNJU0lPTiB8fCBNYXRoLmFicyhoZWlnaHQgLSBtYXJnaW5ZKSA8PSBPdXRsaW5lLlBSRUNJU0lPTikgewogICAgICBjb25zdCB0eCA9IG5ld1ggKyBuZXdXaWR0aCAvIDIgLSAoeCArIHdpZHRoIC8gMik7CiAgICAgIGNvbnN0IHR5ID0gbmV3WSArIG5ld0hlaWdodCAvIDIgLSAoeSArIGhlaWdodCAvIDIpOwogICAgICBmb3IgKGNvbnN0IHsKICAgICAgICBsaW5lLAogICAgICAgIHBvaW50cwogICAgICB9IG9mIHRoaXMuI2xpbmVzKSB7CiAgICAgICAgT3V0bGluZS5fdHJhbnNsYXRlKGxpbmUsIHR4LCB0eSwgbGluZSk7CiAgICAgICAgT3V0bGluZS5fdHJhbnNsYXRlKHBvaW50cywgdHgsIHR5LCBwb2ludHMpOwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgcm9vdDogewogICAgICAgICAgdmlld0JveDogdGhpcy52aWV3Qm94CiAgICAgICAgfSwKICAgICAgICBwYXRoOiB7CiAgICAgICAgICAidHJhbnNmb3JtLW9yaWdpbiI6IGAke091dGxpbmUuc3ZnUm91bmQobmV3WCl9ICR7T3V0bGluZS5zdmdSb3VuZChuZXdZKX1gLAogICAgICAgICAgdHJhbnNmb3JtOiB0aGlzLnJvdGF0aW9uVHJhbnNmb3JtIHx8IG51bGwsCiAgICAgICAgICBkOiB0aGlzLnRvU1ZHUGF0aCgpCiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgY29uc3QgczF4ID0gKG5ld1dpZHRoIC0gMiAqIG1hcmdpblgpIC8gKHdpZHRoIC0gMiAqIG1hcmdpblgpOwogICAgY29uc3QgczF5ID0gKG5ld0hlaWdodCAtIDIgKiBtYXJnaW5ZKSAvIChoZWlnaHQgLSAyICogbWFyZ2luWSk7CiAgICBjb25zdCB0eCA9IC1zMXggKiAoeCArIG1hcmdpblgpICsgbmV3WCArIG1hcmdpblg7CiAgICBjb25zdCB0eSA9IC1zMXkgKiAoeSArIG1hcmdpblkpICsgbmV3WSArIG1hcmdpblk7CiAgICBpZiAoczF4ICE9PSAxIHx8IHMxeSAhPT0gMSB8fCB0eCAhPT0gMCB8fCB0eSAhPT0gMCkgewogICAgICBmb3IgKGNvbnN0IHsKICAgICAgICBsaW5lLAogICAgICAgIHBvaW50cwogICAgICB9IG9mIHRoaXMuI2xpbmVzKSB7CiAgICAgICAgT3V0bGluZS5fcmVzY2FsZShsaW5lLCB0eCwgdHksIHMxeCwgczF5LCBsaW5lKTsKICAgICAgICBPdXRsaW5lLl9yZXNjYWxlKHBvaW50cywgdHgsIHR5LCBzMXgsIHMxeSwgcG9pbnRzKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgcm9vdDogewogICAgICAgIHZpZXdCb3g6IHRoaXMudmlld0JveAogICAgICB9LAogICAgICBwYXRoOiB7CiAgICAgICAgInRyYW5zZm9ybS1vcmlnaW4iOiBgJHtPdXRsaW5lLnN2Z1JvdW5kKG5ld1gpfSAke091dGxpbmUuc3ZnUm91bmQobmV3WSl9YCwKICAgICAgICB0cmFuc2Zvcm06IHRoaXMucm90YXRpb25UcmFuc2Zvcm0gfHwgbnVsbCwKICAgICAgICBkOiB0aGlzLnRvU1ZHUGF0aCgpCiAgICAgIH0KICAgIH07CiAgfQogIGdldFBhdGhUcmFuc2xhdGVkU1ZHUHJvcGVydGllcyhbbmV3WCwgbmV3WV0sIHBhcmVudERpbWVuc2lvbnMpIHsKICAgIGNvbnN0IFtuZXdQYXJlbnRXaWR0aCwgbmV3UGFyZW50SGVpZ2h0XSA9IHBhcmVudERpbWVuc2lvbnM7CiAgICBjb25zdCBiYm94ID0gdGhpcy4jYmJveDsKICAgIGNvbnN0IHR4ID0gbmV3WCAtIGJib3hbMF07CiAgICBjb25zdCB0eSA9IG5ld1kgLSBiYm94WzFdOwogICAgaWYgKHRoaXMuI3BhcmVudFdpZHRoID09PSBuZXdQYXJlbnRXaWR0aCAmJiB0aGlzLiNwYXJlbnRIZWlnaHQgPT09IG5ld1BhcmVudEhlaWdodCkgewogICAgICBmb3IgKGNvbnN0IHsKICAgICAgICBsaW5lLAogICAgICAgIHBvaW50cwogICAgICB9IG9mIHRoaXMuI2xpbmVzKSB7CiAgICAgICAgT3V0bGluZS5fdHJhbnNsYXRlKGxpbmUsIHR4LCB0eSwgbGluZSk7CiAgICAgICAgT3V0bGluZS5fdHJhbnNsYXRlKHBvaW50cywgdHgsIHR5LCBwb2ludHMpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCBzeCA9IHRoaXMuI3BhcmVudFdpZHRoIC8gbmV3UGFyZW50V2lkdGg7CiAgICAgIGNvbnN0IHN5ID0gdGhpcy4jcGFyZW50SGVpZ2h0IC8gbmV3UGFyZW50SGVpZ2h0OwogICAgICB0aGlzLiNwYXJlbnRXaWR0aCA9IG5ld1BhcmVudFdpZHRoOwogICAgICB0aGlzLiNwYXJlbnRIZWlnaHQgPSBuZXdQYXJlbnRIZWlnaHQ7CiAgICAgIGZvciAoY29uc3QgewogICAgICAgIGxpbmUsCiAgICAgICAgcG9pbnRzCiAgICAgIH0gb2YgdGhpcy4jbGluZXMpIHsKICAgICAgICBPdXRsaW5lLl9yZXNjYWxlKGxpbmUsIHR4LCB0eSwgc3gsIHN5LCBsaW5lKTsKICAgICAgICBPdXRsaW5lLl9yZXNjYWxlKHBvaW50cywgdHgsIHR5LCBzeCwgc3ksIHBvaW50cyk7CiAgICAgIH0KICAgICAgYmJveFsyXSAqPSBzeDsKICAgICAgYmJveFszXSAqPSBzeTsKICAgIH0KICAgIGJib3hbMF0gPSBuZXdYOwogICAgYmJveFsxXSA9IG5ld1k7CiAgICByZXR1cm4gewogICAgICByb290OiB7CiAgICAgICAgdmlld0JveDogdGhpcy52aWV3Qm94CiAgICAgIH0sCiAgICAgIHBhdGg6IHsKICAgICAgICBkOiB0aGlzLnRvU1ZHUGF0aCgpLAogICAgICAgICJ0cmFuc2Zvcm0tb3JpZ2luIjogYCR7T3V0bGluZS5zdmdSb3VuZChuZXdYKX0gJHtPdXRsaW5lLnN2Z1JvdW5kKG5ld1kpfWAKICAgICAgfQogICAgfTsKICB9CiAgZ2V0IGRlZmF1bHRTVkdQcm9wZXJ0aWVzKCkgewogICAgY29uc3QgYmJveCA9IHRoaXMuI2Jib3g7CiAgICByZXR1cm4gewogICAgICByb290OiB7CiAgICAgICAgdmlld0JveDogdGhpcy52aWV3Qm94CiAgICAgIH0sCiAgICAgIHJvb3RDbGFzczogewogICAgICAgIGRyYXc6IHRydWUKICAgICAgfSwKICAgICAgcGF0aDogewogICAgICAgIGQ6IHRoaXMudG9TVkdQYXRoKCksCiAgICAgICAgInRyYW5zZm9ybS1vcmlnaW4iOiBgJHtPdXRsaW5lLnN2Z1JvdW5kKGJib3hbMF0pfSAke091dGxpbmUuc3ZnUm91bmQoYmJveFsxXSl9YCwKICAgICAgICB0cmFuc2Zvcm06IHRoaXMucm90YXRpb25UcmFuc2Zvcm0gfHwgbnVsbAogICAgICB9LAogICAgICBiYm94CiAgICB9OwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvZWRpdG9yL2luay5qcwoKCgoKCmNsYXNzIElua0RyYXdpbmdPcHRpb25zIGV4dGVuZHMgRHJhd2luZ09wdGlvbnMgewogIGNvbnN0cnVjdG9yKHZpZXdlclBhcmFtZXRlcnMpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLl92aWV3UGFyYW1ldGVycyA9IHZpZXdlclBhcmFtZXRlcnM7CiAgICBzdXBlci51cGRhdGVQcm9wZXJ0aWVzKHsKICAgICAgZmlsbDogIm5vbmUiLAogICAgICBzdHJva2U6IEFubm90YXRpb25FZGl0b3IuX2RlZmF1bHRMaW5lQ29sb3IsCiAgICAgICJzdHJva2Utb3BhY2l0eSI6IDEsCiAgICAgICJzdHJva2Utd2lkdGgiOiAxLAogICAgICAic3Ryb2tlLWxpbmVjYXAiOiAicm91bmQiLAogICAgICAic3Ryb2tlLWxpbmVqb2luIjogInJvdW5kIiwKICAgICAgInN0cm9rZS1taXRlcmxpbWl0IjogMTAKICAgIH0pOwogIH0KICB1cGRhdGVTVkdQcm9wZXJ0eShuYW1lLCB2YWx1ZSkgewogICAgaWYgKG5hbWUgPT09ICJzdHJva2Utd2lkdGgiKSB7CiAgICAgIHZhbHVlID8/PSB0aGlzWyJzdHJva2Utd2lkdGgiXTsKICAgICAgdmFsdWUgKj0gdGhpcy5fdmlld1BhcmFtZXRlcnMucmVhbFNjYWxlOwogICAgfQogICAgc3VwZXIudXBkYXRlU1ZHUHJvcGVydHkobmFtZSwgdmFsdWUpOwogIH0KICBjbG9uZSgpIHsKICAgIGNvbnN0IGNsb25lID0gbmV3IElua0RyYXdpbmdPcHRpb25zKHRoaXMuX3ZpZXdQYXJhbWV0ZXJzKTsKICAgIGNsb25lLnVwZGF0ZUFsbCh0aGlzKTsKICAgIHJldHVybiBjbG9uZTsKICB9Cn0KY2xhc3MgSW5rRWRpdG9yIGV4dGVuZHMgRHJhd2luZ0VkaXRvciB7CiAgc3RhdGljIF90eXBlID0gImluayI7CiAgc3RhdGljIF9lZGl0b3JUeXBlID0gQW5ub3RhdGlvbkVkaXRvclR5cGUuSU5LOwogIHN0YXRpYyBfZGVmYXVsdERyYXdpbmdPcHRpb25zID0gbnVsbDsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHsKICAgICAgLi4ucGFyYW1zLAogICAgICBuYW1lOiAiaW5rRWRpdG9yIgogICAgfSk7CiAgICB0aGlzLl93aWxsS2VlcEFzcGVjdFJhdGlvID0gdHJ1ZTsKICAgIHRoaXMuZGVmYXVsdEwxMG5JZCA9ICJwZGZqcy1lZGl0b3ItaW5rLWVkaXRvciI7CiAgfQogIHN0YXRpYyBpbml0aWFsaXplKGwxMG4sIHVpTWFuYWdlcikgewogICAgQW5ub3RhdGlvbkVkaXRvci5pbml0aWFsaXplKGwxMG4sIHVpTWFuYWdlcik7CiAgICB0aGlzLl9kZWZhdWx0RHJhd2luZ09wdGlvbnMgPSBuZXcgSW5rRHJhd2luZ09wdGlvbnModWlNYW5hZ2VyLnZpZXdQYXJhbWV0ZXJzKTsKICB9CiAgc3RhdGljIGdldERlZmF1bHREcmF3aW5nT3B0aW9ucyhvcHRpb25zKSB7CiAgICBjb25zdCBjbG9uZSA9IHRoaXMuX2RlZmF1bHREcmF3aW5nT3B0aW9ucy5jbG9uZSgpOwogICAgY2xvbmUudXBkYXRlUHJvcGVydGllcyhvcHRpb25zKTsKICAgIHJldHVybiBjbG9uZTsKICB9CiAgc3RhdGljIGdldCBzdXBwb3J0TXVsdGlwbGVEcmF3aW5ncygpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBzdGF0aWMgZ2V0IHR5cGVzTWFwKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAidHlwZXNNYXAiLCBuZXcgTWFwKFtbQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSU5LX1RISUNLTkVTUywgInN0cm9rZS13aWR0aCJdLCBbQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSU5LX0NPTE9SLCAic3Ryb2tlIl0sIFtBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5JTktfT1BBQ0lUWSwgInN0cm9rZS1vcGFjaXR5Il1dKSk7CiAgfQogIHN0YXRpYyBjcmVhdGVEcmF3ZXJJbnN0YW5jZSh4LCB5LCBwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0LCByb3RhdGlvbikgewogICAgcmV0dXJuIG5ldyBJbmtEcmF3T3V0bGluZXIoeCwgeSwgcGFyZW50V2lkdGgsIHBhcmVudEhlaWdodCwgcm90YXRpb24sIHRoaXMuX2RlZmF1bHREcmF3aW5nT3B0aW9uc1sic3Ryb2tlLXdpZHRoIl0pOwogIH0KICBzdGF0aWMgZGVzZXJpYWxpemVEcmF3KHBhZ2VYLCBwYWdlWSwgcGFnZVdpZHRoLCBwYWdlSGVpZ2h0LCBpbm5lck1hcmdpbiwgZGF0YSkgewogICAgcmV0dXJuIElua0RyYXdPdXRsaW5lLmRlc2VyaWFsaXplKHBhZ2VYLCBwYWdlWSwgcGFnZVdpZHRoLCBwYWdlSGVpZ2h0LCBpbm5lck1hcmdpbiwgZGF0YSk7CiAgfQogIHN0YXRpYyBhc3luYyBkZXNlcmlhbGl6ZShkYXRhLCBwYXJlbnQsIHVpTWFuYWdlcikgewogICAgbGV0IGluaXRpYWxEYXRhID0gbnVsbDsKICAgIGlmIChkYXRhIGluc3RhbmNlb2YgSW5rQW5ub3RhdGlvbkVsZW1lbnQpIHsKICAgICAgY29uc3QgewogICAgICAgIGRhdGE6IHsKICAgICAgICAgIGlua0xpc3RzLAogICAgICAgICAgcmVjdCwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgaWQsCiAgICAgICAgICBjb2xvciwKICAgICAgICAgIG9wYWNpdHksCiAgICAgICAgICBib3JkZXJTdHlsZTogewogICAgICAgICAgICByYXdXaWR0aDogdGhpY2tuZXNzCiAgICAgICAgICB9LAogICAgICAgICAgcG9wdXBSZWYKICAgICAgICB9LAogICAgICAgIHBhcmVudDogewogICAgICAgICAgcGFnZTogewogICAgICAgICAgICBwYWdlTnVtYmVyCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9ID0gZGF0YTsKICAgICAgaW5pdGlhbERhdGEgPSBkYXRhID0gewogICAgICAgIGFubm90YXRpb25UeXBlOiBBbm5vdGF0aW9uRWRpdG9yVHlwZS5JTkssCiAgICAgICAgY29sb3I6IEFycmF5LmZyb20oY29sb3IpLAogICAgICAgIHRoaWNrbmVzcywKICAgICAgICBvcGFjaXR5LAogICAgICAgIHBhdGhzOiB7CiAgICAgICAgICBwb2ludHM6IGlua0xpc3RzCiAgICAgICAgfSwKICAgICAgICBib3hlczogbnVsbCwKICAgICAgICBwYWdlSW5kZXg6IHBhZ2VOdW1iZXIgLSAxLAogICAgICAgIHJlY3Q6IHJlY3Quc2xpY2UoMCksCiAgICAgICAgcm90YXRpb24sCiAgICAgICAgaWQsCiAgICAgICAgZGVsZXRlZDogZmFsc2UsCiAgICAgICAgcG9wdXBSZWYKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IGVkaXRvciA9IGF3YWl0IHN1cGVyLmRlc2VyaWFsaXplKGRhdGEsIHBhcmVudCwgdWlNYW5hZ2VyKTsKICAgIGVkaXRvci5hbm5vdGF0aW9uRWxlbWVudElkID0gZGF0YS5pZCB8fCBudWxsOwogICAgZWRpdG9yLl9pbml0aWFsRGF0YSA9IGluaXRpYWxEYXRhOwogICAgcmV0dXJuIGVkaXRvcjsKICB9CiAgb25TY2FsZUNoYW5naW5nKCkgewogICAgaWYgKCF0aGlzLnBhcmVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBzdXBlci5vblNjYWxlQ2hhbmdpbmcoKTsKICAgIGNvbnN0IHsKICAgICAgX2RyYXdJZCwKICAgICAgX2RyYXdpbmdPcHRpb25zLAogICAgICBwYXJlbnQKICAgIH0gPSB0aGlzOwogICAgX2RyYXdpbmdPcHRpb25zLnVwZGF0ZVNWR1Byb3BlcnR5KCJzdHJva2Utd2lkdGgiKTsKICAgIHBhcmVudC5kcmF3TGF5ZXIudXBkYXRlUHJvcGVydGllcyhfZHJhd0lkLCBfZHJhd2luZ09wdGlvbnMudG9TVkdQcm9wZXJ0aWVzKCkpOwogIH0KICBzdGF0aWMgb25TY2FsZUNoYW5naW5nV2hlbkRyYXdpbmcoKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLl9jdXJyZW50UGFyZW50OwogICAgaWYgKCFwYXJlbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3VwZXIub25TY2FsZUNoYW5naW5nV2hlbkRyYXdpbmcoKTsKICAgIHRoaXMuX2RlZmF1bHREcmF3aW5nT3B0aW9ucy51cGRhdGVTVkdQcm9wZXJ0eSgic3Ryb2tlLXdpZHRoIik7CiAgICBwYXJlbnQuZHJhd0xheWVyLnVwZGF0ZVByb3BlcnRpZXModGhpcy5fY3VycmVudERyYXdJZCwgdGhpcy5fZGVmYXVsdERyYXdpbmdPcHRpb25zLnRvU1ZHUHJvcGVydGllcygpKTsKICB9CiAgY3JlYXRlRHJhd2luZ09wdGlvbnMoewogICAgY29sb3IsCiAgICB0aGlja25lc3MsCiAgICBvcGFjaXR5CiAgfSkgewogICAgdGhpcy5fZHJhd2luZ09wdGlvbnMgPSBJbmtFZGl0b3IuZ2V0RGVmYXVsdERyYXdpbmdPcHRpb25zKHsKICAgICAgc3Ryb2tlOiBVdGlsLm1ha2VIZXhDb2xvciguLi5jb2xvciksCiAgICAgICJzdHJva2Utd2lkdGgiOiB0aGlja25lc3MsCiAgICAgICJzdHJva2Utb3BhY2l0eSI6IG9wYWNpdHkKICAgIH0pOwogIH0KICBzZXJpYWxpemUoaXNGb3JDb3B5aW5nID0gZmFsc2UpIHsKICAgIGlmICh0aGlzLmlzRW1wdHkoKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLmRlbGV0ZWQpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplRGVsZXRlZCgpOwogICAgfQogICAgY29uc3QgewogICAgICBsaW5lcywKICAgICAgcG9pbnRzLAogICAgICByZWN0CiAgICB9ID0gdGhpcy5zZXJpYWxpemVEcmF3KGlzRm9yQ29weWluZyk7CiAgICBjb25zdCB7CiAgICAgIF9kcmF3aW5nT3B0aW9uczogewogICAgICAgIHN0cm9rZSwKICAgICAgICAic3Ryb2tlLW9wYWNpdHkiOiBvcGFjaXR5LAogICAgICAgICJzdHJva2Utd2lkdGgiOiB0aGlja25lc3MKICAgICAgfQogICAgfSA9IHRoaXM7CiAgICBjb25zdCBzZXJpYWxpemVkID0gewogICAgICBhbm5vdGF0aW9uVHlwZTogQW5ub3RhdGlvbkVkaXRvclR5cGUuSU5LLAogICAgICBjb2xvcjogQW5ub3RhdGlvbkVkaXRvci5fY29sb3JNYW5hZ2VyLmNvbnZlcnQoc3Ryb2tlKSwKICAgICAgb3BhY2l0eSwKICAgICAgdGhpY2tuZXNzLAogICAgICBwYXRoczogewogICAgICAgIGxpbmVzLAogICAgICAgIHBvaW50cwogICAgICB9LAogICAgICBwYWdlSW5kZXg6IHRoaXMucGFnZUluZGV4LAogICAgICByZWN0LAogICAgICByb3RhdGlvbjogdGhpcy5yb3RhdGlvbiwKICAgICAgc3RydWN0VHJlZVBhcmVudElkOiB0aGlzLl9zdHJ1Y3RUcmVlUGFyZW50SWQKICAgIH07CiAgICBpZiAoaXNGb3JDb3B5aW5nKSB7CiAgICAgIHNlcmlhbGl6ZWQuaXNDb3B5ID0gdHJ1ZTsKICAgICAgcmV0dXJuIHNlcmlhbGl6ZWQ7CiAgICB9CiAgICBpZiAodGhpcy5hbm5vdGF0aW9uRWxlbWVudElkICYmICF0aGlzLiNoYXNFbGVtZW50Q2hhbmdlZChzZXJpYWxpemVkKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHNlcmlhbGl6ZWQuaWQgPSB0aGlzLmFubm90YXRpb25FbGVtZW50SWQ7CiAgICByZXR1cm4gc2VyaWFsaXplZDsKICB9CiAgI2hhc0VsZW1lbnRDaGFuZ2VkKHNlcmlhbGl6ZWQpIHsKICAgIGNvbnN0IHsKICAgICAgY29sb3IsCiAgICAgIHRoaWNrbmVzcywKICAgICAgb3BhY2l0eSwKICAgICAgcGFnZUluZGV4CiAgICB9ID0gdGhpcy5faW5pdGlhbERhdGE7CiAgICByZXR1cm4gdGhpcy5faGFzQmVlbk1vdmVkIHx8IHRoaXMuX2hhc0JlZW5SZXNpemVkIHx8IHNlcmlhbGl6ZWQuY29sb3Iuc29tZSgoYywgaSkgPT4gYyAhPT0gY29sb3JbaV0pIHx8IHNlcmlhbGl6ZWQudGhpY2tuZXNzICE9PSB0aGlja25lc3MgfHwgc2VyaWFsaXplZC5vcGFjaXR5ICE9PSBvcGFjaXR5IHx8IHNlcmlhbGl6ZWQucGFnZUluZGV4ICE9PSBwYWdlSW5kZXg7CiAgfQogIHJlbmRlckFubm90YXRpb25FbGVtZW50KGFubm90YXRpb24pIHsKICAgIGNvbnN0IHsKICAgICAgcG9pbnRzLAogICAgICByZWN0CiAgICB9ID0gdGhpcy5zZXJpYWxpemVEcmF3KGZhbHNlKTsKICAgIGFubm90YXRpb24udXBkYXRlRWRpdGVkKHsKICAgICAgcmVjdCwKICAgICAgdGhpY2tuZXNzOiB0aGlzLl9kcmF3aW5nT3B0aW9uc1sic3Ryb2tlLXdpZHRoIl0sCiAgICAgIHBvaW50cwogICAgfSk7CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L2VkaXRvci9kcmF3ZXJzL2NvbnRvdXIuanMKCmNsYXNzIENvbnRvdXJEcmF3T3V0bGluZSBleHRlbmRzIElua0RyYXdPdXRsaW5lIHsKICB0b1NWR1BhdGgoKSB7CiAgICBsZXQgcGF0aCA9IHN1cGVyLnRvU1ZHUGF0aCgpOwogICAgaWYgKCFwYXRoLmVuZHNXaXRoKCJaIikpIHsKICAgICAgcGF0aCArPSAiWiI7CiAgICB9CiAgICByZXR1cm4gcGF0aDsKICB9Cn0KCjsvLyAuL3NyYy9kaXNwbGF5L2VkaXRvci9kcmF3ZXJzL3NpZ25hdHVyZWRyYXcuanMKCgoKCmNvbnN0IEJBU0VfSEVBREVSX0xFTkdUSCA9IDg7CmNvbnN0IFBPSU5UU19QUk9QRVJUSUVTX05VTUJFUiA9IDM7CmNsYXNzIFNpZ25hdHVyZUV4dHJhY3RvciB7CiAgc3RhdGljICNQQVJBTUVURVJTID0gewogICAgbWF4RGltOiA1MTIsCiAgICBzaWdtYVNGYWN0b3I6IDAuMDIsCiAgICBzaWdtYVI6IDI1LAogICAga2VybmVsU2l6ZTogMTYKICB9OwogIHN0YXRpYyAjbmVpZ2hib3JJbmRleFRvSWQoaTAsIGowLCBpLCBqKSB7CiAgICBpIC09IGkwOwogICAgaiAtPSBqMDsKICAgIGlmIChpID09PSAwKSB7CiAgICAgIHJldHVybiBqID4gMCA/IDAgOiA0OwogICAgfQogICAgaWYgKGkgPT09IDEpIHsKICAgICAgcmV0dXJuIGogKyA2OwogICAgfQogICAgcmV0dXJuIDIgLSBqOwogIH0KICBzdGF0aWMgI25laWdoYm9ySWRUb0luZGV4ID0gbmV3IEludDMyQXJyYXkoWzAsIDEsIC0xLCAxLCAtMSwgMCwgLTEsIC0xLCAwLCAtMSwgMSwgLTEsIDEsIDAsIDEsIDFdKTsKICBzdGF0aWMgI2Nsb2Nrd2lzZU5vblplcm8oYnVmLCB3aWR0aCwgaTAsIGowLCBpLCBqLCBvZmZzZXQpIHsKICAgIGNvbnN0IGlkID0gdGhpcy4jbmVpZ2hib3JJbmRleFRvSWQoaTAsIGowLCBpLCBqKTsKICAgIGZvciAobGV0IGsgPSAwOyBrIDwgODsgaysrKSB7CiAgICAgIGNvbnN0IGtrID0gKC1rICsgaWQgLSBvZmZzZXQgKyAxNikgJSA4OwogICAgICBjb25zdCBzaGlmdEkgPSB0aGlzLiNuZWlnaGJvcklkVG9JbmRleFsyICoga2tdOwogICAgICBjb25zdCBzaGlmdEogPSB0aGlzLiNuZWlnaGJvcklkVG9JbmRleFsyICoga2sgKyAxXTsKICAgICAgaWYgKGJ1ZlsoaTAgKyBzaGlmdEkpICogd2lkdGggKyAoajAgKyBzaGlmdEopXSAhPT0gMCkgewogICAgICAgIHJldHVybiBrazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIC0xOwogIH0KICBzdGF0aWMgI2NvdW50ZXJDbG9ja3dpc2VOb25aZXJvKGJ1Ziwgd2lkdGgsIGkwLCBqMCwgaSwgaiwgb2Zmc2V0KSB7CiAgICBjb25zdCBpZCA9IHRoaXMuI25laWdoYm9ySW5kZXhUb0lkKGkwLCBqMCwgaSwgaik7CiAgICBmb3IgKGxldCBrID0gMDsgayA8IDg7IGsrKykgewogICAgICBjb25zdCBrayA9IChrICsgaWQgKyBvZmZzZXQgKyAxNikgJSA4OwogICAgICBjb25zdCBzaGlmdEkgPSB0aGlzLiNuZWlnaGJvcklkVG9JbmRleFsyICoga2tdOwogICAgICBjb25zdCBzaGlmdEogPSB0aGlzLiNuZWlnaGJvcklkVG9JbmRleFsyICoga2sgKyAxXTsKICAgICAgaWYgKGJ1ZlsoaTAgKyBzaGlmdEkpICogd2lkdGggKyAoajAgKyBzaGlmdEopXSAhPT0gMCkgewogICAgICAgIHJldHVybiBrazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIC0xOwogIH0KICBzdGF0aWMgI2ZpbmRDb250b3VycyhidWYsIHdpZHRoLCBoZWlnaHQsIHRocmVzaG9sZCkgewogICAgY29uc3QgTiA9IGJ1Zi5sZW5ndGg7CiAgICBjb25zdCB0eXBlcyA9IG5ldyBJbnQzMkFycmF5KE4pOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgICAgdHlwZXNbaV0gPSBidWZbaV0gPD0gdGhyZXNob2xkID8gMSA6IDA7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMTsgaSA8IGhlaWdodCAtIDE7IGkrKykgewogICAgICB0eXBlc1tpICogd2lkdGhdID0gdHlwZXNbaSAqIHdpZHRoICsgd2lkdGggLSAxXSA9IDA7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdpZHRoOyBpKyspIHsKICAgICAgdHlwZXNbaV0gPSB0eXBlc1t3aWR0aCAqIGhlaWdodCAtIDEgLSBpXSA9IDA7CiAgICB9CiAgICBsZXQgbmJkID0gMTsKICAgIGxldCBsbmJkOwogICAgY29uc3QgY29udG91cnMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAxOyBpIDwgaGVpZ2h0IC0gMTsgaSsrKSB7CiAgICAgIGxuYmQgPSAxOwogICAgICBmb3IgKGxldCBqID0gMTsgaiA8IHdpZHRoIC0gMTsgaisrKSB7CiAgICAgICAgY29uc3QgaWogPSBpICogd2lkdGggKyBqOwogICAgICAgIGNvbnN0IHBpeCA9IHR5cGVzW2lqXTsKICAgICAgICBpZiAocGl4ID09PSAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbGV0IGkyID0gaTsKICAgICAgICBsZXQgajIgPSBqOwogICAgICAgIGlmIChwaXggPT09IDEgJiYgdHlwZXNbaWogLSAxXSA9PT0gMCkgewogICAgICAgICAgbmJkICs9IDE7CiAgICAgICAgICBqMiAtPSAxOwogICAgICAgIH0gZWxzZSBpZiAocGl4ID49IDEgJiYgdHlwZXNbaWogKyAxXSA9PT0gMCkgewogICAgICAgICAgbmJkICs9IDE7CiAgICAgICAgICBqMiArPSAxOwogICAgICAgICAgaWYgKHBpeCA+IDEpIHsKICAgICAgICAgICAgbG5iZCA9IHBpeDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHBpeCAhPT0gMSkgewogICAgICAgICAgICBsbmJkID0gTWF0aC5hYnMocGl4KTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBwb2ludHMgPSBbaiwgaV07CiAgICAgICAgY29uc3QgaXNIb2xlID0gajIgPT09IGogKyAxOwogICAgICAgIGNvbnN0IGNvbnRvdXIgPSB7CiAgICAgICAgICBpc0hvbGUsCiAgICAgICAgICBwb2ludHMsCiAgICAgICAgICBpZDogbmJkLAogICAgICAgICAgcGFyZW50OiAwCiAgICAgICAgfTsKICAgICAgICBjb250b3Vycy5wdXNoKGNvbnRvdXIpOwogICAgICAgIGxldCBjb250b3VyMDsKICAgICAgICBmb3IgKGNvbnN0IGMgb2YgY29udG91cnMpIHsKICAgICAgICAgIGlmIChjLmlkID09PSBsbmJkKSB7CiAgICAgICAgICAgIGNvbnRvdXIwID0gYzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghY29udG91cjApIHsKICAgICAgICAgIGNvbnRvdXIucGFyZW50ID0gaXNIb2xlID8gbG5iZCA6IDA7CiAgICAgICAgfSBlbHNlIGlmIChjb250b3VyMC5pc0hvbGUpIHsKICAgICAgICAgIGNvbnRvdXIucGFyZW50ID0gaXNIb2xlID8gY29udG91cjAucGFyZW50IDogbG5iZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29udG91ci5wYXJlbnQgPSBpc0hvbGUgPyBsbmJkIDogY29udG91cjAucGFyZW50OwogICAgICAgIH0KICAgICAgICBjb25zdCBrID0gdGhpcy4jY2xvY2t3aXNlTm9uWmVybyh0eXBlcywgd2lkdGgsIGksIGosIGkyLCBqMiwgMCk7CiAgICAgICAgaWYgKGsgPT09IC0xKSB7CiAgICAgICAgICB0eXBlc1tpal0gPSAtbmJkOwogICAgICAgICAgaWYgKHR5cGVzW2lqXSAhPT0gMSkgewogICAgICAgICAgICBsbmJkID0gTWF0aC5hYnModHlwZXNbaWpdKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBsZXQgc2hpZnRJID0gdGhpcy4jbmVpZ2hib3JJZFRvSW5kZXhbMiAqIGtdOwogICAgICAgIGxldCBzaGlmdEogPSB0aGlzLiNuZWlnaGJvcklkVG9JbmRleFsyICogayArIDFdOwogICAgICAgIGNvbnN0IGkxID0gaSArIHNoaWZ0STsKICAgICAgICBjb25zdCBqMSA9IGogKyBzaGlmdEo7CiAgICAgICAgaTIgPSBpMTsKICAgICAgICBqMiA9IGoxOwogICAgICAgIGxldCBpMyA9IGk7CiAgICAgICAgbGV0IGozID0gajsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgY29uc3Qga2sgPSB0aGlzLiNjb3VudGVyQ2xvY2t3aXNlTm9uWmVybyh0eXBlcywgd2lkdGgsIGkzLCBqMywgaTIsIGoyLCAxKTsKICAgICAgICAgIHNoaWZ0SSA9IHRoaXMuI25laWdoYm9ySWRUb0luZGV4WzIgKiBra107CiAgICAgICAgICBzaGlmdEogPSB0aGlzLiNuZWlnaGJvcklkVG9JbmRleFsyICoga2sgKyAxXTsKICAgICAgICAgIGNvbnN0IGk0ID0gaTMgKyBzaGlmdEk7CiAgICAgICAgICBjb25zdCBqNCA9IGozICsgc2hpZnRKOwogICAgICAgICAgcG9pbnRzLnB1c2goajQsIGk0KTsKICAgICAgICAgIGNvbnN0IGlqMyA9IGkzICogd2lkdGggKyBqMzsKICAgICAgICAgIGlmICh0eXBlc1tpajMgKyAxXSA9PT0gMCkgewogICAgICAgICAgICB0eXBlc1tpajNdID0gLW5iZDsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZXNbaWozXSA9PT0gMSkgewogICAgICAgICAgICB0eXBlc1tpajNdID0gbmJkOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGk0ID09PSBpICYmIGo0ID09PSBqICYmIGkzID09PSBpMSAmJiBqMyA9PT0gajEpIHsKICAgICAgICAgICAgaWYgKHR5cGVzW2lqXSAhPT0gMSkgewogICAgICAgICAgICAgIGxuYmQgPSBNYXRoLmFicyh0eXBlc1tpal0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaTIgPSBpMzsKICAgICAgICAgICAgajIgPSBqMzsKICAgICAgICAgICAgaTMgPSBpNDsKICAgICAgICAgICAgajMgPSBqNDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjb250b3VyczsKICB9CiAgc3RhdGljICNkb3VnbGFzUGV1Y2tlckhlbHBlcihwb2ludHMsIHN0YXJ0LCBlbmQsIG91dHB1dCkgewogICAgaWYgKGVuZCAtIHN0YXJ0IDw9IDQpIHsKICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgZW5kIC0gMjsgaSArPSAyKSB7CiAgICAgICAgb3V0cHV0LnB1c2gocG9pbnRzW2ldLCBwb2ludHNbaSArIDFdKTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBheCA9IHBvaW50c1tzdGFydF07CiAgICBjb25zdCBheSA9IHBvaW50c1tzdGFydCArIDFdOwogICAgY29uc3QgYWJ4ID0gcG9pbnRzW2VuZCAtIDRdIC0gYXg7CiAgICBjb25zdCBhYnkgPSBwb2ludHNbZW5kIC0gM10gLSBheTsKICAgIGNvbnN0IGRpc3QgPSBNYXRoLmh5cG90KGFieCwgYWJ5KTsKICAgIGNvbnN0IG5hYnggPSBhYnggLyBkaXN0OwogICAgY29uc3QgbmFieSA9IGFieSAvIGRpc3Q7CiAgICBjb25zdCBhYSA9IG5hYnggKiBheSAtIG5hYnkgKiBheDsKICAgIGNvbnN0IG0gPSBhYnkgLyBhYng7CiAgICBjb25zdCBpbnZTID0gMSAvIGRpc3Q7CiAgICBjb25zdCBwaGkgPSBNYXRoLmF0YW4obSk7CiAgICBjb25zdCBjb3NQaGkgPSBNYXRoLmNvcyhwaGkpOwogICAgY29uc3Qgc2luUGhpID0gTWF0aC5zaW4ocGhpKTsKICAgIGNvbnN0IHRtYXggPSBpbnZTICogKE1hdGguYWJzKGNvc1BoaSkgKyBNYXRoLmFicyhzaW5QaGkpKTsKICAgIGNvbnN0IHBvbHkgPSBpbnZTICogKDEgLSB0bWF4ICsgdG1heCAqKiAyKTsKICAgIGNvbnN0IHBhcnRpYWxQaGkgPSBNYXRoLm1heChNYXRoLmF0YW4oTWF0aC5hYnMoc2luUGhpICsgY29zUGhpKSAqIHBvbHkpLCBNYXRoLmF0YW4oTWF0aC5hYnMoc2luUGhpIC0gY29zUGhpKSAqIHBvbHkpKTsKICAgIGxldCBkbWF4ID0gMDsKICAgIGxldCBpbmRleCA9IHN0YXJ0OwogICAgZm9yIChsZXQgaSA9IHN0YXJ0ICsgMjsgaSA8IGVuZCAtIDI7IGkgKz0gMikgewogICAgICBjb25zdCBkID0gTWF0aC5hYnMoYWEgLSBuYWJ4ICogcG9pbnRzW2kgKyAxXSArIG5hYnkgKiBwb2ludHNbaV0pOwogICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICBpbmRleCA9IGk7CiAgICAgICAgZG1heCA9IGQ7CiAgICAgIH0KICAgIH0KICAgIGlmIChkbWF4ID4gKGRpc3QgKiBwYXJ0aWFsUGhpKSAqKiAyKSB7CiAgICAgIHRoaXMuI2RvdWdsYXNQZXVja2VySGVscGVyKHBvaW50cywgc3RhcnQsIGluZGV4ICsgMiwgb3V0cHV0KTsKICAgICAgdGhpcy4jZG91Z2xhc1BldWNrZXJIZWxwZXIocG9pbnRzLCBpbmRleCwgZW5kLCBvdXRwdXQpOwogICAgfSBlbHNlIHsKICAgICAgb3V0cHV0LnB1c2goYXgsIGF5KTsKICAgIH0KICB9CiAgc3RhdGljICNkb3VnbGFzUGV1Y2tlcihwb2ludHMpIHsKICAgIGNvbnN0IG91dHB1dCA9IFtdOwogICAgY29uc3QgbGVuID0gcG9pbnRzLmxlbmd0aDsKICAgIHRoaXMuI2RvdWdsYXNQZXVja2VySGVscGVyKHBvaW50cywgMCwgbGVuLCBvdXRwdXQpOwogICAgb3V0cHV0LnB1c2gocG9pbnRzW2xlbiAtIDJdLCBwb2ludHNbbGVuIC0gMV0pOwogICAgcmV0dXJuIG91dHB1dC5sZW5ndGggPD0gNCA/IG51bGwgOiBvdXRwdXQ7CiAgfQogIHN0YXRpYyAjYmlsYXRlcmFsRmlsdGVyKGJ1Ziwgd2lkdGgsIGhlaWdodCwgc2lnbWFTLCBzaWdtYVIsIGtlcm5lbFNpemUpIHsKICAgIGNvbnN0IGtlcm5lbCA9IG5ldyBGbG9hdDMyQXJyYXkoa2VybmVsU2l6ZSAqKiAyKTsKICAgIGNvbnN0IHNpZ21hUzIgPSAtMiAqIHNpZ21hUyAqKiAyOwogICAgY29uc3QgaGFsZlNpemUgPSBrZXJuZWxTaXplID4+IDE7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtlcm5lbFNpemU7IGkrKykgewogICAgICBjb25zdCB4ID0gKGkgLSBoYWxmU2l6ZSkgKiogMjsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBrZXJuZWxTaXplOyBqKyspIHsKICAgICAgICBrZXJuZWxbaSAqIGtlcm5lbFNpemUgKyBqXSA9IE1hdGguZXhwKCh4ICsgKGogLSBoYWxmU2l6ZSkgKiogMikgLyBzaWdtYVMyKTsKICAgICAgfQogICAgfQogICAgY29uc3QgcmFuZ2VWYWx1ZXMgPSBuZXcgRmxvYXQzMkFycmF5KDI1Nik7CiAgICBjb25zdCBzaWdtYVIyID0gLTIgKiBzaWdtYVIgKiogMjsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgcmFuZ2VWYWx1ZXNbaV0gPSBNYXRoLmV4cChpICoqIDIgLyBzaWdtYVIyKTsKICAgIH0KICAgIGNvbnN0IE4gPSBidWYubGVuZ3RoOwogICAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoTik7CiAgICBjb25zdCBoaXN0b2dyYW0gPSBuZXcgVWludDMyQXJyYXkoMjU2KTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgICAgY29uc3QgaWogPSBpICogd2lkdGggKyBqOwogICAgICAgIGNvbnN0IGNlbnRlciA9IGJ1Zltpal07CiAgICAgICAgbGV0IHN1bSA9IDA7CiAgICAgICAgbGV0IG5vcm0gPSAwOwogICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwga2VybmVsU2l6ZTsgaysrKSB7CiAgICAgICAgICBjb25zdCB5ID0gaSArIGsgLSBoYWxmU2l6ZTsKICAgICAgICAgIGlmICh5IDwgMCB8fCB5ID49IGhlaWdodCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsIDwga2VybmVsU2l6ZTsgbCsrKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSBqICsgbCAtIGhhbGZTaXplOwogICAgICAgICAgICBpZiAoeCA8IDAgfHwgeCA+PSB3aWR0aCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG5laWdoYm91ciA9IGJ1Zlt5ICogd2lkdGggKyB4XTsKICAgICAgICAgICAgY29uc3QgdyA9IGtlcm5lbFtrICoga2VybmVsU2l6ZSArIGxdICogcmFuZ2VWYWx1ZXNbTWF0aC5hYnMobmVpZ2hib3VyIC0gY2VudGVyKV07CiAgICAgICAgICAgIHN1bSArPSBuZWlnaGJvdXIgKiB3OwogICAgICAgICAgICBub3JtICs9IHc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBpeCA9IG91dFtpal0gPSBNYXRoLnJvdW5kKHN1bSAvIG5vcm0pOwogICAgICAgIGhpc3RvZ3JhbVtwaXhdKys7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBbb3V0LCBoaXN0b2dyYW1dOwogIH0KICBzdGF0aWMgI2dldEhpc3RvZ3JhbShidWYpIHsKICAgIGNvbnN0IGhpc3RvZ3JhbSA9IG5ldyBVaW50MzJBcnJheSgyNTYpOwogICAgZm9yIChjb25zdCBnIG9mIGJ1ZikgewogICAgICBoaXN0b2dyYW1bZ10rKzsKICAgIH0KICAgIHJldHVybiBoaXN0b2dyYW07CiAgfQogIHN0YXRpYyAjdG9VaW50OChidWYpIHsKICAgIGNvbnN0IE4gPSBidWYubGVuZ3RoOwogICAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KE4gPj4gMik7CiAgICBsZXQgbWF4ID0gLUluZmluaXR5OwogICAgbGV0IG1pbiA9IEluZmluaXR5OwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gb3V0Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgQSA9IGJ1ZlsoaSA8PCAyKSArIDNdOwogICAgICBpZiAoQSA9PT0gMCkgewogICAgICAgIG1heCA9IG91dFtpXSA9IDB4ZmY7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgcGl4ID0gb3V0W2ldID0gYnVmW2kgPDwgMl07CiAgICAgIGlmIChwaXggPiBtYXgpIHsKICAgICAgICBtYXggPSBwaXg7CiAgICAgIH0KICAgICAgaWYgKHBpeCA8IG1pbikgewogICAgICAgIG1pbiA9IHBpeDsKICAgICAgfQogICAgfQogICAgY29uc3QgcmF0aW8gPSAyNTUgLyAobWF4IC0gbWluKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTjsgaSsrKSB7CiAgICAgIG91dFtpXSA9IChvdXRbaV0gLSBtaW4pICogcmF0aW87CiAgICB9CiAgICByZXR1cm4gb3V0OwogIH0KICBzdGF0aWMgI2d1ZXNzVGhyZXNob2xkKGhpc3RvZ3JhbSkgewogICAgbGV0IGk7CiAgICBsZXQgTSA9IC1JbmZpbml0eTsKICAgIGxldCBMID0gLUluZmluaXR5OwogICAgY29uc3QgbWluID0gaGlzdG9ncmFtLmZpbmRJbmRleCh2ID0+IHYgIT09IDApOwogICAgbGV0IHBvcyA9IG1pbjsKICAgIGxldCBzcG9zID0gbWluOwogICAgZm9yIChpID0gbWluOyBpIDwgMjU2OyBpKyspIHsKICAgICAgY29uc3QgdiA9IGhpc3RvZ3JhbVtpXTsKICAgICAgaWYgKHYgPiBNKSB7CiAgICAgICAgaWYgKGkgLSBwb3MgPiBMKSB7CiAgICAgICAgICBMID0gaSAtIHBvczsKICAgICAgICAgIHNwb3MgPSBpIC0gMTsKICAgICAgICB9CiAgICAgICAgTSA9IHY7CiAgICAgICAgcG9zID0gaTsKICAgICAgfQogICAgfQogICAgZm9yIChpID0gc3BvcyAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgIGlmIChoaXN0b2dyYW1baV0gPiBoaXN0b2dyYW1baSArIDFdKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBpOwogIH0KICBzdGF0aWMgI2dldEdyYXlQaXhlbHMoYml0bWFwKSB7CiAgICBjb25zdCBvcmlnaW5hbEJpdG1hcCA9IGJpdG1hcDsKICAgIGNvbnN0IHsKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IGJpdG1hcDsKICAgIGNvbnN0IHsKICAgICAgbWF4RGltCiAgICB9ID0gdGhpcy4jUEFSQU1FVEVSUzsKICAgIGxldCBuZXdXaWR0aCA9IHdpZHRoOwogICAgbGV0IG5ld0hlaWdodCA9IGhlaWdodDsKICAgIGlmICh3aWR0aCA+IG1heERpbSB8fCBoZWlnaHQgPiBtYXhEaW0pIHsKICAgICAgbGV0IHByZXZXaWR0aCA9IHdpZHRoOwogICAgICBsZXQgcHJldkhlaWdodCA9IGhlaWdodDsKICAgICAgbGV0IHN0ZXBzID0gTWF0aC5sb2cyKE1hdGgubWF4KHdpZHRoLCBoZWlnaHQpIC8gbWF4RGltKTsKICAgICAgY29uc3QgaXN0ZXBzID0gTWF0aC5mbG9vcihzdGVwcyk7CiAgICAgIHN0ZXBzID0gc3RlcHMgPT09IGlzdGVwcyA/IGlzdGVwcyAtIDEgOiBpc3RlcHM7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RlcHM7IGkrKykgewogICAgICAgIG5ld1dpZHRoID0gTWF0aC5jZWlsKHByZXZXaWR0aCAvIDIpOwogICAgICAgIG5ld0hlaWdodCA9IE1hdGguY2VpbChwcmV2SGVpZ2h0IC8gMik7CiAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKICAgICAgICBjb25zdCBjdHggPSBvZmZzY3JlZW4uZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICBjdHguZHJhd0ltYWdlKGJpdG1hcCwgMCwgMCwgcHJldldpZHRoLCBwcmV2SGVpZ2h0LCAwLCAwLCBuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKICAgICAgICBwcmV2V2lkdGggPSBuZXdXaWR0aDsKICAgICAgICBwcmV2SGVpZ2h0ID0gbmV3SGVpZ2h0OwogICAgICAgIGlmIChiaXRtYXAgIT09IG9yaWdpbmFsQml0bWFwKSB7CiAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgYml0bWFwID0gb2Zmc2NyZWVuLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgICB9CiAgICAgIGNvbnN0IHJhdGlvID0gTWF0aC5taW4obWF4RGltIC8gbmV3V2lkdGgsIG1heERpbSAvIG5ld0hlaWdodCk7CiAgICAgIG5ld1dpZHRoID0gTWF0aC5yb3VuZChuZXdXaWR0aCAqIHJhdGlvKTsKICAgICAgbmV3SGVpZ2h0ID0gTWF0aC5yb3VuZChuZXdIZWlnaHQgKiByYXRpbyk7CiAgICB9CiAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKG5ld1dpZHRoLCBuZXdIZWlnaHQpOwogICAgY29uc3QgY3R4ID0gb2Zmc2NyZWVuLmdldENvbnRleHQoIjJkIiwgewogICAgICB3aWxsUmVhZEZyZXF1ZW50bHk6IHRydWUKICAgIH0pOwogICAgY3R4LmZpbHRlciA9ICJncmF5c2NhbGUoMSkiOwogICAgY3R4LmRyYXdJbWFnZShiaXRtYXAsIDAsIDAsIGJpdG1hcC53aWR0aCwgYml0bWFwLmhlaWdodCwgMCwgMCwgbmV3V2lkdGgsIG5ld0hlaWdodCk7CiAgICBjb25zdCBncmF5SW1hZ2UgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIG5ld1dpZHRoLCBuZXdIZWlnaHQpLmRhdGE7CiAgICBjb25zdCB1aW50OEJ1ZiA9IHRoaXMuI3RvVWludDgoZ3JheUltYWdlKTsKICAgIHJldHVybiBbdWludDhCdWYsIG5ld1dpZHRoLCBuZXdIZWlnaHRdOwogIH0KICBzdGF0aWMgZXh0cmFjdENvbnRvdXJzRnJvbVRleHQodGV4dCwgewogICAgZm9udEZhbWlseSwKICAgIGZvbnRTdHlsZSwKICAgIGZvbnRXZWlnaHQKICB9LCBwYWdlV2lkdGgsIHBhZ2VIZWlnaHQsIHJvdGF0aW9uLCBpbm5lck1hcmdpbikgewogICAgbGV0IGNhbnZhcyA9IG5ldyBPZmZzY3JlZW5DYW52YXMoMSwgMSk7CiAgICBsZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICBhbHBoYTogZmFsc2UKICAgIH0pOwogICAgY29uc3QgZm9udFNpemUgPSAyMDA7CiAgICBjb25zdCBmb250ID0gY3R4LmZvbnQgPSBgJHtmb250U3R5bGV9ICR7Zm9udFdlaWdodH0gJHtmb250U2l6ZX1weCAke2ZvbnRGYW1pbHl9YDsKICAgIGNvbnN0IHsKICAgICAgYWN0dWFsQm91bmRpbmdCb3hMZWZ0LAogICAgICBhY3R1YWxCb3VuZGluZ0JveFJpZ2h0LAogICAgICBhY3R1YWxCb3VuZGluZ0JveEFzY2VudCwKICAgICAgYWN0dWFsQm91bmRpbmdCb3hEZXNjZW50LAogICAgICBmb250Qm91bmRpbmdCb3hBc2NlbnQsCiAgICAgIGZvbnRCb3VuZGluZ0JveERlc2NlbnQsCiAgICAgIHdpZHRoCiAgICB9ID0gY3R4Lm1lYXN1cmVUZXh0KHRleHQpOwogICAgY29uc3QgU0NBTEUgPSAxLjU7CiAgICBjb25zdCBjYW52YXNXaWR0aCA9IE1hdGguY2VpbChNYXRoLm1heChNYXRoLmFicyhhY3R1YWxCb3VuZGluZ0JveExlZnQpICsgTWF0aC5hYnMoYWN0dWFsQm91bmRpbmdCb3hSaWdodCkgfHwgMCwgd2lkdGgpICogU0NBTEUpOwogICAgY29uc3QgY2FudmFzSGVpZ2h0ID0gTWF0aC5jZWlsKE1hdGgubWF4KE1hdGguYWJzKGFjdHVhbEJvdW5kaW5nQm94QXNjZW50KSArIE1hdGguYWJzKGFjdHVhbEJvdW5kaW5nQm94RGVzY2VudCkgfHwgZm9udFNpemUsIE1hdGguYWJzKGZvbnRCb3VuZGluZ0JveEFzY2VudCkgKyBNYXRoLmFicyhmb250Qm91bmRpbmdCb3hEZXNjZW50KSB8fCBmb250U2l6ZSkgKiBTQ0FMRSk7CiAgICBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpOwogICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICBhbHBoYTogdHJ1ZSwKICAgICAgd2lsbFJlYWRGcmVxdWVudGx5OiB0cnVlCiAgICB9KTsKICAgIGN0eC5mb250ID0gZm9udDsKICAgIGN0eC5maWx0ZXIgPSAiZ3JheXNjYWxlKDEpIjsKICAgIGN0eC5maWxsU3R5bGUgPSAid2hpdGUiOwogICAgY3R4LmZpbGxSZWN0KDAsIDAsIGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpOwogICAgY3R4LmZpbGxTdHlsZSA9ICJibGFjayI7CiAgICBjdHguZmlsbFRleHQodGV4dCwgY2FudmFzV2lkdGggKiAoU0NBTEUgLSAxKSAvIDIsIGNhbnZhc0hlaWdodCAqICgzIC0gU0NBTEUpIC8gMik7CiAgICBjb25zdCB1aW50OEJ1ZiA9IHRoaXMuI3RvVWludDgoY3R4LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KS5kYXRhKTsKICAgIGNvbnN0IGhpc3RvZ3JhbSA9IHRoaXMuI2dldEhpc3RvZ3JhbSh1aW50OEJ1Zik7CiAgICBjb25zdCB0aHJlc2hvbGQgPSB0aGlzLiNndWVzc1RocmVzaG9sZChoaXN0b2dyYW0pOwogICAgY29uc3QgY29udG91ckxpc3QgPSB0aGlzLiNmaW5kQ29udG91cnModWludDhCdWYsIGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQsIHRocmVzaG9sZCk7CiAgICByZXR1cm4gdGhpcy5wcm9jZXNzRHJhd25MaW5lcyh7CiAgICAgIGxpbmVzOiB7CiAgICAgICAgY3VydmVzOiBjb250b3VyTGlzdCwKICAgICAgICB3aWR0aDogY2FudmFzV2lkdGgsCiAgICAgICAgaGVpZ2h0OiBjYW52YXNIZWlnaHQKICAgICAgfSwKICAgICAgcGFnZVdpZHRoLAogICAgICBwYWdlSGVpZ2h0LAogICAgICByb3RhdGlvbiwKICAgICAgaW5uZXJNYXJnaW4sCiAgICAgIG11c3RTbW9vdGg6IHRydWUsCiAgICAgIGFyZUNvbnRvdXJzOiB0cnVlCiAgICB9KTsKICB9CiAgc3RhdGljIHByb2Nlc3MoYml0bWFwLCBwYWdlV2lkdGgsIHBhZ2VIZWlnaHQsIHJvdGF0aW9uLCBpbm5lck1hcmdpbikgewogICAgY29uc3QgW3VpbnQ4QnVmLCB3aWR0aCwgaGVpZ2h0XSA9IHRoaXMuI2dldEdyYXlQaXhlbHMoYml0bWFwKTsKICAgIGNvbnN0IFtidWZmZXIsIGhpc3RvZ3JhbV0gPSB0aGlzLiNiaWxhdGVyYWxGaWx0ZXIodWludDhCdWYsIHdpZHRoLCBoZWlnaHQsIE1hdGguaHlwb3Qod2lkdGgsIGhlaWdodCkgKiB0aGlzLiNQQVJBTUVURVJTLnNpZ21hU0ZhY3RvciwgdGhpcy4jUEFSQU1FVEVSUy5zaWdtYVIsIHRoaXMuI1BBUkFNRVRFUlMua2VybmVsU2l6ZSk7CiAgICBjb25zdCB0aHJlc2hvbGQgPSB0aGlzLiNndWVzc1RocmVzaG9sZChoaXN0b2dyYW0pOwogICAgY29uc3QgY29udG91ckxpc3QgPSB0aGlzLiNmaW5kQ29udG91cnMoYnVmZmVyLCB3aWR0aCwgaGVpZ2h0LCB0aHJlc2hvbGQpOwogICAgcmV0dXJuIHRoaXMucHJvY2Vzc0RyYXduTGluZXMoewogICAgICBsaW5lczogewogICAgICAgIGN1cnZlczogY29udG91ckxpc3QsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0sCiAgICAgIHBhZ2VXaWR0aCwKICAgICAgcGFnZUhlaWdodCwKICAgICAgcm90YXRpb24sCiAgICAgIGlubmVyTWFyZ2luLAogICAgICBtdXN0U21vb3RoOiB0cnVlLAogICAgICBhcmVDb250b3VyczogdHJ1ZQogICAgfSk7CiAgfQogIHN0YXRpYyBwcm9jZXNzRHJhd25MaW5lcyh7CiAgICBsaW5lcywKICAgIHBhZ2VXaWR0aCwKICAgIHBhZ2VIZWlnaHQsCiAgICByb3RhdGlvbiwKICAgIGlubmVyTWFyZ2luLAogICAgbXVzdFNtb290aCwKICAgIGFyZUNvbnRvdXJzCiAgfSkgewogICAgaWYgKHJvdGF0aW9uICUgMTgwICE9PSAwKSB7CiAgICAgIFtwYWdlV2lkdGgsIHBhZ2VIZWlnaHRdID0gW3BhZ2VIZWlnaHQsIHBhZ2VXaWR0aF07CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGN1cnZlcywKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IGxpbmVzOwogICAgY29uc3QgdGhpY2tuZXNzID0gbGluZXMudGhpY2tuZXNzID8/IDA7CiAgICBjb25zdCBsaW5lc0FuZFBvaW50cyA9IFtdOwogICAgY29uc3QgcmF0aW8gPSBNYXRoLm1pbihwYWdlV2lkdGggLyB3aWR0aCwgcGFnZUhlaWdodCAvIGhlaWdodCk7CiAgICBjb25zdCB4U2NhbGUgPSByYXRpbyAvIHBhZ2VXaWR0aDsKICAgIGNvbnN0IHlTY2FsZSA9IHJhdGlvIC8gcGFnZUhlaWdodDsKICAgIGNvbnN0IG5ld0N1cnZlcyA9IFtdOwogICAgZm9yIChjb25zdCB7CiAgICAgIHBvaW50cwogICAgfSBvZiBjdXJ2ZXMpIHsKICAgICAgY29uc3QgcmVkdWNlZFBvaW50cyA9IG11c3RTbW9vdGggPyB0aGlzLiNkb3VnbGFzUGV1Y2tlcihwb2ludHMpIDogcG9pbnRzOwogICAgICBpZiAoIXJlZHVjZWRQb2ludHMpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBuZXdDdXJ2ZXMucHVzaChyZWR1Y2VkUG9pbnRzKTsKICAgICAgY29uc3QgbGVuID0gcmVkdWNlZFBvaW50cy5sZW5ndGg7CiAgICAgIGNvbnN0IG5ld1BvaW50cyA9IG5ldyBGbG9hdDMyQXJyYXkobGVuKTsKICAgICAgY29uc3QgbGluZSA9IG5ldyBGbG9hdDMyQXJyYXkoMyAqIChsZW4gPT09IDIgPyAyIDogbGVuIC0gMikpOwogICAgICBsaW5lc0FuZFBvaW50cy5wdXNoKHsKICAgICAgICBsaW5lLAogICAgICAgIHBvaW50czogbmV3UG9pbnRzCiAgICAgIH0pOwogICAgICBpZiAobGVuID09PSAyKSB7CiAgICAgICAgbmV3UG9pbnRzWzBdID0gcmVkdWNlZFBvaW50c1swXSAqIHhTY2FsZTsKICAgICAgICBuZXdQb2ludHNbMV0gPSByZWR1Y2VkUG9pbnRzWzFdICogeVNjYWxlOwogICAgICAgIGxpbmUuc2V0KFtOYU4sIE5hTiwgTmFOLCBOYU4sIG5ld1BvaW50c1swXSwgbmV3UG9pbnRzWzFdXSwgMCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IFt4MSwgeTEsIHgyLCB5Ml0gPSByZWR1Y2VkUG9pbnRzOwogICAgICB4MSAqPSB4U2NhbGU7CiAgICAgIHkxICo9IHlTY2FsZTsKICAgICAgeDIgKj0geFNjYWxlOwogICAgICB5MiAqPSB5U2NhbGU7CiAgICAgIG5ld1BvaW50cy5zZXQoW3gxLCB5MSwgeDIsIHkyXSwgMCk7CiAgICAgIGxpbmUuc2V0KFtOYU4sIE5hTiwgTmFOLCBOYU4sIHgxLCB5MV0sIDApOwogICAgICBmb3IgKGxldCBpID0gNDsgaSA8IGxlbjsgaSArPSAyKSB7CiAgICAgICAgY29uc3QgeCA9IG5ld1BvaW50c1tpXSA9IHJlZHVjZWRQb2ludHNbaV0gKiB4U2NhbGU7CiAgICAgICAgY29uc3QgeSA9IG5ld1BvaW50c1tpICsgMV0gPSByZWR1Y2VkUG9pbnRzW2kgKyAxXSAqIHlTY2FsZTsKICAgICAgICBsaW5lLnNldChPdXRsaW5lLmNyZWF0ZUJlemllclBvaW50cyh4MSwgeTEsIHgyLCB5MiwgeCwgeSksIChpIC0gMikgKiAzKTsKICAgICAgICBbeDEsIHkxLCB4MiwgeTJdID0gW3gyLCB5MiwgeCwgeV07CiAgICAgIH0KICAgIH0KICAgIGlmIChsaW5lc0FuZFBvaW50cy5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBvdXRsaW5lID0gYXJlQ29udG91cnMgPyBuZXcgQ29udG91ckRyYXdPdXRsaW5lKCkgOiBuZXcgSW5rRHJhd091dGxpbmUoKTsKICAgIG91dGxpbmUuYnVpbGQobGluZXNBbmRQb2ludHMsIHBhZ2VXaWR0aCwgcGFnZUhlaWdodCwgMSwgcm90YXRpb24sIGFyZUNvbnRvdXJzID8gMCA6IHRoaWNrbmVzcywgaW5uZXJNYXJnaW4pOwogICAgcmV0dXJuIHsKICAgICAgb3V0bGluZSwKICAgICAgbmV3Q3VydmVzLAogICAgICBhcmVDb250b3VycywKICAgICAgdGhpY2tuZXNzLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9OwogIH0KICBzdGF0aWMgYXN5bmMgY29tcHJlc3NTaWduYXR1cmUoewogICAgb3V0bGluZXMsCiAgICBhcmVDb250b3VycywKICAgIHRoaWNrbmVzcywKICAgIHdpZHRoLAogICAgaGVpZ2h0CiAgfSkgewogICAgbGV0IG1pbkRpZmYgPSBJbmZpbml0eTsKICAgIGxldCBtYXhEaWZmID0gLUluZmluaXR5OwogICAgbGV0IG91dGxpbmVzTGVuZ3RoID0gMDsKICAgIGZvciAoY29uc3QgcG9pbnRzIG9mIG91dGxpbmVzKSB7CiAgICAgIG91dGxpbmVzTGVuZ3RoICs9IHBvaW50cy5sZW5ndGg7CiAgICAgIGZvciAobGV0IGkgPSAyLCBpaSA9IHBvaW50cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgZHggPSBwb2ludHNbaV0gLSBwb2ludHNbaSAtIDJdOwogICAgICAgIG1pbkRpZmYgPSBNYXRoLm1pbihtaW5EaWZmLCBkeCk7CiAgICAgICAgbWF4RGlmZiA9IE1hdGgubWF4KG1heERpZmYsIGR4KTsKICAgICAgfQogICAgfQogICAgbGV0IGJ1ZmZlclR5cGU7CiAgICBpZiAobWluRGlmZiA+PSAtMTI4ICYmIG1heERpZmYgPD0gMTI3KSB7CiAgICAgIGJ1ZmZlclR5cGUgPSBJbnQ4QXJyYXk7CiAgICB9IGVsc2UgaWYgKG1pbkRpZmYgPj0gLTMyNzY4ICYmIG1heERpZmYgPD0gMzI3NjcpIHsKICAgICAgYnVmZmVyVHlwZSA9IEludDE2QXJyYXk7CiAgICB9IGVsc2UgewogICAgICBidWZmZXJUeXBlID0gSW50MzJBcnJheTsKICAgIH0KICAgIGNvbnN0IGxlbiA9IG91dGxpbmVzLmxlbmd0aDsKICAgIGNvbnN0IGhlYWRlckxlbmd0aCA9IEJBU0VfSEVBREVSX0xFTkdUSCArIFBPSU5UU19QUk9QRVJUSUVTX05VTUJFUiAqIGxlbjsKICAgIGNvbnN0IGhlYWRlciA9IG5ldyBVaW50MzJBcnJheShoZWFkZXJMZW5ndGgpOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICBoZWFkZXJbb2Zmc2V0KytdID0gaGVhZGVyTGVuZ3RoICogVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKyAob3V0bGluZXNMZW5ndGggLSAyICogbGVuKSAqIGJ1ZmZlclR5cGUuQllURVNfUEVSX0VMRU1FTlQ7CiAgICBoZWFkZXJbb2Zmc2V0KytdID0gMDsKICAgIGhlYWRlcltvZmZzZXQrK10gPSB3aWR0aDsKICAgIGhlYWRlcltvZmZzZXQrK10gPSBoZWlnaHQ7CiAgICBoZWFkZXJbb2Zmc2V0KytdID0gYXJlQ29udG91cnMgPyAwIDogMTsKICAgIGhlYWRlcltvZmZzZXQrK10gPSBNYXRoLm1heCgwLCBNYXRoLmZsb29yKHRoaWNrbmVzcyA/PyAwKSk7CiAgICBoZWFkZXJbb2Zmc2V0KytdID0gbGVuOwogICAgaGVhZGVyW29mZnNldCsrXSA9IGJ1ZmZlclR5cGUuQllURVNfUEVSX0VMRU1FTlQ7CiAgICBmb3IgKGNvbnN0IHBvaW50cyBvZiBvdXRsaW5lcykgewogICAgICBoZWFkZXJbb2Zmc2V0KytdID0gcG9pbnRzLmxlbmd0aCAtIDI7CiAgICAgIGhlYWRlcltvZmZzZXQrK10gPSBwb2ludHNbMF07CiAgICAgIGhlYWRlcltvZmZzZXQrK10gPSBwb2ludHNbMV07CiAgICB9CiAgICBjb25zdCBjcyA9IG5ldyBDb21wcmVzc2lvblN0cmVhbSgiZGVmbGF0ZS1yYXciKTsKICAgIGNvbnN0IHdyaXRlciA9IGNzLndyaXRhYmxlLmdldFdyaXRlcigpOwogICAgYXdhaXQgd3JpdGVyLnJlYWR5OwogICAgd3JpdGVyLndyaXRlKGhlYWRlcik7CiAgICBjb25zdCBCdWZmZXJDdG9yID0gYnVmZmVyVHlwZS5wcm90b3R5cGUuY29uc3RydWN0b3I7CiAgICBmb3IgKGNvbnN0IHBvaW50cyBvZiBvdXRsaW5lcykgewogICAgICBjb25zdCBkaWZmcyA9IG5ldyBCdWZmZXJDdG9yKHBvaW50cy5sZW5ndGggLSAyKTsKICAgICAgZm9yIChsZXQgaSA9IDIsIGlpID0gcG9pbnRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBkaWZmc1tpIC0gMl0gPSBwb2ludHNbaV0gLSBwb2ludHNbaSAtIDJdOwogICAgICB9CiAgICAgIHdyaXRlci53cml0ZShkaWZmcyk7CiAgICB9CiAgICB3cml0ZXIuY2xvc2UoKTsKICAgIGNvbnN0IGJ1ZiA9IGF3YWl0IG5ldyBSZXNwb25zZShjcy5yZWFkYWJsZSkuYXJyYXlCdWZmZXIoKTsKICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYnVmKTsKICAgIHJldHVybiB0b0Jhc2U2NFV0aWwoYnl0ZXMpOwogIH0KICBzdGF0aWMgYXN5bmMgZGVjb21wcmVzc1NpZ25hdHVyZShzaWduYXR1cmVEYXRhKSB7CiAgICB0cnkgewogICAgICBjb25zdCBieXRlcyA9IGZyb21CYXNlNjRVdGlsKHNpZ25hdHVyZURhdGEpOwogICAgICBjb25zdCB7CiAgICAgICAgcmVhZGFibGUsCiAgICAgICAgd3JpdGFibGUKICAgICAgfSA9IG5ldyBEZWNvbXByZXNzaW9uU3RyZWFtKCJkZWZsYXRlLXJhdyIpOwogICAgICBjb25zdCB3cml0ZXIgPSB3cml0YWJsZS5nZXRXcml0ZXIoKTsKICAgICAgYXdhaXQgd3JpdGVyLnJlYWR5OwogICAgICB3cml0ZXIud3JpdGUoYnl0ZXMpLnRoZW4oYXN5bmMgKCkgPT4gewogICAgICAgIGF3YWl0IHdyaXRlci5yZWFkeTsKICAgICAgICBhd2FpdCB3cml0ZXIuY2xvc2UoKTsKICAgICAgfSkuY2F0Y2goKCkgPT4ge30pOwogICAgICBsZXQgZGF0YSA9IG51bGw7CiAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHJlYWRhYmxlKSB7CiAgICAgICAgZGF0YSB8fD0gbmV3IFVpbnQ4QXJyYXkobmV3IFVpbnQzMkFycmF5KGNodW5rLmJ1ZmZlciwgMCwgNClbMF0pOwogICAgICAgIGRhdGEuc2V0KGNodW5rLCBvZmZzZXQpOwogICAgICAgIG9mZnNldCArPSBjaHVuay5sZW5ndGg7CiAgICAgIH0KICAgICAgY29uc3QgaGVhZGVyID0gbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyLCAwLCBkYXRhLmxlbmd0aCA+PiAyKTsKICAgICAgY29uc3QgdmVyc2lvbiA9IGhlYWRlclsxXTsKICAgICAgaWYgKHZlcnNpb24gIT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdmVyc2lvbjogJHt2ZXJzaW9ufWApOwogICAgICB9CiAgICAgIGNvbnN0IHdpZHRoID0gaGVhZGVyWzJdOwogICAgICBjb25zdCBoZWlnaHQgPSBoZWFkZXJbM107CiAgICAgIGNvbnN0IGFyZUNvbnRvdXJzID0gaGVhZGVyWzRdID09PSAwOwogICAgICBjb25zdCB0aGlja25lc3MgPSBoZWFkZXJbNV07CiAgICAgIGNvbnN0IG51bWJlck9mRHJhd2luZ3MgPSBoZWFkZXJbNl07CiAgICAgIGNvbnN0IGJ1ZmZlclR5cGUgPSBoZWFkZXJbN107CiAgICAgIGNvbnN0IG91dGxpbmVzID0gW107CiAgICAgIGNvbnN0IGRpZmZzT2Zmc2V0ID0gKEJBU0VfSEVBREVSX0xFTkdUSCArIFBPSU5UU19QUk9QRVJUSUVTX05VTUJFUiAqIG51bWJlck9mRHJhd2luZ3MpICogVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7CiAgICAgIGxldCBkaWZmczsKICAgICAgc3dpdGNoIChidWZmZXJUeXBlKSB7CiAgICAgICAgY2FzZSBJbnQ4QXJyYXkuQllURVNfUEVSX0VMRU1FTlQ6CiAgICAgICAgICBkaWZmcyA9IG5ldyBJbnQ4QXJyYXkoZGF0YS5idWZmZXIsIGRpZmZzT2Zmc2V0KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgSW50MTZBcnJheS5CWVRFU19QRVJfRUxFTUVOVDoKICAgICAgICAgIGRpZmZzID0gbmV3IEludDE2QXJyYXkoZGF0YS5idWZmZXIsIGRpZmZzT2Zmc2V0KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVDoKICAgICAgICAgIGRpZmZzID0gbmV3IEludDMyQXJyYXkoZGF0YS5idWZmZXIsIGRpZmZzT2Zmc2V0KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIG9mZnNldCA9IDA7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZEcmF3aW5nczsgaSsrKSB7CiAgICAgICAgY29uc3QgbGVuID0gaGVhZGVyW1BPSU5UU19QUk9QRVJUSUVTX05VTUJFUiAqIGkgKyBCQVNFX0hFQURFUl9MRU5HVEhdOwogICAgICAgIGNvbnN0IHBvaW50cyA9IG5ldyBGbG9hdDMyQXJyYXkobGVuICsgMik7CiAgICAgICAgb3V0bGluZXMucHVzaChwb2ludHMpOwogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgUE9JTlRTX1BST1BFUlRJRVNfTlVNQkVSIC0gMTsgaisrKSB7CiAgICAgICAgICBwb2ludHNbal0gPSBoZWFkZXJbUE9JTlRTX1BST1BFUlRJRVNfTlVNQkVSICogaSArIEJBU0VfSEVBREVSX0xFTkdUSCArIGogKyAxXTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW47IGorKykgewogICAgICAgICAgcG9pbnRzW2ogKyAyXSA9IHBvaW50c1tqXSArIGRpZmZzW29mZnNldCsrXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBhcmVDb250b3VycywKICAgICAgICB0aGlja25lc3MsCiAgICAgICAgb3V0bGluZXMsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH07CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHdhcm4oYGRlY29tcHJlc3NTaWduYXR1cmU6ICR7ZX1gKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9lZGl0b3Ivc2lnbmF0dXJlLmpzCgoKCgoKCgpjbGFzcyBTaWduYXR1cmVPcHRpb25zIGV4dGVuZHMgRHJhd2luZ09wdGlvbnMgewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoKTsKICAgIHN1cGVyLnVwZGF0ZVByb3BlcnRpZXMoewogICAgICBmaWxsOiBBbm5vdGF0aW9uRWRpdG9yLl9kZWZhdWx0TGluZUNvbG9yLAogICAgICAic3Ryb2tlLXdpZHRoIjogMAogICAgfSk7CiAgfQogIGNsb25lKCkgewogICAgY29uc3QgY2xvbmUgPSBuZXcgU2lnbmF0dXJlT3B0aW9ucygpOwogICAgY2xvbmUudXBkYXRlQWxsKHRoaXMpOwogICAgcmV0dXJuIGNsb25lOwogIH0KfQpjbGFzcyBEcmF3blNpZ25hdHVyZU9wdGlvbnMgZXh0ZW5kcyBJbmtEcmF3aW5nT3B0aW9ucyB7CiAgY29uc3RydWN0b3Iodmlld2VyUGFyYW1ldGVycykgewogICAgc3VwZXIodmlld2VyUGFyYW1ldGVycyk7CiAgICBzdXBlci51cGRhdGVQcm9wZXJ0aWVzKHsKICAgICAgc3Ryb2tlOiBBbm5vdGF0aW9uRWRpdG9yLl9kZWZhdWx0TGluZUNvbG9yLAogICAgICAic3Ryb2tlLXdpZHRoIjogMQogICAgfSk7CiAgfQogIGNsb25lKCkgewogICAgY29uc3QgY2xvbmUgPSBuZXcgRHJhd25TaWduYXR1cmVPcHRpb25zKHRoaXMuX3ZpZXdQYXJhbWV0ZXJzKTsKICAgIGNsb25lLnVwZGF0ZUFsbCh0aGlzKTsKICAgIHJldHVybiBjbG9uZTsKICB9Cn0KY2xhc3MgU2lnbmF0dXJlRWRpdG9yIGV4dGVuZHMgRHJhd2luZ0VkaXRvciB7CiAgI2lzRXh0cmFjdGVkID0gZmFsc2U7CiAgI2Rlc2NyaXB0aW9uID0gbnVsbDsKICAjc2lnbmF0dXJlRGF0YSA9IG51bGw7CiAgI3NpZ25hdHVyZVVVSUQgPSBudWxsOwogIHN0YXRpYyBfdHlwZSA9ICJzaWduYXR1cmUiOwogIHN0YXRpYyBfZWRpdG9yVHlwZSA9IEFubm90YXRpb25FZGl0b3JUeXBlLlNJR05BVFVSRTsKICBzdGF0aWMgX2RlZmF1bHREcmF3aW5nT3B0aW9ucyA9IG51bGw7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcih7CiAgICAgIC4uLnBhcmFtcywKICAgICAgbXVzdEJlQ29tbWl0dGVkOiB0cnVlLAogICAgICBuYW1lOiAic2lnbmF0dXJlRWRpdG9yIgogICAgfSk7CiAgICB0aGlzLl93aWxsS2VlcEFzcGVjdFJhdGlvID0gdHJ1ZTsKICAgIHRoaXMuI3NpZ25hdHVyZURhdGEgPSBwYXJhbXMuc2lnbmF0dXJlRGF0YSB8fCBudWxsOwogICAgdGhpcy4jZGVzY3JpcHRpb24gPSBudWxsOwogICAgdGhpcy5kZWZhdWx0TDEwbklkID0gInBkZmpzLWVkaXRvci1zaWduYXR1cmUtZWRpdG9yMSI7CiAgfQogIHN0YXRpYyBpbml0aWFsaXplKGwxMG4sIHVpTWFuYWdlcikgewogICAgQW5ub3RhdGlvbkVkaXRvci5pbml0aWFsaXplKGwxMG4sIHVpTWFuYWdlcik7CiAgICB0aGlzLl9kZWZhdWx0RHJhd2luZ09wdGlvbnMgPSBuZXcgU2lnbmF0dXJlT3B0aW9ucygpOwogICAgdGhpcy5fZGVmYXVsdERyYXduU2lnbmF0dXJlT3B0aW9ucyA9IG5ldyBEcmF3blNpZ25hdHVyZU9wdGlvbnModWlNYW5hZ2VyLnZpZXdQYXJhbWV0ZXJzKTsKICB9CiAgc3RhdGljIGdldERlZmF1bHREcmF3aW5nT3B0aW9ucyhvcHRpb25zKSB7CiAgICBjb25zdCBjbG9uZSA9IHRoaXMuX2RlZmF1bHREcmF3aW5nT3B0aW9ucy5jbG9uZSgpOwogICAgY2xvbmUudXBkYXRlUHJvcGVydGllcyhvcHRpb25zKTsKICAgIHJldHVybiBjbG9uZTsKICB9CiAgc3RhdGljIGdldCBzdXBwb3J0TXVsdGlwbGVEcmF3aW5ncygpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgc3RhdGljIGdldCB0eXBlc01hcCgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgInR5cGVzTWFwIiwgbmV3IE1hcCgpKTsKICB9CiAgc3RhdGljIGdldCBpc0RyYXdlcigpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0IHRlbGVtZXRyeUZpbmFsRGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6ICJzaWduYXR1cmUiLAogICAgICBoYXNEZXNjcmlwdGlvbjogISF0aGlzLiNkZXNjcmlwdGlvbgogICAgfTsKICB9CiAgc3RhdGljIGNvbXB1dGVUZWxlbWV0cnlGaW5hbERhdGEoZGF0YSkgewogICAgY29uc3QgaGFzRGVzY3JpcHRpb25TdGF0cyA9IGRhdGEuZ2V0KCJoYXNEZXNjcmlwdGlvbiIpOwogICAgcmV0dXJuIHsKICAgICAgaGFzQWx0VGV4dDogaGFzRGVzY3JpcHRpb25TdGF0cy5nZXQodHJ1ZSkgPz8gMCwKICAgICAgaGFzTm9BbHRUZXh0OiBoYXNEZXNjcmlwdGlvblN0YXRzLmdldChmYWxzZSkgPz8gMAogICAgfTsKICB9CiAgZ2V0IGlzUmVzaXphYmxlKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIG9uU2NhbGVDaGFuZ2luZygpIHsKICAgIGlmICh0aGlzLl9kcmF3SWQgPT09IG51bGwpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3VwZXIub25TY2FsZUNoYW5naW5nKCk7CiAgfQogIHJlbmRlcigpIHsKICAgIGlmICh0aGlzLmRpdikgewogICAgICByZXR1cm4gdGhpcy5kaXY7CiAgICB9CiAgICBsZXQgYmFzZVgsIGJhc2VZOwogICAgY29uc3QgewogICAgICBfaXNDb3B5CiAgICB9ID0gdGhpczsKICAgIGlmIChfaXNDb3B5KSB7CiAgICAgIHRoaXMuX2lzQ29weSA9IGZhbHNlOwogICAgICBiYXNlWCA9IHRoaXMueDsKICAgICAgYmFzZVkgPSB0aGlzLnk7CiAgICB9CiAgICBzdXBlci5yZW5kZXIoKTsKICAgIGlmICh0aGlzLl9kcmF3SWQgPT09IG51bGwpIHsKICAgICAgaWYgKHRoaXMuI3NpZ25hdHVyZURhdGEpIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBsaW5lcywKICAgICAgICAgIG11c3RTbW9vdGgsCiAgICAgICAgICBhcmVDb250b3VycywKICAgICAgICAgIGRlc2NyaXB0aW9uLAogICAgICAgICAgdXVpZCwKICAgICAgICAgIGhlaWdodEluUGFnZQogICAgICAgIH0gPSB0aGlzLiNzaWduYXR1cmVEYXRhOwogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHJhd0RpbXM6IHsKICAgICAgICAgICAgcGFnZVdpZHRoLAogICAgICAgICAgICBwYWdlSGVpZ2h0CiAgICAgICAgICB9LAogICAgICAgICAgcm90YXRpb24KICAgICAgICB9ID0gdGhpcy5wYXJlbnQudmlld3BvcnQ7CiAgICAgICAgY29uc3Qgb3V0bGluZSA9IFNpZ25hdHVyZUV4dHJhY3Rvci5wcm9jZXNzRHJhd25MaW5lcyh7CiAgICAgICAgICBsaW5lcywKICAgICAgICAgIHBhZ2VXaWR0aCwKICAgICAgICAgIHBhZ2VIZWlnaHQsCiAgICAgICAgICByb3RhdGlvbiwKICAgICAgICAgIGlubmVyTWFyZ2luOiBTaWduYXR1cmVFZGl0b3IuX0lOTkVSX01BUkdJTiwKICAgICAgICAgIG11c3RTbW9vdGgsCiAgICAgICAgICBhcmVDb250b3VycwogICAgICAgIH0pOwogICAgICAgIHRoaXMuYWRkU2lnbmF0dXJlKG91dGxpbmUsIGhlaWdodEluUGFnZSwgZGVzY3JpcHRpb24sIHV1aWQpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWFyZ3MiLCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICBkZXNjcmlwdGlvbjogIiIKICAgICAgICB9KSk7CiAgICAgICAgdGhpcy5kaXYuaGlkZGVuID0gdHJ1ZTsKICAgICAgICB0aGlzLl91aU1hbmFnZXIuZ2V0U2lnbmF0dXJlKHRoaXMpOwogICAgICB9CiAgICB9CiAgICBpZiAoX2lzQ29weSkgewogICAgICB0aGlzLl9pc0NvcHkgPSB0cnVlOwogICAgICB0aGlzLl9tb3ZlQWZ0ZXJQYXN0ZShiYXNlWCwgYmFzZVkpOwogICAgfQogICAgcmV0dXJuIHRoaXMuZGl2OwogIH0KICBzZXRVdWlkKHV1aWQpIHsKICAgIHRoaXMuI3NpZ25hdHVyZVVVSUQgPSB1dWlkOwogICAgdGhpcy5hZGRFZGl0VG9vbGJhcigpOwogIH0KICBnZXRVdWlkKCkgewogICAgcmV0dXJuIHRoaXMuI3NpZ25hdHVyZVVVSUQ7CiAgfQogIGdldCBkZXNjcmlwdGlvbigpIHsKICAgIHJldHVybiB0aGlzLiNkZXNjcmlwdGlvbjsKICB9CiAgc2V0IGRlc2NyaXB0aW9uKGRlc2NyaXB0aW9uKSB7CiAgICB0aGlzLiNkZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uOwogICAgc3VwZXIuYWRkRWRpdFRvb2xiYXIoKS50aGVuKHRvb2xiYXIgPT4gewogICAgICB0b29sYmFyPy51cGRhdGVFZGl0U2lnbmF0dXJlQnV0dG9uKGRlc2NyaXB0aW9uKTsKICAgIH0pOwogIH0KICBnZXRTaWduYXR1cmVQcmV2aWV3KCkgewogICAgY29uc3QgewogICAgICBuZXdDdXJ2ZXMsCiAgICAgIGFyZUNvbnRvdXJzLAogICAgICB0aGlja25lc3MsCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSB0aGlzLiNzaWduYXR1cmVEYXRhOwogICAgY29uc3QgbWF4RGltID0gTWF0aC5tYXgod2lkdGgsIGhlaWdodCk7CiAgICBjb25zdCBvdXRsaW5lRGF0YSA9IFNpZ25hdHVyZUV4dHJhY3Rvci5wcm9jZXNzRHJhd25MaW5lcyh7CiAgICAgIGxpbmVzOiB7CiAgICAgICAgY3VydmVzOiBuZXdDdXJ2ZXMubWFwKHBvaW50cyA9PiAoewogICAgICAgICAgcG9pbnRzCiAgICAgICAgfSkpLAogICAgICAgIHRoaWNrbmVzcywKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQKICAgICAgfSwKICAgICAgcGFnZVdpZHRoOiBtYXhEaW0sCiAgICAgIHBhZ2VIZWlnaHQ6IG1heERpbSwKICAgICAgcm90YXRpb246IDAsCiAgICAgIGlubmVyTWFyZ2luOiAwLAogICAgICBtdXN0U21vb3RoOiBmYWxzZSwKICAgICAgYXJlQ29udG91cnMKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgYXJlQ29udG91cnMsCiAgICAgIG91dGxpbmU6IG91dGxpbmVEYXRhLm91dGxpbmUKICAgIH07CiAgfQogIGFzeW5jIGFkZEVkaXRUb29sYmFyKCkgewogICAgY29uc3QgdG9vbGJhciA9IGF3YWl0IHN1cGVyLmFkZEVkaXRUb29sYmFyKCk7CiAgICBpZiAoIXRvb2xiYXIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAodGhpcy5fdWlNYW5hZ2VyLnNpZ25hdHVyZU1hbmFnZXIgJiYgdGhpcy4jZGVzY3JpcHRpb24gIT09IG51bGwpIHsKICAgICAgYXdhaXQgdG9vbGJhci5hZGRFZGl0U2lnbmF0dXJlQnV0dG9uKHRoaXMuX3VpTWFuYWdlci5zaWduYXR1cmVNYW5hZ2VyLCB0aGlzLiNzaWduYXR1cmVVVUlELCB0aGlzLiNkZXNjcmlwdGlvbik7CiAgICAgIHRvb2xiYXIuc2hvdygpOwogICAgfQogICAgcmV0dXJuIHRvb2xiYXI7CiAgfQogIGFkZFNpZ25hdHVyZShkYXRhLCBoZWlnaHRJblBhZ2UsIGRlc2NyaXB0aW9uLCB1dWlkKSB7CiAgICBjb25zdCB7CiAgICAgIHg6IHNhdmVkWCwKICAgICAgeTogc2F2ZWRZCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHsKICAgICAgb3V0bGluZQogICAgfSA9IHRoaXMuI3NpZ25hdHVyZURhdGEgPSBkYXRhOwogICAgdGhpcy4jaXNFeHRyYWN0ZWQgPSBvdXRsaW5lIGluc3RhbmNlb2YgQ29udG91ckRyYXdPdXRsaW5lOwogICAgdGhpcy4jZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjsKICAgIHRoaXMuZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWFyZ3MiLCBKU09OLnN0cmluZ2lmeSh7CiAgICAgIGRlc2NyaXB0aW9uCiAgICB9KSk7CiAgICBsZXQgZHJhd2luZ09wdGlvbnM7CiAgICBpZiAodGhpcy4jaXNFeHRyYWN0ZWQpIHsKICAgICAgZHJhd2luZ09wdGlvbnMgPSBTaWduYXR1cmVFZGl0b3IuZ2V0RGVmYXVsdERyYXdpbmdPcHRpb25zKCk7CiAgICB9IGVsc2UgewogICAgICBkcmF3aW5nT3B0aW9ucyA9IFNpZ25hdHVyZUVkaXRvci5fZGVmYXVsdERyYXduU2lnbmF0dXJlT3B0aW9ucy5jbG9uZSgpOwogICAgICBkcmF3aW5nT3B0aW9ucy51cGRhdGVQcm9wZXJ0aWVzKHsKICAgICAgICAic3Ryb2tlLXdpZHRoIjogb3V0bGluZS50aGlja25lc3MKICAgICAgfSk7CiAgICB9CiAgICB0aGlzLl9hZGRPdXRsaW5lcyh7CiAgICAgIGRyYXdPdXRsaW5lczogb3V0bGluZSwKICAgICAgZHJhd2luZ09wdGlvbnMKICAgIH0pOwogICAgY29uc3QgW3BhcmVudFdpZHRoLCBwYXJlbnRIZWlnaHRdID0gdGhpcy5wYXJlbnREaW1lbnNpb25zOwogICAgY29uc3QgWywgcGFnZUhlaWdodF0gPSB0aGlzLnBhZ2VEaW1lbnNpb25zOwogICAgbGV0IG5ld0hlaWdodCA9IGhlaWdodEluUGFnZSAvIHBhZ2VIZWlnaHQ7CiAgICBuZXdIZWlnaHQgPSBuZXdIZWlnaHQgPj0gMSA/IDAuNSA6IG5ld0hlaWdodDsKICAgIHRoaXMud2lkdGggKj0gbmV3SGVpZ2h0IC8gdGhpcy5oZWlnaHQ7CiAgICBpZiAodGhpcy53aWR0aCA+PSAxKSB7CiAgICAgIG5ld0hlaWdodCAqPSAwLjkgLyB0aGlzLndpZHRoOwogICAgICB0aGlzLndpZHRoID0gMC45OwogICAgfQogICAgdGhpcy5oZWlnaHQgPSBuZXdIZWlnaHQ7CiAgICB0aGlzLnNldERpbXMocGFyZW50V2lkdGggKiB0aGlzLndpZHRoLCBwYXJlbnRIZWlnaHQgKiB0aGlzLmhlaWdodCk7CiAgICB0aGlzLnggPSBzYXZlZFg7CiAgICB0aGlzLnkgPSBzYXZlZFk7CiAgICB0aGlzLmNlbnRlcigpOwogICAgdGhpcy5fb25SZXNpemVkKCk7CiAgICB0aGlzLm9uU2NhbGVDaGFuZ2luZygpOwogICAgdGhpcy5yb3RhdGUoKTsKICAgIHRoaXMuX3VpTWFuYWdlci5hZGRUb0Fubm90YXRpb25TdG9yYWdlKHRoaXMpOwogICAgdGhpcy5zZXRVdWlkKHV1aWQpOwogICAgdGhpcy5fcmVwb3J0VGVsZW1ldHJ5KHsKICAgICAgYWN0aW9uOiAicGRmanMuc2lnbmF0dXJlLmluc2VydGVkIiwKICAgICAgZGF0YTogewogICAgICAgIGhhc0JlZW5TYXZlZDogISF1dWlkLAogICAgICAgIGhhc0Rlc2NyaXB0aW9uOiAhIWRlc2NyaXB0aW9uCiAgICAgIH0KICAgIH0pOwogICAgdGhpcy5kaXYuaGlkZGVuID0gZmFsc2U7CiAgfQogIGdldEZyb21JbWFnZShiaXRtYXApIHsKICAgIGNvbnN0IHsKICAgICAgcmF3RGltczogewogICAgICAgIHBhZ2VXaWR0aCwKICAgICAgICBwYWdlSGVpZ2h0CiAgICAgIH0sCiAgICAgIHJvdGF0aW9uCiAgICB9ID0gdGhpcy5wYXJlbnQudmlld3BvcnQ7CiAgICByZXR1cm4gU2lnbmF0dXJlRXh0cmFjdG9yLnByb2Nlc3MoYml0bWFwLCBwYWdlV2lkdGgsIHBhZ2VIZWlnaHQsIHJvdGF0aW9uLCBTaWduYXR1cmVFZGl0b3IuX0lOTkVSX01BUkdJTik7CiAgfQogIGdldEZyb21UZXh0KHRleHQsIGZvbnRJbmZvKSB7CiAgICBjb25zdCB7CiAgICAgIHJhd0RpbXM6IHsKICAgICAgICBwYWdlV2lkdGgsCiAgICAgICAgcGFnZUhlaWdodAogICAgICB9LAogICAgICByb3RhdGlvbgogICAgfSA9IHRoaXMucGFyZW50LnZpZXdwb3J0OwogICAgcmV0dXJuIFNpZ25hdHVyZUV4dHJhY3Rvci5leHRyYWN0Q29udG91cnNGcm9tVGV4dCh0ZXh0LCBmb250SW5mbywgcGFnZVdpZHRoLCBwYWdlSGVpZ2h0LCByb3RhdGlvbiwgU2lnbmF0dXJlRWRpdG9yLl9JTk5FUl9NQVJHSU4pOwogIH0KICBnZXREcmF3blNpZ25hdHVyZShjdXJ2ZXMpIHsKICAgIGNvbnN0IHsKICAgICAgcmF3RGltczogewogICAgICAgIHBhZ2VXaWR0aCwKICAgICAgICBwYWdlSGVpZ2h0CiAgICAgIH0sCiAgICAgIHJvdGF0aW9uCiAgICB9ID0gdGhpcy5wYXJlbnQudmlld3BvcnQ7CiAgICByZXR1cm4gU2lnbmF0dXJlRXh0cmFjdG9yLnByb2Nlc3NEcmF3bkxpbmVzKHsKICAgICAgbGluZXM6IGN1cnZlcywKICAgICAgcGFnZVdpZHRoLAogICAgICBwYWdlSGVpZ2h0LAogICAgICByb3RhdGlvbiwKICAgICAgaW5uZXJNYXJnaW46IFNpZ25hdHVyZUVkaXRvci5fSU5ORVJfTUFSR0lOLAogICAgICBtdXN0U21vb3RoOiBmYWxzZSwKICAgICAgYXJlQ29udG91cnM6IGZhbHNlCiAgICB9KTsKICB9CiAgY3JlYXRlRHJhd2luZ09wdGlvbnMoewogICAgYXJlQ29udG91cnMsCiAgICB0aGlja25lc3MKICB9KSB7CiAgICBpZiAoYXJlQ29udG91cnMpIHsKICAgICAgdGhpcy5fZHJhd2luZ09wdGlvbnMgPSBTaWduYXR1cmVFZGl0b3IuZ2V0RGVmYXVsdERyYXdpbmdPcHRpb25zKCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9kcmF3aW5nT3B0aW9ucyA9IFNpZ25hdHVyZUVkaXRvci5fZGVmYXVsdERyYXduU2lnbmF0dXJlT3B0aW9ucy5jbG9uZSgpOwogICAgICB0aGlzLl9kcmF3aW5nT3B0aW9ucy51cGRhdGVQcm9wZXJ0aWVzKHsKICAgICAgICAic3Ryb2tlLXdpZHRoIjogdGhpY2tuZXNzCiAgICAgIH0pOwogICAgfQogIH0KICBzZXJpYWxpemUoaXNGb3JDb3B5aW5nID0gZmFsc2UpIHsKICAgIGlmICh0aGlzLmlzRW1wdHkoKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgbGluZXMsCiAgICAgIHBvaW50cywKICAgICAgcmVjdAogICAgfSA9IHRoaXMuc2VyaWFsaXplRHJhdyhpc0ZvckNvcHlpbmcpOwogICAgY29uc3QgewogICAgICBfZHJhd2luZ09wdGlvbnM6IHsKICAgICAgICAic3Ryb2tlLXdpZHRoIjogdGhpY2tuZXNzCiAgICAgIH0KICAgIH0gPSB0aGlzOwogICAgY29uc3Qgc2VyaWFsaXplZCA9IHsKICAgICAgYW5ub3RhdGlvblR5cGU6IEFubm90YXRpb25FZGl0b3JUeXBlLlNJR05BVFVSRSwKICAgICAgaXNTaWduYXR1cmU6IHRydWUsCiAgICAgIGFyZUNvbnRvdXJzOiB0aGlzLiNpc0V4dHJhY3RlZCwKICAgICAgY29sb3I6IFswLCAwLCAwXSwKICAgICAgdGhpY2tuZXNzOiB0aGlzLiNpc0V4dHJhY3RlZCA/IDAgOiB0aGlja25lc3MsCiAgICAgIHBhZ2VJbmRleDogdGhpcy5wYWdlSW5kZXgsCiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAogICAgICBzdHJ1Y3RUcmVlUGFyZW50SWQ6IHRoaXMuX3N0cnVjdFRyZWVQYXJlbnRJZAogICAgfTsKICAgIGlmIChpc0ZvckNvcHlpbmcpIHsKICAgICAgc2VyaWFsaXplZC5wYXRocyA9IHsKICAgICAgICBsaW5lcywKICAgICAgICBwb2ludHMKICAgICAgfTsKICAgICAgc2VyaWFsaXplZC51dWlkID0gdGhpcy4jc2lnbmF0dXJlVVVJRDsKICAgICAgc2VyaWFsaXplZC5pc0NvcHkgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgc2VyaWFsaXplZC5saW5lcyA9IGxpbmVzOwogICAgfQogICAgaWYgKHRoaXMuI2Rlc2NyaXB0aW9uKSB7CiAgICAgIHNlcmlhbGl6ZWQuYWNjZXNzaWJpbGl0eURhdGEgPSB7CiAgICAgICAgdHlwZTogIkZpZ3VyZSIsCiAgICAgICAgYWx0OiB0aGlzLiNkZXNjcmlwdGlvbgogICAgICB9OwogICAgfQogICAgcmV0dXJuIHNlcmlhbGl6ZWQ7CiAgfQogIHN0YXRpYyBkZXNlcmlhbGl6ZURyYXcocGFnZVgsIHBhZ2VZLCBwYWdlV2lkdGgsIHBhZ2VIZWlnaHQsIGlubmVyTWFyZ2luLCBkYXRhKSB7CiAgICBpZiAoZGF0YS5hcmVDb250b3VycykgewogICAgICByZXR1cm4gQ29udG91ckRyYXdPdXRsaW5lLmRlc2VyaWFsaXplKHBhZ2VYLCBwYWdlWSwgcGFnZVdpZHRoLCBwYWdlSGVpZ2h0LCBpbm5lck1hcmdpbiwgZGF0YSk7CiAgICB9CiAgICByZXR1cm4gSW5rRHJhd091dGxpbmUuZGVzZXJpYWxpemUocGFnZVgsIHBhZ2VZLCBwYWdlV2lkdGgsIHBhZ2VIZWlnaHQsIGlubmVyTWFyZ2luLCBkYXRhKTsKICB9CiAgc3RhdGljIGFzeW5jIGRlc2VyaWFsaXplKGRhdGEsIHBhcmVudCwgdWlNYW5hZ2VyKSB7CiAgICBjb25zdCBlZGl0b3IgPSBhd2FpdCBzdXBlci5kZXNlcmlhbGl6ZShkYXRhLCBwYXJlbnQsIHVpTWFuYWdlcik7CiAgICBlZGl0b3IuI2lzRXh0cmFjdGVkID0gZGF0YS5hcmVDb250b3VyczsKICAgIGVkaXRvci4jZGVzY3JpcHRpb24gPSBkYXRhLmFjY2Vzc2liaWxpdHlEYXRhPy5hbHQgfHwgIiI7CiAgICBlZGl0b3IuI3NpZ25hdHVyZVVVSUQgPSBkYXRhLnV1aWQ7CiAgICByZXR1cm4gZWRpdG9yOwogIH0KfQoKOy8vIC4vc3JjL2Rpc3BsYXkvZWRpdG9yL3N0YW1wLmpzCgoKCgpjbGFzcyBTdGFtcEVkaXRvciBleHRlbmRzIEFubm90YXRpb25FZGl0b3IgewogICNiaXRtYXAgPSBudWxsOwogICNiaXRtYXBJZCA9IG51bGw7CiAgI2JpdG1hcFByb21pc2UgPSBudWxsOwogICNiaXRtYXBVcmwgPSBudWxsOwogICNiaXRtYXBGaWxlID0gbnVsbDsKICAjYml0bWFwRmlsZU5hbWUgPSAiIjsKICAjY2FudmFzID0gbnVsbDsKICAjbWlzc2luZ0NhbnZhcyA9IGZhbHNlOwogICNyZXNpemVUaW1lb3V0SWQgPSBudWxsOwogICNpc1N2ZyA9IGZhbHNlOwogICNoYXNCZWVuQWRkZWRJblVuZG9TdGFjayA9IGZhbHNlOwogIHN0YXRpYyBfdHlwZSA9ICJzdGFtcCI7CiAgc3RhdGljIF9lZGl0b3JUeXBlID0gQW5ub3RhdGlvbkVkaXRvclR5cGUuU1RBTVA7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcih7CiAgICAgIC4uLnBhcmFtcywKICAgICAgbmFtZTogInN0YW1wRWRpdG9yIgogICAgfSk7CiAgICB0aGlzLiNiaXRtYXBVcmwgPSBwYXJhbXMuYml0bWFwVXJsOwogICAgdGhpcy4jYml0bWFwRmlsZSA9IHBhcmFtcy5iaXRtYXBGaWxlOwogICAgdGhpcy5kZWZhdWx0TDEwbklkID0gInBkZmpzLWVkaXRvci1zdGFtcC1lZGl0b3IiOwogIH0KICBzdGF0aWMgaW5pdGlhbGl6ZShsMTBuLCB1aU1hbmFnZXIpIHsKICAgIEFubm90YXRpb25FZGl0b3IuaW5pdGlhbGl6ZShsMTBuLCB1aU1hbmFnZXIpOwogIH0KICBzdGF0aWMgaXNIYW5kbGluZ01pbWVGb3JQYXN0aW5nKG1pbWUpIHsKICAgIHJldHVybiBTdXBwb3J0ZWRJbWFnZU1pbWVUeXBlcy5pbmNsdWRlcyhtaW1lKTsKICB9CiAgc3RhdGljIHBhc3RlKGl0ZW0sIHBhcmVudCkgewogICAgcGFyZW50LnBhc3RlRWRpdG9yKHsKICAgICAgbW9kZTogQW5ub3RhdGlvbkVkaXRvclR5cGUuU1RBTVAKICAgIH0sIHsKICAgICAgYml0bWFwRmlsZTogaXRlbS5nZXRBc0ZpbGUoKQogICAgfSk7CiAgfQogIGFsdFRleHRGaW5pc2goKSB7CiAgICBpZiAodGhpcy5fdWlNYW5hZ2VyLnVzZU5ld0FsdFRleHRGbG93KSB7CiAgICAgIHRoaXMuZGl2LmhpZGRlbiA9IGZhbHNlOwogICAgfQogICAgc3VwZXIuYWx0VGV4dEZpbmlzaCgpOwogIH0KICBnZXQgdGVsZW1ldHJ5RmluYWxEYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogInN0YW1wIiwKICAgICAgaGFzQWx0VGV4dDogISF0aGlzLmFsdFRleHREYXRhPy5hbHRUZXh0CiAgICB9OwogIH0KICBzdGF0aWMgY29tcHV0ZVRlbGVtZXRyeUZpbmFsRGF0YShkYXRhKSB7CiAgICBjb25zdCBoYXNBbHRUZXh0U3RhdHMgPSBkYXRhLmdldCgiaGFzQWx0VGV4dCIpOwogICAgcmV0dXJuIHsKICAgICAgaGFzQWx0VGV4dDogaGFzQWx0VGV4dFN0YXRzLmdldCh0cnVlKSA/PyAwLAogICAgICBoYXNOb0FsdFRleHQ6IGhhc0FsdFRleHRTdGF0cy5nZXQoZmFsc2UpID8/IDAKICAgIH07CiAgfQogICNnZXRCaXRtYXBGZXRjaGVkKGRhdGEsIGZyb21JZCA9IGZhbHNlKSB7CiAgICBpZiAoIWRhdGEpIHsKICAgICAgdGhpcy5yZW1vdmUoKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jYml0bWFwID0gZGF0YS5iaXRtYXA7CiAgICBpZiAoIWZyb21JZCkgewogICAgICB0aGlzLiNiaXRtYXBJZCA9IGRhdGEuaWQ7CiAgICAgIHRoaXMuI2lzU3ZnID0gZGF0YS5pc1N2ZzsKICAgIH0KICAgIGlmIChkYXRhLmZpbGUpIHsKICAgICAgdGhpcy4jYml0bWFwRmlsZU5hbWUgPSBkYXRhLmZpbGUubmFtZTsKICAgIH0KICAgIHRoaXMuI2NyZWF0ZUNhbnZhcygpOwogIH0KICAjZ2V0Qml0bWFwRG9uZSgpIHsKICAgIHRoaXMuI2JpdG1hcFByb21pc2UgPSBudWxsOwogICAgdGhpcy5fdWlNYW5hZ2VyLmVuYWJsZVdhaXRpbmcoZmFsc2UpOwogICAgaWYgKCF0aGlzLiNjYW52YXMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX3VpTWFuYWdlci51c2VOZXdBbHRUZXh0V2hlbkFkZGluZ0ltYWdlICYmIHRoaXMuX3VpTWFuYWdlci51c2VOZXdBbHRUZXh0RmxvdyAmJiB0aGlzLiNiaXRtYXApIHsKICAgICAgdGhpcy5fZWRpdFRvb2xiYXIuaGlkZSgpOwogICAgICB0aGlzLl91aU1hbmFnZXIuZWRpdEFsdFRleHQodGhpcywgdHJ1ZSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpcy5fdWlNYW5hZ2VyLnVzZU5ld0FsdFRleHRXaGVuQWRkaW5nSW1hZ2UgJiYgdGhpcy5fdWlNYW5hZ2VyLnVzZU5ld0FsdFRleHRGbG93ICYmIHRoaXMuI2JpdG1hcCkgewogICAgICB0aGlzLl9yZXBvcnRUZWxlbWV0cnkoewogICAgICAgIGFjdGlvbjogInBkZmpzLmltYWdlLmltYWdlX2FkZGVkIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBhbHRfdGV4dF9tb2RhbDogZmFsc2UsCiAgICAgICAgICBhbHRfdGV4dF90eXBlOiAiZW1wdHkiCiAgICAgICAgfQogICAgICB9KTsKICAgICAgdHJ5IHsKICAgICAgICB0aGlzLm1sR3Vlc3NBbHRUZXh0KCk7CiAgICAgIH0gY2F0Y2gge30KICAgIH0KICAgIHRoaXMuZGl2LmZvY3VzKCk7CiAgfQogIGFzeW5jIG1sR3Vlc3NBbHRUZXh0KGltYWdlRGF0YSA9IG51bGwsIHVwZGF0ZUFsdFRleHREYXRhID0gdHJ1ZSkgewogICAgaWYgKHRoaXMuaGFzQWx0VGV4dERhdGEoKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgbWxNYW5hZ2VyCiAgICB9ID0gdGhpcy5fdWlNYW5hZ2VyOwogICAgaWYgKCFtbE1hbmFnZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBNTC4iKTsKICAgIH0KICAgIGlmICghKGF3YWl0IG1sTWFuYWdlci5pc0VuYWJsZWRGb3IoImFsdFRleHQiKSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJNTCBpc24ndCBlbmFibGVkIGZvciBhbHQgdGV4dC4iKTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgZGF0YSwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IGltYWdlRGF0YSB8fCB0aGlzLmNvcHlDYW52YXMobnVsbCwgbnVsbCwgdHJ1ZSkuaW1hZ2VEYXRhOwogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtbE1hbmFnZXIuZ3Vlc3MoewogICAgICBuYW1lOiAiYWx0VGV4dCIsCiAgICAgIHJlcXVlc3Q6IHsKICAgICAgICBkYXRhLAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodCwKICAgICAgICBjaGFubmVsczogZGF0YS5sZW5ndGggLyAod2lkdGggKiBoZWlnaHQpCiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFyZXNwb25zZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHJlc3BvbnNlIGZyb20gdGhlIEFJIHNlcnZpY2UuIik7CiAgICB9CiAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJFcnJvciBmcm9tIHRoZSBBSSBzZXJ2aWNlLiIpOwogICAgfQogICAgaWYgKHJlc3BvbnNlLmNhbmNlbCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmICghcmVzcG9uc2Uub3V0cHV0KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gdmFsaWQgcmVzcG9uc2UgZnJvbSB0aGUgQUkgc2VydmljZS4iKTsKICAgIH0KICAgIGNvbnN0IGFsdFRleHQgPSByZXNwb25zZS5vdXRwdXQ7CiAgICBhd2FpdCB0aGlzLnNldEd1ZXNzZWRBbHRUZXh0KGFsdFRleHQpOwogICAgaWYgKHVwZGF0ZUFsdFRleHREYXRhICYmICF0aGlzLmhhc0FsdFRleHREYXRhKCkpIHsKICAgICAgdGhpcy5hbHRUZXh0RGF0YSA9IHsKICAgICAgICBhbHQ6IGFsdFRleHQsCiAgICAgICAgZGVjb3JhdGl2ZTogZmFsc2UKICAgICAgfTsKICAgIH0KICAgIHJldHVybiBhbHRUZXh0OwogIH0KICAjZ2V0Qml0bWFwKCkgewogICAgaWYgKHRoaXMuI2JpdG1hcElkKSB7CiAgICAgIHRoaXMuX3VpTWFuYWdlci5lbmFibGVXYWl0aW5nKHRydWUpOwogICAgICB0aGlzLl91aU1hbmFnZXIuaW1hZ2VNYW5hZ2VyLmdldEZyb21JZCh0aGlzLiNiaXRtYXBJZCkudGhlbihkYXRhID0+IHRoaXMuI2dldEJpdG1hcEZldGNoZWQoZGF0YSwgdHJ1ZSkpLmZpbmFsbHkoKCkgPT4gdGhpcy4jZ2V0Qml0bWFwRG9uZSgpKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuI2JpdG1hcFVybCkgewogICAgICBjb25zdCB1cmwgPSB0aGlzLiNiaXRtYXBVcmw7CiAgICAgIHRoaXMuI2JpdG1hcFVybCA9IG51bGw7CiAgICAgIHRoaXMuX3VpTWFuYWdlci5lbmFibGVXYWl0aW5nKHRydWUpOwogICAgICB0aGlzLiNiaXRtYXBQcm9taXNlID0gdGhpcy5fdWlNYW5hZ2VyLmltYWdlTWFuYWdlci5nZXRGcm9tVXJsKHVybCkudGhlbihkYXRhID0+IHRoaXMuI2dldEJpdG1hcEZldGNoZWQoZGF0YSkpLmZpbmFsbHkoKCkgPT4gdGhpcy4jZ2V0Qml0bWFwRG9uZSgpKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuI2JpdG1hcEZpbGUpIHsKICAgICAgY29uc3QgZmlsZSA9IHRoaXMuI2JpdG1hcEZpbGU7CiAgICAgIHRoaXMuI2JpdG1hcEZpbGUgPSBudWxsOwogICAgICB0aGlzLl91aU1hbmFnZXIuZW5hYmxlV2FpdGluZyh0cnVlKTsKICAgICAgdGhpcy4jYml0bWFwUHJvbWlzZSA9IHRoaXMuX3VpTWFuYWdlci5pbWFnZU1hbmFnZXIuZ2V0RnJvbUZpbGUoZmlsZSkudGhlbihkYXRhID0+IHRoaXMuI2dldEJpdG1hcEZldGNoZWQoZGF0YSkpLmZpbmFsbHkoKCkgPT4gdGhpcy4jZ2V0Qml0bWFwRG9uZSgpKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgaW5wdXQudHlwZSA9ICJmaWxlIjsKICAgIGlucHV0LmFjY2VwdCA9IFN1cHBvcnRlZEltYWdlTWltZVR5cGVzLmpvaW4oIiwiKTsKICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuX3VpTWFuYWdlci5fc2lnbmFsOwogICAgdGhpcy4jYml0bWFwUHJvbWlzZSA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCBhc3luYyAoKSA9PiB7CiAgICAgICAgaWYgKCFpbnB1dC5maWxlcyB8fCBpbnB1dC5maWxlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHRoaXMucmVtb3ZlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX3VpTWFuYWdlci5lbmFibGVXYWl0aW5nKHRydWUpOwogICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuX3VpTWFuYWdlci5pbWFnZU1hbmFnZXIuZ2V0RnJvbUZpbGUoaW5wdXQuZmlsZXNbMF0pOwogICAgICAgICAgdGhpcy5fcmVwb3J0VGVsZW1ldHJ5KHsKICAgICAgICAgICAgYWN0aW9uOiAicGRmanMuaW1hZ2UuaW1hZ2Vfc2VsZWN0ZWQiLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgYWx0X3RleHRfbW9kYWw6IHRoaXMuX3VpTWFuYWdlci51c2VOZXdBbHRUZXh0RmxvdwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuI2dldEJpdG1hcEZldGNoZWQoZGF0YSk7CiAgICAgICAgfQogICAgICAgIHJlc29sdmUoKTsKICAgICAgfSwgewogICAgICAgIHNpZ25hbAogICAgICB9KTsKICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiY2FuY2VsIiwgKCkgPT4gewogICAgICAgIHRoaXMucmVtb3ZlKCk7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9LCB7CiAgICAgICAgc2lnbmFsCiAgICAgIH0pOwogICAgfSkuZmluYWxseSgoKSA9PiB0aGlzLiNnZXRCaXRtYXBEb25lKCkpOwogICAgaW5wdXQuY2xpY2soKTsKICB9CiAgcmVtb3ZlKCkgewogICAgaWYgKHRoaXMuI2JpdG1hcElkKSB7CiAgICAgIHRoaXMuI2JpdG1hcCA9IG51bGw7CiAgICAgIHRoaXMuX3VpTWFuYWdlci5pbWFnZU1hbmFnZXIuZGVsZXRlSWQodGhpcy4jYml0bWFwSWQpOwogICAgICB0aGlzLiNjYW52YXM/LnJlbW92ZSgpOwogICAgICB0aGlzLiNjYW52YXMgPSBudWxsOwogICAgICBpZiAodGhpcy4jcmVzaXplVGltZW91dElkKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuI3Jlc2l6ZVRpbWVvdXRJZCk7CiAgICAgICAgdGhpcy4jcmVzaXplVGltZW91dElkID0gbnVsbDsKICAgICAgfQogICAgfQogICAgc3VwZXIucmVtb3ZlKCk7CiAgfQogIHJlYnVpbGQoKSB7CiAgICBpZiAoIXRoaXMucGFyZW50KSB7CiAgICAgIGlmICh0aGlzLiNiaXRtYXBJZCkgewogICAgICAgIHRoaXMuI2dldEJpdG1hcCgpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN1cGVyLnJlYnVpbGQoKTsKICAgIGlmICh0aGlzLmRpdiA9PT0gbnVsbCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy4jYml0bWFwSWQgJiYgdGhpcy4jY2FudmFzID09PSBudWxsKSB7CiAgICAgIHRoaXMuI2dldEJpdG1hcCgpOwogICAgfQogICAgaWYgKCF0aGlzLmlzQXR0YWNoZWRUb0RPTSkgewogICAgICB0aGlzLnBhcmVudC5hZGQodGhpcyk7CiAgICB9CiAgfQogIG9uY2VBZGRlZChmb2N1cykgewogICAgdGhpcy5faXNEcmFnZ2FibGUgPSB0cnVlOwogICAgaWYgKGZvY3VzKSB7CiAgICAgIHRoaXMuZGl2LmZvY3VzKCk7CiAgICB9CiAgfQogIGlzRW1wdHkoKSB7CiAgICByZXR1cm4gISh0aGlzLiNiaXRtYXBQcm9taXNlIHx8IHRoaXMuI2JpdG1hcCB8fCB0aGlzLiNiaXRtYXBVcmwgfHwgdGhpcy4jYml0bWFwRmlsZSB8fCB0aGlzLiNiaXRtYXBJZCB8fCB0aGlzLiNtaXNzaW5nQ2FudmFzKTsKICB9CiAgZ2V0IGlzUmVzaXphYmxlKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIHJlbmRlcigpIHsKICAgIGlmICh0aGlzLmRpdikgewogICAgICByZXR1cm4gdGhpcy5kaXY7CiAgICB9CiAgICBsZXQgYmFzZVgsIGJhc2VZOwogICAgaWYgKHRoaXMuX2lzQ29weSkgewogICAgICBiYXNlWCA9IHRoaXMueDsKICAgICAgYmFzZVkgPSB0aGlzLnk7CiAgICB9CiAgICBzdXBlci5yZW5kZXIoKTsKICAgIHRoaXMuZGl2LmhpZGRlbiA9IHRydWU7CiAgICB0aGlzLmFkZEFsdFRleHRCdXR0b24oKTsKICAgIGlmICghdGhpcy4jbWlzc2luZ0NhbnZhcykgewogICAgICBpZiAodGhpcy4jYml0bWFwKSB7CiAgICAgICAgdGhpcy4jY3JlYXRlQ2FudmFzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4jZ2V0Qml0bWFwKCk7CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLl9pc0NvcHkpIHsKICAgICAgdGhpcy5fbW92ZUFmdGVyUGFzdGUoYmFzZVgsIGJhc2VZKTsKICAgIH0KICAgIHRoaXMuX3VpTWFuYWdlci5hZGRTaG91bGRSZXNjYWxlKHRoaXMpOwogICAgcmV0dXJuIHRoaXMuZGl2OwogIH0KICBzZXRDYW52YXMoYW5ub3RhdGlvbkVsZW1lbnRJZCwgY2FudmFzKSB7CiAgICBjb25zdCB7CiAgICAgIGlkOiBiaXRtYXBJZCwKICAgICAgYml0bWFwCiAgICB9ID0gdGhpcy5fdWlNYW5hZ2VyLmltYWdlTWFuYWdlci5nZXRGcm9tQ2FudmFzKGFubm90YXRpb25FbGVtZW50SWQsIGNhbnZhcyk7CiAgICBjYW52YXMucmVtb3ZlKCk7CiAgICBpZiAoYml0bWFwSWQgJiYgdGhpcy5fdWlNYW5hZ2VyLmltYWdlTWFuYWdlci5pc1ZhbGlkSWQoYml0bWFwSWQpKSB7CiAgICAgIHRoaXMuI2JpdG1hcElkID0gYml0bWFwSWQ7CiAgICAgIGlmIChiaXRtYXApIHsKICAgICAgICB0aGlzLiNiaXRtYXAgPSBiaXRtYXA7CiAgICAgIH0KICAgICAgdGhpcy4jbWlzc2luZ0NhbnZhcyA9IGZhbHNlOwogICAgICB0aGlzLiNjcmVhdGVDYW52YXMoKTsKICAgIH0KICB9CiAgX29uUmVzaXplZCgpIHsKICAgIHRoaXMub25TY2FsZUNoYW5naW5nKCk7CiAgfQogIG9uU2NhbGVDaGFuZ2luZygpIHsKICAgIGlmICghdGhpcy5wYXJlbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuI3Jlc2l6ZVRpbWVvdXRJZCAhPT0gbnVsbCkgewogICAgICBjbGVhclRpbWVvdXQodGhpcy4jcmVzaXplVGltZW91dElkKTsKICAgIH0KICAgIGNvbnN0IFRJTUVfVE9fV0FJVCA9IDIwMDsKICAgIHRoaXMuI3Jlc2l6ZVRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICB0aGlzLiNyZXNpemVUaW1lb3V0SWQgPSBudWxsOwogICAgICB0aGlzLiNkcmF3Qml0bWFwKCk7CiAgICB9LCBUSU1FX1RPX1dBSVQpOwogIH0KICAjY3JlYXRlQ2FudmFzKCkgewogICAgY29uc3QgewogICAgICBkaXYKICAgIH0gPSB0aGlzOwogICAgbGV0IHsKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IHRoaXMuI2JpdG1hcDsKICAgIGNvbnN0IFtwYWdlV2lkdGgsIHBhZ2VIZWlnaHRdID0gdGhpcy5wYWdlRGltZW5zaW9uczsKICAgIGNvbnN0IE1BWF9SQVRJTyA9IDAuNzU7CiAgICBpZiAodGhpcy53aWR0aCkgewogICAgICB3aWR0aCA9IHRoaXMud2lkdGggKiBwYWdlV2lkdGg7CiAgICAgIGhlaWdodCA9IHRoaXMuaGVpZ2h0ICogcGFnZUhlaWdodDsKICAgIH0gZWxzZSBpZiAod2lkdGggPiBNQVhfUkFUSU8gKiBwYWdlV2lkdGggfHwgaGVpZ2h0ID4gTUFYX1JBVElPICogcGFnZUhlaWdodCkgewogICAgICBjb25zdCBmYWN0b3IgPSBNYXRoLm1pbihNQVhfUkFUSU8gKiBwYWdlV2lkdGggLyB3aWR0aCwgTUFYX1JBVElPICogcGFnZUhlaWdodCAvIGhlaWdodCk7CiAgICAgIHdpZHRoICo9IGZhY3RvcjsKICAgICAgaGVpZ2h0ICo9IGZhY3RvcjsKICAgIH0KICAgIGNvbnN0IFtwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0XSA9IHRoaXMucGFyZW50RGltZW5zaW9uczsKICAgIHRoaXMuc2V0RGltcyh3aWR0aCAqIHBhcmVudFdpZHRoIC8gcGFnZVdpZHRoLCBoZWlnaHQgKiBwYXJlbnRIZWlnaHQgLyBwYWdlSGVpZ2h0KTsKICAgIHRoaXMuX3VpTWFuYWdlci5lbmFibGVXYWl0aW5nKGZhbHNlKTsKICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuI2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgY2FudmFzLnNldEF0dHJpYnV0ZSgicm9sZSIsICJpbWciKTsKICAgIHRoaXMuYWRkQ29udGFpbmVyKGNhbnZhcyk7CiAgICB0aGlzLndpZHRoID0gd2lkdGggLyBwYWdlV2lkdGg7CiAgICB0aGlzLmhlaWdodCA9IGhlaWdodCAvIHBhZ2VIZWlnaHQ7CiAgICBpZiAodGhpcy5faW5pdGlhbE9wdGlvbnM/LmlzQ2VudGVyZWQpIHsKICAgICAgdGhpcy5jZW50ZXIoKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZml4QW5kU2V0UG9zaXRpb24oKTsKICAgIH0KICAgIHRoaXMuX2luaXRpYWxPcHRpb25zID0gbnVsbDsKICAgIGlmICghdGhpcy5fdWlNYW5hZ2VyLnVzZU5ld0FsdFRleHRXaGVuQWRkaW5nSW1hZ2UgfHwgIXRoaXMuX3VpTWFuYWdlci51c2VOZXdBbHRUZXh0RmxvdyB8fCB0aGlzLmFubm90YXRpb25FbGVtZW50SWQpIHsKICAgICAgZGl2LmhpZGRlbiA9IGZhbHNlOwogICAgfQogICAgdGhpcy4jZHJhd0JpdG1hcCgpOwogICAgaWYgKCF0aGlzLiNoYXNCZWVuQWRkZWRJblVuZG9TdGFjaykgewogICAgICB0aGlzLnBhcmVudC5hZGRVbmRvYWJsZUVkaXRvcih0aGlzKTsKICAgICAgdGhpcy4jaGFzQmVlbkFkZGVkSW5VbmRvU3RhY2sgPSB0cnVlOwogICAgfQogICAgdGhpcy5fcmVwb3J0VGVsZW1ldHJ5KHsKICAgICAgYWN0aW9uOiAiaW5zZXJ0ZWRfaW1hZ2UiCiAgICB9KTsKICAgIGlmICh0aGlzLiNiaXRtYXBGaWxlTmFtZSkgewogICAgICB0aGlzLmRpdi5zZXRBdHRyaWJ1dGUoImFyaWEtZGVzY3JpcHRpb24iLCB0aGlzLiNiaXRtYXBGaWxlTmFtZSk7CiAgICB9CiAgfQogIGNvcHlDYW52YXMobWF4RGF0YURpbWVuc2lvbiwgbWF4UHJldmlld0RpbWVuc2lvbiwgY3JlYXRlSW1hZ2VEYXRhID0gZmFsc2UpIHsKICAgIGlmICghbWF4RGF0YURpbWVuc2lvbikgewogICAgICBtYXhEYXRhRGltZW5zaW9uID0gMjI0OwogICAgfQogICAgY29uc3QgewogICAgICB3aWR0aDogYml0bWFwV2lkdGgsCiAgICAgIGhlaWdodDogYml0bWFwSGVpZ2h0CiAgICB9ID0gdGhpcy4jYml0bWFwOwogICAgY29uc3Qgb3V0cHV0U2NhbGUgPSBuZXcgT3V0cHV0U2NhbGUoKTsKICAgIGxldCBiaXRtYXAgPSB0aGlzLiNiaXRtYXA7CiAgICBsZXQgd2lkdGggPSBiaXRtYXBXaWR0aCwKICAgICAgaGVpZ2h0ID0gYml0bWFwSGVpZ2h0OwogICAgbGV0IGNhbnZhcyA9IG51bGw7CiAgICBpZiAobWF4UHJldmlld0RpbWVuc2lvbikgewogICAgICBpZiAoYml0bWFwV2lkdGggPiBtYXhQcmV2aWV3RGltZW5zaW9uIHx8IGJpdG1hcEhlaWdodCA+IG1heFByZXZpZXdEaW1lbnNpb24pIHsKICAgICAgICBjb25zdCByYXRpbyA9IE1hdGgubWluKG1heFByZXZpZXdEaW1lbnNpb24gLyBiaXRtYXBXaWR0aCwgbWF4UHJldmlld0RpbWVuc2lvbiAvIGJpdG1hcEhlaWdodCk7CiAgICAgICAgd2lkdGggPSBNYXRoLmZsb29yKGJpdG1hcFdpZHRoICogcmF0aW8pOwogICAgICAgIGhlaWdodCA9IE1hdGguZmxvb3IoYml0bWFwSGVpZ2h0ICogcmF0aW8pOwogICAgICB9CiAgICAgIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgICBjb25zdCBzY2FsZWRXaWR0aCA9IGNhbnZhcy53aWR0aCA9IE1hdGguY2VpbCh3aWR0aCAqIG91dHB1dFNjYWxlLnN4KTsKICAgICAgY29uc3Qgc2NhbGVkSGVpZ2h0ID0gY2FudmFzLmhlaWdodCA9IE1hdGguY2VpbChoZWlnaHQgKiBvdXRwdXRTY2FsZS5zeSk7CiAgICAgIGlmICghdGhpcy4jaXNTdmcpIHsKICAgICAgICBiaXRtYXAgPSB0aGlzLiNzY2FsZUJpdG1hcChzY2FsZWRXaWR0aCwgc2NhbGVkSGVpZ2h0KTsKICAgICAgfQogICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY3R4LmZpbHRlciA9IHRoaXMuX3VpTWFuYWdlci5oY21GaWx0ZXI7CiAgICAgIGxldCB3aGl0ZSA9ICJ3aGl0ZSIsCiAgICAgICAgYmxhY2sgPSAiI2NmY2ZkOCI7CiAgICAgIGlmICh0aGlzLl91aU1hbmFnZXIuaGNtRmlsdGVyICE9PSAibm9uZSIpIHsKICAgICAgICBibGFjayA9ICJibGFjayI7CiAgICAgIH0gZWxzZSBpZiAod2luZG93Lm1hdGNoTWVkaWE/LigiKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKSIpLm1hdGNoZXMpIHsKICAgICAgICB3aGl0ZSA9ICIjOGY4ZjlkIjsKICAgICAgICBibGFjayA9ICIjNDI0MTRkIjsKICAgICAgfQogICAgICBjb25zdCBib3hEaW0gPSAxNTsKICAgICAgY29uc3QgYm94RGltV2lkdGggPSBib3hEaW0gKiBvdXRwdXRTY2FsZS5zeDsKICAgICAgY29uc3QgYm94RGltSGVpZ2h0ID0gYm94RGltICogb3V0cHV0U2NhbGUuc3k7CiAgICAgIGNvbnN0IHBhdHRlcm4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKGJveERpbVdpZHRoICogMiwgYm94RGltSGVpZ2h0ICogMik7CiAgICAgIGNvbnN0IHBhdHRlcm5DdHggPSBwYXR0ZXJuLmdldENvbnRleHQoIjJkIik7CiAgICAgIHBhdHRlcm5DdHguZmlsbFN0eWxlID0gd2hpdGU7CiAgICAgIHBhdHRlcm5DdHguZmlsbFJlY3QoMCwgMCwgYm94RGltV2lkdGggKiAyLCBib3hEaW1IZWlnaHQgKiAyKTsKICAgICAgcGF0dGVybkN0eC5maWxsU3R5bGUgPSBibGFjazsKICAgICAgcGF0dGVybkN0eC5maWxsUmVjdCgwLCAwLCBib3hEaW1XaWR0aCwgYm94RGltSGVpZ2h0KTsKICAgICAgcGF0dGVybkN0eC5maWxsUmVjdChib3hEaW1XaWR0aCwgYm94RGltSGVpZ2h0LCBib3hEaW1XaWR0aCwgYm94RGltSGVpZ2h0KTsKICAgICAgY3R4LmZpbGxTdHlsZSA9IGN0eC5jcmVhdGVQYXR0ZXJuKHBhdHRlcm4sICJyZXBlYXQiKTsKICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHNjYWxlZFdpZHRoLCBzY2FsZWRIZWlnaHQpOwogICAgICBjdHguZHJhd0ltYWdlKGJpdG1hcCwgMCwgMCwgYml0bWFwLndpZHRoLCBiaXRtYXAuaGVpZ2h0LCAwLCAwLCBzY2FsZWRXaWR0aCwgc2NhbGVkSGVpZ2h0KTsKICAgIH0KICAgIGxldCBpbWFnZURhdGEgPSBudWxsOwogICAgaWYgKGNyZWF0ZUltYWdlRGF0YSkgewogICAgICBsZXQgZGF0YVdpZHRoLCBkYXRhSGVpZ2h0OwogICAgICBpZiAob3V0cHV0U2NhbGUuc3ltbWV0cmljICYmIGJpdG1hcC53aWR0aCA8IG1heERhdGFEaW1lbnNpb24gJiYgYml0bWFwLmhlaWdodCA8IG1heERhdGFEaW1lbnNpb24pIHsKICAgICAgICBkYXRhV2lkdGggPSBiaXRtYXAud2lkdGg7CiAgICAgICAgZGF0YUhlaWdodCA9IGJpdG1hcC5oZWlnaHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYml0bWFwID0gdGhpcy4jYml0bWFwOwogICAgICAgIGlmIChiaXRtYXBXaWR0aCA+IG1heERhdGFEaW1lbnNpb24gfHwgYml0bWFwSGVpZ2h0ID4gbWF4RGF0YURpbWVuc2lvbikgewogICAgICAgICAgY29uc3QgcmF0aW8gPSBNYXRoLm1pbihtYXhEYXRhRGltZW5zaW9uIC8gYml0bWFwV2lkdGgsIG1heERhdGFEaW1lbnNpb24gLyBiaXRtYXBIZWlnaHQpOwogICAgICAgICAgZGF0YVdpZHRoID0gTWF0aC5mbG9vcihiaXRtYXBXaWR0aCAqIHJhdGlvKTsKICAgICAgICAgIGRhdGFIZWlnaHQgPSBNYXRoLmZsb29yKGJpdG1hcEhlaWdodCAqIHJhdGlvKTsKICAgICAgICAgIGlmICghdGhpcy4jaXNTdmcpIHsKICAgICAgICAgICAgYml0bWFwID0gdGhpcy4jc2NhbGVCaXRtYXAoZGF0YVdpZHRoLCBkYXRhSGVpZ2h0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhkYXRhV2lkdGgsIGRhdGFIZWlnaHQpOwogICAgICBjb25zdCBvZmZzY3JlZW5DdHggPSBvZmZzY3JlZW4uZ2V0Q29udGV4dCgiMmQiLCB7CiAgICAgICAgd2lsbFJlYWRGcmVxdWVudGx5OiB0cnVlCiAgICAgIH0pOwogICAgICBvZmZzY3JlZW5DdHguZHJhd0ltYWdlKGJpdG1hcCwgMCwgMCwgYml0bWFwLndpZHRoLCBiaXRtYXAuaGVpZ2h0LCAwLCAwLCBkYXRhV2lkdGgsIGRhdGFIZWlnaHQpOwogICAgICBpbWFnZURhdGEgPSB7CiAgICAgICAgd2lkdGg6IGRhdGFXaWR0aCwKICAgICAgICBoZWlnaHQ6IGRhdGFIZWlnaHQsCiAgICAgICAgZGF0YTogb2Zmc2NyZWVuQ3R4LmdldEltYWdlRGF0YSgwLCAwLCBkYXRhV2lkdGgsIGRhdGFIZWlnaHQpLmRhdGEKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGNhbnZhcywKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodCwKICAgICAgaW1hZ2VEYXRhCiAgICB9OwogIH0KICAjc2NhbGVCaXRtYXAod2lkdGgsIGhlaWdodCkgewogICAgY29uc3QgewogICAgICB3aWR0aDogYml0bWFwV2lkdGgsCiAgICAgIGhlaWdodDogYml0bWFwSGVpZ2h0CiAgICB9ID0gdGhpcy4jYml0bWFwOwogICAgbGV0IG5ld1dpZHRoID0gYml0bWFwV2lkdGg7CiAgICBsZXQgbmV3SGVpZ2h0ID0gYml0bWFwSGVpZ2h0OwogICAgbGV0IGJpdG1hcCA9IHRoaXMuI2JpdG1hcDsKICAgIHdoaWxlIChuZXdXaWR0aCA+IDIgKiB3aWR0aCB8fCBuZXdIZWlnaHQgPiAyICogaGVpZ2h0KSB7CiAgICAgIGNvbnN0IHByZXZXaWR0aCA9IG5ld1dpZHRoOwogICAgICBjb25zdCBwcmV2SGVpZ2h0ID0gbmV3SGVpZ2h0OwogICAgICBpZiAobmV3V2lkdGggPiAyICogd2lkdGgpIHsKICAgICAgICBuZXdXaWR0aCA9IG5ld1dpZHRoID49IDE2Mzg0ID8gTWF0aC5mbG9vcihuZXdXaWR0aCAvIDIpIC0gMSA6IE1hdGguY2VpbChuZXdXaWR0aCAvIDIpOwogICAgICB9CiAgICAgIGlmIChuZXdIZWlnaHQgPiAyICogaGVpZ2h0KSB7CiAgICAgICAgbmV3SGVpZ2h0ID0gbmV3SGVpZ2h0ID49IDE2Mzg0ID8gTWF0aC5mbG9vcihuZXdIZWlnaHQgLyAyKSAtIDEgOiBNYXRoLmNlaWwobmV3SGVpZ2h0IC8gMik7CiAgICAgIH0KICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKICAgICAgY29uc3QgY3R4ID0gb2Zmc2NyZWVuLmdldENvbnRleHQoIjJkIik7CiAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwLCBwcmV2V2lkdGgsIHByZXZIZWlnaHQsIDAsIDAsIG5ld1dpZHRoLCBuZXdIZWlnaHQpOwogICAgICBiaXRtYXAgPSBvZmZzY3JlZW4udHJhbnNmZXJUb0ltYWdlQml0bWFwKCk7CiAgICB9CiAgICByZXR1cm4gYml0bWFwOwogIH0KICAjZHJhd0JpdG1hcCgpIHsKICAgIGNvbnN0IFtwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0XSA9IHRoaXMucGFyZW50RGltZW5zaW9uczsKICAgIGNvbnN0IHsKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IHRoaXM7CiAgICBjb25zdCBvdXRwdXRTY2FsZSA9IG5ldyBPdXRwdXRTY2FsZSgpOwogICAgY29uc3Qgc2NhbGVkV2lkdGggPSBNYXRoLmNlaWwod2lkdGggKiBwYXJlbnRXaWR0aCAqIG91dHB1dFNjYWxlLnN4KTsKICAgIGNvbnN0IHNjYWxlZEhlaWdodCA9IE1hdGguY2VpbChoZWlnaHQgKiBwYXJlbnRIZWlnaHQgKiBvdXRwdXRTY2FsZS5zeSk7CiAgICBjb25zdCBjYW52YXMgPSB0aGlzLiNjYW52YXM7CiAgICBpZiAoIWNhbnZhcyB8fCBjYW52YXMud2lkdGggPT09IHNjYWxlZFdpZHRoICYmIGNhbnZhcy5oZWlnaHQgPT09IHNjYWxlZEhlaWdodCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjYW52YXMud2lkdGggPSBzY2FsZWRXaWR0aDsKICAgIGNhbnZhcy5oZWlnaHQgPSBzY2FsZWRIZWlnaHQ7CiAgICBjb25zdCBiaXRtYXAgPSB0aGlzLiNpc1N2ZyA/IHRoaXMuI2JpdG1hcCA6IHRoaXMuI3NjYWxlQml0bWFwKHNjYWxlZFdpZHRoLCBzY2FsZWRIZWlnaHQpOwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICBjdHguZmlsdGVyID0gdGhpcy5fdWlNYW5hZ2VyLmhjbUZpbHRlcjsKICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwLCBiaXRtYXAud2lkdGgsIGJpdG1hcC5oZWlnaHQsIDAsIDAsIHNjYWxlZFdpZHRoLCBzY2FsZWRIZWlnaHQpOwogIH0KICAjc2VyaWFsaXplQml0bWFwKHRvVXJsKSB7CiAgICBpZiAodG9VcmwpIHsKICAgICAgaWYgKHRoaXMuI2lzU3ZnKSB7CiAgICAgICAgY29uc3QgdXJsID0gdGhpcy5fdWlNYW5hZ2VyLmltYWdlTWFuYWdlci5nZXRTdmdVcmwodGhpcy4jYml0bWFwSWQpOwogICAgICAgIGlmICh1cmwpIHsKICAgICAgICAgIHJldHVybiB1cmw7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgICAoewogICAgICAgIHdpZHRoOiBjYW52YXMud2lkdGgsCiAgICAgICAgaGVpZ2h0OiBjYW52YXMuaGVpZ2h0CiAgICAgIH0gPSB0aGlzLiNiaXRtYXApOwogICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLiNiaXRtYXAsIDAsIDApOwogICAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTCgpOwogICAgfQogICAgaWYgKHRoaXMuI2lzU3ZnKSB7CiAgICAgIGNvbnN0IFtwYWdlV2lkdGgsIHBhZ2VIZWlnaHRdID0gdGhpcy5wYWdlRGltZW5zaW9uczsKICAgICAgY29uc3Qgd2lkdGggPSBNYXRoLnJvdW5kKHRoaXMud2lkdGggKiBwYWdlV2lkdGggKiBQaXhlbHNQZXJJbmNoLlBERl9UT19DU1NfVU5JVFMpOwogICAgICBjb25zdCBoZWlnaHQgPSBNYXRoLnJvdW5kKHRoaXMuaGVpZ2h0ICogcGFnZUhlaWdodCAqIFBpeGVsc1BlckluY2guUERGX1RPX0NTU19VTklUUyk7CiAgICAgIGNvbnN0IG9mZnNjcmVlbiA9IG5ldyBPZmZzY3JlZW5DYW52YXMod2lkdGgsIGhlaWdodCk7CiAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCIyZCIpOwogICAgICBjdHguZHJhd0ltYWdlKHRoaXMuI2JpdG1hcCwgMCwgMCwgdGhpcy4jYml0bWFwLndpZHRoLCB0aGlzLiNiaXRtYXAuaGVpZ2h0LCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgcmV0dXJuIG9mZnNjcmVlbi50cmFuc2ZlclRvSW1hZ2VCaXRtYXAoKTsKICAgIH0KICAgIHJldHVybiBzdHJ1Y3R1cmVkQ2xvbmUodGhpcy4jYml0bWFwKTsKICB9CiAgc3RhdGljIGFzeW5jIGRlc2VyaWFsaXplKGRhdGEsIHBhcmVudCwgdWlNYW5hZ2VyKSB7CiAgICBsZXQgaW5pdGlhbERhdGEgPSBudWxsOwogICAgbGV0IG1pc3NpbmdDYW52YXMgPSBmYWxzZTsKICAgIGlmIChkYXRhIGluc3RhbmNlb2YgU3RhbXBBbm5vdGF0aW9uRWxlbWVudCkgewogICAgICBjb25zdCB7CiAgICAgICAgZGF0YTogewogICAgICAgICAgcmVjdCwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgaWQsCiAgICAgICAgICBzdHJ1Y3RQYXJlbnQsCiAgICAgICAgICBwb3B1cFJlZgogICAgICAgIH0sCiAgICAgICAgY29udGFpbmVyLAogICAgICAgIHBhcmVudDogewogICAgICAgICAgcGFnZTogewogICAgICAgICAgICBwYWdlTnVtYmVyCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjYW52YXMKICAgICAgfSA9IGRhdGE7CiAgICAgIGxldCBiaXRtYXBJZCwgYml0bWFwOwogICAgICBpZiAoY2FudmFzKSB7CiAgICAgICAgZGVsZXRlIGRhdGEuY2FudmFzOwogICAgICAgICh7CiAgICAgICAgICBpZDogYml0bWFwSWQsCiAgICAgICAgICBiaXRtYXAKICAgICAgICB9ID0gdWlNYW5hZ2VyLmltYWdlTWFuYWdlci5nZXRGcm9tQ2FudmFzKGNvbnRhaW5lci5pZCwgY2FudmFzKSk7CiAgICAgICAgY2FudmFzLnJlbW92ZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIG1pc3NpbmdDYW52YXMgPSB0cnVlOwogICAgICAgIGRhdGEuX2hhc05vQ2FudmFzID0gdHJ1ZTsKICAgICAgfQogICAgICBjb25zdCBhbHRUZXh0ID0gKGF3YWl0IHBhcmVudC5fc3RydWN0VHJlZS5nZXRBcmlhQXR0cmlidXRlcyhgJHtBbm5vdGF0aW9uUHJlZml4fSR7aWR9YCkpPy5nZXQoImFyaWEtbGFiZWwiKSB8fCAiIjsKICAgICAgaW5pdGlhbERhdGEgPSBkYXRhID0gewogICAgICAgIGFubm90YXRpb25UeXBlOiBBbm5vdGF0aW9uRWRpdG9yVHlwZS5TVEFNUCwKICAgICAgICBiaXRtYXBJZCwKICAgICAgICBiaXRtYXAsCiAgICAgICAgcGFnZUluZGV4OiBwYWdlTnVtYmVyIC0gMSwKICAgICAgICByZWN0OiByZWN0LnNsaWNlKDApLAogICAgICAgIHJvdGF0aW9uLAogICAgICAgIGlkLAogICAgICAgIGRlbGV0ZWQ6IGZhbHNlLAogICAgICAgIGFjY2Vzc2liaWxpdHlEYXRhOiB7CiAgICAgICAgICBkZWNvcmF0aXZlOiBmYWxzZSwKICAgICAgICAgIGFsdFRleHQKICAgICAgICB9LAogICAgICAgIGlzU3ZnOiBmYWxzZSwKICAgICAgICBzdHJ1Y3RQYXJlbnQsCiAgICAgICAgcG9wdXBSZWYKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IGVkaXRvciA9IGF3YWl0IHN1cGVyLmRlc2VyaWFsaXplKGRhdGEsIHBhcmVudCwgdWlNYW5hZ2VyKTsKICAgIGNvbnN0IHsKICAgICAgcmVjdCwKICAgICAgYml0bWFwLAogICAgICBiaXRtYXBVcmwsCiAgICAgIGJpdG1hcElkLAogICAgICBpc1N2ZywKICAgICAgYWNjZXNzaWJpbGl0eURhdGEKICAgIH0gPSBkYXRhOwogICAgaWYgKG1pc3NpbmdDYW52YXMpIHsKICAgICAgdWlNYW5hZ2VyLmFkZE1pc3NpbmdDYW52YXMoZGF0YS5pZCwgZWRpdG9yKTsKICAgICAgZWRpdG9yLiNtaXNzaW5nQ2FudmFzID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAoYml0bWFwSWQgJiYgdWlNYW5hZ2VyLmltYWdlTWFuYWdlci5pc1ZhbGlkSWQoYml0bWFwSWQpKSB7CiAgICAgIGVkaXRvci4jYml0bWFwSWQgPSBiaXRtYXBJZDsKICAgICAgaWYgKGJpdG1hcCkgewogICAgICAgIGVkaXRvci4jYml0bWFwID0gYml0bWFwOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBlZGl0b3IuI2JpdG1hcFVybCA9IGJpdG1hcFVybDsKICAgIH0KICAgIGVkaXRvci4jaXNTdmcgPSBpc1N2ZzsKICAgIGNvbnN0IFtwYXJlbnRXaWR0aCwgcGFyZW50SGVpZ2h0XSA9IGVkaXRvci5wYWdlRGltZW5zaW9uczsKICAgIGVkaXRvci53aWR0aCA9IChyZWN0WzJdIC0gcmVjdFswXSkgLyBwYXJlbnRXaWR0aDsKICAgIGVkaXRvci5oZWlnaHQgPSAocmVjdFszXSAtIHJlY3RbMV0pIC8gcGFyZW50SGVpZ2h0OwogICAgZWRpdG9yLmFubm90YXRpb25FbGVtZW50SWQgPSBkYXRhLmlkIHx8IG51bGw7CiAgICBpZiAoYWNjZXNzaWJpbGl0eURhdGEpIHsKICAgICAgZWRpdG9yLmFsdFRleHREYXRhID0gYWNjZXNzaWJpbGl0eURhdGE7CiAgICB9CiAgICBlZGl0b3IuX2luaXRpYWxEYXRhID0gaW5pdGlhbERhdGE7CiAgICBlZGl0b3IuI2hhc0JlZW5BZGRlZEluVW5kb1N0YWNrID0gISFpbml0aWFsRGF0YTsKICAgIHJldHVybiBlZGl0b3I7CiAgfQogIHNlcmlhbGl6ZShpc0ZvckNvcHlpbmcgPSBmYWxzZSwgY29udGV4dCA9IG51bGwpIHsKICAgIGlmICh0aGlzLmlzRW1wdHkoKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLmRlbGV0ZWQpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplRGVsZXRlZCgpOwogICAgfQogICAgY29uc3Qgc2VyaWFsaXplZCA9IHsKICAgICAgYW5ub3RhdGlvblR5cGU6IEFubm90YXRpb25FZGl0b3JUeXBlLlNUQU1QLAogICAgICBiaXRtYXBJZDogdGhpcy4jYml0bWFwSWQsCiAgICAgIHBhZ2VJbmRleDogdGhpcy5wYWdlSW5kZXgsCiAgICAgIHJlY3Q6IHRoaXMuZ2V0UmVjdCgwLCAwKSwKICAgICAgcm90YXRpb246IHRoaXMucm90YXRpb24sCiAgICAgIGlzU3ZnOiB0aGlzLiNpc1N2ZywKICAgICAgc3RydWN0VHJlZVBhcmVudElkOiB0aGlzLl9zdHJ1Y3RUcmVlUGFyZW50SWQKICAgIH07CiAgICBpZiAoaXNGb3JDb3B5aW5nKSB7CiAgICAgIHNlcmlhbGl6ZWQuYml0bWFwVXJsID0gdGhpcy4jc2VyaWFsaXplQml0bWFwKHRydWUpOwogICAgICBzZXJpYWxpemVkLmFjY2Vzc2liaWxpdHlEYXRhID0gdGhpcy5zZXJpYWxpemVBbHRUZXh0KHRydWUpOwogICAgICBzZXJpYWxpemVkLmlzQ29weSA9IHRydWU7CiAgICAgIHJldHVybiBzZXJpYWxpemVkOwogICAgfQogICAgY29uc3QgewogICAgICBkZWNvcmF0aXZlLAogICAgICBhbHRUZXh0CiAgICB9ID0gdGhpcy5zZXJpYWxpemVBbHRUZXh0KGZhbHNlKTsKICAgIGlmICghZGVjb3JhdGl2ZSAmJiBhbHRUZXh0KSB7CiAgICAgIHNlcmlhbGl6ZWQuYWNjZXNzaWJpbGl0eURhdGEgPSB7CiAgICAgICAgdHlwZTogIkZpZ3VyZSIsCiAgICAgICAgYWx0OiBhbHRUZXh0CiAgICAgIH07CiAgICB9CiAgICBpZiAodGhpcy5hbm5vdGF0aW9uRWxlbWVudElkKSB7CiAgICAgIGNvbnN0IGNoYW5nZXMgPSB0aGlzLiNoYXNFbGVtZW50Q2hhbmdlZChzZXJpYWxpemVkKTsKICAgICAgaWYgKGNoYW5nZXMuaXNTYW1lKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKGNoYW5nZXMuaXNTYW1lQWx0VGV4dCkgewogICAgICAgIGRlbGV0ZSBzZXJpYWxpemVkLmFjY2Vzc2liaWxpdHlEYXRhOwogICAgICB9IGVsc2UgewogICAgICAgIHNlcmlhbGl6ZWQuYWNjZXNzaWJpbGl0eURhdGEuc3RydWN0UGFyZW50ID0gdGhpcy5faW5pdGlhbERhdGEuc3RydWN0UGFyZW50ID8/IC0xOwogICAgICB9CiAgICB9CiAgICBzZXJpYWxpemVkLmlkID0gdGhpcy5hbm5vdGF0aW9uRWxlbWVudElkOwogICAgaWYgKGNvbnRleHQgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIHNlcmlhbGl6ZWQ7CiAgICB9CiAgICBjb250ZXh0LnN0YW1wcyB8fD0gbmV3IE1hcCgpOwogICAgY29uc3QgYXJlYSA9IHRoaXMuI2lzU3ZnID8gKHNlcmlhbGl6ZWQucmVjdFsyXSAtIHNlcmlhbGl6ZWQucmVjdFswXSkgKiAoc2VyaWFsaXplZC5yZWN0WzNdIC0gc2VyaWFsaXplZC5yZWN0WzFdKSA6IG51bGw7CiAgICBpZiAoIWNvbnRleHQuc3RhbXBzLmhhcyh0aGlzLiNiaXRtYXBJZCkpIHsKICAgICAgY29udGV4dC5zdGFtcHMuc2V0KHRoaXMuI2JpdG1hcElkLCB7CiAgICAgICAgYXJlYSwKICAgICAgICBzZXJpYWxpemVkCiAgICAgIH0pOwogICAgICBzZXJpYWxpemVkLmJpdG1hcCA9IHRoaXMuI3NlcmlhbGl6ZUJpdG1hcChmYWxzZSk7CiAgICB9IGVsc2UgaWYgKHRoaXMuI2lzU3ZnKSB7CiAgICAgIGNvbnN0IHByZXZEYXRhID0gY29udGV4dC5zdGFtcHMuZ2V0KHRoaXMuI2JpdG1hcElkKTsKICAgICAgaWYgKGFyZWEgPiBwcmV2RGF0YS5hcmVhKSB7CiAgICAgICAgcHJldkRhdGEuYXJlYSA9IGFyZWE7CiAgICAgICAgcHJldkRhdGEuc2VyaWFsaXplZC5iaXRtYXAuY2xvc2UoKTsKICAgICAgICBwcmV2RGF0YS5zZXJpYWxpemVkLmJpdG1hcCA9IHRoaXMuI3NlcmlhbGl6ZUJpdG1hcChmYWxzZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzZXJpYWxpemVkOwogIH0KICAjaGFzRWxlbWVudENoYW5nZWQoc2VyaWFsaXplZCkgewogICAgY29uc3QgewogICAgICBwYWdlSW5kZXgsCiAgICAgIGFjY2Vzc2liaWxpdHlEYXRhOiB7CiAgICAgICAgYWx0VGV4dAogICAgICB9CiAgICB9ID0gdGhpcy5faW5pdGlhbERhdGE7CiAgICBjb25zdCBpc1NhbWVQYWdlSW5kZXggPSBzZXJpYWxpemVkLnBhZ2VJbmRleCA9PT0gcGFnZUluZGV4OwogICAgY29uc3QgaXNTYW1lQWx0VGV4dCA9IChzZXJpYWxpemVkLmFjY2Vzc2liaWxpdHlEYXRhPy5hbHQgfHwgIiIpID09PSBhbHRUZXh0OwogICAgcmV0dXJuIHsKICAgICAgaXNTYW1lOiAhdGhpcy5faGFzQmVlbk1vdmVkICYmICF0aGlzLl9oYXNCZWVuUmVzaXplZCAmJiBpc1NhbWVQYWdlSW5kZXggJiYgaXNTYW1lQWx0VGV4dCwKICAgICAgaXNTYW1lQWx0VGV4dAogICAgfTsKICB9CiAgcmVuZGVyQW5ub3RhdGlvbkVsZW1lbnQoYW5ub3RhdGlvbikgewogICAgYW5ub3RhdGlvbi51cGRhdGVFZGl0ZWQoewogICAgICByZWN0OiB0aGlzLmdldFJlY3QoMCwgMCkKICAgIH0pOwogICAgcmV0dXJuIG51bGw7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9lZGl0b3IvYW5ub3RhdGlvbl9lZGl0b3JfbGF5ZXIuanMKCgoKCgoKCgpjbGFzcyBBbm5vdGF0aW9uRWRpdG9yTGF5ZXIgewogICNhY2Nlc3NpYmlsaXR5TWFuYWdlcjsKICAjYWxsb3dDbGljayA9IGZhbHNlOwogICNhbm5vdGF0aW9uTGF5ZXIgPSBudWxsOwogICNjbGlja0FDID0gbnVsbDsKICAjZWRpdG9yRm9jdXNUaW1lb3V0SWQgPSBudWxsOwogICNlZGl0b3JzID0gbmV3IE1hcCgpOwogICNoYWRQb2ludGVyRG93biA9IGZhbHNlOwogICNpc0Rpc2FibGluZyA9IGZhbHNlOwogICNpc0VuYWJsaW5nID0gZmFsc2U7CiAgI2RyYXdpbmdBQyA9IG51bGw7CiAgI2ZvY3VzZWRFbGVtZW50ID0gbnVsbDsKICAjdGV4dExheWVyID0gbnVsbDsKICAjdGV4dFNlbGVjdGlvbkFDID0gbnVsbDsKICAjdWlNYW5hZ2VyOwogIHN0YXRpYyBfaW5pdGlhbGl6ZWQgPSBmYWxzZTsKICBzdGF0aWMgI2VkaXRvclR5cGVzID0gbmV3IE1hcChbRnJlZVRleHRFZGl0b3IsIElua0VkaXRvciwgU3RhbXBFZGl0b3IsIEhpZ2hsaWdodEVkaXRvciwgU2lnbmF0dXJlRWRpdG9yXS5tYXAodHlwZSA9PiBbdHlwZS5fZWRpdG9yVHlwZSwgdHlwZV0pKTsKICBjb25zdHJ1Y3Rvcih7CiAgICB1aU1hbmFnZXIsCiAgICBwYWdlSW5kZXgsCiAgICBkaXYsCiAgICBzdHJ1Y3RUcmVlTGF5ZXIsCiAgICBhY2Nlc3NpYmlsaXR5TWFuYWdlciwKICAgIGFubm90YXRpb25MYXllciwKICAgIGRyYXdMYXllciwKICAgIHRleHRMYXllciwKICAgIHZpZXdwb3J0LAogICAgbDEwbgogIH0pIHsKICAgIGNvbnN0IGVkaXRvclR5cGVzID0gWy4uLkFubm90YXRpb25FZGl0b3JMYXllci4jZWRpdG9yVHlwZXMudmFsdWVzKCldOwogICAgaWYgKCFBbm5vdGF0aW9uRWRpdG9yTGF5ZXIuX2luaXRpYWxpemVkKSB7CiAgICAgIEFubm90YXRpb25FZGl0b3JMYXllci5faW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICBmb3IgKGNvbnN0IGVkaXRvclR5cGUgb2YgZWRpdG9yVHlwZXMpIHsKICAgICAgICBlZGl0b3JUeXBlLmluaXRpYWxpemUobDEwbiwgdWlNYW5hZ2VyKTsKICAgICAgfQogICAgfQogICAgdWlNYW5hZ2VyLnJlZ2lzdGVyRWRpdG9yVHlwZXMoZWRpdG9yVHlwZXMpOwogICAgdGhpcy4jdWlNYW5hZ2VyID0gdWlNYW5hZ2VyOwogICAgdGhpcy5wYWdlSW5kZXggPSBwYWdlSW5kZXg7CiAgICB0aGlzLmRpdiA9IGRpdjsKICAgIHRoaXMuI2FjY2Vzc2liaWxpdHlNYW5hZ2VyID0gYWNjZXNzaWJpbGl0eU1hbmFnZXI7CiAgICB0aGlzLiNhbm5vdGF0aW9uTGF5ZXIgPSBhbm5vdGF0aW9uTGF5ZXI7CiAgICB0aGlzLnZpZXdwb3J0ID0gdmlld3BvcnQ7CiAgICB0aGlzLiN0ZXh0TGF5ZXIgPSB0ZXh0TGF5ZXI7CiAgICB0aGlzLmRyYXdMYXllciA9IGRyYXdMYXllcjsKICAgIHRoaXMuX3N0cnVjdFRyZWUgPSBzdHJ1Y3RUcmVlTGF5ZXI7CiAgICB0aGlzLiN1aU1hbmFnZXIuYWRkTGF5ZXIodGhpcyk7CiAgfQogIGdldCBpc0VtcHR5KCkgewogICAgcmV0dXJuIHRoaXMuI2VkaXRvcnMuc2l6ZSA9PT0gMDsKICB9CiAgZ2V0IGlzSW52aXNpYmxlKCkgewogICAgcmV0dXJuIHRoaXMuaXNFbXB0eSAmJiB0aGlzLiN1aU1hbmFnZXIuZ2V0TW9kZSgpID09PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5OT05FOwogIH0KICB1cGRhdGVUb29sYmFyKG9wdGlvbnMpIHsKICAgIHRoaXMuI3VpTWFuYWdlci51cGRhdGVUb29sYmFyKG9wdGlvbnMpOwogIH0KICB1cGRhdGVNb2RlKG1vZGUgPSB0aGlzLiN1aU1hbmFnZXIuZ2V0TW9kZSgpKSB7CiAgICB0aGlzLiNjbGVhbnVwKCk7CiAgICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5OT05FOgogICAgICAgIHRoaXMuZGlzYWJsZVRleHRTZWxlY3Rpb24oKTsKICAgICAgICB0aGlzLnRvZ2dsZVBvaW50ZXJFdmVudHMoZmFsc2UpOwogICAgICAgIHRoaXMudG9nZ2xlQW5ub3RhdGlvbkxheWVyUG9pbnRlckV2ZW50cyh0cnVlKTsKICAgICAgICB0aGlzLmRpc2FibGVDbGljaygpOwogICAgICAgIHJldHVybjsKICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5JTks6CiAgICAgICAgdGhpcy5kaXNhYmxlVGV4dFNlbGVjdGlvbigpOwogICAgICAgIHRoaXMudG9nZ2xlUG9pbnRlckV2ZW50cyh0cnVlKTsKICAgICAgICB0aGlzLmVuYWJsZUNsaWNrKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuSElHSExJR0hUOgogICAgICAgIHRoaXMuZW5hYmxlVGV4dFNlbGVjdGlvbigpOwogICAgICAgIHRoaXMudG9nZ2xlUG9pbnRlckV2ZW50cyhmYWxzZSk7CiAgICAgICAgdGhpcy5kaXNhYmxlQ2xpY2soKTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aGlzLmRpc2FibGVUZXh0U2VsZWN0aW9uKCk7CiAgICAgICAgdGhpcy50b2dnbGVQb2ludGVyRXZlbnRzKHRydWUpOwogICAgICAgIHRoaXMuZW5hYmxlQ2xpY2soKTsKICAgIH0KICAgIHRoaXMudG9nZ2xlQW5ub3RhdGlvbkxheWVyUG9pbnRlckV2ZW50cyhmYWxzZSk7CiAgICBjb25zdCB7CiAgICAgIGNsYXNzTGlzdAogICAgfSA9IHRoaXMuZGl2OwogICAgZm9yIChjb25zdCBlZGl0b3JUeXBlIG9mIEFubm90YXRpb25FZGl0b3JMYXllci4jZWRpdG9yVHlwZXMudmFsdWVzKCkpIHsKICAgICAgY2xhc3NMaXN0LnRvZ2dsZShgJHtlZGl0b3JUeXBlLl90eXBlfUVkaXRpbmdgLCBtb2RlID09PSBlZGl0b3JUeXBlLl9lZGl0b3JUeXBlKTsKICAgIH0KICAgIHRoaXMuZGl2LmhpZGRlbiA9IGZhbHNlOwogIH0KICBoYXNUZXh0TGF5ZXIodGV4dExheWVyKSB7CiAgICByZXR1cm4gdGV4dExheWVyID09PSB0aGlzLiN0ZXh0TGF5ZXI/LmRpdjsKICB9CiAgc2V0RWRpdGluZ1N0YXRlKGlzRWRpdGluZykgewogICAgdGhpcy4jdWlNYW5hZ2VyLnNldEVkaXRpbmdTdGF0ZShpc0VkaXRpbmcpOwogIH0KICBhZGRDb21tYW5kcyhwYXJhbXMpIHsKICAgIHRoaXMuI3VpTWFuYWdlci5hZGRDb21tYW5kcyhwYXJhbXMpOwogIH0KICBjbGVhblVuZG9TdGFjayh0eXBlKSB7CiAgICB0aGlzLiN1aU1hbmFnZXIuY2xlYW5VbmRvU3RhY2sodHlwZSk7CiAgfQogIHRvZ2dsZURyYXdpbmcoZW5hYmxlZCA9IGZhbHNlKSB7CiAgICB0aGlzLmRpdi5jbGFzc0xpc3QudG9nZ2xlKCJkcmF3aW5nIiwgIWVuYWJsZWQpOwogIH0KICB0b2dnbGVQb2ludGVyRXZlbnRzKGVuYWJsZWQgPSBmYWxzZSkgewogICAgdGhpcy5kaXYuY2xhc3NMaXN0LnRvZ2dsZSgiZGlzYWJsZWQiLCAhZW5hYmxlZCk7CiAgfQogIHRvZ2dsZUFubm90YXRpb25MYXllclBvaW50ZXJFdmVudHMoZW5hYmxlZCA9IGZhbHNlKSB7CiAgICB0aGlzLiNhbm5vdGF0aW9uTGF5ZXI/LmRpdi5jbGFzc0xpc3QudG9nZ2xlKCJkaXNhYmxlZCIsICFlbmFibGVkKTsKICB9CiAgYXN5bmMgZW5hYmxlKCkgewogICAgdGhpcy4jaXNFbmFibGluZyA9IHRydWU7CiAgICB0aGlzLmRpdi50YWJJbmRleCA9IDA7CiAgICB0aGlzLnRvZ2dsZVBvaW50ZXJFdmVudHModHJ1ZSk7CiAgICBjb25zdCBhbm5vdGF0aW9uRWxlbWVudElkcyA9IG5ldyBTZXQoKTsKICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIHRoaXMuI2VkaXRvcnMudmFsdWVzKCkpIHsKICAgICAgZWRpdG9yLmVuYWJsZUVkaXRpbmcoKTsKICAgICAgZWRpdG9yLnNob3codHJ1ZSk7CiAgICAgIGlmIChlZGl0b3IuYW5ub3RhdGlvbkVsZW1lbnRJZCkgewogICAgICAgIHRoaXMuI3VpTWFuYWdlci5yZW1vdmVDaGFuZ2VkRXhpc3RpbmdBbm5vdGF0aW9uKGVkaXRvcik7CiAgICAgICAgYW5ub3RhdGlvbkVsZW1lbnRJZHMuYWRkKGVkaXRvci5hbm5vdGF0aW9uRWxlbWVudElkKTsKICAgICAgfQogICAgfQogICAgaWYgKCF0aGlzLiNhbm5vdGF0aW9uTGF5ZXIpIHsKICAgICAgdGhpcy4jaXNFbmFibGluZyA9IGZhbHNlOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBlZGl0YWJsZXMgPSB0aGlzLiNhbm5vdGF0aW9uTGF5ZXIuZ2V0RWRpdGFibGVBbm5vdGF0aW9ucygpOwogICAgZm9yIChjb25zdCBlZGl0YWJsZSBvZiBlZGl0YWJsZXMpIHsKICAgICAgZWRpdGFibGUuaGlkZSgpOwogICAgICBpZiAodGhpcy4jdWlNYW5hZ2VyLmlzRGVsZXRlZEFubm90YXRpb25FbGVtZW50KGVkaXRhYmxlLmRhdGEuaWQpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGFubm90YXRpb25FbGVtZW50SWRzLmhhcyhlZGl0YWJsZS5kYXRhLmlkKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGVkaXRvciA9IGF3YWl0IHRoaXMuZGVzZXJpYWxpemUoZWRpdGFibGUpOwogICAgICBpZiAoIWVkaXRvcikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRoaXMuYWRkT3JSZWJ1aWxkKGVkaXRvcik7CiAgICAgIGVkaXRvci5lbmFibGVFZGl0aW5nKCk7CiAgICB9CiAgICB0aGlzLiNpc0VuYWJsaW5nID0gZmFsc2U7CiAgfQogIGRpc2FibGUoKSB7CiAgICB0aGlzLiNpc0Rpc2FibGluZyA9IHRydWU7CiAgICB0aGlzLmRpdi50YWJJbmRleCA9IC0xOwogICAgdGhpcy50b2dnbGVQb2ludGVyRXZlbnRzKGZhbHNlKTsKICAgIGNvbnN0IGNoYW5nZWRBbm5vdGF0aW9ucyA9IG5ldyBNYXAoKTsKICAgIGNvbnN0IHJlc2V0QW5ub3RhdGlvbnMgPSBuZXcgTWFwKCk7CiAgICBmb3IgKGNvbnN0IGVkaXRvciBvZiB0aGlzLiNlZGl0b3JzLnZhbHVlcygpKSB7CiAgICAgIGVkaXRvci5kaXNhYmxlRWRpdGluZygpOwogICAgICBpZiAoIWVkaXRvci5hbm5vdGF0aW9uRWxlbWVudElkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGVkaXRvci5zZXJpYWxpemUoKSAhPT0gbnVsbCkgewogICAgICAgIGNoYW5nZWRBbm5vdGF0aW9ucy5zZXQoZWRpdG9yLmFubm90YXRpb25FbGVtZW50SWQsIGVkaXRvcik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzZXRBbm5vdGF0aW9ucy5zZXQoZWRpdG9yLmFubm90YXRpb25FbGVtZW50SWQsIGVkaXRvcik7CiAgICAgIH0KICAgICAgdGhpcy5nZXRFZGl0YWJsZUFubm90YXRpb24oZWRpdG9yLmFubm90YXRpb25FbGVtZW50SWQpPy5zaG93KCk7CiAgICAgIGVkaXRvci5yZW1vdmUoKTsKICAgIH0KICAgIGlmICh0aGlzLiNhbm5vdGF0aW9uTGF5ZXIpIHsKICAgICAgY29uc3QgZWRpdGFibGVzID0gdGhpcy4jYW5ub3RhdGlvbkxheWVyLmdldEVkaXRhYmxlQW5ub3RhdGlvbnMoKTsKICAgICAgZm9yIChjb25zdCBlZGl0YWJsZSBvZiBlZGl0YWJsZXMpIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBpZAogICAgICAgIH0gPSBlZGl0YWJsZS5kYXRhOwogICAgICAgIGlmICh0aGlzLiN1aU1hbmFnZXIuaXNEZWxldGVkQW5ub3RhdGlvbkVsZW1lbnQoaWQpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbGV0IGVkaXRvciA9IHJlc2V0QW5ub3RhdGlvbnMuZ2V0KGlkKTsKICAgICAgICBpZiAoZWRpdG9yKSB7CiAgICAgICAgICBlZGl0b3IucmVzZXRBbm5vdGF0aW9uRWxlbWVudChlZGl0YWJsZSk7CiAgICAgICAgICBlZGl0b3Iuc2hvdyhmYWxzZSk7CiAgICAgICAgICBlZGl0YWJsZS5zaG93KCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgZWRpdG9yID0gY2hhbmdlZEFubm90YXRpb25zLmdldChpZCk7CiAgICAgICAgaWYgKGVkaXRvcikgewogICAgICAgICAgdGhpcy4jdWlNYW5hZ2VyLmFkZENoYW5nZWRFeGlzdGluZ0Fubm90YXRpb24oZWRpdG9yKTsKICAgICAgICAgIGlmIChlZGl0b3IucmVuZGVyQW5ub3RhdGlvbkVsZW1lbnQoZWRpdGFibGUpKSB7CiAgICAgICAgICAgIGVkaXRvci5zaG93KGZhbHNlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWRpdGFibGUuc2hvdygpOwogICAgICB9CiAgICB9CiAgICB0aGlzLiNjbGVhbnVwKCk7CiAgICBpZiAodGhpcy5pc0VtcHR5KSB7CiAgICAgIHRoaXMuZGl2LmhpZGRlbiA9IHRydWU7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGNsYXNzTGlzdAogICAgfSA9IHRoaXMuZGl2OwogICAgZm9yIChjb25zdCBlZGl0b3JUeXBlIG9mIEFubm90YXRpb25FZGl0b3JMYXllci4jZWRpdG9yVHlwZXMudmFsdWVzKCkpIHsKICAgICAgY2xhc3NMaXN0LnJlbW92ZShgJHtlZGl0b3JUeXBlLl90eXBlfUVkaXRpbmdgKTsKICAgIH0KICAgIHRoaXMuZGlzYWJsZVRleHRTZWxlY3Rpb24oKTsKICAgIHRoaXMudG9nZ2xlQW5ub3RhdGlvbkxheWVyUG9pbnRlckV2ZW50cyh0cnVlKTsKICAgIHRoaXMuI2lzRGlzYWJsaW5nID0gZmFsc2U7CiAgfQogIGdldEVkaXRhYmxlQW5ub3RhdGlvbihpZCkgewogICAgcmV0dXJuIHRoaXMuI2Fubm90YXRpb25MYXllcj8uZ2V0RWRpdGFibGVBbm5vdGF0aW9uKGlkKSB8fCBudWxsOwogIH0KICBzZXRBY3RpdmVFZGl0b3IoZWRpdG9yKSB7CiAgICBjb25zdCBjdXJyZW50QWN0aXZlID0gdGhpcy4jdWlNYW5hZ2VyLmdldEFjdGl2ZSgpOwogICAgaWYgKGN1cnJlbnRBY3RpdmUgPT09IGVkaXRvcikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiN1aU1hbmFnZXIuc2V0QWN0aXZlRWRpdG9yKGVkaXRvcik7CiAgfQogIGVuYWJsZVRleHRTZWxlY3Rpb24oKSB7CiAgICB0aGlzLmRpdi50YWJJbmRleCA9IC0xOwogICAgaWYgKHRoaXMuI3RleHRMYXllcj8uZGl2ICYmICF0aGlzLiN0ZXh0U2VsZWN0aW9uQUMpIHsKICAgICAgdGhpcy4jdGV4dFNlbGVjdGlvbkFDID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgICBjb25zdCBzaWduYWwgPSB0aGlzLiN1aU1hbmFnZXIuY29tYmluZWRTaWduYWwodGhpcy4jdGV4dFNlbGVjdGlvbkFDKTsKICAgICAgdGhpcy4jdGV4dExheWVyLmRpdi5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIHRoaXMuI3RleHRMYXllclBvaW50ZXJEb3duLmJpbmQodGhpcyksIHsKICAgICAgICBzaWduYWwKICAgICAgfSk7CiAgICAgIHRoaXMuI3RleHRMYXllci5kaXYuY2xhc3NMaXN0LmFkZCgiaGlnaGxpZ2h0aW5nIik7CiAgICB9CiAgfQogIGRpc2FibGVUZXh0U2VsZWN0aW9uKCkgewogICAgdGhpcy5kaXYudGFiSW5kZXggPSAwOwogICAgaWYgKHRoaXMuI3RleHRMYXllcj8uZGl2ICYmIHRoaXMuI3RleHRTZWxlY3Rpb25BQykgewogICAgICB0aGlzLiN0ZXh0U2VsZWN0aW9uQUMuYWJvcnQoKTsKICAgICAgdGhpcy4jdGV4dFNlbGVjdGlvbkFDID0gbnVsbDsKICAgICAgdGhpcy4jdGV4dExheWVyLmRpdi5jbGFzc0xpc3QucmVtb3ZlKCJoaWdobGlnaHRpbmciKTsKICAgIH0KICB9CiAgI3RleHRMYXllclBvaW50ZXJEb3duKGV2ZW50KSB7CiAgICB0aGlzLiN1aU1hbmFnZXIudW5zZWxlY3RBbGwoKTsKICAgIGNvbnN0IHsKICAgICAgdGFyZ2V0CiAgICB9ID0gZXZlbnQ7CiAgICBpZiAodGFyZ2V0ID09PSB0aGlzLiN0ZXh0TGF5ZXIuZGl2IHx8ICh0YXJnZXQuZ2V0QXR0cmlidXRlKCJyb2xlIikgPT09ICJpbWciIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImVuZE9mQ29udGVudCIpKSAmJiB0aGlzLiN0ZXh0TGF5ZXIuZGl2LmNvbnRhaW5zKHRhcmdldCkpIHsKICAgICAgY29uc3QgewogICAgICAgIGlzTWFjCiAgICAgIH0gPSB1dGlsX0ZlYXR1cmVUZXN0LnBsYXRmb3JtOwogICAgICBpZiAoZXZlbnQuYnV0dG9uICE9PSAwIHx8IGV2ZW50LmN0cmxLZXkgJiYgaXNNYWMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy4jdWlNYW5hZ2VyLnNob3dBbGxFZGl0b3JzKCJoaWdobGlnaHQiLCB0cnVlLCB0cnVlKTsKICAgICAgdGhpcy4jdGV4dExheWVyLmRpdi5jbGFzc0xpc3QuYWRkKCJmcmVlIik7CiAgICAgIHRoaXMudG9nZ2xlRHJhd2luZygpOwogICAgICBIaWdobGlnaHRFZGl0b3Iuc3RhcnRIaWdobGlnaHRpbmcodGhpcywgdGhpcy4jdWlNYW5hZ2VyLmRpcmVjdGlvbiA9PT0gImx0ciIsIHsKICAgICAgICB0YXJnZXQ6IHRoaXMuI3RleHRMYXllci5kaXYsCiAgICAgICAgeDogZXZlbnQueCwKICAgICAgICB5OiBldmVudC55CiAgICAgIH0pOwogICAgICB0aGlzLiN0ZXh0TGF5ZXIuZGl2LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsICgpID0+IHsKICAgICAgICB0aGlzLiN0ZXh0TGF5ZXIuZGl2LmNsYXNzTGlzdC5yZW1vdmUoImZyZWUiKTsKICAgICAgICB0aGlzLnRvZ2dsZURyYXdpbmcodHJ1ZSk7CiAgICAgIH0sIHsKICAgICAgICBvbmNlOiB0cnVlLAogICAgICAgIHNpZ25hbDogdGhpcy4jdWlNYW5hZ2VyLl9zaWduYWwKICAgICAgfSk7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICB9CiAgfQogIGVuYWJsZUNsaWNrKCkgewogICAgaWYgKHRoaXMuI2NsaWNrQUMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jY2xpY2tBQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuI3VpTWFuYWdlci5jb21iaW5lZFNpZ25hbCh0aGlzLiNjbGlja0FDKTsKICAgIHRoaXMuZGl2LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgdGhpcy5wb2ludGVyZG93bi5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICBjb25zdCBwb2ludGVydXAgPSB0aGlzLnBvaW50ZXJ1cC5iaW5kKHRoaXMpOwogICAgdGhpcy5kaXYuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgcG9pbnRlcnVwLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB0aGlzLmRpdi5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyY2FuY2VsIiwgcG9pbnRlcnVwLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgfQogIGRpc2FibGVDbGljaygpIHsKICAgIHRoaXMuI2NsaWNrQUM/LmFib3J0KCk7CiAgICB0aGlzLiNjbGlja0FDID0gbnVsbDsKICB9CiAgYXR0YWNoKGVkaXRvcikgewogICAgdGhpcy4jZWRpdG9ycy5zZXQoZWRpdG9yLmlkLCBlZGl0b3IpOwogICAgY29uc3QgewogICAgICBhbm5vdGF0aW9uRWxlbWVudElkCiAgICB9ID0gZWRpdG9yOwogICAgaWYgKGFubm90YXRpb25FbGVtZW50SWQgJiYgdGhpcy4jdWlNYW5hZ2VyLmlzRGVsZXRlZEFubm90YXRpb25FbGVtZW50KGFubm90YXRpb25FbGVtZW50SWQpKSB7CiAgICAgIHRoaXMuI3VpTWFuYWdlci5yZW1vdmVEZWxldGVkQW5ub3RhdGlvbkVsZW1lbnQoZWRpdG9yKTsKICAgIH0KICB9CiAgZGV0YWNoKGVkaXRvcikgewogICAgdGhpcy4jZWRpdG9ycy5kZWxldGUoZWRpdG9yLmlkKTsKICAgIHRoaXMuI2FjY2Vzc2liaWxpdHlNYW5hZ2VyPy5yZW1vdmVQb2ludGVySW5UZXh0TGF5ZXIoZWRpdG9yLmNvbnRlbnREaXYpOwogICAgaWYgKCF0aGlzLiNpc0Rpc2FibGluZyAmJiBlZGl0b3IuYW5ub3RhdGlvbkVsZW1lbnRJZCkgewogICAgICB0aGlzLiN1aU1hbmFnZXIuYWRkRGVsZXRlZEFubm90YXRpb25FbGVtZW50KGVkaXRvcik7CiAgICB9CiAgfQogIHJlbW92ZShlZGl0b3IpIHsKICAgIHRoaXMuZGV0YWNoKGVkaXRvcik7CiAgICB0aGlzLiN1aU1hbmFnZXIucmVtb3ZlRWRpdG9yKGVkaXRvcik7CiAgICBlZGl0b3IuZGl2LnJlbW92ZSgpOwogICAgZWRpdG9yLmlzQXR0YWNoZWRUb0RPTSA9IGZhbHNlOwogIH0KICBjaGFuZ2VQYXJlbnQoZWRpdG9yKSB7CiAgICBpZiAoZWRpdG9yLnBhcmVudCA9PT0gdGhpcykgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoZWRpdG9yLnBhcmVudCAmJiBlZGl0b3IuYW5ub3RhdGlvbkVsZW1lbnRJZCkgewogICAgICB0aGlzLiN1aU1hbmFnZXIuYWRkRGVsZXRlZEFubm90YXRpb25FbGVtZW50KGVkaXRvci5hbm5vdGF0aW9uRWxlbWVudElkKTsKICAgICAgQW5ub3RhdGlvbkVkaXRvci5kZWxldGVBbm5vdGF0aW9uRWxlbWVudChlZGl0b3IpOwogICAgICBlZGl0b3IuYW5ub3RhdGlvbkVsZW1lbnRJZCA9IG51bGw7CiAgICB9CiAgICB0aGlzLmF0dGFjaChlZGl0b3IpOwogICAgZWRpdG9yLnBhcmVudD8uZGV0YWNoKGVkaXRvcik7CiAgICBlZGl0b3Iuc2V0UGFyZW50KHRoaXMpOwogICAgaWYgKGVkaXRvci5kaXYgJiYgZWRpdG9yLmlzQXR0YWNoZWRUb0RPTSkgewogICAgICBlZGl0b3IuZGl2LnJlbW92ZSgpOwogICAgICB0aGlzLmRpdi5hcHBlbmQoZWRpdG9yLmRpdik7CiAgICB9CiAgfQogIGFkZChlZGl0b3IpIHsKICAgIGlmIChlZGl0b3IucGFyZW50ID09PSB0aGlzICYmIGVkaXRvci5pc0F0dGFjaGVkVG9ET00pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5jaGFuZ2VQYXJlbnQoZWRpdG9yKTsKICAgIHRoaXMuI3VpTWFuYWdlci5hZGRFZGl0b3IoZWRpdG9yKTsKICAgIHRoaXMuYXR0YWNoKGVkaXRvcik7CiAgICBpZiAoIWVkaXRvci5pc0F0dGFjaGVkVG9ET00pIHsKICAgICAgY29uc3QgZGl2ID0gZWRpdG9yLnJlbmRlcigpOwogICAgICB0aGlzLmRpdi5hcHBlbmQoZGl2KTsKICAgICAgZWRpdG9yLmlzQXR0YWNoZWRUb0RPTSA9IHRydWU7CiAgICB9CiAgICBlZGl0b3IuZml4QW5kU2V0UG9zaXRpb24oKTsKICAgIGVkaXRvci5vbmNlQWRkZWQoIXRoaXMuI2lzRW5hYmxpbmcpOwogICAgdGhpcy4jdWlNYW5hZ2VyLmFkZFRvQW5ub3RhdGlvblN0b3JhZ2UoZWRpdG9yKTsKICAgIGVkaXRvci5fcmVwb3J0VGVsZW1ldHJ5KGVkaXRvci50ZWxlbWV0cnlJbml0aWFsRGF0YSk7CiAgfQogIG1vdmVFZGl0b3JJbkRPTShlZGl0b3IpIHsKICAgIGlmICghZWRpdG9yLmlzQXR0YWNoZWRUb0RPTSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGFjdGl2ZUVsZW1lbnQKICAgIH0gPSBkb2N1bWVudDsKICAgIGlmIChlZGl0b3IuZGl2LmNvbnRhaW5zKGFjdGl2ZUVsZW1lbnQpICYmICF0aGlzLiNlZGl0b3JGb2N1c1RpbWVvdXRJZCkgewogICAgICBlZGl0b3IuX2ZvY3VzRXZlbnRzQWxsb3dlZCA9IGZhbHNlOwogICAgICB0aGlzLiNlZGl0b3JGb2N1c1RpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRoaXMuI2VkaXRvckZvY3VzVGltZW91dElkID0gbnVsbDsKICAgICAgICBpZiAoIWVkaXRvci5kaXYuY29udGFpbnMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkpIHsKICAgICAgICAgIGVkaXRvci5kaXYuYWRkRXZlbnRMaXN0ZW5lcigiZm9jdXNpbiIsICgpID0+IHsKICAgICAgICAgICAgZWRpdG9yLl9mb2N1c0V2ZW50c0FsbG93ZWQgPSB0cnVlOwogICAgICAgICAgfSwgewogICAgICAgICAgICBvbmNlOiB0cnVlLAogICAgICAgICAgICBzaWduYWw6IHRoaXMuI3VpTWFuYWdlci5fc2lnbmFsCiAgICAgICAgICB9KTsKICAgICAgICAgIGFjdGl2ZUVsZW1lbnQuZm9jdXMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZWRpdG9yLl9mb2N1c0V2ZW50c0FsbG93ZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSwgMCk7CiAgICB9CiAgICBlZGl0b3IuX3N0cnVjdFRyZWVQYXJlbnRJZCA9IHRoaXMuI2FjY2Vzc2liaWxpdHlNYW5hZ2VyPy5tb3ZlRWxlbWVudEluRE9NKHRoaXMuZGl2LCBlZGl0b3IuZGl2LCBlZGl0b3IuY29udGVudERpdiwgdHJ1ZSk7CiAgfQogIGFkZE9yUmVidWlsZChlZGl0b3IpIHsKICAgIGlmIChlZGl0b3IubmVlZHNUb0JlUmVidWlsdCgpKSB7CiAgICAgIGVkaXRvci5wYXJlbnQgfHw9IHRoaXM7CiAgICAgIGVkaXRvci5yZWJ1aWxkKCk7CiAgICAgIGVkaXRvci5zaG93KCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmFkZChlZGl0b3IpOwogICAgfQogIH0KICBhZGRVbmRvYWJsZUVkaXRvcihlZGl0b3IpIHsKICAgIGNvbnN0IGNtZCA9ICgpID0+IGVkaXRvci5fdWlNYW5hZ2VyLnJlYnVpbGQoZWRpdG9yKTsKICAgIGNvbnN0IHVuZG8gPSAoKSA9PiB7CiAgICAgIGVkaXRvci5yZW1vdmUoKTsKICAgIH07CiAgICB0aGlzLmFkZENvbW1hbmRzKHsKICAgICAgY21kLAogICAgICB1bmRvLAogICAgICBtdXN0RXhlYzogZmFsc2UKICAgIH0pOwogIH0KICBnZXROZXh0SWQoKSB7CiAgICByZXR1cm4gdGhpcy4jdWlNYW5hZ2VyLmdldElkKCk7CiAgfQogIGdldCAjY3VycmVudEVkaXRvclR5cGUoKSB7CiAgICByZXR1cm4gQW5ub3RhdGlvbkVkaXRvckxheWVyLiNlZGl0b3JUeXBlcy5nZXQodGhpcy4jdWlNYW5hZ2VyLmdldE1vZGUoKSk7CiAgfQogIGNvbWJpbmVkU2lnbmFsKGFjKSB7CiAgICByZXR1cm4gdGhpcy4jdWlNYW5hZ2VyLmNvbWJpbmVkU2lnbmFsKGFjKTsKICB9CiAgI2NyZWF0ZU5ld0VkaXRvcihwYXJhbXMpIHsKICAgIGNvbnN0IGVkaXRvclR5cGUgPSB0aGlzLiNjdXJyZW50RWRpdG9yVHlwZTsKICAgIHJldHVybiBlZGl0b3JUeXBlID8gbmV3IGVkaXRvclR5cGUucHJvdG90eXBlLmNvbnN0cnVjdG9yKHBhcmFtcykgOiBudWxsOwogIH0KICBjYW5DcmVhdGVOZXdFbXB0eUVkaXRvcigpIHsKICAgIHJldHVybiB0aGlzLiNjdXJyZW50RWRpdG9yVHlwZT8uY2FuQ3JlYXRlTmV3RW1wdHlFZGl0b3IoKTsKICB9CiAgYXN5bmMgcGFzdGVFZGl0b3Iob3B0aW9ucywgcGFyYW1zKSB7CiAgICB0aGlzLnVwZGF0ZVRvb2xiYXIob3B0aW9ucyk7CiAgICBhd2FpdCB0aGlzLiN1aU1hbmFnZXIudXBkYXRlTW9kZShvcHRpb25zLm1vZGUpOwogICAgY29uc3QgewogICAgICBvZmZzZXRYLAogICAgICBvZmZzZXRZCiAgICB9ID0gdGhpcy4jZ2V0Q2VudGVyUG9pbnQoKTsKICAgIGNvbnN0IGlkID0gdGhpcy5nZXROZXh0SWQoKTsKICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuI2NyZWF0ZU5ld0VkaXRvcih7CiAgICAgIHBhcmVudDogdGhpcywKICAgICAgaWQsCiAgICAgIHg6IG9mZnNldFgsCiAgICAgIHk6IG9mZnNldFksCiAgICAgIHVpTWFuYWdlcjogdGhpcy4jdWlNYW5hZ2VyLAogICAgICBpc0NlbnRlcmVkOiB0cnVlLAogICAgICAuLi5wYXJhbXMKICAgIH0pOwogICAgaWYgKGVkaXRvcikgewogICAgICB0aGlzLmFkZChlZGl0b3IpOwogICAgfQogIH0KICBhc3luYyBkZXNlcmlhbGl6ZShkYXRhKSB7CiAgICByZXR1cm4gKGF3YWl0IEFubm90YXRpb25FZGl0b3JMYXllci4jZWRpdG9yVHlwZXMuZ2V0KGRhdGEuYW5ub3RhdGlvblR5cGUgPz8gZGF0YS5hbm5vdGF0aW9uRWRpdG9yVHlwZSk/LmRlc2VyaWFsaXplKGRhdGEsIHRoaXMsIHRoaXMuI3VpTWFuYWdlcikpIHx8IG51bGw7CiAgfQogIGNyZWF0ZUFuZEFkZE5ld0VkaXRvcihldmVudCwgaXNDZW50ZXJlZCwgZGF0YSA9IHt9KSB7CiAgICBjb25zdCBpZCA9IHRoaXMuZ2V0TmV4dElkKCk7CiAgICBjb25zdCBlZGl0b3IgPSB0aGlzLiNjcmVhdGVOZXdFZGl0b3IoewogICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgIGlkLAogICAgICB4OiBldmVudC5vZmZzZXRYLAogICAgICB5OiBldmVudC5vZmZzZXRZLAogICAgICB1aU1hbmFnZXI6IHRoaXMuI3VpTWFuYWdlciwKICAgICAgaXNDZW50ZXJlZCwKICAgICAgLi4uZGF0YQogICAgfSk7CiAgICBpZiAoZWRpdG9yKSB7CiAgICAgIHRoaXMuYWRkKGVkaXRvcik7CiAgICB9CiAgICByZXR1cm4gZWRpdG9yOwogIH0KICAjZ2V0Q2VudGVyUG9pbnQoKSB7CiAgICBjb25zdCB7CiAgICAgIHgsCiAgICAgIHksCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSB0aGlzLmRpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGNvbnN0IHRsWCA9IE1hdGgubWF4KDAsIHgpOwogICAgY29uc3QgdGxZID0gTWF0aC5tYXgoMCwgeSk7CiAgICBjb25zdCBiclggPSBNYXRoLm1pbih3aW5kb3cuaW5uZXJXaWR0aCwgeCArIHdpZHRoKTsKICAgIGNvbnN0IGJyWSA9IE1hdGgubWluKHdpbmRvdy5pbm5lckhlaWdodCwgeSArIGhlaWdodCk7CiAgICBjb25zdCBjZW50ZXJYID0gKHRsWCArIGJyWCkgLyAyIC0geDsKICAgIGNvbnN0IGNlbnRlclkgPSAodGxZICsgYnJZKSAvIDIgLSB5OwogICAgY29uc3QgW29mZnNldFgsIG9mZnNldFldID0gdGhpcy52aWV3cG9ydC5yb3RhdGlvbiAlIDE4MCA9PT0gMCA/IFtjZW50ZXJYLCBjZW50ZXJZXSA6IFtjZW50ZXJZLCBjZW50ZXJYXTsKICAgIHJldHVybiB7CiAgICAgIG9mZnNldFgsCiAgICAgIG9mZnNldFkKICAgIH07CiAgfQogIGFkZE5ld0VkaXRvcihkYXRhID0ge30pIHsKICAgIHRoaXMuY3JlYXRlQW5kQWRkTmV3RWRpdG9yKHRoaXMuI2dldENlbnRlclBvaW50KCksIHRydWUsIGRhdGEpOwogIH0KICBzZXRTZWxlY3RlZChlZGl0b3IpIHsKICAgIHRoaXMuI3VpTWFuYWdlci5zZXRTZWxlY3RlZChlZGl0b3IpOwogIH0KICB0b2dnbGVTZWxlY3RlZChlZGl0b3IpIHsKICAgIHRoaXMuI3VpTWFuYWdlci50b2dnbGVTZWxlY3RlZChlZGl0b3IpOwogIH0KICB1bnNlbGVjdChlZGl0b3IpIHsKICAgIHRoaXMuI3VpTWFuYWdlci51bnNlbGVjdChlZGl0b3IpOwogIH0KICBwb2ludGVydXAoZXZlbnQpIHsKICAgIGNvbnN0IHsKICAgICAgaXNNYWMKICAgIH0gPSB1dGlsX0ZlYXR1cmVUZXN0LnBsYXRmb3JtOwogICAgaWYgKGV2ZW50LmJ1dHRvbiAhPT0gMCB8fCBldmVudC5jdHJsS2V5ICYmIGlzTWFjKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChldmVudC50YXJnZXQgIT09IHRoaXMuZGl2KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpcy4jaGFkUG9pbnRlckRvd24pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jaGFkUG9pbnRlckRvd24gPSBmYWxzZTsKICAgIGlmICh0aGlzLiNjdXJyZW50RWRpdG9yVHlwZT8uaXNEcmF3ZXIgJiYgdGhpcy4jY3VycmVudEVkaXRvclR5cGUuc3VwcG9ydE11bHRpcGxlRHJhd2luZ3MpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzLiNhbGxvd0NsaWNrKSB7CiAgICAgIHRoaXMuI2FsbG93Q2xpY2sgPSB0cnVlOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjdXJyZW50TW9kZSA9IHRoaXMuI3VpTWFuYWdlci5nZXRNb2RlKCk7CiAgICBpZiAoY3VycmVudE1vZGUgPT09IEFubm90YXRpb25FZGl0b3JUeXBlLlNUQU1QIHx8IGN1cnJlbnRNb2RlID09PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5TSUdOQVRVUkUpIHsKICAgICAgdGhpcy4jdWlNYW5hZ2VyLnVuc2VsZWN0QWxsKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuY3JlYXRlQW5kQWRkTmV3RWRpdG9yKGV2ZW50LCBmYWxzZSk7CiAgfQogIHBvaW50ZXJkb3duKGV2ZW50KSB7CiAgICBpZiAodGhpcy4jdWlNYW5hZ2VyLmdldE1vZGUoKSA9PT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuSElHSExJR0hUKSB7CiAgICAgIHRoaXMuZW5hYmxlVGV4dFNlbGVjdGlvbigpOwogICAgfQogICAgaWYgKHRoaXMuI2hhZFBvaW50ZXJEb3duKSB7CiAgICAgIHRoaXMuI2hhZFBvaW50ZXJEb3duID0gZmFsc2U7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgaXNNYWMKICAgIH0gPSB1dGlsX0ZlYXR1cmVUZXN0LnBsYXRmb3JtOwogICAgaWYgKGV2ZW50LmJ1dHRvbiAhPT0gMCB8fCBldmVudC5jdHJsS2V5ICYmIGlzTWFjKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChldmVudC50YXJnZXQgIT09IHRoaXMuZGl2KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2hhZFBvaW50ZXJEb3duID0gdHJ1ZTsKICAgIGlmICh0aGlzLiNjdXJyZW50RWRpdG9yVHlwZT8uaXNEcmF3ZXIpIHsKICAgICAgdGhpcy5zdGFydERyYXdpbmdTZXNzaW9uKGV2ZW50KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZWRpdG9yID0gdGhpcy4jdWlNYW5hZ2VyLmdldEFjdGl2ZSgpOwogICAgdGhpcy4jYWxsb3dDbGljayA9ICFlZGl0b3IgfHwgZWRpdG9yLmlzRW1wdHkoKTsKICB9CiAgc3RhcnREcmF3aW5nU2Vzc2lvbihldmVudCkgewogICAgdGhpcy5kaXYuZm9jdXMoewogICAgICBwcmV2ZW50U2Nyb2xsOiB0cnVlCiAgICB9KTsKICAgIGlmICh0aGlzLiNkcmF3aW5nQUMpIHsKICAgICAgdGhpcy4jY3VycmVudEVkaXRvclR5cGUuc3RhcnREcmF3aW5nKHRoaXMsIHRoaXMuI3VpTWFuYWdlciwgZmFsc2UsIGV2ZW50KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jdWlNYW5hZ2VyLnNldEN1cnJlbnREcmF3aW5nU2Vzc2lvbih0aGlzKTsKICAgIHRoaXMuI2RyYXdpbmdBQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGNvbnN0IHNpZ25hbCA9IHRoaXMuI3VpTWFuYWdlci5jb21iaW5lZFNpZ25hbCh0aGlzLiNkcmF3aW5nQUMpOwogICAgdGhpcy5kaXYuYWRkRXZlbnRMaXN0ZW5lcigiYmx1ciIsICh7CiAgICAgIHJlbGF0ZWRUYXJnZXQKICAgIH0pID0+IHsKICAgICAgaWYgKHJlbGF0ZWRUYXJnZXQgJiYgIXRoaXMuZGl2LmNvbnRhaW5zKHJlbGF0ZWRUYXJnZXQpKSB7CiAgICAgICAgdGhpcy4jZm9jdXNlZEVsZW1lbnQgPSBudWxsOwogICAgICAgIHRoaXMuY29tbWl0T3JSZW1vdmUoKTsKICAgICAgfQogICAgfSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgdGhpcy4jY3VycmVudEVkaXRvclR5cGUuc3RhcnREcmF3aW5nKHRoaXMsIHRoaXMuI3VpTWFuYWdlciwgZmFsc2UsIGV2ZW50KTsKICB9CiAgcGF1c2Uob24pIHsKICAgIGlmIChvbikgewogICAgICBjb25zdCB7CiAgICAgICAgYWN0aXZlRWxlbWVudAogICAgICB9ID0gZG9jdW1lbnQ7CiAgICAgIGlmICh0aGlzLmRpdi5jb250YWlucyhhY3RpdmVFbGVtZW50KSkgewogICAgICAgIHRoaXMuI2ZvY3VzZWRFbGVtZW50ID0gYWN0aXZlRWxlbWVudDsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy4jZm9jdXNlZEVsZW1lbnQpIHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy4jZm9jdXNlZEVsZW1lbnQ/LmZvY3VzKCk7CiAgICAgICAgdGhpcy4jZm9jdXNlZEVsZW1lbnQgPSBudWxsOwogICAgICB9LCAwKTsKICAgIH0KICB9CiAgZW5kRHJhd2luZ1Nlc3Npb24oaXNBYm9ydGVkID0gZmFsc2UpIHsKICAgIGlmICghdGhpcy4jZHJhd2luZ0FDKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdGhpcy4jdWlNYW5hZ2VyLnNldEN1cnJlbnREcmF3aW5nU2Vzc2lvbihudWxsKTsKICAgIHRoaXMuI2RyYXdpbmdBQy5hYm9ydCgpOwogICAgdGhpcy4jZHJhd2luZ0FDID0gbnVsbDsKICAgIHRoaXMuI2ZvY3VzZWRFbGVtZW50ID0gbnVsbDsKICAgIHJldHVybiB0aGlzLiNjdXJyZW50RWRpdG9yVHlwZS5lbmREcmF3aW5nKGlzQWJvcnRlZCk7CiAgfQogIGZpbmROZXdQYXJlbnQoZWRpdG9yLCB4LCB5KSB7CiAgICBjb25zdCBsYXllciA9IHRoaXMuI3VpTWFuYWdlci5maW5kUGFyZW50KHgsIHkpOwogICAgaWYgKGxheWVyID09PSBudWxsIHx8IGxheWVyID09PSB0aGlzKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGxheWVyLmNoYW5nZVBhcmVudChlZGl0b3IpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIGNvbW1pdE9yUmVtb3ZlKCkgewogICAgaWYgKHRoaXMuI2RyYXdpbmdBQykgewogICAgICB0aGlzLmVuZERyYXdpbmdTZXNzaW9uKCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KICBvblNjYWxlQ2hhbmdpbmcoKSB7CiAgICBpZiAoIXRoaXMuI2RyYXdpbmdBQykgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNjdXJyZW50RWRpdG9yVHlwZS5vblNjYWxlQ2hhbmdpbmdXaGVuRHJhd2luZyh0aGlzKTsKICB9CiAgZGVzdHJveSgpIHsKICAgIHRoaXMuY29tbWl0T3JSZW1vdmUoKTsKICAgIGlmICh0aGlzLiN1aU1hbmFnZXIuZ2V0QWN0aXZlKCk/LnBhcmVudCA9PT0gdGhpcykgewogICAgICB0aGlzLiN1aU1hbmFnZXIuY29tbWl0T3JSZW1vdmUoKTsKICAgICAgdGhpcy4jdWlNYW5hZ2VyLnNldEFjdGl2ZUVkaXRvcihudWxsKTsKICAgIH0KICAgIGlmICh0aGlzLiNlZGl0b3JGb2N1c1RpbWVvdXRJZCkgewogICAgICBjbGVhclRpbWVvdXQodGhpcy4jZWRpdG9yRm9jdXNUaW1lb3V0SWQpOwogICAgICB0aGlzLiNlZGl0b3JGb2N1c1RpbWVvdXRJZCA9IG51bGw7CiAgICB9CiAgICBmb3IgKGNvbnN0IGVkaXRvciBvZiB0aGlzLiNlZGl0b3JzLnZhbHVlcygpKSB7CiAgICAgIHRoaXMuI2FjY2Vzc2liaWxpdHlNYW5hZ2VyPy5yZW1vdmVQb2ludGVySW5UZXh0TGF5ZXIoZWRpdG9yLmNvbnRlbnREaXYpOwogICAgICBlZGl0b3Iuc2V0UGFyZW50KG51bGwpOwogICAgICBlZGl0b3IuaXNBdHRhY2hlZFRvRE9NID0gZmFsc2U7CiAgICAgIGVkaXRvci5kaXYucmVtb3ZlKCk7CiAgICB9CiAgICB0aGlzLmRpdiA9IG51bGw7CiAgICB0aGlzLiNlZGl0b3JzLmNsZWFyKCk7CiAgICB0aGlzLiN1aU1hbmFnZXIucmVtb3ZlTGF5ZXIodGhpcyk7CiAgfQogICNjbGVhbnVwKCkgewogICAgZm9yIChjb25zdCBlZGl0b3Igb2YgdGhpcy4jZWRpdG9ycy52YWx1ZXMoKSkgewogICAgICBpZiAoZWRpdG9yLmlzRW1wdHkoKSkgewogICAgICAgIGVkaXRvci5yZW1vdmUoKTsKICAgICAgfQogICAgfQogIH0KICByZW5kZXIoewogICAgdmlld3BvcnQKICB9KSB7CiAgICB0aGlzLnZpZXdwb3J0ID0gdmlld3BvcnQ7CiAgICBzZXRMYXllckRpbWVuc2lvbnModGhpcy5kaXYsIHZpZXdwb3J0KTsKICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIHRoaXMuI3VpTWFuYWdlci5nZXRFZGl0b3JzKHRoaXMucGFnZUluZGV4KSkgewogICAgICB0aGlzLmFkZChlZGl0b3IpOwogICAgICBlZGl0b3IucmVidWlsZCgpOwogICAgfQogICAgdGhpcy51cGRhdGVNb2RlKCk7CiAgfQogIHVwZGF0ZSh7CiAgICB2aWV3cG9ydAogIH0pIHsKICAgIHRoaXMuI3VpTWFuYWdlci5jb21taXRPclJlbW92ZSgpOwogICAgdGhpcy4jY2xlYW51cCgpOwogICAgY29uc3Qgb2xkUm90YXRpb24gPSB0aGlzLnZpZXdwb3J0LnJvdGF0aW9uOwogICAgY29uc3Qgcm90YXRpb24gPSB2aWV3cG9ydC5yb3RhdGlvbjsKICAgIHRoaXMudmlld3BvcnQgPSB2aWV3cG9ydDsKICAgIHNldExheWVyRGltZW5zaW9ucyh0aGlzLmRpdiwgewogICAgICByb3RhdGlvbgogICAgfSk7CiAgICBpZiAob2xkUm90YXRpb24gIT09IHJvdGF0aW9uKSB7CiAgICAgIGZvciAoY29uc3QgZWRpdG9yIG9mIHRoaXMuI2VkaXRvcnMudmFsdWVzKCkpIHsKICAgICAgICBlZGl0b3Iucm90YXRlKHJvdGF0aW9uKTsKICAgICAgfQogICAgfQogIH0KICBnZXQgcGFnZURpbWVuc2lvbnMoKSB7CiAgICBjb25zdCB7CiAgICAgIHBhZ2VXaWR0aCwKICAgICAgcGFnZUhlaWdodAogICAgfSA9IHRoaXMudmlld3BvcnQucmF3RGltczsKICAgIHJldHVybiBbcGFnZVdpZHRoLCBwYWdlSGVpZ2h0XTsKICB9CiAgZ2V0IHNjYWxlKCkgewogICAgcmV0dXJuIHRoaXMuI3VpTWFuYWdlci52aWV3UGFyYW1ldGVycy5yZWFsU2NhbGU7CiAgfQp9Cgo7Ly8gLi9zcmMvZGlzcGxheS9kcmF3X2xheWVyLmpzCgoKY2xhc3MgRHJhd0xheWVyIHsKICAjcGFyZW50ID0gbnVsbDsKICAjbWFwcGluZyA9IG5ldyBNYXAoKTsKICAjdG9VcGRhdGUgPSBuZXcgTWFwKCk7CiAgc3RhdGljICNpZCA9IDA7CiAgY29uc3RydWN0b3IoewogICAgcGFnZUluZGV4CiAgfSkgewogICAgdGhpcy5wYWdlSW5kZXggPSBwYWdlSW5kZXg7CiAgfQogIHNldFBhcmVudChwYXJlbnQpIHsKICAgIGlmICghdGhpcy4jcGFyZW50KSB7CiAgICAgIHRoaXMuI3BhcmVudCA9IHBhcmVudDsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuI3BhcmVudCAhPT0gcGFyZW50KSB7CiAgICAgIGlmICh0aGlzLiNtYXBwaW5nLnNpemUgPiAwKSB7CiAgICAgICAgZm9yIChjb25zdCByb290IG9mIHRoaXMuI21hcHBpbmcudmFsdWVzKCkpIHsKICAgICAgICAgIHJvb3QucmVtb3ZlKCk7CiAgICAgICAgICBwYXJlbnQuYXBwZW5kKHJvb3QpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLiNwYXJlbnQgPSBwYXJlbnQ7CiAgICB9CiAgfQogIHN0YXRpYyBnZXQgX3N2Z0ZhY3RvcnkoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfc3ZnRmFjdG9yeSIsIG5ldyBET01TVkdGYWN0b3J5KCkpOwogIH0KICBzdGF0aWMgI3NldEJveChlbGVtZW50LCBbeCwgeSwgd2lkdGgsIGhlaWdodF0pIHsKICAgIGNvbnN0IHsKICAgICAgc3R5bGUKICAgIH0gPSBlbGVtZW50OwogICAgc3R5bGUudG9wID0gYCR7MTAwICogeX0lYDsKICAgIHN0eWxlLmxlZnQgPSBgJHsxMDAgKiB4fSVgOwogICAgc3R5bGUud2lkdGggPSBgJHsxMDAgKiB3aWR0aH0lYDsKICAgIHN0eWxlLmhlaWdodCA9IGAkezEwMCAqIGhlaWdodH0lYDsKICB9CiAgI2NyZWF0ZVNWRygpIHsKICAgIGNvbnN0IHN2ZyA9IERyYXdMYXllci5fc3ZnRmFjdG9yeS5jcmVhdGUoMSwgMSwgdHJ1ZSk7CiAgICB0aGlzLiNwYXJlbnQuYXBwZW5kKHN2Zyk7CiAgICBzdmcuc2V0QXR0cmlidXRlKCJhcmlhLWhpZGRlbiIsIHRydWUpOwogICAgcmV0dXJuIHN2ZzsKICB9CiAgI2NyZWF0ZUNsaXBQYXRoKGRlZnMsIHBhdGhJZCkgewogICAgY29uc3QgY2xpcFBhdGggPSBEcmF3TGF5ZXIuX3N2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgiY2xpcFBhdGgiKTsKICAgIGRlZnMuYXBwZW5kKGNsaXBQYXRoKTsKICAgIGNvbnN0IGNsaXBQYXRoSWQgPSBgY2xpcF8ke3BhdGhJZH1gOwogICAgY2xpcFBhdGguc2V0QXR0cmlidXRlKCJpZCIsIGNsaXBQYXRoSWQpOwogICAgY2xpcFBhdGguc2V0QXR0cmlidXRlKCJjbGlwUGF0aFVuaXRzIiwgIm9iamVjdEJvdW5kaW5nQm94Iik7CiAgICBjb25zdCBjbGlwUGF0aFVzZSA9IERyYXdMYXllci5fc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJ1c2UiKTsKICAgIGNsaXBQYXRoLmFwcGVuZChjbGlwUGF0aFVzZSk7CiAgICBjbGlwUGF0aFVzZS5zZXRBdHRyaWJ1dGUoImhyZWYiLCBgIyR7cGF0aElkfWApOwogICAgY2xpcFBhdGhVc2UuY2xhc3NMaXN0LmFkZCgiY2xpcCIpOwogICAgcmV0dXJuIGNsaXBQYXRoSWQ7CiAgfQogICN1cGRhdGVQcm9wZXJ0aWVzKGVsZW1lbnQsIHByb3BlcnRpZXMpIHsKICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHByb3BlcnRpZXMpKSB7CiAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgewogICAgICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKGtleSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KICB9CiAgZHJhdyhwcm9wZXJ0aWVzLCBpc1BhdGhVcGRhdGFibGUgPSBmYWxzZSwgaGFzQ2xpcCA9IGZhbHNlKSB7CiAgICBjb25zdCBpZCA9IERyYXdMYXllci4jaWQrKzsKICAgIGNvbnN0IHJvb3QgPSB0aGlzLiNjcmVhdGVTVkcoKTsKICAgIGNvbnN0IGRlZnMgPSBEcmF3TGF5ZXIuX3N2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgiZGVmcyIpOwogICAgcm9vdC5hcHBlbmQoZGVmcyk7CiAgICBjb25zdCBwYXRoID0gRHJhd0xheWVyLl9zdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInBhdGgiKTsKICAgIGRlZnMuYXBwZW5kKHBhdGgpOwogICAgY29uc3QgcGF0aElkID0gYHBhdGhfcCR7dGhpcy5wYWdlSW5kZXh9XyR7aWR9YDsKICAgIHBhdGguc2V0QXR0cmlidXRlKCJpZCIsIHBhdGhJZCk7CiAgICBwYXRoLnNldEF0dHJpYnV0ZSgidmVjdG9yLWVmZmVjdCIsICJub24tc2NhbGluZy1zdHJva2UiKTsKICAgIGlmIChpc1BhdGhVcGRhdGFibGUpIHsKICAgICAgdGhpcy4jdG9VcGRhdGUuc2V0KGlkLCBwYXRoKTsKICAgIH0KICAgIGNvbnN0IGNsaXBQYXRoSWQgPSBoYXNDbGlwID8gdGhpcy4jY3JlYXRlQ2xpcFBhdGgoZGVmcywgcGF0aElkKSA6IG51bGw7CiAgICBjb25zdCB1c2UgPSBEcmF3TGF5ZXIuX3N2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgidXNlIik7CiAgICByb290LmFwcGVuZCh1c2UpOwogICAgdXNlLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGAjJHtwYXRoSWR9YCk7CiAgICB0aGlzLnVwZGF0ZVByb3BlcnRpZXMocm9vdCwgcHJvcGVydGllcyk7CiAgICB0aGlzLiNtYXBwaW5nLnNldChpZCwgcm9vdCk7CiAgICByZXR1cm4gewogICAgICBpZCwKICAgICAgY2xpcFBhdGhJZDogYHVybCgjJHtjbGlwUGF0aElkfSlgCiAgICB9OwogIH0KICBkcmF3T3V0bGluZShwcm9wZXJ0aWVzLCBtdXN0UmVtb3ZlU2VsZkludGVyc2VjdGlvbnMpIHsKICAgIGNvbnN0IGlkID0gRHJhd0xheWVyLiNpZCsrOwogICAgY29uc3Qgcm9vdCA9IHRoaXMuI2NyZWF0ZVNWRygpOwogICAgY29uc3QgZGVmcyA9IERyYXdMYXllci5fc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJkZWZzIik7CiAgICByb290LmFwcGVuZChkZWZzKTsKICAgIGNvbnN0IHBhdGggPSBEcmF3TGF5ZXIuX3N2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgicGF0aCIpOwogICAgZGVmcy5hcHBlbmQocGF0aCk7CiAgICBjb25zdCBwYXRoSWQgPSBgcGF0aF9wJHt0aGlzLnBhZ2VJbmRleH1fJHtpZH1gOwogICAgcGF0aC5zZXRBdHRyaWJ1dGUoImlkIiwgcGF0aElkKTsKICAgIHBhdGguc2V0QXR0cmlidXRlKCJ2ZWN0b3ItZWZmZWN0IiwgIm5vbi1zY2FsaW5nLXN0cm9rZSIpOwogICAgbGV0IG1hc2tJZDsKICAgIGlmIChtdXN0UmVtb3ZlU2VsZkludGVyc2VjdGlvbnMpIHsKICAgICAgY29uc3QgbWFzayA9IERyYXdMYXllci5fc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJtYXNrIik7CiAgICAgIGRlZnMuYXBwZW5kKG1hc2spOwogICAgICBtYXNrSWQgPSBgbWFza19wJHt0aGlzLnBhZ2VJbmRleH1fJHtpZH1gOwogICAgICBtYXNrLnNldEF0dHJpYnV0ZSgiaWQiLCBtYXNrSWQpOwogICAgICBtYXNrLnNldEF0dHJpYnV0ZSgibWFza1VuaXRzIiwgIm9iamVjdEJvdW5kaW5nQm94Iik7CiAgICAgIGNvbnN0IHJlY3QgPSBEcmF3TGF5ZXIuX3N2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgicmVjdCIpOwogICAgICBtYXNrLmFwcGVuZChyZWN0KTsKICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoIndpZHRoIiwgIjEiKTsKICAgICAgcmVjdC5zZXRBdHRyaWJ1dGUoImhlaWdodCIsICIxIik7CiAgICAgIHJlY3Quc2V0QXR0cmlidXRlKCJmaWxsIiwgIndoaXRlIik7CiAgICAgIGNvbnN0IHVzZSA9IERyYXdMYXllci5fc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJ1c2UiKTsKICAgICAgbWFzay5hcHBlbmQodXNlKTsKICAgICAgdXNlLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGAjJHtwYXRoSWR9YCk7CiAgICAgIHVzZS5zZXRBdHRyaWJ1dGUoInN0cm9rZSIsICJub25lIik7CiAgICAgIHVzZS5zZXRBdHRyaWJ1dGUoImZpbGwiLCAiYmxhY2siKTsKICAgICAgdXNlLnNldEF0dHJpYnV0ZSgiZmlsbC1ydWxlIiwgIm5vbnplcm8iKTsKICAgICAgdXNlLmNsYXNzTGlzdC5hZGQoIm1hc2siKTsKICAgIH0KICAgIGNvbnN0IHVzZTEgPSBEcmF3TGF5ZXIuX3N2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgidXNlIik7CiAgICByb290LmFwcGVuZCh1c2UxKTsKICAgIHVzZTEuc2V0QXR0cmlidXRlKCJocmVmIiwgYCMke3BhdGhJZH1gKTsKICAgIGlmIChtYXNrSWQpIHsKICAgICAgdXNlMS5zZXRBdHRyaWJ1dGUoIm1hc2siLCBgdXJsKCMke21hc2tJZH0pYCk7CiAgICB9CiAgICBjb25zdCB1c2UyID0gdXNlMS5jbG9uZU5vZGUoKTsKICAgIHJvb3QuYXBwZW5kKHVzZTIpOwogICAgdXNlMS5jbGFzc0xpc3QuYWRkKCJtYWluT3V0bGluZSIpOwogICAgdXNlMi5jbGFzc0xpc3QuYWRkKCJzZWNvbmRhcnlPdXRsaW5lIik7CiAgICB0aGlzLnVwZGF0ZVByb3BlcnRpZXMocm9vdCwgcHJvcGVydGllcyk7CiAgICB0aGlzLiNtYXBwaW5nLnNldChpZCwgcm9vdCk7CiAgICByZXR1cm4gaWQ7CiAgfQogIGZpbmFsaXplRHJhdyhpZCwgcHJvcGVydGllcykgewogICAgdGhpcy4jdG9VcGRhdGUuZGVsZXRlKGlkKTsKICAgIHRoaXMudXBkYXRlUHJvcGVydGllcyhpZCwgcHJvcGVydGllcyk7CiAgfQogIHVwZGF0ZVByb3BlcnRpZXMoZWxlbWVudE9ySWQsIHByb3BlcnRpZXMpIHsKICAgIGlmICghcHJvcGVydGllcykgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHJvb3QsCiAgICAgIGJib3gsCiAgICAgIHJvb3RDbGFzcywKICAgICAgcGF0aAogICAgfSA9IHByb3BlcnRpZXM7CiAgICBjb25zdCBlbGVtZW50ID0gdHlwZW9mIGVsZW1lbnRPcklkID09PSAibnVtYmVyIiA/IHRoaXMuI21hcHBpbmcuZ2V0KGVsZW1lbnRPcklkKSA6IGVsZW1lbnRPcklkOwogICAgaWYgKCFlbGVtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChyb290KSB7CiAgICAgIHRoaXMuI3VwZGF0ZVByb3BlcnRpZXMoZWxlbWVudCwgcm9vdCk7CiAgICB9CiAgICBpZiAoYmJveCkgewogICAgICBEcmF3TGF5ZXIuI3NldEJveChlbGVtZW50LCBiYm94KTsKICAgIH0KICAgIGlmIChyb290Q2xhc3MpIHsKICAgICAgY29uc3QgewogICAgICAgIGNsYXNzTGlzdAogICAgICB9ID0gZWxlbWVudDsKICAgICAgZm9yIChjb25zdCBbY2xhc3NOYW1lLCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocm9vdENsYXNzKSkgewogICAgICAgIGNsYXNzTGlzdC50b2dnbGUoY2xhc3NOYW1lLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChwYXRoKSB7CiAgICAgIGNvbnN0IGRlZnMgPSBlbGVtZW50LmZpcnN0Q2hpbGQ7CiAgICAgIGNvbnN0IHBhdGhFbGVtZW50ID0gZGVmcy5maXJzdENoaWxkOwogICAgICB0aGlzLiN1cGRhdGVQcm9wZXJ0aWVzKHBhdGhFbGVtZW50LCBwYXRoKTsKICAgIH0KICB9CiAgdXBkYXRlUGFyZW50KGlkLCBsYXllcikgewogICAgaWYgKGxheWVyID09PSB0aGlzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHJvb3QgPSB0aGlzLiNtYXBwaW5nLmdldChpZCk7CiAgICBpZiAoIXJvb3QpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGF5ZXIuI3BhcmVudC5hcHBlbmQocm9vdCk7CiAgICB0aGlzLiNtYXBwaW5nLmRlbGV0ZShpZCk7CiAgICBsYXllci4jbWFwcGluZy5zZXQoaWQsIHJvb3QpOwogIH0KICByZW1vdmUoaWQpIHsKICAgIHRoaXMuI3RvVXBkYXRlLmRlbGV0ZShpZCk7CiAgICBpZiAodGhpcy4jcGFyZW50ID09PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI21hcHBpbmcuZ2V0KGlkKS5yZW1vdmUoKTsKICAgIHRoaXMuI21hcHBpbmcuZGVsZXRlKGlkKTsKICB9CiAgZGVzdHJveSgpIHsKICAgIHRoaXMuI3BhcmVudCA9IG51bGw7CiAgICBmb3IgKGNvbnN0IHJvb3Qgb2YgdGhpcy4jbWFwcGluZy52YWx1ZXMoKSkgewogICAgICByb290LnJlbW92ZSgpOwogICAgfQogICAgdGhpcy4jbWFwcGluZy5jbGVhcigpOwogICAgdGhpcy4jdG9VcGRhdGUuY2xlYXIoKTsKICB9Cn0KCjsvLyAuL3NyYy9wZGYuanMKCgoKCgoKCgoKCgoKCgoKCnsKICBnbG9iYWxUaGlzLl9wZGZqc1Rlc3RpbmdVdGlscyA9IHsKICAgIEhpZ2hsaWdodE91dGxpbmVyOiBIaWdobGlnaHRPdXRsaW5lcgogIH07Cn0KZ2xvYmFsVGhpcy5wZGZqc0xpYiA9IHsKICBBYm9ydEV4Y2VwdGlvbjogQWJvcnRFeGNlcHRpb24sCiAgQW5ub3RhdGlvbkVkaXRvckxheWVyOiBBbm5vdGF0aW9uRWRpdG9yTGF5ZXIsCiAgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGU6IEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLAogIEFubm90YXRpb25FZGl0b3JUeXBlOiBBbm5vdGF0aW9uRWRpdG9yVHlwZSwKICBBbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyOiBBbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyLAogIEFubm90YXRpb25MYXllcjogQW5ub3RhdGlvbkxheWVyLAogIEFubm90YXRpb25Nb2RlOiBBbm5vdGF0aW9uTW9kZSwKICBBbm5vdGF0aW9uVHlwZTogQW5ub3RhdGlvblR5cGUsCiAgYnVpbGQ6IGJ1aWxkLAogIENvbG9yUGlja2VyOiBDb2xvclBpY2tlciwKICBjcmVhdGVWYWxpZEFic29sdXRlVXJsOiBjcmVhdGVWYWxpZEFic29sdXRlVXJsLAogIERPTVNWR0ZhY3Rvcnk6IERPTVNWR0ZhY3RvcnksCiAgRHJhd0xheWVyOiBEcmF3TGF5ZXIsCiAgRmVhdHVyZVRlc3Q6IHV0aWxfRmVhdHVyZVRlc3QsCiAgZmV0Y2hEYXRhOiBmZXRjaERhdGEsCiAgZ2V0RG9jdW1lbnQ6IGdldERvY3VtZW50LAogIGdldEZpbGVuYW1lRnJvbVVybDogZ2V0RmlsZW5hbWVGcm9tVXJsLAogIGdldFBkZkZpbGVuYW1lRnJvbVVybDogZ2V0UGRmRmlsZW5hbWVGcm9tVXJsLAogIGdldFV1aWQ6IGdldFV1aWQsCiAgZ2V0WGZhUGFnZVZpZXdwb3J0OiBnZXRYZmFQYWdlVmlld3BvcnQsCiAgR2xvYmFsV29ya2VyT3B0aW9uczogR2xvYmFsV29ya2VyT3B0aW9ucywKICBJbWFnZUtpbmQ6IHV0aWxfSW1hZ2VLaW5kLAogIEludmFsaWRQREZFeGNlcHRpb246IEludmFsaWRQREZFeGNlcHRpb24sCiAgaXNEYXRhU2NoZW1lOiBpc0RhdGFTY2hlbWUsCiAgaXNQZGZGaWxlOiBpc1BkZkZpbGUsCiAgaXNWYWxpZEV4cGxpY2l0RGVzdDogaXNWYWxpZEV4cGxpY2l0RGVzdCwKICBNYXRoQ2xhbXA6IE1hdGhDbGFtcCwKICBub0NvbnRleHRNZW51OiBub0NvbnRleHRNZW51LAogIG5vcm1hbGl6ZVVuaWNvZGU6IG5vcm1hbGl6ZVVuaWNvZGUsCiAgT1BTOiBPUFMsCiAgT3V0cHV0U2NhbGU6IE91dHB1dFNjYWxlLAogIFBhc3N3b3JkUmVzcG9uc2VzOiBQYXNzd29yZFJlc3BvbnNlcywKICBQREZEYXRhUmFuZ2VUcmFuc3BvcnQ6IFBERkRhdGFSYW5nZVRyYW5zcG9ydCwKICBQREZEYXRlU3RyaW5nOiBQREZEYXRlU3RyaW5nLAogIFBERldvcmtlcjogUERGV29ya2VyLAogIFBlcm1pc3Npb25GbGFnOiBQZXJtaXNzaW9uRmxhZywKICBQaXhlbHNQZXJJbmNoOiBQaXhlbHNQZXJJbmNoLAogIFJlbmRlcmluZ0NhbmNlbGxlZEV4Y2VwdGlvbjogUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uLAogIFJlc3BvbnNlRXhjZXB0aW9uOiBSZXNwb25zZUV4Y2VwdGlvbiwKICBzZXRMYXllckRpbWVuc2lvbnM6IHNldExheWVyRGltZW5zaW9ucywKICBzaGFkb3c6IHNoYWRvdywKICBTaWduYXR1cmVFeHRyYWN0b3I6IFNpZ25hdHVyZUV4dHJhY3RvciwKICBzdG9wRXZlbnQ6IHN0b3BFdmVudCwKICBTdXBwb3J0ZWRJbWFnZU1pbWVUeXBlczogU3VwcG9ydGVkSW1hZ2VNaW1lVHlwZXMsCiAgVGV4dExheWVyOiBUZXh0TGF5ZXIsCiAgVG91Y2hNYW5hZ2VyOiBUb3VjaE1hbmFnZXIsCiAgdXBkYXRlVXJsSGFzaDogdXBkYXRlVXJsSGFzaCwKICBVdGlsOiBVdGlsLAogIFZlcmJvc2l0eUxldmVsOiBWZXJib3NpdHlMZXZlbCwKICB2ZXJzaW9uOiB2ZXJzaW9uLAogIFhmYUxheWVyOiBYZmFMYXllcgp9OwoKZXhwb3J0IHsgQWJvcnRFeGNlcHRpb24sIEFubm90YXRpb25FZGl0b3JMYXllciwgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUsIEFubm90YXRpb25FZGl0b3JUeXBlLCBBbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyLCBBbm5vdGF0aW9uTGF5ZXIsIEFubm90YXRpb25Nb2RlLCBBbm5vdGF0aW9uVHlwZSwgQ29sb3JQaWNrZXIsIERPTVNWR0ZhY3RvcnksIERyYXdMYXllciwgdXRpbF9GZWF0dXJlVGVzdCBhcyBGZWF0dXJlVGVzdCwgR2xvYmFsV29ya2VyT3B0aW9ucywgdXRpbF9JbWFnZUtpbmQgYXMgSW1hZ2VLaW5kLCBJbnZhbGlkUERGRXhjZXB0aW9uLCBNYXRoQ2xhbXAsIE9QUywgT3V0cHV0U2NhbGUsIFBERkRhdGFSYW5nZVRyYW5zcG9ydCwgUERGRGF0ZVN0cmluZywgUERGV29ya2VyLCBQYXNzd29yZFJlc3BvbnNlcywgUGVybWlzc2lvbkZsYWcsIFBpeGVsc1BlckluY2gsIFJlbmRlcmluZ0NhbmNlbGxlZEV4Y2VwdGlvbiwgUmVzcG9uc2VFeGNlcHRpb24sIFNpZ25hdHVyZUV4dHJhY3RvciwgU3VwcG9ydGVkSW1hZ2VNaW1lVHlwZXMsIFRleHRMYXllciwgVG91Y2hNYW5hZ2VyLCBVdGlsLCBWZXJib3NpdHlMZXZlbCwgWGZhTGF5ZXIsIGJ1aWxkLCBjcmVhdGVWYWxpZEFic29sdXRlVXJsLCBmZXRjaERhdGEsIGdldERvY3VtZW50LCBnZXRGaWxlbmFtZUZyb21VcmwsIGdldFBkZkZpbGVuYW1lRnJvbVVybCwgZ2V0VXVpZCwgZ2V0WGZhUGFnZVZpZXdwb3J0LCBpc0RhdGFTY2hlbWUsIGlzUGRmRmlsZSwgaXNWYWxpZEV4cGxpY2l0RGVzdCwgbm9Db250ZXh0TWVudSwgbm9ybWFsaXplVW5pY29kZSwgc2V0TGF5ZXJEaW1lbnNpb25zLCBzaGFkb3csIHN0b3BFdmVudCwgdXBkYXRlVXJsSGFzaCwgdmVyc2lvbiB9OwoKLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGRmLm1qcy5tYXA=" type="module"></script>

    <link rel="stylesheet" href="data:text/css;base64,LyogQ29weXJpZ2h0IDIwMTQgTW96aWxsYSBGb3VuZGF0aW9uCiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwoKLm1lc3NhZ2VCYXJ7CiAgLS1jbG9zaW5nLWJ1dHRvbi1pY29uOnVybChpbWFnZXMvbWVzc2FnZUJhcl9jbG9zaW5nQnV0dG9uLnN2Zyk7CiAgLS1tZXNzYWdlLWJhci1jbG9zZS1idXR0b24tY29sb3I6dmFyKC0tdGV4dC1wcmltYXJ5LWNvbG9yKTsKICAtLW1lc3NhZ2UtYmFyLWNsb3NlLWJ1dHRvbi1jb2xvci1ob3Zlcjp2YXIoLS10ZXh0LXByaW1hcnktY29sb3IpOwogIC0tbWVzc2FnZS1iYXItY2xvc2UtYnV0dG9uLWJvcmRlci1yYWRpdXM6NHB4OwogIC0tbWVzc2FnZS1iYXItY2xvc2UtYnV0dG9uLWJvcmRlcjpub25lOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTMxOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTEgMjUxIDI1NCAvIDAuMTQpOwogIC0tbWVzc2FnZS1iYXItY2xvc2UtYnV0dG9uLWhvdmVyLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zMSwgcmdiKDIxIDIwIDI2IC8gMC4xNCkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTMyOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTEgMjUxIDI1NCAvIDAuMjEpOwogIC0tbWVzc2FnZS1iYXItY2xvc2UtYnV0dG9uLWFjdGl2ZS1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzIsIHJnYigyMSAyMCAyNiAvIDAuMjEpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zMzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjUxIDI1MSAyNTQgLyAwLjA3KTsKICAtLW1lc3NhZ2UtYmFyLWNsb3NlLWJ1dHRvbi1mb2N1cy1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzMsIHJnYigyMSAyMCAyNiAvIDAuMDcpKTsKfQoKQHN1cHBvcnRzIChjb2xvcjogbGlnaHQtZGFyayhyZWQsIHJlZCkpIGFuZCAoY29sb3I6IHJnYigwIDAgMCAvIDApKXsKLm1lc3NhZ2VCYXJ7CiAgLS1tZXNzYWdlLWJhci1jbG9zZS1idXR0b24taG92ZXItYmctY29sb3I6bGlnaHQtZGFyaygKICAgIHJnYigyMSAyMCAyNiAvIDAuMTQpLAogICAgcmdiKDI1MSAyNTEgMjU0IC8gMC4xNCkKICApOwogIC0tbWVzc2FnZS1iYXItY2xvc2UtYnV0dG9uLWFjdGl2ZS1iZy1jb2xvcjpsaWdodC1kYXJrKAogICAgcmdiKDIxIDIwIDI2IC8gMC4yMSksCiAgICByZ2IoMjUxIDI1MSAyNTQgLyAwLjIxKQogICk7CiAgLS1tZXNzYWdlLWJhci1jbG9zZS1idXR0b24tZm9jdXMtYmctY29sb3I6bGlnaHQtZGFyaygKICAgIHJnYigyMSAyMCAyNiAvIDAuMDcpLAogICAgcmdiKDI1MSAyNTEgMjU0IC8gMC4wNykKICApOwp9Cn0KCkBzdXBwb3J0cyBub3QgKGNvbG9yOiBsaWdodC1kYXJrKHRhbiwgdGFuKSl7CgoubWVzc2FnZUJhciAqewogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTMxOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTEgMjUxIDI1NCAvIDAuMTQpOwogIC0tbWVzc2FnZS1iYXItY2xvc2UtYnV0dG9uLWhvdmVyLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zMSwgcmdiKDIxIDIwIDI2IC8gMC4xNCkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTMyOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTEgMjUxIDI1NCAvIDAuMjEpOwogIC0tbWVzc2FnZS1iYXItY2xvc2UtYnV0dG9uLWFjdGl2ZS1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzIsIHJnYigyMSAyMCAyNiAvIDAuMjEpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zMzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjUxIDI1MSAyNTQgLyAwLjA3KTsKICAtLW1lc3NhZ2UtYmFyLWNsb3NlLWJ1dHRvbi1mb2N1cy1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzMsIHJnYigyMSAyMCAyNiAvIDAuMDcpKTsKICB9Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKLm1lc3NhZ2VCYXJ7CiAgICAtLW1lc3NhZ2UtYmFyLWNsb3NlLWJ1dHRvbi1jb2xvcjpCdXR0b25UZXh0OwogICAgLS1tZXNzYWdlLWJhci1jbG9zZS1idXR0b24tYm9yZGVyOjFweCBzb2xpZCBCdXR0b25UZXh0OwogICAgLS1tZXNzYWdlLWJhci1jbG9zZS1idXR0b24taG92ZXItYmctY29sb3I6QnV0dG9uVGV4dDsKICAgIC0tbWVzc2FnZS1iYXItY2xvc2UtYnV0dG9uLWFjdGl2ZS1iZy1jb2xvcjpCdXR0b25UZXh0OwogICAgLS1tZXNzYWdlLWJhci1jbG9zZS1idXR0b24tZm9jdXMtYmctY29sb3I6QnV0dG9uVGV4dDsKICAgIC0tbWVzc2FnZS1iYXItY2xvc2UtYnV0dG9uLWNvbG9yLWhvdmVyOkhpZ2hsaWdodFRleHQ7Cn0KICB9CgoubWVzc2FnZUJhcnsKCiAgZGlzcGxheTpmbGV4OwogIHBvc2l0aW9uOnJlbGF0aXZlOwogIHBhZGRpbmc6OHB4IDhweCA4cHggMTZweDsKICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgZ2FwOjhweDsKICAtd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgLW1vei11c2VyLXNlbGVjdDpub25lOwogICAgICAgICAgdXNlci1zZWxlY3Q6bm9uZTsKCiAgYm9yZGVyLXJhZGl1czo0cHg7CgogIGJvcmRlcjoxcHggc29saWQgdmFyKC0tbWVzc2FnZS1iYXItYm9yZGVyLWNvbG9yKTsKICBiYWNrZ3JvdW5kOnZhcigtLW1lc3NhZ2UtYmFyLWJnLWNvbG9yKTsKICBjb2xvcjp2YXIoLS1tZXNzYWdlLWJhci1mZy1jb2xvcik7Cn0KCi5tZXNzYWdlQmFyICA+IGRpdnsKICAgIGRpc3BsYXk6ZmxleDsKICAgIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7CiAgICBnYXA6OHB4OwogICAgYWxpZ24tc2VsZjpzdHJldGNoOwogIH0KCjppcygubWVzc2FnZUJhciA+IGRpdik6OmJlZm9yZXsKICAgICAgY29udGVudDoiIjsKICAgICAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgICAgIHdpZHRoOjE2cHg7CiAgICAgIGhlaWdodDoxNnB4OwogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tbWVzc2FnZS1iYXItaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1tZXNzYWdlLWJhci1pY29uKTsKICAgICAgLXdlYmtpdC1tYXNrLXNpemU6Y292ZXI7CiAgICAgICAgICAgICAgbWFzay1zaXplOmNvdmVyOwogICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLW1lc3NhZ2UtYmFyLWljb24tY29sb3IpOwogICAgICBmbGV4LXNocmluazowOwogICAgfQoKLm1lc3NhZ2VCYXIgYnV0dG9uewogICAgY3Vyc29yOnBvaW50ZXI7CiAgfQoKOmlzKC5tZXNzYWdlQmFyIGJ1dHRvbik6Zm9jdXMtdmlzaWJsZXsKICAgICAgb3V0bGluZTp2YXIoLS1mb2N1cy1yaW5nLW91dGxpbmUpOwogICAgICBvdXRsaW5lLW9mZnNldDoycHg7CiAgICB9CgoubWVzc2FnZUJhciAuY2xvc2VCdXR0b257CiAgICB3aWR0aDozMnB4OwogICAgaGVpZ2h0OjMycHg7CiAgICBiYWNrZ3JvdW5kOm5vbmU7CiAgICBib3JkZXItcmFkaXVzOnZhcigtLW1lc3NhZ2UtYmFyLWNsb3NlLWJ1dHRvbi1ib3JkZXItcmFkaXVzKTsKICAgIGJvcmRlcjp2YXIoLS1tZXNzYWdlLWJhci1jbG9zZS1idXR0b24tYm9yZGVyKTsKCiAgICBkaXNwbGF5OmZsZXg7CiAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogIH0KCjppcygubWVzc2FnZUJhciAuY2xvc2VCdXR0b24pOjpiZWZvcmV7CiAgICAgIGNvbnRlbnQ6IiI7CiAgICAgIGRpc3BsYXk6aW5saW5lLWJsb2NrOwogICAgICB3aWR0aDoxNnB4OwogICAgICBoZWlnaHQ6MTZweDsKICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLWNsb3NpbmctYnV0dG9uLWljb24pOwogICAgICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tY2xvc2luZy1idXR0b24taWNvbik7CiAgICAgIC13ZWJraXQtbWFzay1zaXplOmNvdmVyOwogICAgICAgICAgICAgIG1hc2stc2l6ZTpjb3ZlcjsKICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1tZXNzYWdlLWJhci1jbG9zZS1idXR0b24tY29sb3IpOwogICAgfQoKOmlzKC5tZXNzYWdlQmFyIC5jbG9zZUJ1dHRvbik6aXMoOmhvdmVyLDphY3RpdmUsOmZvY3VzKTo6YmVmb3JlewogICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLW1lc3NhZ2UtYmFyLWNsb3NlLWJ1dHRvbi1jb2xvci1ob3Zlcik7CiAgICB9Cgo6aXMoLm1lc3NhZ2VCYXIgLmNsb3NlQnV0dG9uKTpob3ZlcnsKICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1tZXNzYWdlLWJhci1jbG9zZS1idXR0b24taG92ZXItYmctY29sb3IpOwogICAgfQoKOmlzKC5tZXNzYWdlQmFyIC5jbG9zZUJ1dHRvbik6YWN0aXZlewogICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLW1lc3NhZ2UtYmFyLWNsb3NlLWJ1dHRvbi1hY3RpdmUtYmctY29sb3IpOwogICAgfQoKOmlzKC5tZXNzYWdlQmFyIC5jbG9zZUJ1dHRvbik6Zm9jdXN7CiAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tbWVzc2FnZS1iYXItY2xvc2UtYnV0dG9uLWZvY3VzLWJnLWNvbG9yKTsKICAgIH0KCjppcygubWVzc2FnZUJhciAuY2xvc2VCdXR0b24pICA+IHNwYW57CiAgICAgIGRpc3BsYXk6aW5saW5lLWJsb2NrOwogICAgICB3aWR0aDowOwogICAgICBoZWlnaHQ6MDsKICAgICAgb3ZlcmZsb3c6aGlkZGVuOwogICAgfQoKI2VkaXRvclVuZG9CYXJ7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzQ6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2ZiZmJmZTsKICAtLXRleHQtcHJpbWFyeS1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzQsICMxNTE0MWEpOwoKICAtLW1lc3NhZ2UtYmFyLWljb246dXJsKGltYWdlcy9tZXNzYWdlQmFyX2luZm8uc3ZnKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zNTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNzNhN2YzOwogIC0tbWVzc2FnZS1iYXItaWNvbi1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzUsICMwMDYwZGYpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTM2OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICMwMDMwNzA7CiAgLS1tZXNzYWdlLWJhci1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzYsICNkZWVhZmMpOwogIC0tbWVzc2FnZS1iYXItZmctY29sb3I6dmFyKC0tdGV4dC1wcmltYXJ5LWNvbG9yKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zNzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjA4KTsKICAtLW1lc3NhZ2UtYmFyLWJvcmRlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzcsIHJnYigwIDAgMCAvIDAuMDgpKTsKCiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1NSAyNTUgMjU1IC8gMC4wOCk7CgogIC0tdW5kby1idXR0b24tYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTM4LCByZ2IoMjEgMjAgMjYgLyAwLjA3KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzk6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1NSAyNTUgMjU1IC8gMC4xNCk7CiAgLS11bmRvLWJ1dHRvbi1iZy1jb2xvci1ob3Zlcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzksIHJnYigyMSAyMCAyNiAvIDAuMTQpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00MDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjIxKTsKICAtLXVuZG8tYnV0dG9uLWJnLWNvbG9yLWFjdGl2ZTp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDAsIHJnYigyMSAyMCAyNiAvIDAuMjEpKTsKCiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDE6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzBkZjsKCiAgLS11bmRvLWJ1dHRvbi1ib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00MSwgIzAwNjBkZik7CgogIC0tdW5kby1idXR0b24tZmctY29sb3I6dmFyKC0tbWVzc2FnZS1iYXItZmctY29sb3IpOwogIC0tdW5kby1idXR0b24tZmctY29sb3ItaG92ZXI6dmFyKC0tdW5kby1idXR0b24tZmctY29sb3IpOwogIC0tdW5kby1idXR0b24tZmctY29sb3ItYWN0aXZlOnZhcigtLXVuZG8tYnV0dG9uLWZnLWNvbG9yKTsKfQoKQHN1cHBvcnRzIChjb2xvcjogbGlnaHQtZGFyayhyZWQsIHJlZCkpewojZWRpdG9yVW5kb0JhcnsKICAtLXRleHQtcHJpbWFyeS1jb2xvcjpsaWdodC1kYXJrKCMxNTE0MWEsICNmYmZiZmUpOwogIC0tbWVzc2FnZS1iYXItaWNvbi1jb2xvcjpsaWdodC1kYXJrKCMwMDYwZGYsICM3M2E3ZjMpOwogIC0tbWVzc2FnZS1iYXItYmctY29sb3I6bGlnaHQtZGFyaygjZGVlYWZjLCAjMDAzMDcwKTsKfQp9CgpAc3VwcG9ydHMgKGNvbG9yOiBsaWdodC1kYXJrKHJlZCwgcmVkKSkgYW5kIChjb2xvcjogcmdiKDAgMCAwIC8gMCkpewojZWRpdG9yVW5kb0JhcnsKICAtLW1lc3NhZ2UtYmFyLWJvcmRlci1jb2xvcjpsaWdodC1kYXJrKAogICAgcmdiKDAgMCAwIC8gMC4wOCksCiAgICByZ2IoMjU1IDI1NSAyNTUgLyAwLjA4KQogICk7CgogIC0tdW5kby1idXR0b24tYmctY29sb3I6bGlnaHQtZGFyaygKICAgIHJnYigyMSAyMCAyNiAvIDAuMDcpLAogICAgcmdiKDI1NSAyNTUgMjU1IC8gMC4wOCkKICApOwogIC0tdW5kby1idXR0b24tYmctY29sb3ItaG92ZXI6bGlnaHQtZGFyaygKICAgIHJnYigyMSAyMCAyNiAvIDAuMTQpLAogICAgcmdiKDI1NSAyNTUgMjU1IC8gMC4xNCkKICApOwogIC0tdW5kby1idXR0b24tYmctY29sb3ItYWN0aXZlOmxpZ2h0LWRhcmsoCiAgICByZ2IoMjEgMjAgMjYgLyAwLjIxKSwKICAgIHJnYigyNTUgMjU1IDI1NSAvIDAuMjEpCiAgKTsKfQp9CgpAc3VwcG9ydHMgKGNvbG9yOiBsaWdodC1kYXJrKHJlZCwgcmVkKSl7CiNlZGl0b3JVbmRvQmFyewoKICAtLXVuZG8tYnV0dG9uLWJvcmRlcjoxcHggc29saWQgbGlnaHQtZGFyaygjMDA2MGRmLCAjMGRmKTsKfQp9CgpAc3VwcG9ydHMgbm90IChjb2xvcjogbGlnaHQtZGFyayh0YW4sIHRhbikpewoKI2VkaXRvclVuZG9CYXIgKnsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zNDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjZmJmYmZlOwogIC0tdGV4dC1wcmltYXJ5LWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zNCwgIzE1MTQxYSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzU6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzczYTdmMzsKICAtLW1lc3NhZ2UtYmFyLWljb24tY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTM1LCAjMDA2MGRmKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zNjp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMDAzMDcwOwogIC0tbWVzc2FnZS1iYXItYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTM2LCAjZGVlYWZjKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zNzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjA4KTsKICAtLW1lc3NhZ2UtYmFyLWJvcmRlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzcsIHJnYigwIDAgMCAvIDAuMDgpKTsKCiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1NSAyNTUgMjU1IC8gMC4wOCk7CgogIC0tdW5kby1idXR0b24tYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTM4LCByZ2IoMjEgMjAgMjYgLyAwLjA3KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzk6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1NSAyNTUgMjU1IC8gMC4xNCk7CiAgLS11bmRvLWJ1dHRvbi1iZy1jb2xvci1ob3Zlcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzksIHJnYigyMSAyMCAyNiAvIDAuMTQpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00MDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjIxKTsKICAtLXVuZG8tYnV0dG9uLWJnLWNvbG9yLWFjdGl2ZTp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDAsIHJnYigyMSAyMCAyNiAvIDAuMjEpKTsKCiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDE6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzBkZjsKCiAgLS11bmRvLWJ1dHRvbi1ib3JkZXI6MXB4IHNvbGlkIHZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00MSwgIzAwNjBkZik7CiAgfQp9CgpAbWVkaWEgc2NyZWVuIGFuZCAoZm9yY2VkLWNvbG9yczogYWN0aXZlKXsKCiNlZGl0b3JVbmRvQmFyewogICAgLS10ZXh0LXByaW1hcnktY29sb3I6Q2FudmFzVGV4dDsKCiAgICAtLW1lc3NhZ2UtYmFyLWljb24tY29sb3I6Q2FudmFzVGV4dDsKICAgIC0tbWVzc2FnZS1iYXItYmctY29sb3I6Q2FudmFzOwogICAgLS1tZXNzYWdlLWJhci1ib3JkZXItY29sb3I6Q2FudmFzVGV4dDsKCiAgICAtLXVuZG8tYnV0dG9uLWJnLWNvbG9yOkJ1dHRvblRleHQ7CiAgICAtLXVuZG8tYnV0dG9uLWJnLWNvbG9yLWhvdmVyOlNlbGVjdGVkSXRlbTsKICAgIC0tdW5kby1idXR0b24tYmctY29sb3ItYWN0aXZlOlNlbGVjdGVkSXRlbTsKCiAgICAtLXVuZG8tYnV0dG9uLWZnLWNvbG9yOkJ1dHRvbkZhY2U7CiAgICAtLXVuZG8tYnV0dG9uLWZnLWNvbG9yLWhvdmVyOlNlbGVjdGVkSXRlbVRleHQ7CiAgICAtLXVuZG8tYnV0dG9uLWZnLWNvbG9yLWFjdGl2ZTpTZWxlY3RlZEl0ZW1UZXh0OwoKICAgIC0tdW5kby1idXR0b24tYm9yZGVyOm5vbmU7Cn0KICB9CgojZWRpdG9yVW5kb0JhcnsKCiAgcG9zaXRpb246Zml4ZWQ7CiAgdG9wOjUwcHg7CiAgbGVmdDo1MCU7CiAgdHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7CiAgei1pbmRleDoxMDsKCiAgcGFkZGluZy1ibG9jazo4cHg7CiAgcGFkZGluZy1pbmxpbmU6MTZweCA4cHg7CgogIGZvbnQ6bWVudTsKICBmb250LXNpemU6MTVweDsKCiAgY3Vyc29yOmRlZmF1bHQ7Cn0KCiNlZGl0b3JVbmRvQmFyIGJ1dHRvbnsKICAgIGN1cnNvcjpwb2ludGVyOwogIH0KCiNlZGl0b3JVbmRvQmFyICNlZGl0b3JVbmRvQmFyVW5kb0J1dHRvbnsKICAgIGJvcmRlci1yYWRpdXM6NHB4OwogICAgZm9udC13ZWlnaHQ6NTkwOwogICAgbGluZS1oZWlnaHQ6MTkuNXB4OwogICAgY29sb3I6dmFyKC0tdW5kby1idXR0b24tZmctY29sb3IpOwogICAgYm9yZGVyOnZhcigtLXVuZG8tYnV0dG9uLWJvcmRlcik7CiAgICBwYWRkaW5nOjRweCAxNnB4OwogICAgbWFyZ2luLWlubGluZS1zdGFydDo4cHg7CiAgICBoZWlnaHQ6MzJweDsKCiAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXVuZG8tYnV0dG9uLWJnLWNvbG9yKTsKICB9Cgo6aXMoI2VkaXRvclVuZG9CYXIgI2VkaXRvclVuZG9CYXJVbmRvQnV0dG9uKTpob3ZlcnsKICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS11bmRvLWJ1dHRvbi1iZy1jb2xvci1ob3Zlcik7CiAgICAgIGNvbG9yOnZhcigtLXVuZG8tYnV0dG9uLWZnLWNvbG9yLWhvdmVyKTsKICAgIH0KCjppcygjZWRpdG9yVW5kb0JhciAjZWRpdG9yVW5kb0JhclVuZG9CdXR0b24pOmFjdGl2ZXsKICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS11bmRvLWJ1dHRvbi1iZy1jb2xvci1hY3RpdmUpOwogICAgICBjb2xvcjp2YXIoLS11bmRvLWJ1dHRvbi1mZy1jb2xvci1hY3RpdmUpOwogICAgfQoKI2VkaXRvclVuZG9CYXIgID4gZGl2ewogICAgYWxpZ24taXRlbXM6Y2VudGVyOwogIH0KCi5kaWFsb2d7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDI6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzFjMWIyMjsKICAtLWRpYWxvZy1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDIsIHdoaXRlKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00Mzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMWMxYjIyOwogIC0tZGlhbG9nLWJvcmRlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDMsIHdoaXRlKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00NDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMTUxNDFhOwogIC0tZGlhbG9nLXNoYWRvdzowIDJweCAxNHB4IDAgdmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTQ0LCByZ2IoNTggNTcgNjggLyAwLjIpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00NTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjZmJmYmZlOwogIC0tdGV4dC1wcmltYXJ5LWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00NSwgIzE1MTQxYSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDY6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2NmY2ZkODsKICAtLXRleHQtc2Vjb25kYXJ5LWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00NiwgIzViNWI2Nik7CiAgLS1ob3Zlci1maWx0ZXI6YnJpZ2h0bmVzcygwLjkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTQ3OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICMwZGY7CiAgLS1saW5rLWZnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00NywgIzAwNjBkZik7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzgwZWJmZjsKICAtLWxpbmstaG92ZXItZmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTQ4LCAjMDI1MGJiKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00OTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNTI1MjVlOwogIC0tc2VwYXJhdG9yLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00OSwgI2YwZjBmNCk7CgogIC0tdGV4dGFyZWEtYm9yZGVyLWNvbG9yOiM4ZjhmOWQ7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTA6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzQyNDE0ZDsKICAtLXRleHRhcmVhLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01MCwgd2hpdGUpOwogIC0tdGV4dGFyZWEtZmctY29sb3I6dmFyKC0tdGV4dC1zZWNvbmRhcnktY29sb3IpOwoKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01MTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMmIyYTMzOwoKICAtLXJhZGlvLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01MSwgI2YwZjBmNCk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTI6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzE1MTQxYTsKICAtLXJhZGlvLWNoZWNrZWQtYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTUyLCAjZmJmYmZlKTsKICAtLXJhZGlvLWJvcmRlci1jb2xvcjojOGY4ZjlkOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTUzOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICMwZGY7CiAgLS1yYWRpby1jaGVja2VkLWJvcmRlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTMsICMwMDYwZGYpOwoKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01NDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjUxIDI1MSAyNTQgLyAwLjA3KTsKCiAgLS1idXR0b24tc2Vjb25kYXJ5LWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01NCwgcmdiKDIxIDIwIDI2IC8gMC4wNykpOwogIC0tYnV0dG9uLXNlY29uZGFyeS1mZy1jb2xvcjp2YXIoLS10ZXh0LXByaW1hcnktY29sb3IpOwogIC0tYnV0dG9uLXNlY29uZGFyeS1ib3JkZXItY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1iZy1jb2xvcik7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTU6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1MSAyNTEgMjU0IC8gMC4yMSk7CiAgLS1idXR0b24tc2Vjb25kYXJ5LWFjdGl2ZS1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTUsIHJnYigyMSAyMCAyNiAvIDAuMjEpKTsKICAtLWJ1dHRvbi1zZWNvbmRhcnktYWN0aXZlLWZnLWNvbG9yOnZhcigtLWJ1dHRvbi1zZWNvbmRhcnktZmctY29sb3IpOwogIC0tYnV0dG9uLXNlY29uZGFyeS1hY3RpdmUtYm9yZGVyLWNvbG9yOnZhcigtLWJ1dHRvbi1zZWNvbmRhcnktYmctY29sb3IpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTU2OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTEgMjUxIDI1NCAvIDAuMTQpOwogIC0tYnV0dG9uLXNlY29uZGFyeS1ob3Zlci1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTYsIHJnYigyMSAyMCAyNiAvIDAuMTQpKTsKICAtLWJ1dHRvbi1zZWNvbmRhcnktaG92ZXItZmctY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1mZy1jb2xvcik7CiAgLS1idXR0b24tc2Vjb25kYXJ5LWhvdmVyLWJvcmRlci1jb2xvcjp2YXIoLS1idXR0b24tc2Vjb25kYXJ5LWhvdmVyLWJnLWNvbG9yKTsKICAtLWJ1dHRvbi1zZWNvbmRhcnktZGlzYWJsZWQtYmctY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1iZy1jb2xvcik7CiAgLS1idXR0b24tc2Vjb25kYXJ5LWRpc2FibGVkLWJvcmRlci1jb2xvcjp2YXIoCiAgICAtLWJ1dHRvbi1zZWNvbmRhcnktYm9yZGVyLWNvbG9yCiAgKTsKICAtLWJ1dHRvbi1zZWNvbmRhcnktZGlzYWJsZWQtZmctY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1mZy1jb2xvcik7CgogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTU3OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICMwZGY7CgogIC0tYnV0dG9uLXByaW1hcnktYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTU3LCAjMDA2MGRmKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01ODp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMTUxNDFhOwogIC0tYnV0dG9uLXByaW1hcnktZmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTU4LCAjZmJmYmZlKTsKICAtLWJ1dHRvbi1wcmltYXJ5LWJvcmRlci1jb2xvcjp2YXIoLS1idXR0b24tcHJpbWFyeS1iZy1jb2xvcik7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTk6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2FhZjJmZjsKICAtLWJ1dHRvbi1wcmltYXJ5LWFjdGl2ZS1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTksICMwNTQwOTYpOwogIC0tYnV0dG9uLXByaW1hcnktYWN0aXZlLWZnLWNvbG9yOnZhcigtLWJ1dHRvbi1wcmltYXJ5LWZnLWNvbG9yKTsKICAtLWJ1dHRvbi1wcmltYXJ5LWFjdGl2ZS1ib3JkZXItY29sb3I6dmFyKC0tYnV0dG9uLXByaW1hcnktYWN0aXZlLWJnLWNvbG9yKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02MDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjODBlYmZmOwogIC0tYnV0dG9uLXByaW1hcnktaG92ZXItYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTYwLCAjMDI1MGJiKTsKICAtLWJ1dHRvbi1wcmltYXJ5LWhvdmVyLWZnLWNvbG9yOnZhcigtLWJ1dHRvbi1wcmltYXJ5LWZnLWNvbG9yKTsKICAtLWJ1dHRvbi1wcmltYXJ5LWhvdmVyLWJvcmRlci1jb2xvcjp2YXIoLS1idXR0b24tcHJpbWFyeS1ob3Zlci1iZy1jb2xvcik7CiAgLS1idXR0b24tcHJpbWFyeS1kaXNhYmxlZC1iZy1jb2xvcjp2YXIoLS1idXR0b24tcHJpbWFyeS1iZy1jb2xvcik7CiAgLS1idXR0b24tcHJpbWFyeS1kaXNhYmxlZC1ib3JkZXItY29sb3I6dmFyKC0tYnV0dG9uLXByaW1hcnktYm9yZGVyLWNvbG9yKTsKICAtLWJ1dHRvbi1wcmltYXJ5LWRpc2FibGVkLWZnLWNvbG9yOnZhcigtLWJ1dHRvbi1wcmltYXJ5LWZnLWNvbG9yKTsKICAtLWJ1dHRvbi1kaXNhYmxlZC1vcGFjaXR5OjAuNDsKCiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjE6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzQyNDE0ZDsKCiAgLS1pbnB1dC10ZXh0LWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02MSwgd2hpdGUpOwogIC0taW5wdXQtdGV4dC1mZy1jb2xvcjp2YXIoLS10ZXh0LXByaW1hcnktY29sb3IpOwp9CgpAc3VwcG9ydHMgKGNvbG9yOiBsaWdodC1kYXJrKHJlZCwgcmVkKSl7Ci5kaWFsb2d7CiAgLS1kaWFsb2ctYmctY29sb3I6bGlnaHQtZGFyayh3aGl0ZSwgIzFjMWIyMik7CiAgLS1kaWFsb2ctYm9yZGVyLWNvbG9yOmxpZ2h0LWRhcmsod2hpdGUsICMxYzFiMjIpOwp9Cn0KCkBzdXBwb3J0cyAoY29sb3I6IGxpZ2h0LWRhcmsocmVkLCByZWQpKSBhbmQgKGNvbG9yOiByZ2IoMCAwIDAgLyAwKSl7Ci5kaWFsb2d7CiAgLS1kaWFsb2ctc2hhZG93OjAgMnB4IDE0cHggMCBsaWdodC1kYXJrKHJnYig1OCA1NyA2OCAvIDAuMiksICMxNTE0MWEpOwp9Cn0KCkBzdXBwb3J0cyAoY29sb3I6IGxpZ2h0LWRhcmsocmVkLCByZWQpKXsKLmRpYWxvZ3sKICAtLXRleHQtcHJpbWFyeS1jb2xvcjpsaWdodC1kYXJrKCMxNTE0MWEsICNmYmZiZmUpOwogIC0tdGV4dC1zZWNvbmRhcnktY29sb3I6bGlnaHQtZGFyaygjNWI1YjY2LCAjY2ZjZmQ4KTsKICAtLWxpbmstZmctY29sb3I6bGlnaHQtZGFyaygjMDA2MGRmLCAjMGRmKTsKICAtLWxpbmstaG92ZXItZmctY29sb3I6bGlnaHQtZGFyaygjMDI1MGJiLCAjODBlYmZmKTsKICAtLXNlcGFyYXRvci1jb2xvcjpsaWdodC1kYXJrKCNmMGYwZjQsICM1MjUyNWUpOwogIC0tdGV4dGFyZWEtYmctY29sb3I6bGlnaHQtZGFyayh3aGl0ZSwgIzQyNDE0ZCk7CgogIC0tcmFkaW8tYmctY29sb3I6bGlnaHQtZGFyaygjZjBmMGY0LCAjMmIyYTMzKTsKICAtLXJhZGlvLWNoZWNrZWQtYmctY29sb3I6bGlnaHQtZGFyaygjZmJmYmZlLCAjMTUxNDFhKTsKICAtLXJhZGlvLWNoZWNrZWQtYm9yZGVyLWNvbG9yOmxpZ2h0LWRhcmsoIzAwNjBkZiwgIzBkZik7Cn0KfQoKQHN1cHBvcnRzIChjb2xvcjogbGlnaHQtZGFyayhyZWQsIHJlZCkpIGFuZCAoY29sb3I6IHJnYigwIDAgMCAvIDApKXsKLmRpYWxvZ3sKCiAgLS1idXR0b24tc2Vjb25kYXJ5LWJnLWNvbG9yOmxpZ2h0LWRhcmsoCiAgICByZ2IoMjEgMjAgMjYgLyAwLjA3KSwKICAgIHJnYigyNTEgMjUxIDI1NCAvIDAuMDcpCiAgKTsKICAtLWJ1dHRvbi1zZWNvbmRhcnktYWN0aXZlLWJnLWNvbG9yOmxpZ2h0LWRhcmsoCiAgICByZ2IoMjEgMjAgMjYgLyAwLjIxKSwKICAgIHJnYigyNTEgMjUxIDI1NCAvIDAuMjEpCiAgKTsKICAtLWJ1dHRvbi1zZWNvbmRhcnktaG92ZXItYmctY29sb3I6bGlnaHQtZGFyaygKICAgIHJnYigyMSAyMCAyNiAvIDAuMTQpLAogICAgcmdiKDI1MSAyNTEgMjU0IC8gMC4xNCkKICApOwp9Cn0KCkBzdXBwb3J0cyAoY29sb3I6IGxpZ2h0LWRhcmsocmVkLCByZWQpKXsKLmRpYWxvZ3sKCiAgLS1idXR0b24tcHJpbWFyeS1iZy1jb2xvcjpsaWdodC1kYXJrKCMwMDYwZGYsICMwZGYpOwogIC0tYnV0dG9uLXByaW1hcnktZmctY29sb3I6bGlnaHQtZGFyaygjZmJmYmZlLCAjMTUxNDFhKTsKICAtLWJ1dHRvbi1wcmltYXJ5LWFjdGl2ZS1iZy1jb2xvcjpsaWdodC1kYXJrKCMwNTQwOTYsICNhYWYyZmYpOwogIC0tYnV0dG9uLXByaW1hcnktaG92ZXItYmctY29sb3I6bGlnaHQtZGFyaygjMDI1MGJiLCAjODBlYmZmKTsKCiAgLS1pbnB1dC10ZXh0LWJnLWNvbG9yOmxpZ2h0LWRhcmsod2hpdGUsICM0MjQxNGQpOwp9Cn0KCkBzdXBwb3J0cyBub3QgKGNvbG9yOiBsaWdodC1kYXJrKHRhbiwgdGFuKSl7CgouZGlhbG9nICp7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDI6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzFjMWIyMjsKICAtLWRpYWxvZy1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDIsIHdoaXRlKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00Mzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMWMxYjIyOwogIC0tZGlhbG9nLWJvcmRlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDMsIHdoaXRlKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00NDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMTUxNDFhOwogIC0tZGlhbG9nLXNoYWRvdzowIDJweCAxNHB4IDAgdmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTQ0LCByZ2IoNTggNTcgNjggLyAwLjIpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00NTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjZmJmYmZlOwogIC0tdGV4dC1wcmltYXJ5LWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00NSwgIzE1MTQxYSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDY6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2NmY2ZkODsKICAtLXRleHQtc2Vjb25kYXJ5LWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00NiwgIzViNWI2Nik7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDc6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzBkZjsKICAtLWxpbmstZmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTQ3LCAjMDA2MGRmKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00ODp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjODBlYmZmOwogIC0tbGluay1ob3Zlci1mZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNDgsICMwMjUwYmIpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTQ5OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICM1MjUyNWU7CiAgLS1zZXBhcmF0b3ItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTQ5LCAjZjBmMGY0KTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01MDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNDI0MTRkOwogIC0tdGV4dGFyZWEtYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTUwLCB3aGl0ZSk7CgogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTUxOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICMyYjJhMzM7CgogIC0tcmFkaW8tYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTUxLCAjZjBmMGY0KTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01Mjp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMTUxNDFhOwogIC0tcmFkaW8tY2hlY2tlZC1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTIsICNmYmZiZmUpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTUzOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICMwZGY7CiAgLS1yYWRpby1jaGVja2VkLWJvcmRlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTMsICMwMDYwZGYpOwoKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01NDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjUxIDI1MSAyNTQgLyAwLjA3KTsKCiAgLS1idXR0b24tc2Vjb25kYXJ5LWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01NCwgcmdiKDIxIDIwIDI2IC8gMC4wNykpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTU1OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTEgMjUxIDI1NCAvIDAuMjEpOwogIC0tYnV0dG9uLXNlY29uZGFyeS1hY3RpdmUtYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTU1LCByZ2IoMjEgMjAgMjYgLyAwLjIxKSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTY6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1MSAyNTEgMjU0IC8gMC4xNCk7CiAgLS1idXR0b24tc2Vjb25kYXJ5LWhvdmVyLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01NiwgcmdiKDIxIDIwIDI2IC8gMC4xNCkpOwoKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01Nzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMGRmOwoKICAtLWJ1dHRvbi1wcmltYXJ5LWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01NywgIzAwNjBkZik7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzE1MTQxYTsKICAtLWJ1dHRvbi1wcmltYXJ5LWZnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01OCwgI2ZiZmJmZSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTk6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2FhZjJmZjsKICAtLWJ1dHRvbi1wcmltYXJ5LWFjdGl2ZS1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTksICMwNTQwOTYpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTYwOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICM4MGViZmY7CiAgLS1idXR0b24tcHJpbWFyeS1ob3Zlci1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjAsICMwMjUwYmIpOwoKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02MTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNDI0MTRkOwoKICAtLWlucHV0LXRleHQtYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTYxLCB3aGl0ZSk7CiAgfQp9CgpAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKXsKCi5kaWFsb2d7CiAgICAtLWhvdmVyLWZpbHRlcjpicmlnaHRuZXNzKDEuNCk7CiAgICAtLWJ1dHRvbi1kaXNhYmxlZC1vcGFjaXR5OjAuNjsKfQogIH0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKLmRpYWxvZ3sKICAgIC0tZGlhbG9nLWJnLWNvbG9yOkNhbnZhczsKICAgIC0tZGlhbG9nLWJvcmRlci1jb2xvcjpDYW52YXNUZXh0OwogICAgLS1kaWFsb2ctc2hhZG93Om5vbmU7CiAgICAtLXRleHQtcHJpbWFyeS1jb2xvcjpDYW52YXNUZXh0OwogICAgLS10ZXh0LXNlY29uZGFyeS1jb2xvcjpDYW52YXNUZXh0OwogICAgLS1ob3Zlci1maWx0ZXI6bm9uZTsKICAgIC0tbGluay1mZy1jb2xvcjpMaW5rVGV4dDsKICAgIC0tbGluay1ob3Zlci1mZy1jb2xvcjpMaW5rVGV4dDsKICAgIC0tc2VwYXJhdG9yLWNvbG9yOkNhbnZhc1RleHQ7CgogICAgLS10ZXh0YXJlYS1ib3JkZXItY29sb3I6QnV0dG9uQm9yZGVyOwogICAgLS10ZXh0YXJlYS1iZy1jb2xvcjpGaWVsZDsKICAgIC0tdGV4dGFyZWEtZmctY29sb3I6QnV0dG9uVGV4dDsKCiAgICAtLXJhZGlvLWJnLWNvbG9yOkJ1dHRvbkZhY2U7CiAgICAtLXJhZGlvLWNoZWNrZWQtYmctY29sb3I6QnV0dG9uRmFjZTsKICAgIC0tcmFkaW8tYm9yZGVyLWNvbG9yOkJ1dHRvblRleHQ7CiAgICAtLXJhZGlvLWNoZWNrZWQtYm9yZGVyLWNvbG9yOkJ1dHRvblRleHQ7CgogICAgLS1idXR0b24tc2Vjb25kYXJ5LWJnLWNvbG9yOkhpZ2hsaWdodFRleHQ7CiAgICAtLWJ1dHRvbi1zZWNvbmRhcnktZmctY29sb3I6QnV0dG9uVGV4dDsKICAgIC0tYnV0dG9uLXNlY29uZGFyeS1ib3JkZXItY29sb3I6QnV0dG9uVGV4dDsKICAgIC0tYnV0dG9uLXNlY29uZGFyeS1hY3RpdmUtYmctY29sb3I6SGlnaGxpZ2h0VGV4dDsKICAgIC0tYnV0dG9uLXNlY29uZGFyeS1hY3RpdmUtZmctY29sb3I6U2VsZWN0ZWRJdGVtOwogICAgLS1idXR0b24tc2Vjb25kYXJ5LWFjdGl2ZS1ib3JkZXItY29sb3I6QnV0dG9uVGV4dDsKICAgIC0tYnV0dG9uLXNlY29uZGFyeS1ob3Zlci1iZy1jb2xvcjpIaWdobGlnaHRUZXh0OwogICAgLS1idXR0b24tc2Vjb25kYXJ5LWhvdmVyLWZnLWNvbG9yOlNlbGVjdGVkSXRlbTsKICAgIC0tYnV0dG9uLXNlY29uZGFyeS1ob3Zlci1ib3JkZXItY29sb3I6U2VsZWN0ZWRJdGVtOwogICAgLS1idXR0b24tc2Vjb25kYXJ5LWRpc2FibGVkLWZnLWNvbG9yOkdyYXlUZXh0OwogICAgLS1idXR0b24tc2Vjb25kYXJ5LWRpc2FibGVkLWJvcmRlci1jb2xvcjpHcmF5VGV4dDsKCiAgICAtLWJ1dHRvbi1wcmltYXJ5LWJnLWNvbG9yOkJ1dHRvblRleHQ7CiAgICAtLWJ1dHRvbi1wcmltYXJ5LWZnLWNvbG9yOkhpZ2hsaWdodFRleHQ7CiAgICAtLWJ1dHRvbi1wcmltYXJ5LWJvcmRlci1jb2xvcjpCdXR0b25UZXh0OwogICAgLS1idXR0b24tcHJpbWFyeS1hY3RpdmUtYmctY29sb3I6U2VsZWN0ZWRJdGVtOwogICAgLS1idXR0b24tcHJpbWFyeS1hY3RpdmUtZmctY29sb3I6SGlnaGxpZ2h0VGV4dDsKICAgIC0tYnV0dG9uLXByaW1hcnktYWN0aXZlLWJvcmRlci1jb2xvcjpCdXR0b25UZXh0OwogICAgLS1idXR0b24tcHJpbWFyeS1ob3Zlci1iZy1jb2xvcjpTZWxlY3RlZEl0ZW07CiAgICAtLWJ1dHRvbi1wcmltYXJ5LWhvdmVyLWZnLWNvbG9yOkhpZ2hsaWdodFRleHQ7CiAgICAtLWJ1dHRvbi1wcmltYXJ5LWhvdmVyLWJvcmRlci1jb2xvcjpTZWxlY3RlZEl0ZW07CiAgICAtLWJ1dHRvbi1wcmltYXJ5LWRpc2FibGVkLWJnLWNvbG9yOkdyYXlUZXh0OwogICAgLS1idXR0b24tcHJpbWFyeS1kaXNhYmxlZC1mZy1jb2xvcjpCdXR0b25GYWNlOwogICAgLS1idXR0b24tcHJpbWFyeS1kaXNhYmxlZC1ib3JkZXItY29sb3I6R3JheVRleHQ7CiAgICAtLWJ1dHRvbi1kaXNhYmxlZC1vcGFjaXR5OjE7CgogICAgLS1pbnB1dC10ZXh0LWJnLWNvbG9yOkhpZ2hsaWdodFRleHQ7CiAgICAtLWlucHV0LXRleHQtZmctY29sb3I6RmllbGRUZXh0Owp9CiAgfQoKLmRpYWxvZ3sKCiAgZm9udDptZXNzYWdlLWJveDsKICBmb250LXNpemU6MTNweDsKICBmb250LXdlaWdodDo0MDA7CiAgbGluZS1oZWlnaHQ6MTUwJTsKICBib3JkZXItcmFkaXVzOjRweDsKICBwYWRkaW5nOjEycHggMTZweDsKICBib3JkZXI6MXB4IHNvbGlkIHZhcigtLWRpYWxvZy1ib3JkZXItY29sb3IpOwogIGJhY2tncm91bmQ6dmFyKC0tZGlhbG9nLWJnLWNvbG9yKTsKICBjb2xvcjp2YXIoLS10ZXh0LXByaW1hcnktY29sb3IpOwogIGJveC1zaGFkb3c6dmFyKC0tZGlhbG9nLXNoYWRvdyk7Cn0KCjppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSAqOmZvY3VzLXZpc2libGV7CiAgICAgIG91dGxpbmU6dmFyKC0tZm9jdXMtcmluZy1vdXRsaW5lKTsKICAgICAgb3V0bGluZS1vZmZzZXQ6MnB4OwogICAgfQoKOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIC50aXRsZXsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICB3aWR0aDphdXRvOwogICAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICAgIGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsKICAgICAgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsKICAgICAgZ2FwOjEycHg7CiAgICB9Cgo6aXMoOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIC50aXRsZSkgID4gc3BhbnsKICAgICAgICBmb250LXNpemU6MTNweDsKICAgICAgICBmb250LXN0eWxlOm5vcm1hbDsKICAgICAgICBmb250LXdlaWdodDo1OTA7CiAgICAgICAgbGluZS1oZWlnaHQ6MTUwJTsKICAgICAgfQoKOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIC5kaWFsb2dTZXBhcmF0b3J7CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGhlaWdodDowOwogICAgICBtYXJnaW4tYmxvY2s6NHB4OwogICAgICBib3JkZXItdG9wOjFweCBzb2xpZCB2YXIoLS1zZXBhcmF0b3ItY29sb3IpOwogICAgICBib3JkZXItYm90dG9tOm5vbmU7CiAgICB9Cgo6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgLmRpYWxvZ0J1dHRvbnNHcm91cHsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBnYXA6MTJweDsKICAgICAgYWxpZ24tc2VsZjpmbGV4LWVuZDsKICAgIH0KCjppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSAucmFkaW97CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwogICAgICBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OwogICAgICBnYXA6NHB4OwogICAgfQoKOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSAucmFkaW8pICA+IC5yYWRpb0J1dHRvbnsKICAgICAgICBkaXNwbGF5OmZsZXg7CiAgICAgICAgZ2FwOjhweDsKICAgICAgICBhbGlnbi1zZWxmOnN0cmV0Y2g7CiAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICB9Cgo6aXMoOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSAucmFkaW8pID4gLnJhZGlvQnV0dG9uKSBpbnB1dHsKICAgICAgICAgIC13ZWJraXQtYXBwZWFyYW5jZTpub25lOwogICAgICAgICAgICAgLW1vei1hcHBlYXJhbmNlOm5vbmU7CiAgICAgICAgICAgICAgICAgIGFwcGVhcmFuY2U6bm9uZTsKICAgICAgICAgIGJveC1zaXppbmc6Ym9yZGVyLWJveDsKICAgICAgICAgIHdpZHRoOjE2cHg7CiAgICAgICAgICBoZWlnaHQ6MTZweDsKICAgICAgICAgIGJvcmRlci1yYWRpdXM6NTAlOwogICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1yYWRpby1iZy1jb2xvcik7CiAgICAgICAgICBib3JkZXI6MXB4IHNvbGlkIHZhcigtLXJhZGlvLWJvcmRlci1jb2xvcik7CiAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIC5yYWRpbykgPiAucmFkaW9CdXR0b24pIGlucHV0KTpob3ZlcnsKICAgICAgICAgICAgZmlsdGVyOnZhcigtLWhvdmVyLWZpbHRlcik7CiAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgLnJhZGlvKSA+IC5yYWRpb0J1dHRvbikgaW5wdXQpOmNoZWNrZWR7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tcmFkaW8tY2hlY2tlZC1iZy1jb2xvcik7CiAgICAgICAgICAgIGJvcmRlcjo0cHggc29saWQgdmFyKC0tcmFkaW8tY2hlY2tlZC1ib3JkZXItY29sb3IpOwogICAgICAgICAgfQoKOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSAucmFkaW8pICA+IC5yYWRpb0xhYmVsewogICAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgICBwYWRkaW5nLWlubGluZS1zdGFydDoyNHB4OwogICAgICAgIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7CiAgICAgICAgZ2FwOjEwcHg7CiAgICAgICAgYWxpZ24tc2VsZjpzdHJldGNoOwogICAgICB9Cgo6aXMoOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSAucmFkaW8pID4gLnJhZGlvTGFiZWwpICA+IHNwYW57CiAgICAgICAgICBmbGV4OjEgMCAwOwogICAgICAgICAgZm9udC1zaXplOjExcHg7CiAgICAgICAgICBjb2xvcjp2YXIoLS10ZXh0LXNlY29uZGFyeS1jb2xvcik7CiAgICAgICAgfQoKOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIGJ1dHRvbjpub3QoOmlzKC50b2dnbGUtYnV0dG9uLC5jbG9zZUJ1dHRvbiwuY2xlYXJJbnB1dEJ1dHRvbikpewogICAgICBib3JkZXItcmFkaXVzOjRweDsKICAgICAgYm9yZGVyOjFweCBzb2xpZDsKICAgICAgZm9udDptZW51OwogICAgICBmb250LXdlaWdodDo1OTA7CiAgICAgIGZvbnQtc2l6ZToxM3B4OwogICAgICBwYWRkaW5nOjRweCAxNnB4OwogICAgICB3aWR0aDphdXRvOwogICAgICBoZWlnaHQ6MzJweDsKICAgIH0KCjppcyg6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgYnV0dG9uOm5vdCg6aXMoLnRvZ2dsZS1idXR0b24sLmNsb3NlQnV0dG9uLC5jbGVhcklucHV0QnV0dG9uKSkpOmhvdmVyewogICAgICAgIGN1cnNvcjpwb2ludGVyOwogICAgICAgIGZpbHRlcjp2YXIoLS1ob3Zlci1maWx0ZXIpOwogICAgICB9Cgo6aXMoOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIGJ1dHRvbjpub3QoOmlzKC50b2dnbGUtYnV0dG9uLC5jbG9zZUJ1dHRvbiwuY2xlYXJJbnB1dEJ1dHRvbikpKSAgPiBzcGFuewogICAgICAgIGNvbG9yOmluaGVyaXQ7CiAgICAgICAgZm9udDppbmhlcml0OwogICAgICB9Cgouc2Vjb25kYXJ5QnV0dG9uOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSBidXR0b246bm90KDppcygudG9nZ2xlLWJ1dHRvbiwuY2xvc2VCdXR0b24sLmNsZWFySW5wdXRCdXR0b24pKSl7CiAgICAgICAgY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1mZy1jb2xvcik7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1idXR0b24tc2Vjb25kYXJ5LWJnLWNvbG9yKTsKICAgICAgICBib3JkZXItY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1ib3JkZXItY29sb3IpOwogICAgICB9Cgouc2Vjb25kYXJ5QnV0dG9uOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSBidXR0b246bm90KDppcygudG9nZ2xlLWJ1dHRvbiwuY2xvc2VCdXR0b24sLmNsZWFySW5wdXRCdXR0b24pKSk6aG92ZXJ7CiAgICAgICAgICBjb2xvcjp2YXIoLS1idXR0b24tc2Vjb25kYXJ5LWhvdmVyLWZnLWNvbG9yKTsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1ob3Zlci1iZy1jb2xvcik7CiAgICAgICAgICBib3JkZXItY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1ob3Zlci1ib3JkZXItY29sb3IpOwogICAgICAgIH0KCi5zZWNvbmRhcnlCdXR0b246aXMoOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIGJ1dHRvbjpub3QoOmlzKC50b2dnbGUtYnV0dG9uLC5jbG9zZUJ1dHRvbiwuY2xlYXJJbnB1dEJ1dHRvbikpKTphY3RpdmV7CiAgICAgICAgICBjb2xvcjp2YXIoLS1idXR0b24tc2Vjb25kYXJ5LWFjdGl2ZS1mZy1jb2xvcik7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWJ1dHRvbi1zZWNvbmRhcnktYWN0aXZlLWJnLWNvbG9yKTsKICAgICAgICAgIGJvcmRlci1jb2xvcjp2YXIoLS1idXR0b24tc2Vjb25kYXJ5LWFjdGl2ZS1ib3JkZXItY29sb3IpOwogICAgICAgIH0KCi5zZWNvbmRhcnlCdXR0b246aXMoOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIGJ1dHRvbjpub3QoOmlzKC50b2dnbGUtYnV0dG9uLC5jbG9zZUJ1dHRvbiwuY2xlYXJJbnB1dEJ1dHRvbikpKTpkaXNhYmxlZHsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1kaXNhYmxlZC1iZy1jb2xvcik7CiAgICAgICAgICBib3JkZXItY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1kaXNhYmxlZC1ib3JkZXItY29sb3IpOwogICAgICAgICAgY29sb3I6dmFyKC0tYnV0dG9uLXNlY29uZGFyeS1kaXNhYmxlZC1mZy1jb2xvcik7CiAgICAgICAgICBvcGFjaXR5OnZhcigtLWJ1dHRvbi1kaXNhYmxlZC1vcGFjaXR5KTsKICAgICAgICB9CgoucHJpbWFyeUJ1dHRvbjppcyg6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgYnV0dG9uOm5vdCg6aXMoLnRvZ2dsZS1idXR0b24sLmNsb3NlQnV0dG9uLC5jbGVhcklucHV0QnV0dG9uKSkpewogICAgICAgIGNvbG9yOnZhcigtLWJ1dHRvbi1wcmltYXJ5LWZnLWNvbG9yKTsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWJ1dHRvbi1wcmltYXJ5LWJnLWNvbG9yKTsKICAgICAgICBib3JkZXItY29sb3I6dmFyKC0tYnV0dG9uLXByaW1hcnktYm9yZGVyLWNvbG9yKTsKICAgICAgICBvcGFjaXR5OjE7CiAgICAgIH0KCi5wcmltYXJ5QnV0dG9uOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSBidXR0b246bm90KDppcygudG9nZ2xlLWJ1dHRvbiwuY2xvc2VCdXR0b24sLmNsZWFySW5wdXRCdXR0b24pKSk6aG92ZXJ7CiAgICAgICAgICBjb2xvcjp2YXIoLS1idXR0b24tcHJpbWFyeS1ob3Zlci1mZy1jb2xvcik7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWJ1dHRvbi1wcmltYXJ5LWhvdmVyLWJnLWNvbG9yKTsKICAgICAgICAgIGJvcmRlci1jb2xvcjp2YXIoLS1idXR0b24tcHJpbWFyeS1ob3Zlci1ib3JkZXItY29sb3IpOwogICAgICAgIH0KCi5wcmltYXJ5QnV0dG9uOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSBidXR0b246bm90KDppcygudG9nZ2xlLWJ1dHRvbiwuY2xvc2VCdXR0b24sLmNsZWFySW5wdXRCdXR0b24pKSk6YWN0aXZlewogICAgICAgICAgY29sb3I6dmFyKC0tYnV0dG9uLXByaW1hcnktYWN0aXZlLWZnLWNvbG9yKTsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tYnV0dG9uLXByaW1hcnktYWN0aXZlLWJnLWNvbG9yKTsKICAgICAgICAgIGJvcmRlci1jb2xvcjp2YXIoLS1idXR0b24tcHJpbWFyeS1hY3RpdmUtYm9yZGVyLWNvbG9yKTsKICAgICAgICB9CgoucHJpbWFyeUJ1dHRvbjppcyg6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgYnV0dG9uOm5vdCg6aXMoLnRvZ2dsZS1idXR0b24sLmNsb3NlQnV0dG9uLC5jbGVhcklucHV0QnV0dG9uKSkpOmRpc2FibGVkewogICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1idXR0b24tcHJpbWFyeS1kaXNhYmxlZC1iZy1jb2xvcik7CiAgICAgICAgICBib3JkZXItY29sb3I6dmFyKC0tYnV0dG9uLXByaW1hcnktZGlzYWJsZWQtYm9yZGVyLWNvbG9yKTsKICAgICAgICAgIGNvbG9yOnZhcigtLWJ1dHRvbi1wcmltYXJ5LWRpc2FibGVkLWZnLWNvbG9yKTsKICAgICAgICAgIG9wYWNpdHk6dmFyKC0tYnV0dG9uLWRpc2FibGVkLW9wYWNpdHkpOwogICAgICAgIH0KCjppcyg6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgYnV0dG9uOm5vdCg6aXMoLnRvZ2dsZS1idXR0b24sLmNsb3NlQnV0dG9uLC5jbGVhcklucHV0QnV0dG9uKSkpOmRpc2FibGVkewogICAgICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICAgIH0KCjppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSBhewogICAgICBjb2xvcjp2YXIoLS1saW5rLWZnLWNvbG9yKTsKICAgIH0KCjppcyg6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgYSk6aG92ZXJ7CiAgICAgICAgY29sb3I6dmFyKC0tbGluay1ob3Zlci1mZy1jb2xvcik7CiAgICAgIH0KCjppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSB0ZXh0YXJlYXsKICAgICAgZm9udDppbmhlcml0OwogICAgICBwYWRkaW5nOjhweDsKICAgICAgcmVzaXplOm5vbmU7CiAgICAgIG1hcmdpbjowOwogICAgICBib3gtc2l6aW5nOmJvcmRlci1ib3g7CiAgICAgIGJvcmRlci1yYWRpdXM6NHB4OwogICAgICBib3JkZXI6MXB4IHNvbGlkIHZhcigtLXRleHRhcmVhLWJvcmRlci1jb2xvcik7CiAgICAgIGJhY2tncm91bmQ6dmFyKC0tdGV4dGFyZWEtYmctY29sb3IpOwogICAgICBjb2xvcjp2YXIoLS10ZXh0YXJlYS1mZy1jb2xvcik7CiAgICB9Cgo6aXMoOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIHRleHRhcmVhKTpmb2N1c3sKICAgICAgICBvdXRsaW5lLW9mZnNldDowOwogICAgICAgIGJvcmRlci1jb2xvcjp0cmFuc3BhcmVudDsKICAgICAgfQoKOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSB0ZXh0YXJlYSk6ZGlzYWJsZWR7CiAgICAgICAgcG9pbnRlci1ldmVudHM6bm9uZTsKICAgICAgICBvcGFjaXR5OjAuNDsKICAgICAgfQoKOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIGlucHV0W3R5cGU9InRleHQiXXsKICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1pbnB1dC10ZXh0LWJnLWNvbG9yKTsKICAgICAgY29sb3I6dmFyKC0taW5wdXQtdGV4dC1mZy1jb2xvcik7CiAgICB9Cgo6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgLm1lc3NhZ2VCYXJ7CiAgICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTYyOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICM1YTMxMDA7CiAgICAgIC0tbWVzc2FnZS1iYXItYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTYyLCAjZmZlYmNkKTsKICAgICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjM6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2ZiZmJmZTsKICAgICAgLS1tZXNzYWdlLWJhci1mZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjMsICMxNTE0MWEpOwogICAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02NDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjA4KTsKICAgICAgLS1tZXNzYWdlLWJhci1ib3JkZXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTY0LCByZ2IoMCAwIDAgLyAwLjA4KSk7CiAgICAgIC0tbWVzc2FnZS1iYXItaWNvbjp1cmwoaW1hZ2VzL21lc3NhZ2VCYXJfd2FybmluZy5zdmcpOwogICAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02NTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjZTQ5YzQ5OwogICAgICAtLW1lc3NhZ2UtYmFyLWljb24tY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTY1LCAjY2Q0MTFlKTsKICAgIH0KCkBzdXBwb3J0cyAoY29sb3I6IGxpZ2h0LWRhcmsocmVkLCByZWQpKXsKOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIC5tZXNzYWdlQmFyewogICAgICAtLW1lc3NhZ2UtYmFyLWJnLWNvbG9yOmxpZ2h0LWRhcmsoI2ZmZWJjZCwgIzVhMzEwMCk7CiAgICAgIC0tbWVzc2FnZS1iYXItZmctY29sb3I6bGlnaHQtZGFyaygjMTUxNDFhLCAjZmJmYmZlKTsKICAgIH0KfQoKQHN1cHBvcnRzIChjb2xvcjogbGlnaHQtZGFyayhyZWQsIHJlZCkpIGFuZCAoY29sb3I6IHJnYigwIDAgMCAvIDApKXsKOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIC5tZXNzYWdlQmFyewogICAgICAtLW1lc3NhZ2UtYmFyLWJvcmRlci1jb2xvcjpsaWdodC1kYXJrKAogICAgICAgIHJnYigwIDAgMCAvIDAuMDgpLAogICAgICAgIHJnYigyNTUgMjU1IDI1NSAvIDAuMDgpCiAgICAgICk7CiAgICB9Cn0KCkBzdXBwb3J0cyAoY29sb3I6IGxpZ2h0LWRhcmsocmVkLCByZWQpKXsKOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIC5tZXNzYWdlQmFyewogICAgICAtLW1lc3NhZ2UtYmFyLWljb24tY29sb3I6bGlnaHQtZGFyaygjY2Q0MTFlLCAjZTQ5YzQ5KTsKICAgIH0KfQoKQHN1cHBvcnRzIG5vdCAoY29sb3I6IGxpZ2h0LWRhcmsodGFuLCB0YW4pKXsKCjppcyg6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgLm1lc3NhZ2VCYXIpICp7CiAgICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTYyOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICM1YTMxMDA7CiAgICAgIC0tbWVzc2FnZS1iYXItYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTYyLCAjZmZlYmNkKTsKICAgICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjM6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2ZiZmJmZTsKICAgICAgLS1tZXNzYWdlLWJhci1mZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjMsICMxNTE0MWEpOwogICAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02NDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjA4KTsKICAgICAgLS1tZXNzYWdlLWJhci1ib3JkZXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTY0LCByZ2IoMCAwIDAgLyAwLjA4KSk7CiAgICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTY1OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICNlNDljNDk7CiAgICAgIC0tbWVzc2FnZS1iYXItaWNvbi1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjUsICNjZDQxMWUpOwogIH0KfQoKQG1lZGlhIHNjcmVlbiBhbmQgKGZvcmNlZC1jb2xvcnM6IGFjdGl2ZSl7Cgo6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgLm1lc3NhZ2VCYXJ7CiAgICAgICAgLS1tZXNzYWdlLWJhci1iZy1jb2xvcjpIaWdobGlnaHRUZXh0OwogICAgICAgIC0tbWVzc2FnZS1iYXItZmctY29sb3I6Q2FudmFzVGV4dDsKICAgICAgICAtLW1lc3NhZ2UtYmFyLWJvcmRlci1jb2xvcjpDYW52YXNUZXh0OwogICAgICAgIC0tbWVzc2FnZS1iYXItaWNvbi1jb2xvcjpDYW52YXNUZXh0OwogICAgfQogICAgICB9Cgo6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgLm1lc3NhZ2VCYXJ7CgogICAgICBhbGlnbi1zZWxmOnN0cmV0Y2g7CiAgICB9Cgo6aXMoOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSAubWVzc2FnZUJhcikgPiBkaXYpOjpiZWZvcmUsOmlzKDppcyg6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgLm1lc3NhZ2VCYXIpID4gZGl2KSAgPiBkaXZ7CiAgICAgICAgICBtYXJnaW4tYmxvY2s6NHB4OwogICAgICAgIH0KCjppcyg6aXMoOmlzKC5kaWFsb2cgLm1haW5Db250YWluZXIpIC5tZXNzYWdlQmFyKSA+IGRpdikgID4gZGl2ewogICAgICAgICAgZGlzcGxheTpmbGV4OwogICAgICAgICAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwogICAgICAgICAgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsKICAgICAgICAgIGdhcDo4cHg7CiAgICAgICAgICBmbGV4OjEgMCAwOwogICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSAubWVzc2FnZUJhcikgPiBkaXYpID4gZGl2KSAudGl0bGV7CiAgICAgICAgICAgIGZvbnQtc2l6ZToxM3B4OwogICAgICAgICAgICBmb250LXdlaWdodDo1OTA7CiAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgLm1lc3NhZ2VCYXIpID4gZGl2KSA+IGRpdikgLmRlc2NyaXB0aW9uewogICAgICAgICAgICBmb250LXNpemU6MTNweDsKICAgICAgICAgIH0KCjppcyguZGlhbG9nIC5tYWluQ29udGFpbmVyKSAudG9nZ2xlcnsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIGdhcDo4cHg7CiAgICAgIGFsaWduLXNlbGY6c3RyZXRjaDsKICAgIH0KCjppcyg6aXMoLmRpYWxvZyAubWFpbkNvbnRhaW5lcikgLnRvZ2dsZXIpICA+IC50b2dnbGVyTGFiZWx7CiAgICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDpub25lOwogICAgICAgICAgIC1tb3otdXNlci1zZWxlY3Q6bm9uZTsKICAgICAgICAgICAgICAgIHVzZXItc2VsZWN0Om5vbmU7CiAgICAgIH0KCi50ZXh0TGF5ZXJ7CiAgcG9zaXRpb246YWJzb2x1dGU7CiAgdGV4dC1hbGlnbjppbml0aWFsOwogIGluc2V0OjA7CiAgb3ZlcmZsb3c6Y2xpcDsKICBvcGFjaXR5OjE7CiAgbGluZS1oZWlnaHQ6MTsKICAtd2Via2l0LXRleHQtc2l6ZS1hZGp1c3Q6bm9uZTsKICAgICAtbW96LXRleHQtc2l6ZS1hZGp1c3Q6bm9uZTsKICAgICAgICAgIHRleHQtc2l6ZS1hZGp1c3Q6bm9uZTsKICBmb3JjZWQtY29sb3ItYWRqdXN0Om5vbmU7CiAgdHJhbnNmb3JtLW9yaWdpbjowIDA7CiAgY2FyZXQtY29sb3I6Q2FudmFzVGV4dDsKICB6LWluZGV4OjA7Cn0KCi50ZXh0TGF5ZXIuaGlnaGxpZ2h0aW5newogICAgdG91Y2gtYWN0aW9uOm5vbmU7CiAgfQoKLnRleHRMYXllciA6aXMoc3Bhbixicil7CiAgICBjb2xvcjp0cmFuc3BhcmVudDsKICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgd2hpdGUtc3BhY2U6cHJlOwogICAgY3Vyc29yOnRleHQ7CiAgICB0cmFuc2Zvcm0tb3JpZ2luOjAlIDAlOwogIH0KCi50ZXh0TGF5ZXIgID4gOm5vdCgubWFya2VkQ29udGVudCksLnRleHRMYXllciAubWFya2VkQ29udGVudCBzcGFuOm5vdCgubWFya2VkQ29udGVudCl7CiAgICB6LWluZGV4OjE7CiAgfQoKLnRleHRMYXllciBzcGFuLm1hcmtlZENvbnRlbnR7CiAgICB0b3A6MDsKICAgIGhlaWdodDowOwogIH0KCi50ZXh0TGF5ZXIgc3Bhbltyb2xlPSJpbWciXXsKICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsKICAgICAgIC1tb3otdXNlci1zZWxlY3Q6bm9uZTsKICAgICAgICAgICAgdXNlci1zZWxlY3Q6bm9uZTsKICAgIGN1cnNvcjpkZWZhdWx0OwogIH0KCi50ZXh0TGF5ZXIgLmhpZ2hsaWdodHsKICAgIC0taGlnaGxpZ2h0LWJnLWNvbG9yOnJnYigxODAgMCAxNzAgLyAwLjI1KTsKICAgIC0taGlnaGxpZ2h0LXNlbGVjdGVkLWJnLWNvbG9yOnJnYigwIDEwMCAwIC8gMC4yNSk7CiAgICAtLWhpZ2hsaWdodC1iYWNrZHJvcC1maWx0ZXI6bm9uZTsKICAgIC0taGlnaGxpZ2h0LXNlbGVjdGVkLWJhY2tkcm9wLWZpbHRlcjpub25lOwogIH0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKLnRleHRMYXllciAuaGlnaGxpZ2h0ewogICAgICAtLWhpZ2hsaWdodC1iZy1jb2xvcjp0cmFuc3BhcmVudDsKICAgICAgLS1oaWdobGlnaHQtc2VsZWN0ZWQtYmctY29sb3I6dHJhbnNwYXJlbnQ7CiAgICAgIC0taGlnaGxpZ2h0LWJhY2tkcm9wLWZpbHRlcjp2YXIoLS1oY20taGlnaGxpZ2h0LWZpbHRlcik7CiAgICAgIC0taGlnaGxpZ2h0LXNlbGVjdGVkLWJhY2tkcm9wLWZpbHRlcjp2YXIoCiAgICAgICAgLS1oY20taGlnaGxpZ2h0LXNlbGVjdGVkLWZpbHRlcgogICAgICApOwogIH0KICAgIH0KCi50ZXh0TGF5ZXIgLmhpZ2hsaWdodHsKCiAgICBtYXJnaW46LTFweDsKICAgIHBhZGRpbmc6MXB4OwogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1oaWdobGlnaHQtYmctY29sb3IpOwogICAgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI6dmFyKC0taGlnaGxpZ2h0LWJhY2tkcm9wLWZpbHRlcik7CiAgICAgICAgICAgIGJhY2tkcm9wLWZpbHRlcjp2YXIoLS1oaWdobGlnaHQtYmFja2Ryb3AtZmlsdGVyKTsKICAgIGJvcmRlci1yYWRpdXM6NHB4OwogIH0KCi5hcHBlbmRlZDppcygudGV4dExheWVyIC5oaWdobGlnaHQpewogICAgICBwb3NpdGlvbjppbml0aWFsOwogICAgfQoKLmJlZ2luOmlzKC50ZXh0TGF5ZXIgLmhpZ2hsaWdodCl7CiAgICAgIGJvcmRlci1yYWRpdXM6NHB4IDAgMCA0cHg7CiAgICB9CgouZW5kOmlzKC50ZXh0TGF5ZXIgLmhpZ2hsaWdodCl7CiAgICAgIGJvcmRlci1yYWRpdXM6MCA0cHggNHB4IDA7CiAgICB9CgoubWlkZGxlOmlzKC50ZXh0TGF5ZXIgLmhpZ2hsaWdodCl7CiAgICAgIGJvcmRlci1yYWRpdXM6MDsKICAgIH0KCi5zZWxlY3RlZDppcygudGV4dExheWVyIC5oaWdobGlnaHQpewogICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWhpZ2hsaWdodC1zZWxlY3RlZC1iZy1jb2xvcik7CiAgICAgIC13ZWJraXQtYmFja2Ryb3AtZmlsdGVyOnZhcigtLWhpZ2hsaWdodC1zZWxlY3RlZC1iYWNrZHJvcC1maWx0ZXIpOwogICAgICAgICAgICAgIGJhY2tkcm9wLWZpbHRlcjp2YXIoLS1oaWdobGlnaHQtc2VsZWN0ZWQtYmFja2Ryb3AtZmlsdGVyKTsKICAgIH0KCi50ZXh0TGF5ZXIgOjotbW96LXNlbGVjdGlvbnsKICAgIGJhY2tncm91bmQ6cmdiYSgwIDAgMjU1IC8gMC4yNSk7CiAgICBiYWNrZ3JvdW5kOmNvbG9yLW1peChpbiBzcmdiLCBBY2NlbnRDb2xvciwgdHJhbnNwYXJlbnQgNzUlKTsKICB9CgoudGV4dExheWVyIDo6c2VsZWN0aW9uewogICAgYmFja2dyb3VuZDpyZ2JhKDAgMCAyNTUgLyAwLjI1KTsKICAgIGJhY2tncm91bmQ6Y29sb3ItbWl4KGluIHNyZ2IsIEFjY2VudENvbG9yLCB0cmFuc3BhcmVudCA3NSUpOwogIH0KCi50ZXh0TGF5ZXIgYnI6Oi1tb3otc2VsZWN0aW9uewogICAgYmFja2dyb3VuZDp0cmFuc3BhcmVudDsKICB9CgoudGV4dExheWVyIGJyOjpzZWxlY3Rpb257CiAgICBiYWNrZ3JvdW5kOnRyYW5zcGFyZW50OwogIH0KCi50ZXh0TGF5ZXIgLmVuZE9mQ29udGVudHsKICAgIGRpc3BsYXk6YmxvY2s7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIGluc2V0OjEwMCUgMCAwOwogICAgei1pbmRleDowOwogICAgY3Vyc29yOmRlZmF1bHQ7CiAgICAtd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgICAtbW96LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgICAgICAgIHVzZXItc2VsZWN0Om5vbmU7CiAgfQoKLnRleHRMYXllci5zZWxlY3RpbmcgLmVuZE9mQ29udGVudHsKICAgIHRvcDowOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXJ7CiAgLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0OmluaXRpYWw7CiAgY29sb3Itc2NoZW1lOm9ubHkgbGlnaHQ7CgogIC0tYW5ub3RhdGlvbi11bmZvY3VzZWQtZmllbGQtYmFja2dyb3VuZDp1cmwoImRhdGE6aW1hZ2Uvc3ZnK3htbDtjaGFyc2V0PVVURi04LDxzdmcgd2lkdGg9JzFweCcgaGVpZ2h0PScxcHgnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgc3R5bGU9J2ZpbGw6cmdiYSgwLCA1NCwgMjU1LCAwLjEzKTsnLz48L3N2Zz4iKTsKICAtLWlucHV0LWZvY3VzLWJvcmRlci1jb2xvcjpIaWdobGlnaHQ7CiAgLS1pbnB1dC1mb2N1cy1vdXRsaW5lOjFweCBzb2xpZCBDYW52YXM7CiAgLS1pbnB1dC11bmZvY3VzZWQtYm9yZGVyLWNvbG9yOnRyYW5zcGFyZW50OwogIC0taW5wdXQtZGlzYWJsZWQtYm9yZGVyLWNvbG9yOnRyYW5zcGFyZW50OwogIC0taW5wdXQtaG92ZXItYm9yZGVyLWNvbG9yOmJsYWNrOwogIC0tbGluay1vdXRsaW5lOm5vbmU7Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKLmFubm90YXRpb25MYXllcnsKICAgIC0taW5wdXQtZm9jdXMtYm9yZGVyLWNvbG9yOkNhbnZhc1RleHQ7CiAgICAtLWlucHV0LXVuZm9jdXNlZC1ib3JkZXItY29sb3I6QWN0aXZlVGV4dDsKICAgIC0taW5wdXQtZGlzYWJsZWQtYm9yZGVyLWNvbG9yOkdyYXlUZXh0OwogICAgLS1pbnB1dC1ob3Zlci1ib3JkZXItY29sb3I6SGlnaGxpZ2h0OwogICAgLS1saW5rLW91dGxpbmU6MS41cHggc29saWQgTGlua1RleHQ7Cn0KCiAgICAuYW5ub3RhdGlvbkxheWVyIC50ZXh0V2lkZ2V0QW5ub3RhdGlvbiA6aXMoaW5wdXQsdGV4dGFyZWEpOnJlcXVpcmVkLC5hbm5vdGF0aW9uTGF5ZXIgLmNob2ljZVdpZGdldEFubm90YXRpb24gc2VsZWN0OnJlcXVpcmVkLC5hbm5vdGF0aW9uTGF5ZXIgLmJ1dHRvbldpZGdldEFubm90YXRpb246aXMoLmNoZWNrQm94LC5yYWRpb0J1dHRvbikgaW5wdXQ6cmVxdWlyZWR7CiAgICAgIG91dGxpbmU6MS41cHggc29saWQgc2VsZWN0ZWRJdGVtOwogICAgfQoKICAgIC5hbm5vdGF0aW9uTGF5ZXIgLmxpbmtBbm5vdGF0aW9uewogICAgICBvdXRsaW5lOnZhcigtLWxpbmstb3V0bGluZSk7CiAgICB9CgogICAgICA6aXMoLmFubm90YXRpb25MYXllciAubGlua0Fubm90YXRpb24pOmhvdmVyewogICAgICAgIC13ZWJraXQtYmFja2Ryb3AtZmlsdGVyOnZhcigtLWhjbS1oaWdobGlnaHQtZmlsdGVyKTsKICAgICAgICAgICAgICAgIGJhY2tkcm9wLWZpbHRlcjp2YXIoLS1oY20taGlnaGxpZ2h0LWZpbHRlcik7CiAgICAgIH0KCiAgICAgIDppcyguYW5ub3RhdGlvbkxheWVyIC5saW5rQW5ub3RhdGlvbikgPiBhOmhvdmVyewogICAgICAgIG9wYWNpdHk6MCAhaW1wb3J0YW50OwogICAgICAgIGJhY2tncm91bmQ6bm9uZSAhaW1wb3J0YW50OwogICAgICAgIGJveC1zaGFkb3c6bm9uZTsKICAgICAgfQoKICAgIC5hbm5vdGF0aW9uTGF5ZXIgLnBvcHVwQW5ub3RhdGlvbiAucG9wdXB7CiAgICAgIG91dGxpbmU6Y2FsYygxLjVweCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpIHNvbGlkIENhbnZhc1RleHQgIWltcG9ydGFudDsKICAgICAgYmFja2dyb3VuZC1jb2xvcjpCdXR0b25GYWNlICFpbXBvcnRhbnQ7CiAgICAgIGNvbG9yOkJ1dHRvblRleHQgIWltcG9ydGFudDsKICAgIH0KCiAgICAuYW5ub3RhdGlvbkxheWVyIC5oaWdobGlnaHRBcmVhOmhvdmVyOjphZnRlcnsKICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgIHRvcDowOwogICAgICBsZWZ0OjA7CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGhlaWdodDoxMDAlOwogICAgICAtd2Via2l0LWJhY2tkcm9wLWZpbHRlcjp2YXIoLS1oY20taGlnaGxpZ2h0LWZpbHRlcik7CiAgICAgICAgICAgICAgYmFja2Ryb3AtZmlsdGVyOnZhcigtLWhjbS1oaWdobGlnaHQtZmlsdGVyKTsKICAgICAgY29udGVudDoiIjsKICAgICAgcG9pbnRlci1ldmVudHM6bm9uZTsKICAgIH0KCiAgICAuYW5ub3RhdGlvbkxheWVyIC5wb3B1cEFubm90YXRpb24uZm9jdXNlZCAucG9wdXB7CiAgICAgIG91dGxpbmU6Y2FsYygzcHggKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKSBzb2xpZCBIaWdobGlnaHQgIWltcG9ydGFudDsKICAgIH0KICB9CgouYW5ub3RhdGlvbkxheWVyewoKICBwb3NpdGlvbjphYnNvbHV0ZTsKICB0b3A6MDsKICBsZWZ0OjA7CiAgcG9pbnRlci1ldmVudHM6bm9uZTsKICB0cmFuc2Zvcm0tb3JpZ2luOjAgMDsKfQoKLmFubm90YXRpb25MYXllcltkYXRhLW1haW4tcm90YXRpb249IjkwIl0gLm5vcm90YXRlewogICAgdHJhbnNmb3JtOnJvdGF0ZSgyNzBkZWcpIHRyYW5zbGF0ZVgoLTEwMCUpOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSAubm9yb3RhdGV7CiAgICB0cmFuc2Zvcm06cm90YXRlKDE4MGRlZykgdHJhbnNsYXRlKC0xMDAlLCAtMTAwJSk7CiAgfQoKLmFubm90YXRpb25MYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIC5ub3JvdGF0ZXsKICAgIHRyYW5zZm9ybTpyb3RhdGUoOTBkZWcpIHRyYW5zbGF0ZVkoLTEwMCUpOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIuZGlzYWJsZWQgc2VjdGlvbiwuYW5ub3RhdGlvbkxheWVyLmRpc2FibGVkIC5wb3B1cHsKICAgICAgcG9pbnRlci1ldmVudHM6bm9uZTsKICAgIH0KCi5hbm5vdGF0aW9uTGF5ZXIgLmFubm90YXRpb25Db250ZW50ewogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICB3aWR0aDoxMDAlOwogICAgaGVpZ2h0OjEwMCU7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogIH0KCi5mcmVldGV4dDppcyguYW5ub3RhdGlvbkxheWVyIC5hbm5vdGF0aW9uQ29udGVudCl7CiAgICAgIGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7CiAgICAgIGJvcmRlcjpub25lOwogICAgICBpbnNldDowOwogICAgICBvdmVyZmxvdzp2aXNpYmxlOwogICAgICB3aGl0ZS1zcGFjZTpub3dyYXA7CiAgICAgIGZvbnQ6MTBweCBzYW5zLXNlcmlmOwogICAgICBsaW5lLWhlaWdodDoxLjM1OwogICAgfQoKLmFubm90YXRpb25MYXllciBzZWN0aW9uewogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICB0ZXh0LWFsaWduOmluaXRpYWw7CiAgICBwb2ludGVyLWV2ZW50czphdXRvOwogICAgYm94LXNpemluZzpib3JkZXItYm94OwogICAgdHJhbnNmb3JtLW9yaWdpbjowIDA7CiAgICAtd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgICAtbW96LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgICAgICAgIHVzZXItc2VsZWN0Om5vbmU7CiAgfQoKOmlzKC5hbm5vdGF0aW9uTGF5ZXIgc2VjdGlvbik6aGFzKGRpdi5hbm5vdGF0aW9uQ29udGVudCkgY2FudmFzLmFubm90YXRpb25Db250ZW50ewogICAgICAgIGRpc3BsYXk6bm9uZTsKICAgICAgfQoKLnRleHRMYXllci5zZWxlY3RpbmcgfiAuYW5ub3RhdGlvbkxheWVyIHNlY3Rpb257CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIgOmlzKC5saW5rQW5ub3RhdGlvbiwuYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbi5wdXNoQnV0dG9uKSA+IGF7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIGZvbnQtc2l6ZToxZW07CiAgICB0b3A6MDsKICAgIGxlZnQ6MDsKICAgIHdpZHRoOjEwMCU7CiAgICBoZWlnaHQ6MTAwJTsKICB9CgouYW5ub3RhdGlvbkxheWVyIDppcygubGlua0Fubm90YXRpb24sLmJ1dHRvbldpZGdldEFubm90YXRpb24ucHVzaEJ1dHRvbik6bm90KC5oYXNCb3JkZXIpID4gYTpob3ZlcnsKICAgIG9wYWNpdHk6MC4yOwogICAgYmFja2dyb3VuZC1jb2xvcjpyZ2IoMjU1IDI1NSAwKTsKICAgIGJveC1zaGFkb3c6MCAycHggMTBweCByZ2IoMjU1IDI1NSAwKTsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5saW5rQW5ub3RhdGlvbi5oYXNCb3JkZXI6aG92ZXJ7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOnJnYigyNTUgMjU1IDAgLyAwLjIpOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIgLmhhc0JvcmRlcnsKICAgIGJhY2tncm91bmQtc2l6ZToxMDAlIDEwMCU7CiAgfQoKLmFubm90YXRpb25MYXllciAudGV4dEFubm90YXRpb24gaW1newogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICBjdXJzb3I6cG9pbnRlcjsKICAgIHdpZHRoOjEwMCU7CiAgICBoZWlnaHQ6MTAwJTsKICAgIHRvcDowOwogICAgbGVmdDowOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIgLnRleHRXaWRnZXRBbm5vdGF0aW9uIDppcyhpbnB1dCx0ZXh0YXJlYSksLmFubm90YXRpb25MYXllciAuY2hvaWNlV2lkZ2V0QW5ub3RhdGlvbiBzZWxlY3QsLmFubm90YXRpb25MYXllciAuYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbjppcyguY2hlY2tCb3gsLnJhZGlvQnV0dG9uKSBpbnB1dHsKICAgIGJhY2tncm91bmQtaW1hZ2U6dmFyKC0tYW5ub3RhdGlvbi11bmZvY3VzZWQtZmllbGQtYmFja2dyb3VuZCk7CiAgICBib3JkZXI6MnB4IHNvbGlkIHZhcigtLWlucHV0LXVuZm9jdXNlZC1ib3JkZXItY29sb3IpOwogICAgYm94LXNpemluZzpib3JkZXItYm94OwogICAgZm9udDpjYWxjKDlweCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpIHNhbnMtc2VyaWY7CiAgICBoZWlnaHQ6MTAwJTsKICAgIG1hcmdpbjowOwogICAgdmVydGljYWwtYWxpZ246dG9wOwogICAgd2lkdGg6MTAwJTsKICB9CgouYW5ub3RhdGlvbkxheWVyIC50ZXh0V2lkZ2V0QW5ub3RhdGlvbiA6aXMoaW5wdXQsdGV4dGFyZWEpOnJlcXVpcmVkLC5hbm5vdGF0aW9uTGF5ZXIgLmNob2ljZVdpZGdldEFubm90YXRpb24gc2VsZWN0OnJlcXVpcmVkLC5hbm5vdGF0aW9uTGF5ZXIgLmJ1dHRvbldpZGdldEFubm90YXRpb246aXMoLmNoZWNrQm94LC5yYWRpb0J1dHRvbikgaW5wdXQ6cmVxdWlyZWR7CiAgICBvdXRsaW5lOjEuNXB4IHNvbGlkIHJlZDsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5jaG9pY2VXaWRnZXRBbm5vdGF0aW9uIHNlbGVjdCBvcHRpb257CiAgICBwYWRkaW5nOjA7CiAgfQoKLmFubm90YXRpb25MYXllciAuYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbi5yYWRpb0J1dHRvbiBpbnB1dHsKICAgIGJvcmRlci1yYWRpdXM6NTAlOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIgLnRleHRXaWRnZXRBbm5vdGF0aW9uIHRleHRhcmVhewogICAgcmVzaXplOm5vbmU7CiAgfQoKLmFubm90YXRpb25MYXllciAudGV4dFdpZGdldEFubm90YXRpb24gW2Rpc2FibGVkXTppcyhpbnB1dCx0ZXh0YXJlYSksLmFubm90YXRpb25MYXllciAuY2hvaWNlV2lkZ2V0QW5ub3RhdGlvbiBzZWxlY3RbZGlzYWJsZWRdLC5hbm5vdGF0aW9uTGF5ZXIgLmJ1dHRvbldpZGdldEFubm90YXRpb246aXMoLmNoZWNrQm94LC5yYWRpb0J1dHRvbikgaW5wdXRbZGlzYWJsZWRdewogICAgYmFja2dyb3VuZDpub25lOwogICAgYm9yZGVyOjJweCBzb2xpZCB2YXIoLS1pbnB1dC1kaXNhYmxlZC1ib3JkZXItY29sb3IpOwogICAgY3Vyc29yOm5vdC1hbGxvd2VkOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIgLnRleHRXaWRnZXRBbm5vdGF0aW9uIDppcyhpbnB1dCx0ZXh0YXJlYSk6aG92ZXIsLmFubm90YXRpb25MYXllciAuY2hvaWNlV2lkZ2V0QW5ub3RhdGlvbiBzZWxlY3Q6aG92ZXIsLmFubm90YXRpb25MYXllciAuYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbjppcyguY2hlY2tCb3gsLnJhZGlvQnV0dG9uKSBpbnB1dDpob3ZlcnsKICAgIGJvcmRlcjoycHggc29saWQgdmFyKC0taW5wdXQtaG92ZXItYm9yZGVyLWNvbG9yKTsKICB9CgouYW5ub3RhdGlvbkxheWVyIC50ZXh0V2lkZ2V0QW5ub3RhdGlvbiA6aXMoaW5wdXQsdGV4dGFyZWEpOmhvdmVyLC5hbm5vdGF0aW9uTGF5ZXIgLmNob2ljZVdpZGdldEFubm90YXRpb24gc2VsZWN0OmhvdmVyLC5hbm5vdGF0aW9uTGF5ZXIgLmJ1dHRvbldpZGdldEFubm90YXRpb24uY2hlY2tCb3ggaW5wdXQ6aG92ZXJ7CiAgICBib3JkZXItcmFkaXVzOjJweDsKICB9CgouYW5ub3RhdGlvbkxheWVyIC50ZXh0V2lkZ2V0QW5ub3RhdGlvbiA6aXMoaW5wdXQsdGV4dGFyZWEpOmZvY3VzLC5hbm5vdGF0aW9uTGF5ZXIgLmNob2ljZVdpZGdldEFubm90YXRpb24gc2VsZWN0OmZvY3VzewogICAgYmFja2dyb3VuZDpub25lOwogICAgYm9yZGVyOjJweCBzb2xpZCB2YXIoLS1pbnB1dC1mb2N1cy1ib3JkZXItY29sb3IpOwogICAgYm9yZGVyLXJhZGl1czoycHg7CiAgICBvdXRsaW5lOnZhcigtLWlucHV0LWZvY3VzLW91dGxpbmUpOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIgLmJ1dHRvbldpZGdldEFubm90YXRpb246aXMoLmNoZWNrQm94LC5yYWRpb0J1dHRvbikgOmZvY3VzewogICAgYmFja2dyb3VuZC1pbWFnZTpub25lOwogICAgYmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5idXR0b25XaWRnZXRBbm5vdGF0aW9uLmNoZWNrQm94IDpmb2N1c3sKICAgIGJvcmRlcjoycHggc29saWQgdmFyKC0taW5wdXQtZm9jdXMtYm9yZGVyLWNvbG9yKTsKICAgIGJvcmRlci1yYWRpdXM6MnB4OwogICAgb3V0bGluZTp2YXIoLS1pbnB1dC1mb2N1cy1vdXRsaW5lKTsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5idXR0b25XaWRnZXRBbm5vdGF0aW9uLnJhZGlvQnV0dG9uIDpmb2N1c3sKICAgIGJvcmRlcjoycHggc29saWQgdmFyKC0taW5wdXQtZm9jdXMtYm9yZGVyLWNvbG9yKTsKICAgIG91dGxpbmU6dmFyKC0taW5wdXQtZm9jdXMtb3V0bGluZSk7CiAgfQoKLmFubm90YXRpb25MYXllciAuYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbi5jaGVja0JveCBpbnB1dDpjaGVja2VkOjpiZWZvcmUsLmFubm90YXRpb25MYXllciAuYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbi5jaGVja0JveCBpbnB1dDpjaGVja2VkOjphZnRlciwuYW5ub3RhdGlvbkxheWVyIC5idXR0b25XaWRnZXRBbm5vdGF0aW9uLnJhZGlvQnV0dG9uIGlucHV0OmNoZWNrZWQ6OmJlZm9yZXsKICAgIGJhY2tncm91bmQtY29sb3I6Q2FudmFzVGV4dDsKICAgIGNvbnRlbnQ6IiI7CiAgICBkaXNwbGF5OmJsb2NrOwogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgfQoKLmFubm90YXRpb25MYXllciAuYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbi5jaGVja0JveCBpbnB1dDpjaGVja2VkOjpiZWZvcmUsLmFubm90YXRpb25MYXllciAuYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbi5jaGVja0JveCBpbnB1dDpjaGVja2VkOjphZnRlcnsKICAgIGhlaWdodDo4MCU7CiAgICBsZWZ0OjQ1JTsKICAgIHdpZHRoOjFweDsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5idXR0b25XaWRnZXRBbm5vdGF0aW9uLmNoZWNrQm94IGlucHV0OmNoZWNrZWQ6OmJlZm9yZXsKICAgIHRyYW5zZm9ybTpyb3RhdGUoNDVkZWcpOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIgLmJ1dHRvbldpZGdldEFubm90YXRpb24uY2hlY2tCb3ggaW5wdXQ6Y2hlY2tlZDo6YWZ0ZXJ7CiAgICB0cmFuc2Zvcm06cm90YXRlKC00NWRlZyk7CiAgfQoKLmFubm90YXRpb25MYXllciAuYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbi5yYWRpb0J1dHRvbiBpbnB1dDpjaGVja2VkOjpiZWZvcmV7CiAgICBib3JkZXItcmFkaXVzOjUwJTsKICAgIGhlaWdodDo1MCU7CiAgICBsZWZ0OjI1JTsKICAgIHRvcDoyNSU7CiAgICB3aWR0aDo1MCU7CiAgfQoKLmFubm90YXRpb25MYXllciAudGV4dFdpZGdldEFubm90YXRpb24gaW5wdXQuY29tYnsKICAgIGZvbnQtZmFtaWx5Om1vbm9zcGFjZTsKICAgIHBhZGRpbmctbGVmdDoycHg7CiAgICBwYWRkaW5nLXJpZ2h0OjA7CiAgfQoKLmFubm90YXRpb25MYXllciAudGV4dFdpZGdldEFubm90YXRpb24gaW5wdXQuY29tYjpmb2N1c3sKICAgIHdpZHRoOjEwMyU7CiAgfQoKLmFubm90YXRpb25MYXllciAuYnV0dG9uV2lkZ2V0QW5ub3RhdGlvbjppcyguY2hlY2tCb3gsLnJhZGlvQnV0dG9uKSBpbnB1dHsKICAgIC13ZWJraXQtYXBwZWFyYW5jZTpub25lOwogICAgICAgLW1vei1hcHBlYXJhbmNlOm5vbmU7CiAgICAgICAgICAgIGFwcGVhcmFuY2U6bm9uZTsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5maWxlQXR0YWNobWVudEFubm90YXRpb24gLnBvcHVwVHJpZ2dlckFyZWF7CiAgICBoZWlnaHQ6MTAwJTsKICAgIHdpZHRoOjEwMCU7CiAgfQoKLmFubm90YXRpb25MYXllciAucG9wdXBBbm5vdGF0aW9uewogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICBmb250LXNpemU6Y2FsYyg5cHggKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKTsKICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICB3aWR0aDotbW96LW1heC1jb250ZW50OwogICAgd2lkdGg6bWF4LWNvbnRlbnQ7CiAgICBtYXgtd2lkdGg6NDUlOwogICAgaGVpZ2h0OmF1dG87CiAgfQoKLmFubm90YXRpb25MYXllciAucG9wdXB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOnJnYigyNTUgMjU1IDE1Myk7CiAgICBjb2xvcjpibGFjazsKICAgIGJveC1zaGFkb3c6MCBjYWxjKDJweCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpIGNhbGMoNXB4ICogdmFyKC0tdG90YWwtc2NhbGUtZmFjdG9yKSkgcmdiKDEzNiAxMzYgMTM2KTsKICAgIGJvcmRlci1yYWRpdXM6Y2FsYygycHggKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKTsKICAgIG91dGxpbmU6MS41cHggc29saWQgcmdiKDI1NSAyNTUgNzQpOwogICAgcGFkZGluZzpjYWxjKDZweCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpOwogICAgY3Vyc29yOnBvaW50ZXI7CiAgICBmb250Om1lc3NhZ2UtYm94OwogICAgd2hpdGUtc3BhY2U6bm9ybWFsOwogICAgd29yZC13cmFwOmJyZWFrLXdvcmQ7CiAgICBwb2ludGVyLWV2ZW50czphdXRvOwogICAgLXdlYmtpdC11c2VyLXNlbGVjdDp0ZXh0OwogICAgICAgLW1vei11c2VyLXNlbGVjdDp0ZXh0OwogICAgICAgICAgICB1c2VyLXNlbGVjdDp0ZXh0OwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIgLnBvcHVwQW5ub3RhdGlvbi5mb2N1c2VkIC5wb3B1cHsKICAgIG91dGxpbmUtd2lkdGg6M3B4OwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIgLnBvcHVwICp7CiAgICBmb250LXNpemU6Y2FsYyg5cHggKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKTsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5wb3B1cCA+IC5oZWFkZXJ7CiAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5wb3B1cCA+IC5oZWFkZXIgaDF7CiAgICBkaXNwbGF5OmlubGluZTsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5wb3B1cCA+IC5oZWFkZXIgLnBvcHVwRGF0ZXsKICAgIGRpc3BsYXk6aW5saW5lLWJsb2NrOwogICAgbWFyZ2luLWxlZnQ6Y2FsYyg1cHggKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKTsKICAgIHdpZHRoOi1tb3otZml0LWNvbnRlbnQ7CiAgICB3aWR0aDpmaXQtY29udGVudDsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5wb3B1cENvbnRlbnR7CiAgICBib3JkZXItdG9wOjFweCBzb2xpZCByZ2IoNTEgNTEgNTEpOwogICAgbWFyZ2luLXRvcDpjYWxjKDJweCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpOwogICAgcGFkZGluZy10b3A6Y2FsYygycHggKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKTsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5yaWNoVGV4dCA+ICp7CiAgICB3aGl0ZS1zcGFjZTpwcmUtd3JhcDsKICAgIGZvbnQtc2l6ZTpjYWxjKDlweCAqIHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikpOwogIH0KCi5hbm5vdGF0aW9uTGF5ZXIgLnBvcHVwVHJpZ2dlckFyZWF7CiAgICBjdXJzb3I6cG9pbnRlcjsKICB9CgouYW5ub3RhdGlvbkxheWVyIHNlY3Rpb24gc3ZnewogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICB3aWR0aDoxMDAlOwogICAgaGVpZ2h0OjEwMCU7CiAgICB0b3A6MDsKICAgIGxlZnQ6MDsKICB9CgouYW5ub3RhdGlvbkxheWVyIC5hbm5vdGF0aW9uVGV4dENvbnRlbnR7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIHdpZHRoOjEwMCU7CiAgICBoZWlnaHQ6MTAwJTsKICAgIG9wYWNpdHk6MDsKICAgIGNvbG9yOnRyYW5zcGFyZW50OwogICAgLXdlYmtpdC11c2VyLXNlbGVjdDpub25lOwogICAgICAgLW1vei11c2VyLXNlbGVjdDpub25lOwogICAgICAgICAgICB1c2VyLXNlbGVjdDpub25lOwogICAgcG9pbnRlci1ldmVudHM6bm9uZTsKICB9Cgo6aXMoLmFubm90YXRpb25MYXllciAuYW5ub3RhdGlvblRleHRDb250ZW50KSBzcGFuewogICAgICB3aWR0aDoxMDAlOwogICAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICAgIH0KCi5hbm5vdGF0aW9uTGF5ZXIgc3ZnLnF1YWRyaWxhdGVyYWxzQ29udGFpbmVyewogICAgY29udGFpbjpzdHJpY3Q7CiAgICB3aWR0aDowOwogICAgaGVpZ2h0OjA7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIHRvcDowOwogICAgbGVmdDowOwogICAgei1pbmRleDotMTsKICB9Cgo6cm9vdHsKICAtLXhmYS11bmZvY3VzZWQtZmllbGQtYmFja2dyb3VuZDp1cmwoImRhdGE6aW1hZ2Uvc3ZnK3htbDtjaGFyc2V0PVVURi04LDxzdmcgd2lkdGg9JzFweCcgaGVpZ2h0PScxcHgnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgc3R5bGU9J2ZpbGw6cmdiYSgwLCA1NCwgMjU1LCAwLjEzKTsnLz48L3N2Zz4iKTsKICAtLXhmYS1mb2N1cy1vdXRsaW5lOmF1dG87Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewogIDpyb290ewogICAgLS14ZmEtZm9jdXMtb3V0bGluZToycHggc29saWQgQ2FudmFzVGV4dDsKICB9CiAgLnhmYUxheWVyICo6cmVxdWlyZWR7CiAgICBvdXRsaW5lOjEuNXB4IHNvbGlkIHNlbGVjdGVkSXRlbTsKICB9Cn0KCi54ZmFMYXllcnsKICAtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQ6aW5pdGlhbDsKICBjb2xvci1zY2hlbWU6b25seSBsaWdodDsKCiAgYmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDsKfQoKLnhmYUxheWVyIC5oaWdobGlnaHR7CiAgbWFyZ2luOi0xcHg7CiAgcGFkZGluZzoxcHg7CiAgYmFja2dyb3VuZC1jb2xvcjpyZ2IoMjM5IDIwMyAyMzcpOwogIGJvcmRlci1yYWRpdXM6NHB4Owp9CgoueGZhTGF5ZXIgLmhpZ2hsaWdodC5hcHBlbmRlZHsKICBwb3NpdGlvbjppbml0aWFsOwp9CgoueGZhTGF5ZXIgLmhpZ2hsaWdodC5iZWdpbnsKICBib3JkZXItcmFkaXVzOjRweCAwIDAgNHB4Owp9CgoueGZhTGF5ZXIgLmhpZ2hsaWdodC5lbmR7CiAgYm9yZGVyLXJhZGl1czowIDRweCA0cHggMDsKfQoKLnhmYUxheWVyIC5oaWdobGlnaHQubWlkZGxlewogIGJvcmRlci1yYWRpdXM6MDsKfQoKLnhmYUxheWVyIC5oaWdobGlnaHQuc2VsZWN0ZWR7CiAgYmFja2dyb3VuZC1jb2xvcjpyZ2IoMjAzIDIyMyAyMDMpOwp9CgoueGZhUGFnZXsKICBvdmVyZmxvdzpoaWRkZW47CiAgcG9zaXRpb246cmVsYXRpdmU7Cn0KCi54ZmFDb250ZW50YXJlYXsKICBwb3NpdGlvbjphYnNvbHV0ZTsKfQoKLnhmYVByaW50T25seXsKICBkaXNwbGF5Om5vbmU7Cn0KCi54ZmFMYXllcnsKICBwb3NpdGlvbjphYnNvbHV0ZTsKICB0ZXh0LWFsaWduOmluaXRpYWw7CiAgdG9wOjA7CiAgbGVmdDowOwogIHRyYW5zZm9ybS1vcmlnaW46MCAwOwogIGxpbmUtaGVpZ2h0OjEuMjsKfQoKLnhmYUxheWVyICp7CiAgY29sb3I6aW5oZXJpdDsKICBmb250OmluaGVyaXQ7CiAgZm9udC1zdHlsZTppbmhlcml0OwogIGZvbnQtd2VpZ2h0OmluaGVyaXQ7CiAgZm9udC1rZXJuaW5nOmluaGVyaXQ7CiAgbGV0dGVyLXNwYWNpbmc6LTAuMDFweDsKICB0ZXh0LWFsaWduOmluaGVyaXQ7CiAgdGV4dC1kZWNvcmF0aW9uOmluaGVyaXQ7CiAgYm94LXNpemluZzpib3JkZXItYm94OwogIGJhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7CiAgcGFkZGluZzowOwogIG1hcmdpbjowOwogIHBvaW50ZXItZXZlbnRzOmF1dG87CiAgbGluZS1oZWlnaHQ6aW5oZXJpdDsKfQoKLnhmYUxheWVyICo6cmVxdWlyZWR7CiAgb3V0bGluZToxLjVweCBzb2xpZCByZWQ7Cn0KCi54ZmFMYXllciBkaXYsCi54ZmFMYXllciBzdmcsCi54ZmFMYXllciBzdmcgKnsKICBwb2ludGVyLWV2ZW50czpub25lOwp9CgoueGZhTGF5ZXIgYXsKICBjb2xvcjpibHVlOwp9CgoueGZhUmljaCBsaXsKICBtYXJnaW4tbGVmdDozZW07Cn0KCi54ZmFGb250ewogIGNvbG9yOmJsYWNrOwogIGZvbnQtd2VpZ2h0Om5vcm1hbDsKICBmb250LWtlcm5pbmc6bm9uZTsKICBmb250LXNpemU6MTBweDsKICBmb250LXN0eWxlOm5vcm1hbDsKICBsZXR0ZXItc3BhY2luZzowOwogIHRleHQtZGVjb3JhdGlvbjpub25lOwogIHZlcnRpY2FsLWFsaWduOjA7Cn0KCi54ZmFDYXB0aW9uewogIG92ZXJmbG93OmhpZGRlbjsKICBmbGV4OjAgMCBhdXRvOwp9CgoueGZhQ2FwdGlvbkZvckNoZWNrQnV0dG9uewogIG92ZXJmbG93OmhpZGRlbjsKICBmbGV4OjEgMSBhdXRvOwp9CgoueGZhTGFiZWx7CiAgaGVpZ2h0OjEwMCU7CiAgd2lkdGg6MTAwJTsKfQoKLnhmYUxlZnR7CiAgZGlzcGxheTpmbGV4OwogIGZsZXgtZGlyZWN0aW9uOnJvdzsKICBhbGlnbi1pdGVtczpjZW50ZXI7Cn0KCi54ZmFSaWdodHsKICBkaXNwbGF5OmZsZXg7CiAgZmxleC1kaXJlY3Rpb246cm93LXJldmVyc2U7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwp9Cgo6aXMoLnhmYUxlZnQsIC54ZmFSaWdodCkgPiA6aXMoLnhmYUNhcHRpb24sIC54ZmFDYXB0aW9uRm9yQ2hlY2tCdXR0b24pewogIG1heC1oZWlnaHQ6MTAwJTsKfQoKLnhmYVRvcHsKICBkaXNwbGF5OmZsZXg7CiAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwogIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7Cn0KCi54ZmFCb3R0b217CiAgZGlzcGxheTpmbGV4OwogIGZsZXgtZGlyZWN0aW9uOmNvbHVtbi1yZXZlcnNlOwogIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7Cn0KCjppcygueGZhVG9wLCAueGZhQm90dG9tKSA+IDppcygueGZhQ2FwdGlvbiwgLnhmYUNhcHRpb25Gb3JDaGVja0J1dHRvbil7CiAgd2lkdGg6MTAwJTsKfQoKLnhmYUJvcmRlcnsKICBiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50OwogIHBvc2l0aW9uOmFic29sdXRlOwogIHBvaW50ZXItZXZlbnRzOm5vbmU7Cn0KCi54ZmFXcmFwcGVkewogIHdpZHRoOjEwMCU7CiAgaGVpZ2h0OjEwMCU7Cn0KCjppcygueGZhVGV4dGZpZWxkLCAueGZhU2VsZWN0KTpmb2N1c3sKICBiYWNrZ3JvdW5kLWltYWdlOm5vbmU7CiAgYmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDsKICBvdXRsaW5lOnZhcigtLXhmYS1mb2N1cy1vdXRsaW5lKTsKICBvdXRsaW5lLW9mZnNldDotMXB4Owp9Cgo6aXMoLnhmYUNoZWNrYm94LCAueGZhUmFkaW8pOmZvY3VzewogIG91dGxpbmU6dmFyKC0teGZhLWZvY3VzLW91dGxpbmUpOwp9CgoueGZhVGV4dGZpZWxkLAoueGZhU2VsZWN0ewogIGhlaWdodDoxMDAlOwogIHdpZHRoOjEwMCU7CiAgZmxleDoxIDEgYXV0bzsKICBib3JkZXI6bm9uZTsKICByZXNpemU6bm9uZTsKICBiYWNrZ3JvdW5kLWltYWdlOnZhcigtLXhmYS11bmZvY3VzZWQtZmllbGQtYmFja2dyb3VuZCk7Cn0KCi54ZmFTZWxlY3R7CiAgcGFkZGluZy1pbmxpbmU6MnB4Owp9Cgo6aXMoLnhmYVRvcCwgLnhmYUJvdHRvbSkgPiA6aXMoLnhmYVRleHRmaWVsZCwgLnhmYVNlbGVjdCl7CiAgZmxleDowIDEgYXV0bzsKfQoKLnhmYUJ1dHRvbnsKICBjdXJzb3I6cG9pbnRlcjsKICB3aWR0aDoxMDAlOwogIGhlaWdodDoxMDAlOwogIGJvcmRlcjpub25lOwogIHRleHQtYWxpZ246Y2VudGVyOwp9CgoueGZhTGlua3sKICB3aWR0aDoxMDAlOwogIGhlaWdodDoxMDAlOwogIHBvc2l0aW9uOmFic29sdXRlOwogIHRvcDowOwogIGxlZnQ6MDsKfQoKLnhmYUNoZWNrYm94LAoueGZhUmFkaW97CiAgd2lkdGg6MTAwJTsKICBoZWlnaHQ6MTAwJTsKICBmbGV4OjAgMCBhdXRvOwogIGJvcmRlcjpub25lOwp9CgoueGZhUmljaHsKICB3aGl0ZS1zcGFjZTpwcmUtd3JhcDsKICB3aWR0aDoxMDAlOwogIGhlaWdodDoxMDAlOwp9CgoueGZhSW1hZ2V7CiAgLW8tb2JqZWN0LXBvc2l0aW9uOmxlZnQgdG9wOwogICAgIG9iamVjdC1wb3NpdGlvbjpsZWZ0IHRvcDsKICAtby1vYmplY3QtZml0OmNvbnRhaW47CiAgICAgb2JqZWN0LWZpdDpjb250YWluOwogIHdpZHRoOjEwMCU7CiAgaGVpZ2h0OjEwMCU7Cn0KCi54ZmFMclRiLAoueGZhUmxUYiwKLnhmYVRiewogIGRpc3BsYXk6ZmxleDsKICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgYWxpZ24taXRlbXM6c3RyZXRjaDsKfQoKLnhmYUxyewogIGRpc3BsYXk6ZmxleDsKICBmbGV4LWRpcmVjdGlvbjpyb3c7CiAgYWxpZ24taXRlbXM6c3RyZXRjaDsKfQoKLnhmYVJsewogIGRpc3BsYXk6ZmxleDsKICBmbGV4LWRpcmVjdGlvbjpyb3ctcmV2ZXJzZTsKICBhbGlnbi1pdGVtczpzdHJldGNoOwp9CgoueGZhVGIgPiBkaXZ7CiAganVzdGlmeS1jb250ZW50OmxlZnQ7Cn0KCi54ZmFQb3NpdGlvbnsKICBwb3NpdGlvbjpyZWxhdGl2ZTsKfQoKLnhmYUFyZWF7CiAgcG9zaXRpb246cmVsYXRpdmU7Cn0KCi54ZmFWYWxpZ25NaWRkbGV7CiAgZGlzcGxheTpmbGV4OwogIGFsaWduLWl0ZW1zOmNlbnRlcjsKfQoKLnhmYVRhYmxlewogIGRpc3BsYXk6ZmxleDsKICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgYWxpZ24taXRlbXM6c3RyZXRjaDsKfQoKLnhmYVRhYmxlIC54ZmFSb3d7CiAgZGlzcGxheTpmbGV4OwogIGZsZXgtZGlyZWN0aW9uOnJvdzsKICBhbGlnbi1pdGVtczpzdHJldGNoOwp9CgoueGZhVGFibGUgLnhmYVJsUm93ewogIGRpc3BsYXk6ZmxleDsKICBmbGV4LWRpcmVjdGlvbjpyb3ctcmV2ZXJzZTsKICBhbGlnbi1pdGVtczpzdHJldGNoOwogIGZsZXg6MTsKfQoKLnhmYVRhYmxlIC54ZmFSbFJvdyA+IGRpdnsKICBmbGV4OjE7Cn0KCjppcygueGZhTm9uSW50ZXJhY3RpdmUsIC54ZmFEaXNhYmxlZCwgLnhmYVJlYWRPbmx5KSA6aXMoaW5wdXQsIHRleHRhcmVhKXsKICBiYWNrZ3JvdW5kOmluaXRpYWw7Cn0KCkBtZWRpYSBwcmludHsKICAueGZhVGV4dGZpZWxkLAogIC54ZmFTZWxlY3R7CiAgICBiYWNrZ3JvdW5kOnRyYW5zcGFyZW50OwogIH0KCiAgLnhmYVNlbGVjdHsKICAgIC13ZWJraXQtYXBwZWFyYW5jZTpub25lOwogICAgICAgLW1vei1hcHBlYXJhbmNlOm5vbmU7CiAgICAgICAgICAgIGFwcGVhcmFuY2U6bm9uZTsKICAgIHRleHQtaW5kZW50OjFweDsKICAgIHRleHQtb3ZlcmZsb3c6IiI7CiAgfQp9CgouY2FudmFzV3JhcHBlciBzdmd7CiAgICB0cmFuc2Zvcm06bm9uZTsKICB9CgoubW92aW5nOmlzKC5jYW52YXNXcmFwcGVyIHN2Zyl7CiAgICAgIHotaW5kZXg6MTAwMDAwOwogICAgfQoKW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXTppcyguaGlnaGxpZ2h0OmlzKC5jYW52YXNXcmFwcGVyIHN2ZyksLmhpZ2hsaWdodE91dGxpbmU6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKSkgbWFzayxbZGF0YS1tYWluLXJvdGF0aW9uPSI5MCJdOmlzKC5oaWdobGlnaHQ6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKSwuaGlnaGxpZ2h0T3V0bGluZTppcyguY2FudmFzV3JhcHBlciBzdmcpKSB1c2U6bm90KC5jbGlwLC5tYXNrKXsKICAgICAgICAgIHRyYW5zZm9ybTptYXRyaXgoMCwgMSwgLTEsIDAsIDEsIDApOwogICAgICAgIH0KCltkYXRhLW1haW4tcm90YXRpb249IjE4MCJdOmlzKC5oaWdobGlnaHQ6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKSwuaGlnaGxpZ2h0T3V0bGluZTppcyguY2FudmFzV3JhcHBlciBzdmcpKSBtYXNrLFtkYXRhLW1haW4tcm90YXRpb249IjE4MCJdOmlzKC5oaWdobGlnaHQ6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKSwuaGlnaGxpZ2h0T3V0bGluZTppcyguY2FudmFzV3JhcHBlciBzdmcpKSB1c2U6bm90KC5jbGlwLC5tYXNrKXsKICAgICAgICAgIHRyYW5zZm9ybTptYXRyaXgoLTEsIDAsIDAsIC0xLCAxLCAxKTsKICAgICAgICB9CgpbZGF0YS1tYWluLXJvdGF0aW9uPSIyNzAiXTppcyguaGlnaGxpZ2h0OmlzKC5jYW52YXNXcmFwcGVyIHN2ZyksLmhpZ2hsaWdodE91dGxpbmU6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKSkgbWFzayxbZGF0YS1tYWluLXJvdGF0aW9uPSIyNzAiXTppcyguaGlnaGxpZ2h0OmlzKC5jYW52YXNXcmFwcGVyIHN2ZyksLmhpZ2hsaWdodE91dGxpbmU6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKSkgdXNlOm5vdCguY2xpcCwubWFzayl7CiAgICAgICAgICB0cmFuc2Zvcm06bWF0cml4KDAsIC0xLCAxLCAwLCAwLCAxKTsKICAgICAgICB9CgouZHJhdzppcyguY2FudmFzV3JhcHBlciBzdmcpewogICAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgICAgbWl4LWJsZW5kLW1vZGU6bm9ybWFsOwogICAgfQoKLmRyYXdbZGF0YS1kcmF3LXJvdGF0aW9uPSI5MCJdOmlzKC5jYW52YXNXcmFwcGVyIHN2Zyl7CiAgICAgICAgdHJhbnNmb3JtOnJvdGF0ZSg5MGRlZyk7CiAgICAgIH0KCi5kcmF3W2RhdGEtZHJhdy1yb3RhdGlvbj0iMTgwIl06aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKXsKICAgICAgICB0cmFuc2Zvcm06cm90YXRlKDE4MGRlZyk7CiAgICAgIH0KCi5kcmF3W2RhdGEtZHJhdy1yb3RhdGlvbj0iMjcwIl06aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKXsKICAgICAgICB0cmFuc2Zvcm06cm90YXRlKDI3MGRlZyk7CiAgICAgIH0KCi5oaWdobGlnaHQ6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKXsKICAgICAgLS1ibGVuZC1tb2RlOm11bHRpcGx5OwogICAgfQoKQG1lZGlhIHNjcmVlbiBhbmQgKGZvcmNlZC1jb2xvcnM6IGFjdGl2ZSl7CgouaGlnaGxpZ2h0OmlzKC5jYW52YXNXcmFwcGVyIHN2Zyl7CiAgICAgICAgLS1ibGVuZC1tb2RlOmRpZmZlcmVuY2U7CiAgICB9CiAgICAgIH0KCi5oaWdobGlnaHQ6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKXsKCiAgICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgICBtaXgtYmxlbmQtbW9kZTp2YXIoLS1ibGVuZC1tb2RlKTsKICAgIH0KCi5oaWdobGlnaHQ6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKTpub3QoLmZyZWUpewogICAgICAgIGZpbGwtcnVsZTpldmVub2RkOwogICAgICB9CgouaGlnaGxpZ2h0T3V0bGluZTppcyguY2FudmFzV3JhcHBlciBzdmcpewogICAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgICAgbWl4LWJsZW5kLW1vZGU6bm9ybWFsOwogICAgICBmaWxsLXJ1bGU6ZXZlbm9kZDsKICAgICAgZmlsbDpub25lOwogICAgfQoKLmhpZ2hsaWdodE91dGxpbmUuaG92ZXJlZDppcyguY2FudmFzV3JhcHBlciBzdmcpOm5vdCguZnJlZSk6bm90KC5zZWxlY3RlZCl7CiAgICAgICAgICBzdHJva2U6dmFyKC0taG92ZXItb3V0bGluZS1jb2xvcik7CiAgICAgICAgICBzdHJva2Utd2lkdGg6dmFyKC0tb3V0bGluZS13aWR0aCk7CiAgICAgICAgfQoKLmhpZ2hsaWdodE91dGxpbmUuc2VsZWN0ZWQ6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKTpub3QoLmZyZWUpIC5tYWluT3V0bGluZXsKICAgICAgICAgICAgc3Ryb2tlOnZhcigtLW91dGxpbmUtYXJvdW5kLWNvbG9yKTsKICAgICAgICAgICAgc3Ryb2tlLXdpZHRoOmNhbGMoCiAgICAgICAgICAgICAgdmFyKC0tb3V0bGluZS13aWR0aCkgKyAyICogdmFyKC0tb3V0bGluZS1hcm91bmQtd2lkdGgpCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CgouaGlnaGxpZ2h0T3V0bGluZS5zZWxlY3RlZDppcyguY2FudmFzV3JhcHBlciBzdmcpOm5vdCguZnJlZSkgLnNlY29uZGFyeU91dGxpbmV7CiAgICAgICAgICAgIHN0cm9rZTp2YXIoLS1vdXRsaW5lLWNvbG9yKTsKICAgICAgICAgICAgc3Ryb2tlLXdpZHRoOnZhcigtLW91dGxpbmUtd2lkdGgpOwogICAgICAgICAgfQoKLmhpZ2hsaWdodE91dGxpbmUuZnJlZS5ob3ZlcmVkOmlzKC5jYW52YXNXcmFwcGVyIHN2Zyk6bm90KC5zZWxlY3RlZCl7CiAgICAgICAgICBzdHJva2U6dmFyKC0taG92ZXItb3V0bGluZS1jb2xvcik7CiAgICAgICAgICBzdHJva2Utd2lkdGg6Y2FsYygyICogdmFyKC0tb3V0bGluZS13aWR0aCkpOwogICAgICAgIH0KCi5oaWdobGlnaHRPdXRsaW5lLmZyZWUuc2VsZWN0ZWQ6aXMoLmNhbnZhc1dyYXBwZXIgc3ZnKSAubWFpbk91dGxpbmV7CiAgICAgICAgICAgIHN0cm9rZTp2YXIoLS1vdXRsaW5lLWFyb3VuZC1jb2xvcik7CiAgICAgICAgICAgIHN0cm9rZS13aWR0aDpjYWxjKAogICAgICAgICAgICAgIDIgKiAodmFyKC0tb3V0bGluZS13aWR0aCkgKyB2YXIoLS1vdXRsaW5lLWFyb3VuZC13aWR0aCkpCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CgouaGlnaGxpZ2h0T3V0bGluZS5mcmVlLnNlbGVjdGVkOmlzKC5jYW52YXNXcmFwcGVyIHN2ZykgLnNlY29uZGFyeU91dGxpbmV7CiAgICAgICAgICAgIHN0cm9rZTp2YXIoLS1vdXRsaW5lLWNvbG9yKTsKICAgICAgICAgICAgc3Ryb2tlLXdpZHRoOmNhbGMoMiAqIHZhcigtLW91dGxpbmUtd2lkdGgpKTsKICAgICAgICAgIH0KCi50b2dnbGUtYnV0dG9uewogIC0tYnV0dG9uLWJhY2tncm91bmQtY29sb3I6Y29sb3ItbWl4KGluIHNyZ2IsIGN1cnJlbnRDb2xvciA3JSwgdHJhbnNwYXJlbnQpOwogIC0tYnV0dG9uLWJhY2tncm91bmQtY29sb3ItaG92ZXI6Y29sb3ItbWl4KAogICAgaW4gc3JnYiwKICAgIGN1cnJlbnRDb2xvciAxNCUsCiAgICB0cmFuc3BhcmVudAogICk7CiAgLS1idXR0b24tYmFja2dyb3VuZC1jb2xvci1hY3RpdmU6Y29sb3ItbWl4KAogICAgaW4gc3JnYiwKICAgIGN1cnJlbnRDb2xvciAyMSUsCiAgICB0cmFuc3BhcmVudAogICk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjY6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzBkZjsKICAtLWNvbG9yLWFjY2VudC1wcmltYXJ5OnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02NiwgIzAwNjBkZik7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjc6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzgwZWJmZjsKICAtLWNvbG9yLWFjY2VudC1wcmltYXJ5LWhvdmVyOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02NywgIzAyNTBiYik7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2FhZjJmZjsKICAtLWNvbG9yLWFjY2VudC1wcmltYXJ5LWFjdGl2ZTp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjgsICMwNTQwOTYpOwogIC0tYm9yZGVyLXJhZGl1cy1jaXJjbGU6OTk5OXB4OwogIC0tYm9yZGVyLXdpZHRoOjFweDsKICAtLXNpemUtaXRlbS1zbWFsbDoxNnB4OwogIC0tc2l6ZS1pdGVtLWxhcmdlOjMycHg7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjk6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzFjMWIyMjsKICAtLWNvbG9yLWNhbnZhczp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjksIHdoaXRlKTsKICAtLWJhY2tncm91bmQtY29sb3ItY2FudmFzOnZhcigtLWNvbG9yLWNhbnZhcyk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzA6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2Y5ZjlmYTsKICAtLWJvcmRlci1jb2xvci1pbnRlcmFjdGl2ZTp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzAsICM4ZjhmOWQpOwogIC0tYm9yZGVyLWNvbG9yLWludGVyYWN0aXZlLWhvdmVyOnZhcigtLWJvcmRlci1jb2xvci1pbnRlcmFjdGl2ZSk7CiAgLS1ib3JkZXItY29sb3ItaW50ZXJhY3RpdmUtYWN0aXZlOnZhcigtLWJvcmRlci1jb2xvci1pbnRlcmFjdGl2ZSk7Cn0KCkBzdXBwb3J0cyAoY29sb3I6IGxpZ2h0LWRhcmsocmVkLCByZWQpKXsKLnRvZ2dsZS1idXR0b257CiAgLS1jb2xvci1hY2NlbnQtcHJpbWFyeTpsaWdodC1kYXJrKCMwMDYwZGYsICMwZGYpOwogIC0tY29sb3ItYWNjZW50LXByaW1hcnktaG92ZXI6bGlnaHQtZGFyaygjMDI1MGJiLCAjODBlYmZmKTsKICAtLWNvbG9yLWFjY2VudC1wcmltYXJ5LWFjdGl2ZTpsaWdodC1kYXJrKCMwNTQwOTYsICNhYWYyZmYpOwogIC0tY29sb3ItY2FudmFzOmxpZ2h0LWRhcmsod2hpdGUsICMxYzFiMjIpOwogIC0tYm9yZGVyLWNvbG9yLWludGVyYWN0aXZlOmxpZ2h0LWRhcmsoIzhmOGY5ZCwgI2Y5ZjlmYSk7Cn0KfQoKQHN1cHBvcnRzIG5vdCAoY29sb3I6IGxpZ2h0LWRhcmsodGFuLCB0YW4pKXsKCi50b2dnbGUtYnV0dG9uICp7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjY6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzBkZjsKICAtLWNvbG9yLWFjY2VudC1wcmltYXJ5OnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02NiwgIzAwNjBkZik7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjc6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzgwZWJmZjsKICAtLWNvbG9yLWFjY2VudC1wcmltYXJ5LWhvdmVyOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02NywgIzAyNTBiYik7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2FhZjJmZjsKICAtLWNvbG9yLWFjY2VudC1wcmltYXJ5LWFjdGl2ZTp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjgsICMwNTQwOTYpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTY5OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICMxYzFiMjI7CiAgLS1jb2xvci1jYW52YXM6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTY5LCB3aGl0ZSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzA6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2Y5ZjlmYTsKICAtLWJvcmRlci1jb2xvci1pbnRlcmFjdGl2ZTp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzAsICM4ZjhmOWQpOwogIH0KfQoKQG1lZGlhIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKLnRvZ2dsZS1idXR0b257CiAgICAtLWNvbG9yLWFjY2VudC1wcmltYXJ5OkJ1dHRvblRleHQ7CiAgICAtLWNvbG9yLWFjY2VudC1wcmltYXJ5LWhvdmVyOlNlbGVjdGVkSXRlbTsKICAgIC0tY29sb3ItYWNjZW50LXByaW1hcnktYWN0aXZlOlNlbGVjdGVkSXRlbTsKICAgIC0tYnV0dG9uLWJhY2tncm91bmQtY29sb3I6QnV0dG9uRmFjZTsKICAgIC0tYm9yZGVyLWNvbG9yLWludGVyYWN0aXZlOkJ1dHRvblRleHQ7CiAgICAtLWJvcmRlci1jb2xvci1pbnRlcmFjdGl2ZS1ob3ZlcjpTZWxlY3RlZEl0ZW07CiAgICAtLWJvcmRlci1jb2xvci1pbnRlcmFjdGl2ZS1hY3RpdmU6QnV0dG9uVGV4dDsKICAgIC0tY29sb3ItY2FudmFzOkJ1dHRvblRleHQ7CiAgICAtLWJhY2tncm91bmQtY29sb3ItY2FudmFzOkNhbnZhczsKfQogIH0KCi50b2dnbGUtYnV0dG9uewogIC0tdG9nZ2xlLWJhY2tncm91bmQtY29sb3I6dmFyKC0tYnV0dG9uLWJhY2tncm91bmQtY29sb3IpOwogIC0tdG9nZ2xlLWJhY2tncm91bmQtY29sb3ItaG92ZXI6dmFyKC0tYnV0dG9uLWJhY2tncm91bmQtY29sb3ItaG92ZXIpOwogIC0tdG9nZ2xlLWJhY2tncm91bmQtY29sb3ItYWN0aXZlOnZhcigtLWJ1dHRvbi1iYWNrZ3JvdW5kLWNvbG9yLWFjdGl2ZSk7CiAgLS10b2dnbGUtYmFja2dyb3VuZC1jb2xvci1wcmVzc2VkOnZhcigtLWNvbG9yLWFjY2VudC1wcmltYXJ5KTsKICAtLXRvZ2dsZS1iYWNrZ3JvdW5kLWNvbG9yLXByZXNzZWQtaG92ZXI6dmFyKC0tY29sb3ItYWNjZW50LXByaW1hcnktaG92ZXIpOwogIC0tdG9nZ2xlLWJhY2tncm91bmQtY29sb3ItcHJlc3NlZC1hY3RpdmU6dmFyKC0tY29sb3ItYWNjZW50LXByaW1hcnktYWN0aXZlKTsKICAtLXRvZ2dsZS1ib3JkZXItY29sb3I6dmFyKC0tYm9yZGVyLWNvbG9yLWludGVyYWN0aXZlKTsKICAtLXRvZ2dsZS1ib3JkZXItY29sb3ItaG92ZXI6dmFyKC0tdG9nZ2xlLWJvcmRlci1jb2xvcik7CiAgLS10b2dnbGUtYm9yZGVyLWNvbG9yLWFjdGl2ZTp2YXIoLS10b2dnbGUtYm9yZGVyLWNvbG9yKTsKICAtLXRvZ2dsZS1ib3JkZXItcmFkaXVzOnZhcigtLWJvcmRlci1yYWRpdXMtY2lyY2xlKTsKICAtLXRvZ2dsZS1ib3JkZXItd2lkdGg6dmFyKC0tYm9yZGVyLXdpZHRoKTsKICAtLXRvZ2dsZS1oZWlnaHQ6dmFyKC0tc2l6ZS1pdGVtLXNtYWxsKTsKICAtLXRvZ2dsZS13aWR0aDp2YXIoLS1zaXplLWl0ZW0tbGFyZ2UpOwogIC0tdG9nZ2xlLWRvdC1iYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRvZ2dsZS1ib3JkZXItY29sb3IpOwogIC0tdG9nZ2xlLWRvdC1iYWNrZ3JvdW5kLWNvbG9yLWhvdmVyOnZhcigtLXRvZ2dsZS1kb3QtYmFja2dyb3VuZC1jb2xvcik7CiAgLS10b2dnbGUtZG90LWJhY2tncm91bmQtY29sb3ItYWN0aXZlOnZhcigtLXRvZ2dsZS1kb3QtYmFja2dyb3VuZC1jb2xvcik7CiAgLS10b2dnbGUtZG90LWJhY2tncm91bmQtY29sb3Itb24tcHJlc3NlZDp2YXIoLS1iYWNrZ3JvdW5kLWNvbG9yLWNhbnZhcyk7CiAgLS10b2dnbGUtZG90LW1hcmdpbjoxcHg7CiAgLS10b2dnbGUtZG90LWhlaWdodDpjYWxjKAogICAgdmFyKC0tdG9nZ2xlLWhlaWdodCkgLSAyICogdmFyKC0tdG9nZ2xlLWRvdC1tYXJnaW4pIC0gMiAqCiAgICAgIHZhcigtLXRvZ2dsZS1ib3JkZXItd2lkdGgpCiAgKTsKICAtLXRvZ2dsZS1kb3Qtd2lkdGg6dmFyKC0tdG9nZ2xlLWRvdC1oZWlnaHQpOwogIC0tdG9nZ2xlLWRvdC10cmFuc2Zvcm0teDpjYWxjKAogICAgdmFyKC0tdG9nZ2xlLXdpZHRoKSAtIDQgKiB2YXIoLS10b2dnbGUtZG90LW1hcmdpbikgLSB2YXIoLS10b2dnbGUtZG90LXdpZHRoKQogICk7CiAgLS1pbnB1dC13aWR0aDp2YXIoLS10b2dnbGUtd2lkdGgpOwoKICAtd2Via2l0LWFwcGVhcmFuY2U6bm9uZTsKCiAgICAgLW1vei1hcHBlYXJhbmNlOm5vbmU7CgogICAgICAgICAgYXBwZWFyYW5jZTpub25lOwogIHBhZGRpbmc6MDsKICBib3JkZXI6dmFyKC0tdG9nZ2xlLWJvcmRlci13aWR0aCkgc29saWQgdmFyKC0tdG9nZ2xlLWJvcmRlci1jb2xvcik7CiAgaGVpZ2h0OnZhcigtLXRvZ2dsZS1oZWlnaHQpOwogIHdpZHRoOnZhcigtLXRvZ2dsZS13aWR0aCk7CiAgYm9yZGVyLXJhZGl1czp2YXIoLS10b2dnbGUtYm9yZGVyLXJhZGl1cyk7CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b2dnbGUtYmFja2dyb3VuZC1jb2xvcik7CiAgYm94LXNpemluZzpib3JkZXItYm94Owp9CgoudG9nZ2xlLWJ1dHRvbjpmb2N1cy12aXNpYmxlewogICAgb3V0bGluZTp2YXIoLS1mb2N1cy1vdXRsaW5lKTsKICAgIG91dGxpbmUtb2Zmc2V0OnZhcigtLWZvY3VzLW91dGxpbmUtb2Zmc2V0KTsKICB9CgoudG9nZ2xlLWJ1dHRvbjplbmFibGVkOmhvdmVyewogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b2dnbGUtYmFja2dyb3VuZC1jb2xvci1ob3Zlcik7CiAgICBib3JkZXItY29sb3I6dmFyKC0tdG9nZ2xlLWJvcmRlci1jb2xvcik7CiAgfQoKLnRvZ2dsZS1idXR0b246ZW5hYmxlZDpob3ZlcjphY3RpdmV7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRvZ2dsZS1iYWNrZ3JvdW5kLWNvbG9yLWFjdGl2ZSk7CiAgICBib3JkZXItY29sb3I6dmFyKC0tdG9nZ2xlLWJvcmRlci1jb2xvcik7CiAgfQoKLnRvZ2dsZS1idXR0b246OmJlZm9yZXsKICAgIGRpc3BsYXk6YmxvY2s7CiAgICBjb250ZW50OiIiOwogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b2dnbGUtZG90LWJhY2tncm91bmQtY29sb3IpOwogICAgaGVpZ2h0OnZhcigtLXRvZ2dsZS1kb3QtaGVpZ2h0KTsKICAgIHdpZHRoOnZhcigtLXRvZ2dsZS1kb3Qtd2lkdGgpOwogICAgbWFyZ2luOnZhcigtLXRvZ2dsZS1kb3QtbWFyZ2luKTsKICAgIGJvcmRlci1yYWRpdXM6dmFyKC0tdG9nZ2xlLWJvcmRlci1yYWRpdXMpOwogICAgdHJhbnNsYXRlOjA7CiAgfQoKLnRvZ2dsZS1idXR0b25bYXJpYS1wcmVzc2VkPSJ0cnVlIl17CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b2dnbGUtYmFja2dyb3VuZC1jb2xvci1wcmVzc2VkKTsKICBib3JkZXItY29sb3I6dHJhbnNwYXJlbnQ7Cn0KCi50b2dnbGUtYnV0dG9uW2FyaWEtcHJlc3NlZD0idHJ1ZSJdOmVuYWJsZWQ6aG92ZXJ7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRvZ2dsZS1iYWNrZ3JvdW5kLWNvbG9yLXByZXNzZWQtaG92ZXIpOwogICAgYm9yZGVyLWNvbG9yOnRyYW5zcGFyZW50OwogIH0KCi50b2dnbGUtYnV0dG9uW2FyaWEtcHJlc3NlZD0idHJ1ZSJdOmVuYWJsZWQ6aG92ZXI6YWN0aXZlewogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b2dnbGUtYmFja2dyb3VuZC1jb2xvci1wcmVzc2VkLWFjdGl2ZSk7CiAgICBib3JkZXItY29sb3I6dHJhbnNwYXJlbnQ7CiAgfQoKLnRvZ2dsZS1idXR0b25bYXJpYS1wcmVzc2VkPSJ0cnVlIl06OmJlZm9yZXsKICAgIHRyYW5zbGF0ZTp2YXIoLS10b2dnbGUtZG90LXRyYW5zZm9ybS14KTsKICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tdG9nZ2xlLWRvdC1iYWNrZ3JvdW5kLWNvbG9yLW9uLXByZXNzZWQpOwogIH0KCi50b2dnbGUtYnV0dG9uW2FyaWEtcHJlc3NlZD0idHJ1ZSJdOmVuYWJsZWQ6aG92ZXI6OmJlZm9yZSwudG9nZ2xlLWJ1dHRvblthcmlhLXByZXNzZWQ9InRydWUiXTplbmFibGVkOmhvdmVyOmFjdGl2ZTo6YmVmb3JlewogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b2dnbGUtZG90LWJhY2tncm91bmQtY29sb3Itb24tcHJlc3NlZCk7CiAgfQoKLnRvZ2dsZS1idXR0b25bYXJpYS1wcmVzc2VkPSJ0cnVlIl06LW1vei1sb2NhbGUtZGlyKHJ0bCk6OmJlZm9yZSxbZGlyPSJydGwiXSAudG9nZ2xlLWJ1dHRvblthcmlhLXByZXNzZWQ9InRydWUiXTo6YmVmb3JlewogICAgdHJhbnNsYXRlOmNhbGMoLTEgKiB2YXIoLS10b2dnbGUtZG90LXRyYW5zZm9ybS14KSk7CiAgfQoKQG1lZGlhIChwcmVmZXJzLXJlZHVjZWQtbW90aW9uOiBuby1wcmVmZXJlbmNlKXsKICAudG9nZ2xlLWJ1dHRvbjo6YmVmb3JlewogICAgdHJhbnNpdGlvbjp0cmFuc2xhdGUgMTAwbXM7CiAgfQp9CgpAbWVkaWEgKHByZWZlcnMtY29udHJhc3QpewogIC50b2dnbGUtYnV0dG9uOmVuYWJsZWQ6aG92ZXJ7CiAgICBib3JkZXItY29sb3I6dmFyKC0tdG9nZ2xlLWJvcmRlci1jb2xvci1ob3Zlcik7CiAgfQoKICAudG9nZ2xlLWJ1dHRvbjplbmFibGVkOmhvdmVyOmFjdGl2ZXsKICAgIGJvcmRlci1jb2xvcjp2YXIoLS10b2dnbGUtYm9yZGVyLWNvbG9yLWFjdGl2ZSk7CiAgfQoKICAudG9nZ2xlLWJ1dHRvblthcmlhLXByZXNzZWQ9InRydWUiXTplbmFibGVkewogICAgYm9yZGVyLWNvbG9yOnZhcigtLXRvZ2dsZS1ib3JkZXItY29sb3IpOwogICAgcG9zaXRpb246cmVsYXRpdmU7CiAgfQoKICAgIC50b2dnbGUtYnV0dG9uW2FyaWEtcHJlc3NlZD0idHJ1ZSJdOmVuYWJsZWQ6aG92ZXJ7CiAgICAgIGJvcmRlci1jb2xvcjp2YXIoLS10b2dnbGUtYm9yZGVyLWNvbG9yLWhvdmVyKTsKICAgIH0KCiAgICAgIC50b2dnbGUtYnV0dG9uW2FyaWEtcHJlc3NlZD0idHJ1ZSJdOmVuYWJsZWQ6aG92ZXI6YWN0aXZlewogICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tdG9nZ2xlLWRvdC1iYWNrZ3JvdW5kLWNvbG9yLWFjdGl2ZSk7CiAgICAgICAgYm9yZGVyLWNvbG9yOnZhcigtLXRvZ2dsZS1kb3QtYmFja2dyb3VuZC1jb2xvci1ob3Zlcik7CiAgICAgIH0KCiAgLnRvZ2dsZS1idXR0b246ZW5hYmxlZDpob3Zlcjo6YmVmb3JlLAogIC50b2dnbGUtYnV0dG9uOmVuYWJsZWQ6aG92ZXI6YWN0aXZlOjpiZWZvcmV7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRvZ2dsZS1kb3QtYmFja2dyb3VuZC1jb2xvci1ob3Zlcik7CiAgfQp9CgpAbWVkaWEgKGZvcmNlZC1jb2xvcnMpewogIC50b2dnbGUtYnV0dG9uewogICAgLS10b2dnbGUtZG90LWJhY2tncm91bmQtY29sb3I6dmFyKC0tY29sb3ItYWNjZW50LXByaW1hcnkpOwogICAgLS10b2dnbGUtZG90LWJhY2tncm91bmQtY29sb3ItaG92ZXI6dmFyKC0tY29sb3ItYWNjZW50LXByaW1hcnktaG92ZXIpOwogICAgLS10b2dnbGUtZG90LWJhY2tncm91bmQtY29sb3ItYWN0aXZlOnZhcigtLWNvbG9yLWFjY2VudC1wcmltYXJ5LWFjdGl2ZSk7CiAgICAtLXRvZ2dsZS1kb3QtYmFja2dyb3VuZC1jb2xvci1vbi1wcmVzc2VkOnZhcigtLWJ1dHRvbi1iYWNrZ3JvdW5kLWNvbG9yKTsKICAgIC0tdG9nZ2xlLWJvcmRlci1jb2xvci1ob3Zlcjp2YXIoLS1ib3JkZXItY29sb3ItaW50ZXJhY3RpdmUtaG92ZXIpOwogICAgLS10b2dnbGUtYm9yZGVyLWNvbG9yLWFjdGl2ZTp2YXIoLS1ib3JkZXItY29sb3ItaW50ZXJhY3RpdmUtYWN0aXZlKTsKICB9CgogIC50b2dnbGUtYnV0dG9uW2FyaWEtcHJlc3NlZD0idHJ1ZSJdOmVuYWJsZWQ6OmFmdGVyewogICAgYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1idXR0b24tYmFja2dyb3VuZC1jb2xvcik7CiAgICBjb250ZW50OiIiOwogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICBoZWlnaHQ6dmFyKC0tdG9nZ2xlLWhlaWdodCk7CiAgICB3aWR0aDp2YXIoLS10b2dnbGUtd2lkdGgpOwogICAgZGlzcGxheTpibG9jazsKICAgIGJvcmRlci1yYWRpdXM6dmFyKC0tdG9nZ2xlLWJvcmRlci1yYWRpdXMpOwogICAgaW5zZXQ6LTJweDsKICB9CgogIC50b2dnbGUtYnV0dG9uW2FyaWEtcHJlc3NlZD0idHJ1ZSJdOmVuYWJsZWQ6aG92ZXI6YWN0aXZlOjphZnRlcnsKICAgIGJvcmRlci1jb2xvcjp2YXIoLS10b2dnbGUtYm9yZGVyLWNvbG9yLWFjdGl2ZSk7CiAgfQp9Cgo6cm9vdHsKICAtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24taWNvbjp1cmwoaW1hZ2VzL2VkaXRvci10b29sYmFyLWRlbGV0ZS5zdmcpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTcxOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICMyYjJhMzM7CiAgLS1zaWduYXR1cmUtYmc6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTcxLCAjZjlmOWZiKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03Mjp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSB2YXIoLS1zaWduYXR1cmUtYmcpOwogIC0tc2lnbmF0dXJlLWhvdmVyLWJnOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03MiwgI2YwZjBmNCk7CiAgLS1idXR0b24tc2lnbmF0dXJlLWJnOnRyYW5zcGFyZW50OwogIC0tYnV0dG9uLXNpZ25hdHVyZS1jb2xvcjp2YXIoLS1tYWluLWNvbG9yKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03Mzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNWI1YjY2OwogIC0tYnV0dG9uLXNpZ25hdHVyZS1hY3RpdmUtYmc6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTczLCAjY2ZjZmQ4KTsKICAtLWJ1dHRvbi1zaWduYXR1cmUtYWN0aXZlLWJvcmRlcjpub25lOwogIC0tYnV0dG9uLXNpZ25hdHVyZS1hY3RpdmUtY29sb3I6dmFyKC0tYnV0dG9uLXNpZ25hdHVyZS1jb2xvcik7CiAgLS1idXR0b24tc2lnbmF0dXJlLWJvcmRlcjpub25lOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTc0OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICM1MjUyNWU7CiAgLS1idXR0b24tc2lnbmF0dXJlLWhvdmVyLWJnOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03NCwgI2UwZTBlNik7CiAgLS1idXR0b24tc2lnbmF0dXJlLWhvdmVyLWNvbG9yOnZhcigtLWJ1dHRvbi1zaWduYXR1cmUtY29sb3IpOwp9CgpAc3VwcG9ydHMgKGNvbG9yOiBsaWdodC1kYXJrKHJlZCwgcmVkKSl7Cjpyb290ewogIC0tc2lnbmF0dXJlLWJnOmxpZ2h0LWRhcmsoI2Y5ZjlmYiwgIzJiMmEzMyk7CiAgLS1zaWduYXR1cmUtaG92ZXItYmc6bGlnaHQtZGFyaygjZjBmMGY0LCB2YXIoLS1zaWduYXR1cmUtYmcpKTsKICAtLWJ1dHRvbi1zaWduYXR1cmUtYWN0aXZlLWJnOmxpZ2h0LWRhcmsoI2NmY2ZkOCwgIzViNWI2Nik7CiAgLS1idXR0b24tc2lnbmF0dXJlLWhvdmVyLWJnOmxpZ2h0LWRhcmsoI2UwZTBlNiwgIzUyNTI1ZSk7Cn0KfQoKQHN1cHBvcnRzIG5vdCAoY29sb3I6IGxpZ2h0LWRhcmsodGFuLCB0YW4pKXsKCjpyb290ICp7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzE6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzJiMmEzMzsKICAtLXNpZ25hdHVyZS1iZzp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzEsICNmOWY5ZmIpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTcyOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHZhcigtLXNpZ25hdHVyZS1iZyk7CiAgLS1zaWduYXR1cmUtaG92ZXItYmc6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTcyLCAjZjBmMGY0KTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03Mzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNWI1YjY2OwogIC0tYnV0dG9uLXNpZ25hdHVyZS1hY3RpdmUtYmc6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTczLCAjY2ZjZmQ4KTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03NDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNTI1MjVlOwogIC0tYnV0dG9uLXNpZ25hdHVyZS1ob3Zlci1iZzp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzQsICNlMGUwZTYpOwogIH0KfQoKQG1lZGlhIHNjcmVlbiBhbmQgKGZvcmNlZC1jb2xvcnM6IGFjdGl2ZSl7Cgo6cm9vdHsKICAgIC0tc2lnbmF0dXJlLWJnOkhpZ2hsaWdodFRleHQ7CiAgICAtLXNpZ25hdHVyZS1ob3Zlci1iZzp2YXIoLS1zaWduYXR1cmUtYmcpOwogICAgLS1idXR0b24tc2lnbmF0dXJlLWJnOkhpZ2hsaWdodFRleHQ7CiAgICAtLWJ1dHRvbi1zaWduYXR1cmUtY29sb3I6QnV0dG9uVGV4dDsKICAgIC0tYnV0dG9uLXNpZ25hdHVyZS1hY3RpdmUtYmc6QnV0dG9uVGV4dDsKICAgIC0tYnV0dG9uLXNpZ25hdHVyZS1hY3RpdmUtY29sb3I6SGlnaGxpZ2h0VGV4dDsKICAgIC0tYnV0dG9uLXNpZ25hdHVyZS1ib3JkZXI6MXB4IHNvbGlkIEJ1dHRvblRleHQ7CiAgICAtLWJ1dHRvbi1zaWduYXR1cmUtaG92ZXItYmc6SGlnaGxpZ2h0OwogICAgLS1idXR0b24tc2lnbmF0dXJlLWhvdmVyLWNvbG9yOkhpZ2hsaWdodFRleHQ7Cn0KICB9Cgouc2lnbmF0dXJlRGlhbG9newogIC0tcHJpbWFyeS1jb2xvcjp2YXIoLS10ZXh0LXByaW1hcnktY29sb3IpOwogIC0tYm9yZGVyLWNvbG9yOiM4ZjhmOWQ7CiAgLS1vcGVuLWxpbmstZmc6dmFyKC0tbGluay1mZy1jb2xvcik7CiAgLS1vcGVuLWxpbmstaG92ZXItZmc6dmFyKC0tbGluay1ob3Zlci1mZy1jb2xvcik7Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKLnNpZ25hdHVyZURpYWxvZ3sKICAgIC0tcHJpbWFyeS1jb2xvcjpCdXR0b25UZXh0OwogICAgLS1ib3JkZXItY29sb3I6QnV0dG9uVGV4dDsKICAgIC0tb3Blbi1saW5rLWZnOkJ1dHRvblRleHQ7CiAgICAtLW9wZW4tbGluay1ob3Zlci1mZzpCdXR0b25UZXh0Owp9CiAgfQoKLnNpZ25hdHVyZURpYWxvZ3sKCiAgd2lkdGg6NTcwcHg7CiAgbWF4LXdpZHRoOjEwMCU7CiAgbWluLXdpZHRoOjMwMHB4OwogIHBhZGRpbmc6MTZweCAwOwp9Cgouc2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyewogICAgd2lkdGg6MTAwJTsKICAgIGRpc3BsYXk6ZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7CiAgICBnYXA6MTJweDsKICB9Cgo6aXMoLnNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgc3Bhbjpub3QoW3JvbGU9InNlY3Rpb25oZWFkIl0pewogICAgICBmb250LXNpemU6MTNweDsKICAgICAgZm9udC1zdHlsZTpub3JtYWw7CiAgICAgIGZvbnQtd2VpZ2h0OjQwMDsKICAgICAgbGluZS1oZWlnaHQ6bm9ybWFsOwogICAgfQoKOmlzKC5zaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpIC50aXRsZXsKICAgICAgbWFyZ2luLWlubGluZS1zdGFydDoxNnB4OwogICAgfQoKLnNpZ25hdHVyZURpYWxvZyAuaW5wdXRXaXRoQ2xlYXJCdXR0b257CiAgICAtLWJ1dHRvbi1kaW1lbnNpb246MjRweDsKICAgIC0tY2xlYXItYnV0dG9uLWljb246dXJsKGltYWdlcy9tZXNzYWdlQmFyX2Nsb3NpbmdCdXR0b24uc3ZnKTsKCiAgICB3aWR0aDoxMDAlOwogICAgcG9zaXRpb246cmVsYXRpdmU7CiAgICBkaXNwbGF5OmZsZXg7CiAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogIH0KCjppcyguc2lnbmF0dXJlRGlhbG9nIC5pbnB1dFdpdGhDbGVhckJ1dHRvbikgID4gaW5wdXR7CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGhlaWdodDozMnB4OwogICAgICBwYWRkaW5nLWlubGluZTo4cHggY2FsYyg0cHggKyB2YXIoLS1idXR0b24tZGltZW5zaW9uKSk7CiAgICAgIGJveC1zaXppbmc6Ym9yZGVyLWJveDsKICAgICAgYm9yZGVyLXJhZGl1czo0cHg7CiAgICAgIGJvcmRlcjoxcHggc29saWQgdmFyKC0tYm9yZGVyLWNvbG9yKTsKICAgIH0KCjppcyguc2lnbmF0dXJlRGlhbG9nIC5pbnB1dFdpdGhDbGVhckJ1dHRvbikgLmNsZWFySW5wdXRCdXR0b257CiAgICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgICBpbnNldC1ibG9jay1zdGFydDo0cHg7CiAgICAgIGluc2V0LWlubGluZS1lbmQ6NHB4OwogICAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICAgICAgd2lkdGg6dmFyKC0tYnV0dG9uLWRpbWVuc2lvbik7CiAgICAgIGhlaWdodDp2YXIoLS1idXR0b24tZGltZW5zaW9uKTsKICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1pbnB1dC10ZXh0LWZnLWNvbG9yKTsKICAgICAgLXdlYmtpdC1tYXNrLXNpemU6Y292ZXI7CiAgICAgICAgICAgICAgbWFzay1zaXplOmNvdmVyOwogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tY2xlYXItYnV0dG9uLWljb24pOwogICAgICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tY2xlYXItYnV0dG9uLWljb24pOwogICAgICBwYWRkaW5nOjA7CiAgICAgIGJvcmRlcjowOwogICAgfQoKI2FkZFNpZ25hdHVyZURpYWxvZ3sKICAtLXNlY29uZGFyeS1jb2xvcjp2YXIoLS10ZXh0LXNlY29uZGFyeS1jb2xvcik7CiAgLS1iZy1ob3ZlcjojZTBlMGU2OwogIC0tdGFiLXRvcC1saW5lLWFjdGl2ZS1jb2xvcjojMDA2MGRmOwogIC0tdGFiLXRvcC1saW5lLWFjdGl2ZS1ob3Zlci1jb2xvcjp2YXIoLS10YWItdGV4dC1ob3Zlci1jb2xvcik7CiAgLS10YWItdG9wLWxpbmUtaG92ZXItY29sb3I6IzhmOGY5ZDsKICAtLXRhYi10b3AtbGluZS1pbmFjdGl2ZS1jb2xvcjojY2ZjZmQ4OwogIC0tdGFiLWJvdHRvbS1saW5lLWFjdGl2ZS1jb2xvcjp2YXIoLS10YWItdG9wLWxpbmUtaW5hY3RpdmUtY29sb3IpOwogIC0tdGFiLWJvdHRvbS1saW5lLWhvdmVyLWNvbG9yOnZhcigtLXRhYi10b3AtbGluZS1pbmFjdGl2ZS1jb2xvcik7CiAgLS10YWItYm90dG9tLWxpbmUtaW5hY3RpdmUtY29sb3I6dmFyKC0tdGFiLXRvcC1saW5lLWluYWN0aXZlLWNvbG9yKTsKICAtLXRhYi1iZzp2YXIoLS1kaWFsb2ctYmctY29sb3IpOwogIC0tdGFiLWJnLWFjdGl2ZS1jb2xvcjp2YXIoLS10YWItYmcpOwogIC0tdGFiLWJnLWFjdGl2ZS1ob3Zlci1jb2xvcjp2YXIoLS1iZy1ob3Zlcik7CiAgLS10YWItYmctaG92ZXI6dmFyKC0tYmctaG92ZXIpOwogIC0tdGFiLXBhbmVsLWJvcmRlcjpub25lOwogIC0tdGFiLXBhbmVsLWJvcmRlci1yYWRpdXM6NHB4OwogIC0tdGFiLXRleHQtY29sb3I6dmFyKC0tcHJpbWFyeS1jb2xvcik7CiAgLS10YWItdGV4dC1hY3RpdmUtY29sb3I6dmFyKC0tdGFiLXRvcC1saW5lLWFjdGl2ZS1jb2xvcik7CiAgLS10YWItdGV4dC1hY3RpdmUtaG92ZXItY29sb3I6dmFyKC0tdGFiLXRleHQtaG92ZXItY29sb3IpOwogIC0tdGFiLXRleHQtaG92ZXItY29sb3I6dmFyKC0tdGFiLXRleHQtY29sb3IpOwogIC0tc2lnbmF0dXJlLXBsYWNlaG9sZGVyLWNvbG9yOnZhcigtLXNlY29uZGFyeS1jb2xvcik7CiAgLS1zaWduYXR1cmUtZHJhdy1wbGFjZWhvbGRlci1jb2xvcjp2YXIoLS1wcmltYXJ5LWNvbG9yKTsKICAtLXNpZ25hdHVyZS1jb2xvcjp2YXIoLS1wcmltYXJ5LWNvbG9yKTsKICAtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYm9yZGVyLXdpZHRoOjA7CiAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJvcmRlci1zdHlsZTpzb2xpZDsKICAtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYm9yZGVyLWNvbG9yOnRyYW5zcGFyZW50OwogIC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1ib3JkZXItZGlzYWJsZWQtY29sb3I6dHJhbnNwYXJlbnQ7CiAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWNvbG9yOnZhcigtLXByaW1hcnktY29sb3IpOwogIC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1ob3Zlci1jb2xvcjp2YXIoLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWNvbG9yKTsKICAtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYWN0aXZlLWNvbG9yOnZhcigtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tY29sb3IpOwogIC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1kaXNhYmxlZC1jb2xvcjp2YXIoLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWNvbG9yKTsKICAtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tZm9jdXMtY29sb3I6dmFyKC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1jb2xvcik7CiAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJnOnZhcigtLWRpYWxvZy1iZy1jb2xvcik7CiAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJnLWhvdmVyOnZhcigtLWJnLWhvdmVyKTsKICAtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYmctYWN0aXZlOiNjZmNmZDg7CiAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJnLWZvY3VzOiNmMGYwZjQ7CiAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJnLWRpc2FibGVkOmNvbG9yLW1peCgKICAgIGluIHNyZ2IsCiAgICAjZjBmMGY0LAogICAgdHJhbnNwYXJlbnQgNDAlCiAgKTsKICAtLXNhdmUtd2FybmluZy1jb2xvcjp2YXIoLS1zZWNvbmRhcnktY29sb3IpOwogIC0tdGhpY2tuZXNzLWJnOnZhcigtLWRpYWxvZy1iZy1jb2xvcik7CiAgLS10aGlja25lc3MtbGFiZWwtY29sb3I6dmFyKC0tcHJpbWFyeS1jb2xvcik7CiAgLS10aGlja25lc3Mtc2xpZGVyLWNvbG9yOnZhcigtLXByaW1hcnktY29sb3IpOwogIC0tdGhpY2tuZXNzLWJvcmRlcjpub25lOwogIC0tZHJhdy1jdXJzb3I6dXJsKGltYWdlcy9jdXJzb3ItZWRpdG9ySW5rLnN2ZykgMCAxNiwgcG9pbnRlcjsKfQoKQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyayl7CgojYWRkU2lnbmF0dXJlRGlhbG9newogICAgLS1kaWFsb2ctYmctY29sb3I6IzQyNDE0ZDsKICAgIC0tYmctaG92ZXI6IzUyNTI1ZTsKICAgIC0tcHJpbWFyeS1jb2xvcjojZmJmYmZlOwogICAgLS1zZWNvbmRhcnktY29sb3I6I2NmY2ZkODsKICAgIC0tdGFiLXRvcC1saW5lLWFjdGl2ZS1jb2xvcjojMGRmOwogICAgLS10YWItdG9wLWxpbmUtaW5hY3RpdmUtY29sb3I6IzhmOGY5ZDsKICAgIC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1iZy1hY3RpdmU6IzViNWI2NjsKICAgIC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1iZy1mb2N1czojMmIyYTMzOwogICAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJnLWRpc2FibGVkOmNvbG9yLW1peCgKICAgICAgaW4gc3JnYiwKICAgICAgIzJiMmEzMywKICAgICAgdHJhbnNwYXJlbnQgNDAlCiAgICApOwp9CiAgfQoKQG1lZGlhIHNjcmVlbiBhbmQgKGZvcmNlZC1jb2xvcnM6IGFjdGl2ZSl7CgojYWRkU2lnbmF0dXJlRGlhbG9newogICAgLS1zZWNvbmRhcnktY29sb3I6QnV0dG9uVGV4dDsKICAgIC0tYmc6SGlnaGxpZ2h0VGV4dDsKICAgIC0tYmctaG92ZXI6dmFyKC0tYmcpOwogICAgLS10YWItdG9wLWxpbmUtYWN0aXZlLWNvbG9yOkJ1dHRvblRleHQ7CiAgICAtLXRhYi10b3AtbGluZS1hY3RpdmUtaG92ZXItY29sb3I6SGlnaGxpZ2h0VGV4dDsKICAgIC0tdGFiLXRvcC1saW5lLWhvdmVyLWNvbG9yOlNlbGVjdGVkSXRlbTsKICAgIC0tdGFiLXRvcC1saW5lLWluYWN0aXZlLWNvbG9yOkJ1dHRvblRleHQ7CiAgICAtLXRhYi1ib3R0b20tbGluZS1hY3RpdmUtY29sb3I6dmFyKC0tdGFiLXRvcC1saW5lLWFjdGl2ZS1jb2xvcik7CiAgICAtLXRhYi1ib3R0b20tbGluZS1ob3Zlci1jb2xvcjp2YXIoLS10YWItdG9wLWxpbmUtaG92ZXItY29sb3IpOwogICAgLS10YWItYmc6dmFyKC0tYmcpOwogICAgLS10YWItYmctYWN0aXZlLWNvbG9yOlNlbGVjdGVkSXRlbTsKICAgIC0tdGFiLWJnLWFjdGl2ZS1ob3Zlci1jb2xvcjpTZWxlY3RlZEl0ZW07CiAgICAtLXRhYi1wYW5lbC1ib3JkZXI6MXB4IHNvbGlkIEJ1dHRvblRleHQ7CiAgICAtLXRhYi1wYW5lbC1ib3JkZXItcmFkaXVzOjhweDsKICAgIC0tdGFiLXRleHQtY29sb3I6QnV0dG9uVGV4dDsKICAgIC0tdGFiLXRleHQtYWN0aXZlLWNvbG9yOkhpZ2hsaWdodFRleHQ7CiAgICAtLXRhYi10ZXh0LWFjdGl2ZS1ob3Zlci1jb2xvcjpIaWdobGlnaHRUZXh0OwogICAgLS10YWItdGV4dC1ob3Zlci1jb2xvcjpTZWxlY3RlZEl0ZW07CiAgICAtLXNpZ25hdHVyZS1jb2xvcjpCdXR0b25UZXh0OwogICAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJvcmRlci13aWR0aDoxcHg7CiAgICAtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYm9yZGVyLXN0eWxlOnNvbGlkOwogICAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJvcmRlci1jb2xvcjpCdXR0b25UZXh0OwogICAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJvcmRlci1kaXNhYmxlZC1jb2xvcjpHcmF5VGV4dDsKICAgIC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1jb2xvcjpCdXR0b25UZXh0OwogICAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWhvdmVyLWNvbG9yOkhpZ2hsaWdodFRleHQ7CiAgICAtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYWN0aXZlLWNvbG9yOlNlbGVjdGVkSXRlbTsKICAgIC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1mb2N1cy1jb2xvcjpDYW52YXNUZXh0OwogICAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWRpc2FibGVkLWNvbG9yOkdyYXlUZXh0OwogICAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJnOnZhcigtLWJnKTsKICAgIC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1iZy1ob3ZlcjpTZWxlY3RlZEl0ZW07CiAgICAtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYmctYWN0aXZlOnZhcigtLWJnKTsKICAgIC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1iZy1mb2N1czp2YXIoLS1iZyk7CiAgICAtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYmctZGlzYWJsZWQ6dmFyKC0tYmcpOwogICAgLS10aGlja25lc3MtYmc6Q2FudmFzOwogICAgLS10aGlja25lc3MtbGFiZWwtY29sb3I6Q2FudmFzVGV4dDsKICAgIC0tdGhpY2tuZXNzLXNsaWRlci1jb2xvcjpCdXR0b25UZXh0OwogICAgLS10aGlja25lc3MtYm9yZGVyOjFweCBzb2xpZCB2YXIoLS1ib3JkZXItY29sb3IpOwp9CiAgfQoKI2FkZFNpZ25hdHVyZURpYWxvZyAjYWRkU2lnbmF0dXJlRGlhbG9nTGFiZWx7CiAgICBvdmVyZmxvdzpoaWRkZW47CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIGluc2V0OjA7CiAgICB3aWR0aDowOwogICAgaGVpZ2h0OjA7CiAgfQoKI2FkZFNpZ25hdHVyZURpYWxvZy53YWl0aW5nOjphZnRlcnsKICAgIGNvbnRlbnQ6IiI7CiAgICBjdXJzb3I6d2FpdDsKICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgaW5zZXQ6MDsKICAgIHdpZHRoOjEwMCU7CiAgICBoZWlnaHQ6MTAwJTsKICB9Cgo6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgW3JvbGU9InRhYmxpc3QiXXsKICAgICAgd2lkdGg6MTAwJTsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OwogICAgICBnYXA6MDsKICAgIH0KCjppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgW3JvbGU9InRhYmxpc3QiXSkgID4gW3JvbGU9InRhYiJdewogICAgICAgIGZsZXg6MSAwIDA7CiAgICAgICAgYWxpZ24tc2VsZjpzdHJldGNoOwogICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tdGFiLWJnKTsKICAgICAgICBwYWRkaW5nLWlubGluZTowOwogICAgICAgIGN1cnNvcjpkZWZhdWx0OwoKICAgICAgICBib3JkZXItaW5saW5lOjA7CiAgICAgICAgYm9yZGVyLWJsb2NrLXdpZHRoOjFweDsKICAgICAgICBib3JkZXItYmxvY2stc3R5bGU6c29saWQ7CiAgICAgICAgYm9yZGVyLWJsb2NrLXN0YXJ0LWNvbG9yOnZhcigtLXRhYi10b3AtbGluZS1pbmFjdGl2ZS1jb2xvcik7CiAgICAgICAgYm9yZGVyLWJsb2NrLWVuZC1jb2xvcjp2YXIoLS10YWItYm90dG9tLWxpbmUtaW5hY3RpdmUtY29sb3IpOwogICAgICAgIGJvcmRlci1yYWRpdXM6MDsKCiAgICAgICAgZm9udDptZW51OwogICAgICAgIGZvbnQtc2l6ZToxM3B4OwogICAgICAgIGZvbnQtc3R5bGU6bm9ybWFsOwogICAgICAgIGxpbmUtaGVpZ2h0Om5vcm1hbDsKICAgICAgICBmb250LXdlaWdodDo0MDA7CiAgICAgICAgY29sb3I6dmFyKC0tdGFiLXRleHQtY29sb3IpOwogICAgICB9Cgo6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSBbcm9sZT0idGFibGlzdCJdKSA+IFtyb2xlPSJ0YWIiXSk6aG92ZXJ7CiAgICAgICAgICBib3JkZXItYmxvY2stc3RhcnQtd2lkdGg6MnB4OwogICAgICAgICAgYm9yZGVyLWJsb2NrLXN0YXJ0LWNvbG9yOnZhcigtLXRhYi10b3AtbGluZS1ob3Zlci1jb2xvcik7CiAgICAgICAgICBib3JkZXItYmxvY2stZW5kLWNvbG9yOnZhcigtLXRhYi1ib3R0b20tbGluZS1ob3Zlci1jb2xvcik7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRhYi1iZy1ob3Zlcik7CiAgICAgICAgICBjb2xvcjp2YXIoLS10YWItdGV4dC1ob3Zlci1jb2xvcik7CiAgICAgICAgfQoKOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgW3JvbGU9InRhYmxpc3QiXSkgPiBbcm9sZT0idGFiIl0pOmZvY3VzLXZpc2libGV7CiAgICAgICAgICBvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS10YWItdG9wLWxpbmUtYWN0aXZlLWNvbG9yKTsKICAgICAgICAgIG91dGxpbmUtb2Zmc2V0Oi0ycHg7CiAgICAgICAgfQoKW2FyaWEtc2VsZWN0ZWQ9InRydWUiXTppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpIFtyb2xlPSJ0YWJsaXN0Il0pID4gW3JvbGU9InRhYiJdKXsKICAgICAgICAgIGJvcmRlci1ibG9jay1zdGFydC13aWR0aDoycHg7CiAgICAgICAgICBib3JkZXItYmxvY2stc3RhcnQtY29sb3I6dmFyKC0tdGFiLXRvcC1saW5lLWFjdGl2ZS1jb2xvcik7CiAgICAgICAgICBib3JkZXItYmxvY2stZW5kLWNvbG9yOnZhcigtLXRhYi1ib3R0b20tbGluZS1hY3RpdmUtY29sb3IpOwogICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10YWItYmctYWN0aXZlLWNvbG9yKTsKICAgICAgICAgIGZvbnQtd2VpZ2h0OjU5MDsKICAgICAgICAgIGNvbG9yOnZhcigtLXRhYi10ZXh0LWFjdGl2ZS1jb2xvcik7CiAgICAgICAgfQoKW2FyaWEtc2VsZWN0ZWQ9InRydWUiXTppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpIFtyb2xlPSJ0YWJsaXN0Il0pID4gW3JvbGU9InRhYiJdKTpob3ZlcnsKICAgICAgICAgICAgYm9yZGVyLWJsb2NrLXN0YXJ0LWNvbG9yOnZhcigtLXRhYi10b3AtbGluZS1hY3RpdmUtaG92ZXItY29sb3IpOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRhYi1iZy1hY3RpdmUtaG92ZXItY29sb3IpOwogICAgICAgICAgICBjb2xvcjp2YXIoLS10YWItdGV4dC1hY3RpdmUtaG92ZXItY29sb3IpOwogICAgICAgICAgfQoKOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXJ7CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGhlaWdodDphdXRvOwogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgICAgYWxpZ24taXRlbXM6ZmxleC1lbmQ7CiAgICAgIGFsaWduLXNlbGY6c3RyZXRjaDsKICAgICAgZ2FwOjEycHg7CiAgICAgIHBhZGRpbmctaW5saW5lOjE2cHg7CiAgICAgIGJveC1zaXppbmc6Ym9yZGVyLWJveDsKICAgIH0KCjppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgID4gW3JvbGU9InRhYnBhbmVsIl17CiAgICAgICAgcG9zaXRpb246cmVsYXRpdmU7CiAgICAgICAgd2lkdGg6MTAwJTsKICAgICAgICBoZWlnaHQ6MjIwcHg7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1zaWduYXR1cmUtYmcpOwogICAgICAgIGJvcmRlcjp2YXIoLS10YWItcGFuZWwtYm9yZGVyKTsKICAgICAgICBib3JkZXItcmFkaXVzOnZhcigtLXRhYi1wYW5lbC1ib3JkZXItcmFkaXVzKTsKICAgICAgfQoKOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgID4gc3ZnewogICAgICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgICAgICBpbnNldDowOwogICAgICAgICAgd2lkdGg6MTAwJTsKICAgICAgICAgIGhlaWdodDoxMDAlOwogICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDsKICAgICAgICB9CgojYWRkU2lnbmF0dXJlVHlwZUNvbnRhaW5lcjppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpID4gW3JvbGU9InRhYnBhbmVsIl0pewogICAgICAgICAgZGlzcGxheTpub25lOwogICAgICAgIH0KCiNhZGRTaWduYXR1cmVUeXBlQ29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgI2FkZFNpZ25hdHVyZVR5cGVJbnB1dHsKICAgICAgICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgICAgICAgIGluc2V0OjA7CiAgICAgICAgICAgIHdpZHRoOjEwMCU7CiAgICAgICAgICAgIGhlaWdodDoxMDAlOwogICAgICAgICAgICBib3JkZXI6MDsKICAgICAgICAgICAgcGFkZGluZzowOwogICAgICAgICAgICB0ZXh0LWFsaWduOmNlbnRlcjsKICAgICAgICAgICAgY29sb3I6dmFyKC0tc2lnbmF0dXJlLWNvbG9yKTsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czp2YXIoLS10YWItcGFuZWwtYm9yZGVyLXJhZGl1cyk7CgogICAgICAgICAgICBmb250LWZhbWlseToiQnJ1c2ggc2NyaXB0IiwgIkFwcGxlIENoYW5jZXJ5IiwgIlNlZ29lIHNjcmlwdCIsICJGcmVlc3R5bGUgU2NyaXB0IiwgIlBhbGFjZSBTY3JpcHQgTVQiLCAiQnJ1c2ggU2NyaXB0IE1UIiwgVEssIGN1cnNpdmUsIHNlcmlmOwogICAgICAgICAgICBmb250LXNpemU6NDRweDsKICAgICAgICAgICAgZm9udC1zdHlsZTppdGFsaWM7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OjQwMDsKICAgICAgICAgIH0KCjppcygjYWRkU2lnbmF0dXJlVHlwZUNvbnRhaW5lcjppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpID4gW3JvbGU9InRhYnBhbmVsIl0pICNhZGRTaWduYXR1cmVUeXBlSW5wdXQpOjotbW96LXBsYWNlaG9sZGVyewogICAgICAgICAgICAgIGNvbG9yOnZhcigtLXNpZ25hdHVyZS1wbGFjZWhvbGRlci1jb2xvcik7CiAgICAgICAgICAgICAgdGV4dC1hbGlnbjpjZW50ZXI7CgogICAgICAgICAgICAgIGZvbnQ6bWVudTsKICAgICAgICAgICAgICBmb250LXN0eWxlOm5vcm1hbDsKICAgICAgICAgICAgICBmb250LXdlaWdodDoyNzQ7CiAgICAgICAgICAgICAgZm9udC1zaXplOjQ0cHg7CiAgICAgICAgICAgICAgbGluZS1oZWlnaHQ6bm9ybWFsOwogICAgICAgICAgICB9Cgo6aXMoI2FkZFNpZ25hdHVyZVR5cGVDb250YWluZXI6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSA+IFtyb2xlPSJ0YWJwYW5lbCJdKSAjYWRkU2lnbmF0dXJlVHlwZUlucHV0KTo6cGxhY2Vob2xkZXJ7CiAgICAgICAgICAgICAgY29sb3I6dmFyKC0tc2lnbmF0dXJlLXBsYWNlaG9sZGVyLWNvbG9yKTsKICAgICAgICAgICAgICB0ZXh0LWFsaWduOmNlbnRlcjsKCiAgICAgICAgICAgICAgZm9udDptZW51OwogICAgICAgICAgICAgIGZvbnQtc3R5bGU6bm9ybWFsOwogICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OjI3NDsKICAgICAgICAgICAgICBmb250LXNpemU6NDRweDsKICAgICAgICAgICAgICBsaW5lLWhlaWdodDpub3JtYWw7CiAgICAgICAgICAgIH0KCiNhZGRTaWduYXR1cmVEcmF3Q29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSl7CiAgICAgICAgICBkaXNwbGF5Om5vbmU7CiAgICAgICAgfQoKI2FkZFNpZ25hdHVyZURyYXdDb250YWluZXI6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSA+IFtyb2xlPSJ0YWJwYW5lbCJdKSAgPiBzcGFuewogICAgICAgICAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgICAgICAgICAgdG9wOjA7CiAgICAgICAgICAgIGxlZnQ6MDsKICAgICAgICAgICAgd2lkdGg6MTAwJTsKICAgICAgICAgICAgaGVpZ2h0OjEwMCU7CiAgICAgICAgICAgIGRpc3BsYXk6Z3JpZDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwoKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDsKICAgICAgICAgICAgY29sb3I6dmFyKC0tc2lnbmF0dXJlLXBsYWNlaG9sZGVyLWNvbG9yKTsKICAgICAgICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDpub25lOwogICAgICAgICAgICAgICAtbW96LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgICAgICAgICAgICAgICAgdXNlci1zZWxlY3Q6bm9uZTsKICAgICAgICAgIH0KCiNhZGRTaWduYXR1cmVEcmF3Q29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgID4gc3ZnewogICAgICAgICAgICBzdHJva2U6dmFyKC0tc2lnbmF0dXJlLWNvbG9yKTsKICAgICAgICAgICAgZmlsbDpub25lOwogICAgICAgICAgICBzdHJva2Utb3BhY2l0eToxOwogICAgICAgICAgICBzdHJva2UtbGluZWNhcDpyb3VuZDsKICAgICAgICAgICAgc3Ryb2tlLWxpbmVqb2luOnJvdW5kOwogICAgICAgICAgICBzdHJva2UtbWl0ZXJsaW1pdDoxMDsKICAgICAgICAgIH0KCjppcygjYWRkU2lnbmF0dXJlRHJhd0NvbnRhaW5lcjppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpID4gW3JvbGU9InRhYnBhbmVsIl0pID4gc3ZnKTpob3ZlcnsKICAgICAgICAgICAgICBjdXJzb3I6dmFyKC0tZHJhdy1jdXJzb3IpOwogICAgICAgICAgICB9CgojYWRkU2lnbmF0dXJlRHJhd0NvbnRhaW5lcjppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpID4gW3JvbGU9InRhYnBhbmVsIl0pICN0aGlja25lc3N7CiAgICAgICAgICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgICAgICAgICB3aWR0aDoxMDAlOwogICAgICAgICAgICBpbnNldC1ibG9jay1lbmQ6MDsKICAgICAgICAgICAgZGlzcGxheTpncmlkOwogICAgICAgICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICAgICAgICB9Cgo6aXMoI2FkZFNpZ25hdHVyZURyYXdDb250YWluZXI6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSA+IFtyb2xlPSJ0YWJwYW5lbCJdKSAjdGhpY2tuZXNzKSAgPiBzcGFuewogICAgICAgICAgICAgIGNvbG9yOnZhcigtLXNpZ25hdHVyZS1kcmF3LXBsYWNlaG9sZGVyLWNvbG9yKTsKICAgICAgICAgICAgfQoKOmlzKCNhZGRTaWduYXR1cmVEcmF3Q29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgI3RoaWNrbmVzcykgID4gZGl2ewogICAgICAgICAgICAgIHdpZHRoOmF1dG87CiAgICAgICAgICAgICAgaGVpZ2h0OmF1dG87CiAgICAgICAgICAgICAgZGlzcGxheTpmbGV4OwogICAgICAgICAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogICAgICAgICAgICAgIGdhcDo4cHg7CiAgICAgICAgICAgICAgcGFkZGluZzo2cHggOHB4IDdweDsKICAgICAgICAgICAgICBtYXJnaW46MDsKICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRoaWNrbmVzcy1iZyk7CiAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czo0cHggNHB4IDAgMDsKICAgICAgICAgICAgICBib3JkZXItaW5saW5lOnZhcigtLXRoaWNrbmVzcy1ib3JkZXIpOwogICAgICAgICAgICAgIGJvcmRlci10b3A6dmFyKC0tdGhpY2tuZXNzLWJvcmRlcik7CiAgICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6YXV0bzsKICAgICAgICAgICAgICBwb3NpdGlvbjpyZWxhdGl2ZTsKICAgICAgICAgICAgICB0b3A6MXB4OwogICAgICAgICAgICB9Cgo6aXMoOmlzKCNhZGRTaWduYXR1cmVEcmF3Q29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgI3RoaWNrbmVzcykgPiBkaXYpICA+IGxhYmVsewogICAgICAgICAgICAgICAgY29sb3I6dmFyKC0tdGhpY2tuZXNzLWxhYmVsLWNvbG9yKTsKICAgICAgICAgICAgICB9Cgo6aXMoOmlzKCNhZGRTaWduYXR1cmVEcmF3Q29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgI3RoaWNrbmVzcykgPiBkaXYpICA+IGlucHV0ewogICAgICAgICAgICAgICAgd2lkdGg6MTAwcHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6MTRweDsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7CiAgICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURyYXdDb250YWluZXI6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSA+IFtyb2xlPSJ0YWJwYW5lbCJdKSAjdGhpY2tuZXNzKSA+IGRpdikgPiBpbnB1dCk6Oi13ZWJraXQtc2xpZGVyLXJ1bm5hYmxlLXRyYWNrLDppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEcmF3Q29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgI3RoaWNrbmVzcykgPiBkaXYpID4gaW5wdXQpOjotbW96LXJhbmdlLXRyYWNrLDppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEcmF3Q29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgI3RoaWNrbmVzcykgPiBkaXYpID4gaW5wdXQpOjotbW96LXJhbmdlLXByb2dyZXNzewogICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRoaWNrbmVzcy1zbGlkZXItY29sb3IpOwogICAgICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURyYXdDb250YWluZXI6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSA+IFtyb2xlPSJ0YWJwYW5lbCJdKSAjdGhpY2tuZXNzKSA+IGRpdikgPiBpbnB1dCk6Oi13ZWJraXQtc2xpZGVyLXRodW1iLDppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEcmF3Q29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgI3RoaWNrbmVzcykgPiBkaXYpID4gaW5wdXQpOjotbW96LXJhbmdlLXRodW1iewogICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRoaWNrbmVzcy1iZyk7CiAgICAgICAgICAgICAgICB9Cgo6aXMoOmlzKCNhZGRTaWduYXR1cmVEcmF3Q29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgI3RoaWNrbmVzcykgPiBkaXYpICA+IGlucHV0ewoKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6NC41cHg7CiAgICAgICAgICAgICAgICBib3JkZXI6MDsKICAgICAgICAgICAgICAgIGNvbG9yOnZhcigtLXNpZ25hdHVyZS1jb2xvcik7CiAgICAgICAgICAgICAgfQoKI2FkZFNpZ25hdHVyZUltYWdlQ29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSl7CiAgICAgICAgICBkaXNwbGF5Om5vbmU7CiAgICAgICAgfQoKI2FkZFNpZ25hdHVyZUltYWdlQ29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgID4gc3ZnewogICAgICAgICAgICBzdHJva2U6bm9uZTsKICAgICAgICAgICAgc3Ryb2tlLXdpZHRoOjA7CiAgICAgICAgICAgIGZpbGw6dmFyKC0tc2lnbmF0dXJlLWNvbG9yKTsKICAgICAgICAgICAgZmlsbC1vcGFjaXR5OjE7CiAgICAgICAgICB9CgojYWRkU2lnbmF0dXJlSW1hZ2VDb250YWluZXI6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSA+IFtyb2xlPSJ0YWJwYW5lbCJdKSAjYWRkU2lnbmF0dXJlSW1hZ2VQbGFjZWhvbGRlcnsKICAgICAgICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgICAgICAgIHRvcDowOwogICAgICAgICAgICBsZWZ0OjA7CiAgICAgICAgICAgIHdpZHRoOjEwMCU7CiAgICAgICAgICAgIGhlaWdodDoxMDAlOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50OwogICAgICAgICAgICBkaXNwbGF5OmZsZXg7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogICAgICAgICAgfQoKOmlzKCNhZGRTaWduYXR1cmVJbWFnZUNvbnRhaW5lcjppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpID4gW3JvbGU9InRhYnBhbmVsIl0pICNhZGRTaWduYXR1cmVJbWFnZVBsYWNlaG9sZGVyKSBzcGFuewogICAgICAgICAgICAgIGNvbG9yOnZhcigtLXNpZ25hdHVyZS1wbGFjZWhvbGRlci1jb2xvcik7CiAgICAgICAgICAgIH0KCjppcygjYWRkU2lnbmF0dXJlSW1hZ2VDb250YWluZXI6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSA+IFtyb2xlPSJ0YWJwYW5lbCJdKSAjYWRkU2lnbmF0dXJlSW1hZ2VQbGFjZWhvbGRlcikgYXsKICAgICAgICAgICAgICBjb2xvcjp2YXIoLS1vcGVuLWxpbmstZmcpOwogICAgICAgICAgICAgIHRleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmU7CiAgICAgICAgICAgICAgY3Vyc29yOnBvaW50ZXI7CiAgICAgICAgICAgIH0KCjppcyg6aXMoI2FkZFNpZ25hdHVyZUltYWdlQ29udGFpbmVyOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiBbcm9sZT0idGFicGFuZWwiXSkgI2FkZFNpZ25hdHVyZUltYWdlUGxhY2Vob2xkZXIpIGEpOmhvdmVyewogICAgICAgICAgICAgICAgY29sb3I6dmFyKC0tb3Blbi1saW5rLWhvdmVyLWZnKTsKICAgICAgICAgICAgICB9CgojYWRkU2lnbmF0dXJlSW1hZ2VDb250YWluZXI6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSA+IFtyb2xlPSJ0YWJwYW5lbCJdKSAjYWRkU2lnbmF0dXJlRmlsZVBpY2tlcnsKICAgICAgICAgICAgdmlzaWJpbGl0eTpoaWRkZW47CiAgICAgICAgICAgIHBvc2l0aW9uOnJlbGF0aXZlOwogICAgICAgICAgICB3aWR0aDowOwogICAgICAgICAgICBoZWlnaHQ6MDsKICAgICAgICAgIH0KCltkYXRhLXNlbGVjdGVkPSJ0eXBlIl06aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpID4gI2FkZFNpZ25hdHVyZVR5cGVDb250YWluZXIsW2RhdGEtc2VsZWN0ZWQ9ImRyYXciXTppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiAjYWRkU2lnbmF0dXJlRHJhd0NvbnRhaW5lcixbZGF0YS1zZWxlY3RlZD0iaW1hZ2UiXTppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgPiAjYWRkU2lnbmF0dXJlSW1hZ2VDb250YWluZXJ7CiAgICAgICAgZGlzcGxheTpibG9jazsKICAgICAgfQoKOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQ29udHJvbHN7CiAgICAgICAgZGlzcGxheTpmbGV4OwogICAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogICAgICAgIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7CiAgICAgICAgZ2FwOjEycHg7CiAgICAgICAgYWxpZ24tc2VsZjpzdHJldGNoOwogICAgICB9Cgo6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQ29udHJvbHMpICNob3Jpem9udGFsQ29udGFpbmVyewogICAgICAgICAgZGlzcGxheTpmbGV4OwogICAgICAgICAgYWxpZ24taXRlbXM6ZmxleC1lbmQ7CiAgICAgICAgICBnYXA6MTZweDsKICAgICAgICAgIGFsaWduLXNlbGY6c3RyZXRjaDsKICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjaG9yaXpvbnRhbENvbnRhaW5lcikgI2FkZFNpZ25hdHVyZURlc2NyaXB0aW9uQ29udGFpbmVyewogICAgICAgICAgICBkaXNwbGF5OmZsZXg7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsKICAgICAgICAgICAgZ2FwOjRweDsKICAgICAgICAgICAgZmxleDoxIDAgMDsKICAgICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjaG9yaXpvbnRhbENvbnRhaW5lcikgI2FkZFNpZ25hdHVyZURlc2NyaXB0aW9uQ29udGFpbmVyKTpoYXMoaW5wdXQ6ZGlzYWJsZWQpID4gbGFiZWx7CiAgICAgICAgICAgICAgb3BhY2l0eTowLjQ7CiAgICAgICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjaG9yaXpvbnRhbENvbnRhaW5lcikgI2FkZFNpZ25hdHVyZURlc2NyaXB0aW9uQ29udGFpbmVyKSAgPiBsYWJlbHsKICAgICAgICAgICAgICB3aWR0aDphdXRvOwogICAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjaG9yaXpvbnRhbENvbnRhaW5lcikgI2NsZWFyU2lnbmF0dXJlQnV0dG9uewogICAgICAgICAgICBkaXNwbGF5OmZsZXg7CiAgICAgICAgICAgIGhlaWdodDozMnB4OwogICAgICAgICAgICBwYWRkaW5nOjRweCA4cHg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJnKTsKICAgICAgICAgICAgYm9yZGVyLXdpZHRoOnZhcigtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYm9yZGVyLXdpZHRoKTsKICAgICAgICAgICAgYm9yZGVyLXN0eWxlOnZhcigtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYm9yZGVyLXN0eWxlKTsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOnZhcigtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYm9yZGVyLWNvbG9yKTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czo0cHg7CiAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpICNhZGRTaWduYXR1cmVDb250cm9scykgI2hvcml6b250YWxDb250YWluZXIpICNjbGVhclNpZ25hdHVyZUJ1dHRvbikgID4gc3BhbnsKICAgICAgICAgICAgICBkaXNwbGF5OmZsZXg7CiAgICAgICAgICAgICAgaGVpZ2h0OjI0cHg7CiAgICAgICAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICAgICAgICAgIGdhcDo0cHg7CiAgICAgICAgICAgICAgZmxleC1zaHJpbms6MDsKCiAgICAgICAgICAgICAgY29sb3I6dmFyKC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1jb2xvcik7CiAgICAgICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpICNhZGRTaWduYXR1cmVDb250cm9scykgI2hvcml6b250YWxDb250YWluZXIpICNjbGVhclNpZ25hdHVyZUJ1dHRvbikgPiBzcGFuKTo6YWZ0ZXJ7CiAgICAgICAgICAgICAgICBjb250ZW50OiIiOwogICAgICAgICAgICAgICAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgICAgICAgICAgICAgICB3aWR0aDoxNnB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OjE2cHg7CiAgICAgICAgICAgICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1pY29uKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWljb24pOwogICAgICAgICAgICAgICAgLXdlYmtpdC1tYXNrLXNpemU6Y292ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hc2stc2l6ZTpjb3ZlcjsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1jb2xvcik7CiAgICAgICAgICAgICAgICBmbGV4LXNocmluazowOwogICAgICAgICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjaG9yaXpvbnRhbENvbnRhaW5lcikgI2NsZWFyU2lnbmF0dXJlQnV0dG9uKTpob3ZlcnsKICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYmctaG92ZXIpOwogICAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpICNhZGRTaWduYXR1cmVDb250cm9scykgI2hvcml6b250YWxDb250YWluZXIpICNjbGVhclNpZ25hdHVyZUJ1dHRvbik6aG92ZXIgID4gc3BhbnsKICAgICAgICAgICAgICAgIGNvbG9yOnZhcigtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24taG92ZXItY29sb3IpOwogICAgICAgICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpICNhZGRTaWduYXR1cmVDb250cm9scykgI2hvcml6b250YWxDb250YWluZXIpICNjbGVhclNpZ25hdHVyZUJ1dHRvbik6aG92ZXIgPiBzcGFuKTo6YWZ0ZXJ7CiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1ob3Zlci1jb2xvcik7CiAgICAgICAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpICNhZGRTaWduYXR1cmVDb250cm9scykgI2hvcml6b250YWxDb250YWluZXIpICNjbGVhclNpZ25hdHVyZUJ1dHRvbik6YWN0aXZlewogICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1iZy1hY3RpdmUpOwogICAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpICNhZGRTaWduYXR1cmVDb250cm9scykgI2hvcml6b250YWxDb250YWluZXIpICNjbGVhclNpZ25hdHVyZUJ1dHRvbik6YWN0aXZlICA+IHNwYW57CiAgICAgICAgICAgICAgICBjb2xvcjp2YXIoLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWFjdGl2ZS1jb2xvcik7CiAgICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjaG9yaXpvbnRhbENvbnRhaW5lcikgI2NsZWFyU2lnbmF0dXJlQnV0dG9uKTphY3RpdmUgPiBzcGFuKTo6YWZ0ZXJ7CiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1hY3RpdmUtY29sb3IpOwogICAgICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQ29udHJvbHMpICNob3Jpem9udGFsQ29udGFpbmVyKSAjY2xlYXJTaWduYXR1cmVCdXR0b24pOmZvY3VzLXZpc2libGV7CiAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJnLWZvY3VzKTsKICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQ29udHJvbHMpICNob3Jpem9udGFsQ29udGFpbmVyKSAjY2xlYXJTaWduYXR1cmVCdXR0b24pOmZvY3VzLXZpc2libGUgID4gc3BhbnsKICAgICAgICAgICAgICAgIGNvbG9yOnZhcigtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tZm9jdXMtY29sb3IpOwogICAgICAgICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyg6aXMoOmlzKCNhZGRTaWduYXR1cmVEaWFsb2cgLm1haW5Db250YWluZXIpICNhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIpICNhZGRTaWduYXR1cmVDb250cm9scykgI2hvcml6b250YWxDb250YWluZXIpICNjbGVhclNpZ25hdHVyZUJ1dHRvbik6Zm9jdXMtdmlzaWJsZSA+IHNwYW4pOjphZnRlcnsKICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWZvY3VzLWNvbG9yKTsKICAgICAgICAgICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjaG9yaXpvbnRhbENvbnRhaW5lcikgI2NsZWFyU2lnbmF0dXJlQnV0dG9uKTpkaXNhYmxlZHsKICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24tYmctZGlzYWJsZWQpOwogICAgICAgICAgICAgIGJvcmRlci1jb2xvcjp2YXIoLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWJvcmRlci1kaXNhYmxlZC1jb2xvcik7CiAgICAgICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjaG9yaXpvbnRhbENvbnRhaW5lcikgI2NsZWFyU2lnbmF0dXJlQnV0dG9uKTpkaXNhYmxlZCAgPiBzcGFuewogICAgICAgICAgICAgICAgY29sb3I6dmFyKC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1kaXNhYmxlZC1jb2xvcik7CiAgICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjaG9yaXpvbnRhbENvbnRhaW5lcikgI2NsZWFyU2lnbmF0dXJlQnV0dG9uKTpkaXNhYmxlZCA+IHNwYW4pOjphZnRlcnsKICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoCiAgICAgICAgICAgICAgICAgICAgLS1jbGVhci1zaWduYXR1cmUtYnV0dG9uLWRpc2FibGVkLWNvbG9yCiAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9Cgo6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQ29udHJvbHMpICNhZGRTaWduYXR1cmVTYXZlQ29udGFpbmVyewogICAgICAgICAgZGlzcGxheTpncmlkOwogICAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOm1heC1jb250ZW50IGF1dG87CiAgICAgICAgICBnYXA6NHB4OwogICAgICAgICAgd2lkdGg6MTAwJTsKICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjYWRkU2lnbmF0dXJlU2F2ZUNvbnRhaW5lcikgID4gaW5wdXR7CiAgICAgICAgICAgIG1hcmdpbjowOwogICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKDppcygjYWRkU2lnbmF0dXJlRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQWN0aW9uQ29udGFpbmVyKSAjYWRkU2lnbmF0dXJlQ29udHJvbHMpICNhZGRTaWduYXR1cmVTYXZlQ29udGFpbmVyKSA+IGlucHV0KTpkaXNhYmxlZCArIGxhYmVsewogICAgICAgICAgICAgIG9wYWNpdHk6MC40OwogICAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjYWRkU2lnbmF0dXJlU2F2ZUNvbnRhaW5lcikgID4gbGFiZWx7CiAgICAgICAgICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsKICAgICAgICAgICAgICAgLW1vei11c2VyLXNlbGVjdDpub25lOwogICAgICAgICAgICAgICAgICAgIHVzZXItc2VsZWN0Om5vbmU7CiAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjYWRkU2lnbmF0dXJlU2F2ZUNvbnRhaW5lcik6bm90KC5mdWxsU3RvcmFnZSkgI2FkZFNpZ25hdHVyZVNhdmVXYXJuaW5newogICAgICAgICAgICBkaXNwbGF5Om5vbmU7CiAgICAgICAgICB9CgouZnVsbFN0b3JhZ2U6aXMoOmlzKDppcyg6aXMoI2FkZFNpZ25hdHVyZURpYWxvZyAubWFpbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUFjdGlvbkNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZUNvbnRyb2xzKSAjYWRkU2lnbmF0dXJlU2F2ZUNvbnRhaW5lcikgI2FkZFNpZ25hdHVyZVNhdmVXYXJuaW5newogICAgICAgICAgICBkaXNwbGF5OmJsb2NrOwogICAgICAgICAgICBvcGFjaXR5OjE7CiAgICAgICAgICAgIGNvbG9yOnZhcigtLXNhdmUtd2FybmluZy1jb2xvcik7CiAgICAgICAgICAgIGZvbnQtc2l6ZToxMXB4OwogICAgICAgICAgfQoKI2VkaXRTaWduYXR1cmVEZXNjcmlwdGlvbkRpYWxvZyAubWFpbkNvbnRhaW5lcnsKICAgIHBhZGRpbmctaW5saW5lOjE2cHg7CiAgICBib3gtc2l6aW5nOmJvcmRlci1ib3g7CiAgfQoKOmlzKCNlZGl0U2lnbmF0dXJlRGVzY3JpcHRpb25EaWFsb2cgLm1haW5Db250YWluZXIpIC50aXRsZXsKICAgICAgbWFyZ2luLWlubGluZS1zdGFydDowOwogICAgfQoKOmlzKCNlZGl0U2lnbmF0dXJlRGVzY3JpcHRpb25EaWFsb2cgLm1haW5Db250YWluZXIpICNlZGl0U2lnbmF0dXJlRGVzY3JpcHRpb25BbmRWaWV3ewogICAgICB3aWR0aDphdXRvOwogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsKICAgICAgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsKICAgICAgZ2FwOjEycHg7CiAgICAgIGFsaWduLXNlbGY6c3RyZXRjaDsKICAgIH0KCjppcyg6aXMoI2VkaXRTaWduYXR1cmVEZXNjcmlwdGlvbkRpYWxvZyAubWFpbkNvbnRhaW5lcikgI2VkaXRTaWduYXR1cmVEZXNjcmlwdGlvbkFuZFZpZXcpICNlZGl0U2lnbmF0dXJlRGVzY3JpcHRpb25Db250YWluZXJ7CiAgICAgICAgZGlzcGxheTpmbGV4OwogICAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgICAgICBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OwogICAgICAgIGdhcDo0cHg7CiAgICAgICAgZmxleDoxIDEgYXV0bzsKICAgICAgfQoKOmlzKDppcygjZWRpdFNpZ25hdHVyZURlc2NyaXB0aW9uRGlhbG9nIC5tYWluQ29udGFpbmVyKSAjZWRpdFNpZ25hdHVyZURlc2NyaXB0aW9uQW5kVmlldykgID4gc3ZnewogICAgICAgIHdpZHRoOjIxMHB4OwogICAgICAgIGhlaWdodDoxODBweDsKICAgICAgICBwYWRkaW5nOjhweDsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXNpZ25hdHVyZS1iZyk7CiAgICAgIH0KCjppcyg6aXMoOmlzKCNlZGl0U2lnbmF0dXJlRGVzY3JpcHRpb25EaWFsb2cgLm1haW5Db250YWluZXIpICNlZGl0U2lnbmF0dXJlRGVzY3JpcHRpb25BbmRWaWV3KSA+IHN2ZykgID4gcGF0aHsKICAgICAgICAgIHN0cm9rZTp2YXIoLS1idXR0b24tc2lnbmF0dXJlLWNvbG9yKTsKICAgICAgICAgIHN0cm9rZS13aWR0aDoxcHg7CiAgICAgICAgICBzdHJva2UtbGluZWNhcDpyb3VuZDsKICAgICAgICAgIHN0cm9rZS1saW5lam9pbjpyb3VuZDsKICAgICAgICAgIHN0cm9rZS1taXRlcmxpbWl0OjEwOwogICAgICAgICAgdmVjdG9yLWVmZmVjdDpub24tc2NhbGluZy1zdHJva2U7CiAgICAgICAgICBmaWxsOm5vbmU7CiAgICAgICAgfQoKLmNvbnRvdXJzOmlzKDppcyg6aXMoOmlzKCNlZGl0U2lnbmF0dXJlRGVzY3JpcHRpb25EaWFsb2cgLm1haW5Db250YWluZXIpICNlZGl0U2lnbmF0dXJlRGVzY3JpcHRpb25BbmRWaWV3KSA+IHN2ZykgPiBwYXRoKXsKICAgICAgICAgICAgZmlsbDp2YXIoLS1idXR0b24tc2lnbmF0dXJlLWNvbG9yKTsKICAgICAgICAgICAgc3Ryb2tlLXdpZHRoOjAuNXB4OwogICAgICAgICAgfQoKI2VkaXRvclNpZ25hdHVyZVBhcmFtc1Rvb2xiYXJ7CiAgcGFkZGluZzo4cHg7Cn0KCiNlZGl0b3JTaWduYXR1cmVQYXJhbXNUb29sYmFyICNhZGRTaWduYXR1cmVEb29ySGFuZ2VyewogICAgZ2FwOjhweDsKICAgIHBhZGRpbmc6MnB4OwogIH0KCjppcygjZWRpdG9yU2lnbmF0dXJlUGFyYW1zVG9vbGJhciAjYWRkU2lnbmF0dXJlRG9vckhhbmdlcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b25Db250YWluZXJ7CiAgICAgIGhlaWdodDozMnB4OwogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIGFsaWduLXNlbGY6c3RyZXRjaDsKICAgICAgZ2FwOjhweDsKICAgIH0KCjppcyg6aXMoI2VkaXRvclNpZ25hdHVyZVBhcmFtc1Rvb2xiYXIgI2FkZFNpZ25hdHVyZURvb3JIYW5nZXIpIC50b29sYmFyQWRkU2lnbmF0dXJlQnV0dG9uQ29udGFpbmVyKSBidXR0b257CiAgICAgICAgYm9yZGVyOnZhcigtLWJ1dHRvbi1zaWduYXR1cmUtYm9yZGVyKTsKICAgICAgICBib3JkZXItcmFkaXVzOjRweDsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWJ1dHRvbi1zaWduYXR1cmUtYmcpOwogICAgICAgIGNvbG9yOnZhcigtLWJ1dHRvbi1zaWduYXR1cmUtY29sb3IpOwogICAgICB9Cgo6aXMoOmlzKDppcygjZWRpdG9yU2lnbmF0dXJlUGFyYW1zVG9vbGJhciAjYWRkU2lnbmF0dXJlRG9vckhhbmdlcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b25Db250YWluZXIpIGJ1dHRvbik6aG92ZXJ7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWJ1dHRvbi1zaWduYXR1cmUtaG92ZXItYmcpOwogICAgICAgIH0KCjppcyg6aXMoOmlzKCNlZGl0b3JTaWduYXR1cmVQYXJhbXNUb29sYmFyICNhZGRTaWduYXR1cmVEb29ySGFuZ2VyKSAudG9vbGJhckFkZFNpZ25hdHVyZUJ1dHRvbkNvbnRhaW5lcikgYnV0dG9uKTphY3RpdmV7CiAgICAgICAgICBib3JkZXI6dmFyKC0tYnV0dG9uLXNpZ25hdHVyZS1hY3RpdmUtYm9yZGVyKTsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tYnV0dG9uLXNpZ25hdHVyZS1hY3RpdmUtYmcpOwogICAgICAgICAgY29sb3I6dmFyKC0tYnV0dG9uLXNpZ25hdHVyZS1hY3RpdmUtY29sb3IpOwogICAgICAgIH0KCjppcyg6aXMoOmlzKCNlZGl0b3JTaWduYXR1cmVQYXJhbXNUb29sYmFyICNhZGRTaWduYXR1cmVEb29ySGFuZ2VyKSAudG9vbGJhckFkZFNpZ25hdHVyZUJ1dHRvbkNvbnRhaW5lcikgYnV0dG9uKTphY3RpdmU6OmJlZm9yZXsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1idXR0b24tc2lnbmF0dXJlLWFjdGl2ZS1jb2xvcik7CiAgICAgICAgICB9Cgo6aXMoOmlzKDppcygjZWRpdG9yU2lnbmF0dXJlUGFyYW1zVG9vbGJhciAjYWRkU2lnbmF0dXJlRG9vckhhbmdlcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b25Db250YWluZXIpIGJ1dHRvbik6Zm9jdXMtdmlzaWJsZXsKICAgICAgICAgIG91dGxpbmU6dmFyKC0tZm9jdXMtcmluZy1vdXRsaW5lKTsKICAgICAgICB9Cgo6aXMoOmlzKDppcygjZWRpdG9yU2lnbmF0dXJlUGFyYW1zVG9vbGJhciAjYWRkU2lnbmF0dXJlRG9vckhhbmdlcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b25Db250YWluZXIpIGJ1dHRvbik6Zm9jdXMtdmlzaWJsZTo6YmVmb3JlewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWJ1dHRvbi1zaWduYXR1cmUtY29sb3IpOwogICAgICAgICAgfQoKOmlzKDppcyg6aXMoI2VkaXRvclNpZ25hdHVyZVBhcmFtc1Rvb2xiYXIgI2FkZFNpZ25hdHVyZURvb3JIYW5nZXIpIC50b29sYmFyQWRkU2lnbmF0dXJlQnV0dG9uQ29udGFpbmVyKSAuZGVsZXRlQnV0dG9uKTo6YmVmb3JlewogICAgICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLWNsZWFyLXNpZ25hdHVyZS1idXR0b24taWNvbik7CiAgICAgICAgICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tY2xlYXItc2lnbmF0dXJlLWJ1dHRvbi1pY29uKTsKICAgICAgICB9Cgo6aXMoOmlzKCNlZGl0b3JTaWduYXR1cmVQYXJhbXNUb29sYmFyICNhZGRTaWduYXR1cmVEb29ySGFuZ2VyKSAudG9vbGJhckFkZFNpZ25hdHVyZUJ1dHRvbkNvbnRhaW5lcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b257CiAgICAgICAgd2lkdGg6YXV0bzsKICAgICAgICBoZWlnaHQ6MTAwJTsKICAgICAgICBtaW4taGVpZ2h0OnZhcigtLW1lbnVpdGVtLWhlaWdodCk7CiAgICAgICAgYXNwZWN0LXJhdGlvOnVuc2V0OwogICAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgICAganVzdGlmeS1jb250ZW50OmZsZXgtc3RhcnQ7CiAgICAgICAgb3V0bGluZTpub25lOwogICAgICAgIGJvcmRlci1yYWRpdXM6NHB4OwogICAgICAgIGJveC1zaXppbmc6Ym9yZGVyLWJveDsKICAgICAgICBmb250Om1lc3NhZ2UtYm94OwogICAgICAgIHBvc2l0aW9uOnJlbGF0aXZlOwogICAgICAgIGZsZXg6MSAxIGF1dG87CiAgICAgICAgcGFkZGluZzowOwogICAgICAgIGdhcDo4cHg7CiAgICAgICAgdGV4dC1hbGlnbjpzdGFydDsKICAgICAgICB3aGl0ZS1zcGFjZTpub3JtYWw7CiAgICAgICAgY3Vyc29yOmRlZmF1bHQ7CiAgICAgICAgb3ZlcmZsb3c6aGlkZGVuOwogICAgICB9Cgo6aXMoOmlzKDppcygjZWRpdG9yU2lnbmF0dXJlUGFyYW1zVG9vbGJhciAjYWRkU2lnbmF0dXJlRG9vckhhbmdlcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b25Db250YWluZXIpIC50b29sYmFyQWRkU2lnbmF0dXJlQnV0dG9uKSAgPiBzdmd7CiAgICAgICAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICAgICAgICAgIGhlaWdodDoxMDAlOwogICAgICAgICAgYXNwZWN0LXJhdGlvOjE7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXNpZ25hdHVyZS1iZyk7CiAgICAgICAgICBmbGV4Om5vbmU7CiAgICAgICAgICBwYWRkaW5nOjRweDsKICAgICAgICAgIGJveC1zaXppbmc6Ym9yZGVyLWJveDsKICAgICAgICAgIGJvcmRlcjpub25lOwogICAgICAgICAgYm9yZGVyLXJhZGl1czo0cHg7CiAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKCNlZGl0b3JTaWduYXR1cmVQYXJhbXNUb29sYmFyICNhZGRTaWduYXR1cmVEb29ySGFuZ2VyKSAudG9vbGJhckFkZFNpZ25hdHVyZUJ1dHRvbkNvbnRhaW5lcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b24pID4gc3ZnKSAgPiBwYXRoewogICAgICAgICAgICBzdHJva2U6dmFyKC0tYnV0dG9uLXNpZ25hdHVyZS1jb2xvcik7CiAgICAgICAgICAgIHN0cm9rZS13aWR0aDoxcHg7CiAgICAgICAgICAgIHN0cm9rZS1saW5lY2FwOnJvdW5kOwogICAgICAgICAgICBzdHJva2UtbGluZWpvaW46cm91bmQ7CiAgICAgICAgICAgIHN0cm9rZS1taXRlcmxpbWl0OjEwOwogICAgICAgICAgICB2ZWN0b3ItZWZmZWN0Om5vbi1zY2FsaW5nLXN0cm9rZTsKICAgICAgICAgICAgZmlsbDpub25lOwogICAgICAgICAgfQoKLmNvbnRvdXJzOmlzKDppcyg6aXMoOmlzKDppcygjZWRpdG9yU2lnbmF0dXJlUGFyYW1zVG9vbGJhciAjYWRkU2lnbmF0dXJlRG9vckhhbmdlcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b25Db250YWluZXIpIC50b29sYmFyQWRkU2lnbmF0dXJlQnV0dG9uKSA+IHN2ZykgPiBwYXRoKXsKICAgICAgICAgICAgICBmaWxsOnZhcigtLWJ1dHRvbi1zaWduYXR1cmUtY29sb3IpOwogICAgICAgICAgICAgIHN0cm9rZS13aWR0aDowLjVweDsKICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoI2VkaXRvclNpZ25hdHVyZVBhcmFtc1Rvb2xiYXIgI2FkZFNpZ25hdHVyZURvb3JIYW5nZXIpIC50b29sYmFyQWRkU2lnbmF0dXJlQnV0dG9uQ29udGFpbmVyKSAudG9vbGJhckFkZFNpZ25hdHVyZUJ1dHRvbik6aXMoOmhvdmVyLDphY3RpdmUpID4gc3ZnewogICAgICAgICAgYm9yZGVyLXJhZGl1czo0cHggMCAwIDRweDsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tc2lnbmF0dXJlLWhvdmVyLWJnKTsKICAgICAgICB9Cgo6aXMoOmlzKDppcygjZWRpdG9yU2lnbmF0dXJlUGFyYW1zVG9vbGJhciAjYWRkU2lnbmF0dXJlRG9vckhhbmdlcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b25Db250YWluZXIpIC50b29sYmFyQWRkU2lnbmF0dXJlQnV0dG9uKTpob3ZlciAgPiBzcGFuewogICAgICAgICAgICBjb2xvcjp2YXIoLS1idXR0b24tc2lnbmF0dXJlLWhvdmVyLWNvbG9yKTsKICAgICAgICAgIH0KCjppcyg6aXMoOmlzKCNlZGl0b3JTaWduYXR1cmVQYXJhbXNUb29sYmFyICNhZGRTaWduYXR1cmVEb29ySGFuZ2VyKSAudG9vbGJhckFkZFNpZ25hdHVyZUJ1dHRvbkNvbnRhaW5lcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b24pOmFjdGl2ZXsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tYnV0dG9uLXNpZ25hdHVyZS1hY3RpdmUtYmcpOwogICAgICAgIH0KCjppcyg6aXMoOmlzKCNlZGl0b3JTaWduYXR1cmVQYXJhbXNUb29sYmFyICNhZGRTaWduYXR1cmVEb29ySGFuZ2VyKSAudG9vbGJhckFkZFNpZ25hdHVyZUJ1dHRvbkNvbnRhaW5lcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b24pOmlzKFtkaXNhYmxlZD0iZGlzYWJsZWQiXSxbZGlzYWJsZWRdKXsKICAgICAgICAgIG9wYWNpdHk6MC41OwogICAgICAgICAgcG9pbnRlci1ldmVudHM6bm9uZTsKICAgICAgICB9Cgo6aXMoOmlzKDppcygjZWRpdG9yU2lnbmF0dXJlUGFyYW1zVG9vbGJhciAjYWRkU2lnbmF0dXJlRG9vckhhbmdlcikgLnRvb2xiYXJBZGRTaWduYXR1cmVCdXR0b25Db250YWluZXIpIC50b29sYmFyQWRkU2lnbmF0dXJlQnV0dG9uKSAgPiBzcGFuewogICAgICAgICAgaGVpZ2h0OmF1dG87CiAgICAgICAgICB0ZXh0LW92ZXJmbG93OmVsbGlwc2lzOwogICAgICAgICAgd2hpdGUtc3BhY2U6bm93cmFwOwogICAgICAgICAgZmxleDoxIDEgYXV0bzsKICAgICAgICAgIGZvbnQ6bWVudTsKICAgICAgICAgIGZvbnQtc2l6ZToxM3B4OwogICAgICAgICAgZm9udC1zdHlsZTpub3JtYWw7CiAgICAgICAgICBmb250LXdlaWdodDo0MDA7CiAgICAgICAgICBsaW5lLWhlaWdodDpub3JtYWw7CiAgICAgICAgICBvdmVyZmxvdzpoaWRkZW47CiAgICAgICAgfQoKLmVkaXREZXNjcmlwdGlvbi5hbHRUZXh0ewogIC0tYWx0LXRleHQtYWRkLWltYWdlOnVybChpbWFnZXMvZWRpdG9yLXRvb2xiYXItZWRpdC5zdmcpICFpbXBvcnRhbnQ7Cn0KCi5lZGl0RGVzY3JpcHRpb24uYWx0VGV4dDo6YmVmb3JlewogICAgd2lkdGg6MTZweCAhaW1wb3J0YW50OwogICAgaGVpZ2h0OjE2cHggIWltcG9ydGFudDsKICB9Cgo6cm9vdHsKICAtLW91dGxpbmUtd2lkdGg6MnB4OwogIC0tb3V0bGluZS1jb2xvcjojMDA2MGRmOwogIC0tb3V0bGluZS1hcm91bmQtd2lkdGg6MXB4OwogIC0tb3V0bGluZS1hcm91bmQtY29sb3I6I2YwZjBmNDsKICAtLWhvdmVyLW91dGxpbmUtYXJvdW5kLWNvbG9yOnZhcigtLW91dGxpbmUtYXJvdW5kLWNvbG9yKTsKICAtLWZvY3VzLW91dGxpbmU6c29saWQgdmFyKC0tb3V0bGluZS13aWR0aCkgdmFyKC0tb3V0bGluZS1jb2xvcik7CiAgLS11bmZvY3VzLW91dGxpbmU6c29saWQgdmFyKC0tb3V0bGluZS13aWR0aCkgdHJhbnNwYXJlbnQ7CiAgLS1mb2N1cy1vdXRsaW5lLWFyb3VuZDpzb2xpZCB2YXIoLS1vdXRsaW5lLWFyb3VuZC13aWR0aCkgdmFyKC0tb3V0bGluZS1hcm91bmQtY29sb3IpOwogIC0taG92ZXItb3V0bGluZS1jb2xvcjojOGY4ZjlkOwogIC0taG92ZXItb3V0bGluZTpzb2xpZCB2YXIoLS1vdXRsaW5lLXdpZHRoKSB2YXIoLS1ob3Zlci1vdXRsaW5lLWNvbG9yKTsKICAtLWhvdmVyLW91dGxpbmUtYXJvdW5kOnNvbGlkIHZhcigtLW91dGxpbmUtYXJvdW5kLXdpZHRoKSB2YXIoLS1ob3Zlci1vdXRsaW5lLWFyb3VuZC1jb2xvcik7CiAgLS1mcmVldGV4dC1saW5lLWhlaWdodDoxLjM1OwogIC0tZnJlZXRleHQtcGFkZGluZzoycHg7CiAgLS1yZXNpemVyLWJnLWNvbG9yOnZhcigtLW91dGxpbmUtY29sb3IpOwogIC0tcmVzaXplci1zaXplOjZweDsKICAtLXJlc2l6ZXItc2hpZnQ6Y2FsYygKICAgIDBweCAtICh2YXIoLS1vdXRsaW5lLXdpZHRoKSArIHZhcigtLXJlc2l6ZXItc2l6ZSkpIC8gMiAtCiAgICAgIHZhcigtLW91dGxpbmUtYXJvdW5kLXdpZHRoKQogICk7CiAgLS1lZGl0b3JGcmVlVGV4dC1lZGl0aW5nLWN1cnNvcjp0ZXh0OwogIC0tZWRpdG9ySW5rLWVkaXRpbmctY3Vyc29yOnVybChpbWFnZXMvY3Vyc29yLWVkaXRvckluay5zdmcpIDAgMTYsIHBvaW50ZXI7CiAgLS1lZGl0b3JIaWdobGlnaHQtZWRpdGluZy1jdXJzb3I6dXJsKGltYWdlcy9jdXJzb3ItZWRpdG9yVGV4dEhpZ2hsaWdodC5zdmcpIDI0IDI0LCB0ZXh0OwogIC0tZWRpdG9yRnJlZUhpZ2hsaWdodC1lZGl0aW5nLWN1cnNvcjp1cmwoaW1hZ2VzL2N1cnNvci1lZGl0b3JGcmVlSGlnaGxpZ2h0LnN2ZykgMSAxOCwgcG9pbnRlcjsKCiAgLS1uZXctYWx0LXRleHQtd2FybmluZy1pbWFnZTp1cmwoaW1hZ2VzL2FsdFRleHRfd2FybmluZy5zdmcpOwp9Ci52aXN1YWxseUhpZGRlbnsKICBwb3NpdGlvbjphYnNvbHV0ZTsKICB0b3A6MDsKICBsZWZ0OjA7CiAgYm9yZGVyOjA7CiAgbWFyZ2luOjA7CiAgcGFkZGluZzowOwogIHdpZHRoOjA7CiAgaGVpZ2h0OjA7CiAgb3ZlcmZsb3c6aGlkZGVuOwogIHdoaXRlLXNwYWNlOm5vd3JhcDsKICBmb250LXNpemU6MDsKfQoKLnRleHRMYXllci5oaWdobGlnaHRpbmd7CiAgICBjdXJzb3I6dmFyKC0tZWRpdG9yRnJlZUhpZ2hsaWdodC1lZGl0aW5nLWN1cnNvcik7CiAgfQoKLnRleHRMYXllci5oaWdobGlnaHRpbmc6bm90KC5mcmVlKSBzcGFuewogICAgICBjdXJzb3I6dmFyKC0tZWRpdG9ySGlnaGxpZ2h0LWVkaXRpbmctY3Vyc29yKTsKICAgIH0KCltyb2xlPSJpbWciXTppcygudGV4dExheWVyLmhpZ2hsaWdodGluZzpub3QoLmZyZWUpIHNwYW4pewogICAgICAgIGN1cnNvcjp2YXIoLS1lZGl0b3JGcmVlSGlnaGxpZ2h0LWVkaXRpbmctY3Vyc29yKTsKICAgICAgfQoKLnRleHRMYXllci5oaWdobGlnaHRpbmcuZnJlZSBzcGFuewogICAgICBjdXJzb3I6dmFyKC0tZWRpdG9yRnJlZUhpZ2hsaWdodC1lZGl0aW5nLWN1cnNvcik7CiAgICB9Cgo6aXMoI3ZpZXdlckNvbnRhaW5lci5wZGZQcmVzZW50YXRpb25Nb2RlOmZ1bGxzY3JlZW4sLmFubm90YXRpb25FZGl0b3JMYXllci5kaXNhYmxlZCkgLm5vQWx0VGV4dEJhZGdlewogICAgZGlzcGxheTpub25lICFpbXBvcnRhbnQ7CiAgfQoKQG1lZGlhIChtaW4tcmVzb2x1dGlvbjogMS4xZHBweCl7CiAgOnJvb3R7CiAgICAtLWVkaXRvckZyZWVUZXh0LWVkaXRpbmctY3Vyc29yOnVybChpbWFnZXMvY3Vyc29yLWVkaXRvckZyZWVUZXh0LnN2ZykgMCAxNiwgdGV4dDsKICB9Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewogIDpyb290ewogICAgLS1vdXRsaW5lLWNvbG9yOkNhbnZhc1RleHQ7CiAgICAtLW91dGxpbmUtYXJvdW5kLWNvbG9yOkJ1dHRvbkZhY2U7CiAgICAtLXJlc2l6ZXItYmctY29sb3I6QnV0dG9uVGV4dDsKICAgIC0taG92ZXItb3V0bGluZS1jb2xvcjpIaWdobGlnaHQ7CiAgICAtLWhvdmVyLW91dGxpbmUtYXJvdW5kLWNvbG9yOlNlbGVjdGVkSXRlbVRleHQ7CiAgfQp9CgpbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl17CiAgdHJhbnNmb3JtOnJvdGF0ZSg5MGRlZyk7Cn0KCltkYXRhLWVkaXRvci1yb3RhdGlvbj0iMTgwIl17CiAgdHJhbnNmb3JtOnJvdGF0ZSgxODBkZWcpOwp9CgpbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdewogIHRyYW5zZm9ybTpyb3RhdGUoMjcwZGVnKTsKfQoKLmFubm90YXRpb25FZGl0b3JMYXllcnsKICBiYWNrZ3JvdW5kOnRyYW5zcGFyZW50OwogIHBvc2l0aW9uOmFic29sdXRlOwogIGluc2V0OjA7CiAgZm9udC1zaXplOmNhbGMoMTAwcHggKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKTsKICB0cmFuc2Zvcm0tb3JpZ2luOjAgMDsKICBjdXJzb3I6YXV0bzsKfQoKLmFubm90YXRpb25FZGl0b3JMYXllciAuc2VsZWN0ZWRFZGl0b3J7CiAgICB6LWluZGV4OjEwMDAwMCAhaW1wb3J0YW50OwogIH0KCi5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIuZHJhd2luZyAqewogICAgcG9pbnRlci1ldmVudHM6bm9uZSAhaW1wb3J0YW50OwogIH0KCi5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIud2FpdGluZ3sKICBjb250ZW50OiIiOwogIGN1cnNvcjp3YWl0OwogIHBvc2l0aW9uOmFic29sdXRlOwogIGluc2V0OjA7CiAgd2lkdGg6MTAwJTsKICBoZWlnaHQ6MTAwJTsKfQoKLmFubm90YXRpb25FZGl0b3JMYXllci5kaXNhYmxlZHsKICBwb2ludGVyLWV2ZW50czpub25lOwp9CgouYW5ub3RhdGlvbkVkaXRvckxheWVyLmRpc2FibGVkLmhpZ2hsaWdodEVkaXRpbmcgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKXsKICAgIHBvaW50ZXItZXZlbnRzOmF1dG87CiAgfQoKLmFubm90YXRpb25FZGl0b3JMYXllci5mcmVldGV4dEVkaXRpbmd7CiAgY3Vyc29yOnZhcigtLWVkaXRvckZyZWVUZXh0LWVkaXRpbmctY3Vyc29yKTsKfQoKLmFubm90YXRpb25FZGl0b3JMYXllci5pbmtFZGl0aW5newogIGN1cnNvcjp2YXIoLS1lZGl0b3JJbmstZWRpdGluZy1jdXJzb3IpOwp9CgouYW5ub3RhdGlvbkVkaXRvckxheWVyIC5kcmF3ewogIGJveC1zaXppbmc6Ym9yZGVyLWJveDsKfQoKLmFubm90YXRpb25FZGl0b3JMYXllcgogIDppcyguZnJlZVRleHRFZGl0b3IsIC5pbmtFZGl0b3IsIC5zdGFtcEVkaXRvciwgLnNpZ25hdHVyZUVkaXRvcil7CiAgcG9zaXRpb246YWJzb2x1dGU7CiAgYmFja2dyb3VuZDp0cmFuc3BhcmVudDsKICB6LWluZGV4OjE7CiAgdHJhbnNmb3JtLW9yaWdpbjowIDA7CiAgY3Vyc29yOmF1dG87CiAgbWF4LXdpZHRoOjEwMCU7CiAgbWF4LWhlaWdodDoxMDAlOwogIGJvcmRlcjp2YXIoLS11bmZvY3VzLW91dGxpbmUpOwp9CgouZHJhZ2dhYmxlLnNlbGVjdGVkRWRpdG9yOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSl7CiAgICBjdXJzb3I6bW92ZTsKICB9Cgouc2VsZWN0ZWRFZGl0b3I6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpKXsKICAgIGJvcmRlcjp2YXIoLS1mb2N1cy1vdXRsaW5lKTsKICAgIG91dGxpbmU6dmFyKC0tZm9jdXMtb3V0bGluZS1hcm91bmQpOwogIH0KCi5zZWxlY3RlZEVkaXRvcjppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLnNpZ25hdHVyZUVkaXRvcikpOjpiZWZvcmV7CiAgICAgIGNvbnRlbnQ6IiI7CiAgICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgICBpbnNldDowOwogICAgICBib3JkZXI6dmFyKC0tZm9jdXMtb3V0bGluZS1hcm91bmQpOwogICAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgfQoKOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSk6aG92ZXI6bm90KC5zZWxlY3RlZEVkaXRvcil7CiAgICBib3JkZXI6dmFyKC0taG92ZXItb3V0bGluZSk7CiAgICBvdXRsaW5lOnZhcigtLWhvdmVyLW91dGxpbmUtYXJvdW5kKTsKICB9Cgo6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpKTpob3Zlcjpub3QoLnNlbGVjdGVkRWRpdG9yKTo6YmVmb3JlewogICAgICBjb250ZW50OiIiOwogICAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgICAgaW5zZXQ6MDsKICAgICAgYm9yZGVyOnZhcigtLWZvY3VzLW91dGxpbmUtYXJvdW5kKTsKICAgIH0KCjppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXJ7CiAgICAtLWVkaXRvci10b29sYmFyLWRlbGV0ZS1pbWFnZTp1cmwoaW1hZ2VzL2VkaXRvci10b29sYmFyLWRlbGV0ZS5zdmcpOwogICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzU6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzJiMmEzMzsKICAgIC0tZWRpdG9yLXRvb2xiYXItYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTc1LCAjZjBmMGY0KTsKICAgIC0tZWRpdG9yLXRvb2xiYXItaGlnaGxpZ2h0LWltYWdlOnVybChpbWFnZXMvdG9vbGJhckJ1dHRvbi1lZGl0b3JIaWdobGlnaHQuc3ZnKTsKICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTc2OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICNmYmZiZmU7CiAgICAtLWVkaXRvci10b29sYmFyLWZnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03NiwgIzJlMmU1Nik7CiAgICAtLWVkaXRvci10b29sYmFyLWJvcmRlci1jb2xvcjojOGY4ZjlkOwogICAgLS1lZGl0b3ItdG9vbGJhci1ob3Zlci1ib3JkZXItY29sb3I6dmFyKC0tZWRpdG9yLXRvb2xiYXItYm9yZGVyLWNvbG9yKTsKICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTc3OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICM1MjUyNWU7CiAgICAtLWVkaXRvci10b29sYmFyLWhvdmVyLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03NywgI2UwZTBlNik7CiAgICAtLWVkaXRvci10b29sYmFyLWhvdmVyLWZnLWNvbG9yOnZhcigtLWVkaXRvci10b29sYmFyLWZnLWNvbG9yKTsKICAgIC0tZWRpdG9yLXRvb2xiYXItaG92ZXItb3V0bGluZTpub25lOwogICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzBkZjsKICAgIC0tZWRpdG9yLXRvb2xiYXItZm9jdXMtb3V0bGluZS1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzgsICMwMDYwZGYpOwogICAgLS1lZGl0b3ItdG9vbGJhci1zaGFkb3c6MCAycHggNnB4IDAgcmdiKDU4IDU3IDY4IC8gMC4yKTsKICAgIC0tZWRpdG9yLXRvb2xiYXItdmVydC1vZmZzZXQ6NnB4OwogICAgLS1lZGl0b3ItdG9vbGJhci1oZWlnaHQ6MjhweDsKICAgIC0tZWRpdG9yLXRvb2xiYXItcGFkZGluZzoycHg7CiAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03OTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNTRmZmJkOwogICAgLS1hbHQtdGV4dC1kb25lLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03OSwgIzJhYzNhMik7CiAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04MDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjODBlYmZmOwogICAgLS1hbHQtdGV4dC13YXJuaW5nLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04MCwgIzAwOTBlZCk7CiAgICAtLWFsdC10ZXh0LWhvdmVyLWRvbmUtY29sb3I6dmFyKC0tYWx0LXRleHQtZG9uZS1jb2xvcik7CiAgICAtLWFsdC10ZXh0LWhvdmVyLXdhcm5pbmctY29sb3I6dmFyKC0tYWx0LXRleHQtd2FybmluZy1jb2xvcik7CiAgfQoKQHN1cHBvcnRzIChjb2xvcjogbGlnaHQtZGFyayhyZWQsIHJlZCkpewo6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyewogICAgLS1lZGl0b3ItdG9vbGJhci1iZy1jb2xvcjpsaWdodC1kYXJrKCNmMGYwZjQsICMyYjJhMzMpOwogICAgLS1lZGl0b3ItdG9vbGJhci1mZy1jb2xvcjpsaWdodC1kYXJrKCMyZTJlNTYsICNmYmZiZmUpOwogICAgLS1lZGl0b3ItdG9vbGJhci1ob3Zlci1iZy1jb2xvcjpsaWdodC1kYXJrKCNlMGUwZTYsICM1MjUyNWUpOwogICAgLS1lZGl0b3ItdG9vbGJhci1mb2N1cy1vdXRsaW5lLWNvbG9yOmxpZ2h0LWRhcmsoIzAwNjBkZiwgIzBkZik7CiAgICAtLWFsdC10ZXh0LWRvbmUtY29sb3I6bGlnaHQtZGFyaygjMmFjM2EyLCAjNTRmZmJkKTsKICAgIC0tYWx0LXRleHQtd2FybmluZy1jb2xvcjpsaWdodC1kYXJrKCMwMDkwZWQsICM4MGViZmYpOwogIH0KfQoKQHN1cHBvcnRzIG5vdCAoY29sb3I6IGxpZ2h0LWRhcmsodGFuLCB0YW4pKXsKCjppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKSAqewogICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzU6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzJiMmEzMzsKICAgIC0tZWRpdG9yLXRvb2xiYXItYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTc1LCAjZjBmMGY0KTsKICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTc2OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICNmYmZiZmU7CiAgICAtLWVkaXRvci10b29sYmFyLWZnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03NiwgIzJlMmU1Nik7CiAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03Nzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNTI1MjVlOwogICAgLS1lZGl0b3ItdG9vbGJhci1ob3Zlci1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzcsICNlMGUwZTYpOwogICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzBkZjsKICAgIC0tZWRpdG9yLXRvb2xiYXItZm9jdXMtb3V0bGluZS1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzgsICMwMDYwZGYpOwogICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzk6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzU0ZmZiZDsKICAgIC0tYWx0LXRleHQtZG9uZS1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNzksICMyYWMzYTIpOwogICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODA6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzgwZWJmZjsKICAgIC0tYWx0LXRleHQtd2FybmluZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODAsICMwMDkwZWQpOwogIH0KfQoKQG1lZGlhIHNjcmVlbiBhbmQgKGZvcmNlZC1jb2xvcnM6IGFjdGl2ZSl7Cgo6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyewogICAgICAtLWVkaXRvci10b29sYmFyLWJnLWNvbG9yOkJ1dHRvbkZhY2U7CiAgICAgIC0tZWRpdG9yLXRvb2xiYXItZmctY29sb3I6QnV0dG9uVGV4dDsKICAgICAgLS1lZGl0b3ItdG9vbGJhci1ib3JkZXItY29sb3I6QnV0dG9uVGV4dDsKICAgICAgLS1lZGl0b3ItdG9vbGJhci1ob3Zlci1ib3JkZXItY29sb3I6QWNjZW50Q29sb3I7CiAgICAgIC0tZWRpdG9yLXRvb2xiYXItaG92ZXItYmctY29sb3I6QnV0dG9uRmFjZTsKICAgICAgLS1lZGl0b3ItdG9vbGJhci1ob3Zlci1mZy1jb2xvcjpBY2NlbnRDb2xvcjsKICAgICAgLS1lZGl0b3ItdG9vbGJhci1ob3Zlci1vdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1lZGl0b3ItdG9vbGJhci1ob3Zlci1ib3JkZXItY29sb3IpOwogICAgICAtLWVkaXRvci10b29sYmFyLWZvY3VzLW91dGxpbmUtY29sb3I6QnV0dG9uQm9yZGVyOwogICAgICAtLWVkaXRvci10b29sYmFyLXNoYWRvdzpub25lOwogICAgICAtLWFsdC10ZXh0LWRvbmUtY29sb3I6dmFyKC0tZWRpdG9yLXRvb2xiYXItZmctY29sb3IpOwogICAgICAtLWFsdC10ZXh0LXdhcm5pbmctY29sb3I6dmFyKC0tZWRpdG9yLXRvb2xiYXItZmctY29sb3IpOwogICAgICAtLWFsdC10ZXh0LWhvdmVyLWRvbmUtY29sb3I6dmFyKC0tZWRpdG9yLXRvb2xiYXItaG92ZXItZmctY29sb3IpOwogICAgICAtLWFsdC10ZXh0LWhvdmVyLXdhcm5pbmctY29sb3I6dmFyKC0tZWRpdG9yLXRvb2xiYXItaG92ZXItZmctY29sb3IpOwogIH0KICAgIH0KCjppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXJ7CgogICAgZGlzcGxheTpmbGV4OwogICAgd2lkdGg6LW1vei1maXQtY29udGVudDsKICAgIHdpZHRoOmZpdC1jb250ZW50OwogICAgaGVpZ2h0OnZhcigtLWVkaXRvci10b29sYmFyLWhlaWdodCk7CiAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgY3Vyc29yOmRlZmF1bHQ7CiAgICBwb2ludGVyLWV2ZW50czphdXRvOwogICAgYm94LXNpemluZzpjb250ZW50LWJveDsKICAgIHBhZGRpbmc6dmFyKC0tZWRpdG9yLXRvb2xiYXItcGFkZGluZyk7CgogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICBpbnNldC1pbmxpbmUtZW5kOjA7CiAgICBpbnNldC1ibG9jay1zdGFydDpjYWxjKDEwMCUgKyB2YXIoLS1lZGl0b3ItdG9vbGJhci12ZXJ0LW9mZnNldCkpOwoKICAgIGJvcmRlci1yYWRpdXM6NnB4OwogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1lZGl0b3ItdG9vbGJhci1iZy1jb2xvcik7CiAgICBib3JkZXI6MXB4IHNvbGlkIHZhcigtLWVkaXRvci10b29sYmFyLWJvcmRlci1jb2xvcik7CiAgICBib3gtc2hhZG93OnZhcigtLWVkaXRvci10b29sYmFyLXNoYWRvdyk7CiAgfQoKLmhpZGRlbjppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKXsKICAgICAgZGlzcGxheTpub25lOwogICAgfQoKOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpOmhhcyg6Zm9jdXMtdmlzaWJsZSl7CiAgICAgIGJvcmRlci1jb2xvcjp0cmFuc3BhcmVudDsKICAgIH0KCltkaXI9Imx0ciJdIDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKXsKICAgICAgdHJhbnNmb3JtLW9yaWdpbjoxMDAlIDA7CiAgICB9CgpbZGlyPSJydGwiXSA6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuaGlnaGxpZ2h0RWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpLC50ZXh0TGF5ZXIpIC5lZGl0VG9vbGJhcil7CiAgICAgIHRyYW5zZm9ybS1vcmlnaW46MCAwOwogICAgfQoKOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgZ2FwOjA7CiAgICAgIGhlaWdodDoxMDAlOwogICAgfQoKOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgYnV0dG9uewogICAgICAgIHBhZGRpbmc6MDsKICAgICAgfQoKOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmRpdmlkZXJ7CiAgICAgICAgd2lkdGg6MDsKICAgICAgICBoZWlnaHQ6Y2FsYygKICAgICAgICAgIDIgKiB2YXIoLS1lZGl0b3ItdG9vbGJhci1wYWRkaW5nKSArIHZhcigtLWVkaXRvci10b29sYmFyLWhlaWdodCkKICAgICAgICApOwogICAgICAgIGJvcmRlci1sZWZ0OjFweCBzb2xpZCB2YXIoLS1lZGl0b3ItdG9vbGJhci1ib3JkZXItY29sb3IpOwogICAgICAgIGJvcmRlci1yaWdodDpub25lOwogICAgICAgIGRpc3BsYXk6aW5saW5lLWJsb2NrOwogICAgICAgIG1hcmdpbi1pbmxpbmU6MnB4OwogICAgICB9Cgo6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuaGlnaGxpZ2h0QnV0dG9uewogICAgICAgIHdpZHRoOnZhcigtLWVkaXRvci10b29sYmFyLWhlaWdodCk7CiAgICAgIH0KCjppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuaGlnaGxpZ2h0QnV0dG9uKTo6YmVmb3JlewogICAgICAgICAgY29udGVudDoiIjsKICAgICAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1lZGl0b3ItdG9vbGJhci1oaWdobGlnaHQtaW1hZ2UpOwogICAgICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLWVkaXRvci10b29sYmFyLWhpZ2hsaWdodC1pbWFnZSk7CiAgICAgICAgICAtd2Via2l0LW1hc2stcmVwZWF0Om5vLXJlcGVhdDsKICAgICAgICAgICAgICAgICAgbWFzay1yZXBlYXQ6bm8tcmVwZWF0OwogICAgICAgICAgLXdlYmtpdC1tYXNrLXBvc2l0aW9uOmNlbnRlcjsKICAgICAgICAgICAgICAgICAgbWFzay1wb3NpdGlvbjpjZW50ZXI7CiAgICAgICAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tZWRpdG9yLXRvb2xiYXItZmctY29sb3IpOwogICAgICAgICAgd2lkdGg6MTAwJTsKICAgICAgICAgIGhlaWdodDoxMDAlOwogICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuaGlnaGxpZ2h0QnV0dG9uKTpob3Zlcjo6YmVmb3JlewogICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1lZGl0b3ItdG9vbGJhci1ob3Zlci1mZy1jb2xvcik7CiAgICAgICAgfQoKOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmRlbGV0ZXsKICAgICAgICB3aWR0aDp2YXIoLS1lZGl0b3ItdG9vbGJhci1oZWlnaHQpOwogICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmRlbGV0ZSk6OmJlZm9yZXsKICAgICAgICAgIGNvbnRlbnQ6IiI7CiAgICAgICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tZWRpdG9yLXRvb2xiYXItZGVsZXRlLWltYWdlKTsKICAgICAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1lZGl0b3ItdG9vbGJhci1kZWxldGUtaW1hZ2UpOwogICAgICAgICAgLXdlYmtpdC1tYXNrLXJlcGVhdDpuby1yZXBlYXQ7CiAgICAgICAgICAgICAgICAgIG1hc2stcmVwZWF0Om5vLXJlcGVhdDsKICAgICAgICAgIC13ZWJraXQtbWFzay1wb3NpdGlvbjpjZW50ZXI7CiAgICAgICAgICAgICAgICAgIG1hc2stcG9zaXRpb246Y2VudGVyOwogICAgICAgICAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWVkaXRvci10b29sYmFyLWZnLWNvbG9yKTsKICAgICAgICAgIHdpZHRoOjEwMCU7CiAgICAgICAgICBoZWlnaHQ6MTAwJTsKICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmRlbGV0ZSk6aG92ZXI6OmJlZm9yZXsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tZWRpdG9yLXRvb2xiYXItaG92ZXItZmctY29sb3IpOwogICAgICAgIH0KCjppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuaGlnaGxpZ2h0RWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpLC50ZXh0TGF5ZXIpIC5lZGl0VG9vbGJhcikgLmJ1dHRvbnMpICA+ICp7CiAgICAgICAgaGVpZ2h0OnZhcigtLWVkaXRvci10b29sYmFyLWhlaWdodCk7CiAgICAgIH0KCjppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuaGlnaGxpZ2h0RWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpLC50ZXh0TGF5ZXIpIC5lZGl0VG9vbGJhcikgLmJ1dHRvbnMpICA+IDpub3QoLmRpdmlkZXIpewogICAgICAgIGJvcmRlcjpub25lOwogICAgICAgIGJhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7CiAgICAgICAgY3Vyc29yOnBvaW50ZXI7CiAgICAgIH0KCjppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSA+IDpub3QoLmRpdmlkZXIpKTpob3ZlcnsKICAgICAgICAgIGJvcmRlci1yYWRpdXM6MnB4OwogICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1lZGl0b3ItdG9vbGJhci1ob3Zlci1iZy1jb2xvcik7CiAgICAgICAgICBjb2xvcjp2YXIoLS1lZGl0b3ItdG9vbGJhci1ob3Zlci1mZy1jb2xvcik7CiAgICAgICAgICBvdXRsaW5lOnZhcigtLWVkaXRvci10b29sYmFyLWhvdmVyLW91dGxpbmUpOwogICAgICAgICAgb3V0bGluZS1vZmZzZXQ6MXB4OwogICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSA+IDpub3QoLmRpdmlkZXIpKTpob3ZlcjphY3RpdmV7CiAgICAgICAgICAgIG91dGxpbmU6bm9uZTsKICAgICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSA+IDpub3QoLmRpdmlkZXIpKTpmb2N1cy12aXNpYmxlewogICAgICAgICAgYm9yZGVyLXJhZGl1czoycHg7CiAgICAgICAgICBvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1lZGl0b3ItdG9vbGJhci1mb2N1cy1vdXRsaW5lLWNvbG9yKTsKICAgICAgICB9Cgo6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuYWx0VGV4dHsKICAgICAgICAtLWFsdC10ZXh0LWFkZC1pbWFnZTp1cmwoaW1hZ2VzL2FsdFRleHRfYWRkLnN2Zyk7CiAgICAgICAgLS1hbHQtdGV4dC1kb25lLWltYWdlOnVybChpbWFnZXMvYWx0VGV4dF9kb25lLnN2Zyk7CgogICAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICAgICAgICB3aWR0aDotbW96LW1heC1jb250ZW50OwogICAgICAgIHdpZHRoOm1heC1jb250ZW50OwogICAgICAgIHBhZGRpbmctaW5saW5lOjhweDsKICAgICAgICBwb2ludGVyLWV2ZW50czphbGw7CiAgICAgICAgZm9udDptZW51OwogICAgICAgIGZvbnQtd2VpZ2h0OjU5MDsKICAgICAgICBmb250LXNpemU6MTJweDsKICAgICAgICBjb2xvcjp2YXIoLS1lZGl0b3ItdG9vbGJhci1mZy1jb2xvcik7CiAgICAgIH0KCjppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuYWx0VGV4dCk6ZGlzYWJsZWR7CiAgICAgICAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuYWx0VGV4dCk6OmJlZm9yZXsKICAgICAgICAgIGNvbnRlbnQ6IiI7CiAgICAgICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tYWx0LXRleHQtYWRkLWltYWdlKTsKICAgICAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1hbHQtdGV4dC1hZGQtaW1hZ2UpOwogICAgICAgICAgLXdlYmtpdC1tYXNrLXJlcGVhdDpuby1yZXBlYXQ7CiAgICAgICAgICAgICAgICAgIG1hc2stcmVwZWF0Om5vLXJlcGVhdDsKICAgICAgICAgIC13ZWJraXQtbWFzay1wb3NpdGlvbjpjZW50ZXI7CiAgICAgICAgICAgICAgICAgIG1hc2stcG9zaXRpb246Y2VudGVyOwogICAgICAgICAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgICAgICAgICB3aWR0aDoxMnB4OwogICAgICAgICAgaGVpZ2h0OjEzcHg7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWVkaXRvci10b29sYmFyLWZnLWNvbG9yKTsKICAgICAgICAgIG1hcmdpbi1pbmxpbmUtZW5kOjRweDsKICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmFsdFRleHQpOmhvdmVyOjpiZWZvcmV7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWVkaXRvci10b29sYmFyLWhvdmVyLWZnLWNvbG9yKTsKICAgICAgICB9CgouZG9uZTppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuYWx0VGV4dCk6OmJlZm9yZXsKICAgICAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1hbHQtdGV4dC1kb25lLWltYWdlKTsKICAgICAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1hbHQtdGV4dC1kb25lLWltYWdlKTsKICAgICAgICB9CgoubmV3OmlzKDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuaGlnaGxpZ2h0RWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpLC50ZXh0TGF5ZXIpIC5lZGl0VG9vbGJhcikgLmJ1dHRvbnMpIC5hbHRUZXh0KTo6YmVmb3JlewogICAgICAgICAgICB3aWR0aDoxNnB4OwogICAgICAgICAgICBoZWlnaHQ6MTZweDsKICAgICAgICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLW5ldy1hbHQtdGV4dC13YXJuaW5nLWltYWdlKTsKICAgICAgICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLW5ldy1hbHQtdGV4dC13YXJuaW5nLWltYWdlKTsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1hbHQtdGV4dC13YXJuaW5nLWNvbG9yKTsKICAgICAgICAgICAgLXdlYmtpdC1tYXNrLXNpemU6Y292ZXI7CiAgICAgICAgICAgICAgICAgICAgbWFzay1zaXplOmNvdmVyOwogICAgICAgICAgfQoKLm5ldzppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuYWx0VGV4dCk6aG92ZXI6OmJlZm9yZXsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1hbHQtdGV4dC1ob3Zlci13YXJuaW5nLWNvbG9yKTsKICAgICAgICAgIH0KCi5uZXcuZG9uZTppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuYWx0VGV4dCk6OmJlZm9yZXsKICAgICAgICAgICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tYWx0LXRleHQtZG9uZS1pbWFnZSk7CiAgICAgICAgICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLWFsdC10ZXh0LWRvbmUtaW1hZ2UpOwogICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tYWx0LXRleHQtZG9uZS1jb2xvcik7CiAgICAgICAgICAgIH0KCi5uZXcuZG9uZTppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuYWx0VGV4dCk6aG92ZXI6OmJlZm9yZXsKICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWFsdC10ZXh0LWhvdmVyLWRvbmUtY29sb3IpOwogICAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmFsdFRleHQpIC50b29sdGlwewogICAgICAgICAgZGlzcGxheTpub25lOwogICAgICAgICAgd29yZC13cmFwOmFueXdoZXJlOwogICAgICAgIH0KCi5zaG93OmlzKDppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuYWx0VGV4dCkgLnRvb2x0aXApewogICAgICAgICAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04MTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMWMxYjIyOwogICAgICAgICAgICAtLWFsdC10ZXh0LXRvb2x0aXAtYmc6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTgxLCAjZjBmMGY0KTsKICAgICAgICAgICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODI6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2ZiZmJmZTsKICAgICAgICAgICAgLS1hbHQtdGV4dC10b29sdGlwLWZnOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04MiwgIzE1MTQxYSk7CiAgICAgICAgICAgIC0tYWx0LXRleHQtdG9vbHRpcC1ib3JkZXI6IzhmOGY5ZDsKICAgICAgICAgICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODM6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzE1MTQxYTsKICAgICAgICAgICAgLS1hbHQtdGV4dC10b29sdGlwLXNoYWRvdzowcHggMnB4IDZweCAwcHggdmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTgzLCByZ2IoNTggNTcgNjggLyAwLjIpKTsKICAgICAgICAgIH0KCkBzdXBwb3J0cyAoY29sb3I6IGxpZ2h0LWRhcmsocmVkLCByZWQpKXsKLnNob3c6aXMoOmlzKDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuaGlnaGxpZ2h0RWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpLC50ZXh0TGF5ZXIpIC5lZGl0VG9vbGJhcikgLmJ1dHRvbnMpIC5hbHRUZXh0KSAudG9vbHRpcCl7CiAgICAgICAgICAgIC0tYWx0LXRleHQtdG9vbHRpcC1iZzpsaWdodC1kYXJrKCNmMGYwZjQsICMxYzFiMjIpOwogICAgICAgICAgICAtLWFsdC10ZXh0LXRvb2x0aXAtZmc6bGlnaHQtZGFyaygjMTUxNDFhLCAjZmJmYmZlKTsKICAgICAgICAgIH0KfQoKQHN1cHBvcnRzIChjb2xvcjogbGlnaHQtZGFyayhyZWQsIHJlZCkpIGFuZCAoY29sb3I6IHJnYigwIDAgMCAvIDApKXsKLnNob3c6aXMoOmlzKDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuaGlnaGxpZ2h0RWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpLC50ZXh0TGF5ZXIpIC5lZGl0VG9vbGJhcikgLmJ1dHRvbnMpIC5hbHRUZXh0KSAudG9vbHRpcCl7CiAgICAgICAgICAgIC0tYWx0LXRleHQtdG9vbHRpcC1zaGFkb3c6MHB4IDJweCA2cHggMHB4IGxpZ2h0LWRhcmsocmdiKDU4IDU3IDY4IC8gMC4yKSwgIzE1MTQxYSk7CiAgICAgICAgICB9Cn0KCkBzdXBwb3J0cyBub3QgKGNvbG9yOiBsaWdodC1kYXJrKHRhbiwgdGFuKSl7Cgouc2hvdzppcyg6aXMoOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5oaWdobGlnaHRFZGl0b3IsLnNpZ25hdHVyZUVkaXRvciksLnRleHRMYXllcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmFsdFRleHQpIC50b29sdGlwKSAqewogICAgICAgICAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04MTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMWMxYjIyOwogICAgICAgICAgICAtLWFsdC10ZXh0LXRvb2x0aXAtYmc6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTgxLCAjZjBmMGY0KTsKICAgICAgICAgICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODI6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgI2ZiZmJmZTsKICAgICAgICAgICAgLS1hbHQtdGV4dC10b29sdGlwLWZnOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04MiwgIzE1MTQxYSk7CiAgICAgICAgICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTgzOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICMxNTE0MWE7CiAgICAgICAgICAgIC0tYWx0LXRleHQtdG9vbHRpcC1zaGFkb3c6MHB4IDJweCA2cHggMHB4IHZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04MywgcmdiKDU4IDU3IDY4IC8gMC4yKSk7CiAgfQp9CgpAbWVkaWEgc2NyZWVuIGFuZCAoZm9yY2VkLWNvbG9yczogYWN0aXZlKXsKCi5zaG93OmlzKDppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLmhpZ2hsaWdodEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSwudGV4dExheWVyKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuYWx0VGV4dCkgLnRvb2x0aXApewogICAgICAgICAgICAgIC0tYWx0LXRleHQtdG9vbHRpcC1iZzpDYW52YXM7CiAgICAgICAgICAgICAgLS1hbHQtdGV4dC10b29sdGlwLWZnOkNhbnZhc1RleHQ7CiAgICAgICAgICAgICAgLS1hbHQtdGV4dC10b29sdGlwLWJvcmRlcjpDYW52YXNUZXh0OwogICAgICAgICAgICAgIC0tYWx0LXRleHQtdG9vbHRpcC1zaGFkb3c6bm9uZTsKICAgICAgICAgIH0KICAgICAgICAgICAgfQoKLnNob3c6aXMoOmlzKDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuaGlnaGxpZ2h0RWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpLC50ZXh0TGF5ZXIpIC5lZGl0VG9vbGJhcikgLmJ1dHRvbnMpIC5hbHRUZXh0KSAudG9vbHRpcCl7CgogICAgICAgICAgICBkaXNwbGF5OmlubGluZS1mbGV4OwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICAgICAgICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgICAgICAgIHRvcDpjYWxjKDEwMCUgKyAycHgpOwogICAgICAgICAgICBpbnNldC1pbmxpbmUtc3RhcnQ6MDsKICAgICAgICAgICAgcGFkZGluZy1ibG9jazoycHggM3B4OwogICAgICAgICAgICBwYWRkaW5nLWlubGluZTozcHg7CiAgICAgICAgICAgIG1heC13aWR0aDozMDBweDsKICAgICAgICAgICAgd2lkdGg6LW1vei1tYXgtY29udGVudDsKICAgICAgICAgICAgd2lkdGg6bWF4LWNvbnRlbnQ7CiAgICAgICAgICAgIGhlaWdodDphdXRvOwogICAgICAgICAgICBmb250LXNpemU6MTJweDsKCiAgICAgICAgICAgIGJvcmRlcjowLjVweCBzb2xpZCB2YXIoLS1hbHQtdGV4dC10b29sdGlwLWJvcmRlcik7CiAgICAgICAgICAgIGJhY2tncm91bmQ6dmFyKC0tYWx0LXRleHQtdG9vbHRpcC1iZyk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6dmFyKC0tYWx0LXRleHQtdG9vbHRpcC1zaGFkb3cpOwogICAgICAgICAgICBjb2xvcjp2YXIoLS1hbHQtdGV4dC10b29sdGlwLWZnKTsKCiAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICAgICAgICB9CgouYW5ub3RhdGlvbkVkaXRvckxheWVyIC5mcmVlVGV4dEVkaXRvcnsKICBwYWRkaW5nOmNhbGModmFyKC0tZnJlZXRleHQtcGFkZGluZykgKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKTsKICB3aWR0aDphdXRvOwogIGhlaWdodDphdXRvOwogIHRvdWNoLWFjdGlvbjpub25lOwp9CgouYW5ub3RhdGlvbkVkaXRvckxheWVyIC5mcmVlVGV4dEVkaXRvciAuaW50ZXJuYWx7CiAgYmFja2dyb3VuZDp0cmFuc3BhcmVudDsKICBib3JkZXI6bm9uZTsKICBpbnNldDowOwogIG92ZXJmbG93OnZpc2libGU7CiAgd2hpdGUtc3BhY2U6bm93cmFwOwogIGZvbnQ6MTBweCBzYW5zLXNlcmlmOwogIGxpbmUtaGVpZ2h0OnZhcigtLWZyZWV0ZXh0LWxpbmUtaGVpZ2h0KTsKICAtd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgLW1vei11c2VyLXNlbGVjdDpub25lOwogICAgICAgICAgdXNlci1zZWxlY3Q6bm9uZTsKfQoKLmFubm90YXRpb25FZGl0b3JMYXllciAuZnJlZVRleHRFZGl0b3IgLm92ZXJsYXl7CiAgcG9zaXRpb246YWJzb2x1dGU7CiAgZGlzcGxheTpub25lOwogIGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7CiAgaW5zZXQ6MDsKICB3aWR0aDoxMDAlOwogIGhlaWdodDoxMDAlOwp9CgouYW5ub3RhdGlvbkVkaXRvckxheWVyIGZyZWVUZXh0RWRpdG9yIC5vdmVybGF5LmVuYWJsZWR7CiAgZGlzcGxheTpibG9jazsKfQoKLmFubm90YXRpb25FZGl0b3JMYXllciAuZnJlZVRleHRFZGl0b3IgLmludGVybmFsOmVtcHR5OjpiZWZvcmV7CiAgY29udGVudDphdHRyKGRlZmF1bHQtY29udGVudCk7CiAgY29sb3I6Z3JheTsKfQoKLmFubm90YXRpb25FZGl0b3JMYXllciAuZnJlZVRleHRFZGl0b3IgLmludGVybmFsOmZvY3VzewogIG91dGxpbmU6bm9uZTsKICAtd2Via2l0LXVzZXItc2VsZWN0OmF1dG87CiAgICAgLW1vei11c2VyLXNlbGVjdDphdXRvOwogICAgICAgICAgdXNlci1zZWxlY3Q6YXV0bzsKfQoKLmFubm90YXRpb25FZGl0b3JMYXllciAuaW5rRWRpdG9yewogIHdpZHRoOjEwMCU7CiAgaGVpZ2h0OjEwMCU7Cn0KCi5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLmlua0VkaXRvci5lZGl0aW5newogIGN1cnNvcjppbmhlcml0Owp9CgouYW5ub3RhdGlvbkVkaXRvckxheWVyIC5pbmtFZGl0b3IgLmlua0VkaXRvckNhbnZhc3sKICBwb3NpdGlvbjphYnNvbHV0ZTsKICBpbnNldDowOwogIHdpZHRoOjEwMCU7CiAgaGVpZ2h0OjEwMCU7CiAgdG91Y2gtYWN0aW9uOm5vbmU7Cn0KCi5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLnN0YW1wRWRpdG9yewogIHdpZHRoOmF1dG87CiAgaGVpZ2h0OmF1dG87Cn0KCjppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIC5zdGFtcEVkaXRvcikgY2FudmFzewogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICB3aWR0aDoxMDAlOwogICAgaGVpZ2h0OjEwMCU7CiAgICBtYXJnaW46MDsKICAgIHRvcDowOwogICAgbGVmdDowOwogIH0KCjppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIC5zdGFtcEVkaXRvcikgLm5vQWx0VGV4dEJhZGdlewogICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODQ6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzUyNTI1ZTsKICAgIC0tbm8tYWx0LXRleHQtYmFkZ2UtYm9yZGVyLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04NCwgI2YwZjBmNCk7CiAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04NTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjZmJmYmZlOwogICAgLS1uby1hbHQtdGV4dC1iYWRnZS1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODUsICNjZmNmZDgpOwogICAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODY6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzE1MTQxYTsKICAgIC0tbm8tYWx0LXRleHQtYmFkZ2UtZmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTg2LCAjNWI1YjY2KTsKICB9CgpAc3VwcG9ydHMgKGNvbG9yOiBsaWdodC1kYXJrKHJlZCwgcmVkKSl7CjppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIC5zdGFtcEVkaXRvcikgLm5vQWx0VGV4dEJhZGdlewogICAgLS1uby1hbHQtdGV4dC1iYWRnZS1ib3JkZXItY29sb3I6bGlnaHQtZGFyaygjZjBmMGY0LCAjNTI1MjVlKTsKICAgIC0tbm8tYWx0LXRleHQtYmFkZ2UtYmctY29sb3I6bGlnaHQtZGFyaygjY2ZjZmQ4LCAjZmJmYmZlKTsKICAgIC0tbm8tYWx0LXRleHQtYmFkZ2UtZmctY29sb3I6bGlnaHQtZGFyaygjNWI1YjY2LCAjMTUxNDFhKTsKICB9Cn0KCkBzdXBwb3J0cyBub3QgKGNvbG9yOiBsaWdodC1kYXJrKHRhbiwgdGFuKSl7Cgo6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLnN0YW1wRWRpdG9yKSAubm9BbHRUZXh0QmFkZ2UpICp7CiAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04NDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNTI1MjVlOwogICAgLS1uby1hbHQtdGV4dC1iYWRnZS1ib3JkZXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTg0LCAjZjBmMGY0KTsKICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTg1OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICNmYmZiZmU7CiAgICAtLW5vLWFsdC10ZXh0LWJhZGdlLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04NSwgI2NmY2ZkOCk7CiAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04Njp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMTUxNDFhOwogICAgLS1uby1hbHQtdGV4dC1iYWRnZS1mZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODYsICM1YjViNjYpOwogIH0KfQoKQG1lZGlhIHNjcmVlbiBhbmQgKGZvcmNlZC1jb2xvcnM6IGFjdGl2ZSl7Cgo6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciAuc3RhbXBFZGl0b3IpIC5ub0FsdFRleHRCYWRnZXsKICAgICAgLS1uby1hbHQtdGV4dC1iYWRnZS1ib3JkZXItY29sb3I6QnV0dG9uVGV4dDsKICAgICAgLS1uby1hbHQtdGV4dC1iYWRnZS1iZy1jb2xvcjpCdXR0b25GYWNlOwogICAgICAtLW5vLWFsdC10ZXh0LWJhZGdlLWZnLWNvbG9yOkJ1dHRvblRleHQ7CiAgfQogICAgfQoKOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLnN0YW1wRWRpdG9yKSAubm9BbHRUZXh0QmFkZ2V7CgogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICBpbnNldC1pbmxpbmUtZW5kOjVweDsKICAgIGluc2V0LWJsb2NrLWVuZDo1cHg7CiAgICBkaXNwbGF5OmlubGluZS1mbGV4OwogICAgd2lkdGg6MzJweDsKICAgIGhlaWdodDozMnB4OwogICAgcGFkZGluZzozcHg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgcG9pbnRlci1ldmVudHM6bm9uZTsKICAgIHotaW5kZXg6MTsKCiAgICBib3JkZXItcmFkaXVzOjJweDsKICAgIGJvcmRlcjoxcHggc29saWQgdmFyKC0tbm8tYWx0LXRleHQtYmFkZ2UtYm9yZGVyLWNvbG9yKTsKICAgIGJhY2tncm91bmQ6dmFyKC0tbm8tYWx0LXRleHQtYmFkZ2UtYmctY29sb3IpOwogIH0KCjppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciAuc3RhbXBFZGl0b3IpIC5ub0FsdFRleHRCYWRnZSk6OmJlZm9yZXsKICAgICAgY29udGVudDoiIjsKICAgICAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgICAgIHdpZHRoOjE2cHg7CiAgICAgIGhlaWdodDoxNnB4OwogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tbmV3LWFsdC10ZXh0LXdhcm5pbmctaW1hZ2UpOwogICAgICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tbmV3LWFsdC10ZXh0LXdhcm5pbmctaW1hZ2UpOwogICAgICAtd2Via2l0LW1hc2stc2l6ZTpjb3ZlcjsKICAgICAgICAgICAgICBtYXNrLXNpemU6Y292ZXI7CiAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tbm8tYWx0LXRleHQtYmFkZ2UtZmctY29sb3IpOwogICAgfQoKOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSkgPiAucmVzaXplcnN7CiAgICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgICBpbnNldDowOwogICAgfQoKLmhpZGRlbjppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpKSA+IC5yZXNpemVycyl7CiAgICAgICAgZGlzcGxheTpub25lOwogICAgICB9Cgo6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSkgPiAucmVzaXplcnMpID4gLnJlc2l6ZXJ7CiAgICAgICAgd2lkdGg6dmFyKC0tcmVzaXplci1zaXplKTsKICAgICAgICBoZWlnaHQ6dmFyKC0tcmVzaXplci1zaXplKTsKICAgICAgICBiYWNrZ3JvdW5kOmNvbnRlbnQtYm94IHZhcigtLXJlc2l6ZXItYmctY29sb3IpOwogICAgICAgIGJvcmRlcjp2YXIoLS1mb2N1cy1vdXRsaW5lLWFyb3VuZCk7CiAgICAgICAgYm9yZGVyLXJhZGl1czoycHg7CiAgICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgIH0KCi50b3BMZWZ0OmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpKSA+IC5yZXNpemVycykgPiAucmVzaXplcil7CiAgICAgICAgICB0b3A6dmFyKC0tcmVzaXplci1zaGlmdCk7CiAgICAgICAgICBsZWZ0OnZhcigtLXJlc2l6ZXItc2hpZnQpOwogICAgICAgIH0KCi50b3BNaWRkbGU6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLnNpZ25hdHVyZUVkaXRvcikpID4gLnJlc2l6ZXJzKSA+IC5yZXNpemVyKXsKICAgICAgICAgIHRvcDp2YXIoLS1yZXNpemVyLXNoaWZ0KTsKICAgICAgICAgIGxlZnQ6Y2FsYyg1MCUgKyB2YXIoLS1yZXNpemVyLXNoaWZ0KSk7CiAgICAgICAgfQoKLnRvcFJpZ2h0OmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoLmZyZWVUZXh0RWRpdG9yLC5pbmtFZGl0b3IsLnN0YW1wRWRpdG9yLC5zaWduYXR1cmVFZGl0b3IpKSA+IC5yZXNpemVycykgPiAucmVzaXplcil7CiAgICAgICAgICB0b3A6dmFyKC0tcmVzaXplci1zaGlmdCk7CiAgICAgICAgICByaWdodDp2YXIoLS1yZXNpemVyLXNoaWZ0KTsKICAgICAgICB9CgoubWlkZGxlUmlnaHQ6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyguZnJlZVRleHRFZGl0b3IsLmlua0VkaXRvciwuc3RhbXBFZGl0b3IsLnNpZ25hdHVyZUVkaXRvcikpID4gLnJlc2l6ZXJzKSA+IC5yZXNpemVyKXsKICAgICAgICAgIHRvcDpjYWxjKDUwJSArIHZhcigtLXJlc2l6ZXItc2hpZnQpKTsKICAgICAgICAgIHJpZ2h0OnZhcigtLXJlc2l6ZXItc2hpZnQpOwogICAgICAgIH0KCi5ib3R0b21SaWdodDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSkgPiAucmVzaXplcnMpID4gLnJlc2l6ZXIpewogICAgICAgICAgYm90dG9tOnZhcigtLXJlc2l6ZXItc2hpZnQpOwogICAgICAgICAgcmlnaHQ6dmFyKC0tcmVzaXplci1zaGlmdCk7CiAgICAgICAgfQoKLmJvdHRvbU1pZGRsZTppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSkgPiAucmVzaXplcnMpID4gLnJlc2l6ZXIpewogICAgICAgICAgYm90dG9tOnZhcigtLXJlc2l6ZXItc2hpZnQpOwogICAgICAgICAgbGVmdDpjYWxjKDUwJSArIHZhcigtLXJlc2l6ZXItc2hpZnQpKTsKICAgICAgICB9CgouYm90dG9tTGVmdDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSkgPiAucmVzaXplcnMpID4gLnJlc2l6ZXIpewogICAgICAgICAgYm90dG9tOnZhcigtLXJlc2l6ZXItc2hpZnQpOwogICAgICAgICAgbGVmdDp2YXIoLS1yZXNpemVyLXNoaWZ0KTsKICAgICAgICB9CgoubWlkZGxlTGVmdDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKC5mcmVlVGV4dEVkaXRvciwuaW5rRWRpdG9yLC5zdGFtcEVkaXRvciwuc2lnbmF0dXJlRWRpdG9yKSkgPiAucmVzaXplcnMpID4gLnJlc2l6ZXIpewogICAgICAgICAgdG9wOmNhbGMoNTAlICsgdmFyKC0tcmVzaXplci1zaGlmdCkpOwogICAgICAgICAgbGVmdDp2YXIoLS1yZXNpemVyLXNoaWZ0KTsKICAgICAgICB9CgoudG9wTGVmdDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjkwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMjcwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSI5MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMTgwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMTgwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIyNzAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSI5MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMjcwIl0pKSA+IC5yZXNpemVycyA+IC5yZXNpemVyKSwuYm90dG9tUmlnaHQ6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMTgwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSI5MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjE4MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMjcwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdKSkgPiAucmVzaXplcnMgPiAucmVzaXplcil7CiAgICAgICAgY3Vyc29yOm53c2UtcmVzaXplOwogICAgICB9CgoudG9wTWlkZGxlOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSkpID4gLnJlc2l6ZXJzID4gLnJlc2l6ZXIpLC5ib3R0b21NaWRkbGU6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMTgwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSI5MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjE4MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMjcwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdKSkgPiAucmVzaXplcnMgPiAucmVzaXplcil7CiAgICAgICAgY3Vyc29yOm5zLXJlc2l6ZTsKICAgICAgfQoKLnRvcFJpZ2h0OmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSkpID4gLnJlc2l6ZXJzID4gLnJlc2l6ZXIpLC5ib3R0b21MZWZ0OmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSkpID4gLnJlc2l6ZXJzID4gLnJlc2l6ZXIpewogICAgICAgIGN1cnNvcjpuZXN3LXJlc2l6ZTsKICAgICAgfQoKLm1pZGRsZVJpZ2h0OmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSkpID4gLnJlc2l6ZXJzID4gLnJlc2l6ZXIpLC5taWRkbGVMZWZ0OmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSkpID4gLnJlc2l6ZXJzID4gLnJlc2l6ZXIpewogICAgICAgIGN1cnNvcjpldy1yZXNpemU7CiAgICAgIH0KCi50b3BMZWZ0OmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjkwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMTgwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIyNzAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSkpID4gLnJlc2l6ZXJzID4gLnJlc2l6ZXIpLC5ib3R0b21SaWdodDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSI5MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMjcwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSI5MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMTgwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMjcwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSI5MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMjcwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMTgwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0pKSA+IC5yZXNpemVycyA+IC5yZXNpemVyKXsKICAgICAgICBjdXJzb3I6bmVzdy1yZXNpemU7CiAgICAgIH0KCi50b3BNaWRkbGU6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjE4MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdKSkgPiAucmVzaXplcnMgPiAucmVzaXplciksLmJvdHRvbU1pZGRsZTppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSI5MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMjcwIl0pLC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSI5MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMTgwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMjcwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSI5MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iMjcwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMTgwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0pKSA+IC5yZXNpemVycyA+IC5yZXNpemVyKXsKICAgICAgICBjdXJzb3I6ZXctcmVzaXplOwogICAgICB9CgoudG9wUmlnaHQ6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjE4MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdKSkgPiAucmVzaXplcnMgPiAucmVzaXplciksLmJvdHRvbUxlZnQ6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjE4MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdKSkgPiAucmVzaXplcnMgPiAucmVzaXplcil7CiAgICAgICAgY3Vyc29yOm53c2UtcmVzaXplOwogICAgICB9CgoubWlkZGxlUmlnaHQ6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjE4MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdKSkgPiAucmVzaXplcnMgPiAucmVzaXplciksLm1pZGRsZUxlZnQ6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIwIl0gOmlzKFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSxbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdKSwuYW5ub3RhdGlvbkVkaXRvckxheWVyW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSA6aXMoW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0sW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjE4MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSksLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIDppcyhbZGF0YS1lZGl0b3Itcm90YXRpb249IjE4MCJdLFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdKSkgPiAucmVzaXplcnMgPiAucmVzaXplcil7CiAgICAgICAgY3Vyc29yOm5zLXJlc2l6ZTsKICAgICAgfQoKOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKFtkYXRhLW1haW4tcm90YXRpb249IjAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0sW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSxbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMTgwIl0pKSAuZWRpdFRvb2xiYXJ7CiAgICAgIHJvdGF0ZToyNzBkZWc7CiAgICB9CgpbZGlyPSJsdHIiXSA6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKFtkYXRhLW1haW4tcm90YXRpb249IjAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0sW2RhdGEtbWFpbi1yb3RhdGlvbj0iOTAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSxbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMTgwIl0pKSAuZWRpdFRvb2xiYXIpewogICAgICAgIGluc2V0LWlubGluZS1lbmQ6Y2FsYygwcHggLSB2YXIoLS1lZGl0b3ItdG9vbGJhci12ZXJ0LW9mZnNldCkpOwogICAgICAgIGluc2V0LWJsb2NrLXN0YXJ0OjA7CiAgICAgIH0KCltkaXI9InJ0bCJdIDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciA6aXMoW2RhdGEtbWFpbi1yb3RhdGlvbj0iMCJdIFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSxbZGF0YS1tYWluLXJvdGF0aW9uPSI5MCJdIFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdLFtkYXRhLW1haW4tcm90YXRpb249IjE4MCJdIFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMjcwIl0sW2RhdGEtbWFpbi1yb3RhdGlvbj0iMjcwIl0gW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSkpIC5lZGl0VG9vbGJhcil7CiAgICAgICAgaW5zZXQtaW5saW5lLWVuZDpjYWxjKDEwMCUgKyB2YXIoLS1lZGl0b3ItdG9vbGJhci12ZXJ0LW9mZnNldCkpOwogICAgICAgIGluc2V0LWJsb2NrLXN0YXJ0OjA7CiAgICAgIH0KCjppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyhbZGF0YS1tYWluLXJvdGF0aW9uPSIwIl0gW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSxbZGF0YS1tYWluLXJvdGF0aW9uPSI5MCJdIFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iOTAiXSxbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjAiXSxbZGF0YS1tYWluLXJvdGF0aW9uPSIyNzAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdKSkgLmVkaXRUb29sYmFyewogICAgICByb3RhdGU6MTgwZGVnOwogICAgICBpbnNldC1pbmxpbmUtZW5kOjEwMCU7CiAgICAgIGluc2V0LWJsb2NrLXN0YXJ0OmNhbGMoMHBjIC0gdmFyKC0tZWRpdG9yLXRvb2xiYXItdmVydC1vZmZzZXQpKTsKICAgIH0KCjppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIDppcyhbZGF0YS1tYWluLXJvdGF0aW9uPSIwIl0gW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIyNzAiXSxbZGF0YS1tYWluLXJvdGF0aW9uPSI5MCJdIFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMTgwIl0sW2RhdGEtbWFpbi1yb3RhdGlvbj0iMTgwIl0gW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSI5MCJdLFtkYXRhLW1haW4tcm90YXRpb249IjI3MCJdIFtkYXRhLWVkaXRvci1yb3RhdGlvbj0iMCJdKSkgLmVkaXRUb29sYmFyewogICAgICByb3RhdGU6OTBkZWc7CiAgICB9CgpbZGlyPSJsdHIiXSA6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKFtkYXRhLW1haW4tcm90YXRpb249IjAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLW1haW4tcm90YXRpb249IjkwIl0gW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSxbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0sW2RhdGEtbWFpbi1yb3RhdGlvbj0iMjcwIl0gW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0pKSAuZWRpdFRvb2xiYXIpewogICAgICAgIGluc2V0LWlubGluZS1lbmQ6Y2FsYygxMDAlICsgdmFyKC0tZWRpdG9yLXRvb2xiYXItdmVydC1vZmZzZXQpKTsKICAgICAgICBpbnNldC1ibG9jay1zdGFydDoxMDAlOwogICAgICB9CgpbZGlyPSJydGwiXSA6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgOmlzKFtkYXRhLW1haW4tcm90YXRpb249IjAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjI3MCJdLFtkYXRhLW1haW4tcm90YXRpb249IjkwIl0gW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIxODAiXSxbZGF0YS1tYWluLXJvdGF0aW9uPSIxODAiXSBbZGF0YS1lZGl0b3Itcm90YXRpb249IjkwIl0sW2RhdGEtbWFpbi1yb3RhdGlvbj0iMjcwIl0gW2RhdGEtZWRpdG9yLXJvdGF0aW9uPSIwIl0pKSAuZWRpdFRvb2xiYXIpewogICAgICAgIGluc2V0LWlubGluZS1zdGFydDpjYWxjKDBweCAtIHZhcigtLWVkaXRvci10b29sYmFyLXZlcnQtb2Zmc2V0KSk7CiAgICAgICAgaW5zZXQtYmxvY2stc3RhcnQ6MDsKICAgICAgfQoKLmRpYWxvZy5hbHRUZXh0OjpiYWNrZHJvcHsKICAgIC13ZWJraXQtbWFzazp1cmwoI2FsdHRleHQtbWFuYWdlci1tYXNrKTsKICAgICAgICAgICAgbWFzazp1cmwoI2FsdHRleHQtbWFuYWdlci1tYXNrKTsKICB9CgouZGlhbG9nLmFsdFRleHQucG9zaXRpb25lZHsKICAgIG1hcmdpbjowOwogIH0KCi5kaWFsb2cuYWx0VGV4dCAjYWx0VGV4dENvbnRhaW5lcnsKICAgIHdpZHRoOjMwMHB4OwogICAgaGVpZ2h0Oi1tb3otZml0LWNvbnRlbnQ7CiAgICBoZWlnaHQ6Zml0LWNvbnRlbnQ7CiAgICBkaXNwbGF5OmlubGluZS1mbGV4OwogICAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwogICAgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsKICAgIGdhcDoxNnB4OwogIH0KCjppcyguZGlhbG9nLmFsdFRleHQgI2FsdFRleHRDb250YWluZXIpICNvdmVyYWxsRGVzY3JpcHRpb257CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwogICAgICBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OwogICAgICBnYXA6NHB4OwogICAgICBhbGlnbi1zZWxmOnN0cmV0Y2g7CiAgICB9Cgo6aXMoOmlzKC5kaWFsb2cuYWx0VGV4dCAjYWx0VGV4dENvbnRhaW5lcikgI292ZXJhbGxEZXNjcmlwdGlvbikgc3BhbnsKICAgICAgICBhbGlnbi1zZWxmOnN0cmV0Y2g7CiAgICAgIH0KCjppcyg6aXMoLmRpYWxvZy5hbHRUZXh0ICNhbHRUZXh0Q29udGFpbmVyKSAjb3ZlcmFsbERlc2NyaXB0aW9uKSAudGl0bGV7CiAgICAgICAgZm9udC1zaXplOjEzcHg7CiAgICAgICAgZm9udC1zdHlsZTpub3JtYWw7CiAgICAgICAgZm9udC13ZWlnaHQ6NTkwOwogICAgICB9Cgo6aXMoLmRpYWxvZy5hbHRUZXh0ICNhbHRUZXh0Q29udGFpbmVyKSAjYWRkRGVzY3JpcHRpb257CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwogICAgICBhbGlnbi1pdGVtczpzdHJldGNoOwogICAgICBnYXA6OHB4OwogICAgfQoKOmlzKDppcyguZGlhbG9nLmFsdFRleHQgI2FsdFRleHRDb250YWluZXIpICNhZGREZXNjcmlwdGlvbikgLmRlc2NyaXB0aW9uQXJlYXsKICAgICAgICBmbGV4OjE7CiAgICAgICAgcGFkZGluZy1pbmxpbmU6MjRweCAxMHB4OwogICAgICB9Cgo6aXMoOmlzKDppcyguZGlhbG9nLmFsdFRleHQgI2FsdFRleHRDb250YWluZXIpICNhZGREZXNjcmlwdGlvbikgLmRlc2NyaXB0aW9uQXJlYSkgdGV4dGFyZWF7CiAgICAgICAgICB3aWR0aDoxMDAlOwogICAgICAgICAgbWluLWhlaWdodDo3NXB4OwogICAgICAgIH0KCjppcyguZGlhbG9nLmFsdFRleHQgI2FsdFRleHRDb250YWluZXIpICNidXR0b25zewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsKICAgICAgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsKICAgICAgZ2FwOjhweDsKICAgICAgYWxpZ24tc2VsZjpzdHJldGNoOwogICAgfQoKLmRpYWxvZy5uZXdBbHRUZXh0ewogIC0tbmV3LWFsdC10ZXh0LWFpLWRpc2NsYWltZXItaWNvbjp1cmwoaW1hZ2VzL2FsdFRleHRfZGlzY2xhaW1lci5zdmcpOwogIC0tbmV3LWFsdC10ZXh0LXNwaW5uZXItaWNvbjp1cmwoaW1hZ2VzL2FsdFRleHRfc3Bpbm5lci5zdmcpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTg3OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICMyYjJhMzM7CiAgLS1wcmV2aWV3LWltYWdlLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04NywgI2YwZjBmNCk7CiAgLS1wcmV2aWV3LWltYWdlLWJvcmRlcjpub25lOwp9CgpAc3VwcG9ydHMgKGNvbG9yOiBsaWdodC1kYXJrKHJlZCwgcmVkKSl7Ci5kaWFsb2cubmV3QWx0VGV4dHsKICAtLXByZXZpZXctaW1hZ2UtYmctY29sb3I6bGlnaHQtZGFyaygjZjBmMGY0LCAjMmIyYTMzKTsKfQp9CgpAc3VwcG9ydHMgbm90IChjb2xvcjogbGlnaHQtZGFyayh0YW4sIHRhbikpewoKLmRpYWxvZy5uZXdBbHRUZXh0ICp7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODc6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzJiMmEzMzsKICAtLXByZXZpZXctaW1hZ2UtYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTg3LCAjZjBmMGY0KTsKICB9Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKLmRpYWxvZy5uZXdBbHRUZXh0ewogICAgLS1wcmV2aWV3LWltYWdlLWJnLWNvbG9yOkJ1dHRvbkZhY2U7CiAgICAtLXByZXZpZXctaW1hZ2UtYm9yZGVyOjFweCBzb2xpZCBCdXR0b25UZXh0Owp9CiAgfQoKLmRpYWxvZy5uZXdBbHRUZXh0ewoKICB3aWR0aDo4MCU7CiAgbWF4LXdpZHRoOjU3MHB4OwogIG1pbi13aWR0aDozMDBweDsKICBwYWRkaW5nOjA7Cn0KCi5kaWFsb2cubmV3QWx0VGV4dC5ub0FpICNuZXdBbHRUZXh0RGlzY2xhaW1lciwuZGlhbG9nLm5ld0FsdFRleHQubm9BaSAjbmV3QWx0VGV4dENyZWF0ZUF1dG9tYXRpY2FsbHl7CiAgICAgIGRpc3BsYXk6bm9uZSAhaW1wb3J0YW50OwogICAgfQoKLmRpYWxvZy5uZXdBbHRUZXh0LmFpSW5zdGFsbGluZyAjbmV3QWx0VGV4dENyZWF0ZUF1dG9tYXRpY2FsbHl7CiAgICAgIGRpc3BsYXk6bm9uZSAhaW1wb3J0YW50OwogICAgfQoKLmRpYWxvZy5uZXdBbHRUZXh0LmFpSW5zdGFsbGluZyAjbmV3QWx0VGV4dERvd25sb2FkTW9kZWx7CiAgICAgIGRpc3BsYXk6ZmxleCAhaW1wb3J0YW50OwogICAgfQoKLmRpYWxvZy5uZXdBbHRUZXh0LmVycm9yICNuZXdBbHRUZXh0Tm90Tm93ewogICAgICBkaXNwbGF5Om5vbmUgIWltcG9ydGFudDsKICAgIH0KCi5kaWFsb2cubmV3QWx0VGV4dC5lcnJvciAjbmV3QWx0VGV4dENhbmNlbHsKICAgICAgZGlzcGxheTppbmxpbmUtYmxvY2sgIWltcG9ydGFudDsKICAgIH0KCi5kaWFsb2cubmV3QWx0VGV4dDpub3QoLmVycm9yKSAjbmV3QWx0VGV4dEVycm9yewogICAgZGlzcGxheTpub25lICFpbXBvcnRhbnQ7CiAgfQoKLmRpYWxvZy5uZXdBbHRUZXh0ICNuZXdBbHRUZXh0Q29udGFpbmVyewogICAgZGlzcGxheTpmbGV4OwogICAgd2lkdGg6YXV0bzsKICAgIHBhZGRpbmc6MTZweDsKICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgIGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsKICAgIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7CiAgICBnYXA6MTJweDsKICAgIGZsZXg6MCAxIGF1dG87CiAgICBsaW5lLWhlaWdodDpub3JtYWw7CiAgfQoKOmlzKC5kaWFsb2cubmV3QWx0VGV4dCAjbmV3QWx0VGV4dENvbnRhaW5lcikgI21haW5Db250ZW50ewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsKICAgICAgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsKICAgICAgZ2FwOjEycHg7CiAgICAgIGFsaWduLXNlbGY6c3RyZXRjaDsKICAgICAgZmxleDoxIDEgYXV0bzsKICAgIH0KCjppcyg6aXMoLmRpYWxvZy5uZXdBbHRUZXh0ICNuZXdBbHRUZXh0Q29udGFpbmVyKSAjbWFpbkNvbnRlbnQpICNkZXNjcmlwdGlvbkFuZFNldHRpbmdzewogICAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICAgICAgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsKICAgICAgICBnYXA6MTZweDsKICAgICAgICBmbGV4OjEgMCAwOwogICAgICAgIGFsaWduLXNlbGY6c3RyZXRjaDsKICAgICAgfQoKOmlzKDppcyguZGlhbG9nLm5ld0FsdFRleHQgI25ld0FsdFRleHRDb250YWluZXIpICNtYWluQ29udGVudCkgI2Rlc2NyaXB0aW9uSW5zdHJ1Y3Rpb257CiAgICAgICAgZGlzcGxheTpmbGV4OwogICAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgICAgICBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OwogICAgICAgIGdhcDo4cHg7CiAgICAgICAgYWxpZ24tc2VsZjpzdHJldGNoOwogICAgICAgIGZsZXg6MSAxIGF1dG87CiAgICAgIH0KCjppcyg6aXMoOmlzKC5kaWFsb2cubmV3QWx0VGV4dCAjbmV3QWx0VGV4dENvbnRhaW5lcikgI21haW5Db250ZW50KSAjZGVzY3JpcHRpb25JbnN0cnVjdGlvbikgI25ld0FsdFRleHREZXNjcmlwdGlvbkNvbnRhaW5lcnsKICAgICAgICAgIHdpZHRoOjEwMCU7CiAgICAgICAgICBoZWlnaHQ6NzBweDsKICAgICAgICAgIHBvc2l0aW9uOnJlbGF0aXZlOwogICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyguZGlhbG9nLm5ld0FsdFRleHQgI25ld0FsdFRleHRDb250YWluZXIpICNtYWluQ29udGVudCkgI2Rlc2NyaXB0aW9uSW5zdHJ1Y3Rpb24pICNuZXdBbHRUZXh0RGVzY3JpcHRpb25Db250YWluZXIpIHRleHRhcmVhewogICAgICAgICAgICB3aWR0aDoxMDAlOwogICAgICAgICAgICBoZWlnaHQ6MTAwJTsKICAgICAgICAgICAgcGFkZGluZzo4cHg7CiAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoOmlzKC5kaWFsb2cubmV3QWx0VGV4dCAjbmV3QWx0VGV4dENvbnRhaW5lcikgI21haW5Db250ZW50KSAjZGVzY3JpcHRpb25JbnN0cnVjdGlvbikgI25ld0FsdFRleHREZXNjcmlwdGlvbkNvbnRhaW5lcikgdGV4dGFyZWEpOjotbW96LXBsYWNlaG9sZGVyewogICAgICAgICAgICAgIGNvbG9yOnZhcigtLXRleHQtc2Vjb25kYXJ5LWNvbG9yKTsKICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKDppcyguZGlhbG9nLm5ld0FsdFRleHQgI25ld0FsdFRleHRDb250YWluZXIpICNtYWluQ29udGVudCkgI2Rlc2NyaXB0aW9uSW5zdHJ1Y3Rpb24pICNuZXdBbHRUZXh0RGVzY3JpcHRpb25Db250YWluZXIpIHRleHRhcmVhKTo6cGxhY2Vob2xkZXJ7CiAgICAgICAgICAgICAgY29sb3I6dmFyKC0tdGV4dC1zZWNvbmRhcnktY29sb3IpOwogICAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoLmRpYWxvZy5uZXdBbHRUZXh0ICNuZXdBbHRUZXh0Q29udGFpbmVyKSAjbWFpbkNvbnRlbnQpICNkZXNjcmlwdGlvbkluc3RydWN0aW9uKSAjbmV3QWx0VGV4dERlc2NyaXB0aW9uQ29udGFpbmVyKSAuYWx0VGV4dFNwaW5uZXJ7CiAgICAgICAgICAgIGRpc3BsYXk6bm9uZTsKICAgICAgICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgICAgICAgIHdpZHRoOjE2cHg7CiAgICAgICAgICAgIGhlaWdodDoxNnB4OwogICAgICAgICAgICBpbnNldC1pbmxpbmUtc3RhcnQ6OHB4OwogICAgICAgICAgICBpbnNldC1ibG9jay1zdGFydDo4cHg7CiAgICAgICAgICAgIC13ZWJraXQtbWFzay1zaXplOmNvdmVyOwogICAgICAgICAgICAgICAgICAgIG1hc2stc2l6ZTpjb3ZlcjsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10ZXh0LXNlY29uZGFyeS1jb2xvcik7CiAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICAgICAgICB9CgoubG9hZGluZzppcyg6aXMoOmlzKDppcyguZGlhbG9nLm5ld0FsdFRleHQgI25ld0FsdFRleHRDb250YWluZXIpICNtYWluQ29udGVudCkgI2Rlc2NyaXB0aW9uSW5zdHJ1Y3Rpb24pICNuZXdBbHRUZXh0RGVzY3JpcHRpb25Db250YWluZXIpIHRleHRhcmVhOjotbW96LXBsYWNlaG9sZGVyewogICAgICAgICAgICAgIGNvbG9yOnRyYW5zcGFyZW50OwogICAgICAgICAgICB9CgoubG9hZGluZzppcyg6aXMoOmlzKDppcyguZGlhbG9nLm5ld0FsdFRleHQgI25ld0FsdFRleHRDb250YWluZXIpICNtYWluQ29udGVudCkgI2Rlc2NyaXB0aW9uSW5zdHJ1Y3Rpb24pICNuZXdBbHRUZXh0RGVzY3JpcHRpb25Db250YWluZXIpIHRleHRhcmVhOjpwbGFjZWhvbGRlcnsKICAgICAgICAgICAgICBjb2xvcjp0cmFuc3BhcmVudDsKICAgICAgICAgICAgfQoKLmxvYWRpbmc6aXMoOmlzKDppcyg6aXMoLmRpYWxvZy5uZXdBbHRUZXh0ICNuZXdBbHRUZXh0Q29udGFpbmVyKSAjbWFpbkNvbnRlbnQpICNkZXNjcmlwdGlvbkluc3RydWN0aW9uKSAjbmV3QWx0VGV4dERlc2NyaXB0aW9uQ29udGFpbmVyKSAuYWx0VGV4dFNwaW5uZXJ7CiAgICAgICAgICAgICAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgICAgICAgICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLW5ldy1hbHQtdGV4dC1zcGlubmVyLWljb24pOwogICAgICAgICAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1uZXctYWx0LXRleHQtc3Bpbm5lci1pY29uKTsKICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoLmRpYWxvZy5uZXdBbHRUZXh0ICNuZXdBbHRUZXh0Q29udGFpbmVyKSAjbWFpbkNvbnRlbnQpICNkZXNjcmlwdGlvbkluc3RydWN0aW9uKSAjbmV3QWx0VGV4dERlc2NyaXB0aW9uewogICAgICAgICAgZm9udC1zaXplOjExcHg7CiAgICAgICAgfQoKOmlzKDppcyg6aXMoLmRpYWxvZy5uZXdBbHRUZXh0ICNuZXdBbHRUZXh0Q29udGFpbmVyKSAjbWFpbkNvbnRlbnQpICNkZXNjcmlwdGlvbkluc3RydWN0aW9uKSAjbmV3QWx0VGV4dERpc2NsYWltZXJ7CiAgICAgICAgICBkaXNwbGF5OmZsZXg7CiAgICAgICAgICBmbGV4LWRpcmVjdGlvbjpyb3c7CiAgICAgICAgICBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OwogICAgICAgICAgZ2FwOjRweDsKICAgICAgICAgIGZvbnQtc2l6ZToxMXB4OwogICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyguZGlhbG9nLm5ld0FsdFRleHQgI25ld0FsdFRleHRDb250YWluZXIpICNtYWluQ29udGVudCkgI2Rlc2NyaXB0aW9uSW5zdHJ1Y3Rpb24pICNuZXdBbHRUZXh0RGlzY2xhaW1lcik6OmJlZm9yZXsKICAgICAgICAgICAgY29udGVudDoiIjsKICAgICAgICAgICAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgICAgICAgICAgIHdpZHRoOjE3cHg7CiAgICAgICAgICAgIGhlaWdodDoxNnB4OwogICAgICAgICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tbmV3LWFsdC10ZXh0LWFpLWRpc2NsYWltZXItaWNvbik7CiAgICAgICAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1uZXctYWx0LXRleHQtYWktZGlzY2xhaW1lci1pY29uKTsKICAgICAgICAgICAgLXdlYmtpdC1tYXNrLXNpemU6Y292ZXI7CiAgICAgICAgICAgICAgICAgICAgbWFzay1zaXplOmNvdmVyOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRleHQtc2Vjb25kYXJ5LWNvbG9yKTsKICAgICAgICAgICAgZmxleDoxIDAgYXV0bzsKICAgICAgICAgIH0KCjppcyg6aXMoLmRpYWxvZy5uZXdBbHRUZXh0ICNuZXdBbHRUZXh0Q29udGFpbmVyKSAjbWFpbkNvbnRlbnQpICNuZXdBbHRUZXh0RG93bmxvYWRNb2RlbHsKICAgICAgICBkaXNwbGF5OmZsZXg7CiAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICAgIGdhcDo0cHg7CiAgICAgICAgYWxpZ24tc2VsZjpzdHJldGNoOwogICAgICB9Cgo6aXMoOmlzKDppcyguZGlhbG9nLm5ld0FsdFRleHQgI25ld0FsdFRleHRDb250YWluZXIpICNtYWluQ29udGVudCkgI25ld0FsdFRleHREb3dubG9hZE1vZGVsKTo6YmVmb3JlewogICAgICAgICAgY29udGVudDoiIjsKICAgICAgICAgIGRpc3BsYXk6aW5saW5lLWJsb2NrOwogICAgICAgICAgd2lkdGg6MTZweDsKICAgICAgICAgIGhlaWdodDoxNnB4OwogICAgICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLW5ldy1hbHQtdGV4dC1zcGlubmVyLWljb24pOwogICAgICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLW5ldy1hbHQtdGV4dC1zcGlubmVyLWljb24pOwogICAgICAgICAgLXdlYmtpdC1tYXNrLXNpemU6Y292ZXI7CiAgICAgICAgICAgICAgICAgIG1hc2stc2l6ZTpjb3ZlcjsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tdGV4dC1zZWNvbmRhcnktY29sb3IpOwogICAgICAgIH0KCjppcyg6aXMoLmRpYWxvZy5uZXdBbHRUZXh0ICNuZXdBbHRUZXh0Q29udGFpbmVyKSAjbWFpbkNvbnRlbnQpICNuZXdBbHRUZXh0SW1hZ2VQcmV2aWV3ewogICAgICAgIHdpZHRoOjE4MHB4OwogICAgICAgIGFzcGVjdC1yYXRpbzoxOwogICAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogICAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgICBmbGV4OjAgMCBhdXRvOwogICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tcHJldmlldy1pbWFnZS1iZy1jb2xvcik7CiAgICAgICAgYm9yZGVyOnZhcigtLXByZXZpZXctaW1hZ2UtYm9yZGVyKTsKICAgICAgfQoKOmlzKDppcyg6aXMoLmRpYWxvZy5uZXdBbHRUZXh0ICNuZXdBbHRUZXh0Q29udGFpbmVyKSAjbWFpbkNvbnRlbnQpICNuZXdBbHRUZXh0SW1hZ2VQcmV2aWV3KSAgPiBjYW52YXN7CiAgICAgICAgICBtYXgtd2lkdGg6MTAwJTsKICAgICAgICAgIG1heC1oZWlnaHQ6MTAwJTsKICAgICAgICB9CgouY29sb3JQaWNrZXJ7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzgwZWJmZjsKICAtLWhvdmVyLW91dGxpbmUtY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTg4LCAjMDI1MGJiKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04OTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjYWFmMmZmOwogIC0tc2VsZWN0ZWQtb3V0bGluZS1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODksICMwMDYwZGYpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTkwOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICM1MjUyNWU7CiAgLS1zd2F0Y2gtYm9yZGVyLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS05MCwgI2NmY2ZkOCk7Cn0KCkBzdXBwb3J0cyAoY29sb3I6IGxpZ2h0LWRhcmsocmVkLCByZWQpKXsKLmNvbG9yUGlja2VyewogIC0taG92ZXItb3V0bGluZS1jb2xvcjpsaWdodC1kYXJrKCMwMjUwYmIsICM4MGViZmYpOwogIC0tc2VsZWN0ZWQtb3V0bGluZS1jb2xvcjpsaWdodC1kYXJrKCMwMDYwZGYsICNhYWYyZmYpOwogIC0tc3dhdGNoLWJvcmRlci1jb2xvcjpsaWdodC1kYXJrKCNjZmNmZDgsICM1MjUyNWUpOwp9Cn0KCkBzdXBwb3J0cyBub3QgKGNvbG9yOiBsaWdodC1kYXJrKHRhbiwgdGFuKSl7CgouY29sb3JQaWNrZXIgKnsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04ODp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjODBlYmZmOwogIC0taG92ZXItb3V0bGluZS1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODgsICMwMjUwYmIpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTg5OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICNhYWYyZmY7CiAgLS1zZWxlY3RlZC1vdXRsaW5lLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04OSwgIzAwNjBkZik7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tOTA6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzUyNTI1ZTsKICAtLXN3YXRjaC1ib3JkZXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTkwLCAjY2ZjZmQ4KTsKICB9Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKLmNvbG9yUGlja2VyewogICAgLS1ob3Zlci1vdXRsaW5lLWNvbG9yOkhpZ2hsaWdodDsKICAgIC0tc2VsZWN0ZWQtb3V0bGluZS1jb2xvcjp2YXIoLS1ob3Zlci1vdXRsaW5lLWNvbG9yKTsKICAgIC0tc3dhdGNoLWJvcmRlci1jb2xvcjpCdXR0b25UZXh0Owp9CiAgfQoKLmNvbG9yUGlja2VyIC5zd2F0Y2h7CiAgICB3aWR0aDoxNnB4OwogICAgaGVpZ2h0OjE2cHg7CiAgICBib3JkZXI6MXB4IHNvbGlkIHZhcigtLXN3YXRjaC1ib3JkZXItY29sb3IpOwogICAgYm9yZGVyLXJhZGl1czoxMDAlOwogICAgb3V0bGluZS1vZmZzZXQ6MnB4OwogICAgYm94LXNpemluZzpib3JkZXItYm94OwogICAgZm9yY2VkLWNvbG9yLWFkanVzdDpub25lOwogIH0KCi5jb2xvclBpY2tlciBidXR0b246aXMoOmhvdmVyLC5zZWxlY3RlZCkgPiAuc3dhdGNoewogICAgYm9yZGVyOm5vbmU7CiAgfQoKLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjAiXSAuaGlnaGxpZ2h0RWRpdG9yOm5vdCguZnJlZSkgPiAuZWRpdFRvb2xiYXJ7CiAgICAgIHJvdGF0ZTowZGVnOwogICAgfQoKLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjkwIl0gLmhpZ2hsaWdodEVkaXRvcjpub3QoLmZyZWUpID4gLmVkaXRUb29sYmFyewogICAgICByb3RhdGU6MjcwZGVnOwogICAgfQoKLmFubm90YXRpb25FZGl0b3JMYXllcltkYXRhLW1haW4tcm90YXRpb249IjE4MCJdIC5oaWdobGlnaHRFZGl0b3I6bm90KC5mcmVlKSA+IC5lZGl0VG9vbGJhcnsKICAgICAgcm90YXRlOjE4MGRlZzsKICAgIH0KCi5hbm5vdGF0aW9uRWRpdG9yTGF5ZXJbZGF0YS1tYWluLXJvdGF0aW9uPSIyNzAiXSAuaGlnaGxpZ2h0RWRpdG9yOm5vdCguZnJlZSkgPiAuZWRpdFRvb2xiYXJ7CiAgICAgIHJvdGF0ZTo5MGRlZzsKICAgIH0KCi5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLmhpZ2hsaWdodEVkaXRvcnsKICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgYmFja2dyb3VuZDp0cmFuc3BhcmVudDsKICAgIHotaW5kZXg6MTsKICAgIGN1cnNvcjphdXRvOwogICAgbWF4LXdpZHRoOjEwMCU7CiAgICBtYXgtaGVpZ2h0OjEwMCU7CiAgICBib3JkZXI6bm9uZTsKICAgIG91dGxpbmU6bm9uZTsKICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICB0cmFuc2Zvcm0tb3JpZ2luOjAgMDsKICB9Cgo6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciAuaGlnaGxpZ2h0RWRpdG9yKTpub3QoLmZyZWUpewogICAgICB0cmFuc2Zvcm06bm9uZTsKICAgIH0KCjppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIC5oaWdobGlnaHRFZGl0b3IpIC5pbnRlcm5hbHsKICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgIHRvcDowOwogICAgICBsZWZ0OjA7CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGhlaWdodDoxMDAlOwogICAgICBwb2ludGVyLWV2ZW50czphdXRvOwogICAgfQoKLmRpc2FibGVkOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLmhpZ2hsaWdodEVkaXRvcikgLmludGVybmFsewogICAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgfQoKLnNlbGVjdGVkRWRpdG9yOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLmhpZ2hsaWdodEVkaXRvcikgLmludGVybmFsewogICAgICAgIGN1cnNvcjpwb2ludGVyOwogICAgICB9Cgo6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciAuaGlnaGxpZ2h0RWRpdG9yKSAuZWRpdFRvb2xiYXJ7CiAgICAgIC0tZWRpdG9yLXRvb2xiYXItY29sb3JwaWNrZXItYXJyb3ctaW1hZ2U6dXJsKGltYWdlcy90b29sYmFyQnV0dG9uLW1lbnVBcnJvdy5zdmcpOwoKICAgICAgdHJhbnNmb3JtLW9yaWdpbjpjZW50ZXIgIWltcG9ydGFudDsKICAgIH0KCjppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLmhpZ2hsaWdodEVkaXRvcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmNvbG9yUGlja2VyewogICAgICAgICAgcG9zaXRpb246cmVsYXRpdmU7CiAgICAgICAgICB3aWR0aDphdXRvOwogICAgICAgICAgZGlzcGxheTpmbGV4OwogICAgICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICAgICAgICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgICAgICAgIGdhcDo0cHg7CiAgICAgICAgICBwYWRkaW5nOjRweDsKICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciAuaGlnaGxpZ2h0RWRpdG9yKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuY29sb3JQaWNrZXIpOjphZnRlcnsKICAgICAgICAgICAgY29udGVudDoiIjsKICAgICAgICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLWVkaXRvci10b29sYmFyLWNvbG9ycGlja2VyLWFycm93LWltYWdlKTsKICAgICAgICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLWVkaXRvci10b29sYmFyLWNvbG9ycGlja2VyLWFycm93LWltYWdlKTsKICAgICAgICAgICAgLXdlYmtpdC1tYXNrLXJlcGVhdDpuby1yZXBlYXQ7CiAgICAgICAgICAgICAgICAgICAgbWFzay1yZXBlYXQ6bm8tcmVwZWF0OwogICAgICAgICAgICAtd2Via2l0LW1hc2stcG9zaXRpb246Y2VudGVyOwogICAgICAgICAgICAgICAgICAgIG1hc2stcG9zaXRpb246Y2VudGVyOwogICAgICAgICAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1lZGl0b3ItdG9vbGJhci1mZy1jb2xvcik7CiAgICAgICAgICAgIHdpZHRoOjEycHg7CiAgICAgICAgICAgIGhlaWdodDoxMnB4OwogICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLmhpZ2hsaWdodEVkaXRvcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmNvbG9yUGlja2VyKTpob3Zlcjo6YWZ0ZXJ7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tZWRpdG9yLXRvb2xiYXItaG92ZXItZmctY29sb3IpOwogICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLmhpZ2hsaWdodEVkaXRvcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmNvbG9yUGlja2VyKTpoYXMoLmRyb3Bkb3duOm5vdCguaGlkZGVuKSl7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tZWRpdG9yLXRvb2xiYXItaG92ZXItYmctY29sb3IpOwogICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLmhpZ2hsaWdodEVkaXRvcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmNvbG9yUGlja2VyKTpoYXMoLmRyb3Bkb3duOm5vdCguaGlkZGVuKSk6OmFmdGVyewogICAgICAgICAgICAgIHNjYWxlOi0xOwogICAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciAuaGlnaGxpZ2h0RWRpdG9yKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuY29sb3JQaWNrZXIpIC5kcm9wZG93bnsKICAgICAgICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgICAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICAgICAgICAgIGdhcDoxMXB4OwogICAgICAgICAgICBwYWRkaW5nLWJsb2NrOjhweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czo2cHg7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tZWRpdG9yLXRvb2xiYXItYmctY29sb3IpOwogICAgICAgICAgICBib3JkZXI6MXB4IHNvbGlkIHZhcigtLWVkaXRvci10b29sYmFyLWJvcmRlci1jb2xvcik7CiAgICAgICAgICAgIGJveC1zaGFkb3c6dmFyKC0tZWRpdG9yLXRvb2xiYXItc2hhZG93KTsKICAgICAgICAgICAgaW5zZXQtYmxvY2stc3RhcnQ6Y2FsYygxMDAlICsgNHB4KTsKICAgICAgICAgICAgd2lkdGg6Y2FsYygxMDAlICsgMiAqIHZhcigtLWVkaXRvci10b29sYmFyLXBhZGRpbmcpKTsKICAgICAgICAgIH0KCjppcyg6aXMoOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciAuaGlnaGxpZ2h0RWRpdG9yKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuY29sb3JQaWNrZXIpIC5kcm9wZG93bikgYnV0dG9uewogICAgICAgICAgICAgIHdpZHRoOjEwMCU7CiAgICAgICAgICAgICAgaGVpZ2h0OmF1dG87CiAgICAgICAgICAgICAgYm9yZGVyOm5vbmU7CiAgICAgICAgICAgICAgY3Vyc29yOnBvaW50ZXI7CiAgICAgICAgICAgICAgZGlzcGxheTpmbGV4OwogICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgICAgICAgICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICAgICAgICAgIGJhY2tncm91bmQ6bm9uZTsKICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciAuaGlnaGxpZ2h0RWRpdG9yKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuY29sb3JQaWNrZXIpIC5kcm9wZG93bikgYnV0dG9uKTppcyg6YWN0aXZlLDpmb2N1cy12aXNpYmxlKXsKICAgICAgICAgICAgICAgIG91dGxpbmU6bm9uZTsKICAgICAgICAgICAgICB9Cgo6aXMoOmlzKDppcyg6aXMoOmlzKDppcyguYW5ub3RhdGlvbkVkaXRvckxheWVyIC5oaWdobGlnaHRFZGl0b3IpIC5lZGl0VG9vbGJhcikgLmJ1dHRvbnMpIC5jb2xvclBpY2tlcikgLmRyb3Bkb3duKSBidXR0b24pICA+IC5zd2F0Y2h7CiAgICAgICAgICAgICAgICBvdXRsaW5lLW9mZnNldDoycHg7CiAgICAgICAgICAgICAgfQoKW2FyaWEtc2VsZWN0ZWQ9InRydWUiXTppcyg6aXMoOmlzKDppcyg6aXMoOmlzKC5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgLmhpZ2hsaWdodEVkaXRvcikgLmVkaXRUb29sYmFyKSAuYnV0dG9ucykgLmNvbG9yUGlja2VyKSAuZHJvcGRvd24pIGJ1dHRvbikgPiAuc3dhdGNoewogICAgICAgICAgICAgICAgb3V0bGluZToycHggc29saWQgdmFyKC0tc2VsZWN0ZWQtb3V0bGluZS1jb2xvcik7CiAgICAgICAgICAgICAgfQoKOmlzKDppcyg6aXMoOmlzKDppcyg6aXMoLmFubm90YXRpb25FZGl0b3JMYXllciAuaGlnaGxpZ2h0RWRpdG9yKSAuZWRpdFRvb2xiYXIpIC5idXR0b25zKSAuY29sb3JQaWNrZXIpIC5kcm9wZG93bikgYnV0dG9uKTppcyg6aG92ZXIsOmFjdGl2ZSw6Zm9jdXMtdmlzaWJsZSkgPiAuc3dhdGNoewogICAgICAgICAgICAgICAgb3V0bGluZToycHggc29saWQgdmFyKC0taG92ZXItb3V0bGluZS1jb2xvcik7CiAgICAgICAgICAgICAgfQoKLmVkaXRvclBhcmFtc1Rvb2xiYXI6aGFzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyKXsKICBwYWRkaW5nOnVuc2V0Owp9CgojaGlnaGxpZ2h0UGFyYW1zVG9vbGJhckNvbnRhaW5lcnsKICBnYXA6MTZweDsKICBwYWRkaW5nLWlubGluZToxMHB4OwogIHBhZGRpbmctYmxvY2stZW5kOjEycHg7Cn0KCiNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyIC5jb2xvclBpY2tlcnsKICAgIGRpc3BsYXk6ZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgIGdhcDo4cHg7CiAgfQoKOmlzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyIC5jb2xvclBpY2tlcikgLmRyb3Bkb3duewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIGZsZXgtZGlyZWN0aW9uOnJvdzsKICAgICAgaGVpZ2h0OmF1dG87CiAgICB9Cgo6aXMoOmlzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyIC5jb2xvclBpY2tlcikgLmRyb3Bkb3duKSBidXR0b257CiAgICAgICAgd2lkdGg6YXV0bzsKICAgICAgICBoZWlnaHQ6YXV0bzsKICAgICAgICBib3JkZXI6bm9uZTsKICAgICAgICBjdXJzb3I6cG9pbnRlcjsKICAgICAgICBkaXNwbGF5OmZsZXg7CiAgICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICAgICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgICAgYmFja2dyb3VuZDpub25lOwogICAgICAgIGZsZXg6MCAwIGF1dG87CiAgICAgICAgcGFkZGluZzowOwogICAgICB9Cgo6aXMoOmlzKDppcygjaGlnaGxpZ2h0UGFyYW1zVG9vbGJhckNvbnRhaW5lciAuY29sb3JQaWNrZXIpIC5kcm9wZG93bikgYnV0dG9uKSAuc3dhdGNoewogICAgICAgICAgd2lkdGg6MjRweDsKICAgICAgICAgIGhlaWdodDoyNHB4OwogICAgICAgIH0KCjppcyg6aXMoOmlzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyIC5jb2xvclBpY2tlcikgLmRyb3Bkb3duKSBidXR0b24pOmlzKDphY3RpdmUsOmZvY3VzLXZpc2libGUpewogICAgICAgICAgb3V0bGluZTpub25lOwogICAgICAgIH0KClthcmlhLXNlbGVjdGVkPSJ0cnVlIl06aXMoOmlzKDppcygjaGlnaGxpZ2h0UGFyYW1zVG9vbGJhckNvbnRhaW5lciAuY29sb3JQaWNrZXIpIC5kcm9wZG93bikgYnV0dG9uKSA+IC5zd2F0Y2h7CiAgICAgICAgICBvdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1zZWxlY3RlZC1vdXRsaW5lLWNvbG9yKTsKICAgICAgICB9Cgo6aXMoOmlzKDppcygjaGlnaGxpZ2h0UGFyYW1zVG9vbGJhckNvbnRhaW5lciAuY29sb3JQaWNrZXIpIC5kcm9wZG93bikgYnV0dG9uKTppcyg6aG92ZXIsOmFjdGl2ZSw6Zm9jdXMtdmlzaWJsZSkgPiAuc3dhdGNoewogICAgICAgICAgb3V0bGluZToycHggc29saWQgdmFyKC0taG92ZXItb3V0bGluZS1jb2xvcik7CiAgICAgICAgfQoKI2hpZ2hsaWdodFBhcmFtc1Rvb2xiYXJDb250YWluZXIgI2VkaXRvckhpZ2hsaWdodFRoaWNrbmVzc3sKICAgIGRpc3BsYXk6ZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgIGFsaWduLWl0ZW1zOmNlbnRlcjsKICAgIGdhcDo0cHg7CiAgICBhbGlnbi1zZWxmOnN0cmV0Y2g7CiAgfQoKOmlzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyICNlZGl0b3JIaWdobGlnaHRUaGlja25lc3MpIC5lZGl0b3JQYXJhbXNMYWJlbHsKICAgICAgaGVpZ2h0OmF1dG87CiAgICAgIGFsaWduLXNlbGY6c3RyZXRjaDsKICAgIH0KCjppcygjaGlnaGxpZ2h0UGFyYW1zVG9vbGJhckNvbnRhaW5lciAjZWRpdG9ySGlnaGxpZ2h0VGhpY2tuZXNzKSAudGhpY2tuZXNzUGlja2VyewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIGFsaWduLXNlbGY6c3RyZXRjaDsKCiAgICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTkxOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICM4MDgwOGU7CgogICAgICAtLWV4YW1wbGUtY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTkxLCAjYmZiZmM5KTsKICAgIH0KCkBzdXBwb3J0cyAoY29sb3I6IGxpZ2h0LWRhcmsocmVkLCByZWQpKXsKOmlzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyICNlZGl0b3JIaWdobGlnaHRUaGlja25lc3MpIC50aGlja25lc3NQaWNrZXJ7CgogICAgICAtLWV4YW1wbGUtY29sb3I6bGlnaHQtZGFyaygjYmZiZmM5LCAjODA4MDhlKTsKICAgIH0KfQoKQHN1cHBvcnRzIG5vdCAoY29sb3I6IGxpZ2h0LWRhcmsodGFuLCB0YW4pKXsKCjppcyg6aXMoI2hpZ2hsaWdodFBhcmFtc1Rvb2xiYXJDb250YWluZXIgI2VkaXRvckhpZ2hsaWdodFRoaWNrbmVzcykgLnRoaWNrbmVzc1BpY2tlcikgKnsKCiAgICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTkxOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICM4MDgwOGU7CgogICAgICAtLWV4YW1wbGUtY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTkxLCAjYmZiZmM5KTsKICB9Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKOmlzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyICNlZGl0b3JIaWdobGlnaHRUaGlja25lc3MpIC50aGlja25lc3NQaWNrZXJ7CiAgICAgICAgLS1leGFtcGxlLWNvbG9yOkNhbnZhc1RleHQ7CiAgICB9CiAgICAgIH0KCjppcyg6aXMoOmlzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyICNlZGl0b3JIaWdobGlnaHRUaGlja25lc3MpIC50aGlja25lc3NQaWNrZXIpID4gLmVkaXRvclBhcmFtc1NsaWRlcltkaXNhYmxlZF0pewogICAgICAgIG9wYWNpdHk6MC40OwogICAgICB9Cgo6aXMoOmlzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyICNlZGl0b3JIaWdobGlnaHRUaGlja25lc3MpIC50aGlja25lc3NQaWNrZXIpOjpiZWZvcmUsOmlzKDppcygjaGlnaGxpZ2h0UGFyYW1zVG9vbGJhckNvbnRhaW5lciAjZWRpdG9ySGlnaGxpZ2h0VGhpY2tuZXNzKSAudGhpY2tuZXNzUGlja2VyKTo6YWZ0ZXJ7CiAgICAgICAgY29udGVudDoiIjsKICAgICAgICB3aWR0aDo4cHg7CiAgICAgICAgYXNwZWN0LXJhdGlvOjE7CiAgICAgICAgZGlzcGxheTpibG9jazsKICAgICAgICBib3JkZXItcmFkaXVzOjEwMCU7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1leGFtcGxlLWNvbG9yKTsKICAgICAgfQoKOmlzKDppcygjaGlnaGxpZ2h0UGFyYW1zVG9vbGJhckNvbnRhaW5lciAjZWRpdG9ySGlnaGxpZ2h0VGhpY2tuZXNzKSAudGhpY2tuZXNzUGlja2VyKTo6YWZ0ZXJ7CiAgICAgICAgd2lkdGg6MjRweDsKICAgICAgfQoKOmlzKDppcygjaGlnaGxpZ2h0UGFyYW1zVG9vbGJhckNvbnRhaW5lciAjZWRpdG9ySGlnaGxpZ2h0VGhpY2tuZXNzKSAudGhpY2tuZXNzUGlja2VyKSAuZWRpdG9yUGFyYW1zU2xpZGVyewogICAgICAgIHdpZHRoOnVuc2V0OwogICAgICAgIGhlaWdodDoxNHB4OwogICAgICB9CgojaGlnaGxpZ2h0UGFyYW1zVG9vbGJhckNvbnRhaW5lciAjZWRpdG9ySGlnaGxpZ2h0VmlzaWJpbGl0eXsKICAgIGRpc3BsYXk6ZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7CiAgICBnYXA6OHB4OwogICAgYWxpZ24tc2VsZjpzdHJldGNoOwogIH0KCjppcygjaGlnaGxpZ2h0UGFyYW1zVG9vbGJhckNvbnRhaW5lciAjZWRpdG9ySGlnaGxpZ2h0VmlzaWJpbGl0eSkgLmRpdmlkZXJ7CiAgICAgIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTkyOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpICM4ZjhmOWQ7CiAgICAgIC0tZGl2aWRlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tOTIsICNkN2Q3ZGIpOwogICAgfQoKQHN1cHBvcnRzIChjb2xvcjogbGlnaHQtZGFyayhyZWQsIHJlZCkpewo6aXMoI2hpZ2hsaWdodFBhcmFtc1Rvb2xiYXJDb250YWluZXIgI2VkaXRvckhpZ2hsaWdodFZpc2liaWxpdHkpIC5kaXZpZGVyewogICAgICAtLWRpdmlkZXItY29sb3I6bGlnaHQtZGFyaygjZDdkN2RiLCAjOGY4ZjlkKTsKICAgIH0KfQoKQHN1cHBvcnRzIG5vdCAoY29sb3I6IGxpZ2h0LWRhcmsodGFuLCB0YW4pKXsKCjppcyg6aXMoI2hpZ2hsaWdodFBhcmFtc1Rvb2xiYXJDb250YWluZXIgI2VkaXRvckhpZ2hsaWdodFZpc2liaWxpdHkpIC5kaXZpZGVyKSAqewogICAgICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS05Mjp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjOGY4ZjlkOwogICAgICAtLWRpdmlkZXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTkyLCAjZDdkN2RiKTsKICB9Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKOmlzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyICNlZGl0b3JIaWdobGlnaHRWaXNpYmlsaXR5KSAuZGl2aWRlcnsKICAgICAgICAtLWRpdmlkZXItY29sb3I6Q2FudmFzVGV4dDsKICAgIH0KICAgICAgfQoKOmlzKCNoaWdobGlnaHRQYXJhbXNUb29sYmFyQ29udGFpbmVyICNlZGl0b3JIaWdobGlnaHRWaXNpYmlsaXR5KSAuZGl2aWRlcnsKCiAgICAgIG1hcmdpbi1ibG9jazo0cHg7CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGhlaWdodDoxcHg7CiAgICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tZGl2aWRlci1jb2xvcik7CiAgICB9Cgo6aXMoI2hpZ2hsaWdodFBhcmFtc1Rvb2xiYXJDb250YWluZXIgI2VkaXRvckhpZ2hsaWdodFZpc2liaWxpdHkpIC50b2dnbGVyewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIGFsaWduLXNlbGY6c3RyZXRjaDsKICAgIH0KCiNhbHRUZXh0U2V0dGluZ3NEaWFsb2d7CiAgcGFkZGluZzoxNnB4Owp9CgojYWx0VGV4dFNldHRpbmdzRGlhbG9nICNhbHRUZXh0U2V0dGluZ3NDb250YWluZXJ7CiAgICBkaXNwbGF5OmZsZXg7CiAgICB3aWR0aDo1NzNweDsKICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgIGdhcDoxNnB4OwogIH0KCjppcygjYWx0VGV4dFNldHRpbmdzRGlhbG9nICNhbHRUZXh0U2V0dGluZ3NDb250YWluZXIpIC5tYWluQ29udGFpbmVyewogICAgICBnYXA6MTZweDsKICAgIH0KCjppcygjYWx0VGV4dFNldHRpbmdzRGlhbG9nICNhbHRUZXh0U2V0dGluZ3NDb250YWluZXIpIC5kZXNjcmlwdGlvbnsKICAgICAgY29sb3I6dmFyKC0tdGV4dC1zZWNvbmRhcnktY29sb3IpOwogICAgfQoKOmlzKCNhbHRUZXh0U2V0dGluZ3NEaWFsb2cgI2FsdFRleHRTZXR0aW5nc0NvbnRhaW5lcikgI2FpTW9kZWxTZXR0aW5nc3sKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICAgIGdhcDoxMnB4OwogICAgfQoKOmlzKDppcygjYWx0VGV4dFNldHRpbmdzRGlhbG9nICNhbHRUZXh0U2V0dGluZ3NDb250YWluZXIpICNhaU1vZGVsU2V0dGluZ3MpIGJ1dHRvbnsKICAgICAgICB3aWR0aDotbW96LWZpdC1jb250ZW50OwogICAgICAgIHdpZHRoOmZpdC1jb250ZW50OwogICAgICB9CgouZG93bmxvYWQ6aXMoOmlzKCNhbHRUZXh0U2V0dGluZ3NEaWFsb2cgI2FsdFRleHRTZXR0aW5nc0NvbnRhaW5lcikgI2FpTW9kZWxTZXR0aW5ncykgI2RlbGV0ZU1vZGVsQnV0dG9uewogICAgICAgICAgZGlzcGxheTpub25lOwogICAgICAgIH0KCjppcyg6aXMoI2FsdFRleHRTZXR0aW5nc0RpYWxvZyAjYWx0VGV4dFNldHRpbmdzQ29udGFpbmVyKSAjYWlNb2RlbFNldHRpbmdzKTpub3QoLmRvd25sb2FkKSAjZG93bmxvYWRNb2RlbEJ1dHRvbnsKICAgICAgICAgIGRpc3BsYXk6bm9uZTsKICAgICAgICB9Cgo6aXMoI2FsdFRleHRTZXR0aW5nc0RpYWxvZyAjYWx0VGV4dFNldHRpbmdzQ29udGFpbmVyKSAjYXV0b21hdGljQWx0VGV4dCw6aXMoI2FsdFRleHRTZXR0aW5nc0RpYWxvZyAjYWx0VGV4dFNldHRpbmdzQ29udGFpbmVyKSAjYWx0VGV4dEVkaXRvcnsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICAgIGdhcDo4cHg7CiAgICB9Cgo6aXMoI2FsdFRleHRTZXR0aW5nc0RpYWxvZyAjYWx0VGV4dFNldHRpbmdzQ29udGFpbmVyKSAjY3JlYXRlTW9kZWxEZXNjcmlwdGlvbiw6aXMoI2FsdFRleHRTZXR0aW5nc0RpYWxvZyAjYWx0VGV4dFNldHRpbmdzQ29udGFpbmVyKSAjYWlNb2RlbFNldHRpbmdzLDppcygjYWx0VGV4dFNldHRpbmdzRGlhbG9nICNhbHRUZXh0U2V0dGluZ3NDb250YWluZXIpICNzaG93QWx0VGV4dERpYWxvZ0Rlc2NyaXB0aW9uewogICAgICBwYWRkaW5nLWlubGluZS1zdGFydDo0MHB4OwogICAgfQoKOmlzKCNhbHRUZXh0U2V0dGluZ3NEaWFsb2cgI2FsdFRleHRTZXR0aW5nc0NvbnRhaW5lcikgI2F1dG9tYXRpY1NldHRpbmdzewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgICAgZ2FwOjE2cHg7CiAgICB9Cgo6cm9vdHsKICAtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQ6aW5pdGlhbDsKICBjb2xvci1zY2hlbWU6bGlnaHQgZGFyazsKCiAgLS12aWV3ZXItY29udGFpbmVyLWhlaWdodDowOwogIC0tcGRmVmlld2VyLXBhZGRpbmctYm90dG9tOjA7CiAgLS1wYWdlLW1hcmdpbjoxcHggYXV0byAtOHB4OwogIC0tcGFnZS1ib3JkZXI6OXB4IHNvbGlkIHRyYW5zcGFyZW50OwogIC0tc3ByZWFkSG9yaXpvbnRhbFdyYXBwZWQtbWFyZ2luLUxSOi0zLjVweDsKICAtLWxvYWRpbmctaWNvbi1kZWxheTo0MDBtczsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS05Mzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMGRmOwogIC0tZm9jdXMtcmluZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tOTMsICMwMDYwZGYpOwogIC0tZm9jdXMtcmluZy1vdXRsaW5lOjJweCBzb2xpZCB2YXIoLS1mb2N1cy1yaW5nLWNvbG9yKTsKfQoKQHN1cHBvcnRzIChjb2xvcjogbGlnaHQtZGFyayhyZWQsIHJlZCkpewo6cm9vdHsKICAtLWZvY3VzLXJpbmctY29sb3I6bGlnaHQtZGFyaygjMDA2MGRmLCAjMGRmKTsKfQp9CgpAc3VwcG9ydHMgbm90IChjb2xvcjogbGlnaHQtZGFyayh0YW4sIHRhbikpewoKOnJvb3QgKnsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS05Mzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjMGRmOwogIC0tZm9jdXMtcmluZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tOTMsICMwMDYwZGYpOwogIH0KfQoKQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyayl7Cgo6cm9vdHsKICAtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQ6Owp9Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKOnJvb3R7CiAgICAtLXBkZlZpZXdlci1wYWRkaW5nLWJvdHRvbTo5cHg7CiAgICAtLXBhZ2UtbWFyZ2luOjhweCBhdXRvIC0xcHg7CiAgICAtLXBhZ2UtYm9yZGVyOjFweCBzb2xpZCBDYW52YXNUZXh0OwogICAgLS1zcHJlYWRIb3Jpem9udGFsV3JhcHBlZC1tYXJnaW4tTFI6My41cHg7CiAgICAtLWZvY3VzLXJpbmctY29sb3I6Q2FudmFzVGV4dDsKfQogIH0KCltkYXRhLW1haW4tcm90YXRpb249IjkwIl17CiAgdHJhbnNmb3JtOnJvdGF0ZSg5MGRlZykgdHJhbnNsYXRlWSgtMTAwJSk7Cn0KW2RhdGEtbWFpbi1yb3RhdGlvbj0iMTgwIl17CiAgdHJhbnNmb3JtOnJvdGF0ZSgxODBkZWcpIHRyYW5zbGF0ZSgtMTAwJSwgLTEwMCUpOwp9CltkYXRhLW1haW4tcm90YXRpb249IjI3MCJdewogIHRyYW5zZm9ybTpyb3RhdGUoMjcwZGVnKSB0cmFuc2xhdGVYKC0xMDAlKTsKfQoKI2hpZGRlbkNvcHlFbGVtZW50LAouaGlkZGVuQ2FudmFzRWxlbWVudHsKICBwb3NpdGlvbjphYnNvbHV0ZTsKICB0b3A6MDsKICBsZWZ0OjA7CiAgd2lkdGg6MDsKICBoZWlnaHQ6MDsKICBkaXNwbGF5Om5vbmU7Cn0KCi5wZGZWaWV3ZXJ7CiAgLS1zY2FsZS1mYWN0b3I6MTsKICAtLXBhZ2UtYmctY29sb3I6dW5zZXQ7CgogIHBhZGRpbmctYm90dG9tOnZhcigtLXBkZlZpZXdlci1wYWRkaW5nLWJvdHRvbSk7CgogIC0taGNtLWhpZ2hsaWdodC1maWx0ZXI6bm9uZTsKICAtLWhjbS1oaWdobGlnaHQtc2VsZWN0ZWQtZmlsdGVyOm5vbmU7Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewoKLnBkZlZpZXdlcnsKICAgIC0taGNtLWhpZ2hsaWdodC1maWx0ZXI6aW52ZXJ0KDEwMCUpOwp9CiAgfQoKLnBkZlZpZXdlci5jb3B5QWxsewogICAgY3Vyc29yOndhaXQ7CiAgfQoKLnBkZlZpZXdlciAuY2FudmFzV3JhcHBlcnsKICAgIG92ZXJmbG93OmhpZGRlbjsKICAgIHdpZHRoOjEwMCU7CiAgICBoZWlnaHQ6MTAwJTsKICB9Cgo6aXMoLnBkZlZpZXdlciAuY2FudmFzV3JhcHBlcikgY2FudmFzewogICAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgICAgdG9wOjA7CiAgICAgIGxlZnQ6MDsKICAgICAgbWFyZ2luOjA7CiAgICAgIGRpc3BsYXk6YmxvY2s7CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGhlaWdodDoxMDAlOwogICAgICBjb250YWluOmNvbnRlbnQ7CiAgICB9Cgo6aXMoOmlzKC5wZGZWaWV3ZXIgLmNhbnZhc1dyYXBwZXIpIGNhbnZhcykgLnN0cnVjdFRyZWV7CiAgICAgICAgY29udGFpbjpzdHJpY3Q7CiAgICAgIH0KCi5wZGZWaWV3ZXIgLnBhZ2V7CiAgLS11c2VyLXVuaXQ6MTsKICAtLXRvdGFsLXNjYWxlLWZhY3RvcjpjYWxjKHZhcigtLXNjYWxlLWZhY3RvcikgKiB2YXIoLS11c2VyLXVuaXQpKTsKICAtLXNjYWxlLXJvdW5kLXg6MXB4OwogIC0tc2NhbGUtcm91bmQteToxcHg7CgogIGRpcmVjdGlvbjpsdHI7CiAgd2lkdGg6ODE2cHg7CiAgaGVpZ2h0OjEwNTZweDsKICBtYXJnaW46dmFyKC0tcGFnZS1tYXJnaW4pOwogIHBvc2l0aW9uOnJlbGF0aXZlOwogIG92ZXJmbG93OnZpc2libGU7CiAgYm9yZGVyOnZhcigtLXBhZ2UtYm9yZGVyKTsKICBiYWNrZ3JvdW5kLWNsaXA6Y29udGVudC1ib3g7CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1wYWdlLWJnLWNvbG9yLCByZ2IoMjU1IDI1NSAyNTUpKTsKfQoKLnBkZlZpZXdlciAuZHVtbXlQYWdlewogIHBvc2l0aW9uOnJlbGF0aXZlOwogIHdpZHRoOjA7CiAgaGVpZ2h0OnZhcigtLXZpZXdlci1jb250YWluZXItaGVpZ2h0KTsKfQoKLnBkZlZpZXdlci5ub1VzZXJTZWxlY3R7CiAgLXdlYmtpdC11c2VyLXNlbGVjdDpub25lOwogICAgIC1tb3otdXNlci1zZWxlY3Q6bm9uZTsKICAgICAgICAgIHVzZXItc2VsZWN0Om5vbmU7Cn0KCi5wZGZWaWV3ZXIucmVtb3ZlUGFnZUJvcmRlcnMgLnBhZ2V7CiAgbWFyZ2luOjAgYXV0byAxMHB4OwogIGJvcmRlcjpub25lOwp9CgoucGRmVmlld2VyOmlzKC5zY3JvbGxIb3Jpem9udGFsLCAuc2Nyb2xsV3JhcHBlZCksCi5zcHJlYWR7CiAgbWFyZ2luLWlubGluZTozLjVweDsKICB0ZXh0LWFsaWduOmNlbnRlcjsKfQoKLnBkZlZpZXdlci5zY3JvbGxIb3Jpem9udGFsLAouc3ByZWFkewogIHdoaXRlLXNwYWNlOm5vd3JhcDsKfQoKLnBkZlZpZXdlci5yZW1vdmVQYWdlQm9yZGVycywKLnBkZlZpZXdlcjppcyguc2Nyb2xsSG9yaXpvbnRhbCwgLnNjcm9sbFdyYXBwZWQpIC5zcHJlYWR7CiAgbWFyZ2luLWlubGluZTowOwp9Cgouc3ByZWFkIDppcygucGFnZSwgLmR1bW15UGFnZSksCi5wZGZWaWV3ZXI6aXMoLnNjcm9sbEhvcml6b250YWwsIC5zY3JvbGxXcmFwcGVkKSA6aXMoLnBhZ2UsIC5zcHJlYWQpewogIGRpc3BsYXk6aW5saW5lLWJsb2NrOwogIHZlcnRpY2FsLWFsaWduOm1pZGRsZTsKfQoKLnNwcmVhZCAucGFnZSwKLnBkZlZpZXdlcjppcyguc2Nyb2xsSG9yaXpvbnRhbCwgLnNjcm9sbFdyYXBwZWQpIC5wYWdlewogIG1hcmdpbi1pbmxpbmU6dmFyKC0tc3ByZWFkSG9yaXpvbnRhbFdyYXBwZWQtbWFyZ2luLUxSKTsKfQoKLnBkZlZpZXdlci5yZW1vdmVQYWdlQm9yZGVycyAuc3ByZWFkIC5wYWdlLAoucGRmVmlld2VyLnJlbW92ZVBhZ2VCb3JkZXJzOmlzKC5zY3JvbGxIb3Jpem9udGFsLCAuc2Nyb2xsV3JhcHBlZCkgLnBhZ2V7CiAgbWFyZ2luLWlubGluZTo1cHg7Cn0KCi5wZGZWaWV3ZXIgLnBhZ2UubG9hZGluZ0ljb246OmFmdGVyewogIHBvc2l0aW9uOmFic29sdXRlOwogIHRvcDowOwogIGxlZnQ6MDsKICBjb250ZW50OiIiOwogIHdpZHRoOjEwMCU7CiAgaGVpZ2h0OjEwMCU7CiAgYmFja2dyb3VuZDp1cmwoImltYWdlcy9sb2FkaW5nLWljb24uZ2lmIikgY2VudGVyIG5vLXJlcGVhdDsKICBkaXNwbGF5Om5vbmU7CiAgdHJhbnNpdGlvbi1wcm9wZXJ0eTpkaXNwbGF5OwogIHRyYW5zaXRpb24tZGVsYXk6dmFyKC0tbG9hZGluZy1pY29uLWRlbGF5KTsKICB6LWluZGV4OjU7CiAgY29udGFpbjpzdHJpY3Q7Cn0KCi5wZGZWaWV3ZXIgLnBhZ2UubG9hZGluZzo6YWZ0ZXJ7CiAgZGlzcGxheTpibG9jazsKfQoKLnBkZlZpZXdlciAucGFnZTpub3QoLmxvYWRpbmcpOjphZnRlcnsKICB0cmFuc2l0aW9uLXByb3BlcnR5Om5vbmU7CiAgZGlzcGxheTpub25lOwp9CgoucGRmUHJlc2VudGF0aW9uTW9kZSAucGRmVmlld2VyewogIHBhZGRpbmctYm90dG9tOjA7Cn0KCi5wZGZQcmVzZW50YXRpb25Nb2RlIC5zcHJlYWR7CiAgbWFyZ2luOjA7Cn0KCi5wZGZQcmVzZW50YXRpb25Nb2RlIC5wZGZWaWV3ZXIgLnBhZ2V7CiAgbWFyZ2luOjAgYXV0bzsKICBib3JkZXI6MnB4IHNvbGlkIHRyYW5zcGFyZW50Owp9Cgo6cm9vdHsKICAtLWRpci1mYWN0b3I6MTsKICAtLWlubGluZS1zdGFydDpsZWZ0OwogIC0taW5saW5lLWVuZDpyaWdodDsKCiAgLS1zaWRlYmFyLXdpZHRoOjIwMHB4OwogIC0tc2lkZWJhci10cmFuc2l0aW9uLWR1cmF0aW9uOjIwMG1zOwogIC0tc2lkZWJhci10cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvbjplYXNlOwoKICAtLXRvb2xiYXItaGVpZ2h0OjMycHg7CiAgLS10b29sYmFyLWhvcml6b250YWwtcGFkZGluZzoxcHg7CiAgLS10b29sYmFyLXZlcnRpY2FsLXBhZGRpbmc6MnB4OwogIC0taWNvbi1zaXplOjE2cHg7CgogIC0tdG9vbGJhci1pY29uLW9wYWNpdHk6MC43OwogIC0tZG9vcmhhbmdlci1pY29uLW9wYWNpdHk6MC45OwogIC0tZG9vcmhhbmdlci1oZWlnaHQ6OHB4OwoKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0wOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNDkgMjQ5IDI1MCk7CgogIC0tbWFpbi1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMCwgcmdiKDEyIDEyIDEzKSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoNDIgNDIgNDYpOwogIC0tYm9keS1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMSwgcmdiKDIxMiAyMTIgMjE1KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMCA5NiAyMjMpOwogIC0tcHJvZ3Jlc3NCYXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTIsIHJnYigxMCAxMzIgMjU1KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoNDAgNDAgNDMpOwogIC0tcHJvZ3Jlc3NCYXItYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTMsIHJnYigyMjEgMjIxIDIyMikpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTQ6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDIwIDY4IDEzMyk7CiAgLS1wcm9ncmVzc0Jhci1ibGVuZC1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNCwgcmdiKDExNiAxNzcgMjM5KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMTIxIDEyMSAxMjMpOwogIC0tc2Nyb2xsYmFyLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS01LCBhdXRvKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigzNSAzNSAzOSk7CiAgLS1zY3JvbGxiYXItYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTYsIGF1dG8pOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTc6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1NSAyNTUgMjU1KTsKICAtLXRvb2xiYXItaWNvbi1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNywgcmdiKDAgMCAwKSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tODp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUpOwogIC0tdG9vbGJhci1pY29uLWhvdmVyLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS04LCByZ2IoMCAwIDApKTsKCiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tOTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoNDIgNDIgNDYgLyAwLjkpOwoKICAtLXNpZGViYXItbmFycm93LWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS05LCByZ2IoMjEyIDIxMiAyMTUgLyAwLjkpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xMDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoNTAgNTAgNTIpOwogIC0tc2lkZWJhci10b29sYmFyLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xMCwgcmdiKDI0NSAyNDYgMjQ3KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTE6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDU2IDU2IDYxKTsKICAtLXRvb2xiYXItYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTExLCByZ2IoMjQ5IDI0OSAyNTApKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xMjp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMTIgMTIgMTMpOwogIC0tdG9vbGJhci1ib3JkZXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTEyLCByZ2IoMTg0IDE4NCAxODQpKTsKICAtLXRvb2xiYXItYm94LXNoYWRvdzowIDFweCAwIHZhcigtLXRvb2xiYXItYm9yZGVyLWNvbG9yKTsKICAtLXRvb2xiYXItYm9yZGVyLWJvdHRvbTpub25lOwogIC0tdG9vbGJhclNpZGViYXItYm94LXNoYWRvdzppbnNldCBjYWxjKC0xcHggKiB2YXIoLS1kaXItZmFjdG9yKSkgMCAwIHJnYigwIDAgMCAvIDAuMjUpLCAwIDFweCAwIHJnYigwIDAgMCAvIDAuMTUpLCAwIDAgMXB4IHJnYigwIDAgMCAvIDAuMSk7CiAgLS10b29sYmFyU2lkZWJhci1ib3JkZXItYm90dG9tOm5vbmU7CiAgLS1idXR0b24taG92ZXItY29sb3I6Y29sb3ItbWl4KGluIHNyZ2IsIGN1cnJlbnRDb2xvciAxNyUsIHRyYW5zcGFyZW50KTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xMzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUpOwogIC0tdG9nZ2xlZC1idG4tY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTEzLCByZ2IoMCAwIDApKTsKICAtLXRvZ2dsZWQtYnRuLWJnLWNvbG9yOnJnYigwIDAgMCAvIDAuMyk7CiAgLS10b2dnbGVkLWhvdmVyLWFjdGl2ZS1idG4tY29sb3I6cmdiKDAgMCAwIC8gMC40KTsKICAtLXRvZ2dsZWQtaG92ZXItYnRuLW91dGxpbmU6bm9uZTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xNDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoNzQgNzQgNzkpOwogIC0tZHJvcGRvd24tYnRuLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xNCwgcmdiKDIxNSAyMTUgMjE5KSk7CiAgLS1kcm9wZG93bi1idG4tYm9yZGVyOm5vbmU7CiAgLS1zZXBhcmF0b3ItY29sb3I6cmdiKDAgMCAwIC8gMC4zKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xNTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjUwIDI1MCAyNTApOwogIC0tZmllbGQtY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTE1LCByZ2IoNiA2IDYpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xNjp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoNjQgNjQgNjgpOwogIC0tZmllbGQtYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTE2LCByZ2IoMjU1IDI1NSAyNTUpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xNzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMTE1IDExNSAxMTUpOwogIC0tZmllbGQtYm9yZGVyLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xNywgcmdiKDE4NyAxODcgMTg4KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1NSAyNTUgMjU1IC8gMC44KTsKICAtLXRyZWVpdGVtLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xOCwgcmdiKDAgMCAwIC8gMC44KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTk6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1NSAyNTUgMjU1IC8gMC4xNSk7CiAgLS10cmVlaXRlbS1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTksIHJnYigwIDAgMCAvIDAuMTUpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yMDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjkpOwogIC0tdHJlZWl0ZW0taG92ZXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTIwLCByZ2IoMCAwIDAgLyAwLjkpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yMTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjkpOwogIC0tdHJlZWl0ZW0tc2VsZWN0ZWQtY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTIxLCByZ2IoMCAwIDAgLyAwLjkpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yMjp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjI1KTsKICAtLXRyZWVpdGVtLXNlbGVjdGVkLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yMiwgcmdiKDAgMCAwIC8gMC4yNSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTIzOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTUgMjU1IDI1NSAvIDAuMSk7CiAgLS10aHVtYm5haWwtaG92ZXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTIzLCByZ2IoMCAwIDAgLyAwLjEpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yNDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjIpOwogIC0tdGh1bWJuYWlsLXNlbGVjdGVkLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yNCwgcmdiKDAgMCAwIC8gMC4yKSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjU6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgIzQyNDE0ZDsKICAtLWRvb3JoYW5nZXItYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTI1LCByZ2IoMjU1IDI1NSAyNTUpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yNjp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMzkgMzkgNDMpOwogIC0tZG9vcmhhbmdlci1ib3JkZXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTI2LCByZ2IoMTIgMTIgMTMgLyAwLjIpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yNzp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjQ5IDI0OSAyNTApOwogIC0tZG9vcmhhbmdlci1ob3Zlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjcsIHJnYigxMiAxMiAxMykpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTI4OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYig5MiA5MiA5Nyk7CiAgLS1kb29yaGFuZ2VyLXNlcGFyYXRvci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjgsIHJnYigyMjIgMjIyIDIyMikpOwogIC0tZGlhbG9nLWJ1dHRvbi1ib3JkZXI6bm9uZTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yOTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoOTIgOTIgOTcpOwogIC0tZGlhbG9nLWJ1dHRvbi1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjksIHJnYigxMiAxMiAxMyAvIDAuMSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTMwOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigxMTUgMTE1IDExNSk7CiAgLS1kaWFsb2ctYnV0dG9uLWhvdmVyLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zMCwgcmdiKDEyIDEyIDEzIC8gMC4zKSk7CgogIC0tbG9hZGluZy1pY29uOnVybChpbWFnZXMvbG9hZGluZy5zdmcpOwogIC0tdHJlZWl0ZW0tZXhwYW5kZWQtaWNvbjp1cmwoaW1hZ2VzL3RyZWVpdGVtLWV4cGFuZGVkLnN2Zyk7CiAgLS10cmVlaXRlbS1jb2xsYXBzZWQtaWNvbjp1cmwoaW1hZ2VzL3RyZWVpdGVtLWNvbGxhcHNlZC5zdmcpOwogIC0tdG9vbGJhckJ1dHRvbi1lZGl0b3JGcmVlVGV4dC1pY29uOnVybChpbWFnZXMvdG9vbGJhckJ1dHRvbi1lZGl0b3JGcmVlVGV4dC5zdmcpOwogIC0tdG9vbGJhckJ1dHRvbi1lZGl0b3JIaWdobGlnaHQtaWNvbjp1cmwoaW1hZ2VzL3Rvb2xiYXJCdXR0b24tZWRpdG9ySGlnaGxpZ2h0LnN2Zyk7CiAgLS10b29sYmFyQnV0dG9uLWVkaXRvckluay1pY29uOnVybChpbWFnZXMvdG9vbGJhckJ1dHRvbi1lZGl0b3JJbmsuc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tZWRpdG9yU3RhbXAtaWNvbjp1cmwoaW1hZ2VzL3Rvb2xiYXJCdXR0b24tZWRpdG9yU3RhbXAuc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tZWRpdG9yU2lnbmF0dXJlLWljb246dXJsKGltYWdlcy90b29sYmFyQnV0dG9uLWVkaXRvclNpZ25hdHVyZS5zdmcpOwogIC0tdG9vbGJhckJ1dHRvbi1tZW51QXJyb3ctaWNvbjp1cmwoaW1hZ2VzL3Rvb2xiYXJCdXR0b24tbWVudUFycm93LnN2Zyk7CiAgLS10b29sYmFyQnV0dG9uLXNpZGViYXJUb2dnbGUtaWNvbjp1cmwoaW1hZ2VzL3Rvb2xiYXJCdXR0b24tc2lkZWJhclRvZ2dsZS5zdmcpOwogIC0tdG9vbGJhckJ1dHRvbi1zZWNvbmRhcnlUb29sYmFyVG9nZ2xlLWljb246dXJsKGltYWdlcy90b29sYmFyQnV0dG9uLXNlY29uZGFyeVRvb2xiYXJUb2dnbGUuc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tcGFnZVVwLWljb246dXJsKGltYWdlcy90b29sYmFyQnV0dG9uLXBhZ2VVcC5zdmcpOwogIC0tdG9vbGJhckJ1dHRvbi1wYWdlRG93bi1pY29uOnVybChpbWFnZXMvdG9vbGJhckJ1dHRvbi1wYWdlRG93bi5zdmcpOwogIC0tdG9vbGJhckJ1dHRvbi16b29tT3V0LWljb246dXJsKGltYWdlcy90b29sYmFyQnV0dG9uLXpvb21PdXQuc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tem9vbUluLWljb246dXJsKGltYWdlcy90b29sYmFyQnV0dG9uLXpvb21Jbi5zdmcpOwogIC0tdG9vbGJhckJ1dHRvbi1wcmVzZW50YXRpb25Nb2RlLWljb246dXJsKGltYWdlcy90b29sYmFyQnV0dG9uLXByZXNlbnRhdGlvbk1vZGUuc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tcHJpbnQtaWNvbjp1cmwoaW1hZ2VzL3Rvb2xiYXJCdXR0b24tcHJpbnQuc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tb3BlbkZpbGUtaWNvbjp1cmwoaW1hZ2VzL3Rvb2xiYXJCdXR0b24tb3BlbkZpbGUuc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tZG93bmxvYWQtaWNvbjp1cmwoaW1hZ2VzL3Rvb2xiYXJCdXR0b24tZG93bmxvYWQuc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tYm9va21hcmstaWNvbjp1cmwoaW1hZ2VzL3Rvb2xiYXJCdXR0b24tYm9va21hcmsuc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tdmlld1RodW1ibmFpbC1pY29uOnVybChpbWFnZXMvdG9vbGJhckJ1dHRvbi12aWV3VGh1bWJuYWlsLnN2Zyk7CiAgLS10b29sYmFyQnV0dG9uLXZpZXdPdXRsaW5lLWljb246dXJsKGltYWdlcy90b29sYmFyQnV0dG9uLXZpZXdPdXRsaW5lLnN2Zyk7CiAgLS10b29sYmFyQnV0dG9uLXZpZXdBdHRhY2htZW50cy1pY29uOnVybChpbWFnZXMvdG9vbGJhckJ1dHRvbi12aWV3QXR0YWNobWVudHMuc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tdmlld0xheWVycy1pY29uOnVybChpbWFnZXMvdG9vbGJhckJ1dHRvbi12aWV3TGF5ZXJzLnN2Zyk7CiAgLS10b29sYmFyQnV0dG9uLWN1cnJlbnRPdXRsaW5lSXRlbS1pY29uOnVybChpbWFnZXMvdG9vbGJhckJ1dHRvbi1jdXJyZW50T3V0bGluZUl0ZW0uc3ZnKTsKICAtLXRvb2xiYXJCdXR0b24tc2VhcmNoLWljb246dXJsKGltYWdlcy90b29sYmFyQnV0dG9uLXNlYXJjaC5zdmcpOwogIC0tZmluZGJhckJ1dHRvbi1wcmV2aW91cy1pY29uOnVybChpbWFnZXMvZmluZGJhckJ1dHRvbi1wcmV2aW91cy5zdmcpOwogIC0tZmluZGJhckJ1dHRvbi1uZXh0LWljb246dXJsKGltYWdlcy9maW5kYmFyQnV0dG9uLW5leHQuc3ZnKTsKICAtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24tZmlyc3RQYWdlLWljb246dXJsKGltYWdlcy9zZWNvbmRhcnlUb29sYmFyQnV0dG9uLWZpcnN0UGFnZS5zdmcpOwogIC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1sYXN0UGFnZS1pY29uOnVybChpbWFnZXMvc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1sYXN0UGFnZS5zdmcpOwogIC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1yb3RhdGVDY3ctaWNvbjp1cmwoaW1hZ2VzL3NlY29uZGFyeVRvb2xiYXJCdXR0b24tcm90YXRlQ2N3LnN2Zyk7CiAgLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXJvdGF0ZUN3LWljb246dXJsKGltYWdlcy9zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXJvdGF0ZUN3LnN2Zyk7CiAgLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNlbGVjdFRvb2wtaWNvbjp1cmwoaW1hZ2VzL3NlY29uZGFyeVRvb2xiYXJCdXR0b24tc2VsZWN0VG9vbC5zdmcpOwogIC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1oYW5kVG9vbC1pY29uOnVybChpbWFnZXMvc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1oYW5kVG9vbC5zdmcpOwogIC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1zY3JvbGxQYWdlLWljb246dXJsKGltYWdlcy9zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNjcm9sbFBhZ2Uuc3ZnKTsKICAtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24tc2Nyb2xsVmVydGljYWwtaWNvbjp1cmwoaW1hZ2VzL3NlY29uZGFyeVRvb2xiYXJCdXR0b24tc2Nyb2xsVmVydGljYWwuc3ZnKTsKICAtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24tc2Nyb2xsSG9yaXpvbnRhbC1pY29uOnVybChpbWFnZXMvc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1zY3JvbGxIb3Jpem9udGFsLnN2Zyk7CiAgLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNjcm9sbFdyYXBwZWQtaWNvbjp1cmwoaW1hZ2VzL3NlY29uZGFyeVRvb2xiYXJCdXR0b24tc2Nyb2xsV3JhcHBlZC5zdmcpOwogIC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1zcHJlYWROb25lLWljb246dXJsKGltYWdlcy9zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNwcmVhZE5vbmUuc3ZnKTsKICAtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24tc3ByZWFkT2RkLWljb246dXJsKGltYWdlcy9zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNwcmVhZE9kZC5zdmcpOwogIC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1zcHJlYWRFdmVuLWljb246dXJsKGltYWdlcy9zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNwcmVhZEV2ZW4uc3ZnKTsKICAtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24taW1hZ2VBbHRUZXh0U2V0dGluZ3MtaWNvbjp2YXIoCiAgICAtLXRvb2xiYXJCdXR0b24tZWRpdG9yU3RhbXAtaWNvbgogICk7CiAgLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLWRvY3VtZW50UHJvcGVydGllcy1pY29uOnVybChpbWFnZXMvc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1kb2N1bWVudFByb3BlcnRpZXMuc3ZnKTsKICAtLWVkaXRvclBhcmFtcy1zdGFtcEFkZEltYWdlLWljb246dXJsKGltYWdlcy90b29sYmFyQnV0dG9uLXpvb21Jbi5zdmcpOwp9CgpAc3VwcG9ydHMgKGNvbG9yOiBsaWdodC1kYXJrKHJlZCwgcmVkKSkgYW5kIChjb2xvcjogcmdiKDAgMCAwIC8gMCkpewo6cm9vdHsKCiAgLS1tYWluLWNvbG9yOmxpZ2h0LWRhcmsocmdiKDEyIDEyIDEzKSwgcmdiKDI0OSAyNDkgMjUwKSk7CiAgLS1ib2R5LWJnLWNvbG9yOmxpZ2h0LWRhcmsocmdiKDIxMiAyMTIgMjE1KSwgcmdiKDQyIDQyIDQ2KSk7CiAgLS1wcm9ncmVzc0Jhci1jb2xvcjpsaWdodC1kYXJrKHJnYigxMCAxMzIgMjU1KSwgcmdiKDAgOTYgMjIzKSk7CiAgLS1wcm9ncmVzc0Jhci1iZy1jb2xvcjpsaWdodC1kYXJrKHJnYigyMjEgMjIxIDIyMiksIHJnYig0MCA0MCA0MykpOwogIC0tcHJvZ3Jlc3NCYXItYmxlbmQtY29sb3I6bGlnaHQtZGFyayhyZ2IoMTE2IDE3NyAyMzkpLCByZ2IoMjAgNjggMTMzKSk7CiAgLS1zY3JvbGxiYXItY29sb3I6bGlnaHQtZGFyayhhdXRvLCByZ2IoMTIxIDEyMSAxMjMpKTsKICAtLXNjcm9sbGJhci1iZy1jb2xvcjpsaWdodC1kYXJrKGF1dG8sIHJnYigzNSAzNSAzOSkpOwogIC0tdG9vbGJhci1pY29uLWJnLWNvbG9yOmxpZ2h0LWRhcmsocmdiKDAgMCAwKSwgcmdiKDI1NSAyNTUgMjU1KSk7CiAgLS10b29sYmFyLWljb24taG92ZXItYmctY29sb3I6bGlnaHQtZGFyayhyZ2IoMCAwIDApLCByZ2IoMjU1IDI1NSAyNTUpKTsKCiAgLS1zaWRlYmFyLW5hcnJvdy1iZy1jb2xvcjpsaWdodC1kYXJrKAogICAgcmdiKDIxMiAyMTIgMjE1IC8gMC45KSwKICAgIHJnYig0MiA0MiA0NiAvIDAuOSkKICApOwogIC0tc2lkZWJhci10b29sYmFyLWJnLWNvbG9yOmxpZ2h0LWRhcmsocmdiKDI0NSAyNDYgMjQ3KSwgcmdiKDUwIDUwIDUyKSk7CiAgLS10b29sYmFyLWJnLWNvbG9yOmxpZ2h0LWRhcmsocmdiKDI0OSAyNDkgMjUwKSwgcmdiKDU2IDU2IDYxKSk7CiAgLS10b29sYmFyLWJvcmRlci1jb2xvcjpsaWdodC1kYXJrKHJnYigxODQgMTg0IDE4NCksIHJnYigxMiAxMiAxMykpOwogIC0tdG9nZ2xlZC1idG4tY29sb3I6bGlnaHQtZGFyayhyZ2IoMCAwIDApLCByZ2IoMjU1IDI1NSAyNTUpKTsKICAtLWRyb3Bkb3duLWJ0bi1iZy1jb2xvcjpsaWdodC1kYXJrKHJnYigyMTUgMjE1IDIxOSksIHJnYig3NCA3NCA3OSkpOwogIC0tZmllbGQtY29sb3I6bGlnaHQtZGFyayhyZ2IoNiA2IDYpLCByZ2IoMjUwIDI1MCAyNTApKTsKICAtLWZpZWxkLWJnLWNvbG9yOmxpZ2h0LWRhcmsocmdiKDI1NSAyNTUgMjU1KSwgcmdiKDY0IDY0IDY4KSk7CiAgLS1maWVsZC1ib3JkZXItY29sb3I6bGlnaHQtZGFyayhyZ2IoMTg3IDE4NyAxODgpLCByZ2IoMTE1IDExNSAxMTUpKTsKICAtLXRyZWVpdGVtLWNvbG9yOmxpZ2h0LWRhcmsocmdiKDAgMCAwIC8gMC44KSwgcmdiKDI1NSAyNTUgMjU1IC8gMC44KSk7CiAgLS10cmVlaXRlbS1iZy1jb2xvcjpsaWdodC1kYXJrKHJnYigwIDAgMCAvIDAuMTUpLCByZ2IoMjU1IDI1NSAyNTUgLyAwLjE1KSk7CiAgLS10cmVlaXRlbS1ob3Zlci1jb2xvcjpsaWdodC1kYXJrKHJnYigwIDAgMCAvIDAuOSksIHJnYigyNTUgMjU1IDI1NSAvIDAuOSkpOwogIC0tdHJlZWl0ZW0tc2VsZWN0ZWQtY29sb3I6bGlnaHQtZGFyaygKICAgIHJnYigwIDAgMCAvIDAuOSksCiAgICByZ2IoMjU1IDI1NSAyNTUgLyAwLjkpCiAgKTsKICAtLXRyZWVpdGVtLXNlbGVjdGVkLWJnLWNvbG9yOmxpZ2h0LWRhcmsoCiAgICByZ2IoMCAwIDAgLyAwLjI1KSwKICAgIHJnYigyNTUgMjU1IDI1NSAvIDAuMjUpCiAgKTsKICAtLXRodW1ibmFpbC1ob3Zlci1jb2xvcjpsaWdodC1kYXJrKHJnYigwIDAgMCAvIDAuMSksIHJnYigyNTUgMjU1IDI1NSAvIDAuMSkpOwogIC0tdGh1bWJuYWlsLXNlbGVjdGVkLWNvbG9yOmxpZ2h0LWRhcmsoCiAgICByZ2IoMCAwIDAgLyAwLjIpLAogICAgcmdiKDI1NSAyNTUgMjU1IC8gMC4yKQogICk7CiAgLS1kb29yaGFuZ2VyLWJnLWNvbG9yOmxpZ2h0LWRhcmsocmdiKDI1NSAyNTUgMjU1KSwgIzQyNDE0ZCk7CiAgLS1kb29yaGFuZ2VyLWJvcmRlci1jb2xvcjpsaWdodC1kYXJrKHJnYigxMiAxMiAxMyAvIDAuMiksIHJnYigzOSAzOSA0MykpOwogIC0tZG9vcmhhbmdlci1ob3Zlci1jb2xvcjpsaWdodC1kYXJrKHJnYigxMiAxMiAxMyksIHJnYigyNDkgMjQ5IDI1MCkpOwogIC0tZG9vcmhhbmdlci1zZXBhcmF0b3ItY29sb3I6bGlnaHQtZGFyayhyZ2IoMjIyIDIyMiAyMjIpLCByZ2IoOTIgOTIgOTcpKTsKICAtLWRpYWxvZy1idXR0b24tYmctY29sb3I6bGlnaHQtZGFyayhyZ2IoMTIgMTIgMTMgLyAwLjEpLCByZ2IoOTIgOTIgOTcpKTsKICAtLWRpYWxvZy1idXR0b24taG92ZXItYmctY29sb3I6bGlnaHQtZGFyaygKICAgIHJnYigxMiAxMiAxMyAvIDAuMyksCiAgICByZ2IoMTE1IDExNSAxMTUpCiAgKTsKfQp9CgpAc3VwcG9ydHMgbm90IChjb2xvcjogbGlnaHQtZGFyayh0YW4sIHRhbikpewoKOnJvb3QgKnsKCiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjQ5IDI0OSAyNTApOwoKICAtLW1haW4tY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTAsIHJnYigxMiAxMiAxMykpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTE6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDQyIDQyIDQ2KTsKICAtLWJvZHktYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTEsIHJnYigyMTIgMjEyIDIxNSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTI6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDAgOTYgMjIzKTsKICAtLXByb2dyZXNzQmFyLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yLCByZ2IoMTAgMTMyIDI1NSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTM6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDQwIDQwIDQzKTsKICAtLXByb2dyZXNzQmFyLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zLCByZ2IoMjIxIDIyMSAyMjIpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS00OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyMCA2OCAxMzMpOwogIC0tcHJvZ3Jlc3NCYXItYmxlbmQtY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTQsIHJnYigxMTYgMTc3IDIzOSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTU6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDEyMSAxMjEgMTIzKTsKICAtLXNjcm9sbGJhci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNSwgYXV0byk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tNjp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMzUgMzUgMzkpOwogIC0tc2Nyb2xsYmFyLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS02LCBhdXRvKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS03OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTUgMjU1IDI1NSk7CiAgLS10b29sYmFyLWljb24tYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTcsIHJnYigwIDAgMCkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1NSAyNTUgMjU1KTsKICAtLXRvb2xiYXItaWNvbi1ob3Zlci1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tOCwgcmdiKDAgMCAwKSk7CgogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTk6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDQyIDQyIDQ2IC8gMC45KTsKCiAgLS1zaWRlYmFyLW5hcnJvdy1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tOSwgcmdiKDIxMiAyMTIgMjE1IC8gMC45KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTA6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDUwIDUwIDUyKTsKICAtLXNpZGViYXItdG9vbGJhci1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTAsIHJnYigyNDUgMjQ2IDI0NykpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTExOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYig1NiA1NiA2MSk7CiAgLS10b29sYmFyLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xMSwgcmdiKDI0OSAyNDkgMjUwKSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTI6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDEyIDEyIDEzKTsKICAtLXRvb2xiYXItYm9yZGVyLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xMiwgcmdiKDE4NCAxODQgMTg0KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTM6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1NSAyNTUgMjU1KTsKICAtLXRvZ2dsZWQtYnRuLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xMywgcmdiKDAgMCAwKSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTQ6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDc0IDc0IDc5KTsKICAtLWRyb3Bkb3duLWJ0bi1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTQsIHJnYigyMTUgMjE1IDIxOSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTE1OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTAgMjUwIDI1MCk7CiAgLS1maWVsZC1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTUsIHJnYig2IDYgNikpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTE2OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYig2NCA2NCA2OCk7CiAgLS1maWVsZC1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMTYsIHJnYigyNTUgMjU1IDI1NSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTE3OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigxMTUgMTE1IDExNSk7CiAgLS1maWVsZC1ib3JkZXItY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTE3LCByZ2IoMTg3IDE4NyAxODgpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xODp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjgpOwogIC0tdHJlZWl0ZW0tY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTE4LCByZ2IoMCAwIDAgLyAwLjgpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xOTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMjU1IDI1NSAyNTUgLyAwLjE1KTsKICAtLXRyZWVpdGVtLWJnLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0xOSwgcmdiKDAgMCAwIC8gMC4xNSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTIwOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTUgMjU1IDI1NSAvIDAuOSk7CiAgLS10cmVlaXRlbS1ob3Zlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjAsIHJnYigwIDAgMCAvIDAuOSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTIxOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTUgMjU1IDI1NSAvIDAuOSk7CiAgLS10cmVlaXRlbS1zZWxlY3RlZC1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjEsIHJnYigwIDAgMCAvIDAuOSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTIyOnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTUgMjU1IDI1NSAvIDAuMjUpOwogIC0tdHJlZWl0ZW0tc2VsZWN0ZWQtYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTIyLCByZ2IoMCAwIDAgLyAwLjI1KSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjM6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDI1NSAyNTUgMjU1IC8gMC4xKTsKICAtLXRodW1ibmFpbC1ob3Zlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjMsIHJnYigwIDAgMCAvIDAuMSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTI0OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNTUgMjU1IDI1NSAvIDAuMik7CiAgLS10aHVtYm5haWwtc2VsZWN0ZWQtY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTI0LCByZ2IoMCAwIDAgLyAwLjIpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yNTp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSAjNDI0MTRkOwogIC0tZG9vcmhhbmdlci1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjUsIHJnYigyNTUgMjU1IDI1NSkpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTI2OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigzOSAzOSA0Myk7CiAgLS1kb29yaGFuZ2VyLWJvcmRlci1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjYsIHJnYigxMiAxMiAxMyAvIDAuMikpOwogIC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTI3OnZhcigtLWNzc3Rvb2xzLWNvbG9yLXNjaGVtZS0tbGlnaHQpIHJnYigyNDkgMjQ5IDI1MCk7CiAgLS1kb29yaGFuZ2VyLWhvdmVyLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yNywgcmdiKDEyIDEyIDEzKSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjg6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDkyIDkyIDk3KTsKICAtLWRvb3JoYW5nZXItc2VwYXJhdG9yLWNvbG9yOnZhcigtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0yOCwgcmdiKDIyMiAyMjIgMjIyKSk7CiAgLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMjk6dmFyKC0tY3NzdG9vbHMtY29sb3Itc2NoZW1lLS1saWdodCkgcmdiKDkyIDkyIDk3KTsKICAtLWRpYWxvZy1idXR0b24tYmctY29sb3I6dmFyKC0tY3NzdG9vbHMtbGlnaHQtZGFyay10b2dnbGUtLTI5LCByZ2IoMTIgMTIgMTMgLyAwLjEpKTsKICAtLWNzc3Rvb2xzLWxpZ2h0LWRhcmstdG9nZ2xlLS0zMDp2YXIoLS1jc3N0b29scy1jb2xvci1zY2hlbWUtLWxpZ2h0KSByZ2IoMTE1IDExNSAxMTUpOwogIC0tZGlhbG9nLWJ1dHRvbi1ob3Zlci1iZy1jb2xvcjp2YXIoLS1jc3N0b29scy1saWdodC1kYXJrLXRvZ2dsZS0tMzAsIHJnYigxMiAxMiAxMyAvIDAuMykpOwogIH0KfQoKW2Rpcj0icnRsIl06cm9vdHsKICAtLWRpci1mYWN0b3I6LTE7CiAgLS1pbmxpbmUtc3RhcnQ6cmlnaHQ7CiAgLS1pbmxpbmUtZW5kOmxlZnQ7Cn0KCkBtZWRpYSBzY3JlZW4gYW5kIChmb3JjZWQtY29sb3JzOiBhY3RpdmUpewogIDpyb290ewogICAgLS1idXR0b24taG92ZXItY29sb3I6SGlnaGxpZ2h0OwogICAgLS10b29sYmFyLWljb24tb3BhY2l0eToxOwogICAgLS10b29sYmFyLWljb24tYmctY29sb3I6QnV0dG9uVGV4dDsKICAgIC0tdG9vbGJhci1pY29uLWhvdmVyLWJnLWNvbG9yOkJ1dHRvbkZhY2U7CiAgICAtLXRvZ2dsZWQtaG92ZXItYWN0aXZlLWJ0bi1jb2xvcjpCdXR0b25UZXh0OwogICAgLS10b2dnbGVkLWhvdmVyLWJ0bi1vdXRsaW5lOjJweCBzb2xpZCBCdXR0b25Cb3JkZXI7CiAgICAtLXRvb2xiYXItYm9yZGVyLWNvbG9yOkNhbnZhc1RleHQ7CiAgICAtLXRvb2xiYXItYm9yZGVyLWJvdHRvbToxcHggc29saWQgdmFyKC0tdG9vbGJhci1ib3JkZXItY29sb3IpOwogICAgLS10b29sYmFyLWJveC1zaGFkb3c6bm9uZTsKICAgIC0tdG9nZ2xlZC1idG4tY29sb3I6SGlnaGxpZ2h0VGV4dDsKICAgIC0tdG9nZ2xlZC1idG4tYmctY29sb3I6TGlua1RleHQ7CiAgICAtLWRvb3JoYW5nZXItaG92ZXItY29sb3I6QnV0dG9uRmFjZTsKICAgIC0tZG9vcmhhbmdlci1ib3JkZXItY29sb3Itd2hjbToxcHggc29saWQgQnV0dG9uVGV4dDsKICAgIC0tZG9vcmhhbmdlci10cmlhbmdsZS1vcGFjaXR5LXdoY206MDsKICAgIC0tZGlhbG9nLWJ1dHRvbi1ib3JkZXI6MXB4IHNvbGlkIEhpZ2hsaWdodDsKICAgIC0tZGlhbG9nLWJ1dHRvbi1ob3Zlci1iZy1jb2xvcjpIaWdobGlnaHQ7CiAgICAtLWRpYWxvZy1idXR0b24taG92ZXItY29sb3I6QnV0dG9uRmFjZTsKICAgIC0tZHJvcGRvd24tYnRuLWJvcmRlcjoxcHggc29saWQgQnV0dG9uVGV4dDsKICAgIC0tZmllbGQtYm9yZGVyLWNvbG9yOkJ1dHRvblRleHQ7CiAgICAtLW1haW4tY29sb3I6Q2FudmFzVGV4dDsKICAgIC0tc2VwYXJhdG9yLWNvbG9yOkdyYXlUZXh0OwogICAgLS1kb29yaGFuZ2VyLXNlcGFyYXRvci1jb2xvcjpHcmF5VGV4dDsKICAgIC0tdG9vbGJhclNpZGViYXItYm94LXNoYWRvdzpub25lOwogICAgLS10b29sYmFyU2lkZWJhci1ib3JkZXItYm90dG9tOjFweCBzb2xpZCB2YXIoLS10b29sYmFyLWJvcmRlci1jb2xvcik7CiAgfQp9CgpAbWVkaWEgc2NyZWVuIGFuZCAocHJlZmVycy1yZWR1Y2VkLW1vdGlvbjogcmVkdWNlKXsKICA6cm9vdHsKICAgIC0tc2lkZWJhci10cmFuc2l0aW9uLWR1cmF0aW9uOjA7CiAgfQp9CgpAa2V5ZnJhbWVzIHByb2dyZXNzSW5kZXRlcm1pbmF0ZXsKICAwJXsKICAgIHRyYW5zZm9ybTp0cmFuc2xhdGVYKGNhbGMoLTE0MnB4ICogdmFyKC0tZGlyLWZhY3RvcikpKTsKICB9CgogIDEwMCV7CiAgICB0cmFuc2Zvcm06dHJhbnNsYXRlWCgwKTsKICB9Cn0KCmh0bWxbZGF0YS10b29sYmFyLWRlbnNpdHk9ImNvbXBhY3QiXXsKICAgIC0tdG9vbGJhci1oZWlnaHQ6MzBweDsKICB9CgpodG1sW2RhdGEtdG9vbGJhci1kZW5zaXR5PSJ0b3VjaCJdewogICAgLS10b29sYmFyLWhlaWdodDo0NHB4OwogIH0KCmh0bWwsCmJvZHl7CiAgaGVpZ2h0OjEwMCU7CiAgd2lkdGg6MTAwJTsKfQoKYm9keXsKICBtYXJnaW46MDsKICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWJvZHktYmctY29sb3IpOwogIHNjcm9sbGJhci1jb2xvcjp2YXIoLS1zY3JvbGxiYXItY29sb3IpIHZhcigtLXNjcm9sbGJhci1iZy1jb2xvcik7Cn0KCmJvZHkud2FpdDo6YmVmb3JlewogICAgY29udGVudDoiIjsKICAgIHBvc2l0aW9uOmZpeGVkOwogICAgd2lkdGg6MTAwJTsKICAgIGhlaWdodDoxMDAlOwogICAgei1pbmRleDoxMDAwMDA7CiAgICBjdXJzb3I6d2FpdDsKICB9CgouaGlkZGVuLApbaGlkZGVuXXsKICBkaXNwbGF5Om5vbmUgIWltcG9ydGFudDsKfQoKI3ZpZXdlckNvbnRhaW5lci5wZGZQcmVzZW50YXRpb25Nb2RlOmZ1bGxzY3JlZW57CiAgdG9wOjA7CiAgYmFja2dyb3VuZC1jb2xvcjpyZ2IoMCAwIDApOwogIHdpZHRoOjEwMCU7CiAgaGVpZ2h0OjEwMCU7CiAgb3ZlcmZsb3c6aGlkZGVuOwogIGN1cnNvcjpub25lOwogIC13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsKICAgICAtbW96LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgICAgICB1c2VyLXNlbGVjdDpub25lOwp9CgoucGRmUHJlc2VudGF0aW9uTW9kZTpmdWxsc2NyZWVuIHNlY3Rpb246bm90KFtkYXRhLWludGVybmFsLWxpbmtdKXsKICBwb2ludGVyLWV2ZW50czpub25lOwp9CgoucGRmUHJlc2VudGF0aW9uTW9kZTpmdWxsc2NyZWVuIC50ZXh0TGF5ZXIgc3BhbnsKICBjdXJzb3I6bm9uZTsKfQoKLnBkZlByZXNlbnRhdGlvbk1vZGUucGRmUHJlc2VudGF0aW9uTW9kZUNvbnRyb2xzID4gKiwKLnBkZlByZXNlbnRhdGlvbk1vZGUucGRmUHJlc2VudGF0aW9uTW9kZUNvbnRyb2xzIC50ZXh0TGF5ZXIgc3BhbnsKICBjdXJzb3I6ZGVmYXVsdDsKfQoKI291dGVyQ29udGFpbmVyewogIHdpZHRoOjEwMCU7CiAgaGVpZ2h0OjEwMCU7CiAgcG9zaXRpb246cmVsYXRpdmU7CiAgbWFyZ2luOjA7Cn0KCiNzaWRlYmFyQ29udGFpbmVyewogIHBvc2l0aW9uOmFic29sdXRlOwogIGluc2V0LWJsb2NrOnZhcigtLXRvb2xiYXItaGVpZ2h0KSAwOwogIGluc2V0LWlubGluZS1zdGFydDpjYWxjKC0xICogdmFyKC0tc2lkZWJhci13aWR0aCkpOwogIHdpZHRoOnZhcigtLXNpZGViYXItd2lkdGgpOwogIHZpc2liaWxpdHk6aGlkZGVuOwogIHotaW5kZXg6MTsKICBmb250Om1lc3NhZ2UtYm94OwogIGJvcmRlci10b3A6MXB4IHNvbGlkIHRyYW5zcGFyZW50OwogIGJvcmRlci1pbmxpbmUtZW5kOnZhcigtLWRvb3JoYW5nZXItYm9yZGVyLWNvbG9yLXdoY20pOwogIHRyYW5zaXRpb24tcHJvcGVydHk6aW5zZXQtaW5saW5lLXN0YXJ0OwogIHRyYW5zaXRpb24tZHVyYXRpb246dmFyKC0tc2lkZWJhci10cmFuc2l0aW9uLWR1cmF0aW9uKTsKICB0cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvbjp2YXIoLS1zaWRlYmFyLXRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uKTsKfQoKI291dGVyQ29udGFpbmVyOmlzKC5zaWRlYmFyTW92aW5nLCAuc2lkZWJhck9wZW4pICNzaWRlYmFyQ29udGFpbmVyewogIHZpc2liaWxpdHk6dmlzaWJsZTsKfQoKI291dGVyQ29udGFpbmVyLnNpZGViYXJPcGVuICNzaWRlYmFyQ29udGFpbmVyewogIGluc2V0LWlubGluZS1zdGFydDowOwp9CgojbWFpbkNvbnRhaW5lcnsKICBwb3NpdGlvbjphYnNvbHV0ZTsKICBpbnNldDowOwogIG1pbi13aWR0aDozNTBweDsKICBtYXJnaW46MDsKICBkaXNwbGF5OmZsZXg7CiAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwp9Cgojc2lkZWJhckNvbnRlbnR7CiAgaW5zZXQtYmxvY2s6dmFyKC0tdG9vbGJhci1oZWlnaHQpIDA7CiAgaW5zZXQtaW5saW5lLXN0YXJ0OjA7CiAgb3ZlcmZsb3c6YXV0bzsKICBwb3NpdGlvbjphYnNvbHV0ZTsKICB3aWR0aDoxMDAlOwogIGJveC1zaGFkb3c6aW5zZXQgY2FsYygtMXB4ICogdmFyKC0tZGlyLWZhY3RvcikpIDAgMCByZ2IoMCAwIDAgLyAwLjI1KTsKfQoKI3ZpZXdlckNvbnRhaW5lcnsKICBvdmVyZmxvdzphdXRvOwogIHBvc2l0aW9uOmFic29sdXRlOwogIGluc2V0OnZhcigtLXRvb2xiYXItaGVpZ2h0KSAwIDA7CiAgb3V0bGluZTpub25lOwogIHotaW5kZXg6MDsKfQoKI3ZpZXdlckNvbnRhaW5lcjpub3QoLnBkZlByZXNlbnRhdGlvbk1vZGUpewogIHRyYW5zaXRpb24tZHVyYXRpb246dmFyKC0tc2lkZWJhci10cmFuc2l0aW9uLWR1cmF0aW9uKTsKICB0cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvbjp2YXIoLS1zaWRlYmFyLXRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uKTsKfQoKI291dGVyQ29udGFpbmVyLnNpZGViYXJPcGVuICN2aWV3ZXJDb250YWluZXI6bm90KC5wZGZQcmVzZW50YXRpb25Nb2RlKXsKICBpbnNldC1pbmxpbmUtc3RhcnQ6dmFyKC0tc2lkZWJhci13aWR0aCk7CiAgdHJhbnNpdGlvbi1wcm9wZXJ0eTppbnNldC1pbmxpbmUtc3RhcnQ7Cn0KCiNzaWRlYmFyQ29udGFpbmVyIDppcyhpbnB1dCwgYnV0dG9uLCBzZWxlY3QpewogIGZvbnQ6bWVzc2FnZS1ib3g7Cn0KCi50b29sYmFyewogIHotaW5kZXg6MjsKfQoKI3Rvb2xiYXJTaWRlYmFyewogIHdpZHRoOjEwMCU7CiAgaGVpZ2h0OnZhcigtLXRvb2xiYXItaGVpZ2h0KTsKICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXNpZGViYXItdG9vbGJhci1iZy1jb2xvcik7CiAgYm94LXNoYWRvdzp2YXIoLS10b29sYmFyU2lkZWJhci1ib3gtc2hhZG93KTsKICBib3JkZXItYm90dG9tOnZhcigtLXRvb2xiYXJTaWRlYmFyLWJvcmRlci1ib3R0b20pOwogIHBhZGRpbmc6dmFyKC0tdG9vbGJhci12ZXJ0aWNhbC1wYWRkaW5nKSB2YXIoLS10b29sYmFyLWhvcml6b250YWwtcGFkZGluZyk7CiAganVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47Cn0KCiN0b29sYmFyU2lkZWJhciAjdG9vbGJhclNpZGViYXJMZWZ0ewogICAgd2lkdGg6YXV0bzsKICAgIGhlaWdodDoxMDAlOwogIH0KCjppcygjdG9vbGJhclNpZGViYXIgI3Rvb2xiYXJTaWRlYmFyTGVmdCkgI3ZpZXdUaHVtYm5haWw6OmJlZm9yZXsKICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tdmlld1RodW1ibmFpbC1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tdmlld1RodW1ibmFpbC1pY29uKTsKICAgIH0KCjppcygjdG9vbGJhclNpZGViYXIgI3Rvb2xiYXJTaWRlYmFyTGVmdCkgI3ZpZXdPdXRsaW5lOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLXZpZXdPdXRsaW5lLWljb24pOwogICAgICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi12aWV3T3V0bGluZS1pY29uKTsKICAgICAgdHJhbnNmb3JtOnNjYWxlWCh2YXIoLS1kaXItZmFjdG9yKSk7CiAgICB9Cgo6aXMoI3Rvb2xiYXJTaWRlYmFyICN0b29sYmFyU2lkZWJhckxlZnQpICN2aWV3QXR0YWNobWVudHM6OmJlZm9yZXsKICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tdmlld0F0dGFjaG1lbnRzLWljb24pOwogICAgICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi12aWV3QXR0YWNobWVudHMtaWNvbik7CiAgICB9Cgo6aXMoI3Rvb2xiYXJTaWRlYmFyICN0b29sYmFyU2lkZWJhckxlZnQpICN2aWV3TGF5ZXJzOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLXZpZXdMYXllcnMtaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLXZpZXdMYXllcnMtaWNvbik7CiAgICB9CgojdG9vbGJhclNpZGViYXIgI3Rvb2xiYXJTaWRlYmFyUmlnaHR7CiAgICB3aWR0aDphdXRvOwogICAgaGVpZ2h0OjEwMCU7CiAgICBwYWRkaW5nLWlubGluZS1lbmQ6MnB4OwogIH0KCiNzaWRlYmFyUmVzaXplcnsKICBwb3NpdGlvbjphYnNvbHV0ZTsKICBpbnNldC1ibG9jazowOwogIGluc2V0LWlubGluZS1lbmQ6LTZweDsKICB3aWR0aDo2cHg7CiAgei1pbmRleDoyMDA7CiAgY3Vyc29yOmV3LXJlc2l6ZTsKfQoKI291dGVyQ29udGFpbmVyLnNpZGViYXJPcGVuICNsb2FkaW5nQmFyewogIGluc2V0LWlubGluZS1zdGFydDp2YXIoLS1zaWRlYmFyLXdpZHRoKTsKfQoKI291dGVyQ29udGFpbmVyLnNpZGViYXJSZXNpemluZwogIDppcygjc2lkZWJhckNvbnRhaW5lciwgI3ZpZXdlckNvbnRhaW5lciwgI2xvYWRpbmdCYXIpewogIHRyYW5zaXRpb24tZHVyYXRpb246MHM7Cn0KCi5kb29ySGFuZ2VyLAouZG9vckhhbmdlclJpZ2h0ewogIGJvcmRlci1yYWRpdXM6MnB4OwogIGJveC1zaGFkb3c6MCAxcHggNXB4IHZhcigtLWRvb3JoYW5nZXItYm9yZGVyLWNvbG9yKSwgMCAwIDAgMXB4IHZhcigtLWRvb3JoYW5nZXItYm9yZGVyLWNvbG9yKTsKICBib3JkZXI6dmFyKC0tZG9vcmhhbmdlci1ib3JkZXItY29sb3Itd2hjbSk7CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1kb29yaGFuZ2VyLWJnLWNvbG9yKTsKICBpbnNldC1ibG9jay1zdGFydDpjYWxjKDEwMCUgKyB2YXIoLS1kb29yaGFuZ2VyLWhlaWdodCkgLSAycHgpOwp9Cgo6aXMoLmRvb3JIYW5nZXIsLmRvb3JIYW5nZXJSaWdodCk6OmFmdGVyLDppcyguZG9vckhhbmdlciwuZG9vckhhbmdlclJpZ2h0KTo6YmVmb3JlewogICAgYm90dG9tOjEwMCU7CiAgICBib3JkZXItc3R5bGU6c29saWQ7CiAgICBib3JkZXItY29sb3I6dHJhbnNwYXJlbnQ7CiAgICBjb250ZW50OiIiOwogICAgaGVpZ2h0OjA7CiAgICB3aWR0aDowOwogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICBwb2ludGVyLWV2ZW50czpub25lOwogICAgb3BhY2l0eTp2YXIoLS1kb29yaGFuZ2VyLXRyaWFuZ2xlLW9wYWNpdHktd2hjbSk7CiAgfQoKOmlzKC5kb29ySGFuZ2VyLC5kb29ySGFuZ2VyUmlnaHQpOjpiZWZvcmV7CiAgICBib3JkZXItd2lkdGg6Y2FsYyh2YXIoLS1kb29yaGFuZ2VyLWhlaWdodCkgKyAycHgpOwogICAgYm9yZGVyLWJvdHRvbS1jb2xvcjp2YXIoLS1kb29yaGFuZ2VyLWJvcmRlci1jb2xvcik7CiAgfQoKOmlzKC5kb29ySGFuZ2VyLC5kb29ySGFuZ2VyUmlnaHQpOjphZnRlcnsKICAgIGJvcmRlci13aWR0aDp2YXIoLS1kb29yaGFuZ2VyLWhlaWdodCk7CiAgfQoKLmRvb3JIYW5nZXJSaWdodHsKICBpbnNldC1pbmxpbmUtZW5kOmNhbGMoNTAlIC0gdmFyKC0tZG9vcmhhbmdlci1oZWlnaHQpIC0gMXB4KTsKfQoKLmRvb3JIYW5nZXJSaWdodDo6YmVmb3JlewogICAgaW5zZXQtaW5saW5lLWVuZDotMXB4OwogIH0KCi5kb29ySGFuZ2VyUmlnaHQ6OmFmdGVyewogICAgYm9yZGVyLWJvdHRvbS1jb2xvcjp2YXIoLS1kb29yaGFuZ2VyLWJnLWNvbG9yKTsKICAgIGluc2V0LWlubGluZS1lbmQ6MXB4OwogIH0KCi5kb29ySGFuZ2VyewogIGluc2V0LWlubGluZS1zdGFydDpjYWxjKDUwJSAtIHZhcigtLWRvb3JoYW5nZXItaGVpZ2h0KSAtIDFweCk7Cn0KCi5kb29ySGFuZ2VyOjpiZWZvcmV7CiAgICBpbnNldC1pbmxpbmUtc3RhcnQ6LTFweDsKICB9CgouZG9vckhhbmdlcjo6YWZ0ZXJ7CiAgICBib3JkZXItYm90dG9tLWNvbG9yOnZhcigtLXRvb2xiYXItYmctY29sb3IpOwogICAgaW5zZXQtaW5saW5lLXN0YXJ0OjFweDsKICB9CgouZGlhbG9nQnV0dG9uewogIGJvcmRlcjpub25lOwogIGJhY2tncm91bmQ6bm9uZTsKICB3aWR0aDoyOHB4OwogIGhlaWdodDoyOHB4OwogIG91dGxpbmU6bm9uZTsKfQoKLmRpYWxvZ0J1dHRvbjppcyg6aG92ZXIsIDpmb2N1cy12aXNpYmxlKXsKICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWRpYWxvZy1idXR0b24taG92ZXItYmctY29sb3IpOwp9CgouZGlhbG9nQnV0dG9uOmlzKDpob3ZlciwgOmZvY3VzLXZpc2libGUpID4gc3BhbnsKICBjb2xvcjp2YXIoLS1kaWFsb2ctYnV0dG9uLWhvdmVyLWNvbG9yKTsKfQoKLnNwbGl0VG9vbGJhckJ1dHRvblNlcGFyYXRvcnsKICBmbG9hdDp2YXIoLS1pbmxpbmUtc3RhcnQpOwogIHdpZHRoOjA7CiAgaGVpZ2h0OjYyJTsKICBib3JkZXItbGVmdDoxcHggc29saWQgdmFyKC0tc2VwYXJhdG9yLWNvbG9yKTsKICBib3JkZXItcmlnaHQ6bm9uZTsKfQoKLmRpYWxvZ0J1dHRvbnsKICBtaW4td2lkdGg6MTZweDsKICBtYXJnaW46MnB4IDFweDsKICBwYWRkaW5nOjJweCA2cHggMDsKICBib3JkZXI6bm9uZTsKICBib3JkZXItcmFkaXVzOjJweDsKICBjb2xvcjp2YXIoLS1tYWluLWNvbG9yKTsKICBmb250LXNpemU6MTJweDsKICBsaW5lLWhlaWdodDoxNHB4OwogIC13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsKICAgICAtbW96LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgICAgICB1c2VyLXNlbGVjdDpub25lOwogIGN1cnNvcjpkZWZhdWx0OwogIGJveC1zaXppbmc6Ym9yZGVyLWJveDsKfQoKLnRyZWVJdGVtVG9nZ2xlcjo6YmVmb3JlewogIHBvc2l0aW9uOmFic29sdXRlOwogIGRpc3BsYXk6aW5saW5lLWJsb2NrOwogIHdpZHRoOjE2cHg7CiAgaGVpZ2h0OjE2cHg7CgogIGNvbnRlbnQ6IiI7CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b29sYmFyLWljb24tYmctY29sb3IpOwogIC13ZWJraXQtbWFzay1zaXplOmNvdmVyOwogICAgICAgICAgbWFzay1zaXplOmNvdmVyOwp9Cgojc2lkZWJhclRvZ2dsZUJ1dHRvbjo6YmVmb3JlewogIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLXNpZGViYXJUb2dnbGUtaWNvbik7CiAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tc2lkZWJhclRvZ2dsZS1pY29uKTsKICB0cmFuc2Zvcm06c2NhbGVYKHZhcigtLWRpci1mYWN0b3IpKTsKfQoKI3NlY29uZGFyeVRvb2xiYXJUb2dnbGVCdXR0b246OmJlZm9yZXsKICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1zZWNvbmRhcnlUb29sYmFyVG9nZ2xlLWljb24pOwogICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLXNlY29uZGFyeVRvb2xiYXJUb2dnbGUtaWNvbik7CiAgdHJhbnNmb3JtOnNjYWxlWCh2YXIoLS1kaXItZmFjdG9yKSk7Cn0KCiNwcmV2aW91czo6YmVmb3JlewogIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLXBhZ2VVcC1pY29uKTsKICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1wYWdlVXAtaWNvbik7Cn0KCiNuZXh0OjpiZWZvcmV7CiAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tcGFnZURvd24taWNvbik7CiAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tcGFnZURvd24taWNvbik7Cn0KCiN6b29tT3V0QnV0dG9uOjpiZWZvcmV7CiAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tem9vbU91dC1pY29uKTsKICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi16b29tT3V0LWljb24pOwp9Cgojem9vbUluQnV0dG9uOjpiZWZvcmV7CiAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tem9vbUluLWljb24pOwogICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLXpvb21Jbi1pY29uKTsKfQoKI2VkaXRvckZyZWVUZXh0QnV0dG9uOjpiZWZvcmV7CiAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tZWRpdG9yRnJlZVRleHQtaWNvbik7CiAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tZWRpdG9yRnJlZVRleHQtaWNvbik7Cn0KCiNlZGl0b3JIaWdobGlnaHRCdXR0b246OmJlZm9yZXsKICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1lZGl0b3JIaWdobGlnaHQtaWNvbik7CiAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tZWRpdG9ySGlnaGxpZ2h0LWljb24pOwp9CgojZWRpdG9ySW5rQnV0dG9uOjpiZWZvcmV7CiAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tZWRpdG9ySW5rLWljb24pOwogICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLWVkaXRvckluay1pY29uKTsKfQoKI2VkaXRvclN0YW1wQnV0dG9uOjpiZWZvcmV7CiAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tZWRpdG9yU3RhbXAtaWNvbik7CiAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tZWRpdG9yU3RhbXAtaWNvbik7Cn0KCiNlZGl0b3JTaWduYXR1cmVCdXR0b246OmJlZm9yZXsKICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1lZGl0b3JTaWduYXR1cmUtaWNvbik7CiAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tZWRpdG9yU2lnbmF0dXJlLWljb24pOwp9CgojcHJpbnRCdXR0b246OmJlZm9yZXsKICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1wcmludC1pY29uKTsKICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1wcmludC1pY29uKTsKfQoKI2Rvd25sb2FkQnV0dG9uOjpiZWZvcmV7CiAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tZG93bmxvYWQtaWNvbik7CiAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tZG93bmxvYWQtaWNvbik7Cn0KCiNjdXJyZW50T3V0bGluZUl0ZW06OmJlZm9yZXsKICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1jdXJyZW50T3V0bGluZUl0ZW0taWNvbik7CiAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tY3VycmVudE91dGxpbmVJdGVtLWljb24pOwogIHRyYW5zZm9ybTpzY2FsZVgodmFyKC0tZGlyLWZhY3RvcikpOwp9Cgojdmlld0ZpbmRCdXR0b246OmJlZm9yZXsKICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1zZWFyY2gtaWNvbik7CiAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tc2VhcmNoLWljb24pOwp9CgoucGRmU2lkZWJhck5vdGlmaWNhdGlvbjo6YWZ0ZXJ7CiAgcG9zaXRpb246YWJzb2x1dGU7CiAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgdG9wOjJweDsKICBpbnNldC1pbmxpbmUtZW5kOjJweDsKICBjb250ZW50OiIiOwogIGJhY2tncm91bmQtY29sb3I6cmdiKDExMiAyMTkgODUpOwogIGhlaWdodDo5cHg7CiAgd2lkdGg6OXB4OwogIGJvcmRlci1yYWRpdXM6NTAlOwp9CgoudmVydGljYWxUb29sYmFyU2VwYXJhdG9yewogIGRpc3BsYXk6YmxvY2s7CiAgbWFyZ2luLWlubGluZToycHg7CiAgd2lkdGg6MDsKICBoZWlnaHQ6ODAlOwogIGJvcmRlci1sZWZ0OjFweCBzb2xpZCB2YXIoLS1zZXBhcmF0b3ItY29sb3IpOwogIGJvcmRlci1yaWdodDpub25lOwogIGJveC1zaXppbmc6Ym9yZGVyLWJveDsKfQoKLmhvcml6b250YWxUb29sYmFyU2VwYXJhdG9yewogIGRpc3BsYXk6YmxvY2s7CiAgbWFyZ2luOjZweCAwOwogIGJvcmRlci10b3A6MXB4IHNvbGlkIHZhcigtLWRvb3JoYW5nZXItc2VwYXJhdG9yLWNvbG9yKTsKICBib3JkZXItYm90dG9tOm5vbmU7CiAgaGVpZ2h0OjA7CiAgd2lkdGg6MTAwJTsKfQoKLnRvZ2dsZUJ1dHRvbnsKICBkaXNwbGF5OmlubGluZTsKfQoKLnRvZ2dsZUJ1dHRvbjpoYXMoID4gaW5wdXQ6Y2hlY2tlZCl7CiAgICBjb2xvcjp2YXIoLS10b2dnbGVkLWJ0bi1jb2xvcik7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRvZ2dsZWQtYnRuLWJnLWNvbG9yKTsKICB9CgoudG9nZ2xlQnV0dG9uOmlzKDpob3Zlciw6aGFzKCA+IGlucHV0OmZvY3VzLXZpc2libGUpKXsKICAgIGNvbG9yOnZhcigtLXRvZ2dsZWQtYnRuLWNvbG9yKTsKICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tYnV0dG9uLWhvdmVyLWNvbG9yKTsKICB9CgoudG9nZ2xlQnV0dG9uID4gaW5wdXR7CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIHRvcDo1MCU7CiAgICBsZWZ0OjUwJTsKICAgIG9wYWNpdHk6MDsKICAgIHdpZHRoOjA7CiAgICBoZWlnaHQ6MDsKICB9CgoudG9vbGJhckZpZWxkewogIHBhZGRpbmc6NHB4IDdweDsKICBtYXJnaW46M3B4IDA7CiAgYm9yZGVyLXJhZGl1czoycHg7CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1maWVsZC1iZy1jb2xvcik7CiAgYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94OwogIGJvcmRlcjoxcHggc29saWQgdmFyKC0tZmllbGQtYm9yZGVyLWNvbG9yKTsKICBib3gtc2hhZG93Om5vbmU7CiAgY29sb3I6dmFyKC0tZmllbGQtY29sb3IpOwogIGZvbnQtc2l6ZToxMnB4OwogIGxpbmUtaGVpZ2h0OjE2cHg7CiAgb3V0bGluZTpub25lOwp9CgoudG9vbGJhckZpZWxkOmZvY3VzewogICAgYm9yZGVyLWNvbG9yOiMwYTg0ZmY7CiAgfQoKI3BhZ2VOdW1iZXJ7CiAgLW1vei1hcHBlYXJhbmNlOnRleHRmaWVsZDsKICB0ZXh0LWFsaWduOmVuZDsKICB3aWR0aDo0MHB4OwogIGJhY2tncm91bmQtc2l6ZTowIDA7CiAgdHJhbnNpdGlvbi1wcm9wZXJ0eTpub25lOwp9CgojcGFnZU51bWJlcjo6LXdlYmtpdC1pbm5lci1zcGluLWJ1dHRvbnsKICAgIC13ZWJraXQtYXBwZWFyYW5jZTpub25lOwogIH0KCi5sb2FkaW5nSW5wdXQ6aGFzKCA+IC5sb2FkaW5nOmlzKCNwYWdlTnVtYmVyKSk6OmFmdGVyewogICAgZGlzcGxheTppbmxpbmU7CiAgICB2aXNpYmlsaXR5OnZpc2libGU7CgogICAgdHJhbnNpdGlvbi1wcm9wZXJ0eTp2aXNpYmlsaXR5OwogICAgdHJhbnNpdGlvbi1kZWxheTp2YXIoLS1sb2FkaW5nLWljb24tZGVsYXkpOwogIH0KCi5sb2FkaW5nSW5wdXR7CiAgcG9zaXRpb246cmVsYXRpdmU7Cn0KCi5sb2FkaW5nSW5wdXQ6OmFmdGVyewogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICB2aXNpYmlsaXR5OmhpZGRlbjsKICAgIGRpc3BsYXk6bm9uZTsKICAgIHdpZHRoOnZhcigtLWljb24tc2l6ZSk7CiAgICBoZWlnaHQ6dmFyKC0taWNvbi1zaXplKTsKCiAgICBjb250ZW50OiIiOwogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b29sYmFyLWljb24tYmctY29sb3IpOwogICAgLXdlYmtpdC1tYXNrLXNpemU6Y292ZXI7CiAgICAgICAgICAgIG1hc2stc2l6ZTpjb3ZlcjsKICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1sb2FkaW5nLWljb24pOwogICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLWxvYWRpbmctaWNvbik7CiAgfQoKLmxvYWRpbmdJbnB1dC5zdGFydDo6YWZ0ZXJ7CiAgICBpbnNldC1pbmxpbmUtc3RhcnQ6NHB4OwogIH0KCi5sb2FkaW5nSW5wdXQuZW5kOjphZnRlcnsKICAgIGluc2V0LWlubGluZS1lbmQ6NHB4OwogIH0KCiN0aHVtYm5haWxWaWV3LAojb3V0bGluZVZpZXcsCiNhdHRhY2htZW50c1ZpZXcsCiNsYXllcnNWaWV3ewogIHBvc2l0aW9uOmFic29sdXRlOwogIHdpZHRoOmNhbGMoMTAwJSAtIDhweCk7CiAgaW5zZXQtYmxvY2s6MDsKICBwYWRkaW5nOjRweCA0cHggMDsKICBvdmVyZmxvdzphdXRvOwogIC13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsKICAgICAtbW96LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgICAgICB1c2VyLXNlbGVjdDpub25lOwp9CgojdGh1bWJuYWlsVmlld3sKICB3aWR0aDpjYWxjKDEwMCUgLSA2MHB4KTsKICBwYWRkaW5nOjEwcHggMzBweCAwOwp9CgojdGh1bWJuYWlsVmlldyA+IGE6aXMoOmFjdGl2ZSwgOmZvY3VzKXsKICBvdXRsaW5lOjA7Cn0KCi50aHVtYm5haWx7CiAgLS10aHVtYm5haWwtd2lkdGg6MDsKICAtLXRodW1ibmFpbC1oZWlnaHQ6MDsKCiAgZmxvYXQ6dmFyKC0taW5saW5lLXN0YXJ0KTsKICB3aWR0aDp2YXIoLS10aHVtYm5haWwtd2lkdGgpOwogIGhlaWdodDp2YXIoLS10aHVtYm5haWwtaGVpZ2h0KTsKICBtYXJnaW46MCAxMHB4IDVweDsKICBwYWRkaW5nOjFweDsKICBib3JkZXI6N3B4IHNvbGlkIHRyYW5zcGFyZW50OwogIGJvcmRlci1yYWRpdXM6MnB4Owp9CgojdGh1bWJuYWlsVmlldyA+IGE6bGFzdC1vZi10eXBlID4gLnRodW1ibmFpbHsKICBtYXJnaW4tYm90dG9tOjEwcHg7Cn0KCmE6Zm9jdXMgPiAudGh1bWJuYWlsLAoudGh1bWJuYWlsOmhvdmVyewogIGJvcmRlci1jb2xvcjp2YXIoLS10aHVtYm5haWwtaG92ZXItY29sb3IpOwp9CgoudGh1bWJuYWlsLnNlbGVjdGVkewogIGJvcmRlci1jb2xvcjp2YXIoLS10aHVtYm5haWwtc2VsZWN0ZWQtY29sb3IpICFpbXBvcnRhbnQ7Cn0KCi50aHVtYm5haWxJbWFnZXsKICB3aWR0aDp2YXIoLS10aHVtYm5haWwtd2lkdGgpOwogIGhlaWdodDp2YXIoLS10aHVtYm5haWwtaGVpZ2h0KTsKICBvcGFjaXR5OjAuOTsKfQoKYTpmb2N1cyA+IC50aHVtYm5haWwgPiAudGh1bWJuYWlsSW1hZ2UsCi50aHVtYm5haWw6aG92ZXIgPiAudGh1bWJuYWlsSW1hZ2V7CiAgb3BhY2l0eTowLjk1Owp9CgoudGh1bWJuYWlsLnNlbGVjdGVkID4gLnRodW1ibmFpbEltYWdlewogIG9wYWNpdHk6MSAhaW1wb3J0YW50Owp9CgoudGh1bWJuYWlsOm5vdChbZGF0YS1sb2FkZWRdKSA+IC50aHVtYm5haWxJbWFnZXsKICB3aWR0aDpjYWxjKHZhcigtLXRodW1ibmFpbC13aWR0aCkgLSAycHgpOwogIGhlaWdodDpjYWxjKHZhcigtLXRodW1ibmFpbC1oZWlnaHQpIC0gMnB4KTsKICBib3JkZXI6MXB4IGRhc2hlZCByZ2IoMTMyIDEzMiAxMzIpOwp9CgoudHJlZVdpdGhEZWVwTmVzdGluZyA+IC50cmVlSXRlbSwKLnRyZWVJdGVtID4gLnRyZWVJdGVtc3sKICBtYXJnaW4taW5saW5lLXN0YXJ0OjIwcHg7Cn0KCi50cmVlSXRlbSA+IGF7CiAgdGV4dC1kZWNvcmF0aW9uOm5vbmU7CiAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgbWluLXdpZHRoOmNhbGMoMTAwJSAtIDRweCk7CiAgaGVpZ2h0OmF1dG87CiAgbWFyZ2luLWJvdHRvbToxcHg7CiAgcGFkZGluZzoycHggMCA1cHg7CiAgcGFkZGluZy1pbmxpbmUtc3RhcnQ6NHB4OwogIGJvcmRlci1yYWRpdXM6MnB4OwogIGNvbG9yOnZhcigtLXRyZWVpdGVtLWNvbG9yKTsKICBmb250LXNpemU6MTNweDsKICBsaW5lLWhlaWdodDoxNXB4OwogIC13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsKICAgICAtbW96LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgICAgICB1c2VyLXNlbGVjdDpub25lOwogIHdoaXRlLXNwYWNlOm5vcm1hbDsKICBjdXJzb3I6cG9pbnRlcjsKfQoKI2xheWVyc1ZpZXcgLnRyZWVJdGVtID4gYSAqewogIGN1cnNvcjpwb2ludGVyOwp9CgojbGF5ZXJzVmlldyAudHJlZUl0ZW0gPiBhID4gbGFiZWx7CiAgcGFkZGluZy1pbmxpbmUtc3RhcnQ6NHB4Owp9CgojbGF5ZXJzVmlldyAudHJlZUl0ZW0gPiBhID4gbGFiZWwgPiBpbnB1dHsKICBmbG9hdDp2YXIoLS1pbmxpbmUtc3RhcnQpOwogIG1hcmdpbi10b3A6MXB4Owp9CgoudHJlZUl0ZW1Ub2dnbGVyewogIHBvc2l0aW9uOnJlbGF0aXZlOwogIGZsb2F0OnZhcigtLWlubGluZS1zdGFydCk7CiAgaGVpZ2h0OjA7CiAgd2lkdGg6MDsKICBjb2xvcjpyZ2IoMjU1IDI1NSAyNTUgLyAwLjUpOwp9CgoudHJlZUl0ZW1Ub2dnbGVyOjpiZWZvcmV7CiAgaW5zZXQtaW5saW5lLWVuZDo0cHg7CiAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRyZWVpdGVtLWV4cGFuZGVkLWljb24pOwogICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS10cmVlaXRlbS1leHBhbmRlZC1pY29uKTsKfQoKLnRyZWVJdGVtVG9nZ2xlci50cmVlSXRlbXNIaWRkZW46OmJlZm9yZXsKICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdHJlZWl0ZW0tY29sbGFwc2VkLWljb24pOwogICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS10cmVlaXRlbS1jb2xsYXBzZWQtaWNvbik7CiAgdHJhbnNmb3JtOnNjYWxlWCh2YXIoLS1kaXItZmFjdG9yKSk7Cn0KCi50cmVlSXRlbVRvZ2dsZXIudHJlZUl0ZW1zSGlkZGVuIH4gLnRyZWVJdGVtc3sKICBkaXNwbGF5Om5vbmU7Cn0KCi50cmVlSXRlbS5zZWxlY3RlZCA+IGF7CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10cmVlaXRlbS1zZWxlY3RlZC1iZy1jb2xvcik7CiAgY29sb3I6dmFyKC0tdHJlZWl0ZW0tc2VsZWN0ZWQtY29sb3IpOwp9CgoudHJlZUl0ZW1Ub2dnbGVyOmhvdmVyLAoudHJlZUl0ZW1Ub2dnbGVyOmhvdmVyICsgYSwKLnRyZWVJdGVtVG9nZ2xlcjpob3ZlciB+IC50cmVlSXRlbXMsCi50cmVlSXRlbSA+IGE6aG92ZXJ7CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10cmVlaXRlbS1iZy1jb2xvcik7CiAgYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94OwogIGJvcmRlci1yYWRpdXM6MnB4OwogIGNvbG9yOnZhcigtLXRyZWVpdGVtLWhvdmVyLWNvbG9yKTsKfQoKI291dGxpbmVPcHRpb25zQ29udGFpbmVyewogIGRpc3BsYXk6bm9uZTsKfQoKI3NpZGViYXJDb250YWluZXI6aGFzKCNvdXRsaW5lVmlldzpub3QoLmhpZGRlbikpICNvdXRsaW5lT3B0aW9uc0NvbnRhaW5lcnsKICAgIGRpc3BsYXk6aW5saW5lIGZsZXg7CiAgfQoKLmRpYWxvZ0J1dHRvbnsKICB3aWR0aDphdXRvOwogIG1hcmdpbjozcHggNHB4IDJweCAhaW1wb3J0YW50OwogIHBhZGRpbmc6MnB4IDExcHg7CiAgY29sb3I6dmFyKC0tbWFpbi1jb2xvcik7CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1kaWFsb2ctYnV0dG9uLWJnLWNvbG9yKTsKICBib3JkZXI6dmFyKC0tZGlhbG9nLWJ1dHRvbi1ib3JkZXIpICFpbXBvcnRhbnQ7Cn0KCmRpYWxvZ3sKICBtYXJnaW46YXV0bzsKICBwYWRkaW5nOjE1cHg7CiAgYm9yZGVyLXNwYWNpbmc6NHB4OwogIGNvbG9yOnZhcigtLW1haW4tY29sb3IpOwogIGZvbnQ6bWVzc2FnZS1ib3g7CiAgZm9udC1zaXplOjEycHg7CiAgbGluZS1oZWlnaHQ6MTRweDsKICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWRvb3JoYW5nZXItYmctY29sb3IpOwogIGJvcmRlcjoxcHggc29saWQgcmdiKDAgMCAwIC8gMC41KTsKICBib3JkZXItcmFkaXVzOjRweDsKICBib3gtc2hhZG93OjAgMXB4IDRweCByZ2IoMCAwIDAgLyAwLjMpOwp9CgpkaWFsb2c6OmJhY2tkcm9wewogIGJhY2tncm91bmQtY29sb3I6cmdiKDAgMCAwIC8gMC4yKTsKfQoKZGlhbG9nID4gLnJvd3sKICBkaXNwbGF5OnRhYmxlLXJvdzsKfQoKZGlhbG9nID4gLnJvdyA+ICp7CiAgZGlzcGxheTp0YWJsZS1jZWxsOwp9CgpkaWFsb2cgLnRvb2xiYXJGaWVsZHsKICBtYXJnaW46NXB4IDA7Cn0KCmRpYWxvZyAuc2VwYXJhdG9yewogIGRpc3BsYXk6YmxvY2s7CiAgbWFyZ2luOjRweCAwOwogIGhlaWdodDowOwogIHdpZHRoOjEwMCU7CiAgYm9yZGVyLXRvcDoxcHggc29saWQgdmFyKC0tc2VwYXJhdG9yLWNvbG9yKTsKICBib3JkZXItYm90dG9tOm5vbmU7Cn0KCmRpYWxvZyAuYnV0dG9uUm93ewogIHRleHQtYWxpZ246Y2VudGVyOwogIHZlcnRpY2FsLWFsaWduOm1pZGRsZTsKfQoKZGlhbG9nIDpsaW5rewogIGNvbG9yOnJnYigyNTUgMjU1IDI1NSk7Cn0KCiNwYXNzd29yZERpYWxvZ3sKICB0ZXh0LWFsaWduOmNlbnRlcjsKfQoKI3Bhc3N3b3JkRGlhbG9nIC50b29sYmFyRmllbGR7CiAgd2lkdGg6MjAwcHg7Cn0KCiNkb2N1bWVudFByb3BlcnRpZXNEaWFsb2d7CiAgdGV4dC1hbGlnbjpsZWZ0Owp9CgojZG9jdW1lbnRQcm9wZXJ0aWVzRGlhbG9nIC5yb3cgPiAqewogIG1pbi13aWR0aDoxMDBweDsKICB0ZXh0LWFsaWduOnN0YXJ0Owp9CgojZG9jdW1lbnRQcm9wZXJ0aWVzRGlhbG9nIC5yb3cgPiBzcGFuewogIHdpZHRoOjEyNXB4OwogIHdvcmQtd3JhcDpicmVhay13b3JkOwp9CgojZG9jdW1lbnRQcm9wZXJ0aWVzRGlhbG9nIC5yb3cgPiBwewogIG1heC13aWR0aDoyMjVweDsKICB3b3JkLXdyYXA6YnJlYWstd29yZDsKfQoKI2RvY3VtZW50UHJvcGVydGllc0RpYWxvZyAuYnV0dG9uUm93ewogIG1hcmdpbi10b3A6MTBweDsKfQoKLmdyYWItdG8tcGFuLWdyYWJ7CiAgY3Vyc29yOmdyYWIgIWltcG9ydGFudDsKfQoKLmdyYWItdG8tcGFuLWdyYWIKICAqOm5vdChpbnB1dCk6bm90KHRleHRhcmVhKTpub3QoYnV0dG9uKTpub3Qoc2VsZWN0KTpub3QoOmxpbmspewogIGN1cnNvcjppbmhlcml0ICFpbXBvcnRhbnQ7Cn0KCi5ncmFiLXRvLXBhbi1ncmFiOmFjdGl2ZSwKLmdyYWItdG8tcGFuLWdyYWJiaW5newogIGN1cnNvcjpncmFiYmluZyAhaW1wb3J0YW50Owp9CgouZ3JhYi10by1wYW4tZ3JhYmJpbmd7CiAgcG9zaXRpb246Zml4ZWQ7CiAgYmFja2dyb3VuZDpyZ2IoMCAwIDAgLyAwKTsKICBkaXNwbGF5OmJsb2NrOwogIGluc2V0OjA7CiAgb3ZlcmZsb3c6aGlkZGVuOwogIHotaW5kZXg6NTAwMDA7Cn0KCi50b29sYmFyQnV0dG9uewogIGhlaWdodDoxMDAlOwogIGFzcGVjdC1yYXRpbzoxOwogIGRpc3BsYXk6ZmxleDsKICBhbGlnbi1pdGVtczpjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICBiYWNrZ3JvdW5kOm5vbmU7CiAgYm9yZGVyOm5vbmU7CiAgY29sb3I6dmFyKC0tbWFpbi1jb2xvcik7CiAgb3V0bGluZTpub25lOwogIGJvcmRlci1yYWRpdXM6MnB4OwogIGJveC1zaXppbmc6Ym9yZGVyLWJveDsKICBmb250Om1lc3NhZ2UtYm94OwogIGZsZXg6bm9uZTsKICBwb3NpdGlvbjpyZWxhdGl2ZTsKICBwYWRkaW5nOjA7Cn0KCi50b29sYmFyQnV0dG9uICA+IHNwYW57CiAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICAgIHdpZHRoOjA7CiAgICBoZWlnaHQ6MDsKICAgIG92ZXJmbG93OmhpZGRlbjsKICB9CgoudG9vbGJhckJ1dHRvbjo6YmVmb3JlewogICAgb3BhY2l0eTp2YXIoLS10b29sYmFyLWljb24tb3BhY2l0eSk7CiAgICBkaXNwbGF5OmlubGluZS1ibG9jazsKICAgIHdpZHRoOnZhcigtLWljb24tc2l6ZSk7CiAgICBoZWlnaHQ6dmFyKC0taWNvbi1zaXplKTsKICAgIGNvbnRlbnQ6IiI7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRvb2xiYXItaWNvbi1iZy1jb2xvcik7CiAgICAtd2Via2l0LW1hc2stc2l6ZTpjb3ZlcjsKICAgICAgICAgICAgbWFzay1zaXplOmNvdmVyOwogICAgLXdlYmtpdC1tYXNrLXBvc2l0aW9uOmNlbnRlcjsKICAgICAgICAgICAgbWFzay1wb3NpdGlvbjpjZW50ZXI7CiAgfQoKLnRvb2xiYXJCdXR0b24udG9nZ2xlZHsKICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tdG9nZ2xlZC1idG4tYmctY29sb3IpOwogICAgY29sb3I6dmFyKC0tdG9nZ2xlZC1idG4tY29sb3IpOwogIH0KCi50b29sYmFyQnV0dG9uLnRvZ2dsZWQ6OmJlZm9yZXsKICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b2dnbGVkLWJ0bi1jb2xvcik7CiAgICB9CgoudG9vbGJhckJ1dHRvbi50b2dnbGVkOmhvdmVyewogICAgICBvdXRsaW5lOnZhcigtLXRvZ2dsZWQtaG92ZXItYnRuLW91dGxpbmUpICFpbXBvcnRhbnQ7CiAgICB9CgoudG9vbGJhckJ1dHRvbi50b2dnbGVkOmhvdmVyOmFjdGl2ZXsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRvZ2dsZWQtaG92ZXItYWN0aXZlLWJ0bi1jb2xvcik7CiAgICAgIH0KCi50b29sYmFyQnV0dG9uOmlzKDpob3Zlciw6Zm9jdXMtdmlzaWJsZSl7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWJ1dHRvbi1ob3Zlci1jb2xvcik7CiAgfQoKLnRvb2xiYXJCdXR0b246aXMoOmhvdmVyLDpmb2N1cy12aXNpYmxlKTo6YmVmb3JlewogICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXRvb2xiYXItaWNvbi1ob3Zlci1iZy1jb2xvcik7CiAgICB9CgoudG9vbGJhckJ1dHRvbjppcyhbZGlzYWJsZWQ9ImRpc2FibGVkIl0sW2Rpc2FibGVkXSl7CiAgICBvcGFjaXR5OjAuNTsKICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgfQoKLnRvb2xiYXJCdXR0b24ubGFiZWxlZHsKICAgIHdpZHRoOjEwMCU7CiAgICBtaW4taGVpZ2h0OnZhcigtLW1lbnVpdGVtLWhlaWdodCk7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1zdGFydDsKICAgIGdhcDo4cHg7CiAgICBwYWRkaW5nLWlubGluZS1zdGFydDoxMnB4OwogICAgYXNwZWN0LXJhdGlvOnVuc2V0OwogICAgdGV4dC1hbGlnbjpzdGFydDsKICAgIHdoaXRlLXNwYWNlOm5vcm1hbDsKICAgIGN1cnNvcjpkZWZhdWx0OwogIH0KCi50b29sYmFyQnV0dG9uLmxhYmVsZWQ6aXMoYSl7CiAgICAgIHRleHQtZGVjb3JhdGlvbjpub25lOwogICAgfQoKLnRvb2xiYXJCdXR0b24ubGFiZWxlZFtocmVmPSIjIl06aXMoYSl7CiAgICAgICAgb3BhY2l0eTowLjU7CiAgICAgICAgcG9pbnRlci1ldmVudHM6bm9uZTsKICAgICAgfQoKLnRvb2xiYXJCdXR0b24ubGFiZWxlZDo6YmVmb3JlewogICAgICBvcGFjaXR5OnZhcigtLWRvb3JoYW5nZXItaWNvbi1vcGFjaXR5KTsKICAgIH0KCi50b29sYmFyQnV0dG9uLmxhYmVsZWQ6aXMoOmhvdmVyLDpmb2N1cy12aXNpYmxlKXsKICAgICAgY29sb3I6dmFyKC0tZG9vcmhhbmdlci1ob3Zlci1jb2xvcik7CiAgICB9CgoudG9vbGJhckJ1dHRvbi5sYWJlbGVkICA+IHNwYW57CiAgICAgIGRpc3BsYXk6aW5saW5lLWJsb2NrOwogICAgICB3aWR0aDotbW96LW1heC1jb250ZW50OwogICAgICB3aWR0aDptYXgtY29udGVudDsKICAgICAgaGVpZ2h0OmF1dG87CiAgICB9CgoudG9vbGJhckJ1dHRvbldpdGhDb250YWluZXJ7CiAgaGVpZ2h0OjEwMCU7CiAgYXNwZWN0LXJhdGlvOjE7CiAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgcG9zaXRpb246cmVsYXRpdmU7CiAgZmxleDpub25lOwp9CgoudG9vbGJhckJ1dHRvbldpdGhDb250YWluZXIgID4gLnRvb2xiYXJCdXR0b257CiAgICB3aWR0aDoxMDAlOwogICAgaGVpZ2h0OjEwMCU7CiAgfQoKLnRvb2xiYXJCdXR0b25XaXRoQ29udGFpbmVyIC5tZW51ewogICAgcGFkZGluZy1ibG9jazo1cHg7CiAgfQoKLnRvb2xiYXJCdXR0b25XaXRoQ29udGFpbmVyIC5tZW51Q29udGFpbmVyewogICAgd2lkdGg6MTAwJTsKICAgIGhlaWdodDphdXRvOwogICAgbWF4LWhlaWdodDpjYWxjKAogICAgICB2YXIoLS12aWV3ZXItY29udGFpbmVyLWhlaWdodCkgLSB2YXIoLS10b29sYmFyLWhlaWdodCkgLQogICAgICAgIHZhcigtLWRvb3JoYW5nZXItaGVpZ2h0KQogICAgKTsKICAgIGRpc3BsYXk6ZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgIGJveC1zaXppbmc6Ym9yZGVyLWJveDsKICAgIG92ZXJmbG93LXk6YXV0bzsKICB9CgoudG9vbGJhckJ1dHRvbldpdGhDb250YWluZXIgLmVkaXRvclBhcmFtc1Rvb2xiYXJ7CiAgICBoZWlnaHQ6YXV0bzsKICAgIHdpZHRoOjIyMHB4OwogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICB6LWluZGV4OjMwMDAwOwogICAgY3Vyc29yOmRlZmF1bHQ7CiAgfQoKOmlzKC50b29sYmFyQnV0dG9uV2l0aENvbnRhaW5lciAuZWRpdG9yUGFyYW1zVG9vbGJhcikgOmlzKCNlZGl0b3JTdGFtcEFkZEltYWdlLCNlZGl0b3JTaWduYXR1cmVBZGRTaWduYXR1cmUpOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1lZGl0b3JQYXJhbXMtc3RhbXBBZGRJbWFnZS1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLWVkaXRvclBhcmFtcy1zdGFtcEFkZEltYWdlLWljb24pOwogICAgfQoKOmlzKC50b29sYmFyQnV0dG9uV2l0aENvbnRhaW5lciAuZWRpdG9yUGFyYW1zVG9vbGJhcikgLmVkaXRvclBhcmFtc0xhYmVsewogICAgICBmbGV4Om5vbmU7CiAgICAgIGZvbnQ6bWVudTsKICAgICAgZm9udC1zaXplOjEzcHg7CiAgICAgIGZvbnQtc3R5bGU6bm9ybWFsOwogICAgICBmb250LXdlaWdodDo0MDA7CiAgICAgIGxpbmUtaGVpZ2h0OjE1MCU7CiAgICAgIHdpZHRoOi1tb3otZml0LWNvbnRlbnQ7CiAgICAgIHdpZHRoOmZpdC1jb250ZW50OwogICAgICBpbnNldC1pbmxpbmUtc3RhcnQ6MDsKICAgICAgY29sb3I6dmFyKC0tbWFpbi1jb2xvcik7CiAgICB9Cgo6aXMoLnRvb2xiYXJCdXR0b25XaXRoQ29udGFpbmVyIC5lZGl0b3JQYXJhbXNUb29sYmFyKSBidXR0b246aXMoOmhvdmVyLDpmb2N1cy12aXNpYmxlKSAuZWRpdG9yUGFyYW1zTGFiZWx7CiAgICAgIGNvbG9yOnZhcigtLWRvb3JoYW5nZXItaG92ZXItY29sb3IpOwogICAgfQoKOmlzKC50b29sYmFyQnV0dG9uV2l0aENvbnRhaW5lciAuZWRpdG9yUGFyYW1zVG9vbGJhcikgLmVkaXRvclBhcmFtc1Rvb2xiYXJDb250YWluZXJ7CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGhlaWdodDphdXRvOwogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICAgICAgYm94LXNpemluZzpib3JkZXItYm94OwogICAgICBwYWRkaW5nLWlubGluZToxMHB4OwogICAgICBwYWRkaW5nLWJsb2NrOjEwcHg7CiAgICB9Cgo6aXMoOmlzKC50b29sYmFyQnV0dG9uV2l0aENvbnRhaW5lciAuZWRpdG9yUGFyYW1zVG9vbGJhcikgLmVkaXRvclBhcmFtc1Rvb2xiYXJDb250YWluZXIpICA+IC5lZGl0b3JQYXJhbXNTZXR0ZXJ7CiAgICAgICAgbWluLWhlaWdodDoyNnB4OwogICAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgICAganVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47CiAgICAgIH0KCjppcyg6aXMoLnRvb2xiYXJCdXR0b25XaXRoQ29udGFpbmVyIC5lZGl0b3JQYXJhbXNUb29sYmFyKSAuZWRpdG9yUGFyYW1zVG9vbGJhckNvbnRhaW5lcikgLmVkaXRvclBhcmFtc0NvbG9yewogICAgICAgIHdpZHRoOjMycHg7CiAgICAgICAgaGVpZ2h0OjMycHg7CiAgICAgICAgZmxleDpub25lOwogICAgICAgIHBhZGRpbmc6MDsKICAgICAgfQoKOmlzKDppcygudG9vbGJhckJ1dHRvbldpdGhDb250YWluZXIgLmVkaXRvclBhcmFtc1Rvb2xiYXIpIC5lZGl0b3JQYXJhbXNUb29sYmFyQ29udGFpbmVyKSAuZWRpdG9yUGFyYW1zU2xpZGVyewogICAgICAgIGJhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7CiAgICAgICAgd2lkdGg6OTBweDsKICAgICAgICBmbGV4OjAgMSAwOwogICAgICAgIGZvbnQ6bWVzc2FnZS1ib3g7CiAgICAgIH0KCjppcyg6aXMoOmlzKC50b29sYmFyQnV0dG9uV2l0aENvbnRhaW5lciAuZWRpdG9yUGFyYW1zVG9vbGJhcikgLmVkaXRvclBhcmFtc1Rvb2xiYXJDb250YWluZXIpIC5lZGl0b3JQYXJhbXNTbGlkZXIpOjotbW96LXJhbmdlLXByb2dyZXNzewogICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjpibGFjazsKICAgICAgICB9Cgo6aXMoOmlzKDppcygudG9vbGJhckJ1dHRvbldpdGhDb250YWluZXIgLmVkaXRvclBhcmFtc1Rvb2xiYXIpIC5lZGl0b3JQYXJhbXNUb29sYmFyQ29udGFpbmVyKSAuZWRpdG9yUGFyYW1zU2xpZGVyKTo6LXdlYmtpdC1zbGlkZXItcnVubmFibGUtdHJhY2ssOmlzKDppcyg6aXMoLnRvb2xiYXJCdXR0b25XaXRoQ29udGFpbmVyIC5lZGl0b3JQYXJhbXNUb29sYmFyKSAuZWRpdG9yUGFyYW1zVG9vbGJhckNvbnRhaW5lcikgLmVkaXRvclBhcmFtc1NsaWRlcik6Oi1tb3otcmFuZ2UtdHJhY2t7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrOwogICAgICAgIH0KCjppcyg6aXMoOmlzKC50b29sYmFyQnV0dG9uV2l0aENvbnRhaW5lciAuZWRpdG9yUGFyYW1zVG9vbGJhcikgLmVkaXRvclBhcmFtc1Rvb2xiYXJDb250YWluZXIpIC5lZGl0b3JQYXJhbXNTbGlkZXIpOjotd2Via2l0LXNsaWRlci10aHVtYiw6aXMoOmlzKDppcygudG9vbGJhckJ1dHRvbldpdGhDb250YWluZXIgLmVkaXRvclBhcmFtc1Rvb2xiYXIpIC5lZGl0b3JQYXJhbXNUb29sYmFyQ29udGFpbmVyKSAuZWRpdG9yUGFyYW1zU2xpZGVyKTo6LW1vei1yYW5nZS10aHVtYnsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6d2hpdGU7CiAgICAgICAgfQoKI3NlY29uZGFyeVRvb2xiYXJ7CiAgaGVpZ2h0OmF1dG87CiAgd2lkdGg6MjIwcHg7CiAgcG9zaXRpb246YWJzb2x1dGU7CiAgei1pbmRleDozMDAwMDsKICBjdXJzb3I6ZGVmYXVsdDsKICBtaW4taGVpZ2h0OjI2cHg7CiAgbWF4LWhlaWdodDpjYWxjKHZhcigtLXZpZXdlci1jb250YWluZXItaGVpZ2h0KSAtIDQwcHgpOwp9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNzZWNvbmRhcnlPcGVuRmlsZTo6YmVmb3JlewogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1vcGVuRmlsZS1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tb3BlbkZpbGUtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNzZWNvbmRhcnlQcmludDo6YmVmb3JlewogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1wcmludC1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tcHJpbnQtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNzZWNvbmRhcnlEb3dubG9hZDo6YmVmb3JlewogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1kb3dubG9hZC1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tZG93bmxvYWQtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNwcmVzZW50YXRpb25Nb2RlOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLXByZXNlbnRhdGlvbk1vZGUtaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLXByZXNlbnRhdGlvbk1vZGUtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICN2aWV3Qm9va21hcms6OmJlZm9yZXsKICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXRvb2xiYXJCdXR0b24tYm9va21hcmstaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS10b29sYmFyQnV0dG9uLWJvb2ttYXJrLWljb24pOwogICAgfQoKOmlzKCNzZWNvbmRhcnlUb29sYmFyICNzZWNvbmRhcnlUb29sYmFyQnV0dG9uQ29udGFpbmVyKSAjZmlyc3RQYWdlOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLWZpcnN0UGFnZS1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24tZmlyc3RQYWdlLWljb24pOwogICAgfQoKOmlzKCNzZWNvbmRhcnlUb29sYmFyICNzZWNvbmRhcnlUb29sYmFyQnV0dG9uQ29udGFpbmVyKSAjbGFzdFBhZ2U6OmJlZm9yZXsKICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24tbGFzdFBhZ2UtaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLWxhc3RQYWdlLWljb24pOwogICAgfQoKOmlzKCNzZWNvbmRhcnlUb29sYmFyICNzZWNvbmRhcnlUb29sYmFyQnV0dG9uQ29udGFpbmVyKSAjcGFnZVJvdGF0ZUNjdzo6YmVmb3JlewogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1yb3RhdGVDY3ctaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXJvdGF0ZUNjdy1pY29uKTsKICAgIH0KCjppcygjc2Vjb25kYXJ5VG9vbGJhciAjc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbkNvbnRhaW5lcikgI3BhZ2VSb3RhdGVDdzo6YmVmb3JlewogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1yb3RhdGVDdy1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24tcm90YXRlQ3ctaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNjdXJzb3JTZWxlY3RUb29sOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNlbGVjdFRvb2wtaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNlbGVjdFRvb2wtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNjdXJzb3JIYW5kVG9vbDo6YmVmb3JlewogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1oYW5kVG9vbC1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24taGFuZFRvb2wtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNzY3JvbGxQYWdlOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNjcm9sbFBhZ2UtaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNjcm9sbFBhZ2UtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNzY3JvbGxWZXJ0aWNhbDo6YmVmb3JlewogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1zY3JvbGxWZXJ0aWNhbC1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24tc2Nyb2xsVmVydGljYWwtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNzY3JvbGxIb3Jpem9udGFsOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNjcm9sbEhvcml6b250YWwtaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNjcm9sbEhvcml6b250YWwtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNzY3JvbGxXcmFwcGVkOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNjcm9sbFdyYXBwZWQtaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNjcm9sbFdyYXBwZWQtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNzcHJlYWROb25lOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNwcmVhZE5vbmUtaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNwcmVhZE5vbmUtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNzcHJlYWRPZGQ6OmJlZm9yZXsKICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24tc3ByZWFkT2RkLWljb24pOwogICAgICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1zcHJlYWRPZGQtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNzcHJlYWRFdmVuOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNwcmVhZEV2ZW4taWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1zZWNvbmRhcnlUb29sYmFyQnV0dG9uLXNwcmVhZEV2ZW4taWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNpbWFnZUFsdFRleHRTZXR0aW5nczo6YmVmb3JlewogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1pbWFnZUFsdFRleHRTZXR0aW5ncy1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24taW1hZ2VBbHRUZXh0U2V0dGluZ3MtaWNvbik7CiAgICB9Cgo6aXMoI3NlY29uZGFyeVRvb2xiYXIgI3NlY29uZGFyeVRvb2xiYXJCdXR0b25Db250YWluZXIpICNkb2N1bWVudFByb3BlcnRpZXM6OmJlZm9yZXsKICAgICAgLXdlYmtpdC1tYXNrLWltYWdlOnZhcigtLXNlY29uZGFyeVRvb2xiYXJCdXR0b24tZG9jdW1lbnRQcm9wZXJ0aWVzLWljb24pOwogICAgICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tc2Vjb25kYXJ5VG9vbGJhckJ1dHRvbi1kb2N1bWVudFByb3BlcnRpZXMtaWNvbik7CiAgICB9CgojZmluZGJhcnsKICAtLWlucHV0LWhvcml6b250YWwtcGFkZGluZzo0cHg7CiAgLS1maW5kYmFyLXBhZGRpbmc6MnB4OwoKICB3aWR0aDotbW96LW1heC1jb250ZW50OwoKICB3aWR0aDptYXgtY29udGVudDsKICBtYXgtd2lkdGg6OTB2dzsKICBtaW4taGVpZ2h0OnZhcigtLXRvb2xiYXItaGVpZ2h0KTsKICBoZWlnaHQ6YXV0bzsKICBwb3NpdGlvbjphYnNvbHV0ZTsKICB6LWluZGV4OjMwMDAwOwogIGN1cnNvcjpkZWZhdWx0OwogIHBhZGRpbmc6MDsKICBtaW4td2lkdGg6MzAwcHg7CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b29sYmFyLWJnLWNvbG9yKTsKICBib3gtc2l6aW5nOmJvcmRlci1ib3g7CiAgZmxleC13cmFwOndyYXA7CiAganVzdGlmeS1jb250ZW50OmZsZXgtc3RhcnQ7Cn0KCiNmaW5kYmFyICA+ICp7CiAgICBoZWlnaHQ6dmFyKC0tdG9vbGJhci1oZWlnaHQpOwogICAgcGFkZGluZzp2YXIoLS1maW5kYmFyLXBhZGRpbmcpOwogIH0KCiNmaW5kYmFyICNmaW5kSW5wdXRDb250YWluZXJ7CiAgICBtYXJnaW4taW5saW5lLXN0YXJ0OjJweDsKICB9Cgo6aXMoI2ZpbmRiYXIgI2ZpbmRJbnB1dENvbnRhaW5lcikgI2ZpbmRQcmV2aW91c0J1dHRvbjo6YmVmb3JlewogICAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tZmluZGJhckJ1dHRvbi1wcmV2aW91cy1pY29uKTsKICAgICAgICAgICAgICBtYXNrLWltYWdlOnZhcigtLWZpbmRiYXJCdXR0b24tcHJldmlvdXMtaWNvbik7CiAgICB9Cgo6aXMoI2ZpbmRiYXIgI2ZpbmRJbnB1dENvbnRhaW5lcikgI2ZpbmROZXh0QnV0dG9uOjpiZWZvcmV7CiAgICAgIC13ZWJraXQtbWFzay1pbWFnZTp2YXIoLS1maW5kYmFyQnV0dG9uLW5leHQtaWNvbik7CiAgICAgICAgICAgICAgbWFzay1pbWFnZTp2YXIoLS1maW5kYmFyQnV0dG9uLW5leHQtaWNvbik7CiAgICB9Cgo6aXMoI2ZpbmRiYXIgI2ZpbmRJbnB1dENvbnRhaW5lcikgI2ZpbmRJbnB1dHsKICAgICAgd2lkdGg6MjAwcHg7CiAgICAgIHBhZGRpbmc6NXB4IHZhcigtLWlucHV0LWhvcml6b250YWwtcGFkZGluZyk7CiAgICB9Cgo6aXMoOmlzKCNmaW5kYmFyICNmaW5kSW5wdXRDb250YWluZXIpICNmaW5kSW5wdXQpOjotbW96LXBsYWNlaG9sZGVyewogICAgICAgIGZvbnQtc3R5bGU6bm9ybWFsOwogICAgICB9Cgo6aXMoOmlzKCNmaW5kYmFyICNmaW5kSW5wdXRDb250YWluZXIpICNmaW5kSW5wdXQpOjpwbGFjZWhvbGRlcnsKICAgICAgICBmb250LXN0eWxlOm5vcm1hbDsKICAgICAgfQoKLmxvYWRpbmdJbnB1dDpoYXMoID4gW2RhdGEtc3RhdHVzPSJwZW5kaW5nIl06aXMoOmlzKCNmaW5kYmFyICNmaW5kSW5wdXRDb250YWluZXIpICNmaW5kSW5wdXQpKTo6YWZ0ZXJ7CiAgICAgICAgZGlzcGxheTppbmxpbmU7CiAgICAgICAgdmlzaWJpbGl0eTp2aXNpYmxlOwogICAgICAgIGluc2V0LWlubGluZS1lbmQ6Y2FsYyh2YXIoLS1pbnB1dC1ob3Jpem9udGFsLXBhZGRpbmcpICsgMXB4KTsKICAgICAgfQoKW2RhdGEtc3RhdHVzPSJub3RGb3VuZCJdOmlzKDppcygjZmluZGJhciAjZmluZElucHV0Q29udGFpbmVyKSAjZmluZElucHV0KXsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOnJnYigyNTUgMTAyIDEwMik7CiAgICAgIH0KCiNmaW5kYmFyICNmaW5kYmFyTWVzc2FnZUNvbnRhaW5lcnsKICAgIGRpc3BsYXk6bm9uZTsKICAgIGdhcDo0cHg7CiAgfQoKOmlzKCNmaW5kYmFyICNmaW5kYmFyTWVzc2FnZUNvbnRhaW5lcik6aGFzKCA+IDppcygjZmluZFJlc3VsdHNDb3VudCwjZmluZE1zZyk6bm90KDplbXB0eSkpewogICAgICBkaXNwbGF5OmlubGluZSBmbGV4OwogICAgfQoKOmlzKCNmaW5kYmFyICNmaW5kYmFyTWVzc2FnZUNvbnRhaW5lcikgI2ZpbmRSZXN1bHRzQ291bnR7CiAgICAgIGJhY2tncm91bmQtY29sb3I6cmdiKDIxNyAyMTcgMjE3KTsKICAgICAgY29sb3I6cmdiKDgyIDgyIDgyKTsKICAgICAgcGFkZGluZy1ibG9jazo0cHg7CiAgICB9Cgo6aXMoOmlzKCNmaW5kYmFyICNmaW5kYmFyTWVzc2FnZUNvbnRhaW5lcikgI2ZpbmRSZXN1bHRzQ291bnQpOmVtcHR5ewogICAgICAgIGRpc3BsYXk6bm9uZTsKICAgICAgfQoKW2RhdGEtc3RhdHVzPSJub3RGb3VuZCJdOmlzKDppcygjZmluZGJhciAjZmluZGJhck1lc3NhZ2VDb250YWluZXIpICNmaW5kTXNnKXsKICAgICAgICBmb250LXdlaWdodDpib2xkOwogICAgICB9Cgo6aXMoOmlzKCNmaW5kYmFyICNmaW5kYmFyTWVzc2FnZUNvbnRhaW5lcikgI2ZpbmRNc2cpOmVtcHR5ewogICAgICAgIGRpc3BsYXk6bm9uZTsKICAgICAgfQoKI2ZpbmRiYXIud3JhcENvbnRhaW5lcnN7CiAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OwogICAgaGVpZ2h0Oi1tb3otbWF4LWNvbnRlbnQ7CiAgICBoZWlnaHQ6bWF4LWNvbnRlbnQ7CiAgfQoKI2ZpbmRiYXIud3JhcENvbnRhaW5lcnMgLnRvb2xiYXJMYWJlbHsKICAgICAgbWFyZ2luOjAgNHB4OwogICAgfQoKI2ZpbmRiYXIud3JhcENvbnRhaW5lcnMgI2ZpbmRiYXJNZXNzYWdlQ29udGFpbmVyewogICAgICBmbGV4LXdyYXA6d3JhcDsKICAgICAgZmxleC1mbG93OmNvbHVtbiBub3dyYXA7CiAgICAgIGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7CiAgICAgIGhlaWdodDotbW96LW1heC1jb250ZW50OwogICAgICBoZWlnaHQ6bWF4LWNvbnRlbnQ7CiAgICB9Cgo6aXMoI2ZpbmRiYXIud3JhcENvbnRhaW5lcnMgI2ZpbmRiYXJNZXNzYWdlQ29udGFpbmVyKSAjZmluZFJlc3VsdHNDb3VudHsKICAgICAgICBoZWlnaHQ6Y2FsYyh2YXIoLS10b29sYmFyLWhlaWdodCkgLSAyICogdmFyKC0tZmluZGJhci1wYWRkaW5nKSk7CiAgICAgIH0KCjppcygjZmluZGJhci53cmFwQ29udGFpbmVycyAjZmluZGJhck1lc3NhZ2VDb250YWluZXIpICNmaW5kTXNnewogICAgICAgIG1pbi1oZWlnaHQ6dmFyKC0tdG9vbGJhci1oZWlnaHQpOwogICAgICB9CgpAcGFnZXsKICBtYXJnaW46MDsKfQoKI3ByaW50Q29udGFpbmVyewogIGRpc3BsYXk6bm9uZTsKfQoKQG1lZGlhIHByaW50ewogIGJvZHl7CiAgICBiYWNrZ3JvdW5kOnJnYigwIDAgMCAvIDApIG5vbmU7CiAgfQoKICBib2R5W2RhdGEtcGRmanNwcmludGluZ10gI291dGVyQ29udGFpbmVyewogICAgZGlzcGxheTpub25lOwogIH0KCiAgYm9keVtkYXRhLXBkZmpzcHJpbnRpbmddICNwcmludENvbnRhaW5lcnsKICAgIGRpc3BsYXk6YmxvY2s7CiAgfQoKICAjcHJpbnRDb250YWluZXJ7CiAgICBoZWlnaHQ6MTAwJTsKICB9CiAgI3ByaW50Q29udGFpbmVyID4gLnByaW50ZWRQYWdlewogICAgcGFnZS1icmVhay1hZnRlcjphbHdheXM7CiAgICBwYWdlLWJyZWFrLWluc2lkZTphdm9pZDsKICAgIGhlaWdodDoxMDAlOwogICAgd2lkdGg6MTAwJTsKCiAgICBkaXNwbGF5OmZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogICAgYWxpZ24taXRlbXM6Y2VudGVyOwogIH0KCiAgI3ByaW50Q29udGFpbmVyID4gLnhmYVByaW50ZWRQYWdlIC54ZmFQYWdlewogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgfQoKICAjcHJpbnRDb250YWluZXIgPiAueGZhUHJpbnRlZFBhZ2V7CiAgICBwYWdlLWJyZWFrLWFmdGVyOmFsd2F5czsKICAgIHBhZ2UtYnJlYWstaW5zaWRlOmF2b2lkOwogICAgd2lkdGg6MTAwJTsKICAgIGhlaWdodDoxMDAlOwogICAgcG9zaXRpb246cmVsYXRpdmU7CiAgfQoKICAjcHJpbnRDb250YWluZXIgPiAucHJpbnRlZFBhZ2UgOmlzKGNhbnZhcywgaW1nKXsKICAgIG1heC13aWR0aDoxMDAlOwogICAgbWF4LWhlaWdodDoxMDAlOwoKICAgIGRpcmVjdGlvbjpsdHI7CiAgICBkaXNwbGF5OmJsb2NrOwogIH0KfQoKLnZpc2libGVNZWRpdW1WaWV3ewogIGRpc3BsYXk6bm9uZSAhaW1wb3J0YW50Owp9CgoudG9vbGJhckxhYmVsewogIHdpZHRoOi1tb3otbWF4LWNvbnRlbnQ7CiAgd2lkdGg6bWF4LWNvbnRlbnQ7CiAgbWluLXdpZHRoOjE2cHg7CiAgaGVpZ2h0OjEwMCU7CiAgcGFkZGluZy1pbmxpbmU6NHB4OwogIG1hcmdpbjoycHg7CiAgYm9yZGVyLXJhZGl1czoycHg7CiAgY29sb3I6dmFyKC0tbWFpbi1jb2xvcik7CiAgZm9udC1zaXplOjEycHg7CiAgbGluZS1oZWlnaHQ6MTRweDsKICB0ZXh0LWFsaWduOmxlZnQ7CiAgLXdlYmtpdC11c2VyLXNlbGVjdDpub25lOwogICAgIC1tb3otdXNlci1zZWxlY3Q6bm9uZTsKICAgICAgICAgIHVzZXItc2VsZWN0Om5vbmU7CiAgY3Vyc29yOmRlZmF1bHQ7CiAgYm94LXNpemluZzpib3JkZXItYm94OwoKICBkaXNwbGF5OmlubGluZSBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICBhbGlnbi1pdGVtczpjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKfQoKLnRvb2xiYXJMYWJlbCAgPiBsYWJlbHsKICAgIHdpZHRoOjEwMCU7CiAgfQoKLnRvb2xiYXJIb3Jpem9udGFsR3JvdXB7CiAgaGVpZ2h0OjEwMCU7CiAgZGlzcGxheTppbmxpbmUgZmxleDsKICBmbGV4LWRpcmVjdGlvbjpyb3c7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwogIGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOwogIGdhcDoxcHg7CiAgYm94LXNpemluZzpib3JkZXItYm94Owp9CgouZHJvcGRvd25Ub29sYmFyQnV0dG9uewogIGRpc3BsYXk6aW5saW5lIGZsZXg7CiAgZmxleC1kaXJlY3Rpb246cm93OwogIGFsaWduLWl0ZW1zOmNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogIHBvc2l0aW9uOnJlbGF0aXZlOwoKICB3aWR0aDotbW96LWZpdC1jb250ZW50OwoKICB3aWR0aDpmaXQtY29udGVudDsKICBtaW4td2lkdGg6MTQwcHg7CiAgcGFkZGluZzowOwogIGJhY2tncm91bmQtY29sb3I6dmFyKC0tZHJvcGRvd24tYnRuLWJnLWNvbG9yKTsKICBib3JkZXI6dmFyKC0tZHJvcGRvd24tYnRuLWJvcmRlcik7CiAgYm9yZGVyLXJhZGl1czoycHg7CiAgY29sb3I6dmFyKC0tbWFpbi1jb2xvcik7CiAgZm9udC1zaXplOjEycHg7CiAgbGluZS1oZWlnaHQ6MTRweDsKICAtd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7CiAgICAgLW1vei11c2VyLXNlbGVjdDpub25lOwogICAgICAgICAgdXNlci1zZWxlY3Q6bm9uZTsKICBjdXJzb3I6ZGVmYXVsdDsKICBib3gtc2l6aW5nOmJvcmRlci1ib3g7CiAgb3V0bGluZTpub25lOwp9CgouZHJvcGRvd25Ub29sYmFyQnV0dG9uOmhvdmVyewogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1idXR0b24taG92ZXItY29sb3IpOwogIH0KCi5kcm9wZG93blRvb2xiYXJCdXR0b24gID4gc2VsZWN0ewogICAgLXdlYmtpdC1hcHBlYXJhbmNlOm5vbmU7CiAgICAgICAtbW96LWFwcGVhcmFuY2U6bm9uZTsKICAgICAgICAgICAgYXBwZWFyYW5jZTpub25lOwogICAgd2lkdGg6aW5oZXJpdDsKICAgIG1pbi13aWR0aDppbmhlcml0OwogICAgaGVpZ2h0OjI4cHg7CiAgICBmb250Om1lc3NhZ2UtYm94OwogICAgZm9udC1zaXplOjEycHg7CiAgICBjb2xvcjp2YXIoLS1tYWluLWNvbG9yKTsKICAgIG1hcmdpbjowOwogICAgcGFkZGluZy1ibG9jazoxcHggMnB4OwogICAgcGFkZGluZy1pbmxpbmU6NnB4IDM4cHg7CiAgICBib3JkZXI6bm9uZTsKICAgIG91dGxpbmU6bm9uZTsKICAgIGJhY2tncm91bmQtY29sb3I6dmFyKC0tZHJvcGRvd24tYnRuLWJnLWNvbG9yKTsKICB9Cgo6aXMoLmRyb3Bkb3duVG9vbGJhckJ1dHRvbiA+IHNlbGVjdCkgID4gb3B0aW9uewogICAgICBiYWNrZ3JvdW5kOnZhcigtLWRvb3JoYW5nZXItYmctY29sb3IpOwogICAgICBjb2xvcjp2YXIoLS1tYWluLWNvbG9yKTsKICAgIH0KCjppcyguZHJvcGRvd25Ub29sYmFyQnV0dG9uID4gc2VsZWN0KTppcyg6aG92ZXIsOmZvY3VzLXZpc2libGUpewogICAgICBiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWJ1dHRvbi1ob3Zlci1jb2xvcik7CiAgICAgIGNvbG9yOnZhcigtLXRvZ2dsZWQtYnRuLWNvbG9yKTsKICAgIH0KCi5kcm9wZG93blRvb2xiYXJCdXR0b246OmFmdGVyewogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICBkaXNwbGF5OmlubGluZTsKICAgIHdpZHRoOnZhcigtLWljb24tc2l6ZSk7CiAgICBoZWlnaHQ6dmFyKC0taWNvbi1zaXplKTsKCiAgICBjb250ZW50OiIiOwogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b29sYmFyLWljb24tYmctY29sb3IpOwogICAgLXdlYmtpdC1tYXNrLXNpemU6Y292ZXI7CiAgICAgICAgICAgIG1hc2stc2l6ZTpjb3ZlcjsKCiAgICBpbnNldC1pbmxpbmUtZW5kOjRweDsKICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICAtd2Via2l0LW1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1tZW51QXJyb3ctaWNvbik7CiAgICAgICAgICAgIG1hc2staW1hZ2U6dmFyKC0tdG9vbGJhckJ1dHRvbi1tZW51QXJyb3ctaWNvbik7CiAgfQoKLmRyb3Bkb3duVG9vbGJhckJ1dHRvbjppcyg6aG92ZXIsOmZvY3VzLXZpc2libGUsOmFjdGl2ZSk6OmFmdGVyewogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b29sYmFyLWljb24taG92ZXItYmctY29sb3IpOwogIH0KCiN0b29sYmFyQ29udGFpbmVyewogIC0tbWVudWl0ZW0taGVpZ2h0OmNhbGModmFyKC0tdG9vbGJhci1oZWlnaHQpIC0gNnB4KTsKCiAgd2lkdGg6MTAwJTsKICBoZWlnaHQ6dmFyKC0tdG9vbGJhci1oZWlnaHQpOwogIHBhZGRpbmc6dmFyKC0tdG9vbGJhci12ZXJ0aWNhbC1wYWRkaW5nKSB2YXIoLS10b29sYmFyLWhvcml6b250YWwtcGFkZGluZyk7CiAgcG9zaXRpb246cmVsYXRpdmU7CiAgYm94LXNpemluZzpib3JkZXItYm94OwogIGZvbnQ6bWVzc2FnZS1ib3g7CiAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS10b29sYmFyLWJnLWNvbG9yKTsKICBib3gtc2hhZG93OnZhcigtLXRvb2xiYXItYm94LXNoYWRvdyk7CiAgYm9yZGVyLWJvdHRvbTp2YXIoLS10b29sYmFyLWJvcmRlci1ib3R0b20pOwp9CgojdG9vbGJhckNvbnRhaW5lciAjdG9vbGJhclZpZXdlcnsKICAgIHdpZHRoOjEwMCU7CiAgICBoZWlnaHQ6MTAwJTsKICAgIGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOwogIH0KCjppcygjdG9vbGJhckNvbnRhaW5lciAjdG9vbGJhclZpZXdlcikgID4gKnsKICAgICAgZmxleDpub25lOwogICAgfQoKOmlzKCN0b29sYmFyQ29udGFpbmVyICN0b29sYmFyVmlld2VyKSBpbnB1dHsKICAgICAgZm9udDptZXNzYWdlLWJveDsKICAgIH0KCjppcygjdG9vbGJhckNvbnRhaW5lciAjdG9vbGJhclZpZXdlcikgLnRvb2xiYXJCdXR0b25TcGFjZXJ7CiAgICAgIHdpZHRoOjMwcHg7CiAgICAgIGRpc3BsYXk6YmxvY2s7CiAgICAgIGhlaWdodDoxcHg7CiAgICB9Cgo6aXMoI3Rvb2xiYXJDb250YWluZXIgI3Rvb2xiYXJWaWV3ZXIpICN0b29sYmFyVmlld2VyTGVmdCAjbnVtUGFnZXMudG9vbGJhckxhYmVsewogICAgICBwYWRkaW5nLWlubGluZS1zdGFydDozcHg7CiAgICAgIGZsZXg6bm9uZTsKICAgIH0KCiN0b29sYmFyQ29udGFpbmVyICNsb2FkaW5nQmFyewogICAgLS1wcm9ncmVzc0Jhci1wZXJjZW50OjAlOwogICAgLS1wcm9ncmVzc0Jhci1lbmQtb2Zmc2V0OjA7CgogICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICB0b3A6dmFyKC0tdG9vbGJhci1oZWlnaHQpOwogICAgaW5zZXQtaW5saW5lOjAgdmFyKC0tcHJvZ3Jlc3NCYXItZW5kLW9mZnNldCk7CiAgICBoZWlnaHQ6NHB4OwogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1wcm9ncmVzc0Jhci1iZy1jb2xvcik7CiAgICBib3JkZXItYm90dG9tOjFweCBzb2xpZCB2YXIoLS10b29sYmFyLWJvcmRlci1jb2xvcik7CiAgICB0cmFuc2l0aW9uLXByb3BlcnR5Omluc2V0LWlubGluZS1zdGFydDsKICAgIHRyYW5zaXRpb24tZHVyYXRpb246dmFyKC0tc2lkZWJhci10cmFuc2l0aW9uLWR1cmF0aW9uKTsKICAgIHRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uOnZhcigtLXNpZGViYXItdHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb24pOwogIH0KCjppcygjdG9vbGJhckNvbnRhaW5lciAjbG9hZGluZ0JhcikgLnByb2dyZXNzewogICAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgICAgdG9wOjA7CiAgICAgIGluc2V0LWlubGluZS1zdGFydDowOwogICAgICB3aWR0aDoxMDAlOwogICAgICB0cmFuc2Zvcm06c2NhbGVYKHZhcigtLXByb2dyZXNzQmFyLXBlcmNlbnQpKTsKICAgICAgdHJhbnNmb3JtLW9yaWdpbjpjYWxjKDUwJSAtIDUwJSAqIHZhcigtLWRpci1mYWN0b3IpKSAwOwogICAgICBoZWlnaHQ6MTAwJTsKICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1wcm9ncmVzc0Jhci1jb2xvcik7CiAgICAgIG92ZXJmbG93OmhpZGRlbjsKICAgICAgdHJhbnNpdGlvbjp0cmFuc2Zvcm0gMjAwbXM7CiAgICB9CgouaW5kZXRlcm1pbmF0ZTppcygjdG9vbGJhckNvbnRhaW5lciAjbG9hZGluZ0JhcikgLnByb2dyZXNzewogICAgICB0cmFuc2Zvcm06bm9uZTsKICAgICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1wcm9ncmVzc0Jhci1iZy1jb2xvcik7CiAgICAgIHRyYW5zaXRpb246bm9uZTsKICAgIH0KCjppcyguaW5kZXRlcm1pbmF0ZTppcygjdG9vbGJhckNvbnRhaW5lciAjbG9hZGluZ0JhcikgLnByb2dyZXNzKSAuZ2xpbW1lcnsKICAgICAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgICAgICB0b3A6MDsKICAgICAgICBpbnNldC1pbmxpbmUtc3RhcnQ6MDsKICAgICAgICBoZWlnaHQ6MTAwJTsKICAgICAgICB3aWR0aDpjYWxjKDEwMCUgKyAxNTBweCk7CiAgICAgICAgYmFja2dyb3VuZDpyZXBlYXRpbmctbGluZWFyLWdyYWRpZW50KAogICAgICAgICAgMTM1ZGVnLAogICAgICAgICAgdmFyKC0tcHJvZ3Jlc3NCYXItYmxlbmQtY29sb3IpIDAsCiAgICAgICAgICB2YXIoLS1wcm9ncmVzc0Jhci1iZy1jb2xvcikgNXB4LAogICAgICAgICAgdmFyKC0tcHJvZ3Jlc3NCYXItYmctY29sb3IpIDQ1cHgsCiAgICAgICAgICB2YXIoLS1wcm9ncmVzc0Jhci1jb2xvcikgNTVweCwKICAgICAgICAgIHZhcigtLXByb2dyZXNzQmFyLWNvbG9yKSA5NXB4LAogICAgICAgICAgdmFyKC0tcHJvZ3Jlc3NCYXItYmxlbmQtY29sb3IpIDEwMHB4CiAgICAgICAgKTsKICAgICAgICBhbmltYXRpb246cHJvZ3Jlc3NJbmRldGVybWluYXRlIDFzIGxpbmVhciBpbmZpbml0ZTsKICAgICAgfQoKQG1lZGlhIGFsbCBhbmQgKG1heC13aWR0aDogODQwcHgpewogICNzaWRlYmFyQ29udGFpbmVyewogICAgYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1zaWRlYmFyLW5hcnJvdy1iZy1jb2xvcik7CiAgfQogICNvdXRlckNvbnRhaW5lci5zaWRlYmFyT3BlbiAjdmlld2VyQ29udGFpbmVyewogICAgaW5zZXQtaW5saW5lLXN0YXJ0OjAgIWltcG9ydGFudDsKICB9Cn0KCkBtZWRpYSBhbGwgYW5kIChtYXgtd2lkdGg6IDc1MHB4KXsKICAjb3V0ZXJDb250YWluZXIgLmhpZGRlbk1lZGl1bVZpZXd7CiAgICBkaXNwbGF5Om5vbmUgIWltcG9ydGFudDsKICB9CiAgI291dGVyQ29udGFpbmVyIC52aXNpYmxlTWVkaXVtVmlldzpub3QoLmhpZGRlbiwgW2hpZGRlbl0pewogICAgZGlzcGxheTppbmxpbmUtYmxvY2sgIWltcG9ydGFudDsKICB9Cn0KCkBtZWRpYSBhbGwgYW5kIChtYXgtd2lkdGg6IDY5MHB4KXsKICAuaGlkZGVuU21hbGxWaWV3LAogIC5oaWRkZW5TbWFsbFZpZXcgKnsKICAgIGRpc3BsYXk6bm9uZSAhaW1wb3J0YW50OwogIH0KCiAgI3Rvb2xiYXJDb250YWluZXIgI3Rvb2xiYXJWaWV3ZXIgLnRvb2xiYXJCdXR0b25TcGFjZXJ7CiAgICB3aWR0aDowOwogIH0KfQoKQG1lZGlhIGFsbCBhbmQgKG1heC13aWR0aDogNTYwcHgpewogICNzY2FsZVNlbGVjdENvbnRhaW5lcnsKICAgIGRpc3BsYXk6bm9uZTsKICB9Cn0K">

  <script src="data:text/plain;base64,LyoqCiAqIEBsaWNzdGFydCBUaGUgZm9sbG93aW5nIGlzIHRoZSBlbnRpcmUgbGljZW5zZSBub3RpY2UgZm9yIHRoZQogKiBKYXZhU2NyaXB0IGNvZGUgaW4gdGhpcyBwYWdlCiAqCiAqIENvcHlyaWdodCAyMDI0IE1vemlsbGEgRm91bmRhdGlvbgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKiBAbGljZW5kIFRoZSBhYm92ZSBpcyB0aGUgZW50aXJlIGxpY2Vuc2Ugbm90aWNlIGZvciB0aGUKICogSmF2YVNjcmlwdCBjb2RlIGluIHRoaXMgcGFnZQogKi8KCi8qKgogKiBwZGZqc1ZlcnNpb24gPSA1LjMuMzEKICogcGRmanNCdWlsZCA9IDQ3YWQ4MjBkOQogKi8KCjsvLyAuL3dlYi9wZGZqcy5qcwpjb25zdCB7CiAgQWJvcnRFeGNlcHRpb24sCiAgQW5ub3RhdGlvbkVkaXRvckxheWVyLAogIEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLAogIEFubm90YXRpb25FZGl0b3JUeXBlLAogIEFubm90YXRpb25FZGl0b3JVSU1hbmFnZXIsCiAgQW5ub3RhdGlvbkxheWVyLAogIEFubm90YXRpb25Nb2RlLAogIEFubm90YXRpb25UeXBlLAogIGJ1aWxkLAogIENvbG9yUGlja2VyLAogIGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwsCiAgRE9NU1ZHRmFjdG9yeSwKICBEcmF3TGF5ZXIsCiAgRmVhdHVyZVRlc3QsCiAgZmV0Y2hEYXRhLAogIGdldERvY3VtZW50LAogIGdldEZpbGVuYW1lRnJvbVVybCwKICBnZXRQZGZGaWxlbmFtZUZyb21Vcmw6IHBkZmpzX2dldFBkZkZpbGVuYW1lRnJvbVVybCwKICBnZXRVdWlkLAogIGdldFhmYVBhZ2VWaWV3cG9ydCwKICBHbG9iYWxXb3JrZXJPcHRpb25zLAogIEltYWdlS2luZCwKICBJbnZhbGlkUERGRXhjZXB0aW9uLAogIGlzRGF0YVNjaGVtZSwKICBpc1BkZkZpbGUsCiAgaXNWYWxpZEV4cGxpY2l0RGVzdCwKICBNYXRoQ2xhbXAsCiAgbm9Db250ZXh0TWVudSwKICBub3JtYWxpemVVbmljb2RlLAogIE9QUywKICBPdXRwdXRTY2FsZSwKICBQYXNzd29yZFJlc3BvbnNlcywKICBQREZEYXRhUmFuZ2VUcmFuc3BvcnQsCiAgUERGRGF0ZVN0cmluZywKICBQREZXb3JrZXIsCiAgUGVybWlzc2lvbkZsYWcsCiAgUGl4ZWxzUGVySW5jaCwKICBSZW5kZXJpbmdDYW5jZWxsZWRFeGNlcHRpb24sCiAgUmVzcG9uc2VFeGNlcHRpb24sCiAgc2V0TGF5ZXJEaW1lbnNpb25zLAogIHNoYWRvdywKICBTaWduYXR1cmVFeHRyYWN0b3IsCiAgc3RvcEV2ZW50LAogIFN1cHBvcnRlZEltYWdlTWltZVR5cGVzLAogIFRleHRMYXllciwKICBUb3VjaE1hbmFnZXIsCiAgdXBkYXRlVXJsSGFzaCwKICBVdGlsLAogIFZlcmJvc2l0eUxldmVsLAogIHZlcnNpb24sCiAgWGZhTGF5ZXIKfSA9IGdsb2JhbFRoaXMucGRmanNMaWI7Cgo7Ly8gLi93ZWIvdWlfdXRpbHMuanMKCmNvbnN0IERFRkFVTFRfU0NBTEVfVkFMVUUgPSAiYXV0byI7CmNvbnN0IERFRkFVTFRfU0NBTEUgPSAxLjA7CmNvbnN0IERFRkFVTFRfU0NBTEVfREVMVEEgPSAxLjE7CmNvbnN0IE1JTl9TQ0FMRSA9IDAuMTsKY29uc3QgTUFYX1NDQUxFID0gMTAuMDsKY29uc3QgVU5LTk9XTl9TQ0FMRSA9IDA7CmNvbnN0IE1BWF9BVVRPX1NDQUxFID0gMS4yNTsKY29uc3QgU0NST0xMQkFSX1BBRERJTkcgPSA0MDsKY29uc3QgVkVSVElDQUxfUEFERElORyA9IDU7CmNvbnN0IFJlbmRlcmluZ1N0YXRlcyA9IHsKICBJTklUSUFMOiAwLAogIFJVTk5JTkc6IDEsCiAgUEFVU0VEOiAyLAogIEZJTklTSEVEOiAzCn07CmNvbnN0IFByZXNlbnRhdGlvbk1vZGVTdGF0ZSA9IHsKICBVTktOT1dOOiAwLAogIE5PUk1BTDogMSwKICBDSEFOR0lORzogMiwKICBGVUxMU0NSRUVOOiAzCn07CmNvbnN0IFNpZGViYXJWaWV3ID0gewogIFVOS05PV046IC0xLAogIE5PTkU6IDAsCiAgVEhVTUJTOiAxLAogIE9VVExJTkU6IDIsCiAgQVRUQUNITUVOVFM6IDMsCiAgTEFZRVJTOiA0Cn07CmNvbnN0IFRleHRMYXllck1vZGUgPSB7CiAgRElTQUJMRTogMCwKICBFTkFCTEU6IDEsCiAgRU5BQkxFX1BFUk1JU1NJT05TOiAyCn07CmNvbnN0IFNjcm9sbE1vZGUgPSB7CiAgVU5LTk9XTjogLTEsCiAgVkVSVElDQUw6IDAsCiAgSE9SSVpPTlRBTDogMSwKICBXUkFQUEVEOiAyLAogIFBBR0U6IDMKfTsKY29uc3QgU3ByZWFkTW9kZSA9IHsKICBVTktOT1dOOiAtMSwKICBOT05FOiAwLAogIE9ERDogMSwKICBFVkVOOiAyCn07CmNvbnN0IEN1cnNvclRvb2wgPSB7CiAgU0VMRUNUOiAwLAogIEhBTkQ6IDEsCiAgWk9PTTogMgp9Owpjb25zdCBBdXRvUHJpbnRSZWdFeHAgPSAvXGJwcmludFxzKlwoLzsKZnVuY3Rpb24gc2Nyb2xsSW50b1ZpZXcoZWxlbWVudCwgc3BvdCwgc2Nyb2xsTWF0Y2hlcyA9IGZhbHNlKSB7CiAgbGV0IHBhcmVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50OwogIGlmICghcGFyZW50KSB7CiAgICBjb25zb2xlLmVycm9yKCJvZmZzZXRQYXJlbnQgaXMgbm90IHNldCAtLSBjYW5ub3Qgc2Nyb2xsIik7CiAgICByZXR1cm47CiAgfQogIGxldCBvZmZzZXRZID0gZWxlbWVudC5vZmZzZXRUb3AgKyBlbGVtZW50LmNsaWVudFRvcDsKICBsZXQgb2Zmc2V0WCA9IGVsZW1lbnQub2Zmc2V0TGVmdCArIGVsZW1lbnQuY2xpZW50TGVmdDsKICB3aGlsZSAocGFyZW50LmNsaWVudEhlaWdodCA9PT0gcGFyZW50LnNjcm9sbEhlaWdodCAmJiBwYXJlbnQuY2xpZW50V2lkdGggPT09IHBhcmVudC5zY3JvbGxXaWR0aCB8fCBzY3JvbGxNYXRjaGVzICYmIChwYXJlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJtYXJrZWRDb250ZW50IikgfHwgZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnQpLm92ZXJmbG93ID09PSAiaGlkZGVuIikpIHsKICAgIG9mZnNldFkgKz0gcGFyZW50Lm9mZnNldFRvcDsKICAgIG9mZnNldFggKz0gcGFyZW50Lm9mZnNldExlZnQ7CiAgICBwYXJlbnQgPSBwYXJlbnQub2Zmc2V0UGFyZW50OwogICAgaWYgKCFwYXJlbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogIH0KICBpZiAoc3BvdCkgewogICAgaWYgKHNwb3QudG9wICE9PSB1bmRlZmluZWQpIHsKICAgICAgb2Zmc2V0WSArPSBzcG90LnRvcDsKICAgIH0KICAgIGlmIChzcG90LmxlZnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvZmZzZXRYICs9IHNwb3QubGVmdDsKICAgICAgcGFyZW50LnNjcm9sbExlZnQgPSBvZmZzZXRYOwogICAgfQogIH0KICBwYXJlbnQuc2Nyb2xsVG9wID0gb2Zmc2V0WTsKfQpmdW5jdGlvbiB3YXRjaFNjcm9sbCh2aWV3QXJlYUVsZW1lbnQsIGNhbGxiYWNrLCBhYm9ydFNpZ25hbCA9IHVuZGVmaW5lZCkgewogIGNvbnN0IGRlYm91bmNlU2Nyb2xsID0gZnVuY3Rpb24gKGV2dCkgewogICAgaWYgKHJBRikgewogICAgICByZXR1cm47CiAgICB9CiAgICByQUYgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uIHZpZXdBcmVhRWxlbWVudFNjcm9sbGVkKCkgewogICAgICByQUYgPSBudWxsOwogICAgICBjb25zdCBjdXJyZW50WCA9IHZpZXdBcmVhRWxlbWVudC5zY3JvbGxMZWZ0OwogICAgICBjb25zdCBsYXN0WCA9IHN0YXRlLmxhc3RYOwogICAgICBpZiAoY3VycmVudFggIT09IGxhc3RYKSB7CiAgICAgICAgc3RhdGUucmlnaHQgPSBjdXJyZW50WCA+IGxhc3RYOwogICAgICB9CiAgICAgIHN0YXRlLmxhc3RYID0gY3VycmVudFg7CiAgICAgIGNvbnN0IGN1cnJlbnRZID0gdmlld0FyZWFFbGVtZW50LnNjcm9sbFRvcDsKICAgICAgY29uc3QgbGFzdFkgPSBzdGF0ZS5sYXN0WTsKICAgICAgaWYgKGN1cnJlbnRZICE9PSBsYXN0WSkgewogICAgICAgIHN0YXRlLmRvd24gPSBjdXJyZW50WSA+IGxhc3RZOwogICAgICB9CiAgICAgIHN0YXRlLmxhc3RZID0gY3VycmVudFk7CiAgICAgIGNhbGxiYWNrKHN0YXRlKTsKICAgIH0pOwogIH07CiAgY29uc3Qgc3RhdGUgPSB7CiAgICByaWdodDogdHJ1ZSwKICAgIGRvd246IHRydWUsCiAgICBsYXN0WDogdmlld0FyZWFFbGVtZW50LnNjcm9sbExlZnQsCiAgICBsYXN0WTogdmlld0FyZWFFbGVtZW50LnNjcm9sbFRvcCwKICAgIF9ldmVudEhhbmRsZXI6IGRlYm91bmNlU2Nyb2xsCiAgfTsKICBsZXQgckFGID0gbnVsbDsKICB2aWV3QXJlYUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgZGVib3VuY2VTY3JvbGwsIHsKICAgIHVzZUNhcHR1cmU6IHRydWUsCiAgICBzaWduYWw6IGFib3J0U2lnbmFsCiAgfSk7CiAgYWJvcnRTaWduYWw/LmFkZEV2ZW50TGlzdGVuZXIoImFib3J0IiwgKCkgPT4gd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHJBRiksIHsKICAgIG9uY2U6IHRydWUKICB9KTsKICByZXR1cm4gc3RhdGU7Cn0KZnVuY3Rpb24gcGFyc2VRdWVyeVN0cmluZyhxdWVyeSkgewogIGNvbnN0IHBhcmFtcyA9IG5ldyBNYXAoKTsKICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBuZXcgVVJMU2VhcmNoUGFyYW1zKHF1ZXJ5KSkgewogICAgcGFyYW1zLnNldChrZXkudG9Mb3dlckNhc2UoKSwgdmFsdWUpOwogIH0KICByZXR1cm4gcGFyYW1zOwp9CmNvbnN0IEludmlzaWJsZUNoYXJzUmVnRXhwID0gL1tceDAwLVx4MUZdL2c7CmZ1bmN0aW9uIHJlbW92ZU51bGxDaGFyYWN0ZXJzKHN0ciwgcmVwbGFjZUludmlzaWJsZSA9IGZhbHNlKSB7CiAgaWYgKCFJbnZpc2libGVDaGFyc1JlZ0V4cC50ZXN0KHN0cikpIHsKICAgIHJldHVybiBzdHI7CiAgfQogIGlmIChyZXBsYWNlSW52aXNpYmxlKSB7CiAgICByZXR1cm4gc3RyLnJlcGxhY2VBbGwoSW52aXNpYmxlQ2hhcnNSZWdFeHAsIG0gPT4gbSA9PT0gIlx4MDAiID8gIiIgOiAiICIpOwogIH0KICByZXR1cm4gc3RyLnJlcGxhY2VBbGwoIlx4MDAiLCAiIik7Cn0KZnVuY3Rpb24gYmluYXJ5U2VhcmNoRmlyc3RJdGVtKGl0ZW1zLCBjb25kaXRpb24sIHN0YXJ0ID0gMCkgewogIGxldCBtaW5JbmRleCA9IHN0YXJ0OwogIGxldCBtYXhJbmRleCA9IGl0ZW1zLmxlbmd0aCAtIDE7CiAgaWYgKG1heEluZGV4IDwgMCB8fCAhY29uZGl0aW9uKGl0ZW1zW21heEluZGV4XSkpIHsKICAgIHJldHVybiBpdGVtcy5sZW5ndGg7CiAgfQogIGlmIChjb25kaXRpb24oaXRlbXNbbWluSW5kZXhdKSkgewogICAgcmV0dXJuIG1pbkluZGV4OwogIH0KICB3aGlsZSAobWluSW5kZXggPCBtYXhJbmRleCkgewogICAgY29uc3QgY3VycmVudEluZGV4ID0gbWluSW5kZXggKyBtYXhJbmRleCA+PiAxOwogICAgY29uc3QgY3VycmVudEl0ZW0gPSBpdGVtc1tjdXJyZW50SW5kZXhdOwogICAgaWYgKGNvbmRpdGlvbihjdXJyZW50SXRlbSkpIHsKICAgICAgbWF4SW5kZXggPSBjdXJyZW50SW5kZXg7CiAgICB9IGVsc2UgewogICAgICBtaW5JbmRleCA9IGN1cnJlbnRJbmRleCArIDE7CiAgICB9CiAgfQogIHJldHVybiBtaW5JbmRleDsKfQpmdW5jdGlvbiBhcHByb3hpbWF0ZUZyYWN0aW9uKHgpIHsKICBpZiAoTWF0aC5mbG9vcih4KSA9PT0geCkgewogICAgcmV0dXJuIFt4LCAxXTsKICB9CiAgY29uc3QgeGludiA9IDEgLyB4OwogIGNvbnN0IGxpbWl0ID0gODsKICBpZiAoeGludiA+IGxpbWl0KSB7CiAgICByZXR1cm4gWzEsIGxpbWl0XTsKICB9IGVsc2UgaWYgKE1hdGguZmxvb3IoeGludikgPT09IHhpbnYpIHsKICAgIHJldHVybiBbMSwgeGludl07CiAgfQogIGNvbnN0IHhfID0geCA+IDEgPyB4aW52IDogeDsKICBsZXQgYSA9IDAsCiAgICBiID0gMSwKICAgIGMgPSAxLAogICAgZCA9IDE7CiAgd2hpbGUgKHRydWUpIHsKICAgIGNvbnN0IHAgPSBhICsgYywKICAgICAgcSA9IGIgKyBkOwogICAgaWYgKHEgPiBsaW1pdCkgewogICAgICBicmVhazsKICAgIH0KICAgIGlmICh4XyA8PSBwIC8gcSkgewogICAgICBjID0gcDsKICAgICAgZCA9IHE7CiAgICB9IGVsc2UgewogICAgICBhID0gcDsKICAgICAgYiA9IHE7CiAgICB9CiAgfQogIGxldCByZXN1bHQ7CiAgaWYgKHhfIC0gYSAvIGIgPCBjIC8gZCAtIHhfKSB7CiAgICByZXN1bHQgPSB4XyA9PT0geCA/IFthLCBiXSA6IFtiLCBhXTsKICB9IGVsc2UgewogICAgcmVzdWx0ID0geF8gPT09IHggPyBbYywgZF0gOiBbZCwgY107CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KZnVuY3Rpb24gZmxvb3JUb0RpdmlkZSh4LCBkaXYpIHsKICByZXR1cm4geCAtIHggJSBkaXY7Cn0KZnVuY3Rpb24gZ2V0UGFnZVNpemVJbmNoZXMoewogIHZpZXcsCiAgdXNlclVuaXQsCiAgcm90YXRlCn0pIHsKICBjb25zdCBbeDEsIHkxLCB4MiwgeTJdID0gdmlldzsKICBjb25zdCBjaGFuZ2VPcmllbnRhdGlvbiA9IHJvdGF0ZSAlIDE4MCAhPT0gMDsKICBjb25zdCB3aWR0aCA9ICh4MiAtIHgxKSAvIDcyICogdXNlclVuaXQ7CiAgY29uc3QgaGVpZ2h0ID0gKHkyIC0geTEpIC8gNzIgKiB1c2VyVW5pdDsKICByZXR1cm4gewogICAgd2lkdGg6IGNoYW5nZU9yaWVudGF0aW9uID8gaGVpZ2h0IDogd2lkdGgsCiAgICBoZWlnaHQ6IGNoYW5nZU9yaWVudGF0aW9uID8gd2lkdGggOiBoZWlnaHQKICB9Owp9CmZ1bmN0aW9uIGJhY2t0cmFja0JlZm9yZUFsbFZpc2libGVFbGVtZW50cyhpbmRleCwgdmlld3MsIHRvcCkgewogIGlmIChpbmRleCA8IDIpIHsKICAgIHJldHVybiBpbmRleDsKICB9CiAgbGV0IGVsdCA9IHZpZXdzW2luZGV4XS5kaXY7CiAgbGV0IHBhZ2VUb3AgPSBlbHQub2Zmc2V0VG9wICsgZWx0LmNsaWVudFRvcDsKICBpZiAocGFnZVRvcCA+PSB0b3ApIHsKICAgIGVsdCA9IHZpZXdzW2luZGV4IC0gMV0uZGl2OwogICAgcGFnZVRvcCA9IGVsdC5vZmZzZXRUb3AgKyBlbHQuY2xpZW50VG9wOwogIH0KICBmb3IgKGxldCBpID0gaW5kZXggLSAyOyBpID49IDA7IC0taSkgewogICAgZWx0ID0gdmlld3NbaV0uZGl2OwogICAgaWYgKGVsdC5vZmZzZXRUb3AgKyBlbHQuY2xpZW50VG9wICsgZWx0LmNsaWVudEhlaWdodCA8PSBwYWdlVG9wKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgaW5kZXggPSBpOwogIH0KICByZXR1cm4gaW5kZXg7Cn0KZnVuY3Rpb24gZ2V0VmlzaWJsZUVsZW1lbnRzKHsKICBzY3JvbGxFbCwKICB2aWV3cywKICBzb3J0QnlWaXNpYmlsaXR5ID0gZmFsc2UsCiAgaG9yaXpvbnRhbCA9IGZhbHNlLAogIHJ0bCA9IGZhbHNlCn0pIHsKICBjb25zdCB0b3AgPSBzY3JvbGxFbC5zY3JvbGxUb3AsCiAgICBib3R0b20gPSB0b3AgKyBzY3JvbGxFbC5jbGllbnRIZWlnaHQ7CiAgY29uc3QgbGVmdCA9IHNjcm9sbEVsLnNjcm9sbExlZnQsCiAgICByaWdodCA9IGxlZnQgKyBzY3JvbGxFbC5jbGllbnRXaWR0aDsKICBmdW5jdGlvbiBpc0VsZW1lbnRCb3R0b21BZnRlclZpZXdUb3AodmlldykgewogICAgY29uc3QgZWxlbWVudCA9IHZpZXcuZGl2OwogICAgY29uc3QgZWxlbWVudEJvdHRvbSA9IGVsZW1lbnQub2Zmc2V0VG9wICsgZWxlbWVudC5jbGllbnRUb3AgKyBlbGVtZW50LmNsaWVudEhlaWdodDsKICAgIHJldHVybiBlbGVtZW50Qm90dG9tID4gdG9wOwogIH0KICBmdW5jdGlvbiBpc0VsZW1lbnROZXh0QWZ0ZXJWaWV3SG9yaXpvbnRhbGx5KHZpZXcpIHsKICAgIGNvbnN0IGVsZW1lbnQgPSB2aWV3LmRpdjsKICAgIGNvbnN0IGVsZW1lbnRMZWZ0ID0gZWxlbWVudC5vZmZzZXRMZWZ0ICsgZWxlbWVudC5jbGllbnRMZWZ0OwogICAgY29uc3QgZWxlbWVudFJpZ2h0ID0gZWxlbWVudExlZnQgKyBlbGVtZW50LmNsaWVudFdpZHRoOwogICAgcmV0dXJuIHJ0bCA/IGVsZW1lbnRMZWZ0IDwgcmlnaHQgOiBlbGVtZW50UmlnaHQgPiBsZWZ0OwogIH0KICBjb25zdCB2aXNpYmxlID0gW10sCiAgICBpZHMgPSBuZXcgU2V0KCksCiAgICBudW1WaWV3cyA9IHZpZXdzLmxlbmd0aDsKICBsZXQgZmlyc3RWaXNpYmxlRWxlbWVudEluZCA9IGJpbmFyeVNlYXJjaEZpcnN0SXRlbSh2aWV3cywgaG9yaXpvbnRhbCA/IGlzRWxlbWVudE5leHRBZnRlclZpZXdIb3Jpem9udGFsbHkgOiBpc0VsZW1lbnRCb3R0b21BZnRlclZpZXdUb3ApOwogIGlmIChmaXJzdFZpc2libGVFbGVtZW50SW5kID4gMCAmJiBmaXJzdFZpc2libGVFbGVtZW50SW5kIDwgbnVtVmlld3MgJiYgIWhvcml6b250YWwpIHsKICAgIGZpcnN0VmlzaWJsZUVsZW1lbnRJbmQgPSBiYWNrdHJhY2tCZWZvcmVBbGxWaXNpYmxlRWxlbWVudHMoZmlyc3RWaXNpYmxlRWxlbWVudEluZCwgdmlld3MsIHRvcCk7CiAgfQogIGxldCBsYXN0RWRnZSA9IGhvcml6b250YWwgPyByaWdodCA6IC0xOwogIGZvciAobGV0IGkgPSBmaXJzdFZpc2libGVFbGVtZW50SW5kOyBpIDwgbnVtVmlld3M7IGkrKykgewogICAgY29uc3QgdmlldyA9IHZpZXdzW2ldLAogICAgICBlbGVtZW50ID0gdmlldy5kaXY7CiAgICBjb25zdCBjdXJyZW50V2lkdGggPSBlbGVtZW50Lm9mZnNldExlZnQgKyBlbGVtZW50LmNsaWVudExlZnQ7CiAgICBjb25zdCBjdXJyZW50SGVpZ2h0ID0gZWxlbWVudC5vZmZzZXRUb3AgKyBlbGVtZW50LmNsaWVudFRvcDsKICAgIGNvbnN0IHZpZXdXaWR0aCA9IGVsZW1lbnQuY2xpZW50V2lkdGgsCiAgICAgIHZpZXdIZWlnaHQgPSBlbGVtZW50LmNsaWVudEhlaWdodDsKICAgIGNvbnN0IHZpZXdSaWdodCA9IGN1cnJlbnRXaWR0aCArIHZpZXdXaWR0aDsKICAgIGNvbnN0IHZpZXdCb3R0b20gPSBjdXJyZW50SGVpZ2h0ICsgdmlld0hlaWdodDsKICAgIGlmIChsYXN0RWRnZSA9PT0gLTEpIHsKICAgICAgaWYgKHZpZXdCb3R0b20gPj0gYm90dG9tKSB7CiAgICAgICAgbGFzdEVkZ2UgPSB2aWV3Qm90dG9tOwogICAgICB9CiAgICB9IGVsc2UgaWYgKChob3Jpem9udGFsID8gY3VycmVudFdpZHRoIDogY3VycmVudEhlaWdodCkgPiBsYXN0RWRnZSkgewogICAgICBicmVhazsKICAgIH0KICAgIGlmICh2aWV3Qm90dG9tIDw9IHRvcCB8fCBjdXJyZW50SGVpZ2h0ID49IGJvdHRvbSB8fCB2aWV3UmlnaHQgPD0gbGVmdCB8fCBjdXJyZW50V2lkdGggPj0gcmlnaHQpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBtaW5ZID0gTWF0aC5tYXgoMCwgdG9wIC0gY3VycmVudEhlaWdodCk7CiAgICBjb25zdCBtaW5YID0gTWF0aC5tYXgoMCwgbGVmdCAtIGN1cnJlbnRXaWR0aCk7CiAgICBjb25zdCBoaWRkZW5IZWlnaHQgPSBtaW5ZICsgTWF0aC5tYXgoMCwgdmlld0JvdHRvbSAtIGJvdHRvbSk7CiAgICBjb25zdCBoaWRkZW5XaWR0aCA9IG1pblggKyBNYXRoLm1heCgwLCB2aWV3UmlnaHQgLSByaWdodCk7CiAgICBjb25zdCBmcmFjdGlvbkhlaWdodCA9ICh2aWV3SGVpZ2h0IC0gaGlkZGVuSGVpZ2h0KSAvIHZpZXdIZWlnaHQsCiAgICAgIGZyYWN0aW9uV2lkdGggPSAodmlld1dpZHRoIC0gaGlkZGVuV2lkdGgpIC8gdmlld1dpZHRoOwogICAgY29uc3QgcGVyY2VudCA9IGZyYWN0aW9uSGVpZ2h0ICogZnJhY3Rpb25XaWR0aCAqIDEwMCB8IDA7CiAgICB2aXNpYmxlLnB1c2goewogICAgICBpZDogdmlldy5pZCwKICAgICAgeDogY3VycmVudFdpZHRoLAogICAgICB5OiBjdXJyZW50SGVpZ2h0LAogICAgICB2aXNpYmxlQXJlYTogcGVyY2VudCA9PT0gMTAwID8gbnVsbCA6IHsKICAgICAgICBtaW5YLAogICAgICAgIG1pblksCiAgICAgICAgbWF4WDogTWF0aC5taW4odmlld1JpZ2h0LCByaWdodCkgLSBjdXJyZW50V2lkdGgsCiAgICAgICAgbWF4WTogTWF0aC5taW4odmlld0JvdHRvbSwgYm90dG9tKSAtIGN1cnJlbnRIZWlnaHQKICAgICAgfSwKICAgICAgdmlldywKICAgICAgcGVyY2VudCwKICAgICAgd2lkdGhQZXJjZW50OiBmcmFjdGlvbldpZHRoICogMTAwIHwgMAogICAgfSk7CiAgICBpZHMuYWRkKHZpZXcuaWQpOwogIH0KICBjb25zdCBmaXJzdCA9IHZpc2libGVbMF0sCiAgICBsYXN0ID0gdmlzaWJsZS5hdCgtMSk7CiAgaWYgKHNvcnRCeVZpc2liaWxpdHkpIHsKICAgIHZpc2libGUuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICBjb25zdCBwYyA9IGEucGVyY2VudCAtIGIucGVyY2VudDsKICAgICAgaWYgKE1hdGguYWJzKHBjKSA+IDAuMDAxKSB7CiAgICAgICAgcmV0dXJuIC1wYzsKICAgICAgfQogICAgICByZXR1cm4gYS5pZCAtIGIuaWQ7CiAgICB9KTsKICB9CiAgcmV0dXJuIHsKICAgIGZpcnN0LAogICAgbGFzdCwKICAgIHZpZXdzOiB2aXNpYmxlLAogICAgaWRzCiAgfTsKfQpmdW5jdGlvbiBub3JtYWxpemVXaGVlbEV2ZW50RGlyZWN0aW9uKGV2dCkgewogIGxldCBkZWx0YSA9IE1hdGguaHlwb3QoZXZ0LmRlbHRhWCwgZXZ0LmRlbHRhWSk7CiAgY29uc3QgYW5nbGUgPSBNYXRoLmF0YW4yKGV2dC5kZWx0YVksIGV2dC5kZWx0YVgpOwogIGlmICgtMC4yNSAqIE1hdGguUEkgPCBhbmdsZSAmJiBhbmdsZSA8IDAuNzUgKiBNYXRoLlBJKSB7CiAgICBkZWx0YSA9IC1kZWx0YTsKICB9CiAgcmV0dXJuIGRlbHRhOwp9CmZ1bmN0aW9uIG5vcm1hbGl6ZVdoZWVsRXZlbnREZWx0YShldnQpIHsKICBjb25zdCBkZWx0YU1vZGUgPSBldnQuZGVsdGFNb2RlOwogIGxldCBkZWx0YSA9IG5vcm1hbGl6ZVdoZWVsRXZlbnREaXJlY3Rpb24oZXZ0KTsKICBjb25zdCBNT1VTRV9QSVhFTFNfUEVSX0xJTkUgPSAzMDsKICBjb25zdCBNT1VTRV9MSU5FU19QRVJfUEFHRSA9IDMwOwogIGlmIChkZWx0YU1vZGUgPT09IFdoZWVsRXZlbnQuRE9NX0RFTFRBX1BJWEVMKSB7CiAgICBkZWx0YSAvPSBNT1VTRV9QSVhFTFNfUEVSX0xJTkUgKiBNT1VTRV9MSU5FU19QRVJfUEFHRTsKICB9IGVsc2UgaWYgKGRlbHRhTW9kZSA9PT0gV2hlZWxFdmVudC5ET01fREVMVEFfTElORSkgewogICAgZGVsdGEgLz0gTU9VU0VfTElORVNfUEVSX1BBR0U7CiAgfQogIHJldHVybiBkZWx0YTsKfQpmdW5jdGlvbiBpc1ZhbGlkUm90YXRpb24oYW5nbGUpIHsKICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcihhbmdsZSkgJiYgYW5nbGUgJSA5MCA9PT0gMDsKfQpmdW5jdGlvbiBpc1ZhbGlkU2Nyb2xsTW9kZShtb2RlKSB7CiAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIobW9kZSkgJiYgT2JqZWN0LnZhbHVlcyhTY3JvbGxNb2RlKS5pbmNsdWRlcyhtb2RlKSAmJiBtb2RlICE9PSBTY3JvbGxNb2RlLlVOS05PV047Cn0KZnVuY3Rpb24gaXNWYWxpZFNwcmVhZE1vZGUobW9kZSkgewogIHJldHVybiBOdW1iZXIuaXNJbnRlZ2VyKG1vZGUpICYmIE9iamVjdC52YWx1ZXMoU3ByZWFkTW9kZSkuaW5jbHVkZXMobW9kZSkgJiYgbW9kZSAhPT0gU3ByZWFkTW9kZS5VTktOT1dOOwp9CmZ1bmN0aW9uIGlzUG9ydHJhaXRPcmllbnRhdGlvbihzaXplKSB7CiAgcmV0dXJuIHNpemUud2lkdGggPD0gc2l6ZS5oZWlnaHQ7Cn0KY29uc3QgYW5pbWF0aW9uU3RhcnRlZCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShyZXNvbHZlKTsKfSk7CmNvbnN0IGRvY1N0eWxlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlOwpjbGFzcyBQcm9ncmVzc0JhciB7CiAgI2NsYXNzTGlzdCA9IG51bGw7CiAgI2Rpc2FibGVBdXRvRmV0Y2hUaW1lb3V0ID0gbnVsbDsKICAjcGVyY2VudCA9IDA7CiAgI3N0eWxlID0gbnVsbDsKICAjdmlzaWJsZSA9IHRydWU7CiAgY29uc3RydWN0b3IoYmFyKSB7CiAgICB0aGlzLiNjbGFzc0xpc3QgPSBiYXIuY2xhc3NMaXN0OwogICAgdGhpcy4jc3R5bGUgPSBiYXIuc3R5bGU7CiAgfQogIGdldCBwZXJjZW50KCkgewogICAgcmV0dXJuIHRoaXMuI3BlcmNlbnQ7CiAgfQogIHNldCBwZXJjZW50KHZhbCkgewogICAgdGhpcy4jcGVyY2VudCA9IE1hdGhDbGFtcCh2YWwsIDAsIDEwMCk7CiAgICBpZiAoaXNOYU4odmFsKSkgewogICAgICB0aGlzLiNjbGFzc0xpc3QuYWRkKCJpbmRldGVybWluYXRlIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2NsYXNzTGlzdC5yZW1vdmUoImluZGV0ZXJtaW5hdGUiKTsKICAgIHRoaXMuI3N0eWxlLnNldFByb3BlcnR5KCItLXByb2dyZXNzQmFyLXBlcmNlbnQiLCBgJHt0aGlzLiNwZXJjZW50fSVgKTsKICB9CiAgc2V0V2lkdGgodmlld2VyKSB7CiAgICBpZiAoIXZpZXdlcikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjb250YWluZXIgPSB2aWV3ZXIucGFyZW50Tm9kZTsKICAgIGNvbnN0IHNjcm9sbGJhcldpZHRoID0gY29udGFpbmVyLm9mZnNldFdpZHRoIC0gdmlld2VyLm9mZnNldFdpZHRoOwogICAgaWYgKHNjcm9sbGJhcldpZHRoID4gMCkgewogICAgICB0aGlzLiNzdHlsZS5zZXRQcm9wZXJ0eSgiLS1wcm9ncmVzc0Jhci1lbmQtb2Zmc2V0IiwgYCR7c2Nyb2xsYmFyV2lkdGh9cHhgKTsKICAgIH0KICB9CiAgc2V0RGlzYWJsZUF1dG9GZXRjaChkZWxheSA9IDUwMDApIHsKICAgIGlmICh0aGlzLiNwZXJjZW50ID09PSAxMDAgfHwgaXNOYU4odGhpcy4jcGVyY2VudCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuI2Rpc2FibGVBdXRvRmV0Y2hUaW1lb3V0KSB7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLiNkaXNhYmxlQXV0b0ZldGNoVGltZW91dCk7CiAgICB9CiAgICB0aGlzLnNob3coKTsKICAgIHRoaXMuI2Rpc2FibGVBdXRvRmV0Y2hUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHRoaXMuI2Rpc2FibGVBdXRvRmV0Y2hUaW1lb3V0ID0gbnVsbDsKICAgICAgdGhpcy5oaWRlKCk7CiAgICB9LCBkZWxheSk7CiAgfQogIGhpZGUoKSB7CiAgICBpZiAoIXRoaXMuI3Zpc2libGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jdmlzaWJsZSA9IGZhbHNlOwogICAgdGhpcy4jY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgfQogIHNob3coKSB7CiAgICBpZiAodGhpcy4jdmlzaWJsZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiN2aXNpYmxlID0gdHJ1ZTsKICAgIHRoaXMuI2NsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOwogIH0KfQpmdW5jdGlvbiBnZXRBY3RpdmVPckZvY3VzZWRFbGVtZW50KCkgewogIGxldCBjdXJSb290ID0gZG9jdW1lbnQ7CiAgbGV0IGN1ckFjdGl2ZU9yRm9jdXNlZCA9IGN1clJvb3QuYWN0aXZlRWxlbWVudCB8fCBjdXJSb290LnF1ZXJ5U2VsZWN0b3IoIjpmb2N1cyIpOwogIHdoaWxlIChjdXJBY3RpdmVPckZvY3VzZWQ/LnNoYWRvd1Jvb3QpIHsKICAgIGN1clJvb3QgPSBjdXJBY3RpdmVPckZvY3VzZWQuc2hhZG93Um9vdDsKICAgIGN1ckFjdGl2ZU9yRm9jdXNlZCA9IGN1clJvb3QuYWN0aXZlRWxlbWVudCB8fCBjdXJSb290LnF1ZXJ5U2VsZWN0b3IoIjpmb2N1cyIpOwogIH0KICByZXR1cm4gY3VyQWN0aXZlT3JGb2N1c2VkOwp9CmZ1bmN0aW9uIGFwaVBhZ2VMYXlvdXRUb1ZpZXdlck1vZGVzKGxheW91dCkgewogIGxldCBzY3JvbGxNb2RlID0gU2Nyb2xsTW9kZS5WRVJUSUNBTCwKICAgIHNwcmVhZE1vZGUgPSBTcHJlYWRNb2RlLk5PTkU7CiAgc3dpdGNoIChsYXlvdXQpIHsKICAgIGNhc2UgIlNpbmdsZVBhZ2UiOgogICAgICBzY3JvbGxNb2RlID0gU2Nyb2xsTW9kZS5QQUdFOwogICAgICBicmVhazsKICAgIGNhc2UgIk9uZUNvbHVtbiI6CiAgICAgIGJyZWFrOwogICAgY2FzZSAiVHdvUGFnZUxlZnQiOgogICAgICBzY3JvbGxNb2RlID0gU2Nyb2xsTW9kZS5QQUdFOwogICAgY2FzZSAiVHdvQ29sdW1uTGVmdCI6CiAgICAgIHNwcmVhZE1vZGUgPSBTcHJlYWRNb2RlLk9ERDsKICAgICAgYnJlYWs7CiAgICBjYXNlICJUd29QYWdlUmlnaHQiOgogICAgICBzY3JvbGxNb2RlID0gU2Nyb2xsTW9kZS5QQUdFOwogICAgY2FzZSAiVHdvQ29sdW1uUmlnaHQiOgogICAgICBzcHJlYWRNb2RlID0gU3ByZWFkTW9kZS5FVkVOOwogICAgICBicmVhazsKICB9CiAgcmV0dXJuIHsKICAgIHNjcm9sbE1vZGUsCiAgICBzcHJlYWRNb2RlCiAgfTsKfQpmdW5jdGlvbiBhcGlQYWdlTW9kZVRvU2lkZWJhclZpZXcobW9kZSkgewogIHN3aXRjaCAobW9kZSkgewogICAgY2FzZSAiVXNlTm9uZSI6CiAgICAgIHJldHVybiBTaWRlYmFyVmlldy5OT05FOwogICAgY2FzZSAiVXNlVGh1bWJzIjoKICAgICAgcmV0dXJuIFNpZGViYXJWaWV3LlRIVU1CUzsKICAgIGNhc2UgIlVzZU91dGxpbmVzIjoKICAgICAgcmV0dXJuIFNpZGViYXJWaWV3Lk9VVExJTkU7CiAgICBjYXNlICJVc2VBdHRhY2htZW50cyI6CiAgICAgIHJldHVybiBTaWRlYmFyVmlldy5BVFRBQ0hNRU5UUzsKICAgIGNhc2UgIlVzZU9DIjoKICAgICAgcmV0dXJuIFNpZGViYXJWaWV3LkxBWUVSUzsKICB9CiAgcmV0dXJuIFNpZGViYXJWaWV3Lk5PTkU7Cn0KZnVuY3Rpb24gdG9nZ2xlQ2hlY2tlZEJ0bihidXR0b24sIHRvZ2dsZSwgdmlldyA9IG51bGwpIHsKICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgidG9nZ2xlZCIsIHRvZ2dsZSk7CiAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1jaGVja2VkIiwgdG9nZ2xlKTsKICB2aWV3Py5jbGFzc0xpc3QudG9nZ2xlKCJoaWRkZW4iLCAhdG9nZ2xlKTsKfQpmdW5jdGlvbiB0b2dnbGVFeHBhbmRlZEJ0bihidXR0b24sIHRvZ2dsZSwgdmlldyA9IG51bGwpIHsKICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgidG9nZ2xlZCIsIHRvZ2dsZSk7CiAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsIHRvZ2dsZSk7CiAgdmlldz8uY2xhc3NMaXN0LnRvZ2dsZSgiaGlkZGVuIiwgIXRvZ2dsZSk7Cn0KY29uc3QgY2FsY1JvdW5kID0gZnVuY3Rpb24gKCkgewogIGNvbnN0IGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICBlLnN0eWxlLndpZHRoID0gInJvdW5kKGRvd24sIGNhbGMoMS42NjY2NjY2NjY2NjY2NjY1ICogNzkycHgpLCAxcHgpIjsKICByZXR1cm4gZS5zdHlsZS53aWR0aCA9PT0gImNhbGMoMTMyMHB4KSIgPyBNYXRoLmZyb3VuZCA6IHggPT4geDsKfSgpOwoKOy8vIC4vd2ViL2FwcF9vcHRpb25zLmpzCnsKICB2YXIgY29tcGF0UGFyYW1zID0gbmV3IE1hcCgpOwogIGNvbnN0IHsKICAgIG1heFRvdWNoUG9pbnRzLAogICAgcGxhdGZvcm0sCiAgICB1c2VyQWdlbnQKICB9ID0gbmF2aWdhdG9yOwogIGNvbnN0IGlzQW5kcm9pZCA9IC9BbmRyb2lkLy50ZXN0KHVzZXJBZ2VudCk7CiAgY29uc3QgaXNJT1MgPSAvXGIoaVBhZHxpUGhvbmV8aVBvZCkoPz07KS8udGVzdCh1c2VyQWdlbnQpIHx8IHBsYXRmb3JtID09PSAiTWFjSW50ZWwiICYmIG1heFRvdWNoUG9pbnRzID4gMTsKICAoZnVuY3Rpb24gKCkgewogICAgaWYgKGlzSU9TIHx8IGlzQW5kcm9pZCkgewogICAgICBjb21wYXRQYXJhbXMuc2V0KCJtYXhDYW52YXNQaXhlbHMiLCA1MjQyODgwKTsKICAgIH0KICB9KSgpOwogIChmdW5jdGlvbiAoKSB7CiAgICBpZiAoaXNBbmRyb2lkKSB7CiAgICAgIGNvbXBhdFBhcmFtcy5zZXQoInVzZVN5c3RlbUZvbnRzIiwgZmFsc2UpOwogICAgfQogIH0pKCk7Cn0KY29uc3QgT3B0aW9uS2luZCA9IHsKICBCUk9XU0VSOiAweDAxLAogIFZJRVdFUjogMHgwMiwKICBBUEk6IDB4MDQsCiAgV09SS0VSOiAweDA4LAogIEVWRU5UX0RJU1BBVENIOiAweDEwLAogIFBSRUZFUkVOQ0U6IDB4ODAKfTsKY29uc3QgVHlwZSA9IHsKICBCT09MRUFOOiAweDAxLAogIE5VTUJFUjogMHgwMiwKICBPQkpFQ1Q6IDB4MDQsCiAgU1RSSU5HOiAweDA4LAogIFVOREVGSU5FRDogMHgxMAp9Owpjb25zdCBkZWZhdWx0T3B0aW9ucyA9IHsKICBhbGxvd2VkR2xvYmFsRXZlbnRzOiB7CiAgICB2YWx1ZTogbnVsbCwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQlJPV1NFUgogIH0sCiAgY2FudmFzTWF4QXJlYUluQnl0ZXM6IHsKICAgIHZhbHVlOiAtMSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQlJPV1NFUiArIE9wdGlvbktpbmQuQVBJCiAgfSwKICBpc0luQXV0b21hdGlvbjogewogICAgdmFsdWU6IGZhbHNlLAogICAga2luZDogT3B0aW9uS2luZC5CUk9XU0VSCiAgfSwKICBsb2NhbGVQcm9wZXJ0aWVzOiB7CiAgICB2YWx1ZTogewogICAgICBsYW5nOiBuYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgImVuLVVTIgogICAgfSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQlJPV1NFUgogIH0sCiAgbWF4Q2FudmFzRGltOiB7CiAgICB2YWx1ZTogMzI3NjcsCiAgICBraW5kOiBPcHRpb25LaW5kLkJST1dTRVIgKyBPcHRpb25LaW5kLlZJRVdFUgogIH0sCiAgbmltYnVzRGF0YVN0cjogewogICAgdmFsdWU6ICIiLAogICAga2luZDogT3B0aW9uS2luZC5CUk9XU0VSCiAgfSwKICBzdXBwb3J0c0NhcmV0QnJvd3NpbmdNb2RlOiB7CiAgICB2YWx1ZTogZmFsc2UsCiAgICBraW5kOiBPcHRpb25LaW5kLkJST1dTRVIKICB9LAogIHN1cHBvcnRzRG9jdW1lbnRGb250czogewogICAgdmFsdWU6IHRydWUsCiAgICBraW5kOiBPcHRpb25LaW5kLkJST1dTRVIKICB9LAogIHN1cHBvcnRzSW50ZWdyYXRlZEZpbmQ6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQlJPV1NFUgogIH0sCiAgc3VwcG9ydHNNb3VzZVdoZWVsWm9vbUN0cmxLZXk6IHsKICAgIHZhbHVlOiB0cnVlLAogICAga2luZDogT3B0aW9uS2luZC5CUk9XU0VSCiAgfSwKICBzdXBwb3J0c01vdXNlV2hlZWxab29tTWV0YUtleTogewogICAgdmFsdWU6IHRydWUsCiAgICBraW5kOiBPcHRpb25LaW5kLkJST1dTRVIKICB9LAogIHN1cHBvcnRzUGluY2hUb1pvb206IHsKICAgIHZhbHVlOiB0cnVlLAogICAga2luZDogT3B0aW9uS2luZC5CUk9XU0VSCiAgfSwKICBzdXBwb3J0c1ByaW50aW5nOiB7CiAgICB2YWx1ZTogdHJ1ZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQlJPV1NFUgogIH0sCiAgdG9vbGJhckRlbnNpdHk6IHsKICAgIHZhbHVlOiAwLAogICAga2luZDogT3B0aW9uS2luZC5CUk9XU0VSICsgT3B0aW9uS2luZC5FVkVOVF9ESVNQQVRDSAogIH0sCiAgYWx0VGV4dExlYXJuTW9yZVVybDogewogICAgdmFsdWU6ICIiLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIgKyBPcHRpb25LaW5kLlBSRUZFUkVOQ0UKICB9LAogIGFubm90YXRpb25FZGl0b3JNb2RlOiB7CiAgICB2YWx1ZTogMCwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBhbm5vdGF0aW9uTW9kZTogewogICAgdmFsdWU6IDIsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgY2FwQ2FudmFzQXJlYUZhY3RvcjogewogICAgdmFsdWU6IDIwMCwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBjdXJzb3JUb29sT25Mb2FkOiB7CiAgICB2YWx1ZTogMCwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBkZWJ1Z2dlclNyYzogewogICAgdmFsdWU6ICIuL2RlYnVnZ2VyLm1qcyIsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUgogIH0sCiAgZGVmYXVsdFpvb21EZWxheTogewogICAgdmFsdWU6IDQwMCwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBkZWZhdWx0Wm9vbVZhbHVlOiB7CiAgICB2YWx1ZTogIiIsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgZGlzYWJsZUhpc3Rvcnk6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSCiAgfSwKICBkaXNhYmxlUGFnZUxhYmVsczogewogICAgdmFsdWU6IGZhbHNlLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIgKyBPcHRpb25LaW5kLlBSRUZFUkVOQ0UKICB9LAogIGVuYWJsZUFsdFRleHQ6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBlbmFibGVBbHRUZXh0TW9kZWxEb3dubG9hZDogewogICAgdmFsdWU6IHRydWUsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRSArIE9wdGlvbktpbmQuRVZFTlRfRElTUEFUQ0gKICB9LAogIGVuYWJsZUF1dG9MaW5raW5nOiB7CiAgICB2YWx1ZTogdHJ1ZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBlbmFibGVEZXRhaWxDYW52YXM6IHsKICAgIHZhbHVlOiB0cnVlLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIKICB9LAogIGVuYWJsZUd1ZXNzQWx0VGV4dDogewogICAgdmFsdWU6IHRydWUsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRSArIE9wdGlvbktpbmQuRVZFTlRfRElTUEFUQ0gKICB9LAogIGVuYWJsZUhpZ2hsaWdodEZsb2F0aW5nQnV0dG9uOiB7CiAgICB2YWx1ZTogZmFsc2UsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgZW5hYmxlTmV3QWx0VGV4dFdoZW5BZGRpbmdJbWFnZTogewogICAgdmFsdWU6IHRydWUsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgZW5hYmxlUGVybWlzc2lvbnM6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBlbmFibGVQcmludEF1dG9Sb3RhdGU6IHsKICAgIHZhbHVlOiB0cnVlLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIgKyBPcHRpb25LaW5kLlBSRUZFUkVOQ0UKICB9LAogIGVuYWJsZVNjcmlwdGluZzogewogICAgdmFsdWU6IHRydWUsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgZW5hYmxlU2lnbmF0dXJlRWRpdG9yOiB7CiAgICB2YWx1ZTogZmFsc2UsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgZW5hYmxlVXBkYXRlZEFkZEltYWdlOiB7CiAgICB2YWx1ZTogZmFsc2UsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgZXh0ZXJuYWxMaW5rUmVsOiB7CiAgICB2YWx1ZTogIm5vb3BlbmVyIG5vcmVmZXJyZXIgbm9mb2xsb3ciLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIKICB9LAogIGV4dGVybmFsTGlua1RhcmdldDogewogICAgdmFsdWU6IDAsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgaGlnaGxpZ2h0RWRpdG9yQ29sb3JzOiB7CiAgICB2YWx1ZTogInllbGxvdz0jRkZGRjk4LGdyZWVuPSM1M0ZGQkMsYmx1ZT0jODBFQkZGLHBpbms9I0ZGQ0JFNixyZWQ9I0ZGNEY1RiIsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgaGlzdG9yeVVwZGF0ZVVybDogewogICAgdmFsdWU6IGZhbHNlLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIgKyBPcHRpb25LaW5kLlBSRUZFUkVOQ0UKICB9LAogIGlnbm9yZURlc3RpbmF0aW9uWm9vbTogewogICAgdmFsdWU6IGZhbHNlLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIgKyBPcHRpb25LaW5kLlBSRUZFUkVOQ0UKICB9LAogIGltYWdlUmVzb3VyY2VzUGF0aDogewogICAgdmFsdWU6ICIuL2ltYWdlcy8iLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIKICB9LAogIG1heENhbnZhc1BpeGVsczogewogICAgdmFsdWU6IDIgKiogMjUsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUgogIH0sCiAgbWluRHVyYXRpb25Ub1VwZGF0ZUNhbnZhczogewogICAgdmFsdWU6IDUwMCwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSCiAgfSwKICBmb3JjZVBhZ2VDb2xvcnM6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBwYWdlQ29sb3JzQmFja2dyb3VuZDogewogICAgdmFsdWU6ICJDYW52YXMiLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIgKyBPcHRpb25LaW5kLlBSRUZFUkVOQ0UKICB9LAogIHBhZ2VDb2xvcnNGb3JlZ3JvdW5kOiB7CiAgICB2YWx1ZTogIkNhbnZhc1RleHQiLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIgKyBPcHRpb25LaW5kLlBSRUZFUkVOQ0UKICB9LAogIHBkZkJ1Z0VuYWJsZWQ6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBwcmludFJlc29sdXRpb246IHsKICAgIHZhbHVlOiAxNTAsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUgogIH0sCiAgc2lkZWJhclZpZXdPbkxvYWQ6IHsKICAgIHZhbHVlOiAtMSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBzY3JvbGxNb2RlT25Mb2FkOiB7CiAgICB2YWx1ZTogLTEsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUiArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgc3ByZWFkTW9kZU9uTG9hZDogewogICAgdmFsdWU6IC0xLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIgKyBPcHRpb25LaW5kLlBSRUZFUkVOQ0UKICB9LAogIHRleHRMYXllck1vZGU6IHsKICAgIHZhbHVlOiAxLAogICAga2luZDogT3B0aW9uS2luZC5WSUVXRVIgKyBPcHRpb25LaW5kLlBSRUZFUkVOQ0UKICB9LAogIHZpZXdlckNzc1RoZW1lOiB7CiAgICB2YWx1ZTogMCwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICB2aWV3T25Mb2FkOiB7CiAgICB2YWx1ZTogMCwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBjTWFwUGFja2VkOiB7CiAgICB2YWx1ZTogdHJ1ZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQVBJCiAgfSwKICBjTWFwVXJsOiB7CiAgICB2YWx1ZTogIi4uL3dlYi9jbWFwcy8iLAogICAga2luZDogT3B0aW9uS2luZC5BUEkKICB9LAogIGRpc2FibGVBdXRvRmV0Y2g6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQVBJICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBkaXNhYmxlRm9udEZhY2U6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQVBJICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBkaXNhYmxlUmFuZ2U6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQVBJICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBkaXNhYmxlU3RyZWFtOiB7CiAgICB2YWx1ZTogZmFsc2UsCiAgICBraW5kOiBPcHRpb25LaW5kLkFQSSArIE9wdGlvbktpbmQuUFJFRkVSRU5DRQogIH0sCiAgZG9jQmFzZVVybDogewogICAgdmFsdWU6ICIiLAogICAga2luZDogT3B0aW9uS2luZC5BUEkKICB9LAogIGVuYWJsZUhXQTogewogICAgdmFsdWU6IHRydWUsCiAgICBraW5kOiBPcHRpb25LaW5kLkFQSSArIE9wdGlvbktpbmQuVklFV0VSICsgT3B0aW9uS2luZC5QUkVGRVJFTkNFCiAgfSwKICBlbmFibGVYZmE6IHsKICAgIHZhbHVlOiB0cnVlLAogICAga2luZDogT3B0aW9uS2luZC5BUEkgKyBPcHRpb25LaW5kLlBSRUZFUkVOQ0UKICB9LAogIGZvbnRFeHRyYVByb3BlcnRpZXM6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQVBJCiAgfSwKICBpY2NVcmw6IHsKICAgIHZhbHVlOiAiLi4vd2ViL2ljY3MvIiwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQVBJCiAgfSwKICBpc0V2YWxTdXBwb3J0ZWQ6IHsKICAgIHZhbHVlOiB0cnVlLAogICAga2luZDogT3B0aW9uS2luZC5BUEkKICB9LAogIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOiB7CiAgICB2YWx1ZTogdHJ1ZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQVBJCiAgfSwKICBtYXhJbWFnZVNpemU6IHsKICAgIHZhbHVlOiAtMSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQVBJCiAgfSwKICBwZGZCdWc6IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQVBJCiAgfSwKICBzdGFuZGFyZEZvbnREYXRhVXJsOiB7CiAgICB2YWx1ZTogIi4uL3dlYi9zdGFuZGFyZF9mb250cy8iLAogICAga2luZDogT3B0aW9uS2luZC5BUEkKICB9LAogIHVzZVN5c3RlbUZvbnRzOiB7CiAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAga2luZDogT3B0aW9uS2luZC5BUEksCiAgICB0eXBlOiBUeXBlLkJPT0xFQU4gKyBUeXBlLlVOREVGSU5FRAogIH0sCiAgdmVyYm9zaXR5OiB7CiAgICB2YWx1ZTogMSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuQVBJCiAgfSwKICB3YXNtVXJsOiB7CiAgICB2YWx1ZTogIi4uL3dlYi93YXNtLyIsCiAgICBraW5kOiBPcHRpb25LaW5kLkFQSQogIH0sCiAgd29ya2VyUG9ydDogewogICAgdmFsdWU6IG51bGwsCiAgICBraW5kOiBPcHRpb25LaW5kLldPUktFUgogIH0sCiAgd29ya2VyU3JjOiB7CiAgICB2YWx1ZTogIi4uL2J1aWxkL3BkZi53b3JrZXIubWpzIiwKICAgIGtpbmQ6IE9wdGlvbktpbmQuV09SS0VSCiAgfQp9Owp7CiAgZGVmYXVsdE9wdGlvbnMuZGVmYXVsdFVybCA9IHsKICAgIHZhbHVlOiAiY29tcHJlc3NlZC50cmFjZW1vbmtleS1wbGRpLTA5LnBkZiIsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUgogIH07CiAgZGVmYXVsdE9wdGlvbnMuc2FuZGJveEJ1bmRsZVNyYyA9IHsKICAgIHZhbHVlOiAiLi4vYnVpbGQvcGRmLnNhbmRib3gubWpzIiwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSCiAgfTsKICBkZWZhdWx0T3B0aW9ucy5lbmFibGVGYWtlTUxNYW5hZ2VyID0gewogICAgdmFsdWU6IHRydWUsCiAgICBraW5kOiBPcHRpb25LaW5kLlZJRVdFUgogIH07Cn0KewogIGRlZmF1bHRPcHRpb25zLmRpc2FibGVQcmVmZXJlbmNlcyA9IHsKICAgIHZhbHVlOiBmYWxzZSwKICAgIGtpbmQ6IE9wdGlvbktpbmQuVklFV0VSCiAgfTsKfQpjbGFzcyBBcHBPcHRpb25zIHsKICBzdGF0aWMgZXZlbnRCdXM7CiAgc3RhdGljICNvcHRzID0gbmV3IE1hcCgpOwogIHN0YXRpYyB7CiAgICBmb3IgKGNvbnN0IG5hbWUgaW4gZGVmYXVsdE9wdGlvbnMpIHsKICAgICAgdGhpcy4jb3B0cy5zZXQobmFtZSwgZGVmYXVsdE9wdGlvbnNbbmFtZV0udmFsdWUpOwogICAgfQogICAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVdIG9mIGNvbXBhdFBhcmFtcykgewogICAgICB0aGlzLiNvcHRzLnNldChuYW1lLCB2YWx1ZSk7CiAgICB9CiAgICB0aGlzLl9oYXNJbnZva2VkU2V0ID0gZmFsc2U7CiAgICB0aGlzLl9jaGVja0Rpc2FibGVQcmVmZXJlbmNlcyA9ICgpID0+IHsKICAgICAgaWYgKHRoaXMuZ2V0KCJkaXNhYmxlUHJlZmVyZW5jZXMiKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmICh0aGlzLl9oYXNJbnZva2VkU2V0KSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUaGUgUHJlZmVyZW5jZXMgbWF5IG92ZXJyaWRlIG1hbnVhbGx5IHNldCBBcHBPcHRpb25zOyAiICsgJ3BsZWFzZSB1c2UgdGhlICJkaXNhYmxlUHJlZmVyZW5jZXMiLW9wdGlvbiB0byBwcmV2ZW50IHRoYXQuJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKICB9CiAgc3RhdGljIGdldChuYW1lKSB7CiAgICByZXR1cm4gdGhpcy4jb3B0cy5nZXQobmFtZSk7CiAgfQogIHN0YXRpYyBnZXRBbGwoa2luZCA9IG51bGwsIGRlZmF1bHRPbmx5ID0gZmFsc2UpIHsKICAgIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgZm9yIChjb25zdCBuYW1lIGluIGRlZmF1bHRPcHRpb25zKSB7CiAgICAgIGNvbnN0IGRlZmF1bHRPcHQgPSBkZWZhdWx0T3B0aW9uc1tuYW1lXTsKICAgICAgaWYgKGtpbmQgJiYgIShraW5kICYgZGVmYXVsdE9wdC5raW5kKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIG9wdGlvbnNbbmFtZV0gPSAhZGVmYXVsdE9ubHkgPyB0aGlzLiNvcHRzLmdldChuYW1lKSA6IGRlZmF1bHRPcHQudmFsdWU7CiAgICB9CiAgICByZXR1cm4gb3B0aW9uczsKICB9CiAgc3RhdGljIHNldChuYW1lLCB2YWx1ZSkgewogICAgdGhpcy5zZXRBbGwoewogICAgICBbbmFtZV06IHZhbHVlCiAgICB9KTsKICB9CiAgc3RhdGljIHNldEFsbChvcHRpb25zLCBwcmVmcyA9IGZhbHNlKSB7CiAgICB0aGlzLl9oYXNJbnZva2VkU2V0IHx8PSB0cnVlOwogICAgbGV0IGV2ZW50czsKICAgIGZvciAoY29uc3QgbmFtZSBpbiBvcHRpb25zKSB7CiAgICAgIGNvbnN0IGRlZmF1bHRPcHQgPSBkZWZhdWx0T3B0aW9uc1tuYW1lXSwKICAgICAgICB1c2VyT3B0ID0gb3B0aW9uc1tuYW1lXTsKICAgICAgaWYgKCFkZWZhdWx0T3B0IHx8ICEodHlwZW9mIHVzZXJPcHQgPT09IHR5cGVvZiBkZWZhdWx0T3B0LnZhbHVlIHx8IFR5cGVbKHR5cGVvZiB1c2VyT3B0KS50b1VwcGVyQ2FzZSgpXSAmIGRlZmF1bHRPcHQudHlwZSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAga2luZAogICAgICB9ID0gZGVmYXVsdE9wdDsKICAgICAgaWYgKHByZWZzICYmICEoa2luZCAmIE9wdGlvbktpbmQuQlJPV1NFUiB8fCBraW5kICYgT3B0aW9uS2luZC5QUkVGRVJFTkNFKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICh0aGlzLmV2ZW50QnVzICYmIGtpbmQgJiBPcHRpb25LaW5kLkVWRU5UX0RJU1BBVENIKSB7CiAgICAgICAgKGV2ZW50cyB8fD0gbmV3IE1hcCgpKS5zZXQobmFtZSwgdXNlck9wdCk7CiAgICAgIH0KICAgICAgdGhpcy4jb3B0cy5zZXQobmFtZSwgdXNlck9wdCk7CiAgICB9CiAgICBpZiAoZXZlbnRzKSB7CiAgICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiBldmVudHMpIHsKICAgICAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKG5hbWUudG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgICAgdmFsdWUKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0KfQoKOy8vIC4vd2ViL3BkZl9saW5rX3NlcnZpY2UuanMKCgpjb25zdCBERUZBVUxUX0xJTktfUkVMID0gIm5vb3BlbmVyIG5vcmVmZXJyZXIgbm9mb2xsb3ciOwpjb25zdCBMaW5rVGFyZ2V0ID0gewogIE5PTkU6IDAsCiAgU0VMRjogMSwKICBCTEFOSzogMiwKICBQQVJFTlQ6IDMsCiAgVE9QOiA0Cn07CmNsYXNzIFBERkxpbmtTZXJ2aWNlIHsKICBleHRlcm5hbExpbmtFbmFibGVkID0gdHJ1ZTsKICBjb25zdHJ1Y3Rvcih7CiAgICBldmVudEJ1cywKICAgIGV4dGVybmFsTGlua1RhcmdldCA9IG51bGwsCiAgICBleHRlcm5hbExpbmtSZWwgPSBudWxsLAogICAgaWdub3JlRGVzdGluYXRpb25ab29tID0gZmFsc2UKICB9ID0ge30pIHsKICAgIHRoaXMuZXZlbnRCdXMgPSBldmVudEJ1czsKICAgIHRoaXMuZXh0ZXJuYWxMaW5rVGFyZ2V0ID0gZXh0ZXJuYWxMaW5rVGFyZ2V0OwogICAgdGhpcy5leHRlcm5hbExpbmtSZWwgPSBleHRlcm5hbExpbmtSZWw7CiAgICB0aGlzLl9pZ25vcmVEZXN0aW5hdGlvblpvb20gPSBpZ25vcmVEZXN0aW5hdGlvblpvb207CiAgICB0aGlzLmJhc2VVcmwgPSBudWxsOwogICAgdGhpcy5wZGZEb2N1bWVudCA9IG51bGw7CiAgICB0aGlzLnBkZlZpZXdlciA9IG51bGw7CiAgICB0aGlzLnBkZkhpc3RvcnkgPSBudWxsOwogIH0KICBzZXREb2N1bWVudChwZGZEb2N1bWVudCwgYmFzZVVybCA9IG51bGwpIHsKICAgIHRoaXMuYmFzZVVybCA9IGJhc2VVcmw7CiAgICB0aGlzLnBkZkRvY3VtZW50ID0gcGRmRG9jdW1lbnQ7CiAgfQogIHNldFZpZXdlcihwZGZWaWV3ZXIpIHsKICAgIHRoaXMucGRmVmlld2VyID0gcGRmVmlld2VyOwogIH0KICBzZXRIaXN0b3J5KHBkZkhpc3RvcnkpIHsKICAgIHRoaXMucGRmSGlzdG9yeSA9IHBkZkhpc3Rvcnk7CiAgfQogIGdldCBwYWdlc0NvdW50KCkgewogICAgcmV0dXJuIHRoaXMucGRmRG9jdW1lbnQgPyB0aGlzLnBkZkRvY3VtZW50Lm51bVBhZ2VzIDogMDsKICB9CiAgZ2V0IHBhZ2UoKSB7CiAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudCA/IHRoaXMucGRmVmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyIDogMTsKICB9CiAgc2V0IHBhZ2UodmFsdWUpIHsKICAgIGlmICh0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHRoaXMucGRmVmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyID0gdmFsdWU7CiAgICB9CiAgfQogIGdldCByb3RhdGlvbigpIHsKICAgIHJldHVybiB0aGlzLnBkZkRvY3VtZW50ID8gdGhpcy5wZGZWaWV3ZXIucGFnZXNSb3RhdGlvbiA6IDA7CiAgfQogIHNldCByb3RhdGlvbih2YWx1ZSkgewogICAgaWYgKHRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgdGhpcy5wZGZWaWV3ZXIucGFnZXNSb3RhdGlvbiA9IHZhbHVlOwogICAgfQogIH0KICBnZXQgaXNJblByZXNlbnRhdGlvbk1vZGUoKSB7CiAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudCA/IHRoaXMucGRmVmlld2VyLmlzSW5QcmVzZW50YXRpb25Nb2RlIDogZmFsc2U7CiAgfQogIGFzeW5jIGdvVG9EZXN0aW5hdGlvbihkZXN0KSB7CiAgICBpZiAoIXRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IG5hbWVkRGVzdCwgZXhwbGljaXREZXN0LCBwYWdlTnVtYmVyOwogICAgaWYgKHR5cGVvZiBkZXN0ID09PSAic3RyaW5nIikgewogICAgICBuYW1lZERlc3QgPSBkZXN0OwogICAgICBleHBsaWNpdERlc3QgPSBhd2FpdCB0aGlzLnBkZkRvY3VtZW50LmdldERlc3RpbmF0aW9uKGRlc3QpOwogICAgfSBlbHNlIHsKICAgICAgbmFtZWREZXN0ID0gbnVsbDsKICAgICAgZXhwbGljaXREZXN0ID0gYXdhaXQgZGVzdDsKICAgIH0KICAgIGlmICghQXJyYXkuaXNBcnJheShleHBsaWNpdERlc3QpKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoYGdvVG9EZXN0aW5hdGlvbjogIiR7ZXhwbGljaXREZXN0fSIgaXMgbm90IGEgdmFsaWQgZGVzdGluYXRpb24gYXJyYXksIGZvciBkZXN0PSIke2Rlc3R9Ii5gKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgW2Rlc3RSZWZdID0gZXhwbGljaXREZXN0OwogICAgaWYgKGRlc3RSZWYgJiYgdHlwZW9mIGRlc3RSZWYgPT09ICJvYmplY3QiKSB7CiAgICAgIHBhZ2VOdW1iZXIgPSB0aGlzLnBkZkRvY3VtZW50LmNhY2hlZFBhZ2VOdW1iZXIoZGVzdFJlZik7CiAgICAgIGlmICghcGFnZU51bWJlcikgewogICAgICAgIHRyeSB7CiAgICAgICAgICBwYWdlTnVtYmVyID0gKGF3YWl0IHRoaXMucGRmRG9jdW1lbnQuZ2V0UGFnZUluZGV4KGRlc3RSZWYpKSArIDE7CiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGBnb1RvRGVzdGluYXRpb246ICIke2Rlc3RSZWZ9IiBpcyBub3QgYSB2YWxpZCBwYWdlIHJlZmVyZW5jZSwgZm9yIGRlc3Q9IiR7ZGVzdH0iLmApOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGRlc3RSZWYpKSB7CiAgICAgIHBhZ2VOdW1iZXIgPSBkZXN0UmVmICsgMTsKICAgIH0KICAgIGlmICghcGFnZU51bWJlciB8fCBwYWdlTnVtYmVyIDwgMSB8fCBwYWdlTnVtYmVyID4gdGhpcy5wYWdlc0NvdW50KSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoYGdvVG9EZXN0aW5hdGlvbjogIiR7cGFnZU51bWJlcn0iIGlzIG5vdCBhIHZhbGlkIHBhZ2UgbnVtYmVyLCBmb3IgZGVzdD0iJHtkZXN0fSIuYCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLnBkZkhpc3RvcnkpIHsKICAgICAgdGhpcy5wZGZIaXN0b3J5LnB1c2hDdXJyZW50UG9zaXRpb24oKTsKICAgICAgdGhpcy5wZGZIaXN0b3J5LnB1c2goewogICAgICAgIG5hbWVkRGVzdCwKICAgICAgICBleHBsaWNpdERlc3QsCiAgICAgICAgcGFnZU51bWJlcgogICAgICB9KTsKICAgIH0KICAgIHRoaXMucGRmVmlld2VyLnNjcm9sbFBhZ2VJbnRvVmlldyh7CiAgICAgIHBhZ2VOdW1iZXIsCiAgICAgIGRlc3RBcnJheTogZXhwbGljaXREZXN0LAogICAgICBpZ25vcmVEZXN0aW5hdGlvblpvb206IHRoaXMuX2lnbm9yZURlc3RpbmF0aW9uWm9vbQogICAgfSk7CiAgfQogIGdvVG9QYWdlKHZhbCkgewogICAgaWYgKCF0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBhZ2VOdW1iZXIgPSB0eXBlb2YgdmFsID09PSAic3RyaW5nIiAmJiB0aGlzLnBkZlZpZXdlci5wYWdlTGFiZWxUb1BhZ2VOdW1iZXIodmFsKSB8fCB2YWwgfCAwOwogICAgaWYgKCEoTnVtYmVyLmlzSW50ZWdlcihwYWdlTnVtYmVyKSAmJiBwYWdlTnVtYmVyID4gMCAmJiBwYWdlTnVtYmVyIDw9IHRoaXMucGFnZXNDb3VudCkpIHsKICAgICAgY29uc29sZS5lcnJvcihgUERGTGlua1NlcnZpY2UuZ29Ub1BhZ2U6ICIke3ZhbH0iIGlzIG5vdCBhIHZhbGlkIHBhZ2UuYCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLnBkZkhpc3RvcnkpIHsKICAgICAgdGhpcy5wZGZIaXN0b3J5LnB1c2hDdXJyZW50UG9zaXRpb24oKTsKICAgICAgdGhpcy5wZGZIaXN0b3J5LnB1c2hQYWdlKHBhZ2VOdW1iZXIpOwogICAgfQogICAgdGhpcy5wZGZWaWV3ZXIuc2Nyb2xsUGFnZUludG9WaWV3KHsKICAgICAgcGFnZU51bWJlcgogICAgfSk7CiAgfQogIGFkZExpbmtBdHRyaWJ1dGVzKGxpbmssIHVybCwgbmV3V2luZG93ID0gZmFsc2UpIHsKICAgIGlmICghdXJsIHx8IHR5cGVvZiB1cmwgIT09ICJzdHJpbmciKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignQSB2YWxpZCAidXJsIiBwYXJhbWV0ZXIgbXVzdCBwcm92aWRlZC4nKTsKICAgIH0KICAgIGNvbnN0IHRhcmdldCA9IG5ld1dpbmRvdyA/IExpbmtUYXJnZXQuQkxBTksgOiB0aGlzLmV4dGVybmFsTGlua1RhcmdldCwKICAgICAgcmVsID0gdGhpcy5leHRlcm5hbExpbmtSZWw7CiAgICBpZiAodGhpcy5leHRlcm5hbExpbmtFbmFibGVkKSB7CiAgICAgIGxpbmsuaHJlZiA9IGxpbmsudGl0bGUgPSB1cmw7CiAgICB9IGVsc2UgewogICAgICBsaW5rLmhyZWYgPSAiIjsKICAgICAgbGluay50aXRsZSA9IGBEaXNhYmxlZDogJHt1cmx9YDsKICAgICAgbGluay5vbmNsaWNrID0gKCkgPT4gZmFsc2U7CiAgICB9CiAgICBsZXQgdGFyZ2V0U3RyID0gIiI7CiAgICBzd2l0Y2ggKHRhcmdldCkgewogICAgICBjYXNlIExpbmtUYXJnZXQuTk9ORToKICAgICAgICBicmVhazsKICAgICAgY2FzZSBMaW5rVGFyZ2V0LlNFTEY6CiAgICAgICAgdGFyZ2V0U3RyID0gIl9zZWxmIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBMaW5rVGFyZ2V0LkJMQU5LOgogICAgICAgIHRhcmdldFN0ciA9ICJfYmxhbmsiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIExpbmtUYXJnZXQuUEFSRU5UOgogICAgICAgIHRhcmdldFN0ciA9ICJfcGFyZW50IjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBMaW5rVGFyZ2V0LlRPUDoKICAgICAgICB0YXJnZXRTdHIgPSAiX3RvcCI7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBsaW5rLnRhcmdldCA9IHRhcmdldFN0cjsKICAgIGxpbmsucmVsID0gdHlwZW9mIHJlbCA9PT0gInN0cmluZyIgPyByZWwgOiBERUZBVUxUX0xJTktfUkVMOwogIH0KICBnZXREZXN0aW5hdGlvbkhhc2goZGVzdCkgewogICAgaWYgKHR5cGVvZiBkZXN0ID09PSAic3RyaW5nIikgewogICAgICBpZiAoZGVzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QW5jaG9yVXJsKCIjIiArIGVzY2FwZShkZXN0KSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShkZXN0KSkgewogICAgICBjb25zdCBzdHIgPSBKU09OLnN0cmluZ2lmeShkZXN0KTsKICAgICAgaWYgKHN0ci5sZW5ndGggPiAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QW5jaG9yVXJsKCIjIiArIGVzY2FwZShzdHIpKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMuZ2V0QW5jaG9yVXJsKCIiKTsKICB9CiAgZ2V0QW5jaG9yVXJsKGFuY2hvcikgewogICAgcmV0dXJuIHRoaXMuYmFzZVVybCA/IHRoaXMuYmFzZVVybCArIGFuY2hvciA6IGFuY2hvcjsKICB9CiAgc2V0SGFzaChoYXNoKSB7CiAgICBpZiAoIXRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IHBhZ2VOdW1iZXIsIGRlc3Q7CiAgICBpZiAoaGFzaC5pbmNsdWRlcygiPSIpKSB7CiAgICAgIGNvbnN0IHBhcmFtcyA9IHBhcnNlUXVlcnlTdHJpbmcoaGFzaCk7CiAgICAgIGlmIChwYXJhbXMuaGFzKCJzZWFyY2giKSkgewogICAgICAgIGNvbnN0IHF1ZXJ5ID0gcGFyYW1zLmdldCgic2VhcmNoIikucmVwbGFjZUFsbCgnIicsICIiKSwKICAgICAgICAgIHBocmFzZSA9IHBhcmFtcy5nZXQoInBocmFzZSIpID09PSAidHJ1ZSI7CiAgICAgICAgdGhpcy5ldmVudEJ1cy5kaXNwYXRjaCgiZmluZGZyb211cmxoYXNoIiwgewogICAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgICAgcXVlcnk6IHBocmFzZSA/IHF1ZXJ5IDogcXVlcnkubWF0Y2goL1xTKy9nKQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChwYXJhbXMuaGFzKCJwYWdlIikpIHsKICAgICAgICBwYWdlTnVtYmVyID0gcGFyYW1zLmdldCgicGFnZSIpIHwgMCB8fCAxOwogICAgICB9CiAgICAgIGlmIChwYXJhbXMuaGFzKCJ6b29tIikpIHsKICAgICAgICBjb25zdCB6b29tQXJncyA9IHBhcmFtcy5nZXQoInpvb20iKS5zcGxpdCgiLCIpOwogICAgICAgIGNvbnN0IHpvb21BcmcgPSB6b29tQXJnc1swXTsKICAgICAgICBjb25zdCB6b29tQXJnTnVtYmVyID0gcGFyc2VGbG9hdCh6b29tQXJnKTsKICAgICAgICBpZiAoIXpvb21BcmcuaW5jbHVkZXMoIkZpdCIpKSB7CiAgICAgICAgICBkZXN0ID0gW251bGwsIHsKICAgICAgICAgICAgbmFtZTogIlhZWiIKICAgICAgICAgIH0sIHpvb21BcmdzLmxlbmd0aCA+IDEgPyB6b29tQXJnc1sxXSB8IDAgOiBudWxsLCB6b29tQXJncy5sZW5ndGggPiAyID8gem9vbUFyZ3NbMl0gfCAwIDogbnVsbCwgem9vbUFyZ051bWJlciA/IHpvb21BcmdOdW1iZXIgLyAxMDAgOiB6b29tQXJnXTsKICAgICAgICB9IGVsc2UgaWYgKHpvb21BcmcgPT09ICJGaXQiIHx8IHpvb21BcmcgPT09ICJGaXRCIikgewogICAgICAgICAgZGVzdCA9IFtudWxsLCB7CiAgICAgICAgICAgIG5hbWU6IHpvb21BcmcKICAgICAgICAgIH1dOwogICAgICAgIH0gZWxzZSBpZiAoem9vbUFyZyA9PT0gIkZpdEgiIHx8IHpvb21BcmcgPT09ICJGaXRCSCIgfHwgem9vbUFyZyA9PT0gIkZpdFYiIHx8IHpvb21BcmcgPT09ICJGaXRCViIpIHsKICAgICAgICAgIGRlc3QgPSBbbnVsbCwgewogICAgICAgICAgICBuYW1lOiB6b29tQXJnCiAgICAgICAgICB9LCB6b29tQXJncy5sZW5ndGggPiAxID8gem9vbUFyZ3NbMV0gfCAwIDogbnVsbF07CiAgICAgICAgfSBlbHNlIGlmICh6b29tQXJnID09PSAiRml0UiIpIHsKICAgICAgICAgIGlmICh6b29tQXJncy5sZW5ndGggIT09IDUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignUERGTGlua1NlcnZpY2Uuc2V0SGFzaDogTm90IGVub3VnaCBwYXJhbWV0ZXJzIGZvciAiRml0UiIuJyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkZXN0ID0gW251bGwsIHsKICAgICAgICAgICAgICBuYW1lOiB6b29tQXJnCiAgICAgICAgICAgIH0sIHpvb21BcmdzWzFdIHwgMCwgem9vbUFyZ3NbMl0gfCAwLCB6b29tQXJnc1szXSB8IDAsIHpvb21BcmdzWzRdIHwgMF07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFBERkxpbmtTZXJ2aWNlLnNldEhhc2g6ICIke3pvb21Bcmd9IiBpcyBub3QgYSB2YWxpZCB6b29tIHZhbHVlLmApOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoZGVzdCkgewogICAgICAgIHRoaXMucGRmVmlld2VyLnNjcm9sbFBhZ2VJbnRvVmlldyh7CiAgICAgICAgICBwYWdlTnVtYmVyOiBwYWdlTnVtYmVyIHx8IHRoaXMucGFnZSwKICAgICAgICAgIGRlc3RBcnJheTogZGVzdCwKICAgICAgICAgIGFsbG93TmVnYXRpdmVPZmZzZXQ6IHRydWUKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChwYWdlTnVtYmVyKSB7CiAgICAgICAgdGhpcy5wYWdlID0gcGFnZU51bWJlcjsKICAgICAgfQogICAgICBpZiAocGFyYW1zLmhhcygicGFnZW1vZGUiKSkgewogICAgICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goInBhZ2Vtb2RlIiwgewogICAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgICAgbW9kZTogcGFyYW1zLmdldCgicGFnZW1vZGUiKQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChwYXJhbXMuaGFzKCJuYW1lZGRlc3QiKSkgewogICAgICAgIHRoaXMuZ29Ub0Rlc3RpbmF0aW9uKHBhcmFtcy5nZXQoIm5hbWVkZGVzdCIpKTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBkZXN0ID0gdW5lc2NhcGUoaGFzaCk7CiAgICB0cnkgewogICAgICBkZXN0ID0gSlNPTi5wYXJzZShkZXN0KTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRlc3QpKSB7CiAgICAgICAgZGVzdCA9IGRlc3QudG9TdHJpbmcoKTsKICAgICAgfQogICAgfSBjYXRjaCB7fQogICAgaWYgKHR5cGVvZiBkZXN0ID09PSAic3RyaW5nIiB8fCBpc1ZhbGlkRXhwbGljaXREZXN0KGRlc3QpKSB7CiAgICAgIHRoaXMuZ29Ub0Rlc3RpbmF0aW9uKGRlc3QpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zb2xlLmVycm9yKGBQREZMaW5rU2VydmljZS5zZXRIYXNoOiAiJHt1bmVzY2FwZShoYXNoKX0iIGlzIG5vdCBhIHZhbGlkIGRlc3RpbmF0aW9uLmApOwogIH0KICBleGVjdXRlTmFtZWRBY3Rpb24oYWN0aW9uKSB7CiAgICBpZiAoIXRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgY2FzZSAiR29CYWNrIjoKICAgICAgICB0aGlzLnBkZkhpc3Rvcnk/LmJhY2soKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiR29Gb3J3YXJkIjoKICAgICAgICB0aGlzLnBkZkhpc3Rvcnk/LmZvcndhcmQoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiTmV4dFBhZ2UiOgogICAgICAgIHRoaXMucGRmVmlld2VyLm5leHRQYWdlKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIlByZXZQYWdlIjoKICAgICAgICB0aGlzLnBkZlZpZXdlci5wcmV2aW91c1BhZ2UoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiTGFzdFBhZ2UiOgogICAgICAgIHRoaXMucGFnZSA9IHRoaXMucGFnZXNDb3VudDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiRmlyc3RQYWdlIjoKICAgICAgICB0aGlzLnBhZ2UgPSAxOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGJyZWFrOwogICAgfQogICAgdGhpcy5ldmVudEJ1cy5kaXNwYXRjaCgibmFtZWRhY3Rpb24iLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgYWN0aW9uCiAgICB9KTsKICB9CiAgYXN5bmMgZXhlY3V0ZVNldE9DR1N0YXRlKGFjdGlvbikgewogICAgaWYgKCF0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBkZkRvY3VtZW50ID0gdGhpcy5wZGZEb2N1bWVudCwKICAgICAgb3B0aW9uYWxDb250ZW50Q29uZmlnID0gYXdhaXQgdGhpcy5wZGZWaWV3ZXIub3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZTsKICAgIGlmIChwZGZEb2N1bWVudCAhPT0gdGhpcy5wZGZEb2N1bWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBvcHRpb25hbENvbnRlbnRDb25maWcuc2V0T0NHU3RhdGUoYWN0aW9uKTsKICAgIHRoaXMucGRmVmlld2VyLm9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UgPSBQcm9taXNlLnJlc29sdmUob3B0aW9uYWxDb250ZW50Q29uZmlnKTsKICB9Cn0KY2xhc3MgU2ltcGxlTGlua1NlcnZpY2UgZXh0ZW5kcyBQREZMaW5rU2VydmljZSB7CiAgc2V0RG9jdW1lbnQocGRmRG9jdW1lbnQsIGJhc2VVcmwgPSBudWxsKSB7fQp9Cgo7Ly8gLi93ZWIvZXZlbnRfdXRpbHMuanMKY29uc3QgV2FpdE9uVHlwZSA9IHsKICBFVkVOVDogImV2ZW50IiwKICBUSU1FT1VUOiAidGltZW91dCIKfTsKYXN5bmMgZnVuY3Rpb24gd2FpdE9uRXZlbnRPclRpbWVvdXQoewogIHRhcmdldCwKICBuYW1lLAogIGRlbGF5ID0gMAp9KSB7CiAgaWYgKHR5cGVvZiB0YXJnZXQgIT09ICJvYmplY3QiIHx8ICEobmFtZSAmJiB0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIpIHx8ICEoTnVtYmVyLmlzSW50ZWdlcihkZWxheSkgJiYgZGVsYXkgPj0gMCkpIHsKICAgIHRocm93IG5ldyBFcnJvcigid2FpdE9uRXZlbnRPclRpbWVvdXQgLSBpbnZhbGlkIHBhcmFtZXRlcnMuIik7CiAgfQogIGNvbnN0IHsKICAgIHByb21pc2UsCiAgICByZXNvbHZlCiAgfSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogIGNvbnN0IGFjID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogIGZ1bmN0aW9uIGhhbmRsZXIodHlwZSkgewogICAgYWMuYWJvcnQoKTsKICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgIHJlc29sdmUodHlwZSk7CiAgfQogIGNvbnN0IGV2dE1ldGhvZCA9IHRhcmdldCBpbnN0YW5jZW9mIEV2ZW50QnVzID8gIl9vbiIgOiAiYWRkRXZlbnRMaXN0ZW5lciI7CiAgdGFyZ2V0W2V2dE1ldGhvZF0obmFtZSwgaGFuZGxlci5iaW5kKG51bGwsIFdhaXRPblR5cGUuRVZFTlQpLCB7CiAgICBzaWduYWw6IGFjLnNpZ25hbAogIH0pOwogIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KGhhbmRsZXIuYmluZChudWxsLCBXYWl0T25UeXBlLlRJTUVPVVQpLCBkZWxheSk7CiAgcmV0dXJuIHByb21pc2U7Cn0KY2xhc3MgRXZlbnRCdXMgewogICNsaXN0ZW5lcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIG9uKGV2ZW50TmFtZSwgbGlzdGVuZXIsIG9wdGlvbnMgPSBudWxsKSB7CiAgICB0aGlzLl9vbihldmVudE5hbWUsIGxpc3RlbmVyLCB7CiAgICAgIGV4dGVybmFsOiB0cnVlLAogICAgICBvbmNlOiBvcHRpb25zPy5vbmNlLAogICAgICBzaWduYWw6IG9wdGlvbnM/LnNpZ25hbAogICAgfSk7CiAgfQogIG9mZihldmVudE5hbWUsIGxpc3RlbmVyLCBvcHRpb25zID0gbnVsbCkgewogICAgdGhpcy5fb2ZmKGV2ZW50TmFtZSwgbGlzdGVuZXIpOwogIH0KICBkaXNwYXRjaChldmVudE5hbWUsIGRhdGEpIHsKICAgIGNvbnN0IGV2ZW50TGlzdGVuZXJzID0gdGhpcy4jbGlzdGVuZXJzW2V2ZW50TmFtZV07CiAgICBpZiAoIWV2ZW50TGlzdGVuZXJzIHx8IGV2ZW50TGlzdGVuZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgZXh0ZXJuYWxMaXN0ZW5lcnM7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgbGlzdGVuZXIsCiAgICAgIGV4dGVybmFsLAogICAgICBvbmNlCiAgICB9IG9mIGV2ZW50TGlzdGVuZXJzLnNsaWNlKDApKSB7CiAgICAgIGlmIChvbmNlKSB7CiAgICAgICAgdGhpcy5fb2ZmKGV2ZW50TmFtZSwgbGlzdGVuZXIpOwogICAgICB9CiAgICAgIGlmIChleHRlcm5hbCkgewogICAgICAgIChleHRlcm5hbExpc3RlbmVycyB8fD0gW10pLnB1c2gobGlzdGVuZXIpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxpc3RlbmVyKGRhdGEpOwogICAgfQogICAgaWYgKGV4dGVybmFsTGlzdGVuZXJzKSB7CiAgICAgIGZvciAoY29uc3QgbGlzdGVuZXIgb2YgZXh0ZXJuYWxMaXN0ZW5lcnMpIHsKICAgICAgICBsaXN0ZW5lcihkYXRhKTsKICAgICAgfQogICAgICBleHRlcm5hbExpc3RlbmVycyA9IG51bGw7CiAgICB9CiAgfQogIF9vbihldmVudE5hbWUsIGxpc3RlbmVyLCBvcHRpb25zID0gbnVsbCkgewogICAgbGV0IHJtQWJvcnQgPSBudWxsOwogICAgaWYgKG9wdGlvbnM/LnNpZ25hbCBpbnN0YW5jZW9mIEFib3J0U2lnbmFsKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBzaWduYWwKICAgICAgfSA9IG9wdGlvbnM7CiAgICAgIGlmIChzaWduYWwuYWJvcnRlZCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkNhbm5vdCB1c2UgYW4gYGFib3J0ZWRgIHNpZ25hbC4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgb25BYm9ydCA9ICgpID0+IHRoaXMuX29mZihldmVudE5hbWUsIGxpc3RlbmVyKTsKICAgICAgcm1BYm9ydCA9ICgpID0+IHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwogICAgICBzaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvbkFib3J0KTsKICAgIH0KICAgIGNvbnN0IGV2ZW50TGlzdGVuZXJzID0gdGhpcy4jbGlzdGVuZXJzW2V2ZW50TmFtZV0gfHw9IFtdOwogICAgZXZlbnRMaXN0ZW5lcnMucHVzaCh7CiAgICAgIGxpc3RlbmVyLAogICAgICBleHRlcm5hbDogb3B0aW9ucz8uZXh0ZXJuYWwgPT09IHRydWUsCiAgICAgIG9uY2U6IG9wdGlvbnM/Lm9uY2UgPT09IHRydWUsCiAgICAgIHJtQWJvcnQKICAgIH0pOwogIH0KICBfb2ZmKGV2ZW50TmFtZSwgbGlzdGVuZXIsIG9wdGlvbnMgPSBudWxsKSB7CiAgICBjb25zdCBldmVudExpc3RlbmVycyA9IHRoaXMuI2xpc3RlbmVyc1tldmVudE5hbWVdOwogICAgaWYgKCFldmVudExpc3RlbmVycykgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBldmVudExpc3RlbmVycy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGV2dCA9IGV2ZW50TGlzdGVuZXJzW2ldOwogICAgICBpZiAoZXZ0Lmxpc3RlbmVyID09PSBsaXN0ZW5lcikgewogICAgICAgIGV2dC5ybUFib3J0Py4oKTsKICAgICAgICBldmVudExpc3RlbmVycy5zcGxpY2UoaSwgMSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgfQp9CmNsYXNzIEZpcmVmb3hFdmVudEJ1cyBleHRlbmRzIEV2ZW50QnVzIHsKICAjZXh0ZXJuYWxTZXJ2aWNlczsKICAjZ2xvYmFsRXZlbnROYW1lczsKICAjaXNJbkF1dG9tYXRpb247CiAgY29uc3RydWN0b3IoZ2xvYmFsRXZlbnROYW1lcywgZXh0ZXJuYWxTZXJ2aWNlcywgaXNJbkF1dG9tYXRpb24pIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLiNnbG9iYWxFdmVudE5hbWVzID0gZ2xvYmFsRXZlbnROYW1lczsKICAgIHRoaXMuI2V4dGVybmFsU2VydmljZXMgPSBleHRlcm5hbFNlcnZpY2VzOwogICAgdGhpcy4jaXNJbkF1dG9tYXRpb24gPSBpc0luQXV0b21hdGlvbjsKICB9CiAgZGlzcGF0Y2goZXZlbnROYW1lLCBkYXRhKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBpbXBsZW1lbnRlZDogRmlyZWZveEV2ZW50QnVzLmRpc3BhdGNoIik7CiAgfQp9Cgo7Ly8gLi93ZWIvZXh0ZXJuYWxfc2VydmljZXMuanMKY2xhc3MgQmFzZUV4dGVybmFsU2VydmljZXMgewogIHVwZGF0ZUZpbmRDb250cm9sU3RhdGUoZGF0YSkge30KICB1cGRhdGVGaW5kTWF0Y2hlc0NvdW50KGRhdGEpIHt9CiAgaW5pdFBhc3NpdmVMb2FkaW5nKCkge30KICByZXBvcnRUZWxlbWV0cnkoZGF0YSkge30KICBhc3luYyBjcmVhdGVMMTBuKCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgaW1wbGVtZW50ZWQ6IGNyZWF0ZUwxMG4iKTsKICB9CiAgY3JlYXRlU2NyaXB0aW5nKCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgaW1wbGVtZW50ZWQ6IGNyZWF0ZVNjcmlwdGluZyIpOwogIH0KICBjcmVhdGVTaWduYXR1cmVTdG9yYWdlKCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgaW1wbGVtZW50ZWQ6IGNyZWF0ZVNpZ25hdHVyZVN0b3JhZ2UiKTsKICB9CiAgdXBkYXRlRWRpdG9yU3RhdGVzKGRhdGEpIHsKICAgIHRocm93IG5ldyBFcnJvcigiTm90IGltcGxlbWVudGVkOiB1cGRhdGVFZGl0b3JTdGF0ZXMiKTsKICB9CiAgZGlzcGF0Y2hHbG9iYWxFdmVudChfZXZlbnQpIHt9Cn0KCjsvLyAuL3dlYi9wcmVmZXJlbmNlcy5qcwoKY2xhc3MgQmFzZVByZWZlcmVuY2VzIHsKICAjZGVmYXVsdHMgPSBPYmplY3QuZnJlZXplKHsKICAgIGFsdFRleHRMZWFybk1vcmVVcmw6ICIiLAogICAgYW5ub3RhdGlvbkVkaXRvck1vZGU6IDAsCiAgICBhbm5vdGF0aW9uTW9kZTogMiwKICAgIGNhcENhbnZhc0FyZWFGYWN0b3I6IDIwMCwKICAgIGN1cnNvclRvb2xPbkxvYWQ6IDAsCiAgICBkZWZhdWx0Wm9vbURlbGF5OiA0MDAsCiAgICBkZWZhdWx0Wm9vbVZhbHVlOiAiIiwKICAgIGRpc2FibGVQYWdlTGFiZWxzOiBmYWxzZSwKICAgIGVuYWJsZUFsdFRleHQ6IGZhbHNlLAogICAgZW5hYmxlQWx0VGV4dE1vZGVsRG93bmxvYWQ6IHRydWUsCiAgICBlbmFibGVBdXRvTGlua2luZzogdHJ1ZSwKICAgIGVuYWJsZUd1ZXNzQWx0VGV4dDogdHJ1ZSwKICAgIGVuYWJsZUhpZ2hsaWdodEZsb2F0aW5nQnV0dG9uOiBmYWxzZSwKICAgIGVuYWJsZU5ld0FsdFRleHRXaGVuQWRkaW5nSW1hZ2U6IHRydWUsCiAgICBlbmFibGVQZXJtaXNzaW9uczogZmFsc2UsCiAgICBlbmFibGVQcmludEF1dG9Sb3RhdGU6IHRydWUsCiAgICBlbmFibGVTY3JpcHRpbmc6IHRydWUsCiAgICBlbmFibGVTaWduYXR1cmVFZGl0b3I6IGZhbHNlLAogICAgZW5hYmxlVXBkYXRlZEFkZEltYWdlOiBmYWxzZSwKICAgIGV4dGVybmFsTGlua1RhcmdldDogMCwKICAgIGhpZ2hsaWdodEVkaXRvckNvbG9yczogInllbGxvdz0jRkZGRjk4LGdyZWVuPSM1M0ZGQkMsYmx1ZT0jODBFQkZGLHBpbms9I0ZGQ0JFNixyZWQ9I0ZGNEY1RiIsCiAgICBoaXN0b3J5VXBkYXRlVXJsOiBmYWxzZSwKICAgIGlnbm9yZURlc3RpbmF0aW9uWm9vbTogZmFsc2UsCiAgICBmb3JjZVBhZ2VDb2xvcnM6IGZhbHNlLAogICAgcGFnZUNvbG9yc0JhY2tncm91bmQ6ICJDYW52YXMiLAogICAgcGFnZUNvbG9yc0ZvcmVncm91bmQ6ICJDYW52YXNUZXh0IiwKICAgIHBkZkJ1Z0VuYWJsZWQ6IGZhbHNlLAogICAgc2lkZWJhclZpZXdPbkxvYWQ6IC0xLAogICAgc2Nyb2xsTW9kZU9uTG9hZDogLTEsCiAgICBzcHJlYWRNb2RlT25Mb2FkOiAtMSwKICAgIHRleHRMYXllck1vZGU6IDEsCiAgICB2aWV3ZXJDc3NUaGVtZTogMCwKICAgIHZpZXdPbkxvYWQ6IDAsCiAgICBkaXNhYmxlQXV0b0ZldGNoOiBmYWxzZSwKICAgIGRpc2FibGVGb250RmFjZTogZmFsc2UsCiAgICBkaXNhYmxlUmFuZ2U6IGZhbHNlLAogICAgZGlzYWJsZVN0cmVhbTogZmFsc2UsCiAgICBlbmFibGVIV0E6IHRydWUsCiAgICBlbmFibGVYZmE6IHRydWUKICB9KTsKICAjaW5pdGlhbGl6ZWRQcm9taXNlID0gbnVsbDsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuI2luaXRpYWxpemVkUHJvbWlzZSA9IHRoaXMuX3JlYWRGcm9tU3RvcmFnZSh0aGlzLiNkZWZhdWx0cykudGhlbigoewogICAgICBicm93c2VyUHJlZnMsCiAgICAgIHByZWZzCiAgICB9KSA9PiB7CiAgICAgIGlmIChBcHBPcHRpb25zLl9jaGVja0Rpc2FibGVQcmVmZXJlbmNlcygpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIEFwcE9wdGlvbnMuc2V0QWxsKHsKICAgICAgICAuLi5icm93c2VyUHJlZnMsCiAgICAgICAgLi4ucHJlZnMKICAgICAgfSwgdHJ1ZSk7CiAgICB9KTsKICB9CiAgYXN5bmMgX3dyaXRlVG9TdG9yYWdlKHByZWZPYmopIHsKICAgIHRocm93IG5ldyBFcnJvcigiTm90IGltcGxlbWVudGVkOiBfd3JpdGVUb1N0b3JhZ2UiKTsKICB9CiAgYXN5bmMgX3JlYWRGcm9tU3RvcmFnZShwcmVmT2JqKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBpbXBsZW1lbnRlZDogX3JlYWRGcm9tU3RvcmFnZSIpOwogIH0KICBhc3luYyByZXNldCgpIHsKICAgIGF3YWl0IHRoaXMuI2luaXRpYWxpemVkUHJvbWlzZTsKICAgIEFwcE9wdGlvbnMuc2V0QWxsKHRoaXMuI2RlZmF1bHRzLCB0cnVlKTsKICAgIGF3YWl0IHRoaXMuX3dyaXRlVG9TdG9yYWdlKHRoaXMuI2RlZmF1bHRzKTsKICB9CiAgYXN5bmMgc2V0KG5hbWUsIHZhbHVlKSB7CiAgICBhd2FpdCB0aGlzLiNpbml0aWFsaXplZFByb21pc2U7CiAgICBBcHBPcHRpb25zLnNldEFsbCh7CiAgICAgIFtuYW1lXTogdmFsdWUKICAgIH0sIHRydWUpOwogICAgYXdhaXQgdGhpcy5fd3JpdGVUb1N0b3JhZ2UoQXBwT3B0aW9ucy5nZXRBbGwoT3B0aW9uS2luZC5QUkVGRVJFTkNFKSk7CiAgfQogIGFzeW5jIGdldChuYW1lKSB7CiAgICBhd2FpdCB0aGlzLiNpbml0aWFsaXplZFByb21pc2U7CiAgICByZXR1cm4gQXBwT3B0aW9ucy5nZXQobmFtZSk7CiAgfQogIGdldCBpbml0aWFsaXplZFByb21pc2UoKSB7CiAgICByZXR1cm4gdGhpcy4jaW5pdGlhbGl6ZWRQcm9taXNlOwogIH0KfQoKOy8vIC4vbm9kZV9tb2R1bGVzL0BmbHVlbnQvYnVuZGxlL2VzbS90eXBlcy5qcwpjbGFzcyBGbHVlbnRUeXBlIHsKICBjb25zdHJ1Y3Rvcih2YWx1ZSkgewogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogIH0KICB2YWx1ZU9mKCkgewogICAgcmV0dXJuIHRoaXMudmFsdWU7CiAgfQp9CmNsYXNzIEZsdWVudE5vbmUgZXh0ZW5kcyBGbHVlbnRUeXBlIHsKICBjb25zdHJ1Y3Rvcih2YWx1ZSA9ICI/Pz8iKSB7CiAgICBzdXBlcih2YWx1ZSk7CiAgfQogIHRvU3RyaW5nKHNjb3BlKSB7CiAgICByZXR1cm4gYHske3RoaXMudmFsdWV9fWA7CiAgfQp9CmNsYXNzIEZsdWVudE51bWJlciBleHRlbmRzIEZsdWVudFR5cGUgewogIGNvbnN0cnVjdG9yKHZhbHVlLCBvcHRzID0ge30pIHsKICAgIHN1cGVyKHZhbHVlKTsKICAgIHRoaXMub3B0cyA9IG9wdHM7CiAgfQogIHRvU3RyaW5nKHNjb3BlKSB7CiAgICBpZiAoc2NvcGUpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBuZiA9IHNjb3BlLm1lbW9pemVJbnRsT2JqZWN0KEludGwuTnVtYmVyRm9ybWF0LCB0aGlzLm9wdHMpOwogICAgICAgIHJldHVybiBuZi5mb3JtYXQodGhpcy52YWx1ZSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIHNjb3BlLnJlcG9ydEVycm9yKGVycik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0aGlzLnZhbHVlLnRvU3RyaW5nKDEwKTsKICB9Cn0KY2xhc3MgRmx1ZW50RGF0ZVRpbWUgZXh0ZW5kcyBGbHVlbnRUeXBlIHsKICBzdGF0aWMgc3VwcG9ydHNWYWx1ZSh2YWx1ZSkgewogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIpIHJldHVybiB0cnVlOwogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgcmV0dXJuIHRydWU7CiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBGbHVlbnRUeXBlKSByZXR1cm4gRmx1ZW50RGF0ZVRpbWUuc3VwcG9ydHNWYWx1ZSh2YWx1ZS52YWx1ZU9mKCkpOwogICAgaWYgKCJUZW1wb3JhbCIgaW4gZ2xvYmFsVGhpcykgewogICAgICBjb25zdCBfVGVtcG9yYWwgPSBnbG9iYWxUaGlzLlRlbXBvcmFsOwogICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfVGVtcG9yYWwuSW5zdGFudCB8fCB2YWx1ZSBpbnN0YW5jZW9mIF9UZW1wb3JhbC5QbGFpbkRhdGVUaW1lIHx8IHZhbHVlIGluc3RhbmNlb2YgX1RlbXBvcmFsLlBsYWluRGF0ZSB8fCB2YWx1ZSBpbnN0YW5jZW9mIF9UZW1wb3JhbC5QbGFpbk1vbnRoRGF5IHx8IHZhbHVlIGluc3RhbmNlb2YgX1RlbXBvcmFsLlBsYWluVGltZSB8fCB2YWx1ZSBpbnN0YW5jZW9mIF9UZW1wb3JhbC5QbGFpblllYXJNb250aCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNvbnN0cnVjdG9yKHZhbHVlLCBvcHRzID0ge30pIHsKICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEZsdWVudERhdGVUaW1lKSB7CiAgICAgIG9wdHMgPSB7CiAgICAgICAgLi4udmFsdWUub3B0cywKICAgICAgICAuLi5vcHRzCiAgICAgIH07CiAgICAgIHZhbHVlID0gdmFsdWUudmFsdWU7CiAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgRmx1ZW50VHlwZSkgewogICAgICB2YWx1ZSA9IHZhbHVlLnZhbHVlT2YoKTsKICAgIH0KICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiICYmICJjYWxlbmRhcklkIiBpbiB2YWx1ZSAmJiBvcHRzLmNhbGVuZGFyID09PSB1bmRlZmluZWQpIHsKICAgICAgb3B0cyA9IHsKICAgICAgICAuLi5vcHRzLAogICAgICAgIGNhbGVuZGFyOiB2YWx1ZS5jYWxlbmRhcklkCiAgICAgIH07CiAgICB9CiAgICBzdXBlcih2YWx1ZSk7CiAgICB0aGlzLm9wdHMgPSBvcHRzOwogIH0KICBbU3ltYm9sLnRvUHJpbWl0aXZlXShoaW50KSB7CiAgICByZXR1cm4gaGludCA9PT0gInN0cmluZyIgPyB0aGlzLnRvU3RyaW5nKCkgOiB0aGlzLnRvTnVtYmVyKCk7CiAgfQogIHRvTnVtYmVyKCkgewogICAgY29uc3QgdmFsdWUgPSB0aGlzLnZhbHVlOwogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIpIHJldHVybiB2YWx1ZTsKICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHJldHVybiB2YWx1ZS5nZXRUaW1lKCk7CiAgICBpZiAoImVwb2NoTWlsbGlzZWNvbmRzIiBpbiB2YWx1ZSkgewogICAgICByZXR1cm4gdmFsdWUuZXBvY2hNaWxsaXNlY29uZHM7CiAgICB9CiAgICBpZiAoInRvWm9uZWREYXRlVGltZSIgaW4gdmFsdWUpIHsKICAgICAgcmV0dXJuIHZhbHVlLnRvWm9uZWREYXRlVGltZSgiVVRDIikuZXBvY2hNaWxsaXNlY29uZHM7CiAgICB9CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJVbndyYXBwaW5nIGEgbm9uLW51bWJlciB2YWx1ZSBhcyBhIG51bWJlciIpOwogIH0KICB0b1N0cmluZyhzY29wZSkgewogICAgaWYgKHNjb3BlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgZHRmID0gc2NvcGUubWVtb2l6ZUludGxPYmplY3QoSW50bC5EYXRlVGltZUZvcm1hdCwgdGhpcy5vcHRzKTsKICAgICAgICByZXR1cm4gZHRmLmZvcm1hdCh0aGlzLnZhbHVlKTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgc2NvcGUucmVwb3J0RXJyb3IoZXJyKTsKICAgICAgfQogICAgfQogICAgaWYgKHR5cGVvZiB0aGlzLnZhbHVlID09PSAibnVtYmVyIiB8fCB0aGlzLnZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICByZXR1cm4gbmV3IERhdGUodGhpcy52YWx1ZSkudG9JU09TdHJpbmcoKTsKICAgIH0KICAgIHJldHVybiB0aGlzLnZhbHVlLnRvU3RyaW5nKCk7CiAgfQp9CjsvLyAuL25vZGVfbW9kdWxlcy9AZmx1ZW50L2J1bmRsZS9lc20vcmVzb2x2ZXIuanMKCmNvbnN0IE1BWF9QTEFDRUFCTEVTID0gMTAwOwpjb25zdCBGU0kgPSAiXHUyMDY4IjsKY29uc3QgUERJID0gIlx1MjA2OSI7CmZ1bmN0aW9uIG1hdGNoKHNjb3BlLCBzZWxlY3Rvciwga2V5KSB7CiAgaWYgKGtleSA9PT0gc2VsZWN0b3IpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBpZiAoa2V5IGluc3RhbmNlb2YgRmx1ZW50TnVtYmVyICYmIHNlbGVjdG9yIGluc3RhbmNlb2YgRmx1ZW50TnVtYmVyICYmIGtleS52YWx1ZSA9PT0gc2VsZWN0b3IudmFsdWUpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBpZiAoc2VsZWN0b3IgaW5zdGFuY2VvZiBGbHVlbnROdW1iZXIgJiYgdHlwZW9mIGtleSA9PT0gInN0cmluZyIpIHsKICAgIGxldCBjYXRlZ29yeSA9IHNjb3BlLm1lbW9pemVJbnRsT2JqZWN0KEludGwuUGx1cmFsUnVsZXMsIHNlbGVjdG9yLm9wdHMpLnNlbGVjdChzZWxlY3Rvci52YWx1ZSk7CiAgICBpZiAoa2V5ID09PSBjYXRlZ29yeSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CiAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIGdldERlZmF1bHQoc2NvcGUsIHZhcmlhbnRzLCBzdGFyKSB7CiAgaWYgKHZhcmlhbnRzW3N0YXJdKSB7CiAgICByZXR1cm4gcmVzb2x2ZVBhdHRlcm4oc2NvcGUsIHZhcmlhbnRzW3N0YXJdLnZhbHVlKTsKICB9CiAgc2NvcGUucmVwb3J0RXJyb3IobmV3IFJhbmdlRXJyb3IoIk5vIGRlZmF1bHQiKSk7CiAgcmV0dXJuIG5ldyBGbHVlbnROb25lKCk7Cn0KZnVuY3Rpb24gZ2V0QXJndW1lbnRzKHNjb3BlLCBhcmdzKSB7CiAgY29uc3QgcG9zaXRpb25hbCA9IFtdOwogIGNvbnN0IG5hbWVkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBmb3IgKGNvbnN0IGFyZyBvZiBhcmdzKSB7CiAgICBpZiAoYXJnLnR5cGUgPT09ICJuYXJnIikgewogICAgICBuYW1lZFthcmcubmFtZV0gPSByZXNvbHZlRXhwcmVzc2lvbihzY29wZSwgYXJnLnZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHBvc2l0aW9uYWwucHVzaChyZXNvbHZlRXhwcmVzc2lvbihzY29wZSwgYXJnKSk7CiAgICB9CiAgfQogIHJldHVybiB7CiAgICBwb3NpdGlvbmFsLAogICAgbmFtZWQKICB9Owp9CmZ1bmN0aW9uIHJlc29sdmVFeHByZXNzaW9uKHNjb3BlLCBleHByKSB7CiAgc3dpdGNoIChleHByLnR5cGUpIHsKICAgIGNhc2UgInN0ciI6CiAgICAgIHJldHVybiBleHByLnZhbHVlOwogICAgY2FzZSAibnVtIjoKICAgICAgcmV0dXJuIG5ldyBGbHVlbnROdW1iZXIoZXhwci52YWx1ZSwgewogICAgICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogZXhwci5wcmVjaXNpb24KICAgICAgfSk7CiAgICBjYXNlICJ2YXIiOgogICAgICByZXR1cm4gcmVzb2x2ZVZhcmlhYmxlUmVmZXJlbmNlKHNjb3BlLCBleHByKTsKICAgIGNhc2UgIm1lc2ciOgogICAgICByZXR1cm4gcmVzb2x2ZU1lc3NhZ2VSZWZlcmVuY2Uoc2NvcGUsIGV4cHIpOwogICAgY2FzZSAidGVybSI6CiAgICAgIHJldHVybiByZXNvbHZlVGVybVJlZmVyZW5jZShzY29wZSwgZXhwcik7CiAgICBjYXNlICJmdW5jIjoKICAgICAgcmV0dXJuIHJlc29sdmVGdW5jdGlvblJlZmVyZW5jZShzY29wZSwgZXhwcik7CiAgICBjYXNlICJzZWxlY3QiOgogICAgICByZXR1cm4gcmVzb2x2ZVNlbGVjdEV4cHJlc3Npb24oc2NvcGUsIGV4cHIpOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIG5ldyBGbHVlbnROb25lKCk7CiAgfQp9CmZ1bmN0aW9uIHJlc29sdmVWYXJpYWJsZVJlZmVyZW5jZShzY29wZSwgewogIG5hbWUKfSkgewogIGxldCBhcmc7CiAgaWYgKHNjb3BlLnBhcmFtcykgewogICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzY29wZS5wYXJhbXMsIG5hbWUpKSB7CiAgICAgIGFyZyA9IHNjb3BlLnBhcmFtc1tuYW1lXTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBuZXcgRmx1ZW50Tm9uZShgJCR7bmFtZX1gKTsKICAgIH0KICB9IGVsc2UgaWYgKHNjb3BlLmFyZ3MgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNjb3BlLmFyZ3MsIG5hbWUpKSB7CiAgICBhcmcgPSBzY29wZS5hcmdzW25hbWVdOwogIH0gZWxzZSB7CiAgICBzY29wZS5yZXBvcnRFcnJvcihuZXcgUmVmZXJlbmNlRXJyb3IoYFVua25vd24gdmFyaWFibGU6ICQke25hbWV9YCkpOwogICAgcmV0dXJuIG5ldyBGbHVlbnROb25lKGAkJHtuYW1lfWApOwogIH0KICBpZiAoYXJnIGluc3RhbmNlb2YgRmx1ZW50VHlwZSkgewogICAgcmV0dXJuIGFyZzsKICB9CiAgc3dpdGNoICh0eXBlb2YgYXJnKSB7CiAgICBjYXNlICJzdHJpbmciOgogICAgICByZXR1cm4gYXJnOwogICAgY2FzZSAibnVtYmVyIjoKICAgICAgcmV0dXJuIG5ldyBGbHVlbnROdW1iZXIoYXJnKTsKICAgIGNhc2UgIm9iamVjdCI6CiAgICAgIGlmIChGbHVlbnREYXRlVGltZS5zdXBwb3J0c1ZhbHVlKGFyZykpIHsKICAgICAgICByZXR1cm4gbmV3IEZsdWVudERhdGVUaW1lKGFyZyk7CiAgICAgIH0KICAgIGRlZmF1bHQ6CiAgICAgIHNjb3BlLnJlcG9ydEVycm9yKG5ldyBUeXBlRXJyb3IoYFZhcmlhYmxlIHR5cGUgbm90IHN1cHBvcnRlZDogJCR7bmFtZX0sICR7dHlwZW9mIGFyZ31gKSk7CiAgICAgIHJldHVybiBuZXcgRmx1ZW50Tm9uZShgJCR7bmFtZX1gKTsKICB9Cn0KZnVuY3Rpb24gcmVzb2x2ZU1lc3NhZ2VSZWZlcmVuY2Uoc2NvcGUsIHsKICBuYW1lLAogIGF0dHIKfSkgewogIGNvbnN0IG1lc3NhZ2UgPSBzY29wZS5idW5kbGUuX21lc3NhZ2VzLmdldChuYW1lKTsKICBpZiAoIW1lc3NhZ2UpIHsKICAgIHNjb3BlLnJlcG9ydEVycm9yKG5ldyBSZWZlcmVuY2VFcnJvcihgVW5rbm93biBtZXNzYWdlOiAke25hbWV9YCkpOwogICAgcmV0dXJuIG5ldyBGbHVlbnROb25lKG5hbWUpOwogIH0KICBpZiAoYXR0cikgewogICAgY29uc3QgYXR0cmlidXRlID0gbWVzc2FnZS5hdHRyaWJ1dGVzW2F0dHJdOwogICAgaWYgKGF0dHJpYnV0ZSkgewogICAgICByZXR1cm4gcmVzb2x2ZVBhdHRlcm4oc2NvcGUsIGF0dHJpYnV0ZSk7CiAgICB9CiAgICBzY29wZS5yZXBvcnRFcnJvcihuZXcgUmVmZXJlbmNlRXJyb3IoYFVua25vd24gYXR0cmlidXRlOiAke2F0dHJ9YCkpOwogICAgcmV0dXJuIG5ldyBGbHVlbnROb25lKGAke25hbWV9LiR7YXR0cn1gKTsKICB9CiAgaWYgKG1lc3NhZ2UudmFsdWUpIHsKICAgIHJldHVybiByZXNvbHZlUGF0dGVybihzY29wZSwgbWVzc2FnZS52YWx1ZSk7CiAgfQogIHNjb3BlLnJlcG9ydEVycm9yKG5ldyBSZWZlcmVuY2VFcnJvcihgTm8gdmFsdWU6ICR7bmFtZX1gKSk7CiAgcmV0dXJuIG5ldyBGbHVlbnROb25lKG5hbWUpOwp9CmZ1bmN0aW9uIHJlc29sdmVUZXJtUmVmZXJlbmNlKHNjb3BlLCB7CiAgbmFtZSwKICBhdHRyLAogIGFyZ3MKfSkgewogIGNvbnN0IGlkID0gYC0ke25hbWV9YDsKICBjb25zdCB0ZXJtID0gc2NvcGUuYnVuZGxlLl90ZXJtcy5nZXQoaWQpOwogIGlmICghdGVybSkgewogICAgc2NvcGUucmVwb3J0RXJyb3IobmV3IFJlZmVyZW5jZUVycm9yKGBVbmtub3duIHRlcm06ICR7aWR9YCkpOwogICAgcmV0dXJuIG5ldyBGbHVlbnROb25lKGlkKTsKICB9CiAgaWYgKGF0dHIpIHsKICAgIGNvbnN0IGF0dHJpYnV0ZSA9IHRlcm0uYXR0cmlidXRlc1thdHRyXTsKICAgIGlmIChhdHRyaWJ1dGUpIHsKICAgICAgc2NvcGUucGFyYW1zID0gZ2V0QXJndW1lbnRzKHNjb3BlLCBhcmdzKS5uYW1lZDsKICAgICAgY29uc3QgcmVzb2x2ZWQgPSByZXNvbHZlUGF0dGVybihzY29wZSwgYXR0cmlidXRlKTsKICAgICAgc2NvcGUucGFyYW1zID0gbnVsbDsKICAgICAgcmV0dXJuIHJlc29sdmVkOwogICAgfQogICAgc2NvcGUucmVwb3J0RXJyb3IobmV3IFJlZmVyZW5jZUVycm9yKGBVbmtub3duIGF0dHJpYnV0ZTogJHthdHRyfWApKTsKICAgIHJldHVybiBuZXcgRmx1ZW50Tm9uZShgJHtpZH0uJHthdHRyfWApOwogIH0KICBzY29wZS5wYXJhbXMgPSBnZXRBcmd1bWVudHMoc2NvcGUsIGFyZ3MpLm5hbWVkOwogIGNvbnN0IHJlc29sdmVkID0gcmVzb2x2ZVBhdHRlcm4oc2NvcGUsIHRlcm0udmFsdWUpOwogIHNjb3BlLnBhcmFtcyA9IG51bGw7CiAgcmV0dXJuIHJlc29sdmVkOwp9CmZ1bmN0aW9uIHJlc29sdmVGdW5jdGlvblJlZmVyZW5jZShzY29wZSwgewogIG5hbWUsCiAgYXJncwp9KSB7CiAgbGV0IGZ1bmMgPSBzY29wZS5idW5kbGUuX2Z1bmN0aW9uc1tuYW1lXTsKICBpZiAoIWZ1bmMpIHsKICAgIHNjb3BlLnJlcG9ydEVycm9yKG5ldyBSZWZlcmVuY2VFcnJvcihgVW5rbm93biBmdW5jdGlvbjogJHtuYW1lfSgpYCkpOwogICAgcmV0dXJuIG5ldyBGbHVlbnROb25lKGAke25hbWV9KClgKTsKICB9CiAgaWYgKHR5cGVvZiBmdW5jICE9PSAiZnVuY3Rpb24iKSB7CiAgICBzY29wZS5yZXBvcnRFcnJvcihuZXcgVHlwZUVycm9yKGBGdW5jdGlvbiAke25hbWV9KCkgaXMgbm90IGNhbGxhYmxlYCkpOwogICAgcmV0dXJuIG5ldyBGbHVlbnROb25lKGAke25hbWV9KClgKTsKICB9CiAgdHJ5IHsKICAgIGxldCByZXNvbHZlZCA9IGdldEFyZ3VtZW50cyhzY29wZSwgYXJncyk7CiAgICByZXR1cm4gZnVuYyhyZXNvbHZlZC5wb3NpdGlvbmFsLCByZXNvbHZlZC5uYW1lZCk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBzY29wZS5yZXBvcnRFcnJvcihlcnIpOwogICAgcmV0dXJuIG5ldyBGbHVlbnROb25lKGAke25hbWV9KClgKTsKICB9Cn0KZnVuY3Rpb24gcmVzb2x2ZVNlbGVjdEV4cHJlc3Npb24oc2NvcGUsIHsKICBzZWxlY3RvciwKICB2YXJpYW50cywKICBzdGFyCn0pIHsKICBsZXQgc2VsID0gcmVzb2x2ZUV4cHJlc3Npb24oc2NvcGUsIHNlbGVjdG9yKTsKICBpZiAoc2VsIGluc3RhbmNlb2YgRmx1ZW50Tm9uZSkgewogICAgcmV0dXJuIGdldERlZmF1bHQoc2NvcGUsIHZhcmlhbnRzLCBzdGFyKTsKICB9CiAgZm9yIChjb25zdCB2YXJpYW50IG9mIHZhcmlhbnRzKSB7CiAgICBjb25zdCBrZXkgPSByZXNvbHZlRXhwcmVzc2lvbihzY29wZSwgdmFyaWFudC5rZXkpOwogICAgaWYgKG1hdGNoKHNjb3BlLCBzZWwsIGtleSkpIHsKICAgICAgcmV0dXJuIHJlc29sdmVQYXR0ZXJuKHNjb3BlLCB2YXJpYW50LnZhbHVlKTsKICAgIH0KICB9CiAgcmV0dXJuIGdldERlZmF1bHQoc2NvcGUsIHZhcmlhbnRzLCBzdGFyKTsKfQpmdW5jdGlvbiByZXNvbHZlQ29tcGxleFBhdHRlcm4oc2NvcGUsIHB0bikgewogIGlmIChzY29wZS5kaXJ0eS5oYXMocHRuKSkgewogICAgc2NvcGUucmVwb3J0RXJyb3IobmV3IFJhbmdlRXJyb3IoIkN5Y2xpYyByZWZlcmVuY2UiKSk7CiAgICByZXR1cm4gbmV3IEZsdWVudE5vbmUoKTsKICB9CiAgc2NvcGUuZGlydHkuYWRkKHB0bik7CiAgY29uc3QgcmVzdWx0ID0gW107CiAgY29uc3QgdXNlSXNvbGF0aW5nID0gc2NvcGUuYnVuZGxlLl91c2VJc29sYXRpbmcgJiYgcHRuLmxlbmd0aCA+IDE7CiAgZm9yIChjb25zdCBlbGVtIG9mIHB0bikgewogICAgaWYgKHR5cGVvZiBlbGVtID09PSAic3RyaW5nIikgewogICAgICByZXN1bHQucHVzaChzY29wZS5idW5kbGUuX3RyYW5zZm9ybShlbGVtKSk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgc2NvcGUucGxhY2VhYmxlcysrOwogICAgaWYgKHNjb3BlLnBsYWNlYWJsZXMgPiBNQVhfUExBQ0VBQkxFUykgewogICAgICBzY29wZS5kaXJ0eS5kZWxldGUocHRuKTsKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoYFRvbyBtYW55IHBsYWNlYWJsZXMgZXhwYW5kZWQ6ICR7c2NvcGUucGxhY2VhYmxlc30sIGAgKyBgbWF4IGFsbG93ZWQgaXMgJHtNQVhfUExBQ0VBQkxFU31gKTsKICAgIH0KICAgIGlmICh1c2VJc29sYXRpbmcpIHsKICAgICAgcmVzdWx0LnB1c2goRlNJKTsKICAgIH0KICAgIHJlc3VsdC5wdXNoKHJlc29sdmVFeHByZXNzaW9uKHNjb3BlLCBlbGVtKS50b1N0cmluZyhzY29wZSkpOwogICAgaWYgKHVzZUlzb2xhdGluZykgewogICAgICByZXN1bHQucHVzaChQREkpOwogICAgfQogIH0KICBzY29wZS5kaXJ0eS5kZWxldGUocHRuKTsKICByZXR1cm4gcmVzdWx0LmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHJlc29sdmVQYXR0ZXJuKHNjb3BlLCB2YWx1ZSkgewogIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICByZXR1cm4gc2NvcGUuYnVuZGxlLl90cmFuc2Zvcm0odmFsdWUpOwogIH0KICByZXR1cm4gcmVzb2x2ZUNvbXBsZXhQYXR0ZXJuKHNjb3BlLCB2YWx1ZSk7Cn0KOy8vIC4vbm9kZV9tb2R1bGVzL0BmbHVlbnQvYnVuZGxlL2VzbS9zY29wZS5qcwpjbGFzcyBTY29wZSB7CiAgY29uc3RydWN0b3IoYnVuZGxlLCBlcnJvcnMsIGFyZ3MpIHsKICAgIHRoaXMuZGlydHkgPSBuZXcgV2Vha1NldCgpOwogICAgdGhpcy5wYXJhbXMgPSBudWxsOwogICAgdGhpcy5wbGFjZWFibGVzID0gMDsKICAgIHRoaXMuYnVuZGxlID0gYnVuZGxlOwogICAgdGhpcy5lcnJvcnMgPSBlcnJvcnM7CiAgICB0aGlzLmFyZ3MgPSBhcmdzOwogIH0KICByZXBvcnRFcnJvcihlcnJvcikgewogICAgaWYgKCF0aGlzLmVycm9ycyB8fCAhKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpKSB7CiAgICAgIHRocm93IGVycm9yOwogICAgfQogICAgdGhpcy5lcnJvcnMucHVzaChlcnJvcik7CiAgfQogIG1lbW9pemVJbnRsT2JqZWN0KGN0b3IsIG9wdHMpIHsKICAgIGxldCBjYWNoZSA9IHRoaXMuYnVuZGxlLl9pbnRscy5nZXQoY3Rvcik7CiAgICBpZiAoIWNhY2hlKSB7CiAgICAgIGNhY2hlID0ge307CiAgICAgIHRoaXMuYnVuZGxlLl9pbnRscy5zZXQoY3RvciwgY2FjaGUpOwogICAgfQogICAgbGV0IGlkID0gSlNPTi5zdHJpbmdpZnkob3B0cyk7CiAgICBpZiAoIWNhY2hlW2lkXSkgewogICAgICBjYWNoZVtpZF0gPSBuZXcgY3Rvcih0aGlzLmJ1bmRsZS5sb2NhbGVzLCBvcHRzKTsKICAgIH0KICAgIHJldHVybiBjYWNoZVtpZF07CiAgfQp9CjsvLyAuL25vZGVfbW9kdWxlcy9AZmx1ZW50L2J1bmRsZS9lc20vYnVpbHRpbnMuanMKCmZ1bmN0aW9uIHZhbHVlcyhvcHRzLCBhbGxvd2VkKSB7CiAgY29uc3QgdW53cmFwcGVkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBmb3IgKGNvbnN0IFtuYW1lLCBvcHRdIG9mIE9iamVjdC5lbnRyaWVzKG9wdHMpKSB7CiAgICBpZiAoYWxsb3dlZC5pbmNsdWRlcyhuYW1lKSkgewogICAgICB1bndyYXBwZWRbbmFtZV0gPSBvcHQudmFsdWVPZigpOwogICAgfQogIH0KICByZXR1cm4gdW53cmFwcGVkOwp9CmNvbnN0IE5VTUJFUl9BTExPV0VEID0gWyJ1bml0RGlzcGxheSIsICJjdXJyZW5jeURpc3BsYXkiLCAidXNlR3JvdXBpbmciLCAibWluaW11bUludGVnZXJEaWdpdHMiLCAibWluaW11bUZyYWN0aW9uRGlnaXRzIiwgIm1heGltdW1GcmFjdGlvbkRpZ2l0cyIsICJtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHMiLCAibWF4aW11bVNpZ25pZmljYW50RGlnaXRzIl07CmZ1bmN0aW9uIE5VTUJFUihhcmdzLCBvcHRzKSB7CiAgbGV0IGFyZyA9IGFyZ3NbMF07CiAgaWYgKGFyZyBpbnN0YW5jZW9mIEZsdWVudE5vbmUpIHsKICAgIHJldHVybiBuZXcgRmx1ZW50Tm9uZShgTlVNQkVSKCR7YXJnLnZhbHVlT2YoKX0pYCk7CiAgfQogIGlmIChhcmcgaW5zdGFuY2VvZiBGbHVlbnROdW1iZXIpIHsKICAgIHJldHVybiBuZXcgRmx1ZW50TnVtYmVyKGFyZy52YWx1ZU9mKCksIHsKICAgICAgLi4uYXJnLm9wdHMsCiAgICAgIC4uLnZhbHVlcyhvcHRzLCBOVU1CRVJfQUxMT1dFRCkKICAgIH0pOwogIH0KICBpZiAoYXJnIGluc3RhbmNlb2YgRmx1ZW50RGF0ZVRpbWUpIHsKICAgIHJldHVybiBuZXcgRmx1ZW50TnVtYmVyKGFyZy50b051bWJlcigpLCB7CiAgICAgIC4uLnZhbHVlcyhvcHRzLCBOVU1CRVJfQUxMT1dFRCkKICAgIH0pOwogIH0KICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGFyZ3VtZW50IHRvIE5VTUJFUiIpOwp9CmNvbnN0IERBVEVUSU1FX0FMTE9XRUQgPSBbImRhdGVTdHlsZSIsICJ0aW1lU3R5bGUiLCAiZnJhY3Rpb25hbFNlY29uZERpZ2l0cyIsICJkYXlQZXJpb2QiLCAiaG91cjEyIiwgIndlZWtkYXkiLCAiZXJhIiwgInllYXIiLCAibW9udGgiLCAiZGF5IiwgImhvdXIiLCAibWludXRlIiwgInNlY29uZCIsICJ0aW1lWm9uZU5hbWUiXTsKZnVuY3Rpb24gREFURVRJTUUoYXJncywgb3B0cykgewogIGxldCBhcmcgPSBhcmdzWzBdOwogIGlmIChhcmcgaW5zdGFuY2VvZiBGbHVlbnROb25lKSB7CiAgICByZXR1cm4gbmV3IEZsdWVudE5vbmUoYERBVEVUSU1FKCR7YXJnLnZhbHVlT2YoKX0pYCk7CiAgfQogIGlmIChhcmcgaW5zdGFuY2VvZiBGbHVlbnREYXRlVGltZSB8fCBhcmcgaW5zdGFuY2VvZiBGbHVlbnROdW1iZXIpIHsKICAgIHJldHVybiBuZXcgRmx1ZW50RGF0ZVRpbWUoYXJnLCB2YWx1ZXMob3B0cywgREFURVRJTUVfQUxMT1dFRCkpOwogIH0KICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGFyZ3VtZW50IHRvIERBVEVUSU1FIik7Cn0KOy8vIC4vbm9kZV9tb2R1bGVzL0BmbHVlbnQvYnVuZGxlL2VzbS9tZW1vaXplci5qcwpjb25zdCBjYWNoZSA9IG5ldyBNYXAoKTsKZnVuY3Rpb24gZ2V0TWVtb2l6ZXJGb3JMb2NhbGUobG9jYWxlcykgewogIGNvbnN0IHN0cmluZ0xvY2FsZSA9IEFycmF5LmlzQXJyYXkobG9jYWxlcykgPyBsb2NhbGVzLmpvaW4oIiAiKSA6IGxvY2FsZXM7CiAgbGV0IG1lbW9pemVyID0gY2FjaGUuZ2V0KHN0cmluZ0xvY2FsZSk7CiAgaWYgKG1lbW9pemVyID09PSB1bmRlZmluZWQpIHsKICAgIG1lbW9pemVyID0gbmV3IE1hcCgpOwogICAgY2FjaGUuc2V0KHN0cmluZ0xvY2FsZSwgbWVtb2l6ZXIpOwogIH0KICByZXR1cm4gbWVtb2l6ZXI7Cn0KOy8vIC4vbm9kZV9tb2R1bGVzL0BmbHVlbnQvYnVuZGxlL2VzbS9idW5kbGUuanMKCgoKCgpjbGFzcyBGbHVlbnRCdW5kbGUgewogIGNvbnN0cnVjdG9yKGxvY2FsZXMsIHsKICAgIGZ1bmN0aW9ucywKICAgIHVzZUlzb2xhdGluZyA9IHRydWUsCiAgICB0cmFuc2Zvcm0gPSB2ID0+IHYKICB9ID0ge30pIHsKICAgIHRoaXMuX3Rlcm1zID0gbmV3IE1hcCgpOwogICAgdGhpcy5fbWVzc2FnZXMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLmxvY2FsZXMgPSBBcnJheS5pc0FycmF5KGxvY2FsZXMpID8gbG9jYWxlcyA6IFtsb2NhbGVzXTsKICAgIHRoaXMuX2Z1bmN0aW9ucyA9IHsKICAgICAgTlVNQkVSOiBOVU1CRVIsCiAgICAgIERBVEVUSU1FOiBEQVRFVElNRSwKICAgICAgLi4uZnVuY3Rpb25zCiAgICB9OwogICAgdGhpcy5fdXNlSXNvbGF0aW5nID0gdXNlSXNvbGF0aW5nOwogICAgdGhpcy5fdHJhbnNmb3JtID0gdHJhbnNmb3JtOwogICAgdGhpcy5faW50bHMgPSBnZXRNZW1vaXplckZvckxvY2FsZShsb2NhbGVzKTsKICB9CiAgaGFzTWVzc2FnZShpZCkgewogICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VzLmhhcyhpZCk7CiAgfQogIGdldE1lc3NhZ2UoaWQpIHsKICAgIHJldHVybiB0aGlzLl9tZXNzYWdlcy5nZXQoaWQpOwogIH0KICBhZGRSZXNvdXJjZShyZXMsIHsKICAgIGFsbG93T3ZlcnJpZGVzID0gZmFsc2UKICB9ID0ge30pIHsKICAgIGNvbnN0IGVycm9ycyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXMuYm9keS5sZW5ndGg7IGkrKykgewogICAgICBsZXQgZW50cnkgPSByZXMuYm9keVtpXTsKICAgICAgaWYgKGVudHJ5LmlkLnN0YXJ0c1dpdGgoIi0iKSkgewogICAgICAgIGlmIChhbGxvd092ZXJyaWRlcyA9PT0gZmFsc2UgJiYgdGhpcy5fdGVybXMuaGFzKGVudHJ5LmlkKSkgewogICAgICAgICAgZXJyb3JzLnB1c2gobmV3IEVycm9yKGBBdHRlbXB0IHRvIG92ZXJyaWRlIGFuIGV4aXN0aW5nIHRlcm06ICIke2VudHJ5LmlkfSJgKSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fdGVybXMuc2V0KGVudHJ5LmlkLCBlbnRyeSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGFsbG93T3ZlcnJpZGVzID09PSBmYWxzZSAmJiB0aGlzLl9tZXNzYWdlcy5oYXMoZW50cnkuaWQpKSB7CiAgICAgICAgICBlcnJvcnMucHVzaChuZXcgRXJyb3IoYEF0dGVtcHQgdG8gb3ZlcnJpZGUgYW4gZXhpc3RpbmcgbWVzc2FnZTogIiR7ZW50cnkuaWR9ImApKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB0aGlzLl9tZXNzYWdlcy5zZXQoZW50cnkuaWQsIGVudHJ5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGVycm9yczsKICB9CiAgZm9ybWF0UGF0dGVybihwYXR0ZXJuLCBhcmdzID0gbnVsbCwgZXJyb3JzID0gbnVsbCkgewogICAgaWYgKHR5cGVvZiBwYXR0ZXJuID09PSAic3RyaW5nIikgewogICAgICByZXR1cm4gdGhpcy5fdHJhbnNmb3JtKHBhdHRlcm4pOwogICAgfQogICAgbGV0IHNjb3BlID0gbmV3IFNjb3BlKHRoaXMsIGVycm9ycywgYXJncyk7CiAgICB0cnkgewogICAgICBsZXQgdmFsdWUgPSByZXNvbHZlQ29tcGxleFBhdHRlcm4oc2NvcGUsIHBhdHRlcm4pOwogICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoc2NvcGUpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIGlmIChzY29wZS5lcnJvcnMgJiYgZXJyIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICBzY29wZS5lcnJvcnMucHVzaChlcnIpOwogICAgICAgIHJldHVybiBuZXcgRmx1ZW50Tm9uZSgpLnRvU3RyaW5nKHNjb3BlKTsKICAgICAgfQogICAgICB0aHJvdyBlcnI7CiAgICB9CiAgfQp9CjsvLyAuL25vZGVfbW9kdWxlcy9AZmx1ZW50L2J1bmRsZS9lc20vcmVzb3VyY2UuanMKY29uc3QgUkVfTUVTU0FHRV9TVEFSVCA9IC9eKC0/W2EtekEtWl1bXHctXSopICo9ICovZ207CmNvbnN0IFJFX0FUVFJJQlVURV9TVEFSVCA9IC9cLihbYS16QS1aXVtcdy1dKikgKj0gKi95Owpjb25zdCBSRV9WQVJJQU5UX1NUQVJUID0gL1wqP1xbL3k7CmNvbnN0IFJFX05VTUJFUl9MSVRFUkFMID0gLygtP1swLTldKyg/OlwuKFswLTldKykpPykveTsKY29uc3QgUkVfSURFTlRJRklFUiA9IC8oW2EtekEtWl1bXHctXSopL3k7CmNvbnN0IFJFX1JFRkVSRU5DRSA9IC8oWyQtXSk/KFthLXpBLVpdW1x3LV0qKSg/OlwuKFthLXpBLVpdW1x3LV0qKSk/L3k7CmNvbnN0IFJFX0ZVTkNUSU9OX05BTUUgPSAvXltBLVpdW0EtWjAtOV8tXSokLzsKY29uc3QgUkVfVEVYVF9SVU4gPSAvKFtee31cblxyXSspL3k7CmNvbnN0IFJFX1NUUklOR19SVU4gPSAvKFteXFwiXG5ccl0qKS95Owpjb25zdCBSRV9TVFJJTkdfRVNDQVBFID0gL1xcKFtcXCJdKS95Owpjb25zdCBSRV9VTklDT0RFX0VTQ0FQRSA9IC9cXHUoW2EtZkEtRjAtOV17NH0pfFxcVShbYS1mQS1GMC05XXs2fSkveTsKY29uc3QgUkVfTEVBRElOR19ORVdMSU5FUyA9IC9eXG4rLzsKY29uc3QgUkVfVFJBSUxJTkdfU1BBQ0VTID0gLyArJC87CmNvbnN0IFJFX0JMQU5LX0xJTkVTID0gLyAqXHI/XG4vZzsKY29uc3QgUkVfSU5ERU5UID0gLyggKikkLzsKY29uc3QgVE9LRU5fQlJBQ0VfT1BFTiA9IC97XHMqL3k7CmNvbnN0IFRPS0VOX0JSQUNFX0NMT1NFID0gL1xzKn0veTsKY29uc3QgVE9LRU5fQlJBQ0tFVF9PUEVOID0gL1xbXHMqL3k7CmNvbnN0IFRPS0VOX0JSQUNLRVRfQ0xPU0UgPSAvXHMqXSAqL3k7CmNvbnN0IFRPS0VOX1BBUkVOX09QRU4gPSAvXHMqXChccyoveTsKY29uc3QgVE9LRU5fQVJST1cgPSAvXHMqLT5ccyoveTsKY29uc3QgVE9LRU5fQ09MT04gPSAvXHMqOlxzKi95Owpjb25zdCBUT0tFTl9DT01NQSA9IC9ccyosP1xzKi95Owpjb25zdCBUT0tFTl9CTEFOSyA9IC9ccysveTsKY2xhc3MgRmx1ZW50UmVzb3VyY2UgewogIGNvbnN0cnVjdG9yKHNvdXJjZSkgewogICAgdGhpcy5ib2R5ID0gW107CiAgICBSRV9NRVNTQUdFX1NUQVJULmxhc3RJbmRleCA9IDA7CiAgICBsZXQgY3Vyc29yID0gMDsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGxldCBuZXh0ID0gUkVfTUVTU0FHRV9TVEFSVC5leGVjKHNvdXJjZSk7CiAgICAgIGlmIChuZXh0ID09PSBudWxsKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY3Vyc29yID0gUkVfTUVTU0FHRV9TVEFSVC5sYXN0SW5kZXg7CiAgICAgIHRyeSB7CiAgICAgICAgdGhpcy5ib2R5LnB1c2gocGFyc2VNZXNzYWdlKG5leHRbMV0pKTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIFN5bnRheEVycm9yKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgZXJyOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiB0ZXN0KHJlKSB7CiAgICAgIHJlLmxhc3RJbmRleCA9IGN1cnNvcjsKICAgICAgcmV0dXJuIHJlLnRlc3Qoc291cmNlKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNvbnN1bWVDaGFyKGNoYXIsIGVycm9yQ2xhc3MpIHsKICAgICAgaWYgKHNvdXJjZVtjdXJzb3JdID09PSBjaGFyKSB7CiAgICAgICAgY3Vyc29yKys7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKGVycm9yQ2xhc3MpIHsKICAgICAgICB0aHJvdyBuZXcgZXJyb3JDbGFzcyhgRXhwZWN0ZWQgJHtjaGFyfWApOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGZ1bmN0aW9uIGNvbnN1bWVUb2tlbihyZSwgZXJyb3JDbGFzcykgewogICAgICBpZiAodGVzdChyZSkpIHsKICAgICAgICBjdXJzb3IgPSByZS5sYXN0SW5kZXg7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKGVycm9yQ2xhc3MpIHsKICAgICAgICB0aHJvdyBuZXcgZXJyb3JDbGFzcyhgRXhwZWN0ZWQgJHtyZS50b1N0cmluZygpfWApOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGZ1bmN0aW9uIG1hdGNoKHJlKSB7CiAgICAgIHJlLmxhc3RJbmRleCA9IGN1cnNvcjsKICAgICAgbGV0IHJlc3VsdCA9IHJlLmV4ZWMoc291cmNlKTsKICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCkgewogICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihgRXhwZWN0ZWQgJHtyZS50b1N0cmluZygpfWApOwogICAgICB9CiAgICAgIGN1cnNvciA9IHJlLmxhc3RJbmRleDsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIGZ1bmN0aW9uIG1hdGNoMShyZSkgewogICAgICByZXR1cm4gbWF0Y2gocmUpWzFdOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VNZXNzYWdlKGlkKSB7CiAgICAgIGxldCB2YWx1ZSA9IHBhcnNlUGF0dGVybigpOwogICAgICBsZXQgYXR0cmlidXRlcyA9IHBhcnNlQXR0cmlidXRlcygpOwogICAgICBpZiAodmFsdWUgPT09IG51bGwgJiYgT2JqZWN0LmtleXMoYXR0cmlidXRlcykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCJFeHBlY3RlZCBtZXNzYWdlIHZhbHVlIG9yIGF0dHJpYnV0ZXMiKTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIGlkLAogICAgICAgIHZhbHVlLAogICAgICAgIGF0dHJpYnV0ZXMKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlQXR0cmlidXRlcygpIHsKICAgICAgbGV0IGF0dHJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgd2hpbGUgKHRlc3QoUkVfQVRUUklCVVRFX1NUQVJUKSkgewogICAgICAgIGxldCBuYW1lID0gbWF0Y2gxKFJFX0FUVFJJQlVURV9TVEFSVCk7CiAgICAgICAgbGV0IHZhbHVlID0gcGFyc2VQYXR0ZXJuKCk7CiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIkV4cGVjdGVkIGF0dHJpYnV0ZSB2YWx1ZSIpOwogICAgICAgIH0KICAgICAgICBhdHRyc1tuYW1lXSA9IHZhbHVlOwogICAgICB9CiAgICAgIHJldHVybiBhdHRyczsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlUGF0dGVybigpIHsKICAgICAgbGV0IGZpcnN0OwogICAgICBpZiAodGVzdChSRV9URVhUX1JVTikpIHsKICAgICAgICBmaXJzdCA9IG1hdGNoMShSRV9URVhUX1JVTik7CiAgICAgIH0KICAgICAgaWYgKHNvdXJjZVtjdXJzb3JdID09PSAieyIgfHwgc291cmNlW2N1cnNvcl0gPT09ICJ9IikgewogICAgICAgIHJldHVybiBwYXJzZVBhdHRlcm5FbGVtZW50cyhmaXJzdCA/IFtmaXJzdF0gOiBbXSwgSW5maW5pdHkpOwogICAgICB9CiAgICAgIGxldCBpbmRlbnQgPSBwYXJzZUluZGVudCgpOwogICAgICBpZiAoaW5kZW50KSB7CiAgICAgICAgaWYgKGZpcnN0KSB7CiAgICAgICAgICByZXR1cm4gcGFyc2VQYXR0ZXJuRWxlbWVudHMoW2ZpcnN0LCBpbmRlbnRdLCBpbmRlbnQubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgaW5kZW50LnZhbHVlID0gdHJpbShpbmRlbnQudmFsdWUsIFJFX0xFQURJTkdfTkVXTElORVMpOwogICAgICAgIHJldHVybiBwYXJzZVBhdHRlcm5FbGVtZW50cyhbaW5kZW50XSwgaW5kZW50Lmxlbmd0aCk7CiAgICAgIH0KICAgICAgaWYgKGZpcnN0KSB7CiAgICAgICAgcmV0dXJuIHRyaW0oZmlyc3QsIFJFX1RSQUlMSU5HX1NQQUNFUyk7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZVBhdHRlcm5FbGVtZW50cyhlbGVtZW50cyA9IFtdLCBjb21tb25JbmRlbnQpIHsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBpZiAodGVzdChSRV9URVhUX1JVTikpIHsKICAgICAgICAgIGVsZW1lbnRzLnB1c2gobWF0Y2gxKFJFX1RFWFRfUlVOKSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHNvdXJjZVtjdXJzb3JdID09PSAieyIpIHsKICAgICAgICAgIGVsZW1lbnRzLnB1c2gocGFyc2VQbGFjZWFibGUoKSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHNvdXJjZVtjdXJzb3JdID09PSAifSIpIHsKICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiVW5iYWxhbmNlZCBjbG9zaW5nIGJyYWNlIik7CiAgICAgICAgfQogICAgICAgIGxldCBpbmRlbnQgPSBwYXJzZUluZGVudCgpOwogICAgICAgIGlmIChpbmRlbnQpIHsKICAgICAgICAgIGVsZW1lbnRzLnB1c2goaW5kZW50KTsKICAgICAgICAgIGNvbW1vbkluZGVudCA9IE1hdGgubWluKGNvbW1vbkluZGVudCwgaW5kZW50Lmxlbmd0aCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgbGV0IGxhc3RJbmRleCA9IGVsZW1lbnRzLmxlbmd0aCAtIDE7CiAgICAgIGxldCBsYXN0RWxlbWVudCA9IGVsZW1lbnRzW2xhc3RJbmRleF07CiAgICAgIGlmICh0eXBlb2YgbGFzdEVsZW1lbnQgPT09ICJzdHJpbmciKSB7CiAgICAgICAgZWxlbWVudHNbbGFzdEluZGV4XSA9IHRyaW0obGFzdEVsZW1lbnQsIFJFX1RSQUlMSU5HX1NQQUNFUyk7CiAgICAgIH0KICAgICAgbGV0IGJha2VkID0gW107CiAgICAgIGZvciAobGV0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHsKICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEluZGVudCkgewogICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQudmFsdWUuc2xpY2UoMCwgZWxlbWVudC52YWx1ZS5sZW5ndGggLSBjb21tb25JbmRlbnQpOwogICAgICAgIH0KICAgICAgICBpZiAoZWxlbWVudCkgewogICAgICAgICAgYmFrZWQucHVzaChlbGVtZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGJha2VkOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VQbGFjZWFibGUoKSB7CiAgICAgIGNvbnN1bWVUb2tlbihUT0tFTl9CUkFDRV9PUEVOLCBTeW50YXhFcnJvcik7CiAgICAgIGxldCBzZWxlY3RvciA9IHBhcnNlSW5saW5lRXhwcmVzc2lvbigpOwogICAgICBpZiAoY29uc3VtZVRva2VuKFRPS0VOX0JSQUNFX0NMT1NFKSkgewogICAgICAgIHJldHVybiBzZWxlY3RvcjsKICAgICAgfQogICAgICBpZiAoY29uc3VtZVRva2VuKFRPS0VOX0FSUk9XKSkgewogICAgICAgIGxldCB2YXJpYW50cyA9IHBhcnNlVmFyaWFudHMoKTsKICAgICAgICBjb25zdW1lVG9rZW4oVE9LRU5fQlJBQ0VfQ0xPU0UsIFN5bnRheEVycm9yKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogInNlbGVjdCIsCiAgICAgICAgICBzZWxlY3RvciwKICAgICAgICAgIC4uLnZhcmlhbnRzCiAgICAgICAgfTsKICAgICAgfQogICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIlVuY2xvc2VkIHBsYWNlYWJsZSIpOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VJbmxpbmVFeHByZXNzaW9uKCkgewogICAgICBpZiAoc291cmNlW2N1cnNvcl0gPT09ICJ7IikgewogICAgICAgIHJldHVybiBwYXJzZVBsYWNlYWJsZSgpOwogICAgICB9CiAgICAgIGlmICh0ZXN0KFJFX1JFRkVSRU5DRSkpIHsKICAgICAgICBsZXQgWywgc2lnaWwsIG5hbWUsIGF0dHIgPSBudWxsXSA9IG1hdGNoKFJFX1JFRkVSRU5DRSk7CiAgICAgICAgaWYgKHNpZ2lsID09PSAiJCIpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHR5cGU6ICJ2YXIiLAogICAgICAgICAgICBuYW1lCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAoY29uc3VtZVRva2VuKFRPS0VOX1BBUkVOX09QRU4pKSB7CiAgICAgICAgICBsZXQgYXJncyA9IHBhcnNlQXJndW1lbnRzKCk7CiAgICAgICAgICBpZiAoc2lnaWwgPT09ICItIikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHR5cGU6ICJ0ZXJtIiwKICAgICAgICAgICAgICBuYW1lLAogICAgICAgICAgICAgIGF0dHIsCiAgICAgICAgICAgICAgYXJncwogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgaWYgKFJFX0ZVTkNUSU9OX05BTUUudGVzdChuYW1lKSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHR5cGU6ICJmdW5jIiwKICAgICAgICAgICAgICBuYW1lLAogICAgICAgICAgICAgIGFyZ3MKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiRnVuY3Rpb24gbmFtZXMgbXVzdCBiZSBhbGwgdXBwZXItY2FzZSIpOwogICAgICAgIH0KICAgICAgICBpZiAoc2lnaWwgPT09ICItIikgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogInRlcm0iLAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICBhdHRyLAogICAgICAgICAgICBhcmdzOiBbXQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICJtZXNnIiwKICAgICAgICAgIG5hbWUsCiAgICAgICAgICBhdHRyCiAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gcGFyc2VMaXRlcmFsKCk7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZUFyZ3VtZW50cygpIHsKICAgICAgbGV0IGFyZ3MgPSBbXTsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBzd2l0Y2ggKHNvdXJjZVtjdXJzb3JdKSB7CiAgICAgICAgICBjYXNlICIpIjoKICAgICAgICAgICAgY3Vyc29yKys7CiAgICAgICAgICAgIHJldHVybiBhcmdzOwogICAgICAgICAgY2FzZSB1bmRlZmluZWQ6CiAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiVW5jbG9zZWQgYXJndW1lbnQgbGlzdCIpOwogICAgICAgIH0KICAgICAgICBhcmdzLnB1c2gocGFyc2VBcmd1bWVudCgpKTsKICAgICAgICBjb25zdW1lVG9rZW4oVE9LRU5fQ09NTUEpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZUFyZ3VtZW50KCkgewogICAgICBsZXQgZXhwciA9IHBhcnNlSW5saW5lRXhwcmVzc2lvbigpOwogICAgICBpZiAoZXhwci50eXBlICE9PSAibWVzZyIpIHsKICAgICAgICByZXR1cm4gZXhwcjsKICAgICAgfQogICAgICBpZiAoY29uc3VtZVRva2VuKFRPS0VOX0NPTE9OKSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiAibmFyZyIsCiAgICAgICAgICBuYW1lOiBleHByLm5hbWUsCiAgICAgICAgICB2YWx1ZTogcGFyc2VMaXRlcmFsKCkKICAgICAgICB9OwogICAgICB9CiAgICAgIHJldHVybiBleHByOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VWYXJpYW50cygpIHsKICAgICAgbGV0IHZhcmlhbnRzID0gW107CiAgICAgIGxldCBjb3VudCA9IDA7CiAgICAgIGxldCBzdGFyOwogICAgICB3aGlsZSAodGVzdChSRV9WQVJJQU5UX1NUQVJUKSkgewogICAgICAgIGlmIChjb25zdW1lQ2hhcigiKiIpKSB7CiAgICAgICAgICBzdGFyID0gY291bnQ7CiAgICAgICAgfQogICAgICAgIGxldCBrZXkgPSBwYXJzZVZhcmlhbnRLZXkoKTsKICAgICAgICBsZXQgdmFsdWUgPSBwYXJzZVBhdHRlcm4oKTsKICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiRXhwZWN0ZWQgdmFyaWFudCB2YWx1ZSIpOwogICAgICAgIH0KICAgICAgICB2YXJpYW50c1tjb3VudCsrXSA9IHsKICAgICAgICAgIGtleSwKICAgICAgICAgIHZhbHVlCiAgICAgICAgfTsKICAgICAgfQogICAgICBpZiAoY291bnQgPT09IDApIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAoc3RhciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCJFeHBlY3RlZCBkZWZhdWx0IHZhcmlhbnQiKTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIHZhcmlhbnRzLAogICAgICAgIHN0YXIKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlVmFyaWFudEtleSgpIHsKICAgICAgY29uc3VtZVRva2VuKFRPS0VOX0JSQUNLRVRfT1BFTiwgU3ludGF4RXJyb3IpOwogICAgICBsZXQga2V5OwogICAgICBpZiAodGVzdChSRV9OVU1CRVJfTElURVJBTCkpIHsKICAgICAgICBrZXkgPSBwYXJzZU51bWJlckxpdGVyYWwoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBrZXkgPSB7CiAgICAgICAgICB0eXBlOiAic3RyIiwKICAgICAgICAgIHZhbHVlOiBtYXRjaDEoUkVfSURFTlRJRklFUikKICAgICAgICB9OwogICAgICB9CiAgICAgIGNvbnN1bWVUb2tlbihUT0tFTl9CUkFDS0VUX0NMT1NFLCBTeW50YXhFcnJvcik7CiAgICAgIHJldHVybiBrZXk7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZUxpdGVyYWwoKSB7CiAgICAgIGlmICh0ZXN0KFJFX05VTUJFUl9MSVRFUkFMKSkgewogICAgICAgIHJldHVybiBwYXJzZU51bWJlckxpdGVyYWwoKTsKICAgICAgfQogICAgICBpZiAoc291cmNlW2N1cnNvcl0gPT09ICciJykgewogICAgICAgIHJldHVybiBwYXJzZVN0cmluZ0xpdGVyYWwoKTsKICAgICAgfQogICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIkludmFsaWQgZXhwcmVzc2lvbiIpOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VOdW1iZXJMaXRlcmFsKCkgewogICAgICBsZXQgWywgdmFsdWUsIGZyYWN0aW9uID0gIiJdID0gbWF0Y2goUkVfTlVNQkVSX0xJVEVSQUwpOwogICAgICBsZXQgcHJlY2lzaW9uID0gZnJhY3Rpb24ubGVuZ3RoOwogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICJudW0iLAogICAgICAgIHZhbHVlOiBwYXJzZUZsb2F0KHZhbHVlKSwKICAgICAgICBwcmVjaXNpb24KICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlU3RyaW5nTGl0ZXJhbCgpIHsKICAgICAgY29uc3VtZUNoYXIoJyInLCBTeW50YXhFcnJvcik7CiAgICAgIGxldCB2YWx1ZSA9ICIiOwogICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgIHZhbHVlICs9IG1hdGNoMShSRV9TVFJJTkdfUlVOKTsKICAgICAgICBpZiAoc291cmNlW2N1cnNvcl0gPT09ICJcXCIpIHsKICAgICAgICAgIHZhbHVlICs9IHBhcnNlRXNjYXBlU2VxdWVuY2UoKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoY29uc3VtZUNoYXIoJyInKSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogInN0ciIsCiAgICAgICAgICAgIHZhbHVlCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIlVuY2xvc2VkIHN0cmluZyBsaXRlcmFsIik7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlRXNjYXBlU2VxdWVuY2UoKSB7CiAgICAgIGlmICh0ZXN0KFJFX1NUUklOR19FU0NBUEUpKSB7CiAgICAgICAgcmV0dXJuIG1hdGNoMShSRV9TVFJJTkdfRVNDQVBFKTsKICAgICAgfQogICAgICBpZiAodGVzdChSRV9VTklDT0RFX0VTQ0FQRSkpIHsKICAgICAgICBsZXQgWywgY29kZXBvaW50NCwgY29kZXBvaW50Nl0gPSBtYXRjaChSRV9VTklDT0RFX0VTQ0FQRSk7CiAgICAgICAgbGV0IGNvZGVwb2ludCA9IHBhcnNlSW50KGNvZGVwb2ludDQgfHwgY29kZXBvaW50NiwgMTYpOwogICAgICAgIHJldHVybiBjb2RlcG9pbnQgPD0gMHhkN2ZmIHx8IDB4ZTAwMCA8PSBjb2RlcG9pbnQgPyBTdHJpbmcuZnJvbUNvZGVQb2ludChjb2RlcG9pbnQpIDogIu+/vSI7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCJVbmtub3duIGVzY2FwZSBzZXF1ZW5jZSIpOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VJbmRlbnQoKSB7CiAgICAgIGxldCBzdGFydCA9IGN1cnNvcjsKICAgICAgY29uc3VtZVRva2VuKFRPS0VOX0JMQU5LKTsKICAgICAgc3dpdGNoIChzb3VyY2VbY3Vyc29yXSkgewogICAgICAgIGNhc2UgIi4iOgogICAgICAgIGNhc2UgIlsiOgogICAgICAgIGNhc2UgIioiOgogICAgICAgIGNhc2UgIn0iOgogICAgICAgIGNhc2UgdW5kZWZpbmVkOgogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGNhc2UgInsiOgogICAgICAgICAgcmV0dXJuIG1ha2VJbmRlbnQoc291cmNlLnNsaWNlKHN0YXJ0LCBjdXJzb3IpKTsKICAgICAgfQogICAgICBpZiAoc291cmNlW2N1cnNvciAtIDFdID09PSAiICIpIHsKICAgICAgICByZXR1cm4gbWFrZUluZGVudChzb3VyY2Uuc2xpY2Uoc3RhcnQsIGN1cnNvcikpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGZ1bmN0aW9uIHRyaW0odGV4dCwgcmUpIHsKICAgICAgcmV0dXJuIHRleHQucmVwbGFjZShyZSwgIiIpOwogICAgfQogICAgZnVuY3Rpb24gbWFrZUluZGVudChibGFuaykgewogICAgICBsZXQgdmFsdWUgPSBibGFuay5yZXBsYWNlKFJFX0JMQU5LX0xJTkVTLCAiXG4iKTsKICAgICAgbGV0IGxlbmd0aCA9IFJFX0lOREVOVC5leGVjKGJsYW5rKVsxXS5sZW5ndGg7CiAgICAgIHJldHVybiBuZXcgSW5kZW50KHZhbHVlLCBsZW5ndGgpOwogICAgfQogIH0KfQpjbGFzcyBJbmRlbnQgewogIGNvbnN0cnVjdG9yKHZhbHVlLCBsZW5ndGgpIHsKICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoOwogIH0KfQo7Ly8gLi9ub2RlX21vZHVsZXMvQGZsdWVudC9idW5kbGUvZXNtL2luZGV4LmpzCgoKCjsvLyAuL25vZGVfbW9kdWxlcy9AZmx1ZW50L2RvbS9lc20vb3ZlcmxheS5qcwpjb25zdCByZU92ZXJsYXkgPSAvPHwmIz9cdys7LzsKY29uc3QgVEVYVF9MRVZFTF9FTEVNRU5UUyA9IHsKICAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI6IFsiZW0iLCAic3Ryb25nIiwgInNtYWxsIiwgInMiLCAiY2l0ZSIsICJxIiwgImRmbiIsICJhYmJyIiwgImRhdGEiLCAidGltZSIsICJjb2RlIiwgInZhciIsICJzYW1wIiwgImtiZCIsICJzdWIiLCAic3VwIiwgImkiLCAiYiIsICJ1IiwgIm1hcmsiLCAiYmRpIiwgImJkbyIsICJzcGFuIiwgImJyIiwgIndiciJdCn07CmNvbnN0IExPQ0FMSVpBQkxFX0FUVFJJQlVURVMgPSB7CiAgImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiOiB7CiAgICBnbG9iYWw6IFsidGl0bGUiLCAiYXJpYS1kZXNjcmlwdGlvbiIsICJhcmlhLWxhYmVsIiwgImFyaWEtdmFsdWV0ZXh0Il0sCiAgICBhOiBbImRvd25sb2FkIl0sCiAgICBhcmVhOiBbImRvd25sb2FkIiwgImFsdCJdLAogICAgaW5wdXQ6IFsiYWx0IiwgInBsYWNlaG9sZGVyIl0sCiAgICBtZW51aXRlbTogWyJsYWJlbCJdLAogICAgbWVudTogWyJsYWJlbCJdLAogICAgb3B0Z3JvdXA6IFsibGFiZWwiXSwKICAgIG9wdGlvbjogWyJsYWJlbCJdLAogICAgdHJhY2s6IFsibGFiZWwiXSwKICAgIGltZzogWyJhbHQiXSwKICAgIHRleHRhcmVhOiBbInBsYWNlaG9sZGVyIl0sCiAgICB0aDogWyJhYmJyIl0KICB9LAogICJodHRwOi8vd3d3Lm1vemlsbGEub3JnL2tleW1hc3Rlci9nYXRla2VlcGVyL3RoZXJlLmlzLm9ubHkueHVsIjogewogICAgZ2xvYmFsOiBbImFjY2Vzc2tleSIsICJhcmlhLWxhYmVsIiwgImFyaWEtdmFsdWV0ZXh0IiwgImxhYmVsIiwgInRpdGxlIiwgInRvb2x0aXB0ZXh0Il0sCiAgICBkZXNjcmlwdGlvbjogWyJ2YWx1ZSJdLAogICAga2V5OiBbImtleSIsICJrZXljb2RlIl0sCiAgICBsYWJlbDogWyJ2YWx1ZSJdLAogICAgdGV4dGJveDogWyJwbGFjZWhvbGRlciIsICJ2YWx1ZSJdCiAgfQp9OwpmdW5jdGlvbiB0cmFuc2xhdGVFbGVtZW50KGVsZW1lbnQsIHRyYW5zbGF0aW9uKSB7CiAgY29uc3QgewogICAgdmFsdWUKICB9ID0gdHJhbnNsYXRpb247CiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgIGlmIChlbGVtZW50LmxvY2FsTmFtZSA9PT0gInRpdGxlIiAmJiBlbGVtZW50Lm5hbWVzcGFjZVVSSSA9PT0gImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiKSB7CiAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgIH0gZWxzZSBpZiAoIXJlT3ZlcmxheS50ZXN0KHZhbHVlKSkgewogICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICBjb25zdCB0ZW1wbGF0ZUVsZW1lbnQgPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiwgInRlbXBsYXRlIik7CiAgICAgIHRlbXBsYXRlRWxlbWVudC5pbm5lckhUTUwgPSB2YWx1ZTsKICAgICAgb3ZlcmxheUNoaWxkTm9kZXModGVtcGxhdGVFbGVtZW50LmNvbnRlbnQsIGVsZW1lbnQpOwogICAgfQogIH0KICBvdmVybGF5QXR0cmlidXRlcyh0cmFuc2xhdGlvbiwgZWxlbWVudCk7Cn0KZnVuY3Rpb24gb3ZlcmxheUNoaWxkTm9kZXMoZnJvbUZyYWdtZW50LCB0b0VsZW1lbnQpIHsKICBmb3IgKGNvbnN0IGNoaWxkTm9kZSBvZiBmcm9tRnJhZ21lbnQuY2hpbGROb2RlcykgewogICAgaWYgKGNoaWxkTm9kZS5ub2RlVHlwZSA9PT0gY2hpbGROb2RlLlRFWFRfTk9ERSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmIChjaGlsZE5vZGUuaGFzQXR0cmlidXRlKCJkYXRhLWwxMG4tbmFtZSIpKSB7CiAgICAgIGNvbnN0IHNhbml0aXplZCA9IGdldE5vZGVGb3JOYW1lZEVsZW1lbnQodG9FbGVtZW50LCBjaGlsZE5vZGUpOwogICAgICBmcm9tRnJhZ21lbnQucmVwbGFjZUNoaWxkKHNhbml0aXplZCwgY2hpbGROb2RlKTsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAoaXNFbGVtZW50QWxsb3dlZChjaGlsZE5vZGUpKSB7CiAgICAgIGNvbnN0IHNhbml0aXplZCA9IGNyZWF0ZVNhbml0aXplZEVsZW1lbnQoY2hpbGROb2RlKTsKICAgICAgZnJvbUZyYWdtZW50LnJlcGxhY2VDaGlsZChzYW5pdGl6ZWQsIGNoaWxkTm9kZSk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgY29uc29sZS53YXJuKGBBbiBlbGVtZW50IG9mIGZvcmJpZGRlbiB0eXBlICIke2NoaWxkTm9kZS5sb2NhbE5hbWV9IiB3YXMgZm91bmQgaW4gYCArICJ0aGUgdHJhbnNsYXRpb24uIE9ubHkgc2FmZSB0ZXh0LWxldmVsIGVsZW1lbnRzIGFuZCBlbGVtZW50cyB3aXRoICIgKyAiZGF0YS1sMTBuLW5hbWUgYXJlIGFsbG93ZWQuIik7CiAgICBmcm9tRnJhZ21lbnQucmVwbGFjZUNoaWxkKGNyZWF0ZVRleHROb2RlRnJvbVRleHRDb250ZW50KGNoaWxkTm9kZSksIGNoaWxkTm9kZSk7CiAgfQogIHRvRWxlbWVudC50ZXh0Q29udGVudCA9ICIiOwogIHRvRWxlbWVudC5hcHBlbmRDaGlsZChmcm9tRnJhZ21lbnQpOwp9CmZ1bmN0aW9uIGhhc0F0dHJpYnV0ZShhdHRyaWJ1dGVzLCBuYW1lKSB7CiAgaWYgKCFhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGZvciAobGV0IGF0dHIgb2YgYXR0cmlidXRlcykgewogICAgaWYgKGF0dHIubmFtZSA9PT0gbmFtZSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CiAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIG92ZXJsYXlBdHRyaWJ1dGVzKGZyb21FbGVtZW50LCB0b0VsZW1lbnQpIHsKICBjb25zdCBleHBsaWNpdGx5QWxsb3dlZCA9IHRvRWxlbWVudC5oYXNBdHRyaWJ1dGUoImRhdGEtbDEwbi1hdHRycyIpID8gdG9FbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWF0dHJzIikuc3BsaXQoIiwiKS5tYXAoaSA9PiBpLnRyaW0oKSkgOiBudWxsOwogIGZvciAoY29uc3QgYXR0ciBvZiBBcnJheS5mcm9tKHRvRWxlbWVudC5hdHRyaWJ1dGVzKSkgewogICAgaWYgKGlzQXR0ck5hbWVMb2NhbGl6YWJsZShhdHRyLm5hbWUsIHRvRWxlbWVudCwgZXhwbGljaXRseUFsbG93ZWQpICYmICFoYXNBdHRyaWJ1dGUoZnJvbUVsZW1lbnQuYXR0cmlidXRlcywgYXR0ci5uYW1lKSkgewogICAgICB0b0VsZW1lbnQucmVtb3ZlQXR0cmlidXRlKGF0dHIubmFtZSk7CiAgICB9CiAgfQogIGlmICghZnJvbUVsZW1lbnQuYXR0cmlidXRlcykgewogICAgcmV0dXJuOwogIH0KICBmb3IgKGNvbnN0IGF0dHIgb2YgQXJyYXkuZnJvbShmcm9tRWxlbWVudC5hdHRyaWJ1dGVzKSkgewogICAgaWYgKGlzQXR0ck5hbWVMb2NhbGl6YWJsZShhdHRyLm5hbWUsIHRvRWxlbWVudCwgZXhwbGljaXRseUFsbG93ZWQpICYmIHRvRWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0ci5uYW1lKSAhPT0gYXR0ci52YWx1ZSkgewogICAgICB0b0VsZW1lbnQuc2V0QXR0cmlidXRlKGF0dHIubmFtZSwgYXR0ci52YWx1ZSk7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGdldE5vZGVGb3JOYW1lZEVsZW1lbnQoc291cmNlRWxlbWVudCwgdHJhbnNsYXRlZENoaWxkKSB7CiAgY29uc3QgY2hpbGROYW1lID0gdHJhbnNsYXRlZENoaWxkLmdldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLW5hbWUiKTsKICBjb25zdCBzb3VyY2VDaGlsZCA9IHNvdXJjZUVsZW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtbDEwbi1uYW1lPSIke2NoaWxkTmFtZX0iXWApOwogIGlmICghc291cmNlQ2hpbGQpIHsKICAgIGNvbnNvbGUud2FybihgQW4gZWxlbWVudCBuYW1lZCAiJHtjaGlsZE5hbWV9IiB3YXNuJ3QgZm91bmQgaW4gdGhlIHNvdXJjZS5gKTsKICAgIHJldHVybiBjcmVhdGVUZXh0Tm9kZUZyb21UZXh0Q29udGVudCh0cmFuc2xhdGVkQ2hpbGQpOwogIH0KICBpZiAoc291cmNlQ2hpbGQubG9jYWxOYW1lICE9PSB0cmFuc2xhdGVkQ2hpbGQubG9jYWxOYW1lKSB7CiAgICBjb25zb2xlLndhcm4oYEFuIGVsZW1lbnQgbmFtZWQgIiR7Y2hpbGROYW1lfSIgd2FzIGZvdW5kIGluIHRoZSB0cmFuc2xhdGlvbiBgICsgYGJ1dCBpdHMgdHlwZSAke3RyYW5zbGF0ZWRDaGlsZC5sb2NhbE5hbWV9IGRpZG4ndCBtYXRjaCB0aGUgYCArIGBlbGVtZW50IGZvdW5kIGluIHRoZSBzb3VyY2UgKCR7c291cmNlQ2hpbGQubG9jYWxOYW1lfSkuYCk7CiAgICByZXR1cm4gY3JlYXRlVGV4dE5vZGVGcm9tVGV4dENvbnRlbnQodHJhbnNsYXRlZENoaWxkKTsKICB9CiAgc291cmNlRWxlbWVudC5yZW1vdmVDaGlsZChzb3VyY2VDaGlsZCk7CiAgY29uc3QgY2xvbmUgPSBzb3VyY2VDaGlsZC5jbG9uZU5vZGUoZmFsc2UpOwogIHJldHVybiBzaGFsbG93UG9wdWxhdGVVc2luZyh0cmFuc2xhdGVkQ2hpbGQsIGNsb25lKTsKfQpmdW5jdGlvbiBjcmVhdGVTYW5pdGl6ZWRFbGVtZW50KGVsZW1lbnQpIHsKICBjb25zdCBjbG9uZSA9IGVsZW1lbnQub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KGVsZW1lbnQubG9jYWxOYW1lKTsKICByZXR1cm4gc2hhbGxvd1BvcHVsYXRlVXNpbmcoZWxlbWVudCwgY2xvbmUpOwp9CmZ1bmN0aW9uIGNyZWF0ZVRleHROb2RlRnJvbVRleHRDb250ZW50KGVsZW1lbnQpIHsKICByZXR1cm4gZWxlbWVudC5vd25lckRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGVsZW1lbnQudGV4dENvbnRlbnQpOwp9CmZ1bmN0aW9uIGlzRWxlbWVudEFsbG93ZWQoZWxlbWVudCkgewogIGNvbnN0IGFsbG93ZWQgPSBURVhUX0xFVkVMX0VMRU1FTlRTW2VsZW1lbnQubmFtZXNwYWNlVVJJXTsKICByZXR1cm4gYWxsb3dlZCAmJiBhbGxvd2VkLmluY2x1ZGVzKGVsZW1lbnQubG9jYWxOYW1lKTsKfQpmdW5jdGlvbiBpc0F0dHJOYW1lTG9jYWxpemFibGUobmFtZSwgZWxlbWVudCwgZXhwbGljaXRseUFsbG93ZWQgPSBudWxsKSB7CiAgaWYgKGV4cGxpY2l0bHlBbGxvd2VkICYmIGV4cGxpY2l0bHlBbGxvd2VkLmluY2x1ZGVzKG5hbWUpKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgY29uc3QgYWxsb3dlZCA9IExPQ0FMSVpBQkxFX0FUVFJJQlVURVNbZWxlbWVudC5uYW1lc3BhY2VVUkldOwogIGlmICghYWxsb3dlZCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjb25zdCBhdHRyTmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICBjb25zdCBlbGVtTmFtZSA9IGVsZW1lbnQubG9jYWxOYW1lOwogIGlmIChhbGxvd2VkLmdsb2JhbC5pbmNsdWRlcyhhdHRyTmFtZSkpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBpZiAoIWFsbG93ZWRbZWxlbU5hbWVdKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmIChhbGxvd2VkW2VsZW1OYW1lXS5pbmNsdWRlcyhhdHRyTmFtZSkpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBpZiAoZWxlbWVudC5uYW1lc3BhY2VVUkkgPT09ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiAmJiBlbGVtTmFtZSA9PT0gImlucHV0IiAmJiBhdHRyTmFtZSA9PT0gInZhbHVlIikgewogICAgY29uc3QgdHlwZSA9IGVsZW1lbnQudHlwZS50b0xvd2VyQ2FzZSgpOwogICAgaWYgKHR5cGUgPT09ICJzdWJtaXQiIHx8IHR5cGUgPT09ICJidXR0b24iIHx8IHR5cGUgPT09ICJyZXNldCIpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQogIHJldHVybiBmYWxzZTsKfQpmdW5jdGlvbiBzaGFsbG93UG9wdWxhdGVVc2luZyhmcm9tRWxlbWVudCwgdG9FbGVtZW50KSB7CiAgdG9FbGVtZW50LnRleHRDb250ZW50ID0gZnJvbUVsZW1lbnQudGV4dENvbnRlbnQ7CiAgb3ZlcmxheUF0dHJpYnV0ZXMoZnJvbUVsZW1lbnQsIHRvRWxlbWVudCk7CiAgcmV0dXJuIHRvRWxlbWVudDsKfQo7Ly8gLi9ub2RlX21vZHVsZXMvY2FjaGVkLWl0ZXJhYmxlL3NyYy9jYWNoZWRfaXRlcmFibGUubWpzCmNsYXNzIENhY2hlZEl0ZXJhYmxlIGV4dGVuZHMgQXJyYXkgewogIHN0YXRpYyBmcm9tKGl0ZXJhYmxlKSB7CiAgICBpZiAoaXRlcmFibGUgaW5zdGFuY2VvZiB0aGlzKSB7CiAgICAgIHJldHVybiBpdGVyYWJsZTsKICAgIH0KICAgIHJldHVybiBuZXcgdGhpcyhpdGVyYWJsZSk7CiAgfQp9CjsvLyAuL25vZGVfbW9kdWxlcy9jYWNoZWQtaXRlcmFibGUvc3JjL2NhY2hlZF9zeW5jX2l0ZXJhYmxlLm1qcwoKY2xhc3MgQ2FjaGVkU3luY0l0ZXJhYmxlIGV4dGVuZHMgQ2FjaGVkSXRlcmFibGUgewogIGNvbnN0cnVjdG9yKGl0ZXJhYmxlKSB7CiAgICBzdXBlcigpOwogICAgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcmFibGUpKSB7CiAgICAgIHRoaXMuaXRlcmF0b3IgPSBpdGVyYWJsZVtTeW1ib2wuaXRlcmF0b3JdKCk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJBcmd1bWVudCBtdXN0IGltcGxlbWVudCB0aGUgaXRlcmF0aW9uIHByb3RvY29sLiIpOwogICAgfQogIH0KICBbU3ltYm9sLml0ZXJhdG9yXSgpIHsKICAgIGNvbnN0IGNhY2hlZCA9IHRoaXM7CiAgICBsZXQgY3VyID0gMDsKICAgIHJldHVybiB7CiAgICAgIG5leHQoKSB7CiAgICAgICAgaWYgKGNhY2hlZC5sZW5ndGggPD0gY3VyKSB7CiAgICAgICAgICBjYWNoZWQucHVzaChjYWNoZWQuaXRlcmF0b3IubmV4dCgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNhY2hlZFtjdXIrK107CiAgICAgIH0KICAgIH07CiAgfQogIHRvdWNoTmV4dChjb3VudCA9IDEpIHsKICAgIGxldCBpZHggPSAwOwogICAgd2hpbGUgKGlkeCsrIDwgY291bnQpIHsKICAgICAgY29uc3QgbGFzdCA9IHRoaXNbdGhpcy5sZW5ndGggLSAxXTsKICAgICAgaWYgKGxhc3QgJiYgbGFzdC5kb25lKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5wdXNoKHRoaXMuaXRlcmF0b3IubmV4dCgpKTsKICAgIH0KICAgIHJldHVybiB0aGlzW3RoaXMubGVuZ3RoIC0gMV07CiAgfQp9CjsvLyAuL25vZGVfbW9kdWxlcy9jYWNoZWQtaXRlcmFibGUvc3JjL2NhY2hlZF9hc3luY19pdGVyYWJsZS5tanMKCmNsYXNzIENhY2hlZEFzeW5jSXRlcmFibGUgZXh0ZW5kcyBDYWNoZWRJdGVyYWJsZSB7CiAgY29uc3RydWN0b3IoaXRlcmFibGUpIHsKICAgIHN1cGVyKCk7CiAgICBpZiAoU3ltYm9sLmFzeW5jSXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXJhYmxlKSkgewogICAgICB0aGlzLml0ZXJhdG9yID0gaXRlcmFibGVbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCk7CiAgICB9IGVsc2UgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcmFibGUpKSB7CiAgICAgIHRoaXMuaXRlcmF0b3IgPSBpdGVyYWJsZVtTeW1ib2wuaXRlcmF0b3JdKCk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJBcmd1bWVudCBtdXN0IGltcGxlbWVudCB0aGUgaXRlcmF0aW9uIHByb3RvY29sLiIpOwogICAgfQogIH0KICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkgewogICAgY29uc3QgY2FjaGVkID0gdGhpczsKICAgIGxldCBjdXIgPSAwOwogICAgcmV0dXJuIHsKICAgICAgYXN5bmMgbmV4dCgpIHsKICAgICAgICBpZiAoY2FjaGVkLmxlbmd0aCA8PSBjdXIpIHsKICAgICAgICAgIGNhY2hlZC5wdXNoKGNhY2hlZC5pdGVyYXRvci5uZXh0KCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FjaGVkW2N1cisrXTsKICAgICAgfQogICAgfTsKICB9CiAgYXN5bmMgdG91Y2hOZXh0KGNvdW50ID0gMSkgewogICAgbGV0IGlkeCA9IDA7CiAgICB3aGlsZSAoaWR4KysgPCBjb3VudCkgewogICAgICBjb25zdCBsYXN0ID0gdGhpc1t0aGlzLmxlbmd0aCAtIDFdOwogICAgICBpZiAobGFzdCAmJiAoYXdhaXQgbGFzdCkuZG9uZSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMucHVzaCh0aGlzLml0ZXJhdG9yLm5leHQoKSk7CiAgICB9CiAgICByZXR1cm4gdGhpc1t0aGlzLmxlbmd0aCAtIDFdOwogIH0KfQo7Ly8gLi9ub2RlX21vZHVsZXMvY2FjaGVkLWl0ZXJhYmxlL3NyYy9pbmRleC5tanMKCgo7Ly8gLi9ub2RlX21vZHVsZXMvQGZsdWVudC9kb20vZXNtL2xvY2FsaXphdGlvbi5qcwoKY2xhc3MgTG9jYWxpemF0aW9uIHsKICBjb25zdHJ1Y3RvcihyZXNvdXJjZUlkcyA9IFtdLCBnZW5lcmF0ZUJ1bmRsZXMpIHsKICAgIHRoaXMucmVzb3VyY2VJZHMgPSByZXNvdXJjZUlkczsKICAgIHRoaXMuZ2VuZXJhdGVCdW5kbGVzID0gZ2VuZXJhdGVCdW5kbGVzOwogICAgdGhpcy5vbkNoYW5nZSh0cnVlKTsKICB9CiAgYWRkUmVzb3VyY2VJZHMocmVzb3VyY2VJZHMsIGVhZ2VyID0gZmFsc2UpIHsKICAgIHRoaXMucmVzb3VyY2VJZHMucHVzaCguLi5yZXNvdXJjZUlkcyk7CiAgICB0aGlzLm9uQ2hhbmdlKGVhZ2VyKTsKICAgIHJldHVybiB0aGlzLnJlc291cmNlSWRzLmxlbmd0aDsKICB9CiAgcmVtb3ZlUmVzb3VyY2VJZHMocmVzb3VyY2VJZHMpIHsKICAgIHRoaXMucmVzb3VyY2VJZHMgPSB0aGlzLnJlc291cmNlSWRzLmZpbHRlcihyID0+ICFyZXNvdXJjZUlkcy5pbmNsdWRlcyhyKSk7CiAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICByZXR1cm4gdGhpcy5yZXNvdXJjZUlkcy5sZW5ndGg7CiAgfQogIGFzeW5jIGZvcm1hdFdpdGhGYWxsYmFjayhrZXlzLCBtZXRob2QpIHsKICAgIGNvbnN0IHRyYW5zbGF0aW9ucyA9IFtdOwogICAgbGV0IGhhc0F0TGVhc3RPbmVCdW5kbGUgPSBmYWxzZTsKICAgIGZvciBhd2FpdCAoY29uc3QgYnVuZGxlIG9mIHRoaXMuYnVuZGxlcykgewogICAgICBoYXNBdExlYXN0T25lQnVuZGxlID0gdHJ1ZTsKICAgICAgY29uc3QgbWlzc2luZ0lkcyA9IGtleXNGcm9tQnVuZGxlKG1ldGhvZCwgYnVuZGxlLCBrZXlzLCB0cmFuc2xhdGlvbnMpOwogICAgICBpZiAobWlzc2luZ0lkcy5zaXplID09PSAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIGNvbnN0IGxvY2FsZSA9IGJ1bmRsZS5sb2NhbGVzWzBdOwogICAgICAgIGNvbnN0IGlkcyA9IEFycmF5LmZyb20obWlzc2luZ0lkcykuam9pbigiLCAiKTsKICAgICAgICBjb25zb2xlLndhcm4oYFtmbHVlbnRdIE1pc3NpbmcgdHJhbnNsYXRpb25zIGluICR7bG9jYWxlfTogJHtpZHN9YCk7CiAgICAgIH0KICAgIH0KICAgIGlmICghaGFzQXRMZWFzdE9uZUJ1bmRsZSAmJiB0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgY29uc29sZS53YXJuKGBbZmx1ZW50XSBSZXF1ZXN0IGZvciBrZXlzIGZhaWxlZCBiZWNhdXNlIG5vIHJlc291cmNlIGJ1bmRsZXMgZ290IGdlbmVyYXRlZC4KICBrZXlzOiAke0pTT04uc3RyaW5naWZ5KGtleXMpfS4KICByZXNvdXJjZUlkczogJHtKU09OLnN0cmluZ2lmeSh0aGlzLnJlc291cmNlSWRzKX0uYCk7CiAgICB9CiAgICByZXR1cm4gdHJhbnNsYXRpb25zOwogIH0KICBmb3JtYXRNZXNzYWdlcyhrZXlzKSB7CiAgICByZXR1cm4gdGhpcy5mb3JtYXRXaXRoRmFsbGJhY2soa2V5cywgbWVzc2FnZUZyb21CdW5kbGUpOwogIH0KICBmb3JtYXRWYWx1ZXMoa2V5cykgewogICAgcmV0dXJuIHRoaXMuZm9ybWF0V2l0aEZhbGxiYWNrKGtleXMsIHZhbHVlRnJvbUJ1bmRsZSk7CiAgfQogIGFzeW5jIGZvcm1hdFZhbHVlKGlkLCBhcmdzKSB7CiAgICBjb25zdCBbdmFsXSA9IGF3YWl0IHRoaXMuZm9ybWF0VmFsdWVzKFt7CiAgICAgIGlkLAogICAgICBhcmdzCiAgICB9XSk7CiAgICByZXR1cm4gdmFsOwogIH0KICBoYW5kbGVFdmVudCgpIHsKICAgIHRoaXMub25DaGFuZ2UoKTsKICB9CiAgb25DaGFuZ2UoZWFnZXIgPSBmYWxzZSkgewogICAgdGhpcy5idW5kbGVzID0gQ2FjaGVkQXN5bmNJdGVyYWJsZS5mcm9tKHRoaXMuZ2VuZXJhdGVCdW5kbGVzKHRoaXMucmVzb3VyY2VJZHMpKTsKICAgIGlmIChlYWdlcikgewogICAgICB0aGlzLmJ1bmRsZXMudG91Y2hOZXh0KDIpOwogICAgfQogIH0KfQpmdW5jdGlvbiB2YWx1ZUZyb21CdW5kbGUoYnVuZGxlLCBlcnJvcnMsIG1lc3NhZ2UsIGFyZ3MpIHsKICBpZiAobWVzc2FnZS52YWx1ZSkgewogICAgcmV0dXJuIGJ1bmRsZS5mb3JtYXRQYXR0ZXJuKG1lc3NhZ2UudmFsdWUsIGFyZ3MsIGVycm9ycyk7CiAgfQogIHJldHVybiBudWxsOwp9CmZ1bmN0aW9uIG1lc3NhZ2VGcm9tQnVuZGxlKGJ1bmRsZSwgZXJyb3JzLCBtZXNzYWdlLCBhcmdzKSB7CiAgY29uc3QgZm9ybWF0dGVkID0gewogICAgdmFsdWU6IG51bGwsCiAgICBhdHRyaWJ1dGVzOiBudWxsCiAgfTsKICBpZiAobWVzc2FnZS52YWx1ZSkgewogICAgZm9ybWF0dGVkLnZhbHVlID0gYnVuZGxlLmZvcm1hdFBhdHRlcm4obWVzc2FnZS52YWx1ZSwgYXJncywgZXJyb3JzKTsKICB9CiAgbGV0IGF0dHJOYW1lcyA9IE9iamVjdC5rZXlzKG1lc3NhZ2UuYXR0cmlidXRlcyk7CiAgaWYgKGF0dHJOYW1lcy5sZW5ndGggPiAwKSB7CiAgICBmb3JtYXR0ZWQuYXR0cmlidXRlcyA9IG5ldyBBcnJheShhdHRyTmFtZXMubGVuZ3RoKTsKICAgIGZvciAobGV0IFtpLCBuYW1lXSBvZiBhdHRyTmFtZXMuZW50cmllcygpKSB7CiAgICAgIGxldCB2YWx1ZSA9IGJ1bmRsZS5mb3JtYXRQYXR0ZXJuKG1lc3NhZ2UuYXR0cmlidXRlc1tuYW1lXSwgYXJncywgZXJyb3JzKTsKICAgICAgZm9ybWF0dGVkLmF0dHJpYnV0ZXNbaV0gPSB7CiAgICAgICAgbmFtZSwKICAgICAgICB2YWx1ZQogICAgICB9OwogICAgfQogIH0KICByZXR1cm4gZm9ybWF0dGVkOwp9CmZ1bmN0aW9uIGtleXNGcm9tQnVuZGxlKG1ldGhvZCwgYnVuZGxlLCBrZXlzLCB0cmFuc2xhdGlvbnMpIHsKICBjb25zdCBtZXNzYWdlRXJyb3JzID0gW107CiAgY29uc3QgbWlzc2luZ0lkcyA9IG5ldyBTZXQoKTsKICBrZXlzLmZvckVhY2goKHsKICAgIGlkLAogICAgYXJncwogIH0sIGkpID0+IHsKICAgIGlmICh0cmFuc2xhdGlvbnNbaV0gIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgbWVzc2FnZSA9IGJ1bmRsZS5nZXRNZXNzYWdlKGlkKTsKICAgIGlmIChtZXNzYWdlKSB7CiAgICAgIG1lc3NhZ2VFcnJvcnMubGVuZ3RoID0gMDsKICAgICAgdHJhbnNsYXRpb25zW2ldID0gbWV0aG9kKGJ1bmRsZSwgbWVzc2FnZUVycm9ycywgbWVzc2FnZSwgYXJncyk7CiAgICAgIGlmIChtZXNzYWdlRXJyb3JzLmxlbmd0aCA+IDAgJiYgdHlwZW9mIGNvbnNvbGUgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgY29uc3QgbG9jYWxlID0gYnVuZGxlLmxvY2FsZXNbMF07CiAgICAgICAgY29uc3QgZXJyb3JzID0gbWVzc2FnZUVycm9ycy5qb2luKCIsICIpOwogICAgICAgIGNvbnNvbGUud2FybihgW2ZsdWVudF1bcmVzb2x2ZXJdIGVycm9ycyBpbiAke2xvY2FsZX0vJHtpZH06ICR7ZXJyb3JzfS5gKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbWlzc2luZ0lkcy5hZGQoaWQpOwogICAgfQogIH0pOwogIHJldHVybiBtaXNzaW5nSWRzOwp9CjsvLyAuL25vZGVfbW9kdWxlcy9AZmx1ZW50L2RvbS9lc20vZG9tX2xvY2FsaXphdGlvbi5qcwoKCmNvbnN0IEwxME5JRF9BVFRSX05BTUUgPSAiZGF0YS1sMTBuLWlkIjsKY29uc3QgTDEwTkFSR1NfQVRUUl9OQU1FID0gImRhdGEtbDEwbi1hcmdzIjsKY29uc3QgTDEwTl9FTEVNRU5UX1FVRVJZID0gYFske0wxME5JRF9BVFRSX05BTUV9XWA7CmNsYXNzIERPTUxvY2FsaXphdGlvbiBleHRlbmRzIExvY2FsaXphdGlvbiB7CiAgY29uc3RydWN0b3IocmVzb3VyY2VJZHMsIGdlbmVyYXRlQnVuZGxlcykgewogICAgc3VwZXIocmVzb3VyY2VJZHMsIGdlbmVyYXRlQnVuZGxlcyk7CiAgICB0aGlzLnJvb3RzID0gbmV3IFNldCgpOwogICAgdGhpcy5wZW5kaW5nckFGID0gbnVsbDsKICAgIHRoaXMucGVuZGluZ0VsZW1lbnRzID0gbmV3IFNldCgpOwogICAgdGhpcy53aW5kb3dFbGVtZW50ID0gbnVsbDsKICAgIHRoaXMubXV0YXRpb25PYnNlcnZlciA9IG51bGw7CiAgICB0aGlzLm9ic2VydmVyQ29uZmlnID0gewogICAgICBhdHRyaWJ1dGVzOiB0cnVlLAogICAgICBjaGFyYWN0ZXJEYXRhOiBmYWxzZSwKICAgICAgY2hpbGRMaXN0OiB0cnVlLAogICAgICBzdWJ0cmVlOiB0cnVlLAogICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFtMMTBOSURfQVRUUl9OQU1FLCBMMTBOQVJHU19BVFRSX05BTUVdCiAgICB9OwogIH0KICBvbkNoYW5nZShlYWdlciA9IGZhbHNlKSB7CiAgICBzdXBlci5vbkNoYW5nZShlYWdlcik7CiAgICBpZiAodGhpcy5yb290cykgewogICAgICB0aGlzLnRyYW5zbGF0ZVJvb3RzKCk7CiAgICB9CiAgfQogIHNldEF0dHJpYnV0ZXMoZWxlbWVudCwgaWQsIGFyZ3MpIHsKICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKEwxME5JRF9BVFRSX05BTUUsIGlkKTsKICAgIGlmIChhcmdzKSB7CiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKEwxME5BUkdTX0FUVFJfTkFNRSwgSlNPTi5zdHJpbmdpZnkoYXJncykpOwogICAgfSBlbHNlIHsKICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoTDEwTkFSR1NfQVRUUl9OQU1FKTsKICAgIH0KICAgIHJldHVybiBlbGVtZW50OwogIH0KICBnZXRBdHRyaWJ1dGVzKGVsZW1lbnQpIHsKICAgIHJldHVybiB7CiAgICAgIGlkOiBlbGVtZW50LmdldEF0dHJpYnV0ZShMMTBOSURfQVRUUl9OQU1FKSwKICAgICAgYXJnczogSlNPTi5wYXJzZShlbGVtZW50LmdldEF0dHJpYnV0ZShMMTBOQVJHU19BVFRSX05BTUUpIHx8IG51bGwpCiAgICB9OwogIH0KICBjb25uZWN0Um9vdChuZXdSb290KSB7CiAgICBmb3IgKGNvbnN0IHJvb3Qgb2YgdGhpcy5yb290cykgewogICAgICBpZiAocm9vdCA9PT0gbmV3Um9vdCB8fCByb290LmNvbnRhaW5zKG5ld1Jvb3QpIHx8IG5ld1Jvb3QuY29udGFpbnMocm9vdCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBhZGQgYSByb290IHRoYXQgb3ZlcmxhcHMgd2l0aCBleGlzdGluZyByb290LiIpOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy53aW5kb3dFbGVtZW50KSB7CiAgICAgIGlmICh0aGlzLndpbmRvd0VsZW1lbnQgIT09IG5ld1Jvb3Qub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldykgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNvbm5lY3QgYSByb290OgogICAgICAgICAgRE9NTG9jYWxpemF0aW9uIGFscmVhZHkgaGFzIGEgcm9vdCBmcm9tIGEgZGlmZmVyZW50IHdpbmRvdy5gKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy53aW5kb3dFbGVtZW50ID0gbmV3Um9vdC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3OwogICAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXIgPSBuZXcgdGhpcy53aW5kb3dFbGVtZW50Lk11dGF0aW9uT2JzZXJ2ZXIobXV0YXRpb25zID0+IHRoaXMudHJhbnNsYXRlTXV0YXRpb25zKG11dGF0aW9ucykpOwogICAgfQogICAgdGhpcy5yb290cy5hZGQobmV3Um9vdCk7CiAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShuZXdSb290LCB0aGlzLm9ic2VydmVyQ29uZmlnKTsKICB9CiAgZGlzY29ubmVjdFJvb3Qocm9vdCkgewogICAgdGhpcy5yb290cy5kZWxldGUocm9vdCk7CiAgICB0aGlzLnBhdXNlT2JzZXJ2aW5nKCk7CiAgICBpZiAodGhpcy5yb290cy5zaXplID09PSAwKSB7CiAgICAgIHRoaXMubXV0YXRpb25PYnNlcnZlciA9IG51bGw7CiAgICAgIGlmICh0aGlzLndpbmRvd0VsZW1lbnQgJiYgdGhpcy5wZW5kaW5nckFGKSB7CiAgICAgICAgdGhpcy53aW5kb3dFbGVtZW50LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMucGVuZGluZ3JBRik7CiAgICAgIH0KICAgICAgdGhpcy53aW5kb3dFbGVtZW50ID0gbnVsbDsKICAgICAgdGhpcy5wZW5kaW5nckFGID0gbnVsbDsKICAgICAgdGhpcy5wZW5kaW5nRWxlbWVudHMuY2xlYXIoKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICB0aGlzLnJlc3VtZU9ic2VydmluZygpOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICB0cmFuc2xhdGVSb290cygpIHsKICAgIGNvbnN0IHJvb3RzID0gQXJyYXkuZnJvbSh0aGlzLnJvb3RzKTsKICAgIHJldHVybiBQcm9taXNlLmFsbChyb290cy5tYXAocm9vdCA9PiB0aGlzLnRyYW5zbGF0ZUZyYWdtZW50KHJvb3QpKSk7CiAgfQogIHBhdXNlT2JzZXJ2aW5nKCkgewogICAgaWYgKCF0aGlzLm11dGF0aW9uT2JzZXJ2ZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy50cmFuc2xhdGVNdXRhdGlvbnModGhpcy5tdXRhdGlvbk9ic2VydmVyLnRha2VSZWNvcmRzKCkpOwogICAgdGhpcy5tdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICB9CiAgcmVzdW1lT2JzZXJ2aW5nKCkgewogICAgaWYgKCF0aGlzLm11dGF0aW9uT2JzZXJ2ZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCByb290IG9mIHRoaXMucm9vdHMpIHsKICAgICAgdGhpcy5tdXRhdGlvbk9ic2VydmVyLm9ic2VydmUocm9vdCwgdGhpcy5vYnNlcnZlckNvbmZpZyk7CiAgICB9CiAgfQogIHRyYW5zbGF0ZU11dGF0aW9ucyhtdXRhdGlvbnMpIHsKICAgIGZvciAoY29uc3QgbXV0YXRpb24gb2YgbXV0YXRpb25zKSB7CiAgICAgIHN3aXRjaCAobXV0YXRpb24udHlwZSkgewogICAgICAgIGNhc2UgImF0dHJpYnV0ZXMiOgogICAgICAgICAgaWYgKG11dGF0aW9uLnRhcmdldC5oYXNBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIpKSB7CiAgICAgICAgICAgIHRoaXMucGVuZGluZ0VsZW1lbnRzLmFkZChtdXRhdGlvbi50YXJnZXQpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiY2hpbGRMaXN0IjoKICAgICAgICAgIGZvciAoY29uc3QgYWRkZWROb2RlIG9mIG11dGF0aW9uLmFkZGVkTm9kZXMpIHsKICAgICAgICAgICAgaWYgKGFkZGVkTm9kZS5ub2RlVHlwZSA9PT0gYWRkZWROb2RlLkVMRU1FTlRfTk9ERSkgewogICAgICAgICAgICAgIGlmIChhZGRlZE5vZGUuY2hpbGRFbGVtZW50Q291bnQpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiB0aGlzLmdldFRyYW5zbGF0YWJsZXMoYWRkZWROb2RlKSkgewogICAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdFbGVtZW50cy5hZGQoZWxlbWVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChhZGRlZE5vZGUuaGFzQXR0cmlidXRlKEwxME5JRF9BVFRSX05BTUUpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdFbGVtZW50cy5hZGQoYWRkZWROb2RlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5wZW5kaW5nRWxlbWVudHMuc2l6ZSA+IDApIHsKICAgICAgaWYgKHRoaXMucGVuZGluZ3JBRiA9PT0gbnVsbCkgewogICAgICAgIHRoaXMucGVuZGluZ3JBRiA9IHRoaXMud2luZG93RWxlbWVudC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gewogICAgICAgICAgdGhpcy50cmFuc2xhdGVFbGVtZW50cyhBcnJheS5mcm9tKHRoaXMucGVuZGluZ0VsZW1lbnRzKSk7CiAgICAgICAgICB0aGlzLnBlbmRpbmdFbGVtZW50cy5jbGVhcigpOwogICAgICAgICAgdGhpcy5wZW5kaW5nckFGID0gbnVsbDsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0KICB0cmFuc2xhdGVGcmFnbWVudChmcmFnKSB7CiAgICByZXR1cm4gdGhpcy50cmFuc2xhdGVFbGVtZW50cyh0aGlzLmdldFRyYW5zbGF0YWJsZXMoZnJhZykpOwogIH0KICBhc3luYyB0cmFuc2xhdGVFbGVtZW50cyhlbGVtZW50cykgewogICAgaWYgKCFlbGVtZW50cy5sZW5ndGgpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGNvbnN0IGtleXMgPSBlbGVtZW50cy5tYXAodGhpcy5nZXRLZXlzRm9yRWxlbWVudCk7CiAgICBjb25zdCB0cmFuc2xhdGlvbnMgPSBhd2FpdCB0aGlzLmZvcm1hdE1lc3NhZ2VzKGtleXMpOwogICAgcmV0dXJuIHRoaXMuYXBwbHlUcmFuc2xhdGlvbnMoZWxlbWVudHMsIHRyYW5zbGF0aW9ucyk7CiAgfQogIGFwcGx5VHJhbnNsYXRpb25zKGVsZW1lbnRzLCB0cmFuc2xhdGlvbnMpIHsKICAgIHRoaXMucGF1c2VPYnNlcnZpbmcoKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHRyYW5zbGF0aW9uc1tpXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdHJhbnNsYXRlRWxlbWVudChlbGVtZW50c1tpXSwgdHJhbnNsYXRpb25zW2ldKTsKICAgICAgfQogICAgfQogICAgdGhpcy5yZXN1bWVPYnNlcnZpbmcoKTsKICB9CiAgZ2V0VHJhbnNsYXRhYmxlcyhlbGVtZW50KSB7CiAgICBjb25zdCBub2RlcyA9IEFycmF5LmZyb20oZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKEwxME5fRUxFTUVOVF9RVUVSWSkpOwogICAgaWYgKHR5cGVvZiBlbGVtZW50Lmhhc0F0dHJpYnV0ZSA9PT0gImZ1bmN0aW9uIiAmJiBlbGVtZW50Lmhhc0F0dHJpYnV0ZShMMTBOSURfQVRUUl9OQU1FKSkgewogICAgICBub2Rlcy5wdXNoKGVsZW1lbnQpOwogICAgfQogICAgcmV0dXJuIG5vZGVzOwogIH0KICBnZXRLZXlzRm9yRWxlbWVudChlbGVtZW50KSB7CiAgICByZXR1cm4gewogICAgICBpZDogZWxlbWVudC5nZXRBdHRyaWJ1dGUoTDEwTklEX0FUVFJfTkFNRSksCiAgICAgIGFyZ3M6IEpTT04ucGFyc2UoZWxlbWVudC5nZXRBdHRyaWJ1dGUoTDEwTkFSR1NfQVRUUl9OQU1FKSB8fCBudWxsKQogICAgfTsKICB9Cn0KOy8vIC4vbm9kZV9tb2R1bGVzL0BmbHVlbnQvZG9tL2VzbS9pbmRleC5qcwoKCjsvLyAuL3dlYi9sMTBuLmpzCmNsYXNzIEwxMG4gewogICNkaXI7CiAgI2VsZW1lbnRzOwogICNsYW5nOwogICNsMTBuOwogIGNvbnN0cnVjdG9yKHsKICAgIGxhbmcsCiAgICBpc1JUTAogIH0sIGwxMG4gPSBudWxsKSB7CiAgICB0aGlzLiNsYW5nID0gTDEwbi4jZml4dXBMYW5nQ29kZShsYW5nKTsKICAgIHRoaXMuI2wxMG4gPSBsMTBuOwogICAgdGhpcy4jZGlyID0gaXNSVEwgPz8gTDEwbi4jaXNSVEwodGhpcy4jbGFuZykgPyAicnRsIiA6ICJsdHIiOwogIH0KICBfc2V0TDEwbihsMTBuKSB7CiAgICB0aGlzLiNsMTBuID0gbDEwbjsKICB9CiAgZ2V0TGFuZ3VhZ2UoKSB7CiAgICByZXR1cm4gdGhpcy4jbGFuZzsKICB9CiAgZ2V0RGlyZWN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuI2RpcjsKICB9CiAgYXN5bmMgZ2V0KGlkcywgYXJncyA9IG51bGwsIGZhbGxiYWNrKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheShpZHMpKSB7CiAgICAgIGlkcyA9IGlkcy5tYXAoaWQgPT4gKHsKICAgICAgICBpZAogICAgICB9KSk7CiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgdGhpcy4jbDEwbi5mb3JtYXRNZXNzYWdlcyhpZHMpOwogICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1lc3NhZ2UgPT4gbWVzc2FnZS52YWx1ZSk7CiAgICB9CiAgICBjb25zdCBtZXNzYWdlcyA9IGF3YWl0IHRoaXMuI2wxMG4uZm9ybWF0TWVzc2FnZXMoW3sKICAgICAgaWQ6IGlkcywKICAgICAgYXJncwogICAgfV0pOwogICAgcmV0dXJuIG1lc3NhZ2VzWzBdPy52YWx1ZSB8fCBmYWxsYmFjazsKICB9CiAgYXN5bmMgdHJhbnNsYXRlKGVsZW1lbnQpIHsKICAgICh0aGlzLiNlbGVtZW50cyB8fD0gbmV3IFNldCgpKS5hZGQoZWxlbWVudCk7CiAgICB0cnkgewogICAgICB0aGlzLiNsMTBuLmNvbm5lY3RSb290KGVsZW1lbnQpOwogICAgICBhd2FpdCB0aGlzLiNsMTBuLnRyYW5zbGF0ZVJvb3RzKCk7CiAgICB9IGNhdGNoIHt9CiAgfQogIGFzeW5jIHRyYW5zbGF0ZU9uY2UoZWxlbWVudCkgewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy4jbDEwbi50cmFuc2xhdGVFbGVtZW50cyhbZWxlbWVudF0pOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgY29uc29sZS5lcnJvcigidHJhbnNsYXRlT25jZToiLCBleCk7CiAgICB9CiAgfQogIGFzeW5jIGRlc3Ryb3koKSB7CiAgICBpZiAodGhpcy4jZWxlbWVudHMpIHsKICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIHRoaXMuI2VsZW1lbnRzKSB7CiAgICAgICAgdGhpcy4jbDEwbi5kaXNjb25uZWN0Um9vdChlbGVtZW50KTsKICAgICAgfQogICAgICB0aGlzLiNlbGVtZW50cy5jbGVhcigpOwogICAgICB0aGlzLiNlbGVtZW50cyA9IG51bGw7CiAgICB9CiAgICB0aGlzLiNsMTBuLnBhdXNlT2JzZXJ2aW5nKCk7CiAgfQogIHBhdXNlKCkgewogICAgdGhpcy4jbDEwbi5wYXVzZU9ic2VydmluZygpOwogIH0KICByZXN1bWUoKSB7CiAgICB0aGlzLiNsMTBuLnJlc3VtZU9ic2VydmluZygpOwogIH0KICBzdGF0aWMgI2ZpeHVwTGFuZ0NvZGUobGFuZ0NvZGUpIHsKICAgIGxhbmdDb2RlID0gbGFuZ0NvZGU/LnRvTG93ZXJDYXNlKCkgfHwgImVuLXVzIjsKICAgIGNvbnN0IFBBUlRJQUxfTEFOR19DT0RFUyA9IHsKICAgICAgZW46ICJlbi11cyIsCiAgICAgIGVzOiAiZXMtZXMiLAogICAgICBmeTogImZ5LW5sIiwKICAgICAgZ2E6ICJnYS1pZSIsCiAgICAgIGd1OiAiZ3UtaW4iLAogICAgICBoaTogImhpLWluIiwKICAgICAgaHk6ICJoeS1hbSIsCiAgICAgIG5iOiAibmItbm8iLAogICAgICBuZTogIm5lLW5wIiwKICAgICAgbm46ICJubi1ubyIsCiAgICAgIHBhOiAicGEtaW4iLAogICAgICBwdDogInB0LXB0IiwKICAgICAgc3Y6ICJzdi1zZSIsCiAgICAgIHpoOiAiemgtY24iCiAgICB9OwogICAgcmV0dXJuIFBBUlRJQUxfTEFOR19DT0RFU1tsYW5nQ29kZV0gfHwgbGFuZ0NvZGU7CiAgfQogIHN0YXRpYyAjaXNSVEwobGFuZykgewogICAgY29uc3Qgc2hvcnRDb2RlID0gbGFuZy5zcGxpdCgiLSIsIDEpWzBdOwogICAgcmV0dXJuIFsiYXIiLCAiaGUiLCAiZmEiLCAicHMiLCAidXIiXS5pbmNsdWRlcyhzaG9ydENvZGUpOwogIH0KfQpjb25zdCBHZW5lcmljTDEwbiA9IG51bGw7Cgo7Ly8gLi93ZWIvZ2VuZXJpY2wxMG4uanMKCgoKCmZ1bmN0aW9uIFBMQVRGT1JNKCkgewogIGNvbnN0IHsKICAgIGlzQW5kcm9pZCwKICAgIGlzTGludXgsCiAgICBpc01hYywKICAgIGlzV2luZG93cwogIH0gPSBGZWF0dXJlVGVzdC5wbGF0Zm9ybTsKICBpZiAoaXNMaW51eCkgewogICAgcmV0dXJuICJsaW51eCI7CiAgfQogIGlmIChpc1dpbmRvd3MpIHsKICAgIHJldHVybiAid2luZG93cyI7CiAgfQogIGlmIChpc01hYykgewogICAgcmV0dXJuICJtYWNvcyI7CiAgfQogIGlmIChpc0FuZHJvaWQpIHsKICAgIHJldHVybiAiYW5kcm9pZCI7CiAgfQogIHJldHVybiAib3RoZXIiOwp9CmZ1bmN0aW9uIGNyZWF0ZUJ1bmRsZShsYW5nLCB0ZXh0KSB7CiAgY29uc3QgcmVzb3VyY2UgPSBuZXcgRmx1ZW50UmVzb3VyY2UodGV4dCk7CiAgY29uc3QgYnVuZGxlID0gbmV3IEZsdWVudEJ1bmRsZShsYW5nLCB7CiAgICBmdW5jdGlvbnM6IHsKICAgICAgUExBVEZPUk0KICAgIH0KICB9KTsKICBjb25zdCBlcnJvcnMgPSBidW5kbGUuYWRkUmVzb3VyY2UocmVzb3VyY2UpOwogIGlmIChlcnJvcnMubGVuZ3RoKSB7CiAgICBjb25zb2xlLmVycm9yKCJMMTBuIGVycm9ycyIsIGVycm9ycyk7CiAgfQogIHJldHVybiBidW5kbGU7Cn0KY2xhc3MgZ2VuZXJpY2wxMG5fR2VuZXJpY0wxMG4gZXh0ZW5kcyBMMTBuIHsKICBjb25zdHJ1Y3RvcihsYW5nKSB7CiAgICBzdXBlcih7CiAgICAgIGxhbmcKICAgIH0pOwogICAgY29uc3QgZ2VuZXJhdGVCdW5kbGVzID0gIWxhbmcgPyBnZW5lcmljbDEwbl9HZW5lcmljTDEwbi4jZ2VuZXJhdGVCdW5kbGVzRmFsbGJhY2suYmluZChnZW5lcmljbDEwbl9HZW5lcmljTDEwbiwgdGhpcy5nZXRMYW5ndWFnZSgpKSA6IGdlbmVyaWNsMTBuX0dlbmVyaWNMMTBuLiNnZW5lcmF0ZUJ1bmRsZXMuYmluZChnZW5lcmljbDEwbl9HZW5lcmljTDEwbiwgImVuLXVzIiwgdGhpcy5nZXRMYW5ndWFnZSgpKTsKICAgIHRoaXMuX3NldEwxMG4obmV3IERPTUxvY2FsaXphdGlvbihbXSwgZ2VuZXJhdGVCdW5kbGVzKSk7CiAgfQogIHN0YXRpYyBhc3luYyAqI2dlbmVyYXRlQnVuZGxlcyhkZWZhdWx0TGFuZywgYmFzZUxhbmcpIHsKICAgIGNvbnN0IHsKICAgICAgYmFzZVVSTCwKICAgICAgcGF0aHMKICAgIH0gPSBhd2FpdCB0aGlzLiNnZXRQYXRocygpOwogICAgY29uc3QgbGFuZ3MgPSBbYmFzZUxhbmddOwogICAgaWYgKGRlZmF1bHRMYW5nICE9PSBiYXNlTGFuZykgewogICAgICBjb25zdCBzaG9ydExhbmcgPSBiYXNlTGFuZy5zcGxpdCgiLSIsIDEpWzBdOwogICAgICBpZiAoc2hvcnRMYW5nICE9PSBiYXNlTGFuZykgewogICAgICAgIGxhbmdzLnB1c2goc2hvcnRMYW5nKTsKICAgICAgfQogICAgICBsYW5ncy5wdXNoKGRlZmF1bHRMYW5nKTsKICAgIH0KICAgIGNvbnN0IGJ1bmRsZXMgPSBsYW5ncy5tYXAobGFuZyA9PiBbbGFuZywgdGhpcy4jY3JlYXRlQnVuZGxlKGxhbmcsIGJhc2VVUkwsIHBhdGhzKV0pOwogICAgZm9yIChjb25zdCBbbGFuZywgYnVuZGxlUHJvbWlzZV0gb2YgYnVuZGxlcykgewogICAgICBjb25zdCBidW5kbGUgPSBhd2FpdCBidW5kbGVQcm9taXNlOwogICAgICBpZiAoYnVuZGxlKSB7CiAgICAgICAgeWllbGQgYnVuZGxlOwogICAgICB9IGVsc2UgaWYgKGxhbmcgPT09ICJlbi11cyIpIHsKICAgICAgICB5aWVsZCB0aGlzLiNjcmVhdGVCdW5kbGVGYWxsYmFjayhsYW5nKTsKICAgICAgfQogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgI2NyZWF0ZUJ1bmRsZShsYW5nLCBiYXNlVVJMLCBwYXRocykgewogICAgY29uc3QgcGF0aCA9IHBhdGhzW2xhbmddOwogICAgaWYgKCFwYXRoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgdXJsID0gbmV3IFVSTChwYXRoLCBiYXNlVVJMKTsKICAgIGNvbnN0IHRleHQgPSBhd2FpdCBmZXRjaERhdGEodXJsLCAidGV4dCIpOwogICAgcmV0dXJuIGNyZWF0ZUJ1bmRsZShsYW5nLCB0ZXh0KTsKICB9CiAgc3RhdGljIGFzeW5jICNnZXRQYXRocygpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBocmVmCiAgICAgIH0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBsaW5rW3R5cGU9ImFwcGxpY2F0aW9uL2wxMG4iXWApOwogICAgICBjb25zdCBwYXRocyA9IGF3YWl0IGZldGNoRGF0YShocmVmLCAianNvbiIpOwogICAgICByZXR1cm4gewogICAgICAgIGJhc2VVUkw6IGhyZWYuc3Vic3RyaW5nKDAsIGhyZWYubGFzdEluZGV4T2YoIi8iKSArIDEpIHx8ICIuLyIsCiAgICAgICAgcGF0aHMKICAgICAgfTsKICAgIH0gY2F0Y2gge30KICAgIHJldHVybiB7CiAgICAgIGJhc2VVUkw6ICIuLyIsCiAgICAgIHBhdGhzOiBPYmplY3QuY3JlYXRlKG51bGwpCiAgICB9OwogIH0KICBzdGF0aWMgYXN5bmMgKiNnZW5lcmF0ZUJ1bmRsZXNGYWxsYmFjayhsYW5nKSB7CiAgICB5aWVsZCB0aGlzLiNjcmVhdGVCdW5kbGVGYWxsYmFjayhsYW5nKTsKICB9CiAgc3RhdGljIGFzeW5jICNjcmVhdGVCdW5kbGVGYWxsYmFjayhsYW5nKSB7CiAgICBjb25zdCB0ZXh0ID0gInBkZmpzLXByZXZpb3VzLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gUHJldmlvdXMgUGFnZVxucGRmanMtcHJldmlvdXMtYnV0dG9uLWxhYmVsID0gUHJldmlvdXNcbnBkZmpzLW5leHQtYnV0dG9uID1cbiAgICAudGl0bGUgPSBOZXh0IFBhZ2VcbnBkZmpzLW5leHQtYnV0dG9uLWxhYmVsID0gTmV4dFxucGRmanMtcGFnZS1pbnB1dCA9XG4gICAgLnRpdGxlID0gUGFnZVxucGRmanMtb2YtcGFnZXMgPSBvZiB7ICRwYWdlc0NvdW50IH1cbnBkZmpzLXBhZ2Utb2YtcGFnZXMgPSAoeyAkcGFnZU51bWJlciB9IG9mIHsgJHBhZ2VzQ291bnQgfSlcbnBkZmpzLXpvb20tb3V0LWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gWm9vbSBPdXRcbnBkZmpzLXpvb20tb3V0LWJ1dHRvbi1sYWJlbCA9IFpvb20gT3V0XG5wZGZqcy16b29tLWluLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gWm9vbSBJblxucGRmanMtem9vbS1pbi1idXR0b24tbGFiZWwgPSBab29tIEluXG5wZGZqcy16b29tLXNlbGVjdCA9XG4gICAgLnRpdGxlID0gWm9vbVxucGRmanMtcHJlc2VudGF0aW9uLW1vZGUtYnV0dG9uID1cbiAgICAudGl0bGUgPSBTd2l0Y2ggdG8gUHJlc2VudGF0aW9uIE1vZGVcbnBkZmpzLXByZXNlbnRhdGlvbi1tb2RlLWJ1dHRvbi1sYWJlbCA9IFByZXNlbnRhdGlvbiBNb2RlXG5wZGZqcy1vcGVuLWZpbGUtYnV0dG9uID1cbiAgICAudGl0bGUgPSBPcGVuIEZpbGVcbnBkZmpzLW9wZW4tZmlsZS1idXR0b24tbGFiZWwgPSBPcGVuXG5wZGZqcy1wcmludC1idXR0b24gPVxuICAgIC50aXRsZSA9IFByaW50XG5wZGZqcy1wcmludC1idXR0b24tbGFiZWwgPSBQcmludFxucGRmanMtc2F2ZS1idXR0b24gPVxuICAgIC50aXRsZSA9IFNhdmVcbnBkZmpzLXNhdmUtYnV0dG9uLWxhYmVsID0gU2F2ZVxucGRmanMtZG93bmxvYWQtYnV0dG9uID1cbiAgICAudGl0bGUgPSBEb3dubG9hZFxucGRmanMtZG93bmxvYWQtYnV0dG9uLWxhYmVsID0gRG93bmxvYWRcbnBkZmpzLWJvb2ttYXJrLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gQ3VycmVudCBQYWdlIChWaWV3IFVSTCBmcm9tIEN1cnJlbnQgUGFnZSlcbnBkZmpzLWJvb2ttYXJrLWJ1dHRvbi1sYWJlbCA9IEN1cnJlbnQgUGFnZVxucGRmanMtdG9vbHMtYnV0dG9uID1cbiAgICAudGl0bGUgPSBUb29sc1xucGRmanMtdG9vbHMtYnV0dG9uLWxhYmVsID0gVG9vbHNcbnBkZmpzLWZpcnN0LXBhZ2UtYnV0dG9uID1cbiAgICAudGl0bGUgPSBHbyB0byBGaXJzdCBQYWdlXG5wZGZqcy1maXJzdC1wYWdlLWJ1dHRvbi1sYWJlbCA9IEdvIHRvIEZpcnN0IFBhZ2VcbnBkZmpzLWxhc3QtcGFnZS1idXR0b24gPVxuICAgIC50aXRsZSA9IEdvIHRvIExhc3QgUGFnZVxucGRmanMtbGFzdC1wYWdlLWJ1dHRvbi1sYWJlbCA9IEdvIHRvIExhc3QgUGFnZVxucGRmanMtcGFnZS1yb3RhdGUtY3ctYnV0dG9uID1cbiAgICAudGl0bGUgPSBSb3RhdGUgQ2xvY2t3aXNlXG5wZGZqcy1wYWdlLXJvdGF0ZS1jdy1idXR0b24tbGFiZWwgPSBSb3RhdGUgQ2xvY2t3aXNlXG5wZGZqcy1wYWdlLXJvdGF0ZS1jY3ctYnV0dG9uID1cbiAgICAudGl0bGUgPSBSb3RhdGUgQ291bnRlcmNsb2Nrd2lzZVxucGRmanMtcGFnZS1yb3RhdGUtY2N3LWJ1dHRvbi1sYWJlbCA9IFJvdGF0ZSBDb3VudGVyY2xvY2t3aXNlXG5wZGZqcy1jdXJzb3ItdGV4dC1zZWxlY3QtdG9vbC1idXR0b24gPVxuICAgIC50aXRsZSA9IEVuYWJsZSBUZXh0IFNlbGVjdGlvbiBUb29sXG5wZGZqcy1jdXJzb3ItdGV4dC1zZWxlY3QtdG9vbC1idXR0b24tbGFiZWwgPSBUZXh0IFNlbGVjdGlvbiBUb29sXG5wZGZqcy1jdXJzb3ItaGFuZC10b29sLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gRW5hYmxlIEhhbmQgVG9vbFxucGRmanMtY3Vyc29yLWhhbmQtdG9vbC1idXR0b24tbGFiZWwgPSBIYW5kIFRvb2xcbnBkZmpzLXNjcm9sbC1wYWdlLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gVXNlIFBhZ2UgU2Nyb2xsaW5nXG5wZGZqcy1zY3JvbGwtcGFnZS1idXR0b24tbGFiZWwgPSBQYWdlIFNjcm9sbGluZ1xucGRmanMtc2Nyb2xsLXZlcnRpY2FsLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gVXNlIFZlcnRpY2FsIFNjcm9sbGluZ1xucGRmanMtc2Nyb2xsLXZlcnRpY2FsLWJ1dHRvbi1sYWJlbCA9IFZlcnRpY2FsIFNjcm9sbGluZ1xucGRmanMtc2Nyb2xsLWhvcml6b250YWwtYnV0dG9uID1cbiAgICAudGl0bGUgPSBVc2UgSG9yaXpvbnRhbCBTY3JvbGxpbmdcbnBkZmpzLXNjcm9sbC1ob3Jpem9udGFsLWJ1dHRvbi1sYWJlbCA9IEhvcml6b250YWwgU2Nyb2xsaW5nXG5wZGZqcy1zY3JvbGwtd3JhcHBlZC1idXR0b24gPVxuICAgIC50aXRsZSA9IFVzZSBXcmFwcGVkIFNjcm9sbGluZ1xucGRmanMtc2Nyb2xsLXdyYXBwZWQtYnV0dG9uLWxhYmVsID0gV3JhcHBlZCBTY3JvbGxpbmdcbnBkZmpzLXNwcmVhZC1ub25lLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gRG8gbm90IGpvaW4gcGFnZSBzcHJlYWRzXG5wZGZqcy1zcHJlYWQtbm9uZS1idXR0b24tbGFiZWwgPSBObyBTcHJlYWRzXG5wZGZqcy1zcHJlYWQtb2RkLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gSm9pbiBwYWdlIHNwcmVhZHMgc3RhcnRpbmcgd2l0aCBvZGQtbnVtYmVyZWQgcGFnZXNcbnBkZmpzLXNwcmVhZC1vZGQtYnV0dG9uLWxhYmVsID0gT2RkIFNwcmVhZHNcbnBkZmpzLXNwcmVhZC1ldmVuLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gSm9pbiBwYWdlIHNwcmVhZHMgc3RhcnRpbmcgd2l0aCBldmVuLW51bWJlcmVkIHBhZ2VzXG5wZGZqcy1zcHJlYWQtZXZlbi1idXR0b24tbGFiZWwgPSBFdmVuIFNwcmVhZHNcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtYnV0dG9uID1cbiAgICAudGl0bGUgPSBEb2N1bWVudCBQcm9wZXJ0aWVzXHUyMDI2XG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLWJ1dHRvbi1sYWJlbCA9IERvY3VtZW50IFByb3BlcnRpZXNcdTIwMjZcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtZmlsZS1uYW1lID0gRmlsZSBuYW1lOlxucGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1maWxlLXNpemUgPSBGaWxlIHNpemU6XG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLXNpemUta2IgPSB7IE5VTUJFUigka2IsIG1heGltdW1TaWduaWZpY2FudERpZ2l0czogMykgfSBLQiAoeyAkYiB9IGJ5dGVzKVxucGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1zaXplLW1iID0geyBOVU1CRVIoJG1iLCBtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHM6IDMpIH0gTUIgKHsgJGIgfSBieXRlcylcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtdGl0bGUgPSBUaXRsZTpcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtYXV0aG9yID0gQXV0aG9yOlxucGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1zdWJqZWN0ID0gU3ViamVjdDpcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMta2V5d29yZHMgPSBLZXl3b3JkczpcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtY3JlYXRpb24tZGF0ZSA9IENyZWF0aW9uIERhdGU6XG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLW1vZGlmaWNhdGlvbi1kYXRlID0gTW9kaWZpY2F0aW9uIERhdGU6XG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLWRhdGUtdGltZS1zdHJpbmcgPSB7IERBVEVUSU1FKCRkYXRlT2JqLCBkYXRlU3R5bGU6IFwic2hvcnRcIiwgdGltZVN0eWxlOiBcIm1lZGl1bVwiKSB9XG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLWNyZWF0b3IgPSBDcmVhdG9yOlxucGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wcm9kdWNlciA9IFBERiBQcm9kdWNlcjpcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtdmVyc2lvbiA9IFBERiBWZXJzaW9uOlxucGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wYWdlLWNvdW50ID0gUGFnZSBDb3VudDpcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtcGFnZS1zaXplID0gUGFnZSBTaXplOlxucGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wYWdlLXNpemUtdW5pdC1pbmNoZXMgPSBpblxucGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wYWdlLXNpemUtdW5pdC1taWxsaW1ldGVycyA9IG1tXG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLXBhZ2Utc2l6ZS1vcmllbnRhdGlvbi1wb3J0cmFpdCA9IHBvcnRyYWl0XG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLXBhZ2Utc2l6ZS1vcmllbnRhdGlvbi1sYW5kc2NhcGUgPSBsYW5kc2NhcGVcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtcGFnZS1zaXplLW5hbWUtYS10aHJlZSA9IEEzXG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLXBhZ2Utc2l6ZS1uYW1lLWEtZm91ciA9IEE0XG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLXBhZ2Utc2l6ZS1uYW1lLWxldHRlciA9IExldHRlclxucGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wYWdlLXNpemUtbmFtZS1sZWdhbCA9IExlZ2FsXG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLXBhZ2Utc2l6ZS1kaW1lbnNpb24tc3RyaW5nID0geyAkd2lkdGggfSBceEQ3IHsgJGhlaWdodCB9IHsgJHVuaXQgfSAoeyAkb3JpZW50YXRpb24gfSlcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtcGFnZS1zaXplLWRpbWVuc2lvbi1uYW1lLXN0cmluZyA9IHsgJHdpZHRoIH0gXHhENyB7ICRoZWlnaHQgfSB7ICR1bml0IH0gKHsgJG5hbWUgfSwgeyAkb3JpZW50YXRpb24gfSlcbnBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtbGluZWFyaXplZCA9IEZhc3QgV2ViIFZpZXc6XG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLWxpbmVhcml6ZWQteWVzID0gWWVzXG5wZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLWxpbmVhcml6ZWQtbm8gPSBOb1xucGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1jbG9zZS1idXR0b24gPSBDbG9zZVxucGRmanMtcHJpbnQtcHJvZ3Jlc3MtbWVzc2FnZSA9IFByZXBhcmluZyBkb2N1bWVudCBmb3IgcHJpbnRpbmdcdTIwMjZcbnBkZmpzLXByaW50LXByb2dyZXNzLXBlcmNlbnQgPSB7ICRwcm9ncmVzcyB9JVxucGRmanMtcHJpbnQtcHJvZ3Jlc3MtY2xvc2UtYnV0dG9uID0gQ2FuY2VsXG5wZGZqcy1wcmludGluZy1ub3Qtc3VwcG9ydGVkID0gV2FybmluZzogUHJpbnRpbmcgaXMgbm90IGZ1bGx5IHN1cHBvcnRlZCBieSB0aGlzIGJyb3dzZXIuXG5wZGZqcy1wcmludGluZy1ub3QtcmVhZHkgPSBXYXJuaW5nOiBUaGUgUERGIGlzIG5vdCBmdWxseSBsb2FkZWQgZm9yIHByaW50aW5nLlxucGRmanMtdG9nZ2xlLXNpZGViYXItYnV0dG9uID1cbiAgICAudGl0bGUgPSBUb2dnbGUgU2lkZWJhclxucGRmanMtdG9nZ2xlLXNpZGViYXItbm90aWZpY2F0aW9uLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gVG9nZ2xlIFNpZGViYXIgKGRvY3VtZW50IGNvbnRhaW5zIG91dGxpbmUvYXR0YWNobWVudHMvbGF5ZXJzKVxucGRmanMtdG9nZ2xlLXNpZGViYXItYnV0dG9uLWxhYmVsID0gVG9nZ2xlIFNpZGViYXJcbnBkZmpzLWRvY3VtZW50LW91dGxpbmUtYnV0dG9uID1cbiAgICAudGl0bGUgPSBTaG93IERvY3VtZW50IE91dGxpbmUgKGRvdWJsZS1jbGljayB0byBleHBhbmQvY29sbGFwc2UgYWxsIGl0ZW1zKVxucGRmanMtZG9jdW1lbnQtb3V0bGluZS1idXR0b24tbGFiZWwgPSBEb2N1bWVudCBPdXRsaW5lXG5wZGZqcy1hdHRhY2htZW50cy1idXR0b24gPVxuICAgIC50aXRsZSA9IFNob3cgQXR0YWNobWVudHNcbnBkZmpzLWF0dGFjaG1lbnRzLWJ1dHRvbi1sYWJlbCA9IEF0dGFjaG1lbnRzXG5wZGZqcy1sYXllcnMtYnV0dG9uID1cbiAgICAudGl0bGUgPSBTaG93IExheWVycyAoZG91YmxlLWNsaWNrIHRvIHJlc2V0IGFsbCBsYXllcnMgdG8gdGhlIGRlZmF1bHQgc3RhdGUpXG5wZGZqcy1sYXllcnMtYnV0dG9uLWxhYmVsID0gTGF5ZXJzXG5wZGZqcy10aHVtYnMtYnV0dG9uID1cbiAgICAudGl0bGUgPSBTaG93IFRodW1ibmFpbHNcbnBkZmpzLXRodW1icy1idXR0b24tbGFiZWwgPSBUaHVtYm5haWxzXG5wZGZqcy1jdXJyZW50LW91dGxpbmUtaXRlbS1idXR0b24gPVxuICAgIC50aXRsZSA9IEZpbmQgQ3VycmVudCBPdXRsaW5lIEl0ZW1cbnBkZmpzLWN1cnJlbnQtb3V0bGluZS1pdGVtLWJ1dHRvbi1sYWJlbCA9IEN1cnJlbnQgT3V0bGluZSBJdGVtXG5wZGZqcy1maW5kYmFyLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gRmluZCBpbiBEb2N1bWVudFxucGRmanMtZmluZGJhci1idXR0b24tbGFiZWwgPSBGaW5kXG5wZGZqcy1hZGRpdGlvbmFsLWxheWVycyA9IEFkZGl0aW9uYWwgTGF5ZXJzXG5wZGZqcy10aHVtYi1wYWdlLXRpdGxlID1cbiAgICAudGl0bGUgPSBQYWdlIHsgJHBhZ2UgfVxucGRmanMtdGh1bWItcGFnZS1jYW52YXMgPVxuICAgIC5hcmlhLWxhYmVsID0gVGh1bWJuYWlsIG9mIFBhZ2UgeyAkcGFnZSB9XG5wZGZqcy1maW5kLWlucHV0ID1cbiAgICAudGl0bGUgPSBGaW5kXG4gICAgLnBsYWNlaG9sZGVyID0gRmluZCBpbiBkb2N1bWVudFx1MjAyNlxucGRmanMtZmluZC1wcmV2aW91cy1idXR0b24gPVxuICAgIC50aXRsZSA9IEZpbmQgdGhlIHByZXZpb3VzIG9jY3VycmVuY2Ugb2YgdGhlIHBocmFzZVxucGRmanMtZmluZC1wcmV2aW91cy1idXR0b24tbGFiZWwgPSBQcmV2aW91c1xucGRmanMtZmluZC1uZXh0LWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gRmluZCB0aGUgbmV4dCBvY2N1cnJlbmNlIG9mIHRoZSBwaHJhc2VcbnBkZmpzLWZpbmQtbmV4dC1idXR0b24tbGFiZWwgPSBOZXh0XG5wZGZqcy1maW5kLWhpZ2hsaWdodC1jaGVja2JveCA9IEhpZ2hsaWdodCBBbGxcbnBkZmpzLWZpbmQtbWF0Y2gtY2FzZS1jaGVja2JveC1sYWJlbCA9IE1hdGNoIENhc2VcbnBkZmpzLWZpbmQtbWF0Y2gtZGlhY3JpdGljcy1jaGVja2JveC1sYWJlbCA9IE1hdGNoIERpYWNyaXRpY3NcbnBkZmpzLWZpbmQtZW50aXJlLXdvcmQtY2hlY2tib3gtbGFiZWwgPSBXaG9sZSBXb3Jkc1xucGRmanMtZmluZC1yZWFjaGVkLXRvcCA9IFJlYWNoZWQgdG9wIG9mIGRvY3VtZW50LCBjb250aW51ZWQgZnJvbSBib3R0b21cbnBkZmpzLWZpbmQtcmVhY2hlZC1ib3R0b20gPSBSZWFjaGVkIGVuZCBvZiBkb2N1bWVudCwgY29udGludWVkIGZyb20gdG9wXG5wZGZqcy1maW5kLW1hdGNoLWNvdW50ID1cbiAgICB7ICR0b3RhbCAtPlxuICAgICAgICBbb25lXSB7ICRjdXJyZW50IH0gb2YgeyAkdG90YWwgfSBtYXRjaFxuICAgICAgICpbb3RoZXJdIHsgJGN1cnJlbnQgfSBvZiB7ICR0b3RhbCB9IG1hdGNoZXNcbiAgICB9XG5wZGZqcy1maW5kLW1hdGNoLWNvdW50LWxpbWl0ID1cbiAgICB7ICRsaW1pdCAtPlxuICAgICAgICBbb25lXSBNb3JlIHRoYW4geyAkbGltaXQgfSBtYXRjaFxuICAgICAgICpbb3RoZXJdIE1vcmUgdGhhbiB7ICRsaW1pdCB9IG1hdGNoZXNcbiAgICB9XG5wZGZqcy1maW5kLW5vdC1mb3VuZCA9IFBocmFzZSBub3QgZm91bmRcbnBkZmpzLXBhZ2Utc2NhbGUtd2lkdGggPSBQYWdlIFdpZHRoXG5wZGZqcy1wYWdlLXNjYWxlLWZpdCA9IFBhZ2UgRml0XG5wZGZqcy1wYWdlLXNjYWxlLWF1dG8gPSBBdXRvbWF0aWMgWm9vbVxucGRmanMtcGFnZS1zY2FsZS1hY3R1YWwgPSBBY3R1YWwgU2l6ZVxucGRmanMtcGFnZS1zY2FsZS1wZXJjZW50ID0geyAkc2NhbGUgfSVcbnBkZmpzLXBhZ2UtbGFuZG1hcmsgPVxuICAgIC5hcmlhLWxhYmVsID0gUGFnZSB7ICRwYWdlIH1cbnBkZmpzLWxvYWRpbmctZXJyb3IgPSBBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBsb2FkaW5nIHRoZSBQREYuXG5wZGZqcy1pbnZhbGlkLWZpbGUtZXJyb3IgPSBJbnZhbGlkIG9yIGNvcnJ1cHRlZCBQREYgZmlsZS5cbnBkZmpzLW1pc3NpbmctZmlsZS1lcnJvciA9IE1pc3NpbmcgUERGIGZpbGUuXG5wZGZqcy11bmV4cGVjdGVkLXJlc3BvbnNlLWVycm9yID0gVW5leHBlY3RlZCBzZXJ2ZXIgcmVzcG9uc2UuXG5wZGZqcy1yZW5kZXJpbmctZXJyb3IgPSBBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSByZW5kZXJpbmcgdGhlIHBhZ2UuXG5wZGZqcy1hbm5vdGF0aW9uLWRhdGUtdGltZS1zdHJpbmcgPSB7IERBVEVUSU1FKCRkYXRlT2JqLCBkYXRlU3R5bGU6IFwic2hvcnRcIiwgdGltZVN0eWxlOiBcIm1lZGl1bVwiKSB9XG5wZGZqcy10ZXh0LWFubm90YXRpb24tdHlwZSA9XG4gICAgLmFsdCA9IFt7ICR0eXBlIH0gQW5ub3RhdGlvbl1cbnBkZmpzLXBhc3N3b3JkLWxhYmVsID0gRW50ZXIgdGhlIHBhc3N3b3JkIHRvIG9wZW4gdGhpcyBQREYgZmlsZS5cbnBkZmpzLXBhc3N3b3JkLWludmFsaWQgPSBJbnZhbGlkIHBhc3N3b3JkLiBQbGVhc2UgdHJ5IGFnYWluLlxucGRmanMtcGFzc3dvcmQtb2stYnV0dG9uID0gT0tcbnBkZmpzLXBhc3N3b3JkLWNhbmNlbC1idXR0b24gPSBDYW5jZWxcbnBkZmpzLXdlYi1mb250cy1kaXNhYmxlZCA9IFdlYiBmb250cyBhcmUgZGlzYWJsZWQ6IHVuYWJsZSB0byB1c2UgZW1iZWRkZWQgUERGIGZvbnRzLlxucGRmanMtZWRpdG9yLWZyZWUtdGV4dC1idXR0b24gPVxuICAgIC50aXRsZSA9IFRleHRcbnBkZmpzLWVkaXRvci1mcmVlLXRleHQtYnV0dG9uLWxhYmVsID0gVGV4dFxucGRmanMtZWRpdG9yLWluay1idXR0b24gPVxuICAgIC50aXRsZSA9IERyYXdcbnBkZmpzLWVkaXRvci1pbmstYnV0dG9uLWxhYmVsID0gRHJhd1xucGRmanMtZWRpdG9yLXN0YW1wLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gQWRkIG9yIGVkaXQgaW1hZ2VzXG5wZGZqcy1lZGl0b3Itc3RhbXAtYnV0dG9uLWxhYmVsID0gQWRkIG9yIGVkaXQgaW1hZ2VzXG5wZGZqcy1lZGl0b3ItaGlnaGxpZ2h0LWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gSGlnaGxpZ2h0XG5wZGZqcy1lZGl0b3ItaGlnaGxpZ2h0LWJ1dHRvbi1sYWJlbCA9IEhpZ2hsaWdodFxucGRmanMtaGlnaGxpZ2h0LWZsb2F0aW5nLWJ1dHRvbjEgPVxuICAgIC50aXRsZSA9IEhpZ2hsaWdodFxuICAgIC5hcmlhLWxhYmVsID0gSGlnaGxpZ2h0XG5wZGZqcy1oaWdobGlnaHQtZmxvYXRpbmctYnV0dG9uLWxhYmVsID0gSGlnaGxpZ2h0XG5wZGZqcy1lZGl0b3Itc2lnbmF0dXJlLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gQWRkIHNpZ25hdHVyZVxucGRmanMtZWRpdG9yLXNpZ25hdHVyZS1idXR0b24tbGFiZWwgPSBBZGQgc2lnbmF0dXJlXG5wZGZqcy1lZGl0b3ItaGlnaGxpZ2h0LWVkaXRvciA9XG4gICAgLmFyaWEtbGFiZWwgPSBIaWdobGlnaHQgZWRpdG9yXG5wZGZqcy1lZGl0b3ItaW5rLWVkaXRvciA9XG4gICAgLmFyaWEtbGFiZWwgPSBEcmF3aW5nIGVkaXRvclxucGRmanMtZWRpdG9yLXNpZ25hdHVyZS1lZGl0b3IxID1cbiAgICAuYXJpYS1kZXNjcmlwdGlvbiA9IFNpZ25hdHVyZSBlZGl0b3I6IHsgJGRlc2NyaXB0aW9uIH1cbnBkZmpzLWVkaXRvci1zdGFtcC1lZGl0b3IgPVxuICAgIC5hcmlhLWxhYmVsID0gSW1hZ2UgZWRpdG9yXG5wZGZqcy1lZGl0b3ItcmVtb3ZlLWluay1idXR0b24gPVxuICAgIC50aXRsZSA9IFJlbW92ZSBkcmF3aW5nXG5wZGZqcy1lZGl0b3ItcmVtb3ZlLWZyZWV0ZXh0LWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gUmVtb3ZlIHRleHRcbnBkZmpzLWVkaXRvci1yZW1vdmUtc3RhbXAtYnV0dG9uID1cbiAgICAudGl0bGUgPSBSZW1vdmUgaW1hZ2VcbnBkZmpzLWVkaXRvci1yZW1vdmUtaGlnaGxpZ2h0LWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gUmVtb3ZlIGhpZ2hsaWdodFxucGRmanMtZWRpdG9yLXJlbW92ZS1zaWduYXR1cmUtYnV0dG9uID1cbiAgICAudGl0bGUgPSBSZW1vdmUgc2lnbmF0dXJlXG5wZGZqcy1lZGl0b3ItZnJlZS10ZXh0LWNvbG9yLWlucHV0ID0gQ29sb3JcbnBkZmpzLWVkaXRvci1mcmVlLXRleHQtc2l6ZS1pbnB1dCA9IFNpemVcbnBkZmpzLWVkaXRvci1pbmstY29sb3ItaW5wdXQgPSBDb2xvclxucGRmanMtZWRpdG9yLWluay10aGlja25lc3MtaW5wdXQgPSBUaGlja25lc3NcbnBkZmpzLWVkaXRvci1pbmstb3BhY2l0eS1pbnB1dCA9IE9wYWNpdHlcbnBkZmpzLWVkaXRvci1zdGFtcC1hZGQtaW1hZ2UtYnV0dG9uID1cbiAgICAudGl0bGUgPSBBZGQgaW1hZ2VcbnBkZmpzLWVkaXRvci1zdGFtcC1hZGQtaW1hZ2UtYnV0dG9uLWxhYmVsID0gQWRkIGltYWdlXG5wZGZqcy1lZGl0b3ItZnJlZS1oaWdobGlnaHQtdGhpY2tuZXNzLWlucHV0ID0gVGhpY2tuZXNzXG5wZGZqcy1lZGl0b3ItZnJlZS1oaWdobGlnaHQtdGhpY2tuZXNzLXRpdGxlID1cbiAgICAudGl0bGUgPSBDaGFuZ2UgdGhpY2tuZXNzIHdoZW4gaGlnaGxpZ2h0aW5nIGl0ZW1zIG90aGVyIHRoYW4gdGV4dFxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtY29udGFpbmVyID1cbiAgICAuYXJpYS1sYWJlbCA9IFNpZ25hdHVyZSBjb250cm9scyBhbmQgc2F2ZWQgc2lnbmF0dXJlc1xucGRmanMtZWRpdG9yLXNpZ25hdHVyZS1hZGQtc2lnbmF0dXJlLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gQWRkIG5ldyBzaWduYXR1cmVcbnBkZmpzLWVkaXRvci1zaWduYXR1cmUtYWRkLXNpZ25hdHVyZS1idXR0b24tbGFiZWwgPSBBZGQgbmV3IHNpZ25hdHVyZVxucGRmanMtZWRpdG9yLWFkZC1zYXZlZC1zaWduYXR1cmUtYnV0dG9uID1cbiAgICAudGl0bGUgPSBTYXZlZCBzaWduYXR1cmU6IHsgJGRlc2NyaXB0aW9uIH1cbnBkZmpzLWZyZWUtdGV4dDIgPVxuICAgIC5hcmlhLWxhYmVsID0gVGV4dCBFZGl0b3JcbiAgICAuZGVmYXVsdC1jb250ZW50ID0gU3RhcnQgdHlwaW5nXHUyMDI2XG5wZGZqcy1lZGl0b3ItYWx0LXRleHQtYnV0dG9uID1cbiAgICAuYXJpYS1sYWJlbCA9IEFsdCB0ZXh0XG5wZGZqcy1lZGl0b3ItYWx0LXRleHQtYnV0dG9uLWxhYmVsID0gQWx0IHRleHRcbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1lZGl0LWJ1dHRvbiA9XG4gICAgLmFyaWEtbGFiZWwgPSBFZGl0IGFsdCB0ZXh0XG5wZGZqcy1lZGl0b3ItYWx0LXRleHQtZGlhbG9nLWxhYmVsID0gQ2hvb3NlIGFuIG9wdGlvblxucGRmanMtZWRpdG9yLWFsdC10ZXh0LWRpYWxvZy1kZXNjcmlwdGlvbiA9IEFsdCB0ZXh0IChhbHRlcm5hdGl2ZSB0ZXh0KSBoZWxwcyB3aGVuIHBlb3BsZSBjYW5cdTIwMTl0IHNlZSB0aGUgaW1hZ2Ugb3Igd2hlbiBpdCBkb2Vzblx1MjAxOXQgbG9hZC5cbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1hZGQtZGVzY3JpcHRpb24tbGFiZWwgPSBBZGQgYSBkZXNjcmlwdGlvblxucGRmanMtZWRpdG9yLWFsdC10ZXh0LWFkZC1kZXNjcmlwdGlvbi1kZXNjcmlwdGlvbiA9IEFpbSBmb3IgMS0yIHNlbnRlbmNlcyB0aGF0IGRlc2NyaWJlIHRoZSBzdWJqZWN0LCBzZXR0aW5nLCBvciBhY3Rpb25zLlxucGRmanMtZWRpdG9yLWFsdC10ZXh0LW1hcmstZGVjb3JhdGl2ZS1sYWJlbCA9IE1hcmsgYXMgZGVjb3JhdGl2ZVxucGRmanMtZWRpdG9yLWFsdC10ZXh0LW1hcmstZGVjb3JhdGl2ZS1kZXNjcmlwdGlvbiA9IFRoaXMgaXMgdXNlZCBmb3Igb3JuYW1lbnRhbCBpbWFnZXMsIGxpa2UgYm9yZGVycyBvciB3YXRlcm1hcmtzLlxucGRmanMtZWRpdG9yLWFsdC10ZXh0LWNhbmNlbC1idXR0b24gPSBDYW5jZWxcbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1zYXZlLWJ1dHRvbiA9IFNhdmVcbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1kZWNvcmF0aXZlLXRvb2x0aXAgPSBNYXJrZWQgYXMgZGVjb3JhdGl2ZVxucGRmanMtZWRpdG9yLWFsdC10ZXh0LXRleHRhcmVhID1cbiAgICAucGxhY2Vob2xkZXIgPSBGb3IgZXhhbXBsZSwgXHUyMDFDQSB5b3VuZyBtYW4gc2l0cyBkb3duIGF0IGEgdGFibGUgdG8gZWF0IGEgbWVhbFx1MjAxRFxucGRmanMtZWRpdG9yLXJlc2l6ZXItdG9wLWxlZnQgPVxuICAgIC5hcmlhLWxhYmVsID0gVG9wIGxlZnQgY29ybmVyIFx1MjAxNCByZXNpemVcbnBkZmpzLWVkaXRvci1yZXNpemVyLXRvcC1taWRkbGUgPVxuICAgIC5hcmlhLWxhYmVsID0gVG9wIG1pZGRsZSBcdTIwMTQgcmVzaXplXG5wZGZqcy1lZGl0b3ItcmVzaXplci10b3AtcmlnaHQgPVxuICAgIC5hcmlhLWxhYmVsID0gVG9wIHJpZ2h0IGNvcm5lciBcdTIwMTQgcmVzaXplXG5wZGZqcy1lZGl0b3ItcmVzaXplci1taWRkbGUtcmlnaHQgPVxuICAgIC5hcmlhLWxhYmVsID0gTWlkZGxlIHJpZ2h0IFx1MjAxNCByZXNpemVcbnBkZmpzLWVkaXRvci1yZXNpemVyLWJvdHRvbS1yaWdodCA9XG4gICAgLmFyaWEtbGFiZWwgPSBCb3R0b20gcmlnaHQgY29ybmVyIFx1MjAxNCByZXNpemVcbnBkZmpzLWVkaXRvci1yZXNpemVyLWJvdHRvbS1taWRkbGUgPVxuICAgIC5hcmlhLWxhYmVsID0gQm90dG9tIG1pZGRsZSBcdTIwMTQgcmVzaXplXG5wZGZqcy1lZGl0b3ItcmVzaXplci1ib3R0b20tbGVmdCA9XG4gICAgLmFyaWEtbGFiZWwgPSBCb3R0b20gbGVmdCBjb3JuZXIgXHUyMDE0IHJlc2l6ZVxucGRmanMtZWRpdG9yLXJlc2l6ZXItbWlkZGxlLWxlZnQgPVxuICAgIC5hcmlhLWxhYmVsID0gTWlkZGxlIGxlZnQgXHUyMDE0IHJlc2l6ZVxucGRmanMtZWRpdG9yLWhpZ2hsaWdodC1jb2xvcnBpY2tlci1sYWJlbCA9IEhpZ2hsaWdodCBjb2xvclxucGRmanMtZWRpdG9yLWNvbG9ycGlja2VyLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gQ2hhbmdlIGNvbG9yXG5wZGZqcy1lZGl0b3ItY29sb3JwaWNrZXItZHJvcGRvd24gPVxuICAgIC5hcmlhLWxhYmVsID0gQ29sb3IgY2hvaWNlc1xucGRmanMtZWRpdG9yLWNvbG9ycGlja2VyLXllbGxvdyA9XG4gICAgLnRpdGxlID0gWWVsbG93XG5wZGZqcy1lZGl0b3ItY29sb3JwaWNrZXItZ3JlZW4gPVxuICAgIC50aXRsZSA9IEdyZWVuXG5wZGZqcy1lZGl0b3ItY29sb3JwaWNrZXItYmx1ZSA9XG4gICAgLnRpdGxlID0gQmx1ZVxucGRmanMtZWRpdG9yLWNvbG9ycGlja2VyLXBpbmsgPVxuICAgIC50aXRsZSA9IFBpbmtcbnBkZmpzLWVkaXRvci1jb2xvcnBpY2tlci1yZWQgPVxuICAgIC50aXRsZSA9IFJlZFxucGRmanMtZWRpdG9yLWhpZ2hsaWdodC1zaG93LWFsbC1idXR0b24tbGFiZWwgPSBTaG93IGFsbFxucGRmanMtZWRpdG9yLWhpZ2hsaWdodC1zaG93LWFsbC1idXR0b24gPVxuICAgIC50aXRsZSA9IFNob3cgYWxsXG5wZGZqcy1lZGl0b3ItbmV3LWFsdC10ZXh0LWRpYWxvZy1lZGl0LWxhYmVsID0gRWRpdCBhbHQgdGV4dCAoaW1hZ2UgZGVzY3JpcHRpb24pXG5wZGZqcy1lZGl0b3ItbmV3LWFsdC10ZXh0LWRpYWxvZy1hZGQtbGFiZWwgPSBBZGQgYWx0IHRleHQgKGltYWdlIGRlc2NyaXB0aW9uKVxucGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC10ZXh0YXJlYSA9XG4gICAgLnBsYWNlaG9sZGVyID0gV3JpdGUgeW91ciBkZXNjcmlwdGlvbiBoZXJlXHUyMDI2XG5wZGZqcy1lZGl0b3ItbmV3LWFsdC10ZXh0LWRlc2NyaXB0aW9uID0gU2hvcnQgZGVzY3JpcHRpb24gZm9yIHBlb3BsZSB3aG8gY2FuXHUyMDE5dCBzZWUgdGhlIGltYWdlIG9yIHdoZW4gdGhlIGltYWdlIGRvZXNuXHUyMDE5dCBsb2FkLlxucGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1kaXNjbGFpbWVyMSA9IFRoaXMgYWx0IHRleHQgd2FzIGNyZWF0ZWQgYXV0b21hdGljYWxseSBhbmQgbWF5IGJlIGluYWNjdXJhdGUuXG5wZGZqcy1lZGl0b3ItbmV3LWFsdC10ZXh0LWRpc2NsYWltZXItbGVhcm4tbW9yZS11cmwgPSBMZWFybiBtb3JlXG5wZGZqcy1lZGl0b3ItbmV3LWFsdC10ZXh0LWNyZWF0ZS1hdXRvbWF0aWNhbGx5LWJ1dHRvbi1sYWJlbCA9IENyZWF0ZSBhbHQgdGV4dCBhdXRvbWF0aWNhbGx5XG5wZGZqcy1lZGl0b3ItbmV3LWFsdC10ZXh0LW5vdC1ub3ctYnV0dG9uID0gTm90IG5vd1xucGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1lcnJvci10aXRsZSA9IENvdWxkblx1MjAxOXQgY3JlYXRlIGFsdCB0ZXh0IGF1dG9tYXRpY2FsbHlcbnBkZmpzLWVkaXRvci1uZXctYWx0LXRleHQtZXJyb3ItZGVzY3JpcHRpb24gPSBQbGVhc2Ugd3JpdGUgeW91ciBvd24gYWx0IHRleHQgb3IgdHJ5IGFnYWluIGxhdGVyLlxucGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1lcnJvci1jbG9zZS1idXR0b24gPSBDbG9zZVxucGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1haS1tb2RlbC1kb3dubG9hZGluZy1wcm9ncmVzcyA9IERvd25sb2FkaW5nIGFsdCB0ZXh0IEFJIG1vZGVsICh7ICRkb3dubG9hZGVkU2l6ZSB9IG9mIHsgJHRvdGFsU2l6ZSB9IE1CKVxuICAgIC5hcmlhLXZhbHVldGV4dCA9IERvd25sb2FkaW5nIGFsdCB0ZXh0IEFJIG1vZGVsICh7ICRkb3dubG9hZGVkU2l6ZSB9IG9mIHsgJHRvdGFsU2l6ZSB9IE1CKVxucGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1hZGRlZC1idXR0b24gPVxuICAgIC5hcmlhLWxhYmVsID0gQWx0IHRleHQgYWRkZWRcbnBkZmpzLWVkaXRvci1uZXctYWx0LXRleHQtYWRkZWQtYnV0dG9uLWxhYmVsID0gQWx0IHRleHQgYWRkZWRcbnBkZmpzLWVkaXRvci1uZXctYWx0LXRleHQtbWlzc2luZy1idXR0b24gPVxuICAgIC5hcmlhLWxhYmVsID0gTWlzc2luZyBhbHQgdGV4dFxucGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1taXNzaW5nLWJ1dHRvbi1sYWJlbCA9IE1pc3NpbmcgYWx0IHRleHRcbnBkZmpzLWVkaXRvci1uZXctYWx0LXRleHQtdG8tcmV2aWV3LWJ1dHRvbiA9XG4gICAgLmFyaWEtbGFiZWwgPSBSZXZpZXcgYWx0IHRleHRcbnBkZmpzLWVkaXRvci1uZXctYWx0LXRleHQtdG8tcmV2aWV3LWJ1dHRvbi1sYWJlbCA9IFJldmlldyBhbHQgdGV4dFxucGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1nZW5lcmF0ZWQtYWx0LXRleHQtd2l0aC1kaXNjbGFpbWVyID0gQ3JlYXRlZCBhdXRvbWF0aWNhbGx5OiB7ICRnZW5lcmF0ZWRBbHRUZXh0IH1cbnBkZmpzLWltYWdlLWFsdC10ZXh0LXNldHRpbmdzLWJ1dHRvbiA9XG4gICAgLnRpdGxlID0gSW1hZ2UgYWx0IHRleHQgc2V0dGluZ3NcbnBkZmpzLWltYWdlLWFsdC10ZXh0LXNldHRpbmdzLWJ1dHRvbi1sYWJlbCA9IEltYWdlIGFsdCB0ZXh0IHNldHRpbmdzXG5wZGZqcy1lZGl0b3ItYWx0LXRleHQtc2V0dGluZ3MtZGlhbG9nLWxhYmVsID0gSW1hZ2UgYWx0IHRleHQgc2V0dGluZ3NcbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1zZXR0aW5ncy1hdXRvbWF0aWMtdGl0bGUgPSBBdXRvbWF0aWMgYWx0IHRleHRcbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1zZXR0aW5ncy1jcmVhdGUtbW9kZWwtYnV0dG9uLWxhYmVsID0gQ3JlYXRlIGFsdCB0ZXh0IGF1dG9tYXRpY2FsbHlcbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1zZXR0aW5ncy1jcmVhdGUtbW9kZWwtZGVzY3JpcHRpb24gPSBTdWdnZXN0cyBkZXNjcmlwdGlvbnMgdG8gaGVscCBwZW9wbGUgd2hvIGNhblx1MjAxOXQgc2VlIHRoZSBpbWFnZSBvciB3aGVuIHRoZSBpbWFnZSBkb2Vzblx1MjAxOXQgbG9hZC5cbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1zZXR0aW5ncy1kb3dubG9hZC1tb2RlbC1sYWJlbCA9IEFsdCB0ZXh0IEFJIG1vZGVsICh7ICR0b3RhbFNpemUgfSBNQilcbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1zZXR0aW5ncy1haS1tb2RlbC1kZXNjcmlwdGlvbiA9IFJ1bnMgbG9jYWxseSBvbiB5b3VyIGRldmljZSBzbyB5b3VyIGRhdGEgc3RheXMgcHJpdmF0ZS4gUmVxdWlyZWQgZm9yIGF1dG9tYXRpYyBhbHQgdGV4dC5cbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1zZXR0aW5ncy1kZWxldGUtbW9kZWwtYnV0dG9uID0gRGVsZXRlXG5wZGZqcy1lZGl0b3ItYWx0LXRleHQtc2V0dGluZ3MtZG93bmxvYWQtbW9kZWwtYnV0dG9uID0gRG93bmxvYWRcbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1zZXR0aW5ncy1kb3dubG9hZGluZy1tb2RlbC1idXR0b24gPSBEb3dubG9hZGluZ1x1MjAyNlxucGRmanMtZWRpdG9yLWFsdC10ZXh0LXNldHRpbmdzLWVkaXRvci10aXRsZSA9IEFsdCB0ZXh0IGVkaXRvclxucGRmanMtZWRpdG9yLWFsdC10ZXh0LXNldHRpbmdzLXNob3ctZGlhbG9nLWJ1dHRvbi1sYWJlbCA9IFNob3cgYWx0IHRleHQgZWRpdG9yIHJpZ2h0IGF3YXkgd2hlbiBhZGRpbmcgYW4gaW1hZ2VcbnBkZmpzLWVkaXRvci1hbHQtdGV4dC1zZXR0aW5ncy1zaG93LWRpYWxvZy1kZXNjcmlwdGlvbiA9IEhlbHBzIHlvdSBtYWtlIHN1cmUgYWxsIHlvdXIgaW1hZ2VzIGhhdmUgYWx0IHRleHQuXG5wZGZqcy1lZGl0b3ItYWx0LXRleHQtc2V0dGluZ3MtY2xvc2UtYnV0dG9uID0gQ2xvc2VcbnBkZmpzLWVkaXRvci11bmRvLWJhci1tZXNzYWdlLWhpZ2hsaWdodCA9IEhpZ2hsaWdodCByZW1vdmVkXG5wZGZqcy1lZGl0b3ItdW5kby1iYXItbWVzc2FnZS1mcmVldGV4dCA9IFRleHQgcmVtb3ZlZFxucGRmanMtZWRpdG9yLXVuZG8tYmFyLW1lc3NhZ2UtaW5rID0gRHJhd2luZyByZW1vdmVkXG5wZGZqcy1lZGl0b3ItdW5kby1iYXItbWVzc2FnZS1zdGFtcCA9IEltYWdlIHJlbW92ZWRcbnBkZmpzLWVkaXRvci11bmRvLWJhci1tZXNzYWdlLXNpZ25hdHVyZSA9IFNpZ25hdHVyZSByZW1vdmVkXG5wZGZqcy1lZGl0b3ItdW5kby1iYXItbWVzc2FnZS1tdWx0aXBsZSA9XG4gICAgeyAkY291bnQgLT5cbiAgICAgICAgW29uZV0geyAkY291bnQgfSBhbm5vdGF0aW9uIHJlbW92ZWRcbiAgICAgICAqW290aGVyXSB7ICRjb3VudCB9IGFubm90YXRpb25zIHJlbW92ZWRcbiAgICB9XG5wZGZqcy1lZGl0b3ItdW5kby1iYXItdW5kby1idXR0b24gPVxuICAgIC50aXRsZSA9IFVuZG9cbnBkZmpzLWVkaXRvci11bmRvLWJhci11bmRvLWJ1dHRvbi1sYWJlbCA9IFVuZG9cbnBkZmpzLWVkaXRvci11bmRvLWJhci1jbG9zZS1idXR0b24gPVxuICAgIC50aXRsZSA9IENsb3NlXG5wZGZqcy1lZGl0b3ItdW5kby1iYXItY2xvc2UtYnV0dG9uLWxhYmVsID0gQ2xvc2VcbnBkZmpzLWVkaXRvci1hZGQtc2lnbmF0dXJlLWRpYWxvZy1sYWJlbCA9IFRoaXMgbW9kYWwgYWxsb3dzIHRoZSB1c2VyIHRvIGNyZWF0ZSBhIHNpZ25hdHVyZSB0byBhZGQgdG8gYSBQREYgZG9jdW1lbnQuIFRoZSB1c2VyIGNhbiBlZGl0IHRoZSBuYW1lICh3aGljaCBhbHNvIHNlcnZlcyBhcyB0aGUgYWx0IHRleHQpLCBhbmQgb3B0aW9uYWxseSBzYXZlIHRoZSBzaWduYXR1cmUgZm9yIHJlcGVhdGVkIHVzZS5cbnBkZmpzLWVkaXRvci1hZGQtc2lnbmF0dXJlLWRpYWxvZy10aXRsZSA9IEFkZCBhIHNpZ25hdHVyZVxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtdHlwZS1idXR0b24gPSBUeXBlXG4gICAgLnRpdGxlID0gVHlwZVxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtZHJhdy1idXR0b24gPSBEcmF3XG4gICAgLnRpdGxlID0gRHJhd1xucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtaW1hZ2UtYnV0dG9uID0gSW1hZ2VcbiAgICAudGl0bGUgPSBJbWFnZVxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtdHlwZS1pbnB1dCA9XG4gICAgLmFyaWEtbGFiZWwgPSBUeXBlIHlvdXIgc2lnbmF0dXJlXG4gICAgLnBsYWNlaG9sZGVyID0gVHlwZSB5b3VyIHNpZ25hdHVyZVxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtZHJhdy1wbGFjZWhvbGRlciA9IERyYXcgeW91ciBzaWduYXR1cmVcbnBkZmpzLWVkaXRvci1hZGQtc2lnbmF0dXJlLWRyYXctdGhpY2tuZXNzLXJhbmdlLWxhYmVsID0gVGhpY2tuZXNzXG5wZGZqcy1lZGl0b3ItYWRkLXNpZ25hdHVyZS1kcmF3LXRoaWNrbmVzcy1yYW5nZSA9XG4gICAgLnRpdGxlID0gRHJhd2luZyB0aGlja25lc3M6IHsgJHRoaWNrbmVzcyB9XG5wZGZqcy1lZGl0b3ItYWRkLXNpZ25hdHVyZS1pbWFnZS1wbGFjZWhvbGRlciA9IERyYWcgYSBmaWxlIGhlcmUgdG8gdXBsb2FkXG5wZGZqcy1lZGl0b3ItYWRkLXNpZ25hdHVyZS1pbWFnZS1icm93c2UtbGluayA9XG4gICAgeyBQTEFURk9STSgpIC0+XG4gICAgICAgIFttYWNvc10gT3IgY2hvb3NlIGltYWdlIGZpbGVzXG4gICAgICAgKltvdGhlcl0gT3IgYnJvd3NlIGltYWdlIGZpbGVzXG4gICAgfVxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtZGVzY3JpcHRpb24tbGFiZWwgPSBEZXNjcmlwdGlvbiAoYWx0IHRleHQpXG5wZGZqcy1lZGl0b3ItYWRkLXNpZ25hdHVyZS1kZXNjcmlwdGlvbi1pbnB1dCA9XG4gICAgLnRpdGxlID0gRGVzY3JpcHRpb24gKGFsdCB0ZXh0KVxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtZGVzY3JpcHRpb24tZGVmYXVsdC13aGVuLWRyYXdpbmcgPSBTaWduYXR1cmVcbnBkZmpzLWVkaXRvci1hZGQtc2lnbmF0dXJlLWNsZWFyLWJ1dHRvbi1sYWJlbCA9IENsZWFyIHNpZ25hdHVyZVxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtY2xlYXItYnV0dG9uID1cbiAgICAudGl0bGUgPSBDbGVhciBzaWduYXR1cmVcbnBkZmpzLWVkaXRvci1hZGQtc2lnbmF0dXJlLXNhdmUtY2hlY2tib3ggPSBTYXZlIHNpZ25hdHVyZVxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtc2F2ZS13YXJuaW5nLW1lc3NhZ2UgPSBZb3VcdTIwMTl2ZSByZWFjaGVkIHRoZSBsaW1pdCBvZiA1IHNhdmVkIHNpZ25hdHVyZXMuIFJlbW92ZSBvbmUgdG8gc2F2ZSBtb3JlLlxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtaW1hZ2UtdXBsb2FkLWVycm9yLXRpdGxlID0gQ291bGRuXHUyMDE5dCB1cGxvYWQgaW1hZ2VcbnBkZmpzLWVkaXRvci1hZGQtc2lnbmF0dXJlLWltYWdlLXVwbG9hZC1lcnJvci1kZXNjcmlwdGlvbiA9IENoZWNrIHlvdXIgbmV0d29yayBjb25uZWN0aW9uIG9yIHRyeSBhbm90aGVyIGltYWdlLlxucGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtZXJyb3ItY2xvc2UtYnV0dG9uID0gQ2xvc2VcbnBkZmpzLWVkaXRvci1hZGQtc2lnbmF0dXJlLWNhbmNlbC1idXR0b24gPSBDYW5jZWxcbnBkZmpzLWVkaXRvci1hZGQtc2lnbmF0dXJlLWFkZC1idXR0b24gPSBBZGRcbnBkZmpzLWVkaXRvci1kZWxldGUtc2lnbmF0dXJlLWJ1dHRvbjEgPVxuICAgIC50aXRsZSA9IFJlbW92ZSBzYXZlZCBzaWduYXR1cmVcbnBkZmpzLWVkaXRvci1kZWxldGUtc2lnbmF0dXJlLWJ1dHRvbi1sYWJlbDEgPSBSZW1vdmUgc2F2ZWQgc2lnbmF0dXJlXG5wZGZqcy1lZGl0b3ItYWRkLXNpZ25hdHVyZS1lZGl0LWJ1dHRvbi1sYWJlbCA9IEVkaXQgZGVzY3JpcHRpb25cbnBkZmpzLWVkaXRvci1lZGl0LXNpZ25hdHVyZS1kaWFsb2ctdGl0bGUgPSBFZGl0IGRlc2NyaXB0aW9uXG5wZGZqcy1lZGl0b3ItZWRpdC1zaWduYXR1cmUtdXBkYXRlLWJ1dHRvbiA9IFVwZGF0ZSI7CiAgICByZXR1cm4gY3JlYXRlQnVuZGxlKGxhbmcsIHRleHQpOwogIH0KfQoKOy8vIC4vd2ViL2dlbmVyaWNfc2NyaXB0aW5nLmpzCgphc3luYyBmdW5jdGlvbiBkb2NQcm9wZXJ0aWVzKHBkZkRvY3VtZW50KSB7CiAgY29uc3QgdXJsID0gIiIsCiAgICBiYXNlVXJsID0gIiI7CiAgY29uc3QgewogICAgaW5mbywKICAgIG1ldGFkYXRhLAogICAgY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWUsCiAgICBjb250ZW50TGVuZ3RoCiAgfSA9IGF3YWl0IHBkZkRvY3VtZW50LmdldE1ldGFkYXRhKCk7CiAgcmV0dXJuIHsKICAgIC4uLmluZm8sCiAgICBiYXNlVVJMOiBiYXNlVXJsLAogICAgZmlsZXNpemU6IGNvbnRlbnRMZW5ndGggfHwgKGF3YWl0IHBkZkRvY3VtZW50LmdldERvd25sb2FkSW5mbygpKS5sZW5ndGgsCiAgICBmaWxlbmFtZTogY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWUgfHwgZ2V0UGRmRmlsZW5hbWVGcm9tVXJsKHVybCksCiAgICBtZXRhZGF0YTogbWV0YWRhdGE/LmdldFJhdygpLAogICAgYXV0aG9yczogbWV0YWRhdGE/LmdldCgiZGM6Y3JlYXRvciIpLAogICAgbnVtUGFnZXM6IHBkZkRvY3VtZW50Lm51bVBhZ2VzLAogICAgVVJMOiB1cmwKICB9Owp9CmNsYXNzIEdlbmVyaWNTY3JpcHRpbmcgewogIGNvbnN0cnVjdG9yKHNhbmRib3hCdW5kbGVTcmMpIHsKICAgIHRoaXMuX3JlYWR5ID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBjb25zdCBzYW5kYm94ID0gaW1wb3J0KAogICAgICAvKndlYnBhY2tJZ25vcmU6IHRydWUqLwogICAgICAvKkB2aXRlLWlnbm9yZSovCiAgICAgIHNhbmRib3hCdW5kbGVTcmMpOwogICAgICBzYW5kYm94LnRoZW4ocGRmanNTYW5kYm94ID0+IHsKICAgICAgICByZXNvbHZlKHBkZmpzU2FuZGJveC5RdWlja0pTU2FuZGJveCgpKTsKICAgICAgfSkuY2F0Y2gocmVqZWN0KTsKICAgIH0pOwogIH0KICBhc3luYyBjcmVhdGVTYW5kYm94KGRhdGEpIHsKICAgIGNvbnN0IHNhbmRib3ggPSBhd2FpdCB0aGlzLl9yZWFkeTsKICAgIHNhbmRib3guY3JlYXRlKGRhdGEpOwogIH0KICBhc3luYyBkaXNwYXRjaEV2ZW50SW5TYW5kYm94KGV2ZW50KSB7CiAgICBjb25zdCBzYW5kYm94ID0gYXdhaXQgdGhpcy5fcmVhZHk7CiAgICBzZXRUaW1lb3V0KCgpID0+IHNhbmRib3guZGlzcGF0Y2hFdmVudChldmVudCksIDApOwogIH0KICBhc3luYyBkZXN0cm95U2FuZGJveCgpIHsKICAgIGNvbnN0IHNhbmRib3ggPSBhd2FpdCB0aGlzLl9yZWFkeTsKICAgIHNhbmRib3gubnVrZVNhbmRib3goKTsKICB9Cn0KCjsvLyAuL3dlYi9nZW5lcmljX3NpZ25hdHVyZV9zdG9yYWdlLmpzCgpjb25zdCBLRVlfU1RPUkFHRSA9ICJwZGZqcy5zaWduYXR1cmUiOwpjbGFzcyBTaWduYXR1cmVTdG9yYWdlIHsKICAjZXZlbnRCdXM7CiAgI3NpZ25hdHVyZXMgPSBudWxsOwogICNzaWduYWwgPSBudWxsOwogIGNvbnN0cnVjdG9yKGV2ZW50QnVzLCBzaWduYWwpIHsKICAgIHRoaXMuI2V2ZW50QnVzID0gZXZlbnRCdXM7CiAgICB0aGlzLiNzaWduYWwgPSBzaWduYWw7CiAgfQogICNzYXZlKCkgewogICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oS0VZX1NUT1JBR0UsIEpTT04uc3RyaW5naWZ5KE9iamVjdC5mcm9tRW50cmllcyh0aGlzLiNzaWduYXR1cmVzKSkpOwogIH0KICBhc3luYyBnZXRBbGwoKSB7CiAgICBpZiAodGhpcy4jc2lnbmFsKSB7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJzdG9yYWdlIiwgKHsKICAgICAgICBrZXkKICAgICAgfSkgPT4gewogICAgICAgIGlmIChrZXkgPT09IEtFWV9TVE9SQUdFKSB7CiAgICAgICAgICB0aGlzLiNzaWduYXR1cmVzID0gbnVsbDsKICAgICAgICAgIHRoaXMuI2V2ZW50QnVzPy5kaXNwYXRjaCgic3RvcmVkc2lnbmF0dXJlc2NoYW5nZWQiLCB7CiAgICAgICAgICAgIHNvdXJjZTogdGhpcwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgc2lnbmFsOiB0aGlzLiNzaWduYWwKICAgICAgfSk7CiAgICAgIHRoaXMuI3NpZ25hbCA9IG51bGw7CiAgICB9CiAgICBpZiAoIXRoaXMuI3NpZ25hdHVyZXMpIHsKICAgICAgdGhpcy4jc2lnbmF0dXJlcyA9IG5ldyBNYXAoKTsKICAgICAgY29uc3QgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKEtFWV9TVE9SQUdFKTsKICAgICAgaWYgKGRhdGEpIHsKICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhKU09OLnBhcnNlKGRhdGEpKSkgewogICAgICAgICAgdGhpcy4jc2lnbmF0dXJlcy5zZXQoa2V5LCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy4jc2lnbmF0dXJlczsKICB9CiAgYXN5bmMgaXNGdWxsKCkgewogICAgcmV0dXJuIChhd2FpdCB0aGlzLnNpemUoKSkgPT09IDU7CiAgfQogIGFzeW5jIHNpemUoKSB7CiAgICByZXR1cm4gKGF3YWl0IHRoaXMuZ2V0QWxsKCkpLnNpemU7CiAgfQogIGFzeW5jIGNyZWF0ZShkYXRhKSB7CiAgICBpZiAoYXdhaXQgdGhpcy5pc0Z1bGwoKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHV1aWQgPSBnZXRVdWlkKCk7CiAgICB0aGlzLiNzaWduYXR1cmVzLnNldCh1dWlkLCBkYXRhKTsKICAgIHRoaXMuI3NhdmUoKTsKICAgIHJldHVybiB1dWlkOwogIH0KICBhc3luYyBkZWxldGUodXVpZCkgewogICAgY29uc3Qgc2lnbmF0dXJlcyA9IGF3YWl0IHRoaXMuZ2V0QWxsKCk7CiAgICBpZiAoIXNpZ25hdHVyZXMuaGFzKHV1aWQpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHNpZ25hdHVyZXMuZGVsZXRlKHV1aWQpOwogICAgdGhpcy4jc2F2ZSgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Cgo7Ly8gLi93ZWIvZ2VuZXJpY2NvbS5qcwoKCgoKCgpmdW5jdGlvbiBpbml0Q29tKGFwcCkge30KY2xhc3MgUHJlZmVyZW5jZXMgZXh0ZW5kcyBCYXNlUHJlZmVyZW5jZXMgewogIGFzeW5jIF93cml0ZVRvU3RvcmFnZShwcmVmT2JqKSB7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgicGRmanMucHJlZmVyZW5jZXMiLCBKU09OLnN0cmluZ2lmeShwcmVmT2JqKSk7CiAgfQogIGFzeW5jIF9yZWFkRnJvbVN0b3JhZ2UocHJlZk9iaikgewogICAgcmV0dXJuIHsKICAgICAgcHJlZnM6IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oInBkZmpzLnByZWZlcmVuY2VzIikpCiAgICB9OwogIH0KfQpjbGFzcyBFeHRlcm5hbFNlcnZpY2VzIGV4dGVuZHMgQmFzZUV4dGVybmFsU2VydmljZXMgewogIGFzeW5jIGNyZWF0ZUwxMG4oKSB7CiAgICByZXR1cm4gbmV3IGdlbmVyaWNsMTBuX0dlbmVyaWNMMTBuKEFwcE9wdGlvbnMuZ2V0KCJsb2NhbGVQcm9wZXJ0aWVzIik/LmxhbmcpOwogIH0KICBjcmVhdGVTY3JpcHRpbmcoKSB7CiAgICByZXR1cm4gbmV3IEdlbmVyaWNTY3JpcHRpbmcoQXBwT3B0aW9ucy5nZXQoInNhbmRib3hCdW5kbGVTcmMiKSk7CiAgfQogIGNyZWF0ZVNpZ25hdHVyZVN0b3JhZ2UoZXZlbnRCdXMsIHNpZ25hbCkgewogICAgcmV0dXJuIG5ldyBTaWduYXR1cmVTdG9yYWdlKGV2ZW50QnVzLCBzaWduYWwpOwogIH0KfQpjbGFzcyBNTE1hbmFnZXIgewogIGFzeW5jIGlzRW5hYmxlZEZvcihfbmFtZSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBhc3luYyBkZWxldGVNb2RlbChfc2VydmljZSkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlzUmVhZHkoX25hbWUpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ3Vlc3MoX2RhdGEpIHt9CiAgdG9nZ2xlU2VydmljZShfbmFtZSwgX2VuYWJsZWQpIHt9Cn0KCjsvLyAuL3dlYi9uZXdfYWx0X3RleHRfbWFuYWdlci5qcwoKY2xhc3MgTmV3QWx0VGV4dE1hbmFnZXIgewogICNib3VuZENhbmNlbCA9IHRoaXMuI2NhbmNlbC5iaW5kKHRoaXMpOwogICNjcmVhdGVBdXRvbWF0aWNhbGx5QnV0dG9uOwogICNjdXJyZW50RWRpdG9yID0gbnVsbDsKICAjY2FuY2VsQnV0dG9uOwogICNkZXNjcmlwdGlvbkNvbnRhaW5lcjsKICAjZGlhbG9nOwogICNkaXNjbGFpbWVyOwogICNkb3dubG9hZE1vZGVsOwogICNkb3dubG9hZE1vZGVsRGVzY3JpcHRpb247CiAgI2V2ZW50QnVzOwogICNmaXJzdFRpbWUgPSBmYWxzZTsKICAjZ3Vlc3NlZEFsdFRleHQ7CiAgI2hhc0FJID0gbnVsbDsKICAjaXNFZGl0aW5nID0gbnVsbDsKICAjaW1hZ2VQcmV2aWV3OwogICNpbWFnZURhdGE7CiAgI2lzQUlMb2FkaW5nID0gZmFsc2U7CiAgI3dhc0FJTG9hZGluZyA9IGZhbHNlOwogICNsZWFybk1vcmU7CiAgI25vdE5vd0J1dHRvbjsKICAjb3ZlcmxheU1hbmFnZXI7CiAgI3RleHRhcmVhOwogICN0aXRsZTsKICAjdWlNYW5hZ2VyOwogICNwcmV2aW91c0FsdFRleHQgPSBudWxsOwogIGNvbnN0cnVjdG9yKHsKICAgIGRlc2NyaXB0aW9uQ29udGFpbmVyLAogICAgZGlhbG9nLAogICAgaW1hZ2VQcmV2aWV3LAogICAgY2FuY2VsQnV0dG9uLAogICAgZGlzY2xhaW1lciwKICAgIG5vdE5vd0J1dHRvbiwKICAgIHNhdmVCdXR0b24sCiAgICB0ZXh0YXJlYSwKICAgIGxlYXJuTW9yZSwKICAgIGVycm9yQ2xvc2VCdXR0b24sCiAgICBjcmVhdGVBdXRvbWF0aWNhbGx5QnV0dG9uLAogICAgZG93bmxvYWRNb2RlbCwKICAgIGRvd25sb2FkTW9kZWxEZXNjcmlwdGlvbiwKICAgIHRpdGxlCiAgfSwgb3ZlcmxheU1hbmFnZXIsIGV2ZW50QnVzKSB7CiAgICB0aGlzLiNjYW5jZWxCdXR0b24gPSBjYW5jZWxCdXR0b247CiAgICB0aGlzLiNjcmVhdGVBdXRvbWF0aWNhbGx5QnV0dG9uID0gY3JlYXRlQXV0b21hdGljYWxseUJ1dHRvbjsKICAgIHRoaXMuI2Rlc2NyaXB0aW9uQ29udGFpbmVyID0gZGVzY3JpcHRpb25Db250YWluZXI7CiAgICB0aGlzLiNkaWFsb2cgPSBkaWFsb2c7CiAgICB0aGlzLiNkaXNjbGFpbWVyID0gZGlzY2xhaW1lcjsKICAgIHRoaXMuI25vdE5vd0J1dHRvbiA9IG5vdE5vd0J1dHRvbjsKICAgIHRoaXMuI2ltYWdlUHJldmlldyA9IGltYWdlUHJldmlldzsKICAgIHRoaXMuI3RleHRhcmVhID0gdGV4dGFyZWE7CiAgICB0aGlzLiNsZWFybk1vcmUgPSBsZWFybk1vcmU7CiAgICB0aGlzLiN0aXRsZSA9IHRpdGxlOwogICAgdGhpcy4jZG93bmxvYWRNb2RlbCA9IGRvd25sb2FkTW9kZWw7CiAgICB0aGlzLiNkb3dubG9hZE1vZGVsRGVzY3JpcHRpb24gPSBkb3dubG9hZE1vZGVsRGVzY3JpcHRpb247CiAgICB0aGlzLiNvdmVybGF5TWFuYWdlciA9IG92ZXJsYXlNYW5hZ2VyOwogICAgdGhpcy4jZXZlbnRCdXMgPSBldmVudEJ1czsKICAgIGRpYWxvZy5hZGRFdmVudExpc3RlbmVyKCJjbG9zZSIsIHRoaXMuI2Nsb3NlLmJpbmQodGhpcykpOwogICAgZGlhbG9nLmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51IiwgZXZlbnQgPT4gewogICAgICBpZiAoZXZlbnQudGFyZ2V0ICE9PSB0aGlzLiN0ZXh0YXJlYSkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0pOwogICAgY2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy4jYm91bmRDYW5jZWwpOwogICAgbm90Tm93QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy4jYm91bmRDYW5jZWwpOwogICAgc2F2ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuI3NhdmUuYmluZCh0aGlzKSk7CiAgICBlcnJvckNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICB0aGlzLiN0b2dnbGVFcnJvcihmYWxzZSk7CiAgICB9KTsKICAgIGNyZWF0ZUF1dG9tYXRpY2FsbHlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBhc3luYyAoKSA9PiB7CiAgICAgIGNvbnN0IGNoZWNrZWQgPSBjcmVhdGVBdXRvbWF0aWNhbGx5QnV0dG9uLmdldEF0dHJpYnV0ZSgiYXJpYS1wcmVzc2VkIikgIT09ICJ0cnVlIjsKICAgICAgdGhpcy4jY3VycmVudEVkaXRvci5fcmVwb3J0VGVsZW1ldHJ5KHsKICAgICAgICBhY3Rpb246ICJwZGZqcy5pbWFnZS5hbHRfdGV4dC5haV9nZW5lcmF0aW9uX2NoZWNrIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBzdGF0dXM6IGNoZWNrZWQKICAgICAgICB9CiAgICAgIH0pOwogICAgICBpZiAodGhpcy4jdWlNYW5hZ2VyKSB7CiAgICAgICAgdGhpcy4jdWlNYW5hZ2VyLnNldFByZWZlcmVuY2UoImVuYWJsZUd1ZXNzQWx0VGV4dCIsIGNoZWNrZWQpOwogICAgICAgIGF3YWl0IHRoaXMuI3VpTWFuYWdlci5tbE1hbmFnZXIudG9nZ2xlU2VydmljZSgiYWx0VGV4dCIsIGNoZWNrZWQpOwogICAgICB9CiAgICAgIHRoaXMuI3RvZ2dsZUd1ZXNzQWx0VGV4dChjaGVja2VkLCBmYWxzZSk7CiAgICB9KTsKICAgIHRleHRhcmVhLmFkZEV2ZW50TGlzdGVuZXIoImZvY3VzIiwgKCkgPT4gewogICAgICB0aGlzLiN3YXNBSUxvYWRpbmcgPSB0aGlzLiNpc0FJTG9hZGluZzsKICAgICAgdGhpcy4jdG9nZ2xlTG9hZGluZyhmYWxzZSk7CiAgICAgIHRoaXMuI3RvZ2dsZVRpdGxlQW5kRGlzY2xhaW1lcigpOwogICAgfSk7CiAgICB0ZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKCJibHVyIiwgKCkgPT4gewogICAgICBpZiAoIXRleHRhcmVhLnZhbHVlKSB7CiAgICAgICAgdGhpcy4jdG9nZ2xlTG9hZGluZyh0aGlzLiN3YXNBSUxvYWRpbmcpOwogICAgICB9CiAgICAgIHRoaXMuI3RvZ2dsZVRpdGxlQW5kRGlzY2xhaW1lcigpOwogICAgfSk7CiAgICB0ZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHsKICAgICAgdGhpcy4jdG9nZ2xlVGl0bGVBbmREaXNjbGFpbWVyKCk7CiAgICB9KTsKICAgIGV2ZW50QnVzLl9vbigiZW5hYmxlZ3Vlc3NhbHR0ZXh0IiwgKHsKICAgICAgdmFsdWUKICAgIH0pID0+IHsKICAgICAgdGhpcy4jdG9nZ2xlR3Vlc3NBbHRUZXh0KHZhbHVlLCBmYWxzZSk7CiAgICB9KTsKICAgIHRoaXMuI292ZXJsYXlNYW5hZ2VyLnJlZ2lzdGVyKGRpYWxvZyk7CiAgICB0aGlzLiNsZWFybk1vcmUuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IuX3JlcG9ydFRlbGVtZXRyeSh7CiAgICAgICAgYWN0aW9uOiAicGRmanMuaW1hZ2UuYWx0X3RleHQuaW5mbyIsCiAgICAgICAgZGF0YTogewogICAgICAgICAgdG9waWM6ICJhbHRfdGV4dCIKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfQogICN0b2dnbGVMb2FkaW5nKHZhbHVlKSB7CiAgICBpZiAoIXRoaXMuI3VpTWFuYWdlciB8fCB0aGlzLiNpc0FJTG9hZGluZyA9PT0gdmFsdWUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jaXNBSUxvYWRpbmcgPSB2YWx1ZTsKICAgIHRoaXMuI2Rlc2NyaXB0aW9uQ29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoImxvYWRpbmciLCB2YWx1ZSk7CiAgfQogICN0b2dnbGVFcnJvcih2YWx1ZSkgewogICAgaWYgKCF0aGlzLiN1aU1hbmFnZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jZGlhbG9nLmNsYXNzTGlzdC50b2dnbGUoImVycm9yIiwgdmFsdWUpOwogIH0KICBhc3luYyAjdG9nZ2xlR3Vlc3NBbHRUZXh0KHZhbHVlLCBpc0luaXRpYWwgPSBmYWxzZSkgewogICAgaWYgKCF0aGlzLiN1aU1hbmFnZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jZGlhbG9nLmNsYXNzTGlzdC50b2dnbGUoImFpRGlzYWJsZWQiLCAhdmFsdWUpOwogICAgdGhpcy4jY3JlYXRlQXV0b21hdGljYWxseUJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtcHJlc3NlZCIsIHZhbHVlKTsKICAgIGlmICh2YWx1ZSkgewogICAgICBjb25zdCB7CiAgICAgICAgYWx0VGV4dExlYXJuTW9yZVVybAogICAgICB9ID0gdGhpcy4jdWlNYW5hZ2VyLm1sTWFuYWdlcjsKICAgICAgaWYgKGFsdFRleHRMZWFybk1vcmVVcmwpIHsKICAgICAgICB0aGlzLiNsZWFybk1vcmUuaHJlZiA9IGFsdFRleHRMZWFybk1vcmVVcmw7CiAgICAgIH0KICAgICAgdGhpcy4jbWxHdWVzc0FsdFRleHQoaXNJbml0aWFsKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuI3RvZ2dsZUxvYWRpbmcoZmFsc2UpOwogICAgICB0aGlzLiNpc0FJTG9hZGluZyA9IGZhbHNlOwogICAgICB0aGlzLiN0b2dnbGVUaXRsZUFuZERpc2NsYWltZXIoKTsKICAgIH0KICB9CiAgI3RvZ2dsZU5vdE5vdygpIHsKICAgIHRoaXMuI25vdE5vd0J1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJoaWRkZW4iLCAhdGhpcy4jZmlyc3RUaW1lKTsKICAgIHRoaXMuI2NhbmNlbEJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJoaWRkZW4iLCB0aGlzLiNmaXJzdFRpbWUpOwogIH0KICAjdG9nZ2xlQUkodmFsdWUpIHsKICAgIGlmICghdGhpcy4jdWlNYW5hZ2VyIHx8IHRoaXMuI2hhc0FJID09PSB2YWx1ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNoYXNBSSA9IHZhbHVlOwogICAgdGhpcy4jZGlhbG9nLmNsYXNzTGlzdC50b2dnbGUoIm5vQWkiLCAhdmFsdWUpOwogICAgdGhpcy4jdG9nZ2xlVGl0bGVBbmREaXNjbGFpbWVyKCk7CiAgfQogICN0b2dnbGVUaXRsZUFuZERpc2NsYWltZXIoKSB7CiAgICBjb25zdCB2aXNpYmxlID0gdGhpcy4jaXNBSUxvYWRpbmcgfHwgdGhpcy4jZ3Vlc3NlZEFsdFRleHQgJiYgdGhpcy4jZ3Vlc3NlZEFsdFRleHQgPT09IHRoaXMuI3RleHRhcmVhLnZhbHVlOwogICAgdGhpcy4jZGlzY2xhaW1lci5oaWRkZW4gPSAhdmlzaWJsZTsKICAgIGNvbnN0IGlzRWRpdGluZyA9IHRoaXMuI2lzQUlMb2FkaW5nIHx8ICEhdGhpcy4jdGV4dGFyZWEudmFsdWU7CiAgICBpZiAodGhpcy4jaXNFZGl0aW5nID09PSBpc0VkaXRpbmcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jaXNFZGl0aW5nID0gaXNFZGl0aW5nOwogICAgdGhpcy4jdGl0bGUuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCBpc0VkaXRpbmcgPyAicGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1kaWFsb2ctZWRpdC1sYWJlbCIgOiAicGRmanMtZWRpdG9yLW5ldy1hbHQtdGV4dC1kaWFsb2ctYWRkLWxhYmVsIik7CiAgfQogIGFzeW5jICNtbEd1ZXNzQWx0VGV4dChpc0luaXRpYWwpIHsKICAgIGlmICh0aGlzLiNpc0FJTG9hZGluZykgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy4jdGV4dGFyZWEudmFsdWUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGlzSW5pdGlhbCAmJiB0aGlzLiNwcmV2aW91c0FsdFRleHQgIT09IG51bGwpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jZ3Vlc3NlZEFsdFRleHQgPSB0aGlzLiNjdXJyZW50RWRpdG9yLmd1ZXNzZWRBbHRUZXh0OwogICAgaWYgKHRoaXMuI3ByZXZpb3VzQWx0VGV4dCA9PT0gbnVsbCAmJiB0aGlzLiNndWVzc2VkQWx0VGV4dCkgewogICAgICB0aGlzLiNhZGRBbHRUZXh0KHRoaXMuI2d1ZXNzZWRBbHRUZXh0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jdG9nZ2xlTG9hZGluZyh0cnVlKTsKICAgIHRoaXMuI3RvZ2dsZVRpdGxlQW5kRGlzY2xhaW1lcigpOwogICAgbGV0IGhhc0Vycm9yID0gZmFsc2U7CiAgICB0cnkgewogICAgICBjb25zdCBhbHRUZXh0ID0gYXdhaXQgdGhpcy4jY3VycmVudEVkaXRvci5tbEd1ZXNzQWx0VGV4dCh0aGlzLiNpbWFnZURhdGEsIGZhbHNlKTsKICAgICAgaWYgKGFsdFRleHQpIHsKICAgICAgICB0aGlzLiNndWVzc2VkQWx0VGV4dCA9IGFsdFRleHQ7CiAgICAgICAgdGhpcy4jd2FzQUlMb2FkaW5nID0gdGhpcy4jaXNBSUxvYWRpbmc7CiAgICAgICAgaWYgKHRoaXMuI2lzQUlMb2FkaW5nKSB7CiAgICAgICAgICB0aGlzLiNhZGRBbHRUZXh0KGFsdFRleHQpOwogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICBoYXNFcnJvciA9IHRydWU7CiAgICB9CiAgICB0aGlzLiN0b2dnbGVMb2FkaW5nKGZhbHNlKTsKICAgIHRoaXMuI3RvZ2dsZVRpdGxlQW5kRGlzY2xhaW1lcigpOwogICAgaWYgKGhhc0Vycm9yICYmIHRoaXMuI3VpTWFuYWdlcikgewogICAgICB0aGlzLiN0b2dnbGVFcnJvcih0cnVlKTsKICAgIH0KICB9CiAgI2FkZEFsdFRleHQoYWx0VGV4dCkgewogICAgaWYgKCF0aGlzLiN1aU1hbmFnZXIgfHwgdGhpcy4jdGV4dGFyZWEudmFsdWUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jdGV4dGFyZWEudmFsdWUgPSBhbHRUZXh0OwogICAgdGhpcy4jdG9nZ2xlVGl0bGVBbmREaXNjbGFpbWVyKCk7CiAgfQogICNzZXRQcm9ncmVzcygpIHsKICAgIHRoaXMuI2Rvd25sb2FkTW9kZWwuY2xhc3NMaXN0LnRvZ2dsZSgiaGlkZGVuIiwgZmFsc2UpOwogICAgY29uc3QgY2FsbGJhY2sgPSBhc3luYyAoewogICAgICBkZXRhaWw6IHsKICAgICAgICBmaW5pc2hlZCwKICAgICAgICB0b3RhbCwKICAgICAgICB0b3RhbExvYWRlZAogICAgICB9CiAgICB9KSA9PiB7CiAgICAgIGNvbnN0IE9ORV9NRUdBX0JZVEVTID0gMWU2OwogICAgICB0b3RhbExvYWRlZCA9IE1hdGgubWluKDAuOTkgKiB0b3RhbCwgdG90YWxMb2FkZWQpOwogICAgICBjb25zdCB0b3RhbFNpemUgPSB0aGlzLiNkb3dubG9hZE1vZGVsRGVzY3JpcHRpb24uYXJpYVZhbHVlTWF4ID0gTWF0aC5yb3VuZCh0b3RhbCAvIE9ORV9NRUdBX0JZVEVTKTsKICAgICAgY29uc3QgZG93bmxvYWRlZFNpemUgPSB0aGlzLiNkb3dubG9hZE1vZGVsRGVzY3JpcHRpb24uYXJpYVZhbHVlTm93ID0gTWF0aC5yb3VuZCh0b3RhbExvYWRlZCAvIE9ORV9NRUdBX0JZVEVTKTsKICAgICAgdGhpcy4jZG93bmxvYWRNb2RlbERlc2NyaXB0aW9uLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWFyZ3MiLCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgdG90YWxTaXplLAogICAgICAgIGRvd25sb2FkZWRTaXplCiAgICAgIH0pKTsKICAgICAgaWYgKCFmaW5pc2hlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLiNldmVudEJ1cy5fb2ZmKCJsb2FkYWllbmdpbmVwcm9ncmVzcyIsIGNhbGxiYWNrKTsKICAgICAgdGhpcy4jZG93bmxvYWRNb2RlbC5jbGFzc0xpc3QudG9nZ2xlKCJoaWRkZW4iLCB0cnVlKTsKICAgICAgdGhpcy4jdG9nZ2xlQUkodHJ1ZSk7CiAgICAgIGlmICghdGhpcy4jdWlNYW5hZ2VyKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBtbE1hbmFnZXIKICAgICAgfSA9IHRoaXMuI3VpTWFuYWdlcjsKICAgICAgbWxNYW5hZ2VyLnRvZ2dsZVNlcnZpY2UoImFsdFRleHQiLCB0cnVlKTsKICAgICAgdGhpcy4jdG9nZ2xlR3Vlc3NBbHRUZXh0KGF3YWl0IG1sTWFuYWdlci5pc0VuYWJsZWRGb3IoImFsdFRleHQiKSwgdHJ1ZSk7CiAgICB9OwogICAgdGhpcy4jZXZlbnRCdXMuX29uKCJsb2FkYWllbmdpbmVwcm9ncmVzcyIsIGNhbGxiYWNrKTsKICB9CiAgYXN5bmMgZWRpdEFsdFRleHQodWlNYW5hZ2VyLCBlZGl0b3IsIGZpcnN0VGltZSkgewogICAgaWYgKHRoaXMuI2N1cnJlbnRFZGl0b3IgfHwgIWVkaXRvcikgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoZmlyc3RUaW1lICYmIGVkaXRvci5oYXNBbHRUZXh0RGF0YSgpKSB7CiAgICAgIGVkaXRvci5hbHRUZXh0RmluaXNoKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2ZpcnN0VGltZSA9IGZpcnN0VGltZTsKICAgIGxldCB7CiAgICAgIG1sTWFuYWdlcgogICAgfSA9IHVpTWFuYWdlcjsKICAgIGxldCBoYXNBSSA9ICEhbWxNYW5hZ2VyOwogICAgdGhpcy4jdG9nZ2xlVGl0bGVBbmREaXNjbGFpbWVyKCk7CiAgICBpZiAobWxNYW5hZ2VyICYmICFtbE1hbmFnZXIuaXNSZWFkeSgiYWx0VGV4dCIpKSB7CiAgICAgIGhhc0FJID0gZmFsc2U7CiAgICAgIGlmIChtbE1hbmFnZXIuaGFzUHJvZ3Jlc3MpIHsKICAgICAgICB0aGlzLiNzZXRQcm9ncmVzcygpOwogICAgICB9IGVsc2UgewogICAgICAgIG1sTWFuYWdlciA9IG51bGw7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuI2Rvd25sb2FkTW9kZWwuY2xhc3NMaXN0LnRvZ2dsZSgiaGlkZGVuIiwgdHJ1ZSk7CiAgICB9CiAgICBjb25zdCBpc0FsdFRleHRFbmFibGVkUHJvbWlzZSA9IG1sTWFuYWdlcj8uaXNFbmFibGVkRm9yKCJhbHRUZXh0Iik7CiAgICB0aGlzLiNjdXJyZW50RWRpdG9yID0gZWRpdG9yOwogICAgdGhpcy4jdWlNYW5hZ2VyID0gdWlNYW5hZ2VyOwogICAgdGhpcy4jdWlNYW5hZ2VyLnJlbW92ZUVkaXRMaXN0ZW5lcnMoKTsKICAgICh7CiAgICAgIGFsdFRleHQ6IHRoaXMuI3ByZXZpb3VzQWx0VGV4dAogICAgfSA9IGVkaXRvci5hbHRUZXh0RGF0YSk7CiAgICB0aGlzLiN0ZXh0YXJlYS52YWx1ZSA9IHRoaXMuI3ByZXZpb3VzQWx0VGV4dCA/PyAiIjsKICAgIGNvbnN0IEFJX01BWF9JTUFHRV9ESU1FTlNJT04gPSAyMjQ7CiAgICBjb25zdCBNQVhfUFJFVklFV19ESU1FTlNJT04gPSAxODA7CiAgICBsZXQgY2FudmFzLCB3aWR0aCwgaGVpZ2h0OwogICAgaWYgKG1sTWFuYWdlcikgewogICAgICAoewogICAgICAgIGNhbnZhcywKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgaW1hZ2VEYXRhOiB0aGlzLiNpbWFnZURhdGEKICAgICAgfSA9IGVkaXRvci5jb3B5Q2FudmFzKEFJX01BWF9JTUFHRV9ESU1FTlNJT04sIE1BWF9QUkVWSUVXX0RJTUVOU0lPTiwgdHJ1ZSkpOwogICAgICBpZiAoaGFzQUkpIHsKICAgICAgICB0aGlzLiN0b2dnbGVHdWVzc0FsdFRleHQoYXdhaXQgaXNBbHRUZXh0RW5hYmxlZFByb21pc2UsIHRydWUpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAoewogICAgICAgIGNhbnZhcywKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQKICAgICAgfSA9IGVkaXRvci5jb3B5Q2FudmFzKEFJX01BWF9JTUFHRV9ESU1FTlNJT04sIE1BWF9QUkVWSUVXX0RJTUVOU0lPTiwgZmFsc2UpKTsKICAgIH0KICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGUoInJvbGUiLCAicHJlc2VudGF0aW9uIik7CiAgICBjb25zdCB7CiAgICAgIHN0eWxlCiAgICB9ID0gY2FudmFzOwogICAgc3R5bGUud2lkdGggPSBgJHt3aWR0aH1weGA7CiAgICBzdHlsZS5oZWlnaHQgPSBgJHtoZWlnaHR9cHhgOwogICAgdGhpcy4jaW1hZ2VQcmV2aWV3LmFwcGVuZChjYW52YXMpOwogICAgdGhpcy4jdG9nZ2xlTm90Tm93KCk7CiAgICB0aGlzLiN0b2dnbGVBSShoYXNBSSk7CiAgICB0aGlzLiN0b2dnbGVFcnJvcihmYWxzZSk7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLiNvdmVybGF5TWFuYWdlci5vcGVuKHRoaXMuI2RpYWxvZyk7CiAgICB9IGNhdGNoIChleCkgewogICAgICB0aGlzLiNjbG9zZSgpOwogICAgICB0aHJvdyBleDsKICAgIH0KICB9CiAgI2NhbmNlbCgpIHsKICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IuYWx0VGV4dERhdGEgPSB7CiAgICAgIGNhbmNlbDogdHJ1ZQogICAgfTsKICAgIGNvbnN0IGFsdFRleHQgPSB0aGlzLiN0ZXh0YXJlYS52YWx1ZS50cmltKCk7CiAgICB0aGlzLiNjdXJyZW50RWRpdG9yLl9yZXBvcnRUZWxlbWV0cnkoewogICAgICBhY3Rpb246ICJwZGZqcy5pbWFnZS5hbHRfdGV4dC5kaXNtaXNzIiwKICAgICAgZGF0YTogewogICAgICAgIGFsdF90ZXh0X3R5cGU6IGFsdFRleHQgPyAicHJlc2VudCIgOiAiZW1wdHkiLAogICAgICAgIGZsb3c6IHRoaXMuI2ZpcnN0VGltZSA/ICJpbWFnZV9hZGQiIDogImFsdF90ZXh0X2VkaXQiCiAgICAgIH0KICAgIH0pOwogICAgdGhpcy4jY3VycmVudEVkaXRvci5fcmVwb3J0VGVsZW1ldHJ5KHsKICAgICAgYWN0aW9uOiAicGRmanMuaW1hZ2UuaW1hZ2VfYWRkZWQiLAogICAgICBkYXRhOiB7CiAgICAgICAgYWx0X3RleHRfbW9kYWw6IHRydWUsCiAgICAgICAgYWx0X3RleHRfdHlwZTogInNraXBwZWQiCiAgICAgIH0KICAgIH0pOwogICAgdGhpcy4jZmluaXNoKCk7CiAgfQogICNmaW5pc2goKSB7CiAgICB0aGlzLiNvdmVybGF5TWFuYWdlci5jbG9zZUlmQWN0aXZlKHRoaXMuI2RpYWxvZyk7CiAgfQogICNjbG9zZSgpIHsKICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuI2ltYWdlUHJldmlldy5maXJzdENoaWxkOwogICAgY2FudmFzLnJlbW92ZSgpOwogICAgY2FudmFzLndpZHRoID0gY2FudmFzLmhlaWdodCA9IDA7CiAgICB0aGlzLiNpbWFnZURhdGEgPSBudWxsOwogICAgdGhpcy4jdG9nZ2xlTG9hZGluZyhmYWxzZSk7CiAgICB0aGlzLiN1aU1hbmFnZXI/LmFkZEVkaXRMaXN0ZW5lcnMoKTsKICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IuYWx0VGV4dEZpbmlzaCgpOwogICAgdGhpcy4jdWlNYW5hZ2VyPy5zZXRTZWxlY3RlZCh0aGlzLiNjdXJyZW50RWRpdG9yKTsKICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IgPSBudWxsOwogICAgdGhpcy4jdWlNYW5hZ2VyID0gbnVsbDsKICB9CiAgI2V4dHJhY3RXb3Jkcyh0ZXh0KSB7CiAgICByZXR1cm4gbmV3IFNldCh0ZXh0LnRvTG93ZXJDYXNlKCkuc3BsaXQoL1teXHB7TH1ccHtOfV0rL2d1KS5maWx0ZXIoeCA9PiAhIXgpKTsKICB9CiAgI3NhdmUoKSB7CiAgICBjb25zdCBhbHRUZXh0ID0gdGhpcy4jdGV4dGFyZWEudmFsdWUudHJpbSgpOwogICAgdGhpcy4jY3VycmVudEVkaXRvci5hbHRUZXh0RGF0YSA9IHsKICAgICAgYWx0VGV4dCwKICAgICAgZGVjb3JhdGl2ZTogZmFsc2UKICAgIH07CiAgICB0aGlzLiNjdXJyZW50RWRpdG9yLmFsdFRleHREYXRhLmd1ZXNzZWRBbHRUZXh0ID0gdGhpcy4jZ3Vlc3NlZEFsdFRleHQ7CiAgICBpZiAodGhpcy4jZ3Vlc3NlZEFsdFRleHQgJiYgdGhpcy4jZ3Vlc3NlZEFsdFRleHQgIT09IGFsdFRleHQpIHsKICAgICAgY29uc3QgZ3Vlc3NlZFdvcmRzID0gdGhpcy4jZXh0cmFjdFdvcmRzKHRoaXMuI2d1ZXNzZWRBbHRUZXh0KTsKICAgICAgY29uc3Qgd29yZHMgPSB0aGlzLiNleHRyYWN0V29yZHMoYWx0VGV4dCk7CiAgICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IuX3JlcG9ydFRlbGVtZXRyeSh7CiAgICAgICAgYWN0aW9uOiAicGRmanMuaW1hZ2UuYWx0X3RleHQudXNlcl9lZGl0IiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICB0b3RhbF93b3JkczogZ3Vlc3NlZFdvcmRzLnNpemUsCiAgICAgICAgICB3b3Jkc19yZW1vdmVkOiBndWVzc2VkV29yZHMuZGlmZmVyZW5jZSh3b3Jkcykuc2l6ZSwKICAgICAgICAgIHdvcmRzX2FkZGVkOiB3b3Jkcy5kaWZmZXJlbmNlKGd1ZXNzZWRXb3Jkcykuc2l6ZQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICB0aGlzLiNjdXJyZW50RWRpdG9yLl9yZXBvcnRUZWxlbWV0cnkoewogICAgICBhY3Rpb246ICJwZGZqcy5pbWFnZS5pbWFnZV9hZGRlZCIsCiAgICAgIGRhdGE6IHsKICAgICAgICBhbHRfdGV4dF9tb2RhbDogdHJ1ZSwKICAgICAgICBhbHRfdGV4dF90eXBlOiBhbHRUZXh0ID8gInByZXNlbnQiIDogImVtcHR5IgogICAgICB9CiAgICB9KTsKICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IuX3JlcG9ydFRlbGVtZXRyeSh7CiAgICAgIGFjdGlvbjogInBkZmpzLmltYWdlLmFsdF90ZXh0LnNhdmUiLAogICAgICBkYXRhOiB7CiAgICAgICAgYWx0X3RleHRfdHlwZTogYWx0VGV4dCA/ICJwcmVzZW50IiA6ICJlbXB0eSIsCiAgICAgICAgZmxvdzogdGhpcy4jZmlyc3RUaW1lID8gImltYWdlX2FkZCIgOiAiYWx0X3RleHRfZWRpdCIKICAgICAgfQogICAgfSk7CiAgICB0aGlzLiNmaW5pc2goKTsKICB9CiAgZGVzdHJveSgpIHsKICAgIHRoaXMuI3VpTWFuYWdlciA9IG51bGw7CiAgICB0aGlzLiNmaW5pc2goKTsKICB9Cn0KY2xhc3MgSW1hZ2VBbHRUZXh0U2V0dGluZ3MgewogICNhaU1vZGVsU2V0dGluZ3M7CiAgI2NyZWF0ZU1vZGVsQnV0dG9uOwogICNkb3dubG9hZE1vZGVsQnV0dG9uOwogICNkaWFsb2c7CiAgI2V2ZW50QnVzOwogICNtbE1hbmFnZXI7CiAgI292ZXJsYXlNYW5hZ2VyOwogICNzaG93QWx0VGV4dERpYWxvZ0J1dHRvbjsKICBjb25zdHJ1Y3Rvcih7CiAgICBkaWFsb2csCiAgICBjcmVhdGVNb2RlbEJ1dHRvbiwKICAgIGFpTW9kZWxTZXR0aW5ncywKICAgIGxlYXJuTW9yZSwKICAgIGNsb3NlQnV0dG9uLAogICAgZGVsZXRlTW9kZWxCdXR0b24sCiAgICBkb3dubG9hZE1vZGVsQnV0dG9uLAogICAgc2hvd0FsdFRleHREaWFsb2dCdXR0b24KICB9LCBvdmVybGF5TWFuYWdlciwgZXZlbnRCdXMsIG1sTWFuYWdlcikgewogICAgdGhpcy4jZGlhbG9nID0gZGlhbG9nOwogICAgdGhpcy4jYWlNb2RlbFNldHRpbmdzID0gYWlNb2RlbFNldHRpbmdzOwogICAgdGhpcy4jY3JlYXRlTW9kZWxCdXR0b24gPSBjcmVhdGVNb2RlbEJ1dHRvbjsKICAgIHRoaXMuI2Rvd25sb2FkTW9kZWxCdXR0b24gPSBkb3dubG9hZE1vZGVsQnV0dG9uOwogICAgdGhpcy4jc2hvd0FsdFRleHREaWFsb2dCdXR0b24gPSBzaG93QWx0VGV4dERpYWxvZ0J1dHRvbjsKICAgIHRoaXMuI292ZXJsYXlNYW5hZ2VyID0gb3ZlcmxheU1hbmFnZXI7CiAgICB0aGlzLiNldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgdGhpcy4jbWxNYW5hZ2VyID0gbWxNYW5hZ2VyOwogICAgY29uc3QgewogICAgICBhbHRUZXh0TGVhcm5Nb3JlVXJsCiAgICB9ID0gbWxNYW5hZ2VyOwogICAgaWYgKGFsdFRleHRMZWFybk1vcmVVcmwpIHsKICAgICAgbGVhcm5Nb3JlLmhyZWYgPSBhbHRUZXh0TGVhcm5Nb3JlVXJsOwogICAgfQogICAgZGlhbG9nLmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51Iiwgbm9Db250ZXh0TWVudSk7CiAgICBjcmVhdGVNb2RlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFzeW5jIGUgPT4gewogICAgICBjb25zdCBjaGVja2VkID0gdGhpcy4jdG9nZ2xlUHJlZigiZW5hYmxlR3Vlc3NBbHRUZXh0IiwgZSk7CiAgICAgIGF3YWl0IG1sTWFuYWdlci50b2dnbGVTZXJ2aWNlKCJhbHRUZXh0IiwgY2hlY2tlZCk7CiAgICAgIHRoaXMuI3JlcG9ydFRlbGVtZXRyeSh7CiAgICAgICAgdHlwZTogInN0YW1wIiwKICAgICAgICBhY3Rpb246ICJwZGZqcy5pbWFnZS5hbHRfdGV4dC5zZXR0aW5nc19haV9nZW5lcmF0aW9uX2NoZWNrIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBzdGF0dXM6IGNoZWNrZWQKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgICBzaG93QWx0VGV4dERpYWxvZ0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGUgPT4gewogICAgICBjb25zdCBjaGVja2VkID0gdGhpcy4jdG9nZ2xlUHJlZigiZW5hYmxlTmV3QWx0VGV4dFdoZW5BZGRpbmdJbWFnZSIsIGUpOwogICAgICB0aGlzLiNyZXBvcnRUZWxlbWV0cnkoewogICAgICAgIHR5cGU6ICJzdGFtcCIsCiAgICAgICAgYWN0aW9uOiAicGRmanMuaW1hZ2UuYWx0X3RleHQuc2V0dGluZ3NfZWRpdF9hbHRfdGV4dF9jaGVjayIsCiAgICAgICAgZGF0YTogewogICAgICAgICAgc3RhdHVzOiBjaGVja2VkCiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogICAgZGVsZXRlTW9kZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLiNkZWxldGUuYmluZCh0aGlzLCB0cnVlKSk7CiAgICBkb3dubG9hZE1vZGVsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy4jZG93bmxvYWQuYmluZCh0aGlzLCB0cnVlKSk7CiAgICBjbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuI2ZpbmlzaC5iaW5kKHRoaXMpKTsKICAgIGxlYXJuTW9yZS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgdGhpcy4jcmVwb3J0VGVsZW1ldHJ5KHsKICAgICAgICB0eXBlOiAic3RhbXAiLAogICAgICAgIGFjdGlvbjogInBkZmpzLmltYWdlLmFsdF90ZXh0LmluZm8iLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIHRvcGljOiAiYWlfZ2VuZXJhdGlvbiIKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgICBldmVudEJ1cy5fb24oImVuYWJsZWFsdHRleHRtb2RlbGRvd25sb2FkIiwgKHsKICAgICAgdmFsdWUKICAgIH0pID0+IHsKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgdGhpcy4jZG93bmxvYWQoZmFsc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuI2RlbGV0ZShmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy4jb3ZlcmxheU1hbmFnZXIucmVnaXN0ZXIoZGlhbG9nKTsKICB9CiAgI3JlcG9ydFRlbGVtZXRyeShkYXRhKSB7CiAgICB0aGlzLiNldmVudEJ1cy5kaXNwYXRjaCgicmVwb3J0dGVsZW1ldHJ5IiwgewogICAgICBzb3VyY2U6IHRoaXMsCiAgICAgIGRldGFpbHM6IHsKICAgICAgICB0eXBlOiAiZWRpdGluZyIsCiAgICAgICAgZGF0YQogICAgICB9CiAgICB9KTsKICB9CiAgYXN5bmMgI2Rvd25sb2FkKGlzRnJvbVVJID0gZmFsc2UpIHsKICAgIGlmIChpc0Zyb21VSSkgewogICAgICB0aGlzLiNkb3dubG9hZE1vZGVsQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgY29uc3Qgc3BhbiA9IHRoaXMuI2Rvd25sb2FkTW9kZWxCdXR0b24uZmlyc3RDaGlsZDsKICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsICJwZGZqcy1lZGl0b3ItYWx0LXRleHQtc2V0dGluZ3MtZG93bmxvYWRpbmctbW9kZWwtYnV0dG9uIik7CiAgICAgIGF3YWl0IHRoaXMuI21sTWFuYWdlci5kb3dubG9hZE1vZGVsKCJhbHRUZXh0Iik7CiAgICAgIHNwYW4uc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCAicGRmanMtZWRpdG9yLWFsdC10ZXh0LXNldHRpbmdzLWRvd25sb2FkLW1vZGVsLWJ1dHRvbiIpOwogICAgICB0aGlzLiNjcmVhdGVNb2RlbEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICB0aGlzLiNzZXRQcmVmKCJlbmFibGVHdWVzc0FsdFRleHQiLCB0cnVlKTsKICAgICAgdGhpcy4jbWxNYW5hZ2VyLnRvZ2dsZVNlcnZpY2UoImFsdFRleHQiLCB0cnVlKTsKICAgICAgdGhpcy4jc2V0UHJlZigiZW5hYmxlQWx0VGV4dE1vZGVsRG93bmxvYWQiLCB0cnVlKTsKICAgICAgdGhpcy4jZG93bmxvYWRNb2RlbEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlOwogICAgfQogICAgdGhpcy4jYWlNb2RlbFNldHRpbmdzLmNsYXNzTGlzdC50b2dnbGUoImRvd25sb2FkIiwgZmFsc2UpOwogICAgdGhpcy4jY3JlYXRlTW9kZWxCdXR0b24uc2V0QXR0cmlidXRlKCJhcmlhLXByZXNzZWQiLCB0cnVlKTsKICB9CiAgYXN5bmMgI2RlbGV0ZShpc0Zyb21VSSA9IGZhbHNlKSB7CiAgICBpZiAoaXNGcm9tVUkpIHsKICAgICAgYXdhaXQgdGhpcy4jbWxNYW5hZ2VyLmRlbGV0ZU1vZGVsKCJhbHRUZXh0Iik7CiAgICAgIHRoaXMuI3NldFByZWYoImVuYWJsZUd1ZXNzQWx0VGV4dCIsIGZhbHNlKTsKICAgICAgdGhpcy4jc2V0UHJlZigiZW5hYmxlQWx0VGV4dE1vZGVsRG93bmxvYWQiLCBmYWxzZSk7CiAgICB9CiAgICB0aGlzLiNhaU1vZGVsU2V0dGluZ3MuY2xhc3NMaXN0LnRvZ2dsZSgiZG93bmxvYWQiLCB0cnVlKTsKICAgIHRoaXMuI2NyZWF0ZU1vZGVsQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTsKICAgIHRoaXMuI2NyZWF0ZU1vZGVsQnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1wcmVzc2VkIiwgZmFsc2UpOwogIH0KICBhc3luYyBvcGVuKHsKICAgIGVuYWJsZUd1ZXNzQWx0VGV4dCwKICAgIGVuYWJsZU5ld0FsdFRleHRXaGVuQWRkaW5nSW1hZ2UKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIGVuYWJsZUFsdFRleHRNb2RlbERvd25sb2FkCiAgICB9ID0gdGhpcy4jbWxNYW5hZ2VyOwogICAgdGhpcy4jY3JlYXRlTW9kZWxCdXR0b24uZGlzYWJsZWQgPSAhZW5hYmxlQWx0VGV4dE1vZGVsRG93bmxvYWQ7CiAgICB0aGlzLiNjcmVhdGVNb2RlbEJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtcHJlc3NlZCIsIGVuYWJsZUFsdFRleHRNb2RlbERvd25sb2FkICYmIGVuYWJsZUd1ZXNzQWx0VGV4dCk7CiAgICB0aGlzLiNzaG93QWx0VGV4dERpYWxvZ0J1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtcHJlc3NlZCIsIGVuYWJsZU5ld0FsdFRleHRXaGVuQWRkaW5nSW1hZ2UpOwogICAgdGhpcy4jYWlNb2RlbFNldHRpbmdzLmNsYXNzTGlzdC50b2dnbGUoImRvd25sb2FkIiwgIWVuYWJsZUFsdFRleHRNb2RlbERvd25sb2FkKTsKICAgIGF3YWl0IHRoaXMuI292ZXJsYXlNYW5hZ2VyLm9wZW4odGhpcy4jZGlhbG9nKTsKICAgIHRoaXMuI3JlcG9ydFRlbGVtZXRyeSh7CiAgICAgIHR5cGU6ICJzdGFtcCIsCiAgICAgIGFjdGlvbjogInBkZmpzLmltYWdlLmFsdF90ZXh0LnNldHRpbmdzX2Rpc3BsYXllZCIKICAgIH0pOwogIH0KICAjdG9nZ2xlUHJlZihuYW1lLCB7CiAgICB0YXJnZXQKICB9KSB7CiAgICBjb25zdCBjaGVja2VkID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgiYXJpYS1wcmVzc2VkIikgIT09ICJ0cnVlIjsKICAgIHRoaXMuI3NldFByZWYobmFtZSwgY2hlY2tlZCk7CiAgICB0YXJnZXQuc2V0QXR0cmlidXRlKCJhcmlhLXByZXNzZWQiLCBjaGVja2VkKTsKICAgIHJldHVybiBjaGVja2VkOwogIH0KICAjc2V0UHJlZihuYW1lLCB2YWx1ZSkgewogICAgdGhpcy4jZXZlbnRCdXMuZGlzcGF0Y2goInNldHByZWZlcmVuY2UiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgbmFtZSwKICAgICAgdmFsdWUKICAgIH0pOwogIH0KICAjZmluaXNoKCkgewogICAgdGhpcy4jb3ZlcmxheU1hbmFnZXIuY2xvc2VJZkFjdGl2ZSh0aGlzLiNkaWFsb2cpOwogIH0KfQoKOy8vIC4vd2ViL2FsdF90ZXh0X21hbmFnZXIuanMKCmNsYXNzIEFsdFRleHRNYW5hZ2VyIHsKICAjY2xpY2tBQyA9IG51bGw7CiAgI2N1cnJlbnRFZGl0b3IgPSBudWxsOwogICNjYW5jZWxCdXR0b247CiAgI2RpYWxvZzsKICAjZXZlbnRCdXM7CiAgI2hhc1VzZWRQb2ludGVyID0gZmFsc2U7CiAgI29wdGlvbkRlc2NyaXB0aW9uOwogICNvcHRpb25EZWNvcmF0aXZlOwogICNvdmVybGF5TWFuYWdlcjsKICAjc2F2ZUJ1dHRvbjsKICAjdGV4dGFyZWE7CiAgI3VpTWFuYWdlcjsKICAjcHJldmlvdXNBbHRUZXh0ID0gbnVsbDsKICAjcmVzaXplQUMgPSBudWxsOwogICNzdmdFbGVtZW50ID0gbnVsbDsKICAjcmVjdEVsZW1lbnQgPSBudWxsOwogICNjb250YWluZXI7CiAgI3RlbGVtZXRyeURhdGEgPSBudWxsOwogIGNvbnN0cnVjdG9yKHsKICAgIGRpYWxvZywKICAgIG9wdGlvbkRlc2NyaXB0aW9uLAogICAgb3B0aW9uRGVjb3JhdGl2ZSwKICAgIHRleHRhcmVhLAogICAgY2FuY2VsQnV0dG9uLAogICAgc2F2ZUJ1dHRvbgogIH0sIGNvbnRhaW5lciwgb3ZlcmxheU1hbmFnZXIsIGV2ZW50QnVzKSB7CiAgICB0aGlzLiNkaWFsb2cgPSBkaWFsb2c7CiAgICB0aGlzLiNvcHRpb25EZXNjcmlwdGlvbiA9IG9wdGlvbkRlc2NyaXB0aW9uOwogICAgdGhpcy4jb3B0aW9uRGVjb3JhdGl2ZSA9IG9wdGlvbkRlY29yYXRpdmU7CiAgICB0aGlzLiN0ZXh0YXJlYSA9IHRleHRhcmVhOwogICAgdGhpcy4jY2FuY2VsQnV0dG9uID0gY2FuY2VsQnV0dG9uOwogICAgdGhpcy4jc2F2ZUJ1dHRvbiA9IHNhdmVCdXR0b247CiAgICB0aGlzLiNvdmVybGF5TWFuYWdlciA9IG92ZXJsYXlNYW5hZ2VyOwogICAgdGhpcy4jZXZlbnRCdXMgPSBldmVudEJ1czsKICAgIHRoaXMuI2NvbnRhaW5lciA9IGNvbnRhaW5lcjsKICAgIGNvbnN0IG9uVXBkYXRlVUlTdGF0ZSA9IHRoaXMuI3VwZGF0ZVVJU3RhdGUuYmluZCh0aGlzKTsKICAgIGRpYWxvZy5hZGRFdmVudExpc3RlbmVyKCJjbG9zZSIsIHRoaXMuI2Nsb3NlLmJpbmQodGhpcykpOwogICAgZGlhbG9nLmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51IiwgZXZlbnQgPT4gewogICAgICBpZiAoZXZlbnQudGFyZ2V0ICE9PSB0aGlzLiN0ZXh0YXJlYSkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0pOwogICAgY2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy4jZmluaXNoLmJpbmQodGhpcykpOwogICAgc2F2ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuI3NhdmUuYmluZCh0aGlzKSk7CiAgICBvcHRpb25EZXNjcmlwdGlvbi5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCBvblVwZGF0ZVVJU3RhdGUpOwogICAgb3B0aW9uRGVjb3JhdGl2ZS5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCBvblVwZGF0ZVVJU3RhdGUpOwogICAgdGhpcy4jb3ZlcmxheU1hbmFnZXIucmVnaXN0ZXIoZGlhbG9nKTsKICB9CiAgI2NyZWF0ZVNWR0VsZW1lbnQoKSB7CiAgICBpZiAodGhpcy4jc3ZnRWxlbWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBzdmdGYWN0b3J5ID0gbmV3IERPTVNWR0ZhY3RvcnkoKTsKICAgIGNvbnN0IHN2ZyA9IHRoaXMuI3N2Z0VsZW1lbnQgPSBzdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInN2ZyIpOwogICAgc3ZnLnNldEF0dHJpYnV0ZSgid2lkdGgiLCAiMCIpOwogICAgc3ZnLnNldEF0dHJpYnV0ZSgiaGVpZ2h0IiwgIjAiKTsKICAgIGNvbnN0IGRlZnMgPSBzdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoImRlZnMiKTsKICAgIHN2Zy5hcHBlbmQoZGVmcyk7CiAgICBjb25zdCBtYXNrID0gc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJtYXNrIik7CiAgICBkZWZzLmFwcGVuZChtYXNrKTsKICAgIG1hc2suc2V0QXR0cmlidXRlKCJpZCIsICJhbHR0ZXh0LW1hbmFnZXItbWFzayIpOwogICAgbWFzay5zZXRBdHRyaWJ1dGUoIm1hc2tDb250ZW50VW5pdHMiLCAib2JqZWN0Qm91bmRpbmdCb3giKTsKICAgIGxldCByZWN0ID0gc3ZnRmFjdG9yeS5jcmVhdGVFbGVtZW50KCJyZWN0Iik7CiAgICBtYXNrLmFwcGVuZChyZWN0KTsKICAgIHJlY3Quc2V0QXR0cmlidXRlKCJmaWxsIiwgIndoaXRlIik7CiAgICByZWN0LnNldEF0dHJpYnV0ZSgid2lkdGgiLCAiMSIpOwogICAgcmVjdC5zZXRBdHRyaWJ1dGUoImhlaWdodCIsICIxIik7CiAgICByZWN0LnNldEF0dHJpYnV0ZSgieCIsICIwIik7CiAgICByZWN0LnNldEF0dHJpYnV0ZSgieSIsICIwIik7CiAgICByZWN0ID0gdGhpcy4jcmVjdEVsZW1lbnQgPSBzdmdGYWN0b3J5LmNyZWF0ZUVsZW1lbnQoInJlY3QiKTsKICAgIG1hc2suYXBwZW5kKHJlY3QpOwogICAgcmVjdC5zZXRBdHRyaWJ1dGUoImZpbGwiLCAiYmxhY2siKTsKICAgIHRoaXMuI2RpYWxvZy5hcHBlbmQoc3ZnKTsKICB9CiAgYXN5bmMgZWRpdEFsdFRleHQodWlNYW5hZ2VyLCBlZGl0b3IpIHsKICAgIGlmICh0aGlzLiNjdXJyZW50RWRpdG9yIHx8ICFlZGl0b3IpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jY3JlYXRlU1ZHRWxlbWVudCgpOwogICAgdGhpcy4jaGFzVXNlZFBvaW50ZXIgPSBmYWxzZTsKICAgIHRoaXMuI2NsaWNrQUMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBjb25zdCBjbGlja09wdHMgPSB7CiAgICAgICAgc2lnbmFsOiB0aGlzLiNjbGlja0FDLnNpZ25hbAogICAgICB9LAogICAgICBvbkNsaWNrID0gdGhpcy4jb25DbGljay5iaW5kKHRoaXMpOwogICAgZm9yIChjb25zdCBlbGVtZW50IG9mIFt0aGlzLiNvcHRpb25EZXNjcmlwdGlvbiwgdGhpcy4jb3B0aW9uRGVjb3JhdGl2ZSwgdGhpcy4jdGV4dGFyZWEsIHRoaXMuI3NhdmVCdXR0b24sIHRoaXMuI2NhbmNlbEJ1dHRvbl0pIHsKICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIG9uQ2xpY2ssIGNsaWNrT3B0cyk7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGFsdFRleHQsCiAgICAgIGRlY29yYXRpdmUKICAgIH0gPSBlZGl0b3IuYWx0VGV4dERhdGE7CiAgICBpZiAoZGVjb3JhdGl2ZSA9PT0gdHJ1ZSkgewogICAgICB0aGlzLiNvcHRpb25EZWNvcmF0aXZlLmNoZWNrZWQgPSB0cnVlOwogICAgICB0aGlzLiNvcHRpb25EZXNjcmlwdGlvbi5jaGVja2VkID0gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICB0aGlzLiNvcHRpb25EZWNvcmF0aXZlLmNoZWNrZWQgPSBmYWxzZTsKICAgICAgdGhpcy4jb3B0aW9uRGVzY3JpcHRpb24uY2hlY2tlZCA9IHRydWU7CiAgICB9CiAgICB0aGlzLiNwcmV2aW91c0FsdFRleHQgPSB0aGlzLiN0ZXh0YXJlYS52YWx1ZSA9IGFsdFRleHQ/LnRyaW0oKSB8fCAiIjsKICAgIHRoaXMuI3VwZGF0ZVVJU3RhdGUoKTsKICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IgPSBlZGl0b3I7CiAgICB0aGlzLiN1aU1hbmFnZXIgPSB1aU1hbmFnZXI7CiAgICB0aGlzLiN1aU1hbmFnZXIucmVtb3ZlRWRpdExpc3RlbmVycygpOwogICAgdGhpcy4jcmVzaXplQUMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICB0aGlzLiNldmVudEJ1cy5fb24oInJlc2l6ZSIsIHRoaXMuI3NldFBvc2l0aW9uLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsOiB0aGlzLiNyZXNpemVBQy5zaWduYWwKICAgIH0pOwogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy4jb3ZlcmxheU1hbmFnZXIub3Blbih0aGlzLiNkaWFsb2cpOwogICAgICB0aGlzLiNzZXRQb3NpdGlvbigpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgdGhpcy4jY2xvc2UoKTsKICAgICAgdGhyb3cgZXg7CiAgICB9CiAgfQogICNzZXRQb3NpdGlvbigpIHsKICAgIGlmICghdGhpcy4jY3VycmVudEVkaXRvcikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBkaWFsb2cgPSB0aGlzLiNkaWFsb2c7CiAgICBjb25zdCB7CiAgICAgIHN0eWxlCiAgICB9ID0gZGlhbG9nOwogICAgY29uc3QgewogICAgICB4OiBjb250YWluZXJYLAogICAgICB5OiBjb250YWluZXJZLAogICAgICB3aWR0aDogY29udGFpbmVyVywKICAgICAgaGVpZ2h0OiBjb250YWluZXJICiAgICB9ID0gdGhpcy4jY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgY29uc3QgewogICAgICBpbm5lcldpZHRoOiB3aW5kb3dXLAogICAgICBpbm5lckhlaWdodDogd2luZG93SAogICAgfSA9IHdpbmRvdzsKICAgIGNvbnN0IHsKICAgICAgd2lkdGg6IGRpYWxvZ1csCiAgICAgIGhlaWdodDogZGlhbG9nSAogICAgfSA9IGRpYWxvZy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGNvbnN0IHsKICAgICAgeCwKICAgICAgeSwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IHRoaXMuI2N1cnJlbnRFZGl0b3IuZ2V0Q2xpZW50RGltZW5zaW9ucygpOwogICAgY29uc3QgTUFSR0lOID0gMTA7CiAgICBjb25zdCBpc0xUUiA9IHRoaXMuI3VpTWFuYWdlci5kaXJlY3Rpb24gPT09ICJsdHIiOwogICAgY29uc3QgeHMgPSBNYXRoLm1heCh4LCBjb250YWluZXJYKTsKICAgIGNvbnN0IHhlID0gTWF0aC5taW4oeCArIHdpZHRoLCBjb250YWluZXJYICsgY29udGFpbmVyVyk7CiAgICBjb25zdCB5cyA9IE1hdGgubWF4KHksIGNvbnRhaW5lclkpOwogICAgY29uc3QgeWUgPSBNYXRoLm1pbih5ICsgaGVpZ2h0LCBjb250YWluZXJZICsgY29udGFpbmVySCk7CiAgICB0aGlzLiNyZWN0RWxlbWVudC5zZXRBdHRyaWJ1dGUoIndpZHRoIiwgYCR7KHhlIC0geHMpIC8gd2luZG93V31gKTsKICAgIHRoaXMuI3JlY3RFbGVtZW50LnNldEF0dHJpYnV0ZSgiaGVpZ2h0IiwgYCR7KHllIC0geXMpIC8gd2luZG93SH1gKTsKICAgIHRoaXMuI3JlY3RFbGVtZW50LnNldEF0dHJpYnV0ZSgieCIsIGAke3hzIC8gd2luZG93V31gKTsKICAgIHRoaXMuI3JlY3RFbGVtZW50LnNldEF0dHJpYnV0ZSgieSIsIGAke3lzIC8gd2luZG93SH1gKTsKICAgIGxldCBsZWZ0ID0gbnVsbDsKICAgIGxldCB0b3AgPSBNYXRoLm1heCh5LCAwKTsKICAgIHRvcCArPSBNYXRoLm1pbih3aW5kb3dIIC0gKHRvcCArIGRpYWxvZ0gpLCAwKTsKICAgIGlmIChpc0xUUikgewogICAgICBpZiAoeCArIHdpZHRoICsgTUFSR0lOICsgZGlhbG9nVyA8IHdpbmRvd1cpIHsKICAgICAgICBsZWZ0ID0geCArIHdpZHRoICsgTUFSR0lOOwogICAgICB9IGVsc2UgaWYgKHggPiBkaWFsb2dXICsgTUFSR0lOKSB7CiAgICAgICAgbGVmdCA9IHggLSBkaWFsb2dXIC0gTUFSR0lOOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHggPiBkaWFsb2dXICsgTUFSR0lOKSB7CiAgICAgIGxlZnQgPSB4IC0gZGlhbG9nVyAtIE1BUkdJTjsKICAgIH0gZWxzZSBpZiAoeCArIHdpZHRoICsgTUFSR0lOICsgZGlhbG9nVyA8IHdpbmRvd1cpIHsKICAgICAgbGVmdCA9IHggKyB3aWR0aCArIE1BUkdJTjsKICAgIH0KICAgIGlmIChsZWZ0ID09PSBudWxsKSB7CiAgICAgIHRvcCA9IG51bGw7CiAgICAgIGxlZnQgPSBNYXRoLm1heCh4LCAwKTsKICAgICAgbGVmdCArPSBNYXRoLm1pbih3aW5kb3dXIC0gKGxlZnQgKyBkaWFsb2dXKSwgMCk7CiAgICAgIGlmICh5ID4gZGlhbG9nSCArIE1BUkdJTikgewogICAgICAgIHRvcCA9IHkgLSBkaWFsb2dIIC0gTUFSR0lOOwogICAgICB9IGVsc2UgaWYgKHkgKyBoZWlnaHQgKyBNQVJHSU4gKyBkaWFsb2dIIDwgd2luZG93SCkgewogICAgICAgIHRvcCA9IHkgKyBoZWlnaHQgKyBNQVJHSU47CiAgICAgIH0KICAgIH0KICAgIGlmICh0b3AgIT09IG51bGwpIHsKICAgICAgZGlhbG9nLmNsYXNzTGlzdC5hZGQoInBvc2l0aW9uZWQiKTsKICAgICAgaWYgKGlzTFRSKSB7CiAgICAgICAgc3R5bGUubGVmdCA9IGAke2xlZnR9cHhgOwogICAgICB9IGVsc2UgewogICAgICAgIHN0eWxlLnJpZ2h0ID0gYCR7d2luZG93VyAtIGxlZnQgLSBkaWFsb2dXfXB4YDsKICAgICAgfQogICAgICBzdHlsZS50b3AgPSBgJHt0b3B9cHhgOwogICAgfSBlbHNlIHsKICAgICAgZGlhbG9nLmNsYXNzTGlzdC5yZW1vdmUoInBvc2l0aW9uZWQiKTsKICAgICAgc3R5bGUubGVmdCA9ICIiOwogICAgICBzdHlsZS50b3AgPSAiIjsKICAgIH0KICB9CiAgI2ZpbmlzaCgpIHsKICAgIHRoaXMuI292ZXJsYXlNYW5hZ2VyLmNsb3NlSWZBY3RpdmUodGhpcy4jZGlhbG9nKTsKICB9CiAgI2Nsb3NlKCkgewogICAgdGhpcy4jY3VycmVudEVkaXRvci5fcmVwb3J0VGVsZW1ldHJ5KHRoaXMuI3RlbGVtZXRyeURhdGEgfHwgewogICAgICBhY3Rpb246ICJhbHRfdGV4dF9jYW5jZWwiLAogICAgICBhbHRfdGV4dF9rZXlib2FyZDogIXRoaXMuI2hhc1VzZWRQb2ludGVyCiAgICB9KTsKICAgIHRoaXMuI3RlbGVtZXRyeURhdGEgPSBudWxsOwogICAgdGhpcy4jcmVtb3ZlT25DbGlja0xpc3RlbmVycygpOwogICAgdGhpcy4jdWlNYW5hZ2VyPy5hZGRFZGl0TGlzdGVuZXJzKCk7CiAgICB0aGlzLiNyZXNpemVBQz8uYWJvcnQoKTsKICAgIHRoaXMuI3Jlc2l6ZUFDID0gbnVsbDsKICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IuYWx0VGV4dEZpbmlzaCgpOwogICAgdGhpcy4jY3VycmVudEVkaXRvciA9IG51bGw7CiAgICB0aGlzLiN1aU1hbmFnZXIgPSBudWxsOwogIH0KICAjdXBkYXRlVUlTdGF0ZSgpIHsKICAgIHRoaXMuI3RleHRhcmVhLmRpc2FibGVkID0gdGhpcy4jb3B0aW9uRGVjb3JhdGl2ZS5jaGVja2VkOwogIH0KICAjc2F2ZSgpIHsKICAgIGNvbnN0IGFsdFRleHQgPSB0aGlzLiN0ZXh0YXJlYS52YWx1ZS50cmltKCk7CiAgICBjb25zdCBkZWNvcmF0aXZlID0gdGhpcy4jb3B0aW9uRGVjb3JhdGl2ZS5jaGVja2VkOwogICAgdGhpcy4jY3VycmVudEVkaXRvci5hbHRUZXh0RGF0YSA9IHsKICAgICAgYWx0VGV4dCwKICAgICAgZGVjb3JhdGl2ZQogICAgfTsKICAgIHRoaXMuI3RlbGVtZXRyeURhdGEgPSB7CiAgICAgIGFjdGlvbjogImFsdF90ZXh0X3NhdmUiLAogICAgICBhbHRfdGV4dF9kZXNjcmlwdGlvbjogISFhbHRUZXh0LAogICAgICBhbHRfdGV4dF9lZGl0OiAhIXRoaXMuI3ByZXZpb3VzQWx0VGV4dCAmJiB0aGlzLiNwcmV2aW91c0FsdFRleHQgIT09IGFsdFRleHQsCiAgICAgIGFsdF90ZXh0X2RlY29yYXRpdmU6IGRlY29yYXRpdmUsCiAgICAgIGFsdF90ZXh0X2tleWJvYXJkOiAhdGhpcy4jaGFzVXNlZFBvaW50ZXIKICAgIH07CiAgICB0aGlzLiNmaW5pc2goKTsKICB9CiAgI29uQ2xpY2soZXZ0KSB7CiAgICBpZiAoZXZ0LmRldGFpbCA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNoYXNVc2VkUG9pbnRlciA9IHRydWU7CiAgICB0aGlzLiNyZW1vdmVPbkNsaWNrTGlzdGVuZXJzKCk7CiAgfQogICNyZW1vdmVPbkNsaWNrTGlzdGVuZXJzKCkgewogICAgdGhpcy4jY2xpY2tBQz8uYWJvcnQoKTsKICAgIHRoaXMuI2NsaWNrQUMgPSBudWxsOwogIH0KICBkZXN0cm95KCkgewogICAgdGhpcy4jdWlNYW5hZ2VyID0gbnVsbDsKICAgIHRoaXMuI2ZpbmlzaCgpOwogICAgdGhpcy4jc3ZnRWxlbWVudD8ucmVtb3ZlKCk7CiAgICB0aGlzLiNzdmdFbGVtZW50ID0gdGhpcy4jcmVjdEVsZW1lbnQgPSBudWxsOwogIH0KfQoKOy8vIC4vd2ViL2Fubm90YXRpb25fZWRpdG9yX3BhcmFtcy5qcwoKY2xhc3MgQW5ub3RhdGlvbkVkaXRvclBhcmFtcyB7CiAgY29uc3RydWN0b3Iob3B0aW9ucywgZXZlbnRCdXMpIHsKICAgIHRoaXMuZXZlbnRCdXMgPSBldmVudEJ1czsKICAgIHRoaXMuI2JpbmRMaXN0ZW5lcnMob3B0aW9ucyk7CiAgfQogICNiaW5kTGlzdGVuZXJzKHsKICAgIGVkaXRvckZyZWVUZXh0Rm9udFNpemUsCiAgICBlZGl0b3JGcmVlVGV4dENvbG9yLAogICAgZWRpdG9ySW5rQ29sb3IsCiAgICBlZGl0b3JJbmtUaGlja25lc3MsCiAgICBlZGl0b3JJbmtPcGFjaXR5LAogICAgZWRpdG9yU3RhbXBBZGRJbWFnZSwKICAgIGVkaXRvckZyZWVIaWdobGlnaHRUaGlja25lc3MsCiAgICBlZGl0b3JIaWdobGlnaHRTaG93QWxsLAogICAgZWRpdG9yU2lnbmF0dXJlQWRkU2lnbmF0dXJlCiAgfSkgewogICAgY29uc3QgewogICAgICBldmVudEJ1cwogICAgfSA9IHRoaXM7CiAgICBjb25zdCBkaXNwYXRjaEV2ZW50ID0gKHR5cGVTdHIsIHZhbHVlKSA9PiB7CiAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKCJzd2l0Y2hhbm5vdGF0aW9uZWRpdG9ycGFyYW1zIiwgewogICAgICAgIHNvdXJjZTogdGhpcywKICAgICAgICB0eXBlOiBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZVt0eXBlU3RyXSwKICAgICAgICB2YWx1ZQogICAgICB9KTsKICAgIH07CiAgICBlZGl0b3JGcmVlVGV4dEZvbnRTaXplLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgZnVuY3Rpb24gKCkgewogICAgICBkaXNwYXRjaEV2ZW50KCJGUkVFVEVYVF9TSVpFIiwgdGhpcy52YWx1ZUFzTnVtYmVyKTsKICAgIH0pOwogICAgZWRpdG9yRnJlZVRleHRDb2xvci5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIGZ1bmN0aW9uICgpIHsKICAgICAgZGlzcGF0Y2hFdmVudCgiRlJFRVRFWFRfQ09MT1IiLCB0aGlzLnZhbHVlKTsKICAgIH0pOwogICAgZWRpdG9ySW5rQ29sb3IuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGRpc3BhdGNoRXZlbnQoIklOS19DT0xPUiIsIHRoaXMudmFsdWUpOwogICAgfSk7CiAgICBlZGl0b3JJbmtUaGlja25lc3MuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGRpc3BhdGNoRXZlbnQoIklOS19USElDS05FU1MiLCB0aGlzLnZhbHVlQXNOdW1iZXIpOwogICAgfSk7CiAgICBlZGl0b3JJbmtPcGFjaXR5LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgZnVuY3Rpb24gKCkgewogICAgICBkaXNwYXRjaEV2ZW50KCJJTktfT1BBQ0lUWSIsIHRoaXMudmFsdWVBc051bWJlcik7CiAgICB9KTsKICAgIGVkaXRvclN0YW1wQWRkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKCJyZXBvcnR0ZWxlbWV0cnkiLCB7CiAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgIGRldGFpbHM6IHsKICAgICAgICAgIHR5cGU6ICJlZGl0aW5nIiwKICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgYWN0aW9uOiAicGRmanMuaW1hZ2UuYWRkX2ltYWdlX2NsaWNrIgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGRpc3BhdGNoRXZlbnQoIkNSRUFURSIpOwogICAgfSk7CiAgICBlZGl0b3JGcmVlSGlnaGxpZ2h0VGhpY2tuZXNzLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgZnVuY3Rpb24gKCkgewogICAgICBkaXNwYXRjaEV2ZW50KCJISUdITElHSFRfVEhJQ0tORVNTIiwgdGhpcy52YWx1ZUFzTnVtYmVyKTsKICAgIH0pOwogICAgZWRpdG9ySGlnaGxpZ2h0U2hvd0FsbC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3QgY2hlY2tlZCA9IHRoaXMuZ2V0QXR0cmlidXRlKCJhcmlhLXByZXNzZWQiKSA9PT0gInRydWUiOwogICAgICB0aGlzLnNldEF0dHJpYnV0ZSgiYXJpYS1wcmVzc2VkIiwgIWNoZWNrZWQpOwogICAgICBkaXNwYXRjaEV2ZW50KCJISUdITElHSFRfU0hPV19BTEwiLCAhY2hlY2tlZCk7CiAgICB9KTsKICAgIGVkaXRvclNpZ25hdHVyZUFkZFNpZ25hdHVyZS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgZGlzcGF0Y2hFdmVudCgiQ1JFQVRFIik7CiAgICB9KTsKICAgIGV2ZW50QnVzLl9vbigiYW5ub3RhdGlvbmVkaXRvcnBhcmFtc2NoYW5nZWQiLCBldnQgPT4gewogICAgICBmb3IgKGNvbnN0IFt0eXBlLCB2YWx1ZV0gb2YgZXZ0LmRldGFpbHMpIHsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuRlJFRVRFWFRfU0laRToKICAgICAgICAgICAgZWRpdG9yRnJlZVRleHRGb250U2l6ZS52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuRlJFRVRFWFRfQ09MT1I6CiAgICAgICAgICAgIGVkaXRvckZyZWVUZXh0Q29sb3IudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLklOS19DT0xPUjoKICAgICAgICAgICAgZWRpdG9ySW5rQ29sb3IudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLklOS19USElDS05FU1M6CiAgICAgICAgICAgIGVkaXRvcklua1RoaWNrbmVzcy52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSU5LX09QQUNJVFk6CiAgICAgICAgICAgIGVkaXRvcklua09wYWNpdHkudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLkhJR0hMSUdIVF9ERUZBVUxUX0NPTE9SOgogICAgICAgICAgICBldmVudEJ1cy5kaXNwYXRjaCgibWFpbmhpZ2hsaWdodGNvbG9ycGlja2VydXBkYXRlY29sb3IiLCB7CiAgICAgICAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgICAgICAgIHZhbHVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX1RISUNLTkVTUzoKICAgICAgICAgICAgZWRpdG9yRnJlZUhpZ2hsaWdodFRoaWNrbmVzcy52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUuSElHSExJR0hUX0ZSRUU6CiAgICAgICAgICAgIGVkaXRvckZyZWVIaWdobGlnaHRUaGlja25lc3MuZGlzYWJsZWQgPSAhdmFsdWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZS5ISUdITElHSFRfU0hPV19BTEw6CiAgICAgICAgICAgIGVkaXRvckhpZ2hsaWdodFNob3dBbGwuc2V0QXR0cmlidXRlKCJhcmlhLXByZXNzZWQiLCB2YWx1ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfQp9Cgo7Ly8gLi93ZWIvY2FyZXRfYnJvd3NpbmcuanMKY29uc3QgUFJFQ0lTSU9OID0gMWUtMTsKY2xhc3MgQ2FyZXRCcm93c2luZ01vZGUgewogICNtYWluQ29udGFpbmVyOwogICN0b29sQmFySGVpZ2h0ID0gMDsKICAjdmlld2VyQ29udGFpbmVyOwogIGNvbnN0cnVjdG9yKGFib3J0U2lnbmFsLCBtYWluQ29udGFpbmVyLCB2aWV3ZXJDb250YWluZXIsIHRvb2xiYXJDb250YWluZXIpIHsKICAgIHRoaXMuI21haW5Db250YWluZXIgPSBtYWluQ29udGFpbmVyOwogICAgdGhpcy4jdmlld2VyQ29udGFpbmVyID0gdmlld2VyQ29udGFpbmVyOwogICAgaWYgKCF0b29sYmFyQ29udGFpbmVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI3Rvb2xCYXJIZWlnaHQgPSB0b29sYmFyQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDsKICAgIGNvbnN0IHRvb2xiYXJPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcihlbnRyaWVzID0+IHsKICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7CiAgICAgICAgaWYgKGVudHJ5LnRhcmdldCA9PT0gdG9vbGJhckNvbnRhaW5lcikgewogICAgICAgICAgdGhpcy4jdG9vbEJhckhlaWdodCA9IE1hdGguZmxvb3IoZW50cnkuYm9yZGVyQm94U2l6ZVswXS5ibG9ja1NpemUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIHRvb2xiYXJPYnNlcnZlci5vYnNlcnZlKHRvb2xiYXJDb250YWluZXIpOwogICAgYWJvcnRTaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCAoKSA9PiB0b29sYmFyT2JzZXJ2ZXIuZGlzY29ubmVjdCgpLCB7CiAgICAgIG9uY2U6IHRydWUKICAgIH0pOwogIH0KICAjaXNPblNhbWVMaW5lKHJlY3QxLCByZWN0MikgewogICAgY29uc3QgdG9wMSA9IHJlY3QxLnk7CiAgICBjb25zdCBib3QxID0gcmVjdDEuYm90dG9tOwogICAgY29uc3QgbWlkMSA9IHJlY3QxLnkgKyByZWN0MS5oZWlnaHQgLyAyOwogICAgY29uc3QgdG9wMiA9IHJlY3QyLnk7CiAgICBjb25zdCBib3QyID0gcmVjdDIuYm90dG9tOwogICAgY29uc3QgbWlkMiA9IHJlY3QyLnkgKyByZWN0Mi5oZWlnaHQgLyAyOwogICAgcmV0dXJuIHRvcDEgPD0gbWlkMiAmJiBtaWQyIDw9IGJvdDEgfHwgdG9wMiA8PSBtaWQxICYmIG1pZDEgPD0gYm90MjsKICB9CiAgI2lzVW5kZXJPdmVyKHJlY3QsIHgsIHksIGlzVXApIHsKICAgIGNvbnN0IG1pZFkgPSByZWN0LnkgKyByZWN0LmhlaWdodCAvIDI7CiAgICByZXR1cm4gKGlzVXAgPyB5ID49IG1pZFkgOiB5IDw9IG1pZFkpICYmIHJlY3QueCAtIFBSRUNJU0lPTiA8PSB4ICYmIHggPD0gcmVjdC5yaWdodCArIFBSRUNJU0lPTjsKICB9CiAgI2lzVmlzaWJsZShyZWN0KSB7CiAgICByZXR1cm4gcmVjdC50b3AgPj0gdGhpcy4jdG9vbEJhckhlaWdodCAmJiByZWN0LmxlZnQgPj0gMCAmJiByZWN0LmJvdHRvbSA8PSAod2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpICYmIHJlY3QucmlnaHQgPD0gKHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCk7CiAgfQogICNnZXRDYXJldFBvc2l0aW9uKHNlbGVjdGlvbiwgaXNVcCkgewogICAgY29uc3QgewogICAgICBmb2N1c05vZGUsCiAgICAgIGZvY3VzT2Zmc2V0CiAgICB9ID0gc2VsZWN0aW9uOwogICAgY29uc3QgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpOwogICAgcmFuZ2Uuc2V0U3RhcnQoZm9jdXNOb2RlLCBmb2N1c09mZnNldCk7CiAgICByYW5nZS5zZXRFbmQoZm9jdXNOb2RlLCBmb2N1c09mZnNldCk7CiAgICBjb25zdCByZWN0ID0gcmFuZ2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICByZXR1cm4gW3JlY3QueCwgaXNVcCA/IHJlY3QudG9wIDogcmVjdC5ib3R0b21dOwogIH0KICBzdGF0aWMgI2NhcmV0UG9zaXRpb25Gcm9tUG9pbnQoeCwgeSkgewogICAgaWYgKCFkb2N1bWVudC5jYXJldFBvc2l0aW9uRnJvbVBvaW50KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBzdGFydENvbnRhaW5lcjogb2Zmc2V0Tm9kZSwKICAgICAgICBzdGFydE9mZnNldDogb2Zmc2V0CiAgICAgIH0gPSBkb2N1bWVudC5jYXJldFJhbmdlRnJvbVBvaW50KHgsIHkpOwogICAgICByZXR1cm4gewogICAgICAgIG9mZnNldE5vZGUsCiAgICAgICAgb2Zmc2V0CiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gZG9jdW1lbnQuY2FyZXRQb3NpdGlvbkZyb21Qb2ludCh4LCB5KTsKICB9CiAgI3NldENhcmV0UG9zaXRpb25IZWxwZXIoc2VsZWN0aW9uLCBjYXJldFgsIHNlbGVjdCwgZWxlbWVudCwgcmVjdCkgewogICAgcmVjdCB8fD0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGlmIChjYXJldFggPD0gcmVjdC54ICsgUFJFQ0lTSU9OKSB7CiAgICAgIGlmIChzZWxlY3QpIHsKICAgICAgICBzZWxlY3Rpb24uZXh0ZW5kKGVsZW1lbnQuZmlyc3RDaGlsZCwgMCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZWN0aW9uLnNldFBvc2l0aW9uKGVsZW1lbnQuZmlyc3RDaGlsZCwgMCk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHJlY3QucmlnaHQgLSBQUkVDSVNJT04gPD0gY2FyZXRYKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBsYXN0Q2hpbGQKICAgICAgfSA9IGVsZW1lbnQ7CiAgICAgIGlmIChzZWxlY3QpIHsKICAgICAgICBzZWxlY3Rpb24uZXh0ZW5kKGxhc3RDaGlsZCwgbGFzdENoaWxkLmxlbmd0aCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZWN0aW9uLnNldFBvc2l0aW9uKGxhc3RDaGlsZCwgbGFzdENoaWxkLmxlbmd0aCk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbWlkWSA9IHJlY3QueSArIHJlY3QuaGVpZ2h0IC8gMjsKICAgIGxldCBjYXJldFBvc2l0aW9uID0gQ2FyZXRCcm93c2luZ01vZGUuI2NhcmV0UG9zaXRpb25Gcm9tUG9pbnQoY2FyZXRYLCBtaWRZKTsKICAgIGxldCBwYXJlbnRFbGVtZW50ID0gY2FyZXRQb3NpdGlvbi5vZmZzZXROb2RlPy5wYXJlbnRFbGVtZW50OwogICAgaWYgKHBhcmVudEVsZW1lbnQgJiYgcGFyZW50RWxlbWVudCAhPT0gZWxlbWVudCkgewogICAgICBjb25zdCBlbGVtZW50c0F0UG9pbnQgPSBkb2N1bWVudC5lbGVtZW50c0Zyb21Qb2ludChjYXJldFgsIG1pZFkpOwogICAgICBjb25zdCBzYXZlZFZpc2liaWxpdGllcyA9IFtdOwogICAgICBmb3IgKGNvbnN0IGVsIG9mIGVsZW1lbnRzQXRQb2ludCkgewogICAgICAgIGlmIChlbCA9PT0gZWxlbWVudCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHN0eWxlCiAgICAgICAgfSA9IGVsOwogICAgICAgIHNhdmVkVmlzaWJpbGl0aWVzLnB1c2goW2VsLCBzdHlsZS52aXNpYmlsaXR5XSk7CiAgICAgICAgc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwogICAgICB9CiAgICAgIGNhcmV0UG9zaXRpb24gPSBDYXJldEJyb3dzaW5nTW9kZS4jY2FyZXRQb3NpdGlvbkZyb21Qb2ludChjYXJldFgsIG1pZFkpOwogICAgICBwYXJlbnRFbGVtZW50ID0gY2FyZXRQb3NpdGlvbi5vZmZzZXROb2RlPy5wYXJlbnRFbGVtZW50OwogICAgICBmb3IgKGNvbnN0IFtlbCwgdmlzaWJpbGl0eV0gb2Ygc2F2ZWRWaXNpYmlsaXRpZXMpIHsKICAgICAgICBlbC5zdHlsZS52aXNpYmlsaXR5ID0gdmlzaWJpbGl0eTsKICAgICAgfQogICAgfQogICAgaWYgKHBhcmVudEVsZW1lbnQgIT09IGVsZW1lbnQpIHsKICAgICAgaWYgKHNlbGVjdCkgewogICAgICAgIHNlbGVjdGlvbi5leHRlbmQoZWxlbWVudC5maXJzdENoaWxkLCAwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxlY3Rpb24uc2V0UG9zaXRpb24oZWxlbWVudC5maXJzdENoaWxkLCAwKTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoc2VsZWN0KSB7CiAgICAgIHNlbGVjdGlvbi5leHRlbmQoY2FyZXRQb3NpdGlvbi5vZmZzZXROb2RlLCBjYXJldFBvc2l0aW9uLm9mZnNldCk7CiAgICB9IGVsc2UgewogICAgICBzZWxlY3Rpb24uc2V0UG9zaXRpb24oY2FyZXRQb3NpdGlvbi5vZmZzZXROb2RlLCBjYXJldFBvc2l0aW9uLm9mZnNldCk7CiAgICB9CiAgfQogICNzZXRDYXJldFBvc2l0aW9uKHNlbGVjdCwgc2VsZWN0aW9uLCBuZXdMaW5lRWxlbWVudCwgbmV3TGluZUVsZW1lbnRSZWN0LCBjYXJldFgpIHsKICAgIGlmICh0aGlzLiNpc1Zpc2libGUobmV3TGluZUVsZW1lbnRSZWN0KSkgewogICAgICB0aGlzLiNzZXRDYXJldFBvc2l0aW9uSGVscGVyKHNlbGVjdGlvbiwgY2FyZXRYLCBzZWxlY3QsIG5ld0xpbmVFbGVtZW50LCBuZXdMaW5lRWxlbWVudFJlY3QpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNtYWluQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoInNjcm9sbGVuZCIsIHRoaXMuI3NldENhcmV0UG9zaXRpb25IZWxwZXIuYmluZCh0aGlzLCBzZWxlY3Rpb24sIGNhcmV0WCwgc2VsZWN0LCBuZXdMaW5lRWxlbWVudCwgbnVsbCksIHsKICAgICAgb25jZTogdHJ1ZQogICAgfSk7CiAgICBuZXdMaW5lRWxlbWVudC5zY3JvbGxJbnRvVmlldygpOwogIH0KICAjZ2V0Tm9kZU9uTmV4dFBhZ2UodGV4dExheWVyLCBpc1VwKSB7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBjb25zdCBwYWdlID0gdGV4dExheWVyLmNsb3Nlc3QoIi5wYWdlIik7CiAgICAgIGNvbnN0IHBhZ2VOdW1iZXIgPSBwYXJzZUludChwYWdlLmdldEF0dHJpYnV0ZSgiZGF0YS1wYWdlLW51bWJlciIpKTsKICAgICAgY29uc3QgbmV4dFBhZ2UgPSBpc1VwID8gcGFnZU51bWJlciAtIDEgOiBwYWdlTnVtYmVyICsgMTsKICAgICAgdGV4dExheWVyID0gdGhpcy4jdmlld2VyQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYC5wYWdlW2RhdGEtcGFnZS1udW1iZXI9IiR7bmV4dFBhZ2V9Il0gLnRleHRMYXllcmApOwogICAgICBpZiAoIXRleHRMYXllcikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IHdhbGtlciA9IGRvY3VtZW50LmNyZWF0ZVRyZWVXYWxrZXIodGV4dExheWVyLCBOb2RlRmlsdGVyLlNIT1dfVEVYVCk7CiAgICAgIGNvbnN0IG5vZGUgPSBpc1VwID8gd2Fsa2VyLmxhc3RDaGlsZCgpIDogd2Fsa2VyLmZpcnN0Q2hpbGQoKTsKICAgICAgaWYgKG5vZGUpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQogIH0KICBtb3ZlQ2FyZXQoaXNVcCwgc2VsZWN0KSB7CiAgICBjb25zdCBzZWxlY3Rpb24gPSBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKTsKICAgIGlmIChzZWxlY3Rpb24ucmFuZ2VDb3VudCA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGZvY3VzTm9kZQogICAgfSA9IHNlbGVjdGlvbjsKICAgIGNvbnN0IGZvY3VzRWxlbWVudCA9IGZvY3VzTm9kZS5ub2RlVHlwZSAhPT0gTm9kZS5FTEVNRU5UX05PREUgPyBmb2N1c05vZGUucGFyZW50RWxlbWVudCA6IGZvY3VzTm9kZTsKICAgIGNvbnN0IHJvb3QgPSBmb2N1c0VsZW1lbnQuY2xvc2VzdCgiLnRleHRMYXllciIpOwogICAgaWYgKCFyb290KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHdhbGtlciA9IGRvY3VtZW50LmNyZWF0ZVRyZWVXYWxrZXIocm9vdCwgTm9kZUZpbHRlci5TSE9XX1RFWFQpOwogICAgd2Fsa2VyLmN1cnJlbnROb2RlID0gZm9jdXNOb2RlOwogICAgY29uc3QgZm9jdXNSZWN0ID0gZm9jdXNFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgbGV0IG5ld0xpbmVFbGVtZW50ID0gbnVsbDsKICAgIGNvbnN0IG5vZGVJdGVyYXRvciA9IChpc1VwID8gd2Fsa2VyLnByZXZpb3VzU2libGluZyA6IHdhbGtlci5uZXh0U2libGluZykuYmluZCh3YWxrZXIpOwogICAgd2hpbGUgKG5vZGVJdGVyYXRvcigpKSB7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSB3YWxrZXIuY3VycmVudE5vZGUucGFyZW50RWxlbWVudDsKICAgICAgaWYgKCF0aGlzLiNpc09uU2FtZUxpbmUoZm9jdXNSZWN0LCBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSkgewogICAgICAgIG5ld0xpbmVFbGVtZW50ID0gZWxlbWVudDsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKCFuZXdMaW5lRWxlbWVudCkgewogICAgICBjb25zdCBub2RlID0gdGhpcy4jZ2V0Tm9kZU9uTmV4dFBhZ2Uocm9vdCwgaXNVcCk7CiAgICAgIGlmICghbm9kZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoc2VsZWN0KSB7CiAgICAgICAgY29uc3QgbGFzdE5vZGUgPSAoaXNVcCA/IHdhbGtlci5maXJzdENoaWxkKCkgOiB3YWxrZXIubGFzdENoaWxkKCkpIHx8IGZvY3VzTm9kZTsKICAgICAgICBzZWxlY3Rpb24uZXh0ZW5kKGxhc3ROb2RlLCBpc1VwID8gMCA6IGxhc3ROb2RlLmxlbmd0aCk7CiAgICAgICAgY29uc3QgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpOwogICAgICAgIHJhbmdlLnNldFN0YXJ0KG5vZGUsIGlzVXAgPyBub2RlLmxlbmd0aCA6IDApOwogICAgICAgIHJhbmdlLnNldEVuZChub2RlLCBpc1VwID8gbm9kZS5sZW5ndGggOiAwKTsKICAgICAgICBzZWxlY3Rpb24uYWRkUmFuZ2UocmFuZ2UpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBbY2FyZXRYXSA9IHRoaXMuI2dldENhcmV0UG9zaXRpb24oc2VsZWN0aW9uLCBpc1VwKTsKICAgICAgY29uc3QgewogICAgICAgIHBhcmVudEVsZW1lbnQKICAgICAgfSA9IG5vZGU7CiAgICAgIHRoaXMuI3NldENhcmV0UG9zaXRpb24oc2VsZWN0LCBzZWxlY3Rpb24sIHBhcmVudEVsZW1lbnQsIHBhcmVudEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIGNhcmV0WCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IFtjYXJldFgsIGNhcmV0WV0gPSB0aGlzLiNnZXRDYXJldFBvc2l0aW9uKHNlbGVjdGlvbiwgaXNVcCk7CiAgICBjb25zdCBuZXdMaW5lRWxlbWVudFJlY3QgPSBuZXdMaW5lRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGlmICh0aGlzLiNpc1VuZGVyT3ZlcihuZXdMaW5lRWxlbWVudFJlY3QsIGNhcmV0WCwgY2FyZXRZLCBpc1VwKSkgewogICAgICB0aGlzLiNzZXRDYXJldFBvc2l0aW9uKHNlbGVjdCwgc2VsZWN0aW9uLCBuZXdMaW5lRWxlbWVudCwgbmV3TGluZUVsZW1lbnRSZWN0LCBjYXJldFgpOwogICAgICByZXR1cm47CiAgICB9CiAgICB3aGlsZSAobm9kZUl0ZXJhdG9yKCkpIHsKICAgICAgY29uc3QgZWxlbWVudCA9IHdhbGtlci5jdXJyZW50Tm9kZS5wYXJlbnRFbGVtZW50OwogICAgICBjb25zdCBlbGVtZW50UmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIGlmICghdGhpcy4jaXNPblNhbWVMaW5lKG5ld0xpbmVFbGVtZW50UmVjdCwgZWxlbWVudFJlY3QpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuI2lzVW5kZXJPdmVyKGVsZW1lbnRSZWN0LCBjYXJldFgsIGNhcmV0WSwgaXNVcCkpIHsKICAgICAgICB0aGlzLiNzZXRDYXJldFBvc2l0aW9uKHNlbGVjdCwgc2VsZWN0aW9uLCBlbGVtZW50LCBlbGVtZW50UmVjdCwgY2FyZXRYKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICAgIHRoaXMuI3NldENhcmV0UG9zaXRpb24oc2VsZWN0LCBzZWxlY3Rpb24sIG5ld0xpbmVFbGVtZW50LCBuZXdMaW5lRWxlbWVudFJlY3QsIGNhcmV0WCk7CiAgfQp9Cgo7Ly8gLi93ZWIvZG93bmxvYWRfbWFuYWdlci5qcwoKZnVuY3Rpb24gZG93bmxvYWQoYmxvYlVybCwgZmlsZW5hbWUpIHsKICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogIGlmICghYS5jbGljaykgewogICAgdGhyb3cgbmV3IEVycm9yKCdEb3dubG9hZE1hbmFnZXI6ICJhLmNsaWNrKCkiIGlzIG5vdCBzdXBwb3J0ZWQuJyk7CiAgfQogIGEuaHJlZiA9IGJsb2JVcmw7CiAgYS50YXJnZXQgPSAiX3BhcmVudCI7CiAgaWYgKCJkb3dubG9hZCIgaW4gYSkgewogICAgYS5kb3dubG9hZCA9IGZpbGVuYW1lOwogIH0KICAoZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmFwcGVuZChhKTsKICBhLmNsaWNrKCk7CiAgYS5yZW1vdmUoKTsKfQpjbGFzcyBEb3dubG9hZE1hbmFnZXIgewogICNvcGVuQmxvYlVybHMgPSBuZXcgV2Vha01hcCgpOwogIGRvd25sb2FkRGF0YShkYXRhLCBmaWxlbmFtZSwgY29udGVudFR5cGUpIHsKICAgIGNvbnN0IGJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtkYXRhXSwgewogICAgICB0eXBlOiBjb250ZW50VHlwZQogICAgfSkpOwogICAgZG93bmxvYWQoYmxvYlVybCwgZmlsZW5hbWUpOwogIH0KICBvcGVuT3JEb3dubG9hZERhdGEoZGF0YSwgZmlsZW5hbWUsIGRlc3QgPSBudWxsKSB7CiAgICBjb25zdCBpc1BkZkRhdGEgPSBpc1BkZkZpbGUoZmlsZW5hbWUpOwogICAgY29uc3QgY29udGVudFR5cGUgPSBpc1BkZkRhdGEgPyAiYXBwbGljYXRpb24vcGRmIiA6ICIiOwogICAgaWYgKGlzUGRmRGF0YSkgewogICAgICBsZXQgYmxvYlVybCA9IHRoaXMuI29wZW5CbG9iVXJscy5nZXQoZGF0YSk7CiAgICAgIGlmICghYmxvYlVybCkgewogICAgICAgIGJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtkYXRhXSwgewogICAgICAgICAgdHlwZTogY29udGVudFR5cGUKICAgICAgICB9KSk7CiAgICAgICAgdGhpcy4jb3BlbkJsb2JVcmxzLnNldChkYXRhLCBibG9iVXJsKTsKICAgICAgfQogICAgICBsZXQgdmlld2VyVXJsOwogICAgICB2aWV3ZXJVcmwgPSAiP2ZpbGU9IiArIGVuY29kZVVSSUNvbXBvbmVudChibG9iVXJsICsgIiMiICsgZmlsZW5hbWUpOwogICAgICBpZiAoZGVzdCkgewogICAgICAgIHZpZXdlclVybCArPSBgIyR7ZXNjYXBlKGRlc3QpfWA7CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICB3aW5kb3cub3Blbih2aWV3ZXJVcmwpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIm9wZW5PckRvd25sb2FkRGF0YToiLCBleCk7CiAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChibG9iVXJsKTsKICAgICAgICB0aGlzLiNvcGVuQmxvYlVybHMuZGVsZXRlKGRhdGEpOwogICAgICB9CiAgICB9CiAgICB0aGlzLmRvd25sb2FkRGF0YShkYXRhLCBmaWxlbmFtZSwgY29udGVudFR5cGUpOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICBkb3dubG9hZChkYXRhLCB1cmwsIGZpbGVuYW1lKSB7CiAgICBsZXQgYmxvYlVybDsKICAgIGlmIChkYXRhKSB7CiAgICAgIGJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtkYXRhXSwgewogICAgICAgIHR5cGU6ICJhcHBsaWNhdGlvbi9wZGYiCiAgICAgIH0pKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghY3JlYXRlVmFsaWRBYnNvbHV0ZVVybCh1cmwsICJodHRwOi8vZXhhbXBsZS5jb20iKSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYGRvd25sb2FkIC0gbm90IGEgdmFsaWQgVVJMOiAke3VybH1gKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgYmxvYlVybCA9IHVybCArICIjcGRmanMuYWN0aW9uPWRvd25sb2FkIjsKICAgIH0KICAgIGRvd25sb2FkKGJsb2JVcmwsIGZpbGVuYW1lKTsKICB9Cn0KCjsvLyAuL3dlYi9lZGl0b3JfdW5kb19iYXIuanMKCmNsYXNzIEVkaXRvclVuZG9CYXIgewogICNjbG9zZUJ1dHRvbiA9IG51bGw7CiAgI2NvbnRhaW5lcjsKICAjZXZlbnRCdXMgPSBudWxsOwogICNmb2N1c1RpbWVvdXQgPSBudWxsOwogICNpbml0Q29udHJvbGxlciA9IG51bGw7CiAgaXNPcGVuID0gZmFsc2U7CiAgI21lc3NhZ2U7CiAgI3Nob3dDb250cm9sbGVyID0gbnVsbDsKICAjdW5kb0J1dHRvbjsKICBzdGF0aWMgI2wxMG5NZXNzYWdlcyA9IE9iamVjdC5mcmVlemUoewogICAgaGlnaGxpZ2h0OiAicGRmanMtZWRpdG9yLXVuZG8tYmFyLW1lc3NhZ2UtaGlnaGxpZ2h0IiwKICAgIGZyZWV0ZXh0OiAicGRmanMtZWRpdG9yLXVuZG8tYmFyLW1lc3NhZ2UtZnJlZXRleHQiLAogICAgc3RhbXA6ICJwZGZqcy1lZGl0b3ItdW5kby1iYXItbWVzc2FnZS1zdGFtcCIsCiAgICBpbms6ICJwZGZqcy1lZGl0b3ItdW5kby1iYXItbWVzc2FnZS1pbmsiLAogICAgc2lnbmF0dXJlOiAicGRmanMtZWRpdG9yLXVuZG8tYmFyLW1lc3NhZ2Utc2lnbmF0dXJlIiwKICAgIF9tdWx0aXBsZTogInBkZmpzLWVkaXRvci11bmRvLWJhci1tZXNzYWdlLW11bHRpcGxlIgogIH0pOwogIGNvbnN0cnVjdG9yKHsKICAgIGNvbnRhaW5lciwKICAgIG1lc3NhZ2UsCiAgICB1bmRvQnV0dG9uLAogICAgY2xvc2VCdXR0b24KICB9LCBldmVudEJ1cykgewogICAgdGhpcy4jY29udGFpbmVyID0gY29udGFpbmVyOwogICAgdGhpcy4jbWVzc2FnZSA9IG1lc3NhZ2U7CiAgICB0aGlzLiN1bmRvQnV0dG9uID0gdW5kb0J1dHRvbjsKICAgIHRoaXMuI2Nsb3NlQnV0dG9uID0gY2xvc2VCdXR0b247CiAgICB0aGlzLiNldmVudEJ1cyA9IGV2ZW50QnVzOwogIH0KICBkZXN0cm95KCkgewogICAgdGhpcy4jaW5pdENvbnRyb2xsZXI/LmFib3J0KCk7CiAgICB0aGlzLiNpbml0Q29udHJvbGxlciA9IG51bGw7CiAgICB0aGlzLmhpZGUoKTsKICB9CiAgc2hvdyh1bmRvQWN0aW9uLCBtZXNzYWdlRGF0YSkgewogICAgaWYgKCF0aGlzLiNpbml0Q29udHJvbGxlcikgewogICAgICB0aGlzLiNpbml0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgICAgY29uc3Qgb3B0cyA9IHsKICAgICAgICBzaWduYWw6IHRoaXMuI2luaXRDb250cm9sbGVyLnNpZ25hbAogICAgICB9OwogICAgICBjb25zdCBib3VuZEhpZGUgPSB0aGlzLmhpZGUuYmluZCh0aGlzKTsKICAgICAgdGhpcy4jY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51Iiwgbm9Db250ZXh0TWVudSwgb3B0cyk7CiAgICAgIHRoaXMuI2Nsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgYm91bmRIaWRlLCBvcHRzKTsKICAgICAgdGhpcy4jZXZlbnRCdXMuX29uKCJiZWZvcmVwcmludCIsIGJvdW5kSGlkZSwgb3B0cyk7CiAgICAgIHRoaXMuI2V2ZW50QnVzLl9vbigiZG93bmxvYWQiLCBib3VuZEhpZGUsIG9wdHMpOwogICAgfQogICAgdGhpcy5oaWRlKCk7CiAgICBpZiAodHlwZW9mIG1lc3NhZ2VEYXRhID09PSAic3RyaW5nIikgewogICAgICB0aGlzLiNtZXNzYWdlLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgRWRpdG9yVW5kb0Jhci4jbDEwbk1lc3NhZ2VzW21lc3NhZ2VEYXRhXSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLiNtZXNzYWdlLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgRWRpdG9yVW5kb0Jhci4jbDEwbk1lc3NhZ2VzLl9tdWx0aXBsZSk7CiAgICAgIHRoaXMuI21lc3NhZ2Uuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4tYXJncyIsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICBjb3VudDogbWVzc2FnZURhdGEKICAgICAgfSkpOwogICAgfQogICAgdGhpcy5pc09wZW4gPSB0cnVlOwogICAgdGhpcy4jY29udGFpbmVyLmhpZGRlbiA9IGZhbHNlOwogICAgdGhpcy4jc2hvd0NvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICB0aGlzLiN1bmRvQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICB1bmRvQWN0aW9uKCk7CiAgICAgIHRoaXMuaGlkZSgpOwogICAgfSwgewogICAgICBzaWduYWw6IHRoaXMuI3Nob3dDb250cm9sbGVyLnNpZ25hbAogICAgfSk7CiAgICB0aGlzLiNmb2N1c1RpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgdGhpcy4jY29udGFpbmVyLmZvY3VzKCk7CiAgICAgIHRoaXMuI2ZvY3VzVGltZW91dCA9IG51bGw7CiAgICB9LCAxMDApOwogIH0KICBoaWRlKCkgewogICAgaWYgKCF0aGlzLmlzT3BlbikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmlzT3BlbiA9IGZhbHNlOwogICAgdGhpcy4jY29udGFpbmVyLmhpZGRlbiA9IHRydWU7CiAgICB0aGlzLiNzaG93Q29udHJvbGxlcj8uYWJvcnQoKTsKICAgIHRoaXMuI3Nob3dDb250cm9sbGVyID0gbnVsbDsKICAgIGlmICh0aGlzLiNmb2N1c1RpbWVvdXQpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuI2ZvY3VzVGltZW91dCk7CiAgICAgIHRoaXMuI2ZvY3VzVGltZW91dCA9IG51bGw7CiAgICB9CiAgfQp9Cgo7Ly8gLi93ZWIvb3ZlcmxheV9tYW5hZ2VyLmpzCmNsYXNzIE92ZXJsYXlNYW5hZ2VyIHsKICAjb3ZlcmxheXMgPSBuZXcgV2Vha01hcCgpOwogICNhY3RpdmUgPSBudWxsOwogIGdldCBhY3RpdmUoKSB7CiAgICByZXR1cm4gdGhpcy4jYWN0aXZlOwogIH0KICBhc3luYyByZWdpc3RlcihkaWFsb2csIGNhbkZvcmNlQ2xvc2UgPSBmYWxzZSkgewogICAgaWYgKHR5cGVvZiBkaWFsb2cgIT09ICJvYmplY3QiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGVub3VnaCBwYXJhbWV0ZXJzLiIpOwogICAgfSBlbHNlIGlmICh0aGlzLiNvdmVybGF5cy5oYXMoZGlhbG9nKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBvdmVybGF5IGlzIGFscmVhZHkgcmVnaXN0ZXJlZC4iKTsKICAgIH0KICAgIHRoaXMuI292ZXJsYXlzLnNldChkaWFsb2csIHsKICAgICAgY2FuRm9yY2VDbG9zZQogICAgfSk7CiAgICBkaWFsb2cuYWRkRXZlbnRMaXN0ZW5lcigiY2FuY2VsIiwgKHsKICAgICAgdGFyZ2V0CiAgICB9KSA9PiB7CiAgICAgIGlmICh0aGlzLiNhY3RpdmUgPT09IHRhcmdldCkgewogICAgICAgIHRoaXMuI2FjdGl2ZSA9IG51bGw7CiAgICAgIH0KICAgIH0pOwogIH0KICBhc3luYyBvcGVuKGRpYWxvZykgewogICAgaWYgKCF0aGlzLiNvdmVybGF5cy5oYXMoZGlhbG9nKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBvdmVybGF5IGRvZXMgbm90IGV4aXN0LiIpOwogICAgfSBlbHNlIGlmICh0aGlzLiNhY3RpdmUpIHsKICAgICAgaWYgKHRoaXMuI2FjdGl2ZSA9PT0gZGlhbG9nKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgb3ZlcmxheSBpcyBhbHJlYWR5IGFjdGl2ZS4iKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLiNvdmVybGF5cy5nZXQoZGlhbG9nKS5jYW5Gb3JjZUNsb3NlKSB7CiAgICAgICAgYXdhaXQgdGhpcy5jbG9zZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQW5vdGhlciBvdmVybGF5IGlzIGN1cnJlbnRseSBhY3RpdmUuIik7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuI2FjdGl2ZSA9IGRpYWxvZzsKICAgIGRpYWxvZy5zaG93TW9kYWwoKTsKICB9CiAgYXN5bmMgY2xvc2UoZGlhbG9nID0gdGhpcy4jYWN0aXZlKSB7CiAgICBpZiAoIXRoaXMuI292ZXJsYXlzLmhhcyhkaWFsb2cpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlIG92ZXJsYXkgZG9lcyBub3QgZXhpc3QuIik7CiAgICB9IGVsc2UgaWYgKCF0aGlzLiNhY3RpdmUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgb3ZlcmxheSBpcyBjdXJyZW50bHkgbm90IGFjdGl2ZS4iKTsKICAgIH0gZWxzZSBpZiAodGhpcy4jYWN0aXZlICE9PSBkaWFsb2cpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJBbm90aGVyIG92ZXJsYXkgaXMgY3VycmVudGx5IGFjdGl2ZS4iKTsKICAgIH0KICAgIGRpYWxvZy5jbG9zZSgpOwogICAgdGhpcy4jYWN0aXZlID0gbnVsbDsKICB9CiAgYXN5bmMgY2xvc2VJZkFjdGl2ZShkaWFsb2cpIHsKICAgIGlmICh0aGlzLiNhY3RpdmUgPT09IGRpYWxvZykgewogICAgICBhd2FpdCB0aGlzLmNsb3NlKGRpYWxvZyk7CiAgICB9CiAgfQp9Cgo7Ly8gLi93ZWIvcGFzc3dvcmRfcHJvbXB0LmpzCgpjbGFzcyBQYXNzd29yZFByb21wdCB7CiAgI2FjdGl2ZUNhcGFiaWxpdHkgPSBudWxsOwogICN1cGRhdGVDYWxsYmFjayA9IG51bGw7CiAgI3JlYXNvbiA9IG51bGw7CiAgY29uc3RydWN0b3Iob3B0aW9ucywgb3ZlcmxheU1hbmFnZXIsIGlzVmlld2VyRW1iZWRkZWQgPSBmYWxzZSkgewogICAgdGhpcy5kaWFsb2cgPSBvcHRpb25zLmRpYWxvZzsKICAgIHRoaXMubGFiZWwgPSBvcHRpb25zLmxhYmVsOwogICAgdGhpcy5pbnB1dCA9IG9wdGlvbnMuaW5wdXQ7CiAgICB0aGlzLnN1Ym1pdEJ1dHRvbiA9IG9wdGlvbnMuc3VibWl0QnV0dG9uOwogICAgdGhpcy5jYW5jZWxCdXR0b24gPSBvcHRpb25zLmNhbmNlbEJ1dHRvbjsKICAgIHRoaXMub3ZlcmxheU1hbmFnZXIgPSBvdmVybGF5TWFuYWdlcjsKICAgIHRoaXMuX2lzVmlld2VyRW1iZWRkZWQgPSBpc1ZpZXdlckVtYmVkZGVkOwogICAgdGhpcy5zdWJtaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLiN2ZXJpZnkuYmluZCh0aGlzKSk7CiAgICB0aGlzLmNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuY2xvc2UuYmluZCh0aGlzKSk7CiAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBlID0+IHsKICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHsKICAgICAgICB0aGlzLiN2ZXJpZnkoKTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLm92ZXJsYXlNYW5hZ2VyLnJlZ2lzdGVyKHRoaXMuZGlhbG9nLCB0cnVlKTsKICAgIHRoaXMuZGlhbG9nLmFkZEV2ZW50TGlzdGVuZXIoImNsb3NlIiwgdGhpcy4jY2FuY2VsLmJpbmQodGhpcykpOwogIH0KICBhc3luYyBvcGVuKCkgewogICAgYXdhaXQgdGhpcy4jYWN0aXZlQ2FwYWJpbGl0eT8ucHJvbWlzZTsKICAgIHRoaXMuI2FjdGl2ZUNhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMub3ZlcmxheU1hbmFnZXIub3Blbih0aGlzLmRpYWxvZyk7CiAgICB9IGNhdGNoIChleCkgewogICAgICB0aGlzLiNhY3RpdmVDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgdGhyb3cgZXg7CiAgICB9CiAgICBjb25zdCBwYXNzd29yZEluY29ycmVjdCA9IHRoaXMuI3JlYXNvbiA9PT0gUGFzc3dvcmRSZXNwb25zZXMuSU5DT1JSRUNUX1BBU1NXT1JEOwogICAgaWYgKCF0aGlzLl9pc1ZpZXdlckVtYmVkZGVkIHx8IHBhc3N3b3JkSW5jb3JyZWN0KSB7CiAgICAgIHRoaXMuaW5wdXQuZm9jdXMoKTsKICAgIH0KICAgIHRoaXMubGFiZWwuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCBwYXNzd29yZEluY29ycmVjdCA/ICJwZGZqcy1wYXNzd29yZC1pbnZhbGlkIiA6ICJwZGZqcy1wYXNzd29yZC1sYWJlbCIpOwogIH0KICBhc3luYyBjbG9zZSgpIHsKICAgIHRoaXMub3ZlcmxheU1hbmFnZXIuY2xvc2VJZkFjdGl2ZSh0aGlzLmRpYWxvZyk7CiAgfQogICN2ZXJpZnkoKSB7CiAgICBjb25zdCBwYXNzd29yZCA9IHRoaXMuaW5wdXQudmFsdWU7CiAgICBpZiAocGFzc3dvcmQ/Lmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy4jaW52b2tlQ2FsbGJhY2socGFzc3dvcmQpOwogICAgfQogIH0KICAjY2FuY2VsKCkgewogICAgdGhpcy4jaW52b2tlQ2FsbGJhY2sobmV3IEVycm9yKCJQYXNzd29yZFByb21wdCBjYW5jZWxsZWQuIikpOwogICAgdGhpcy4jYWN0aXZlQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgfQogICNpbnZva2VDYWxsYmFjayhwYXNzd29yZCkgewogICAgaWYgKCF0aGlzLiN1cGRhdGVDYWxsYmFjaykgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmNsb3NlKCk7CiAgICB0aGlzLmlucHV0LnZhbHVlID0gIiI7CiAgICB0aGlzLiN1cGRhdGVDYWxsYmFjayhwYXNzd29yZCk7CiAgICB0aGlzLiN1cGRhdGVDYWxsYmFjayA9IG51bGw7CiAgfQogIGFzeW5jIHNldFVwZGF0ZUNhbGxiYWNrKHVwZGF0ZUNhbGxiYWNrLCByZWFzb24pIHsKICAgIGlmICh0aGlzLiNhY3RpdmVDYXBhYmlsaXR5KSB7CiAgICAgIGF3YWl0IHRoaXMuI2FjdGl2ZUNhcGFiaWxpdHkucHJvbWlzZTsKICAgIH0KICAgIHRoaXMuI3VwZGF0ZUNhbGxiYWNrID0gdXBkYXRlQ2FsbGJhY2s7CiAgICB0aGlzLiNyZWFzb24gPSByZWFzb247CiAgfQp9Cgo7Ly8gLi93ZWIvYmFzZV90cmVlX3ZpZXdlci5qcwoKY29uc3QgVFJFRUlURU1fT0ZGU0VUX1RPUCA9IC0xMDA7CmNvbnN0IFRSRUVJVEVNX1NFTEVDVEVEX0NMQVNTID0gInNlbGVjdGVkIjsKY2xhc3MgQmFzZVRyZWVWaWV3ZXIgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHRoaXMuY29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXI7CiAgICB0aGlzLmV2ZW50QnVzID0gb3B0aW9ucy5ldmVudEJ1czsKICAgIHRoaXMuX2wxMG4gPSBvcHRpb25zLmwxMG47CiAgICB0aGlzLnJlc2V0KCk7CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy5fcGRmRG9jdW1lbnQgPSBudWxsOwogICAgdGhpcy5fbGFzdFRvZ2dsZUlzU2hvdyA9IHRydWU7CiAgICB0aGlzLl9jdXJyZW50VHJlZUl0ZW0gPSBudWxsOwogICAgdGhpcy5jb250YWluZXIudGV4dENvbnRlbnQgPSAiIjsKICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoInRyZWVXaXRoRGVlcE5lc3RpbmciKTsKICB9CiAgX2Rpc3BhdGNoRXZlbnQoY291bnQpIHsKICAgIHRocm93IG5ldyBFcnJvcigiTm90IGltcGxlbWVudGVkOiBfZGlzcGF0Y2hFdmVudCIpOwogIH0KICBfYmluZExpbmsoZWxlbWVudCwgcGFyYW1zKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBpbXBsZW1lbnRlZDogX2JpbmRMaW5rIik7CiAgfQogIF9ub3JtYWxpemVUZXh0Q29udGVudChzdHIpIHsKICAgIHJldHVybiByZW1vdmVOdWxsQ2hhcmFjdGVycyhzdHIsIHRydWUpIHx8ICJcdTIwMTMiOwogIH0KICBfYWRkVG9nZ2xlQnV0dG9uKGRpdiwgaGlkZGVuID0gZmFsc2UpIHsKICAgIGNvbnN0IHRvZ2dsZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIHRvZ2dsZXIuY2xhc3NOYW1lID0gInRyZWVJdGVtVG9nZ2xlciI7CiAgICBpZiAoaGlkZGVuKSB7CiAgICAgIHRvZ2dsZXIuY2xhc3NMaXN0LmFkZCgidHJlZUl0ZW1zSGlkZGVuIik7CiAgICB9CiAgICB0b2dnbGVyLm9uY2xpY2sgPSBldnQgPT4gewogICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIHRvZ2dsZXIuY2xhc3NMaXN0LnRvZ2dsZSgidHJlZUl0ZW1zSGlkZGVuIik7CiAgICAgIGlmIChldnQuc2hpZnRLZXkpIHsKICAgICAgICBjb25zdCBzaG91bGRTaG93QWxsID0gIXRvZ2dsZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCJ0cmVlSXRlbXNIaWRkZW4iKTsKICAgICAgICB0aGlzLl90b2dnbGVUcmVlSXRlbShkaXYsIHNob3VsZFNob3dBbGwpOwogICAgICB9CiAgICB9OwogICAgZGl2LnByZXBlbmQodG9nZ2xlcik7CiAgfQogIF90b2dnbGVUcmVlSXRlbShyb290LCBzaG93ID0gZmFsc2UpIHsKICAgIHRoaXMuX2wxMG4ucGF1c2UoKTsKICAgIHRoaXMuX2xhc3RUb2dnbGVJc1Nob3cgPSBzaG93OwogICAgZm9yIChjb25zdCB0b2dnbGVyIG9mIHJvb3QucXVlcnlTZWxlY3RvckFsbCgiLnRyZWVJdGVtVG9nZ2xlciIpKSB7CiAgICAgIHRvZ2dsZXIuY2xhc3NMaXN0LnRvZ2dsZSgidHJlZUl0ZW1zSGlkZGVuIiwgIXNob3cpOwogICAgfQogICAgdGhpcy5fbDEwbi5yZXN1bWUoKTsKICB9CiAgX3RvZ2dsZUFsbFRyZWVJdGVtcygpIHsKICAgIHRoaXMuX3RvZ2dsZVRyZWVJdGVtKHRoaXMuY29udGFpbmVyLCAhdGhpcy5fbGFzdFRvZ2dsZUlzU2hvdyk7CiAgfQogIF9maW5pc2hSZW5kZXJpbmcoZnJhZ21lbnQsIGNvdW50LCBoYXNBbnlOZXN0aW5nID0gZmFsc2UpIHsKICAgIGlmIChoYXNBbnlOZXN0aW5nKSB7CiAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoInRyZWVXaXRoRGVlcE5lc3RpbmciKTsKICAgICAgdGhpcy5fbGFzdFRvZ2dsZUlzU2hvdyA9ICFmcmFnbWVudC5xdWVyeVNlbGVjdG9yKCIudHJlZUl0ZW1zSGlkZGVuIik7CiAgICB9CiAgICB0aGlzLl9sMTBuLnBhdXNlKCk7CiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoZnJhZ21lbnQpOwogICAgdGhpcy5fbDEwbi5yZXN1bWUoKTsKICAgIHRoaXMuX2Rpc3BhdGNoRXZlbnQoY291bnQpOwogIH0KICByZW5kZXIocGFyYW1zKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBpbXBsZW1lbnRlZDogcmVuZGVyIik7CiAgfQogIF91cGRhdGVDdXJyZW50VHJlZUl0ZW0odHJlZUl0ZW0gPSBudWxsKSB7CiAgICBpZiAodGhpcy5fY3VycmVudFRyZWVJdGVtKSB7CiAgICAgIHRoaXMuX2N1cnJlbnRUcmVlSXRlbS5jbGFzc0xpc3QucmVtb3ZlKFRSRUVJVEVNX1NFTEVDVEVEX0NMQVNTKTsKICAgICAgdGhpcy5fY3VycmVudFRyZWVJdGVtID0gbnVsbDsKICAgIH0KICAgIGlmICh0cmVlSXRlbSkgewogICAgICB0cmVlSXRlbS5jbGFzc0xpc3QuYWRkKFRSRUVJVEVNX1NFTEVDVEVEX0NMQVNTKTsKICAgICAgdGhpcy5fY3VycmVudFRyZWVJdGVtID0gdHJlZUl0ZW07CiAgICB9CiAgfQogIF9zY3JvbGxUb0N1cnJlbnRUcmVlSXRlbSh0cmVlSXRlbSkgewogICAgaWYgKCF0cmVlSXRlbSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9sMTBuLnBhdXNlKCk7CiAgICBsZXQgY3VycmVudE5vZGUgPSB0cmVlSXRlbS5wYXJlbnROb2RlOwogICAgd2hpbGUgKGN1cnJlbnROb2RlICYmIGN1cnJlbnROb2RlICE9PSB0aGlzLmNvbnRhaW5lcikgewogICAgICBpZiAoY3VycmVudE5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCJ0cmVlSXRlbSIpKSB7CiAgICAgICAgY29uc3QgdG9nZ2xlciA9IGN1cnJlbnROb2RlLmZpcnN0RWxlbWVudENoaWxkOwogICAgICAgIHRvZ2dsZXI/LmNsYXNzTGlzdC5yZW1vdmUoInRyZWVJdGVtc0hpZGRlbiIpOwogICAgICB9CiAgICAgIGN1cnJlbnROb2RlID0gY3VycmVudE5vZGUucGFyZW50Tm9kZTsKICAgIH0KICAgIHRoaXMuX2wxMG4ucmVzdW1lKCk7CiAgICB0aGlzLl91cGRhdGVDdXJyZW50VHJlZUl0ZW0odHJlZUl0ZW0pOwogICAgdGhpcy5jb250YWluZXIuc2Nyb2xsVG8odHJlZUl0ZW0ub2Zmc2V0TGVmdCwgdHJlZUl0ZW0ub2Zmc2V0VG9wICsgVFJFRUlURU1fT0ZGU0VUX1RPUCk7CiAgfQp9Cgo7Ly8gLi93ZWIvcGRmX2F0dGFjaG1lbnRfdmlld2VyLmpzCgoKY2xhc3MgUERGQXR0YWNobWVudFZpZXdlciBleHRlbmRzIEJhc2VUcmVlVmlld2VyIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICBzdXBlcihvcHRpb25zKTsKICAgIHRoaXMuZG93bmxvYWRNYW5hZ2VyID0gb3B0aW9ucy5kb3dubG9hZE1hbmFnZXI7CiAgICB0aGlzLmV2ZW50QnVzLl9vbigiZmlsZWF0dGFjaG1lbnRhbm5vdGF0aW9uIiwgdGhpcy4jYXBwZW5kQXR0YWNobWVudC5iaW5kKHRoaXMpKTsKICB9CiAgcmVzZXQoa2VlcFJlbmRlcmVkQ2FwYWJpbGl0eSA9IGZhbHNlKSB7CiAgICBzdXBlci5yZXNldCgpOwogICAgdGhpcy5fYXR0YWNobWVudHMgPSBudWxsOwogICAgaWYgKCFrZWVwUmVuZGVyZWRDYXBhYmlsaXR5KSB7CiAgICAgIHRoaXMuX3JlbmRlcmVkQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgfQogICAgdGhpcy5fcGVuZGluZ0Rpc3BhdGNoRXZlbnQgPSBmYWxzZTsKICB9CiAgYXN5bmMgX2Rpc3BhdGNoRXZlbnQoYXR0YWNobWVudHNDb3VudCkgewogICAgdGhpcy5fcmVuZGVyZWRDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgIGlmIChhdHRhY2htZW50c0NvdW50ID09PSAwICYmICF0aGlzLl9wZW5kaW5nRGlzcGF0Y2hFdmVudCkgewogICAgICB0aGlzLl9wZW5kaW5nRGlzcGF0Y2hFdmVudCA9IHRydWU7CiAgICAgIGF3YWl0IHdhaXRPbkV2ZW50T3JUaW1lb3V0KHsKICAgICAgICB0YXJnZXQ6IHRoaXMuZXZlbnRCdXMsCiAgICAgICAgbmFtZTogImFubm90YXRpb25sYXllcnJlbmRlcmVkIiwKICAgICAgICBkZWxheTogMTAwMAogICAgICB9KTsKICAgICAgaWYgKCF0aGlzLl9wZW5kaW5nRGlzcGF0Y2hFdmVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgdGhpcy5fcGVuZGluZ0Rpc3BhdGNoRXZlbnQgPSBmYWxzZTsKICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goImF0dGFjaG1lbnRzbG9hZGVkIiwgewogICAgICBzb3VyY2U6IHRoaXMsCiAgICAgIGF0dGFjaG1lbnRzQ291bnQKICAgIH0pOwogIH0KICBfYmluZExpbmsoZWxlbWVudCwgewogICAgY29udGVudCwKICAgIGRlc2NyaXB0aW9uLAogICAgZmlsZW5hbWUKICB9KSB7CiAgICBpZiAoZGVzY3JpcHRpb24pIHsKICAgICAgZWxlbWVudC50aXRsZSA9IGRlc2NyaXB0aW9uOwogICAgfQogICAgZWxlbWVudC5vbmNsaWNrID0gKCkgPT4gewogICAgICB0aGlzLmRvd25sb2FkTWFuYWdlci5vcGVuT3JEb3dubG9hZERhdGEoY29udGVudCwgZmlsZW5hbWUpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwogIH0KICByZW5kZXIoewogICAgYXR0YWNobWVudHMsCiAgICBrZWVwUmVuZGVyZWRDYXBhYmlsaXR5ID0gZmFsc2UKICB9KSB7CiAgICBpZiAodGhpcy5fYXR0YWNobWVudHMpIHsKICAgICAgdGhpcy5yZXNldChrZWVwUmVuZGVyZWRDYXBhYmlsaXR5KTsKICAgIH0KICAgIHRoaXMuX2F0dGFjaG1lbnRzID0gYXR0YWNobWVudHMgfHwgbnVsbDsKICAgIGlmICghYXR0YWNobWVudHMpIHsKICAgICAgdGhpcy5fZGlzcGF0Y2hFdmVudCgwKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICBsZXQgYXR0YWNobWVudHNDb3VudCA9IDA7CiAgICBmb3IgKGNvbnN0IG5hbWUgaW4gYXR0YWNobWVudHMpIHsKICAgICAgY29uc3QgaXRlbSA9IGF0dGFjaG1lbnRzW25hbWVdOwogICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgZGl2LmNsYXNzTmFtZSA9ICJ0cmVlSXRlbSI7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgIHRoaXMuX2JpbmRMaW5rKGVsZW1lbnQsIGl0ZW0pOwogICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gdGhpcy5fbm9ybWFsaXplVGV4dENvbnRlbnQoaXRlbS5maWxlbmFtZSk7CiAgICAgIGRpdi5hcHBlbmQoZWxlbWVudCk7CiAgICAgIGZyYWdtZW50LmFwcGVuZChkaXYpOwogICAgICBhdHRhY2htZW50c0NvdW50Kys7CiAgICB9CiAgICB0aGlzLl9maW5pc2hSZW5kZXJpbmcoZnJhZ21lbnQsIGF0dGFjaG1lbnRzQ291bnQpOwogIH0KICAjYXBwZW5kQXR0YWNobWVudChpdGVtKSB7CiAgICBjb25zdCByZW5kZXJlZFByb21pc2UgPSB0aGlzLl9yZW5kZXJlZENhcGFiaWxpdHkucHJvbWlzZTsKICAgIHJlbmRlcmVkUHJvbWlzZS50aGVuKCgpID0+IHsKICAgICAgaWYgKHJlbmRlcmVkUHJvbWlzZSAhPT0gdGhpcy5fcmVuZGVyZWRDYXBhYmlsaXR5LnByb21pc2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgYXR0YWNobWVudHMgPSB0aGlzLl9hdHRhY2htZW50cyB8fCBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gYXR0YWNobWVudHMpIHsKICAgICAgICBpZiAoaXRlbS5maWxlbmFtZSA9PT0gbmFtZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgICBhdHRhY2htZW50c1tpdGVtLmZpbGVuYW1lXSA9IGl0ZW07CiAgICAgIHRoaXMucmVuZGVyKHsKICAgICAgICBhdHRhY2htZW50cywKICAgICAgICBrZWVwUmVuZGVyZWRDYXBhYmlsaXR5OiB0cnVlCiAgICAgIH0pOwogICAgfSk7CiAgfQp9Cgo7Ly8gLi93ZWIvZ3JhYl90b19wYW4uanMKCmNvbnN0IENTU19DTEFTU19HUkFCID0gImdyYWItdG8tcGFuLWdyYWIiOwpjbGFzcyBHcmFiVG9QYW4gewogICNhY3RpdmF0ZUFDID0gbnVsbDsKICAjbW91c2VEb3duQUMgPSBudWxsOwogICNzY3JvbGxBQyA9IG51bGw7CiAgY29uc3RydWN0b3IoewogICAgZWxlbWVudAogIH0pIHsKICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7CiAgICB0aGlzLmRvY3VtZW50ID0gZWxlbWVudC5vd25lckRvY3VtZW50OwogICAgY29uc3Qgb3ZlcmxheSA9IHRoaXMub3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgb3ZlcmxheS5jbGFzc05hbWUgPSAiZ3JhYi10by1wYW4tZ3JhYmJpbmciOwogIH0KICBhY3RpdmF0ZSgpIHsKICAgIGlmICghdGhpcy4jYWN0aXZhdGVBQykgewogICAgICB0aGlzLiNhY3RpdmF0ZUFDID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgdGhpcy4jb25Nb3VzZURvd24uYmluZCh0aGlzKSwgewogICAgICAgIGNhcHR1cmU6IHRydWUsCiAgICAgICAgc2lnbmFsOiB0aGlzLiNhY3RpdmF0ZUFDLnNpZ25hbAogICAgICB9KTsKICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoQ1NTX0NMQVNTX0dSQUIpOwogICAgfQogIH0KICBkZWFjdGl2YXRlKCkgewogICAgaWYgKHRoaXMuI2FjdGl2YXRlQUMpIHsKICAgICAgdGhpcy4jYWN0aXZhdGVBQy5hYm9ydCgpOwogICAgICB0aGlzLiNhY3RpdmF0ZUFDID0gbnVsbDsKICAgICAgdGhpcy4jZW5kUGFuKCk7CiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKENTU19DTEFTU19HUkFCKTsKICAgIH0KICB9CiAgdG9nZ2xlKCkgewogICAgaWYgKHRoaXMuI2FjdGl2YXRlQUMpIHsKICAgICAgdGhpcy5kZWFjdGl2YXRlKCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmFjdGl2YXRlKCk7CiAgICB9CiAgfQogIGlnbm9yZVRhcmdldChub2RlKSB7CiAgICByZXR1cm4gbm9kZS5tYXRjaGVzKCJhW2hyZWZdLCBhW2hyZWZdICosIGlucHV0LCB0ZXh0YXJlYSwgYnV0dG9uLCBidXR0b24gKiwgc2VsZWN0LCBvcHRpb24iKTsKICB9CiAgI29uTW91c2VEb3duKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQuYnV0dG9uICE9PSAwIHx8IHRoaXMuaWdub3JlVGFyZ2V0KGV2ZW50LnRhcmdldCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGV2ZW50Lm9yaWdpbmFsVGFyZ2V0KSB7CiAgICAgIHRyeSB7CiAgICAgICAgZXZlbnQub3JpZ2luYWxUYXJnZXQudGFnTmFtZTsKICAgICAgfSBjYXRjaCB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICB0aGlzLnNjcm9sbExlZnRTdGFydCA9IHRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0OwogICAgdGhpcy5zY3JvbGxUb3BTdGFydCA9IHRoaXMuZWxlbWVudC5zY3JvbGxUb3A7CiAgICB0aGlzLmNsaWVudFhTdGFydCA9IGV2ZW50LmNsaWVudFg7CiAgICB0aGlzLmNsaWVudFlTdGFydCA9IGV2ZW50LmNsaWVudFk7CiAgICB0aGlzLiNtb3VzZURvd25BQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGNvbnN0IGJvdW5kRW5kUGFuID0gdGhpcy4jZW5kUGFuLmJpbmQodGhpcyksCiAgICAgIG1vdXNlT3B0cyA9IHsKICAgICAgICBjYXB0dXJlOiB0cnVlLAogICAgICAgIHNpZ25hbDogdGhpcy4jbW91c2VEb3duQUMuc2lnbmFsCiAgICAgIH07CiAgICB0aGlzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIHRoaXMuI29uTW91c2VNb3ZlLmJpbmQodGhpcyksIG1vdXNlT3B0cyk7CiAgICB0aGlzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCBib3VuZEVuZFBhbiwgbW91c2VPcHRzKTsKICAgIHRoaXMuI3Njcm9sbEFDID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoInNjcm9sbCIsIGJvdW5kRW5kUGFuLCB7CiAgICAgIGNhcHR1cmU6IHRydWUsCiAgICAgIHNpZ25hbDogdGhpcy4jc2Nyb2xsQUMuc2lnbmFsCiAgICB9KTsKICAgIHN0b3BFdmVudChldmVudCk7CiAgICBjb25zdCBmb2N1c2VkRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7CiAgICBpZiAoZm9jdXNlZEVsZW1lbnQgJiYgIWZvY3VzZWRFbGVtZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHsKICAgICAgZm9jdXNlZEVsZW1lbnQuYmx1cigpOwogICAgfQogIH0KICAjb25Nb3VzZU1vdmUoZXZlbnQpIHsKICAgIHRoaXMuI3Njcm9sbEFDPy5hYm9ydCgpOwogICAgdGhpcy4jc2Nyb2xsQUMgPSBudWxsOwogICAgaWYgKCEoZXZlbnQuYnV0dG9ucyAmIDEpKSB7CiAgICAgIHRoaXMuI2VuZFBhbigpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB4RGlmZiA9IGV2ZW50LmNsaWVudFggLSB0aGlzLmNsaWVudFhTdGFydDsKICAgIGNvbnN0IHlEaWZmID0gZXZlbnQuY2xpZW50WSAtIHRoaXMuY2xpZW50WVN0YXJ0OwogICAgdGhpcy5lbGVtZW50LnNjcm9sbFRvKHsKICAgICAgdG9wOiB0aGlzLnNjcm9sbFRvcFN0YXJ0IC0geURpZmYsCiAgICAgIGxlZnQ6IHRoaXMuc2Nyb2xsTGVmdFN0YXJ0IC0geERpZmYsCiAgICAgIGJlaGF2aW9yOiAiaW5zdGFudCIKICAgIH0pOwogICAgaWYgKCF0aGlzLm92ZXJsYXkucGFyZW50Tm9kZSkgewogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZCh0aGlzLm92ZXJsYXkpOwogICAgfQogIH0KICAjZW5kUGFuKCkgewogICAgdGhpcy4jbW91c2VEb3duQUM/LmFib3J0KCk7CiAgICB0aGlzLiNtb3VzZURvd25BQyA9IG51bGw7CiAgICB0aGlzLiNzY3JvbGxBQz8uYWJvcnQoKTsKICAgIHRoaXMuI3Njcm9sbEFDID0gbnVsbDsKICAgIHRoaXMub3ZlcmxheS5yZW1vdmUoKTsKICB9Cn0KCjsvLyAuL3dlYi9wZGZfY3Vyc29yX3Rvb2xzLmpzCgoKCmNsYXNzIFBERkN1cnNvclRvb2xzIHsKICAjYWN0aXZlID0gQ3Vyc29yVG9vbC5TRUxFQ1Q7CiAgI3ByZXZBY3RpdmUgPSBudWxsOwogIGNvbnN0cnVjdG9yKHsKICAgIGNvbnRhaW5lciwKICAgIGV2ZW50QnVzLAogICAgY3Vyc29yVG9vbE9uTG9hZCA9IEN1cnNvclRvb2wuU0VMRUNUCiAgfSkgewogICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7CiAgICB0aGlzLmV2ZW50QnVzID0gZXZlbnRCdXM7CiAgICB0aGlzLiNhZGRFdmVudExpc3RlbmVycygpOwogICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB7CiAgICAgIHRoaXMuc3dpdGNoVG9vbChjdXJzb3JUb29sT25Mb2FkKTsKICAgIH0pOwogIH0KICBnZXQgYWN0aXZlVG9vbCgpIHsKICAgIHJldHVybiB0aGlzLiNhY3RpdmU7CiAgfQogIHN3aXRjaFRvb2wodG9vbCkgewogICAgaWYgKHRoaXMuI3ByZXZBY3RpdmUgIT09IG51bGwpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jc3dpdGNoVG9vbCh0b29sKTsKICB9CiAgI3N3aXRjaFRvb2wodG9vbCwgZGlzYWJsZWQgPSBmYWxzZSkgewogICAgaWYgKHRvb2wgPT09IHRoaXMuI2FjdGl2ZSkgewogICAgICBpZiAodGhpcy4jcHJldkFjdGl2ZSAhPT0gbnVsbCkgewogICAgICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goImN1cnNvcnRvb2xjaGFuZ2VkIiwgewogICAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgICAgdG9vbCwKICAgICAgICAgIGRpc2FibGVkCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZGlzYWJsZUFjdGl2ZVRvb2wgPSAoKSA9PiB7CiAgICAgIHN3aXRjaCAodGhpcy4jYWN0aXZlKSB7CiAgICAgICAgY2FzZSBDdXJzb3JUb29sLlNFTEVDVDoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQ3Vyc29yVG9vbC5IQU5EOgogICAgICAgICAgdGhpcy5faGFuZFRvb2wuZGVhY3RpdmF0ZSgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBDdXJzb3JUb29sLlpPT006CiAgICAgIH0KICAgIH07CiAgICBzd2l0Y2ggKHRvb2wpIHsKICAgICAgY2FzZSBDdXJzb3JUb29sLlNFTEVDVDoKICAgICAgICBkaXNhYmxlQWN0aXZlVG9vbCgpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIEN1cnNvclRvb2wuSEFORDoKICAgICAgICBkaXNhYmxlQWN0aXZlVG9vbCgpOwogICAgICAgIHRoaXMuX2hhbmRUb29sLmFjdGl2YXRlKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgQ3Vyc29yVG9vbC5aT09NOgogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnNvbGUuZXJyb3IoYHN3aXRjaFRvb2w6ICIke3Rvb2x9IiBpcyBhbiB1bnN1cHBvcnRlZCB2YWx1ZS5gKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNhY3RpdmUgPSB0b29sOwogICAgdGhpcy5ldmVudEJ1cy5kaXNwYXRjaCgiY3Vyc29ydG9vbGNoYW5nZWQiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgdG9vbCwKICAgICAgZGlzYWJsZWQKICAgIH0pOwogIH0KICAjYWRkRXZlbnRMaXN0ZW5lcnMoKSB7CiAgICB0aGlzLmV2ZW50QnVzLl9vbigic3dpdGNoY3Vyc29ydG9vbCIsIGV2dCA9PiB7CiAgICAgIGlmICghZXZ0LnJlc2V0KSB7CiAgICAgICAgdGhpcy5zd2l0Y2hUb29sKGV2dC50b29sKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLiNwcmV2QWN0aXZlICE9PSBudWxsKSB7CiAgICAgICAgYW5ub3RhdGlvbkVkaXRvck1vZGUgPSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5OT05FOwogICAgICAgIHByZXNlbnRhdGlvbk1vZGVTdGF0ZSA9IFByZXNlbnRhdGlvbk1vZGVTdGF0ZS5OT1JNQUw7CiAgICAgICAgZW5hYmxlQWN0aXZlKCk7CiAgICAgIH0KICAgIH0pOwogICAgbGV0IGFubm90YXRpb25FZGl0b3JNb2RlID0gQW5ub3RhdGlvbkVkaXRvclR5cGUuTk9ORSwKICAgICAgcHJlc2VudGF0aW9uTW9kZVN0YXRlID0gUHJlc2VudGF0aW9uTW9kZVN0YXRlLk5PUk1BTDsKICAgIGNvbnN0IGRpc2FibGVBY3RpdmUgPSAoKSA9PiB7CiAgICAgIHRoaXMuI3ByZXZBY3RpdmUgPz89IHRoaXMuI2FjdGl2ZTsKICAgICAgdGhpcy4jc3dpdGNoVG9vbChDdXJzb3JUb29sLlNFTEVDVCwgdHJ1ZSk7CiAgICB9OwogICAgY29uc3QgZW5hYmxlQWN0aXZlID0gKCkgPT4gewogICAgICBpZiAodGhpcy4jcHJldkFjdGl2ZSAhPT0gbnVsbCAmJiBhbm5vdGF0aW9uRWRpdG9yTW9kZSA9PT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuTk9ORSAmJiBwcmVzZW50YXRpb25Nb2RlU3RhdGUgPT09IFByZXNlbnRhdGlvbk1vZGVTdGF0ZS5OT1JNQUwpIHsKICAgICAgICB0aGlzLiNzd2l0Y2hUb29sKHRoaXMuI3ByZXZBY3RpdmUpOwogICAgICAgIHRoaXMuI3ByZXZBY3RpdmUgPSBudWxsOwogICAgICB9CiAgICB9OwogICAgdGhpcy5ldmVudEJ1cy5fb24oImFubm90YXRpb25lZGl0b3Jtb2RlY2hhbmdlZCIsICh7CiAgICAgIG1vZGUKICAgIH0pID0+IHsKICAgICAgYW5ub3RhdGlvbkVkaXRvck1vZGUgPSBtb2RlOwogICAgICBpZiAobW9kZSA9PT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuTk9ORSkgewogICAgICAgIGVuYWJsZUFjdGl2ZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIGRpc2FibGVBY3RpdmUoKTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLmV2ZW50QnVzLl9vbigicHJlc2VudGF0aW9ubW9kZWNoYW5nZWQiLCAoewogICAgICBzdGF0ZQogICAgfSkgPT4gewogICAgICBwcmVzZW50YXRpb25Nb2RlU3RhdGUgPSBzdGF0ZTsKICAgICAgaWYgKHN0YXRlID09PSBQcmVzZW50YXRpb25Nb2RlU3RhdGUuTk9STUFMKSB7CiAgICAgICAgZW5hYmxlQWN0aXZlKCk7CiAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09IFByZXNlbnRhdGlvbk1vZGVTdGF0ZS5GVUxMU0NSRUVOKSB7CiAgICAgICAgZGlzYWJsZUFjdGl2ZSgpOwogICAgICB9CiAgICB9KTsKICB9CiAgZ2V0IF9oYW5kVG9vbCgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9oYW5kVG9vbCIsIG5ldyBHcmFiVG9QYW4oewogICAgICBlbGVtZW50OiB0aGlzLmNvbnRhaW5lcgogICAgfSkpOwogIH0KfQoKOy8vIC4vd2ViL3BkZl9kb2N1bWVudF9wcm9wZXJ0aWVzLmpzCgoKY29uc3QgTk9OX01FVFJJQ19MT0NBTEVTID0gWyJlbi11cyIsICJlbi1sciIsICJteSJdOwpjb25zdCBVU19QQUdFX05BTUVTID0gewogICI4LjV4MTEiOiAicGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wYWdlLXNpemUtbmFtZS1sZXR0ZXIiLAogICI4LjV4MTQiOiAicGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wYWdlLXNpemUtbmFtZS1sZWdhbCIKfTsKY29uc3QgTUVUUklDX1BBR0VfTkFNRVMgPSB7CiAgIjI5N3g0MjAiOiAicGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wYWdlLXNpemUtbmFtZS1hLXRocmVlIiwKICAiMjEweDI5NyI6ICJwZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLXBhZ2Utc2l6ZS1uYW1lLWEtZm91ciIKfTsKZnVuY3Rpb24gZ2V0UGFnZU5hbWUoc2l6ZSwgaXNQb3J0cmFpdCwgcGFnZU5hbWVzKSB7CiAgY29uc3Qgd2lkdGggPSBpc1BvcnRyYWl0ID8gc2l6ZS53aWR0aCA6IHNpemUuaGVpZ2h0OwogIGNvbnN0IGhlaWdodCA9IGlzUG9ydHJhaXQgPyBzaXplLmhlaWdodCA6IHNpemUud2lkdGg7CiAgcmV0dXJuIHBhZ2VOYW1lc1tgJHt3aWR0aH14JHtoZWlnaHR9YF07Cn0KY2xhc3MgUERGRG9jdW1lbnRQcm9wZXJ0aWVzIHsKICAjZmllbGREYXRhID0gbnVsbDsKICBjb25zdHJ1Y3Rvcih7CiAgICBkaWFsb2csCiAgICBmaWVsZHMsCiAgICBjbG9zZUJ1dHRvbgogIH0sIG92ZXJsYXlNYW5hZ2VyLCBldmVudEJ1cywgbDEwbiwgZmlsZU5hbWVMb29rdXAsIHRpdGxlTG9va3VwKSB7CiAgICB0aGlzLmRpYWxvZyA9IGRpYWxvZzsKICAgIHRoaXMuZmllbGRzID0gZmllbGRzOwogICAgdGhpcy5vdmVybGF5TWFuYWdlciA9IG92ZXJsYXlNYW5hZ2VyOwogICAgdGhpcy5sMTBuID0gbDEwbjsKICAgIHRoaXMuX2ZpbGVOYW1lTG9va3VwID0gZmlsZU5hbWVMb29rdXA7CiAgICB0aGlzLl90aXRsZUxvb2t1cCA9IHRpdGxlTG9va3VwOwogICAgdGhpcy4jcmVzZXQoKTsKICAgIGNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy5jbG9zZS5iaW5kKHRoaXMpKTsKICAgIHRoaXMub3ZlcmxheU1hbmFnZXIucmVnaXN0ZXIodGhpcy5kaWFsb2cpOwogICAgZXZlbnRCdXMuX29uKCJwYWdlY2hhbmdpbmciLCBldnQgPT4gewogICAgICB0aGlzLl9jdXJyZW50UGFnZU51bWJlciA9IGV2dC5wYWdlTnVtYmVyOwogICAgfSk7CiAgICBldmVudEJ1cy5fb24oInJvdGF0aW9uY2hhbmdpbmciLCBldnQgPT4gewogICAgICB0aGlzLl9wYWdlc1JvdGF0aW9uID0gZXZ0LnBhZ2VzUm90YXRpb247CiAgICB9KTsKICB9CiAgYXN5bmMgb3BlbigpIHsKICAgIGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLm92ZXJsYXlNYW5hZ2VyLm9wZW4odGhpcy5kaWFsb2cpLCB0aGlzLl9kYXRhQXZhaWxhYmxlQ2FwYWJpbGl0eS5wcm9taXNlXSk7CiAgICBjb25zdCBjdXJyZW50UGFnZU51bWJlciA9IHRoaXMuX2N1cnJlbnRQYWdlTnVtYmVyOwogICAgY29uc3QgcGFnZXNSb3RhdGlvbiA9IHRoaXMuX3BhZ2VzUm90YXRpb247CiAgICBpZiAodGhpcy4jZmllbGREYXRhICYmIGN1cnJlbnRQYWdlTnVtYmVyID09PSB0aGlzLiNmaWVsZERhdGEuX2N1cnJlbnRQYWdlTnVtYmVyICYmIHBhZ2VzUm90YXRpb24gPT09IHRoaXMuI2ZpZWxkRGF0YS5fcGFnZXNSb3RhdGlvbikgewogICAgICB0aGlzLiN1cGRhdGVVSSgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBbewogICAgICBpbmZvLAogICAgICBtZXRhZGF0YSwKICAgICAgY29udGVudExlbmd0aAogICAgfSwgcGRmUGFnZV0gPSBhd2FpdCBQcm9taXNlLmFsbChbdGhpcy5wZGZEb2N1bWVudC5nZXRNZXRhZGF0YSgpLCB0aGlzLnBkZkRvY3VtZW50LmdldFBhZ2UoY3VycmVudFBhZ2VOdW1iZXIpXSk7CiAgICBjb25zdCBbZmlsZU5hbWUsIGZpbGVTaXplLCB0aXRsZSwgY3JlYXRpb25EYXRlLCBtb2RpZmljYXRpb25EYXRlLCBwYWdlU2l6ZSwgaXNMaW5lYXJpemVkXSA9IGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLl9maWxlTmFtZUxvb2t1cCgpLCB0aGlzLiNwYXJzZUZpbGVTaXplKGNvbnRlbnRMZW5ndGgpLCB0aGlzLl90aXRsZUxvb2t1cCgpLCB0aGlzLiNwYXJzZURhdGUobWV0YWRhdGE/LmdldCgieG1wOmNyZWF0ZWRhdGUiKSwgaW5mby5DcmVhdGlvbkRhdGUpLCB0aGlzLiNwYXJzZURhdGUobWV0YWRhdGE/LmdldCgieG1wOm1vZGlmeWRhdGUiKSwgaW5mby5Nb2REYXRlKSwgdGhpcy4jcGFyc2VQYWdlU2l6ZShnZXRQYWdlU2l6ZUluY2hlcyhwZGZQYWdlKSwgcGFnZXNSb3RhdGlvbiksIHRoaXMuI3BhcnNlTGluZWFyaXphdGlvbihpbmZvLklzTGluZWFyaXplZCldKTsKICAgIHRoaXMuI2ZpZWxkRGF0YSA9IE9iamVjdC5mcmVlemUoewogICAgICBmaWxlTmFtZSwKICAgICAgZmlsZVNpemUsCiAgICAgIHRpdGxlLAogICAgICBhdXRob3I6IG1ldGFkYXRhPy5nZXQoImRjOmNyZWF0b3IiKT8uam9pbigiXG4iKSB8fCBpbmZvLkF1dGhvciwKICAgICAgc3ViamVjdDogbWV0YWRhdGE/LmdldCgiZGM6c3ViamVjdCIpPy5qb2luKCJcbiIpIHx8IGluZm8uU3ViamVjdCwKICAgICAga2V5d29yZHM6IG1ldGFkYXRhPy5nZXQoInBkZjprZXl3b3JkcyIpIHx8IGluZm8uS2V5d29yZHMsCiAgICAgIGNyZWF0aW9uRGF0ZSwKICAgICAgbW9kaWZpY2F0aW9uRGF0ZSwKICAgICAgY3JlYXRvcjogbWV0YWRhdGE/LmdldCgieG1wOmNyZWF0b3J0b29sIikgfHwgaW5mby5DcmVhdG9yLAogICAgICBwcm9kdWNlcjogbWV0YWRhdGE/LmdldCgicGRmOnByb2R1Y2VyIikgfHwgaW5mby5Qcm9kdWNlciwKICAgICAgdmVyc2lvbjogaW5mby5QREZGb3JtYXRWZXJzaW9uLAogICAgICBwYWdlQ291bnQ6IHRoaXMucGRmRG9jdW1lbnQubnVtUGFnZXMsCiAgICAgIHBhZ2VTaXplLAogICAgICBsaW5lYXJpemVkOiBpc0xpbmVhcml6ZWQsCiAgICAgIF9jdXJyZW50UGFnZU51bWJlcjogY3VycmVudFBhZ2VOdW1iZXIsCiAgICAgIF9wYWdlc1JvdGF0aW9uOiBwYWdlc1JvdGF0aW9uCiAgICB9KTsKICAgIHRoaXMuI3VwZGF0ZVVJKCk7CiAgICBjb25zdCB7CiAgICAgIGxlbmd0aAogICAgfSA9IGF3YWl0IHRoaXMucGRmRG9jdW1lbnQuZ2V0RG93bmxvYWRJbmZvKCk7CiAgICBpZiAoY29udGVudExlbmd0aCA9PT0gbGVuZ3RoKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGRhdGEgPSBPYmplY3QuYXNzaWduKE9iamVjdC5jcmVhdGUobnVsbCksIHRoaXMuI2ZpZWxkRGF0YSk7CiAgICBkYXRhLmZpbGVTaXplID0gYXdhaXQgdGhpcy4jcGFyc2VGaWxlU2l6ZShsZW5ndGgpOwogICAgdGhpcy4jZmllbGREYXRhID0gT2JqZWN0LmZyZWV6ZShkYXRhKTsKICAgIHRoaXMuI3VwZGF0ZVVJKCk7CiAgfQogIGFzeW5jIGNsb3NlKCkgewogICAgdGhpcy5vdmVybGF5TWFuYWdlci5jbG9zZSh0aGlzLmRpYWxvZyk7CiAgfQogIHNldERvY3VtZW50KHBkZkRvY3VtZW50KSB7CiAgICBpZiAodGhpcy5wZGZEb2N1bWVudCkgewogICAgICB0aGlzLiNyZXNldCgpOwogICAgICB0aGlzLiN1cGRhdGVVSSgpOwogICAgfQogICAgaWYgKCFwZGZEb2N1bWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnBkZkRvY3VtZW50ID0gcGRmRG9jdW1lbnQ7CiAgICB0aGlzLl9kYXRhQXZhaWxhYmxlQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgfQogICNyZXNldCgpIHsKICAgIHRoaXMucGRmRG9jdW1lbnQgPSBudWxsOwogICAgdGhpcy4jZmllbGREYXRhID0gbnVsbDsKICAgIHRoaXMuX2RhdGFBdmFpbGFibGVDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICB0aGlzLl9jdXJyZW50UGFnZU51bWJlciA9IDE7CiAgICB0aGlzLl9wYWdlc1JvdGF0aW9uID0gMDsKICB9CiAgI3VwZGF0ZVVJKCkgewogICAgaWYgKHRoaXMuI2ZpZWxkRGF0YSAmJiB0aGlzLm92ZXJsYXlNYW5hZ2VyLmFjdGl2ZSAhPT0gdGhpcy5kaWFsb2cpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBpZCBpbiB0aGlzLmZpZWxkcykgewogICAgICBjb25zdCBjb250ZW50ID0gdGhpcy4jZmllbGREYXRhPy5baWRdOwogICAgICB0aGlzLmZpZWxkc1tpZF0udGV4dENvbnRlbnQgPSBjb250ZW50IHx8IGNvbnRlbnQgPT09IDAgPyBjb250ZW50IDogIi0iOwogICAgfQogIH0KICBhc3luYyAjcGFyc2VGaWxlU2l6ZShiID0gMCkgewogICAgY29uc3Qga2IgPSBiIC8gMTAyNCwKICAgICAgbWIgPSBrYiAvIDEwMjQ7CiAgICByZXR1cm4ga2IgPyB0aGlzLmwxMG4uZ2V0KG1iID49IDEgPyAicGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1zaXplLW1iIiA6ICJwZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLXNpemUta2IiLCB7CiAgICAgIG1iLAogICAgICBrYiwKICAgICAgYgogICAgfSkgOiB1bmRlZmluZWQ7CiAgfQogIGFzeW5jICNwYXJzZVBhZ2VTaXplKHBhZ2VTaXplSW5jaGVzLCBwYWdlc1JvdGF0aW9uKSB7CiAgICBpZiAoIXBhZ2VTaXplSW5jaGVzKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBpZiAocGFnZXNSb3RhdGlvbiAlIDE4MCAhPT0gMCkgewogICAgICBwYWdlU2l6ZUluY2hlcyA9IHsKICAgICAgICB3aWR0aDogcGFnZVNpemVJbmNoZXMuaGVpZ2h0LAogICAgICAgIGhlaWdodDogcGFnZVNpemVJbmNoZXMud2lkdGgKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IGlzUG9ydHJhaXQgPSBpc1BvcnRyYWl0T3JpZW50YXRpb24ocGFnZVNpemVJbmNoZXMpLAogICAgICBub25NZXRyaWMgPSBOT05fTUVUUklDX0xPQ0FMRVMuaW5jbHVkZXModGhpcy5sMTBuLmdldExhbmd1YWdlKCkpOwogICAgbGV0IHNpemVJbmNoZXMgPSB7CiAgICAgIHdpZHRoOiBNYXRoLnJvdW5kKHBhZ2VTaXplSW5jaGVzLndpZHRoICogMTAwKSAvIDEwMCwKICAgICAgaGVpZ2h0OiBNYXRoLnJvdW5kKHBhZ2VTaXplSW5jaGVzLmhlaWdodCAqIDEwMCkgLyAxMDAKICAgIH07CiAgICBsZXQgc2l6ZU1pbGxpbWV0ZXJzID0gewogICAgICB3aWR0aDogTWF0aC5yb3VuZChwYWdlU2l6ZUluY2hlcy53aWR0aCAqIDI1LjQgKiAxMCkgLyAxMCwKICAgICAgaGVpZ2h0OiBNYXRoLnJvdW5kKHBhZ2VTaXplSW5jaGVzLmhlaWdodCAqIDI1LjQgKiAxMCkgLyAxMAogICAgfTsKICAgIGxldCBuYW1lSWQgPSBnZXRQYWdlTmFtZShzaXplSW5jaGVzLCBpc1BvcnRyYWl0LCBVU19QQUdFX05BTUVTKSB8fCBnZXRQYWdlTmFtZShzaXplTWlsbGltZXRlcnMsIGlzUG9ydHJhaXQsIE1FVFJJQ19QQUdFX05BTUVTKTsKICAgIGlmICghbmFtZUlkICYmICEoTnVtYmVyLmlzSW50ZWdlcihzaXplTWlsbGltZXRlcnMud2lkdGgpICYmIE51bWJlci5pc0ludGVnZXIoc2l6ZU1pbGxpbWV0ZXJzLmhlaWdodCkpKSB7CiAgICAgIGNvbnN0IGV4YWN0TWlsbGltZXRlcnMgPSB7CiAgICAgICAgd2lkdGg6IHBhZ2VTaXplSW5jaGVzLndpZHRoICogMjUuNCwKICAgICAgICBoZWlnaHQ6IHBhZ2VTaXplSW5jaGVzLmhlaWdodCAqIDI1LjQKICAgICAgfTsKICAgICAgY29uc3QgaW50TWlsbGltZXRlcnMgPSB7CiAgICAgICAgd2lkdGg6IE1hdGgucm91bmQoc2l6ZU1pbGxpbWV0ZXJzLndpZHRoKSwKICAgICAgICBoZWlnaHQ6IE1hdGgucm91bmQoc2l6ZU1pbGxpbWV0ZXJzLmhlaWdodCkKICAgICAgfTsKICAgICAgaWYgKE1hdGguYWJzKGV4YWN0TWlsbGltZXRlcnMud2lkdGggLSBpbnRNaWxsaW1ldGVycy53aWR0aCkgPCAwLjEgJiYgTWF0aC5hYnMoZXhhY3RNaWxsaW1ldGVycy5oZWlnaHQgLSBpbnRNaWxsaW1ldGVycy5oZWlnaHQpIDwgMC4xKSB7CiAgICAgICAgbmFtZUlkID0gZ2V0UGFnZU5hbWUoaW50TWlsbGltZXRlcnMsIGlzUG9ydHJhaXQsIE1FVFJJQ19QQUdFX05BTUVTKTsKICAgICAgICBpZiAobmFtZUlkKSB7CiAgICAgICAgICBzaXplSW5jaGVzID0gewogICAgICAgICAgICB3aWR0aDogTWF0aC5yb3VuZChpbnRNaWxsaW1ldGVycy53aWR0aCAvIDI1LjQgKiAxMDApIC8gMTAwLAogICAgICAgICAgICBoZWlnaHQ6IE1hdGgucm91bmQoaW50TWlsbGltZXRlcnMuaGVpZ2h0IC8gMjUuNCAqIDEwMCkgLyAxMDAKICAgICAgICAgIH07CiAgICAgICAgICBzaXplTWlsbGltZXRlcnMgPSBpbnRNaWxsaW1ldGVyczsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IFt7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0sIHVuaXQsIG5hbWUsIG9yaWVudGF0aW9uXSA9IGF3YWl0IFByb21pc2UuYWxsKFtub25NZXRyaWMgPyBzaXplSW5jaGVzIDogc2l6ZU1pbGxpbWV0ZXJzLCB0aGlzLmwxMG4uZ2V0KG5vbk1ldHJpYyA/ICJwZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLXBhZ2Utc2l6ZS11bml0LWluY2hlcyIgOiAicGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wYWdlLXNpemUtdW5pdC1taWxsaW1ldGVycyIpLCBuYW1lSWQgJiYgdGhpcy5sMTBuLmdldChuYW1lSWQpLCB0aGlzLmwxMG4uZ2V0KGlzUG9ydHJhaXQgPyAicGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wYWdlLXNpemUtb3JpZW50YXRpb24tcG9ydHJhaXQiIDogInBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtcGFnZS1zaXplLW9yaWVudGF0aW9uLWxhbmRzY2FwZSIpXSk7CiAgICByZXR1cm4gdGhpcy5sMTBuLmdldChuYW1lID8gInBkZmpzLWRvY3VtZW50LXByb3BlcnRpZXMtcGFnZS1zaXplLWRpbWVuc2lvbi1uYW1lLXN0cmluZyIgOiAicGRmanMtZG9jdW1lbnQtcHJvcGVydGllcy1wYWdlLXNpemUtZGltZW5zaW9uLXN0cmluZyIsIHsKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodCwKICAgICAgdW5pdCwKICAgICAgbmFtZSwKICAgICAgb3JpZW50YXRpb24KICAgIH0pOwogIH0KICBhc3luYyAjcGFyc2VEYXRlKG1ldGFkYXRhRGF0ZSwgaW5mb0RhdGUpIHsKICAgIGNvbnN0IGRhdGVPYmogPSBEYXRlLnBhcnNlKG1ldGFkYXRhRGF0ZSkgfHwgUERGRGF0ZVN0cmluZy50b0RhdGVPYmplY3QoaW5mb0RhdGUpOwogICAgcmV0dXJuIGRhdGVPYmogPyB0aGlzLmwxMG4uZ2V0KCJwZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLWRhdGUtdGltZS1zdHJpbmciLCB7CiAgICAgIGRhdGVPYmo6IGRhdGVPYmoudmFsdWVPZigpCiAgICB9KSA6IHVuZGVmaW5lZDsKICB9CiAgI3BhcnNlTGluZWFyaXphdGlvbihpc0xpbmVhcml6ZWQpIHsKICAgIHJldHVybiB0aGlzLmwxMG4uZ2V0KGlzTGluZWFyaXplZCA/ICJwZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLWxpbmVhcml6ZWQteWVzIiA6ICJwZGZqcy1kb2N1bWVudC1wcm9wZXJ0aWVzLWxpbmVhcml6ZWQtbm8iKTsKICB9Cn0KCjsvLyAuL3dlYi9wZGZfZmluZF91dGlscy5qcwpjb25zdCBDaGFyYWN0ZXJUeXBlID0gewogIFNQQUNFOiAwLAogIEFMUEhBX0xFVFRFUjogMSwKICBQVU5DVDogMiwKICBIQU5fTEVUVEVSOiAzLAogIEtBVEFLQU5BX0xFVFRFUjogNCwKICBISVJBR0FOQV9MRVRURVI6IDUsCiAgSEFMRldJRFRIX0tBVEFLQU5BX0xFVFRFUjogNiwKICBUSEFJX0xFVFRFUjogNwp9OwpmdW5jdGlvbiBpc0FscGhhYmV0aWNhbFNjcmlwdChjaGFyQ29kZSkgewogIHJldHVybiBjaGFyQ29kZSA8IDB4MmU4MDsKfQpmdW5jdGlvbiBpc0FzY2lpKGNoYXJDb2RlKSB7CiAgcmV0dXJuIChjaGFyQ29kZSAmIDB4ZmY4MCkgPT09IDA7Cn0KZnVuY3Rpb24gaXNBc2NpaUFscGhhKGNoYXJDb2RlKSB7CiAgcmV0dXJuIGNoYXJDb2RlID49IDB4NjEgJiYgY2hhckNvZGUgPD0gMHg3YSB8fCBjaGFyQ29kZSA+PSAweDQxICYmIGNoYXJDb2RlIDw9IDB4NWE7Cn0KZnVuY3Rpb24gaXNBc2NpaURpZ2l0KGNoYXJDb2RlKSB7CiAgcmV0dXJuIGNoYXJDb2RlID49IDB4MzAgJiYgY2hhckNvZGUgPD0gMHgzOTsKfQpmdW5jdGlvbiBpc0FzY2lpU3BhY2UoY2hhckNvZGUpIHsKICByZXR1cm4gY2hhckNvZGUgPT09IDB4MjAgfHwgY2hhckNvZGUgPT09IDB4MDkgfHwgY2hhckNvZGUgPT09IDB4MGQgfHwgY2hhckNvZGUgPT09IDB4MGE7Cn0KZnVuY3Rpb24gaXNIYW4oY2hhckNvZGUpIHsKICByZXR1cm4gY2hhckNvZGUgPj0gMHgzNDAwICYmIGNoYXJDb2RlIDw9IDB4OWZmZiB8fCBjaGFyQ29kZSA+PSAweGY5MDAgJiYgY2hhckNvZGUgPD0gMHhmYWZmOwp9CmZ1bmN0aW9uIGlzS2F0YWthbmEoY2hhckNvZGUpIHsKICByZXR1cm4gY2hhckNvZGUgPj0gMHgzMGEwICYmIGNoYXJDb2RlIDw9IDB4MzBmZjsKfQpmdW5jdGlvbiBpc0hpcmFnYW5hKGNoYXJDb2RlKSB7CiAgcmV0dXJuIGNoYXJDb2RlID49IDB4MzA0MCAmJiBjaGFyQ29kZSA8PSAweDMwOWY7Cn0KZnVuY3Rpb24gaXNIYWxmd2lkdGhLYXRha2FuYShjaGFyQ29kZSkgewogIHJldHVybiBjaGFyQ29kZSA+PSAweGZmNjAgJiYgY2hhckNvZGUgPD0gMHhmZjlmOwp9CmZ1bmN0aW9uIGlzVGhhaShjaGFyQ29kZSkgewogIHJldHVybiAoY2hhckNvZGUgJiAweGZmODApID09PSAweDBlMDA7Cn0KZnVuY3Rpb24gZ2V0Q2hhcmFjdGVyVHlwZShjaGFyQ29kZSkgewogIGlmIChpc0FscGhhYmV0aWNhbFNjcmlwdChjaGFyQ29kZSkpIHsKICAgIGlmIChpc0FzY2lpKGNoYXJDb2RlKSkgewogICAgICBpZiAoaXNBc2NpaVNwYWNlKGNoYXJDb2RlKSkgewogICAgICAgIHJldHVybiBDaGFyYWN0ZXJUeXBlLlNQQUNFOwogICAgICB9IGVsc2UgaWYgKGlzQXNjaWlBbHBoYShjaGFyQ29kZSkgfHwgaXNBc2NpaURpZ2l0KGNoYXJDb2RlKSB8fCBjaGFyQ29kZSA9PT0gMHg1ZikgewogICAgICAgIHJldHVybiBDaGFyYWN0ZXJUeXBlLkFMUEhBX0xFVFRFUjsKICAgICAgfQogICAgICByZXR1cm4gQ2hhcmFjdGVyVHlwZS5QVU5DVDsKICAgIH0gZWxzZSBpZiAoaXNUaGFpKGNoYXJDb2RlKSkgewogICAgICByZXR1cm4gQ2hhcmFjdGVyVHlwZS5USEFJX0xFVFRFUjsKICAgIH0gZWxzZSBpZiAoY2hhckNvZGUgPT09IDB4YTApIHsKICAgICAgcmV0dXJuIENoYXJhY3RlclR5cGUuU1BBQ0U7CiAgICB9CiAgICByZXR1cm4gQ2hhcmFjdGVyVHlwZS5BTFBIQV9MRVRURVI7CiAgfQogIGlmIChpc0hhbihjaGFyQ29kZSkpIHsKICAgIHJldHVybiBDaGFyYWN0ZXJUeXBlLkhBTl9MRVRURVI7CiAgfSBlbHNlIGlmIChpc0thdGFrYW5hKGNoYXJDb2RlKSkgewogICAgcmV0dXJuIENoYXJhY3RlclR5cGUuS0FUQUtBTkFfTEVUVEVSOwogIH0gZWxzZSBpZiAoaXNIaXJhZ2FuYShjaGFyQ29kZSkpIHsKICAgIHJldHVybiBDaGFyYWN0ZXJUeXBlLkhJUkFHQU5BX0xFVFRFUjsKICB9IGVsc2UgaWYgKGlzSGFsZndpZHRoS2F0YWthbmEoY2hhckNvZGUpKSB7CiAgICByZXR1cm4gQ2hhcmFjdGVyVHlwZS5IQUxGV0lEVEhfS0FUQUtBTkFfTEVUVEVSOwogIH0KICByZXR1cm4gQ2hhcmFjdGVyVHlwZS5BTFBIQV9MRVRURVI7Cn0KbGV0IE5vcm1hbGl6ZVdpdGhORktDOwpmdW5jdGlvbiBnZXROb3JtYWxpemVXaXRoTkZLQygpIHsKICBOb3JtYWxpemVXaXRoTkZLQyB8fD0gYMKgwqjCqsKvwrItwrXCuC3CusK8LcK+xLItxLPEvy3FgMWJxb/HhC3HjMexLcezyrAtyrjLmC3LncugLcukzbTNus2+zoQtzoXOh8+QLc+Wz7Atz7LPtC3Ptc+51ofZtS3ZuOClmC3gpZ/gp5wt4Ked4Kef4Kiz4Ki24KmZLeCpm+CpnuCtnC3grZ3guLPgurPgu5wt4Lud4LyM4L2D4L2N4L2S4L2X4L2c4L2p4YO84bSsLeG0ruG0sC3htLrhtLwt4bWN4bWPLeG1quG1uOG2my3htr/hupot4bqb4b2x4b2z4b214b234b254b274b294b674b69LeG/geG/ieG/i+G/jS3hv4/hv5Phv5vhv50t4b+f4b+j4b+r4b+tLeG/r+G/ueG/u+G/vS3hv77igIAt4oCK4oCR4oCX4oCkLeKApuKAr+KAsy3igLTigLYt4oC34oC84oC+4oGHLeKBieKBl+KBn+KBsC3igbHigbQt4oKO4oKQLeKCnOKCqOKEgC3ihIPihIUt4oSH4oSJLeKEk+KElS3ihJbihJkt4oSd4oSgLeKEouKEpOKEpuKEqOKEqi3ihK3ihK8t4oSx4oSzLeKEueKEuy3ihYDihYUt4oWJ4oWQLeKFv+KGieKIrC3iiK3iiK8t4oiw4oypLeKMquKRoC3ik6riqIziqbQt4qm24quc4rG8LeKxveK1r+K6n+K7s+K8gC3iv5XjgIDjgLbjgLgt44C644KbLeOCnOOCn+ODv+OEsS3jho7jhpIt44af44iALeOInuOIoC3jiYfjiZAt44m+44qALeOPv+qanC3qmp3qnbDqn7It6p+06p+4LeqfueqtnC3qrZ/qranvpIAt76iN76iQ76iS76iVLe+onu+ooO+oou+opS3vqKbvqKot76mt76mwLe+rme+sgC3vrIbvrJMt76yX76yd76yfLe+stu+suC3vrLzvrL7vrYAt762B762DLe+thO+thi3vrrHvr5Mt77S977WQLe+2j++2ki3vt4fvt7At77e877iQLe+4me+4sC3vuYTvuYct77mS77mULe+5pu+5qC3vuavvubAt77my77m077m2Le+7vO+8gS3vvr7vv4It77+H77+KLe+/j++/ki3vv5fvv5ot77+c77+gLe+/pmA7CiAgcmV0dXJuIE5vcm1hbGl6ZVdpdGhORktDOwp9Cgo7Ly8gLi93ZWIvcGRmX2ZpbmRfY29udHJvbGxlci5qcwoKCmNvbnN0IEZpbmRTdGF0ZSA9IHsKICBGT1VORDogMCwKICBOT1RfRk9VTkQ6IDEsCiAgV1JBUFBFRDogMiwKICBQRU5ESU5HOiAzCn07CmNvbnN0IEZJTkRfVElNRU9VVCA9IDI1MDsKY29uc3QgTUFUQ0hfU0NST0xMX09GRlNFVF9UT1AgPSAtNTA7CmNvbnN0IE1BVENIX1NDUk9MTF9PRkZTRVRfTEVGVCA9IC00MDA7CmNvbnN0IENIQVJBQ1RFUlNfVE9fTk9STUFMSVpFID0gewogICJcdTIwMTAiOiAiLSIsCiAgIlx1MjAxOCI6ICInIiwKICAiXHUyMDE5IjogIiciLAogICJcdTIwMUEiOiAiJyIsCiAgIlx1MjAxQiI6ICInIiwKICAiXHUyMDFDIjogJyInLAogICJcdTIwMUQiOiAnIicsCiAgIlx1MjAxRSI6ICciJywKICAiXHUyMDFGIjogJyInLAogICJcdTAwQkMiOiAiMS80IiwKICAiXHUwMEJEIjogIjEvMiIsCiAgIlx1MDBCRSI6ICIzLzQiCn07CmNvbnN0IERJQUNSSVRJQ1NfRVhDRVBUSU9OID0gbmV3IFNldChbMHgzMDk5LCAweDMwOWEsIDB4MDk0ZCwgMHgwOWNkLCAweDBhNGQsIDB4MGFjZCwgMHgwYjRkLCAweDBiY2QsIDB4MGM0ZCwgMHgwY2NkLCAweDBkM2IsIDB4MGQzYywgMHgwZDRkLCAweDBkY2EsIDB4MGUzYSwgMHgwZWJhLCAweDBmODQsIDB4MTAzOSwgMHgxMDNhLCAweDE3MTQsIDB4MTczNCwgMHgxN2QyLCAweDFhNjAsIDB4MWI0NCwgMHgxYmFhLCAweDFiYWIsIDB4MWJmMiwgMHgxYmYzLCAweDJkN2YsIDB4YTgwNiwgMHhhODJjLCAweGE4YzQsIDB4YTk1MywgMHhhOWMwLCAweGFhZjYsIDB4YWJlZCwgMHgwYzU2LCAweDBmNzEsIDB4MGY3MiwgMHgwZjdhLCAweDBmN2IsIDB4MGY3YywgMHgwZjdkLCAweDBmODAsIDB4MGY3NF0pOwpsZXQgRElBQ1JJVElDU19FWENFUFRJT05fU1RSOwpjb25zdCBESUFDUklUSUNTX1JFR19FWFAgPSAvXHB7TX0rL2d1Owpjb25zdCBTUEVDSUFMX0NIQVJTX1JFR19FWFAgPSAvKFsuKis/XiR7fSgpfFtcXVxcXSl8KFxwe1B9KXwoXHMrKXwoXHB7TX0pfChccHtMfSkvZ3U7CmNvbnN0IE5PVF9ESUFDUklUSUNfRlJPTV9FTkRfUkVHX0VYUCA9IC8oW15ccHtNfV0pXHB7TX0qJC91Owpjb25zdCBOT1RfRElBQ1JJVElDX0ZST01fU1RBUlRfUkVHX0VYUCA9IC9eXHB7TX0qKFteXHB7TX1dKS91Owpjb25zdCBTWUxMQUJMRVNfUkVHX0VYUCA9IC9bXHVBQzAwLVx1RDdBRlx1RkE2Q1x1RkFDRi1cdUZBRDFcdUZBRDUtXHVGQUQ3XSsvZzsKY29uc3QgU1lMTEFCTEVTX0xFTkdUSFMgPSBuZXcgTWFwKCk7CmNvbnN0IEZJUlNUX0NIQVJfU1lMTEFCTEVTX1JFR19FWFAgPSAiW1xcdTExMDAtXFx1MTExMlxcdWQ3YTQtXFx1ZDdhZlxcdWQ4NGFcXHVkODRjXFx1ZDg1MFxcdWQ4NTRcXHVkODU3XFx1ZDg1Zl0iOwpjb25zdCBORktDX0NIQVJTX1RPX05PUk1BTElaRSA9IG5ldyBNYXAoKTsKbGV0IG5vU3lsbGFibGVzUmVnRXhwID0gbnVsbDsKbGV0IHdpdGhTeWxsYWJsZXNSZWdFeHAgPSBudWxsOwpmdW5jdGlvbiBub3JtYWxpemUodGV4dCkgewogIGNvbnN0IHN5bGxhYmxlUG9zaXRpb25zID0gW107CiAgbGV0IG07CiAgd2hpbGUgKChtID0gU1lMTEFCTEVTX1JFR19FWFAuZXhlYyh0ZXh0KSkgIT09IG51bGwpIHsKICAgIGxldCB7CiAgICAgIGluZGV4CiAgICB9ID0gbTsKICAgIGZvciAoY29uc3QgY2hhciBvZiBtWzBdKSB7CiAgICAgIGxldCBsZW4gPSBTWUxMQUJMRVNfTEVOR1RIUy5nZXQoY2hhcik7CiAgICAgIGlmICghbGVuKSB7CiAgICAgICAgbGVuID0gY2hhci5ub3JtYWxpemUoIk5GRCIpLmxlbmd0aDsKICAgICAgICBTWUxMQUJMRVNfTEVOR1RIUy5zZXQoY2hhciwgbGVuKTsKICAgICAgfQogICAgICBzeWxsYWJsZVBvc2l0aW9ucy5wdXNoKFtsZW4sIGluZGV4KytdKTsKICAgIH0KICB9CiAgY29uc3QgaGFzU3lsbGFibGVzID0gc3lsbGFibGVQb3NpdGlvbnMubGVuZ3RoID4gMDsKICBsZXQgbm9ybWFsaXphdGlvblJlZ2V4OwogIGlmICghaGFzU3lsbGFibGVzICYmIG5vU3lsbGFibGVzUmVnRXhwKSB7CiAgICBub3JtYWxpemF0aW9uUmVnZXggPSBub1N5bGxhYmxlc1JlZ0V4cDsKICB9IGVsc2UgaWYgKGhhc1N5bGxhYmxlcyAmJiB3aXRoU3lsbGFibGVzUmVnRXhwKSB7CiAgICBub3JtYWxpemF0aW9uUmVnZXggPSB3aXRoU3lsbGFibGVzUmVnRXhwOwogIH0gZWxzZSB7CiAgICBjb25zdCByZXBsYWNlID0gT2JqZWN0LmtleXMoQ0hBUkFDVEVSU19UT19OT1JNQUxJWkUpLmpvaW4oIiIpOwogICAgY29uc3QgdG9Ob3JtYWxpemVXaXRoTkZLQyA9IGdldE5vcm1hbGl6ZVdpdGhORktDKCk7CiAgICBjb25zdCBDSksgPSAiKD86XFxwe0lkZW9ncmFwaGljfXxbXHUzMDQwLVx1MzBGRl0pIjsKICAgIGNvbnN0IEhLRGlhY3JpdGljcyA9ICIoPzpcdTMwOTl8XHUzMDlBKSI7CiAgICBjb25zdCBCcm9rZW5Xb3JkID0gYFxccHtMbH0tXFxuKD89XFxwe0xsfSl8XFxwe0x1fS1cXG4oPz1cXHB7TH0pYDsKICAgIGNvbnN0IHJlZ2V4cHMgPSBbYFske3JlcGxhY2V9XWAsIGBbJHt0b05vcm1hbGl6ZVdpdGhORktDfV1gLCBgJHtIS0RpYWNyaXRpY3N9XFxuYCwgIlxccHtNfSsoPzotXFxuKT8iLCBgJHtCcm9rZW5Xb3JkfWAsICJcXFMtXFxuIiwgYCR7Q0pLfVxcbmAsICJcXG4iLCBoYXNTeWxsYWJsZXMgPyBGSVJTVF9DSEFSX1NZTExBQkxFU19SRUdfRVhQIDogIlxcdTAwMDAiXTsKICAgIG5vcm1hbGl6YXRpb25SZWdleCA9IG5ldyBSZWdFeHAocmVnZXhwcy5tYXAociA9PiBgKCR7cn0pYCkuam9pbigifCIpLCAiZ3VtIik7CiAgICBpZiAoaGFzU3lsbGFibGVzKSB7CiAgICAgIHdpdGhTeWxsYWJsZXNSZWdFeHAgPSBub3JtYWxpemF0aW9uUmVnZXg7CiAgICB9IGVsc2UgewogICAgICBub1N5bGxhYmxlc1JlZ0V4cCA9IG5vcm1hbGl6YXRpb25SZWdleDsKICAgIH0KICB9CiAgY29uc3QgcmF3RGlhY3JpdGljc1Bvc2l0aW9ucyA9IFtdOwogIHdoaWxlICgobSA9IERJQUNSSVRJQ1NfUkVHX0VYUC5leGVjKHRleHQpKSAhPT0gbnVsbCkgewogICAgcmF3RGlhY3JpdGljc1Bvc2l0aW9ucy5wdXNoKFttWzBdLmxlbmd0aCwgbS5pbmRleF0pOwogIH0KICBsZXQgbm9ybWFsaXplZCA9IHRleHQubm9ybWFsaXplKCJORkQiKTsKICBjb25zdCBwb3NpdGlvbnMgPSBbMCwgMF07CiAgbGV0IHJhd0RpYWNyaXRpY3NJbmRleCA9IDA7CiAgbGV0IHN5bGxhYmxlSW5kZXggPSAwOwogIGxldCBzaGlmdCA9IDA7CiAgbGV0IHNoaWZ0T3JpZ2luID0gMDsKICBsZXQgZW9sID0gMDsKICBsZXQgaGFzRGlhY3JpdGljcyA9IGZhbHNlOwogIG5vcm1hbGl6ZWQgPSBub3JtYWxpemVkLnJlcGxhY2Uobm9ybWFsaXphdGlvblJlZ2V4LCAobWF0Y2gsIHAxLCBwMiwgcDMsIHA0LCBwNSwgcDYsIHA3LCBwOCwgcDksIGkpID0+IHsKICAgIGkgLT0gc2hpZnRPcmlnaW47CiAgICBpZiAocDEpIHsKICAgICAgY29uc3QgcmVwbGFjZW1lbnQgPSBDSEFSQUNURVJTX1RPX05PUk1BTElaRVtwMV07CiAgICAgIGNvbnN0IGpqID0gcmVwbGFjZW1lbnQubGVuZ3RoOwogICAgICBmb3IgKGxldCBqID0gMTsgaiA8IGpqOyBqKyspIHsKICAgICAgICBwb3NpdGlvbnMucHVzaChpIC0gc2hpZnQgKyBqLCBzaGlmdCAtIGopOwogICAgICB9CiAgICAgIHNoaWZ0IC09IGpqIC0gMTsKICAgICAgcmV0dXJuIHJlcGxhY2VtZW50OwogICAgfQogICAgaWYgKHAyKSB7CiAgICAgIGxldCByZXBsYWNlbWVudCA9IE5GS0NfQ0hBUlNfVE9fTk9STUFMSVpFLmdldChwMik7CiAgICAgIGlmICghcmVwbGFjZW1lbnQpIHsKICAgICAgICByZXBsYWNlbWVudCA9IHAyLm5vcm1hbGl6ZSgiTkZLQyIpOwogICAgICAgIE5GS0NfQ0hBUlNfVE9fTk9STUFMSVpFLnNldChwMiwgcmVwbGFjZW1lbnQpOwogICAgICB9CiAgICAgIGNvbnN0IGpqID0gcmVwbGFjZW1lbnQubGVuZ3RoOwogICAgICBmb3IgKGxldCBqID0gMTsgaiA8IGpqOyBqKyspIHsKICAgICAgICBwb3NpdGlvbnMucHVzaChpIC0gc2hpZnQgKyBqLCBzaGlmdCAtIGopOwogICAgICB9CiAgICAgIHNoaWZ0IC09IGpqIC0gMTsKICAgICAgcmV0dXJuIHJlcGxhY2VtZW50OwogICAgfQogICAgaWYgKHAzKSB7CiAgICAgIGhhc0RpYWNyaXRpY3MgPSB0cnVlOwogICAgICBpZiAoaSArIGVvbCA9PT0gcmF3RGlhY3JpdGljc1Bvc2l0aW9uc1tyYXdEaWFjcml0aWNzSW5kZXhdPy5bMV0pIHsKICAgICAgICArK3Jhd0RpYWNyaXRpY3NJbmRleDsKICAgICAgfSBlbHNlIHsKICAgICAgICBwb3NpdGlvbnMucHVzaChpIC0gMSAtIHNoaWZ0ICsgMSwgc2hpZnQgLSAxKTsKICAgICAgICBzaGlmdCAtPSAxOwogICAgICAgIHNoaWZ0T3JpZ2luICs9IDE7CiAgICAgIH0KICAgICAgcG9zaXRpb25zLnB1c2goaSAtIHNoaWZ0ICsgMSwgc2hpZnQpOwogICAgICBzaGlmdE9yaWdpbiArPSAxOwogICAgICBlb2wgKz0gMTsKICAgICAgcmV0dXJuIHAzLmNoYXJBdCgwKTsKICAgIH0KICAgIGlmIChwNCkgewogICAgICBjb25zdCBoYXNUcmFpbGluZ0Rhc2hFT0wgPSBwNC5lbmRzV2l0aCgiXG4iKTsKICAgICAgY29uc3QgbGVuID0gaGFzVHJhaWxpbmdEYXNoRU9MID8gcDQubGVuZ3RoIC0gMiA6IHA0Lmxlbmd0aDsKICAgICAgaGFzRGlhY3JpdGljcyA9IHRydWU7CiAgICAgIGxldCBqaiA9IGxlbjsKICAgICAgaWYgKGkgKyBlb2wgPT09IHJhd0RpYWNyaXRpY3NQb3NpdGlvbnNbcmF3RGlhY3JpdGljc0luZGV4XT8uWzFdKSB7CiAgICAgICAgamogLT0gcmF3RGlhY3JpdGljc1Bvc2l0aW9uc1tyYXdEaWFjcml0aWNzSW5kZXhdWzBdOwogICAgICAgICsrcmF3RGlhY3JpdGljc0luZGV4OwogICAgICB9CiAgICAgIGZvciAobGV0IGogPSAxOyBqIDw9IGpqOyBqKyspIHsKICAgICAgICBwb3NpdGlvbnMucHVzaChpIC0gMSAtIHNoaWZ0ICsgaiwgc2hpZnQgLSBqKTsKICAgICAgfQogICAgICBzaGlmdCAtPSBqajsKICAgICAgc2hpZnRPcmlnaW4gKz0gamo7CiAgICAgIGlmIChoYXNUcmFpbGluZ0Rhc2hFT0wpIHsKICAgICAgICBpICs9IGxlbiAtIDE7CiAgICAgICAgcG9zaXRpb25zLnB1c2goaSAtIHNoaWZ0ICsgMSwgMSArIHNoaWZ0KTsKICAgICAgICBzaGlmdCArPSAxOwogICAgICAgIHNoaWZ0T3JpZ2luICs9IDE7CiAgICAgICAgZW9sICs9IDE7CiAgICAgICAgcmV0dXJuIHA0LnNsaWNlKDAsIGxlbik7CiAgICAgIH0KICAgICAgcmV0dXJuIHA0OwogICAgfQogICAgaWYgKHA1KSB7CiAgICAgIGNvbnN0IGxlbiA9IHA1Lmxlbmd0aCAtIDI7CiAgICAgIHBvc2l0aW9ucy5wdXNoKGkgLSBzaGlmdCArIGxlbiwgMSArIHNoaWZ0KTsKICAgICAgc2hpZnQgKz0gMTsKICAgICAgc2hpZnRPcmlnaW4gKz0gMTsKICAgICAgZW9sICs9IDE7CiAgICAgIHJldHVybiBwNS5zbGljZSgwLCAtMik7CiAgICB9CiAgICBpZiAocDYpIHsKICAgICAgc2hpZnRPcmlnaW4gKz0gMTsKICAgICAgZW9sICs9IDE7CiAgICAgIHJldHVybiBwNi5zbGljZSgwLCAtMSk7CiAgICB9CiAgICBpZiAocDcpIHsKICAgICAgY29uc3QgbGVuID0gcDcubGVuZ3RoIC0gMTsKICAgICAgcG9zaXRpb25zLnB1c2goaSAtIHNoaWZ0ICsgbGVuLCBzaGlmdCk7CiAgICAgIHNoaWZ0T3JpZ2luICs9IDE7CiAgICAgIGVvbCArPSAxOwogICAgICByZXR1cm4gcDcuc2xpY2UoMCwgLTEpOwogICAgfQogICAgaWYgKHA4KSB7CiAgICAgIHBvc2l0aW9ucy5wdXNoKGkgLSBzaGlmdCArIDEsIHNoaWZ0IC0gMSk7CiAgICAgIHNoaWZ0IC09IDE7CiAgICAgIHNoaWZ0T3JpZ2luICs9IDE7CiAgICAgIGVvbCArPSAxOwogICAgICByZXR1cm4gIiAiOwogICAgfQogICAgaWYgKGkgKyBlb2wgPT09IHN5bGxhYmxlUG9zaXRpb25zW3N5bGxhYmxlSW5kZXhdPy5bMV0pIHsKICAgICAgY29uc3QgbmV3Q2hhckxlbiA9IHN5bGxhYmxlUG9zaXRpb25zW3N5bGxhYmxlSW5kZXhdWzBdIC0gMTsKICAgICAgKytzeWxsYWJsZUluZGV4OwogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSBuZXdDaGFyTGVuOyBqKyspIHsKICAgICAgICBwb3NpdGlvbnMucHVzaChpIC0gKHNoaWZ0IC0gaiksIHNoaWZ0IC0gaik7CiAgICAgIH0KICAgICAgc2hpZnQgLT0gbmV3Q2hhckxlbjsKICAgICAgc2hpZnRPcmlnaW4gKz0gbmV3Q2hhckxlbjsKICAgIH0KICAgIHJldHVybiBwOTsKICB9KTsKICBwb3NpdGlvbnMucHVzaChub3JtYWxpemVkLmxlbmd0aCwgc2hpZnQpOwogIGNvbnN0IHN0YXJ0cyA9IG5ldyBVaW50MzJBcnJheShwb3NpdGlvbnMubGVuZ3RoID4+IDEpOwogIGNvbnN0IHNoaWZ0cyA9IG5ldyBJbnQzMkFycmF5KHBvc2l0aW9ucy5sZW5ndGggPj4gMSk7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gcG9zaXRpb25zLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgIHN0YXJ0c1tpID4+IDFdID0gcG9zaXRpb25zW2ldOwogICAgc2hpZnRzW2kgPj4gMV0gPSBwb3NpdGlvbnNbaSArIDFdOwogIH0KICByZXR1cm4gW25vcm1hbGl6ZWQsIFtzdGFydHMsIHNoaWZ0c10sIGhhc0RpYWNyaXRpY3NdOwp9CmZ1bmN0aW9uIGdldE9yaWdpbmFsSW5kZXgoZGlmZnMsIHBvcywgbGVuKSB7CiAgaWYgKCFkaWZmcykgewogICAgcmV0dXJuIFtwb3MsIGxlbl07CiAgfQogIGNvbnN0IFtzdGFydHMsIHNoaWZ0c10gPSBkaWZmczsKICBjb25zdCBzdGFydCA9IHBvczsKICBjb25zdCBlbmQgPSBwb3MgKyBsZW4gLSAxOwogIGxldCBpID0gYmluYXJ5U2VhcmNoRmlyc3RJdGVtKHN0YXJ0cywgeCA9PiB4ID49IHN0YXJ0KTsKICBpZiAoc3RhcnRzW2ldID4gc3RhcnQpIHsKICAgIC0taTsKICB9CiAgbGV0IGogPSBiaW5hcnlTZWFyY2hGaXJzdEl0ZW0oc3RhcnRzLCB4ID0+IHggPj0gZW5kLCBpKTsKICBpZiAoc3RhcnRzW2pdID4gZW5kKSB7CiAgICAtLWo7CiAgfQogIGNvbnN0IG9sZFN0YXJ0ID0gc3RhcnQgKyBzaGlmdHNbaV07CiAgY29uc3Qgb2xkRW5kID0gZW5kICsgc2hpZnRzW2pdOwogIGNvbnN0IG9sZExlbiA9IG9sZEVuZCArIDEgLSBvbGRTdGFydDsKICByZXR1cm4gW29sZFN0YXJ0LCBvbGRMZW5dOwp9CmNsYXNzIFBERkZpbmRDb250cm9sbGVyIHsKICAjc3RhdGUgPSBudWxsOwogICN1cGRhdGVNYXRjaGVzQ291bnRPblByb2dyZXNzID0gdHJ1ZTsKICAjdmlzaXRlZFBhZ2VzQ291bnQgPSAwOwogIGNvbnN0cnVjdG9yKHsKICAgIGxpbmtTZXJ2aWNlLAogICAgZXZlbnRCdXMsCiAgICB1cGRhdGVNYXRjaGVzQ291bnRPblByb2dyZXNzID0gdHJ1ZQogIH0pIHsKICAgIHRoaXMuX2xpbmtTZXJ2aWNlID0gbGlua1NlcnZpY2U7CiAgICB0aGlzLl9ldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgdGhpcy4jdXBkYXRlTWF0Y2hlc0NvdW50T25Qcm9ncmVzcyA9IHVwZGF0ZU1hdGNoZXNDb3VudE9uUHJvZ3Jlc3M7CiAgICB0aGlzLm9uSXNQYWdlVmlzaWJsZSA9IG51bGw7CiAgICB0aGlzLiNyZXNldCgpOwogICAgZXZlbnRCdXMuX29uKCJmaW5kIiwgdGhpcy4jb25GaW5kLmJpbmQodGhpcykpOwogICAgZXZlbnRCdXMuX29uKCJmaW5kYmFyY2xvc2UiLCB0aGlzLiNvbkZpbmRCYXJDbG9zZS5iaW5kKHRoaXMpKTsKICB9CiAgZ2V0IGhpZ2hsaWdodE1hdGNoZXMoKSB7CiAgICByZXR1cm4gdGhpcy5faGlnaGxpZ2h0TWF0Y2hlczsKICB9CiAgZ2V0IHBhZ2VNYXRjaGVzKCkgewogICAgcmV0dXJuIHRoaXMuX3BhZ2VNYXRjaGVzOwogIH0KICBnZXQgcGFnZU1hdGNoZXNMZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5fcGFnZU1hdGNoZXNMZW5ndGg7CiAgfQogIGdldCBzZWxlY3RlZCgpIHsKICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZDsKICB9CiAgZ2V0IHN0YXRlKCkgewogICAgcmV0dXJuIHRoaXMuI3N0YXRlOwogIH0KICBzZXREb2N1bWVudChwZGZEb2N1bWVudCkgewogICAgaWYgKHRoaXMuX3BkZkRvY3VtZW50KSB7CiAgICAgIHRoaXMuI3Jlc2V0KCk7CiAgICB9CiAgICBpZiAoIXBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX3BkZkRvY3VtZW50ID0gcGRmRG9jdW1lbnQ7CiAgICB0aGlzLl9maXJzdFBhZ2VDYXBhYmlsaXR5LnJlc29sdmUoKTsKICB9CiAgI29uRmluZChzdGF0ZSkgewogICAgaWYgKCFzdGF0ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwZGZEb2N1bWVudCA9IHRoaXMuX3BkZkRvY3VtZW50OwogICAgY29uc3QgewogICAgICB0eXBlCiAgICB9ID0gc3RhdGU7CiAgICBpZiAodGhpcy4jc3RhdGUgPT09IG51bGwgfHwgdGhpcy4jc2hvdWxkRGlydHlNYXRjaChzdGF0ZSkpIHsKICAgICAgdGhpcy5fZGlydHlNYXRjaCA9IHRydWU7CiAgICB9CiAgICB0aGlzLiNzdGF0ZSA9IHN0YXRlOwogICAgaWYgKHR5cGUgIT09ICJoaWdobGlnaHRhbGxjaGFuZ2UiKSB7CiAgICAgIHRoaXMuI3VwZGF0ZVVJU3RhdGUoRmluZFN0YXRlLlBFTkRJTkcpOwogICAgfQogICAgdGhpcy5fZmlyc3RQYWdlQ2FwYWJpbGl0eS5wcm9taXNlLnRoZW4oKCkgPT4gewogICAgICBpZiAoIXRoaXMuX3BkZkRvY3VtZW50IHx8IHBkZkRvY3VtZW50ICYmIHRoaXMuX3BkZkRvY3VtZW50ICE9PSBwZGZEb2N1bWVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLiNleHRyYWN0VGV4dCgpOwogICAgICBjb25zdCBmaW5kYmFyQ2xvc2VkID0gIXRoaXMuX2hpZ2hsaWdodE1hdGNoZXM7CiAgICAgIGNvbnN0IHBlbmRpbmdUaW1lb3V0ID0gISF0aGlzLl9maW5kVGltZW91dDsKICAgICAgaWYgKHRoaXMuX2ZpbmRUaW1lb3V0KSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2ZpbmRUaW1lb3V0KTsKICAgICAgICB0aGlzLl9maW5kVGltZW91dCA9IG51bGw7CiAgICAgIH0KICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgdGhpcy5fZmluZFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHRoaXMuI25leHRNYXRjaCgpOwogICAgICAgICAgdGhpcy5fZmluZFRpbWVvdXQgPSBudWxsOwogICAgICAgIH0sIEZJTkRfVElNRU9VVCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fZGlydHlNYXRjaCkgewogICAgICAgIHRoaXMuI25leHRNYXRjaCgpOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICJhZ2FpbiIpIHsKICAgICAgICB0aGlzLiNuZXh0TWF0Y2goKTsKICAgICAgICBpZiAoZmluZGJhckNsb3NlZCAmJiB0aGlzLiNzdGF0ZS5oaWdobGlnaHRBbGwpIHsKICAgICAgICAgIHRoaXMuI3VwZGF0ZUFsbFBhZ2VzKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICJoaWdobGlnaHRhbGxjaGFuZ2UiKSB7CiAgICAgICAgaWYgKHBlbmRpbmdUaW1lb3V0KSB7CiAgICAgICAgICB0aGlzLiNuZXh0TWF0Y2goKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5faGlnaGxpZ2h0TWF0Y2hlcyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHRoaXMuI3VwZGF0ZUFsbFBhZ2VzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4jbmV4dE1hdGNoKCk7CiAgICAgIH0KICAgIH0pOwogIH0KICBzY3JvbGxNYXRjaEludG9WaWV3KHsKICAgIGVsZW1lbnQgPSBudWxsLAogICAgc2VsZWN0ZWRMZWZ0ID0gMCwKICAgIHBhZ2VJbmRleCA9IC0xLAogICAgbWF0Y2hJbmRleCA9IC0xCiAgfSkgewogICAgaWYgKCF0aGlzLl9zY3JvbGxNYXRjaGVzIHx8ICFlbGVtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0gZWxzZSBpZiAobWF0Y2hJbmRleCA9PT0gLTEgfHwgbWF0Y2hJbmRleCAhPT0gdGhpcy5fc2VsZWN0ZWQubWF0Y2hJZHgpIHsKICAgICAgcmV0dXJuOwogICAgfSBlbHNlIGlmIChwYWdlSW5kZXggPT09IC0xIHx8IHBhZ2VJbmRleCAhPT0gdGhpcy5fc2VsZWN0ZWQucGFnZUlkeCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9zY3JvbGxNYXRjaGVzID0gZmFsc2U7CiAgICBjb25zdCBzcG90ID0gewogICAgICB0b3A6IE1BVENIX1NDUk9MTF9PRkZTRVRfVE9QLAogICAgICBsZWZ0OiBzZWxlY3RlZExlZnQgKyBNQVRDSF9TQ1JPTExfT0ZGU0VUX0xFRlQKICAgIH07CiAgICBzY3JvbGxJbnRvVmlldyhlbGVtZW50LCBzcG90LCB0cnVlKTsKICB9CiAgI3Jlc2V0KCkgewogICAgdGhpcy5faGlnaGxpZ2h0TWF0Y2hlcyA9IGZhbHNlOwogICAgdGhpcy5fc2Nyb2xsTWF0Y2hlcyA9IGZhbHNlOwogICAgdGhpcy5fcGRmRG9jdW1lbnQgPSBudWxsOwogICAgdGhpcy5fcGFnZU1hdGNoZXMgPSBbXTsKICAgIHRoaXMuX3BhZ2VNYXRjaGVzTGVuZ3RoID0gW107CiAgICB0aGlzLiN2aXNpdGVkUGFnZXNDb3VudCA9IDA7CiAgICB0aGlzLiNzdGF0ZSA9IG51bGw7CiAgICB0aGlzLl9zZWxlY3RlZCA9IHsKICAgICAgcGFnZUlkeDogLTEsCiAgICAgIG1hdGNoSWR4OiAtMQogICAgfTsKICAgIHRoaXMuX29mZnNldCA9IHsKICAgICAgcGFnZUlkeDogbnVsbCwKICAgICAgbWF0Y2hJZHg6IG51bGwsCiAgICAgIHdyYXBwZWQ6IGZhbHNlCiAgICB9OwogICAgdGhpcy5fZXh0cmFjdFRleHRQcm9taXNlcyA9IFtdOwogICAgdGhpcy5fcGFnZUNvbnRlbnRzID0gW107CiAgICB0aGlzLl9wYWdlRGlmZnMgPSBbXTsKICAgIHRoaXMuX2hhc0RpYWNyaXRpY3MgPSBbXTsKICAgIHRoaXMuX21hdGNoZXNDb3VudFRvdGFsID0gMDsKICAgIHRoaXMuX3BhZ2VzVG9TZWFyY2ggPSBudWxsOwogICAgdGhpcy5fcGVuZGluZ0ZpbmRNYXRjaGVzID0gbmV3IFNldCgpOwogICAgdGhpcy5fcmVzdW1lUGFnZUlkeCA9IG51bGw7CiAgICB0aGlzLl9kaXJ0eU1hdGNoID0gZmFsc2U7CiAgICBjbGVhclRpbWVvdXQodGhpcy5fZmluZFRpbWVvdXQpOwogICAgdGhpcy5fZmluZFRpbWVvdXQgPSBudWxsOwogICAgdGhpcy5fZmlyc3RQYWdlQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogIH0KICBnZXQgI3F1ZXJ5KCkgewogICAgY29uc3QgewogICAgICBxdWVyeQogICAgfSA9IHRoaXMuI3N0YXRlOwogICAgaWYgKHR5cGVvZiBxdWVyeSA9PT0gInN0cmluZyIpIHsKICAgICAgaWYgKHF1ZXJ5ICE9PSB0aGlzLl9yYXdRdWVyeSkgewogICAgICAgIHRoaXMuX3Jhd1F1ZXJ5ID0gcXVlcnk7CiAgICAgICAgW3RoaXMuX25vcm1hbGl6ZWRRdWVyeV0gPSBub3JtYWxpemUocXVlcnkpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9ub3JtYWxpemVkUXVlcnk7CiAgICB9CiAgICByZXR1cm4gKHF1ZXJ5IHx8IFtdKS5maWx0ZXIocSA9PiAhIXEpLm1hcChxID0+IG5vcm1hbGl6ZShxKVswXSk7CiAgfQogICNzaG91bGREaXJ0eU1hdGNoKHN0YXRlKSB7CiAgICBjb25zdCBuZXdRdWVyeSA9IHN0YXRlLnF1ZXJ5LAogICAgICBwcmV2UXVlcnkgPSB0aGlzLiNzdGF0ZS5xdWVyeTsKICAgIGNvbnN0IG5ld1R5cGUgPSB0eXBlb2YgbmV3UXVlcnksCiAgICAgIHByZXZUeXBlID0gdHlwZW9mIHByZXZRdWVyeTsKICAgIGlmIChuZXdUeXBlICE9PSBwcmV2VHlwZSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChuZXdUeXBlID09PSAic3RyaW5nIikgewogICAgICBpZiAobmV3UXVlcnkgIT09IHByZXZRdWVyeSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9IGVsc2UgaWYgKEpTT04uc3RyaW5naWZ5KG5ld1F1ZXJ5KSAhPT0gSlNPTi5zdHJpbmdpZnkocHJldlF1ZXJ5KSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHN3aXRjaCAoc3RhdGUudHlwZSkgewogICAgICBjYXNlICJhZ2FpbiI6CiAgICAgICAgY29uc3QgcGFnZU51bWJlciA9IHRoaXMuX3NlbGVjdGVkLnBhZ2VJZHggKyAxOwogICAgICAgIGNvbnN0IGxpbmtTZXJ2aWNlID0gdGhpcy5fbGlua1NlcnZpY2U7CiAgICAgICAgcmV0dXJuIHBhZ2VOdW1iZXIgPj0gMSAmJiBwYWdlTnVtYmVyIDw9IGxpbmtTZXJ2aWNlLnBhZ2VzQ291bnQgJiYgcGFnZU51bWJlciAhPT0gbGlua1NlcnZpY2UucGFnZSAmJiAhKHRoaXMub25Jc1BhZ2VWaXNpYmxlPy4ocGFnZU51bWJlcikgPz8gdHJ1ZSk7CiAgICAgIGNhc2UgImhpZ2hsaWdodGFsbGNoYW5nZSI6CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogICNpc0VudGlyZVdvcmQoY29udGVudCwgc3RhcnRJZHgsIGxlbmd0aCkgewogICAgbGV0IG1hdGNoID0gY29udGVudC5zbGljZSgwLCBzdGFydElkeCkubWF0Y2goTk9UX0RJQUNSSVRJQ19GUk9NX0VORF9SRUdfRVhQKTsKICAgIGlmIChtYXRjaCkgewogICAgICBjb25zdCBmaXJzdCA9IGNvbnRlbnQuY2hhckNvZGVBdChzdGFydElkeCk7CiAgICAgIGNvbnN0IGxpbWl0ID0gbWF0Y2hbMV0uY2hhckNvZGVBdCgwKTsKICAgICAgaWYgKGdldENoYXJhY3RlclR5cGUoZmlyc3QpID09PSBnZXRDaGFyYWN0ZXJUeXBlKGxpbWl0KSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgbWF0Y2ggPSBjb250ZW50LnNsaWNlKHN0YXJ0SWR4ICsgbGVuZ3RoKS5tYXRjaChOT1RfRElBQ1JJVElDX0ZST01fU1RBUlRfUkVHX0VYUCk7CiAgICBpZiAobWF0Y2gpIHsKICAgICAgY29uc3QgbGFzdCA9IGNvbnRlbnQuY2hhckNvZGVBdChzdGFydElkeCArIGxlbmd0aCAtIDEpOwogICAgICBjb25zdCBsaW1pdCA9IG1hdGNoWzFdLmNoYXJDb2RlQXQoMCk7CiAgICAgIGlmIChnZXRDaGFyYWN0ZXJUeXBlKGxhc3QpID09PSBnZXRDaGFyYWN0ZXJUeXBlKGxpbWl0KSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogICNjb252ZXJ0VG9SZWdFeHBTdHJpbmcocXVlcnksIGhhc0RpYWNyaXRpY3MpIHsKICAgIGNvbnN0IHsKICAgICAgbWF0Y2hEaWFjcml0aWNzCiAgICB9ID0gdGhpcy4jc3RhdGU7CiAgICBsZXQgaXNVbmljb2RlID0gZmFsc2U7CiAgICBxdWVyeSA9IHF1ZXJ5LnJlcGxhY2VBbGwoU1BFQ0lBTF9DSEFSU19SRUdfRVhQLCAobWF0Y2gsIHAxLCBwMiwgcDMsIHA0LCBwNSkgPT4gewogICAgICBpZiAocDEpIHsKICAgICAgICByZXR1cm4gYFsgXSpcXCR7cDF9WyBdKmA7CiAgICAgIH0KICAgICAgaWYgKHAyKSB7CiAgICAgICAgcmV0dXJuIGBbIF0qJHtwMn1bIF0qYDsKICAgICAgfQogICAgICBpZiAocDMpIHsKICAgICAgICByZXR1cm4gIlsgXSsiOwogICAgICB9CiAgICAgIGlmIChtYXRjaERpYWNyaXRpY3MpIHsKICAgICAgICByZXR1cm4gcDQgfHwgcDU7CiAgICAgIH0KICAgICAgaWYgKHA0KSB7CiAgICAgICAgcmV0dXJuIERJQUNSSVRJQ1NfRVhDRVBUSU9OLmhhcyhwNC5jaGFyQ29kZUF0KDApKSA/IHA0IDogIiI7CiAgICAgIH0KICAgICAgaWYgKGhhc0RpYWNyaXRpY3MpIHsKICAgICAgICBpc1VuaWNvZGUgPSB0cnVlOwogICAgICAgIHJldHVybiBgJHtwNX1cXHB7TX0qYDsKICAgICAgfQogICAgICByZXR1cm4gcDU7CiAgICB9KTsKICAgIGNvbnN0IHRyYWlsaW5nU3BhY2VzID0gIlsgXSoiOwogICAgaWYgKHF1ZXJ5LmVuZHNXaXRoKHRyYWlsaW5nU3BhY2VzKSkgewogICAgICBxdWVyeSA9IHF1ZXJ5LnNsaWNlKDAsIHF1ZXJ5Lmxlbmd0aCAtIHRyYWlsaW5nU3BhY2VzLmxlbmd0aCk7CiAgICB9CiAgICBpZiAobWF0Y2hEaWFjcml0aWNzKSB7CiAgICAgIGlmIChoYXNEaWFjcml0aWNzKSB7CiAgICAgICAgRElBQ1JJVElDU19FWENFUFRJT05fU1RSIHx8PSBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLkRJQUNSSVRJQ1NfRVhDRVBUSU9OKTsKICAgICAgICBpc1VuaWNvZGUgPSB0cnVlOwogICAgICAgIHF1ZXJ5ID0gYCR7cXVlcnl9KD89WyR7RElBQ1JJVElDU19FWENFUFRJT05fU1RSfV18W15cXHB7TX1dfCQpYDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIFtpc1VuaWNvZGUsIHF1ZXJ5XTsKICB9CiAgI2NhbGN1bGF0ZU1hdGNoKHBhZ2VJbmRleCkgewogICAgaWYgKCF0aGlzLiNzdGF0ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBxdWVyeSA9IHRoaXMuI3F1ZXJ5OwogICAgaWYgKHF1ZXJ5Lmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwYWdlQ29udGVudCA9IHRoaXMuX3BhZ2VDb250ZW50c1twYWdlSW5kZXhdOwogICAgY29uc3QgbWF0Y2hlclJlc3VsdCA9IHRoaXMubWF0Y2gocXVlcnksIHBhZ2VDb250ZW50LCBwYWdlSW5kZXgpOwogICAgY29uc3QgbWF0Y2hlcyA9IHRoaXMuX3BhZ2VNYXRjaGVzW3BhZ2VJbmRleF0gPSBbXTsKICAgIGNvbnN0IG1hdGNoZXNMZW5ndGggPSB0aGlzLl9wYWdlTWF0Y2hlc0xlbmd0aFtwYWdlSW5kZXhdID0gW107CiAgICBjb25zdCBkaWZmcyA9IHRoaXMuX3BhZ2VEaWZmc1twYWdlSW5kZXhdOwogICAgbWF0Y2hlclJlc3VsdD8uZm9yRWFjaCgoewogICAgICBpbmRleCwKICAgICAgbGVuZ3RoCiAgICB9KSA9PiB7CiAgICAgIGNvbnN0IFttYXRjaFBvcywgbWF0Y2hMZW5dID0gZ2V0T3JpZ2luYWxJbmRleChkaWZmcywgaW5kZXgsIGxlbmd0aCk7CiAgICAgIGlmIChtYXRjaExlbikgewogICAgICAgIG1hdGNoZXMucHVzaChtYXRjaFBvcyk7CiAgICAgICAgbWF0Y2hlc0xlbmd0aC5wdXNoKG1hdGNoTGVuKTsKICAgICAgfQogICAgfSk7CiAgICBpZiAodGhpcy4jc3RhdGUuaGlnaGxpZ2h0QWxsKSB7CiAgICAgIHRoaXMuI3VwZGF0ZVBhZ2UocGFnZUluZGV4KTsKICAgIH0KICAgIGlmICh0aGlzLl9yZXN1bWVQYWdlSWR4ID09PSBwYWdlSW5kZXgpIHsKICAgICAgdGhpcy5fcmVzdW1lUGFnZUlkeCA9IG51bGw7CiAgICAgIHRoaXMuI25leHRQYWdlTWF0Y2goKTsKICAgIH0KICAgIGNvbnN0IHBhZ2VNYXRjaGVzQ291bnQgPSBtYXRjaGVzLmxlbmd0aDsKICAgIHRoaXMuX21hdGNoZXNDb3VudFRvdGFsICs9IHBhZ2VNYXRjaGVzQ291bnQ7CiAgICBpZiAodGhpcy4jdXBkYXRlTWF0Y2hlc0NvdW50T25Qcm9ncmVzcykgewogICAgICBpZiAocGFnZU1hdGNoZXNDb3VudCA+IDApIHsKICAgICAgICB0aGlzLiN1cGRhdGVVSVJlc3VsdHNDb3VudCgpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKCsrdGhpcy4jdmlzaXRlZFBhZ2VzQ291bnQgPT09IHRoaXMuX2xpbmtTZXJ2aWNlLnBhZ2VzQ291bnQpIHsKICAgICAgdGhpcy4jdXBkYXRlVUlSZXN1bHRzQ291bnQoKTsKICAgIH0KICB9CiAgbWF0Y2gocXVlcnksIHBhZ2VDb250ZW50LCBwYWdlSW5kZXgpIHsKICAgIGNvbnN0IGhhc0RpYWNyaXRpY3MgPSB0aGlzLl9oYXNEaWFjcml0aWNzW3BhZ2VJbmRleF07CiAgICBsZXQgaXNVbmljb2RlID0gZmFsc2U7CiAgICBpZiAodHlwZW9mIHF1ZXJ5ID09PSAic3RyaW5nIikgewogICAgICBbaXNVbmljb2RlLCBxdWVyeV0gPSB0aGlzLiNjb252ZXJ0VG9SZWdFeHBTdHJpbmcocXVlcnksIGhhc0RpYWNyaXRpY3MpOwogICAgfSBlbHNlIHsKICAgICAgcXVlcnkgPSBxdWVyeS5zb3J0KCkucmV2ZXJzZSgpLm1hcChxID0+IHsKICAgICAgICBjb25zdCBbaXNVbmljb2RlUGFydCwgcXVlcnlQYXJ0XSA9IHRoaXMuI2NvbnZlcnRUb1JlZ0V4cFN0cmluZyhxLCBoYXNEaWFjcml0aWNzKTsKICAgICAgICBpc1VuaWNvZGUgfHw9IGlzVW5pY29kZVBhcnQ7CiAgICAgICAgcmV0dXJuIGAoJHtxdWVyeVBhcnR9KWA7CiAgICAgIH0pLmpvaW4oInwiKTsKICAgIH0KICAgIGlmICghcXVlcnkpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgY2FzZVNlbnNpdGl2ZSwKICAgICAgZW50aXJlV29yZAogICAgfSA9IHRoaXMuI3N0YXRlOwogICAgY29uc3QgZmxhZ3MgPSBgZyR7aXNVbmljb2RlID8gInUiIDogIiJ9JHtjYXNlU2Vuc2l0aXZlID8gIiIgOiAiaSJ9YDsKICAgIHF1ZXJ5ID0gbmV3IFJlZ0V4cChxdWVyeSwgZmxhZ3MpOwogICAgY29uc3QgbWF0Y2hlcyA9IFtdOwogICAgbGV0IG1hdGNoOwogICAgd2hpbGUgKChtYXRjaCA9IHF1ZXJ5LmV4ZWMocGFnZUNvbnRlbnQpKSAhPT0gbnVsbCkgewogICAgICBpZiAoZW50aXJlV29yZCAmJiAhdGhpcy4jaXNFbnRpcmVXb3JkKHBhZ2VDb250ZW50LCBtYXRjaC5pbmRleCwgbWF0Y2hbMF0ubGVuZ3RoKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIG1hdGNoZXMucHVzaCh7CiAgICAgICAgaW5kZXg6IG1hdGNoLmluZGV4LAogICAgICAgIGxlbmd0aDogbWF0Y2hbMF0ubGVuZ3RoCiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIG1hdGNoZXM7CiAgfQogICNleHRyYWN0VGV4dCgpIHsKICAgIGlmICh0aGlzLl9leHRyYWN0VGV4dFByb21pc2VzLmxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGRlZmVycmVkID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICBjb25zdCB0ZXh0T3B0aW9ucyA9IHsKICAgICAgZGlzYWJsZU5vcm1hbGl6YXRpb246IHRydWUKICAgIH07CiAgICBjb25zdCBwZGZEb2MgPSB0aGlzLl9wZGZEb2N1bWVudDsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHRoaXMuX2xpbmtTZXJ2aWNlLnBhZ2VzQ291bnQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBwcm9taXNlLAogICAgICAgIHJlc29sdmUKICAgICAgfSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgICB0aGlzLl9leHRyYWN0VGV4dFByb21pc2VzW2ldID0gcHJvbWlzZTsKICAgICAgZGVmZXJyZWQgPSBkZWZlcnJlZC50aGVuKGFzeW5jICgpID0+IHsKICAgICAgICBpZiAocGRmRG9jICE9PSB0aGlzLl9wZGZEb2N1bWVudCkgewogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBhd2FpdCBwZGZEb2MuZ2V0UGFnZShpICsgMSkudGhlbihwZGZQYWdlID0+IHBkZlBhZ2UuZ2V0VGV4dENvbnRlbnQodGV4dE9wdGlvbnMpKS50aGVuKHRleHRDb250ZW50ID0+IHsKICAgICAgICAgIGNvbnN0IHN0ckJ1ZiA9IFtdOwogICAgICAgICAgZm9yIChjb25zdCB0ZXh0SXRlbSBvZiB0ZXh0Q29udGVudC5pdGVtcykgewogICAgICAgICAgICBzdHJCdWYucHVzaCh0ZXh0SXRlbS5zdHIpOwogICAgICAgICAgICBpZiAodGV4dEl0ZW0uaGFzRU9MKSB7CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goIlxuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIFt0aGlzLl9wYWdlQ29udGVudHNbaV0sIHRoaXMuX3BhZ2VEaWZmc1tpXSwgdGhpcy5faGFzRGlhY3JpdGljc1tpXV0gPSBub3JtYWxpemUoc3RyQnVmLmpvaW4oIiIpKTsKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9LCByZWFzb24gPT4gewogICAgICAgICAgY29uc29sZS5lcnJvcihgVW5hYmxlIHRvIGdldCB0ZXh0IGNvbnRlbnQgZm9yIHBhZ2UgJHtpICsgMX1gLCByZWFzb24pOwogICAgICAgICAgdGhpcy5fcGFnZUNvbnRlbnRzW2ldID0gIiI7CiAgICAgICAgICB0aGlzLl9wYWdlRGlmZnNbaV0gPSBudWxsOwogICAgICAgICAgdGhpcy5faGFzRGlhY3JpdGljc1tpXSA9IGZhbHNlOwogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9CiAgI3VwZGF0ZVBhZ2UoaW5kZXgpIHsKICAgIGlmICh0aGlzLl9zY3JvbGxNYXRjaGVzICYmIHRoaXMuX3NlbGVjdGVkLnBhZ2VJZHggPT09IGluZGV4KSB7CiAgICAgIHRoaXMuX2xpbmtTZXJ2aWNlLnBhZ2UgPSBpbmRleCArIDE7CiAgICB9CiAgICB0aGlzLl9ldmVudEJ1cy5kaXNwYXRjaCgidXBkYXRldGV4dGxheWVybWF0Y2hlcyIsIHsKICAgICAgc291cmNlOiB0aGlzLAogICAgICBwYWdlSW5kZXg6IGluZGV4CiAgICB9KTsKICB9CiAgI3VwZGF0ZUFsbFBhZ2VzKCkgewogICAgdGhpcy5fZXZlbnRCdXMuZGlzcGF0Y2goInVwZGF0ZXRleHRsYXllcm1hdGNoZXMiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgcGFnZUluZGV4OiAtMQogICAgfSk7CiAgfQogICNuZXh0TWF0Y2goKSB7CiAgICBjb25zdCBwcmV2aW91cyA9IHRoaXMuI3N0YXRlLmZpbmRQcmV2aW91czsKICAgIGNvbnN0IGN1cnJlbnRQYWdlSW5kZXggPSB0aGlzLl9saW5rU2VydmljZS5wYWdlIC0gMTsKICAgIGNvbnN0IG51bVBhZ2VzID0gdGhpcy5fbGlua1NlcnZpY2UucGFnZXNDb3VudDsKICAgIHRoaXMuX2hpZ2hsaWdodE1hdGNoZXMgPSB0cnVlOwogICAgaWYgKHRoaXMuX2RpcnR5TWF0Y2gpIHsKICAgICAgdGhpcy5fZGlydHlNYXRjaCA9IGZhbHNlOwogICAgICB0aGlzLl9zZWxlY3RlZC5wYWdlSWR4ID0gdGhpcy5fc2VsZWN0ZWQubWF0Y2hJZHggPSAtMTsKICAgICAgdGhpcy5fb2Zmc2V0LnBhZ2VJZHggPSBjdXJyZW50UGFnZUluZGV4OwogICAgICB0aGlzLl9vZmZzZXQubWF0Y2hJZHggPSBudWxsOwogICAgICB0aGlzLl9vZmZzZXQud3JhcHBlZCA9IGZhbHNlOwogICAgICB0aGlzLl9yZXN1bWVQYWdlSWR4ID0gbnVsbDsKICAgICAgdGhpcy5fcGFnZU1hdGNoZXMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5fcGFnZU1hdGNoZXNMZW5ndGgubGVuZ3RoID0gMDsKICAgICAgdGhpcy4jdmlzaXRlZFBhZ2VzQ291bnQgPSAwOwogICAgICB0aGlzLl9tYXRjaGVzQ291bnRUb3RhbCA9IDA7CiAgICAgIHRoaXMuI3VwZGF0ZUFsbFBhZ2VzKCk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtUGFnZXM7IGkrKykgewogICAgICAgIGlmICh0aGlzLl9wZW5kaW5nRmluZE1hdGNoZXMuaGFzKGkpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fcGVuZGluZ0ZpbmRNYXRjaGVzLmFkZChpKTsKICAgICAgICB0aGlzLl9leHRyYWN0VGV4dFByb21pc2VzW2ldLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy5fcGVuZGluZ0ZpbmRNYXRjaGVzLmRlbGV0ZShpKTsKICAgICAgICAgIHRoaXMuI2NhbGN1bGF0ZU1hdGNoKGkpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBjb25zdCBxdWVyeSA9IHRoaXMuI3F1ZXJ5OwogICAgaWYgKHF1ZXJ5Lmxlbmd0aCA9PT0gMCkgewogICAgICB0aGlzLiN1cGRhdGVVSVN0YXRlKEZpbmRTdGF0ZS5GT1VORCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9yZXN1bWVQYWdlSWR4KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG9mZnNldCA9IHRoaXMuX29mZnNldDsKICAgIHRoaXMuX3BhZ2VzVG9TZWFyY2ggPSBudW1QYWdlczsKICAgIGlmIChvZmZzZXQubWF0Y2hJZHggIT09IG51bGwpIHsKICAgICAgY29uc3QgbnVtUGFnZU1hdGNoZXMgPSB0aGlzLl9wYWdlTWF0Y2hlc1tvZmZzZXQucGFnZUlkeF0ubGVuZ3RoOwogICAgICBpZiAoIXByZXZpb3VzICYmIG9mZnNldC5tYXRjaElkeCArIDEgPCBudW1QYWdlTWF0Y2hlcyB8fCBwcmV2aW91cyAmJiBvZmZzZXQubWF0Y2hJZHggPiAwKSB7CiAgICAgICAgb2Zmc2V0Lm1hdGNoSWR4ID0gcHJldmlvdXMgPyBvZmZzZXQubWF0Y2hJZHggLSAxIDogb2Zmc2V0Lm1hdGNoSWR4ICsgMTsKICAgICAgICB0aGlzLiN1cGRhdGVNYXRjaCh0cnVlKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy4jYWR2YW5jZU9mZnNldFBhZ2UocHJldmlvdXMpOwogICAgfQogICAgdGhpcy4jbmV4dFBhZ2VNYXRjaCgpOwogIH0KICAjbWF0Y2hlc1JlYWR5KG1hdGNoZXMpIHsKICAgIGNvbnN0IG9mZnNldCA9IHRoaXMuX29mZnNldDsKICAgIGNvbnN0IG51bU1hdGNoZXMgPSBtYXRjaGVzLmxlbmd0aDsKICAgIGNvbnN0IHByZXZpb3VzID0gdGhpcy4jc3RhdGUuZmluZFByZXZpb3VzOwogICAgaWYgKG51bU1hdGNoZXMpIHsKICAgICAgb2Zmc2V0Lm1hdGNoSWR4ID0gcHJldmlvdXMgPyBudW1NYXRjaGVzIC0gMSA6IDA7CiAgICAgIHRoaXMuI3VwZGF0ZU1hdGNoKHRydWUpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHRoaXMuI2FkdmFuY2VPZmZzZXRQYWdlKHByZXZpb3VzKTsKICAgIGlmIChvZmZzZXQud3JhcHBlZCkgewogICAgICBvZmZzZXQubWF0Y2hJZHggPSBudWxsOwogICAgICBpZiAodGhpcy5fcGFnZXNUb1NlYXJjaCA8IDApIHsKICAgICAgICB0aGlzLiN1cGRhdGVNYXRjaChmYWxzZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgI25leHRQYWdlTWF0Y2goKSB7CiAgICBpZiAodGhpcy5fcmVzdW1lUGFnZUlkeCAhPT0gbnVsbCkgewogICAgICBjb25zb2xlLmVycm9yKCJUaGVyZSBjYW4gb25seSBiZSBvbmUgcGVuZGluZyBwYWdlLiIpOwogICAgfQogICAgbGV0IG1hdGNoZXMgPSBudWxsOwogICAgZG8gewogICAgICBjb25zdCBwYWdlSWR4ID0gdGhpcy5fb2Zmc2V0LnBhZ2VJZHg7CiAgICAgIG1hdGNoZXMgPSB0aGlzLl9wYWdlTWF0Y2hlc1twYWdlSWR4XTsKICAgICAgaWYgKCFtYXRjaGVzKSB7CiAgICAgICAgdGhpcy5fcmVzdW1lUGFnZUlkeCA9IHBhZ2VJZHg7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0gd2hpbGUgKCF0aGlzLiNtYXRjaGVzUmVhZHkobWF0Y2hlcykpOwogIH0KICAjYWR2YW5jZU9mZnNldFBhZ2UocHJldmlvdXMpIHsKICAgIGNvbnN0IG9mZnNldCA9IHRoaXMuX29mZnNldDsKICAgIGNvbnN0IG51bVBhZ2VzID0gdGhpcy5fbGlua1NlcnZpY2UucGFnZXNDb3VudDsKICAgIG9mZnNldC5wYWdlSWR4ID0gcHJldmlvdXMgPyBvZmZzZXQucGFnZUlkeCAtIDEgOiBvZmZzZXQucGFnZUlkeCArIDE7CiAgICBvZmZzZXQubWF0Y2hJZHggPSBudWxsOwogICAgdGhpcy5fcGFnZXNUb1NlYXJjaC0tOwogICAgaWYgKG9mZnNldC5wYWdlSWR4ID49IG51bVBhZ2VzIHx8IG9mZnNldC5wYWdlSWR4IDwgMCkgewogICAgICBvZmZzZXQucGFnZUlkeCA9IHByZXZpb3VzID8gbnVtUGFnZXMgLSAxIDogMDsKICAgICAgb2Zmc2V0LndyYXBwZWQgPSB0cnVlOwogICAgfQogIH0KICAjdXBkYXRlTWF0Y2goZm91bmQgPSBmYWxzZSkgewogICAgbGV0IHN0YXRlID0gRmluZFN0YXRlLk5PVF9GT1VORDsKICAgIGNvbnN0IHdyYXBwZWQgPSB0aGlzLl9vZmZzZXQud3JhcHBlZDsKICAgIHRoaXMuX29mZnNldC53cmFwcGVkID0gZmFsc2U7CiAgICBpZiAoZm91bmQpIHsKICAgICAgY29uc3QgcHJldmlvdXNQYWdlID0gdGhpcy5fc2VsZWN0ZWQucGFnZUlkeDsKICAgICAgdGhpcy5fc2VsZWN0ZWQucGFnZUlkeCA9IHRoaXMuX29mZnNldC5wYWdlSWR4OwogICAgICB0aGlzLl9zZWxlY3RlZC5tYXRjaElkeCA9IHRoaXMuX29mZnNldC5tYXRjaElkeDsKICAgICAgc3RhdGUgPSB3cmFwcGVkID8gRmluZFN0YXRlLldSQVBQRUQgOiBGaW5kU3RhdGUuRk9VTkQ7CiAgICAgIGlmIChwcmV2aW91c1BhZ2UgIT09IC0xICYmIHByZXZpb3VzUGFnZSAhPT0gdGhpcy5fc2VsZWN0ZWQucGFnZUlkeCkgewogICAgICAgIHRoaXMuI3VwZGF0ZVBhZ2UocHJldmlvdXNQYWdlKTsKICAgICAgfQogICAgfQogICAgdGhpcy4jdXBkYXRlVUlTdGF0ZShzdGF0ZSwgdGhpcy4jc3RhdGUuZmluZFByZXZpb3VzKTsKICAgIGlmICh0aGlzLl9zZWxlY3RlZC5wYWdlSWR4ICE9PSAtMSkgewogICAgICB0aGlzLl9zY3JvbGxNYXRjaGVzID0gdHJ1ZTsKICAgICAgdGhpcy4jdXBkYXRlUGFnZSh0aGlzLl9zZWxlY3RlZC5wYWdlSWR4KTsKICAgIH0KICB9CiAgI29uRmluZEJhckNsb3NlKGV2dCkgewogICAgY29uc3QgcGRmRG9jdW1lbnQgPSB0aGlzLl9wZGZEb2N1bWVudDsKICAgIHRoaXMuX2ZpcnN0UGFnZUNhcGFiaWxpdHkucHJvbWlzZS50aGVuKCgpID0+IHsKICAgICAgaWYgKCF0aGlzLl9wZGZEb2N1bWVudCB8fCBwZGZEb2N1bWVudCAmJiB0aGlzLl9wZGZEb2N1bWVudCAhPT0gcGRmRG9jdW1lbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMuX2ZpbmRUaW1lb3V0KSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2ZpbmRUaW1lb3V0KTsKICAgICAgICB0aGlzLl9maW5kVGltZW91dCA9IG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuX3Jlc3VtZVBhZ2VJZHgpIHsKICAgICAgICB0aGlzLl9yZXN1bWVQYWdlSWR4ID0gbnVsbDsKICAgICAgICB0aGlzLl9kaXJ0eU1hdGNoID0gdHJ1ZTsKICAgICAgfQogICAgICB0aGlzLiN1cGRhdGVVSVN0YXRlKEZpbmRTdGF0ZS5GT1VORCk7CiAgICAgIHRoaXMuX2hpZ2hsaWdodE1hdGNoZXMgPSBmYWxzZTsKICAgICAgdGhpcy4jdXBkYXRlQWxsUGFnZXMoKTsKICAgIH0pOwogIH0KICAjcmVxdWVzdE1hdGNoZXNDb3VudCgpIHsKICAgIGNvbnN0IHsKICAgICAgcGFnZUlkeCwKICAgICAgbWF0Y2hJZHgKICAgIH0gPSB0aGlzLl9zZWxlY3RlZDsKICAgIGxldCBjdXJyZW50ID0gMCwKICAgICAgdG90YWwgPSB0aGlzLl9tYXRjaGVzQ291bnRUb3RhbDsKICAgIGlmIChtYXRjaElkeCAhPT0gLTEpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlSWR4OyBpKyspIHsKICAgICAgICBjdXJyZW50ICs9IHRoaXMuX3BhZ2VNYXRjaGVzW2ldPy5sZW5ndGggfHwgMDsKICAgICAgfQogICAgICBjdXJyZW50ICs9IG1hdGNoSWR4ICsgMTsKICAgIH0KICAgIGlmIChjdXJyZW50IDwgMSB8fCBjdXJyZW50ID4gdG90YWwpIHsKICAgICAgY3VycmVudCA9IHRvdGFsID0gMDsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGN1cnJlbnQsCiAgICAgIHRvdGFsCiAgICB9OwogIH0KICAjdXBkYXRlVUlSZXN1bHRzQ291bnQoKSB7CiAgICB0aGlzLl9ldmVudEJ1cy5kaXNwYXRjaCgidXBkYXRlZmluZG1hdGNoZXNjb3VudCIsIHsKICAgICAgc291cmNlOiB0aGlzLAogICAgICBtYXRjaGVzQ291bnQ6IHRoaXMuI3JlcXVlc3RNYXRjaGVzQ291bnQoKQogICAgfSk7CiAgfQogICN1cGRhdGVVSVN0YXRlKHN0YXRlLCBwcmV2aW91cyA9IGZhbHNlKSB7CiAgICBpZiAoIXRoaXMuI3VwZGF0ZU1hdGNoZXNDb3VudE9uUHJvZ3Jlc3MgJiYgKHRoaXMuI3Zpc2l0ZWRQYWdlc0NvdW50ICE9PSB0aGlzLl9saW5rU2VydmljZS5wYWdlc0NvdW50IHx8IHN0YXRlID09PSBGaW5kU3RhdGUuUEVORElORykpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fZXZlbnRCdXMuZGlzcGF0Y2goInVwZGF0ZWZpbmRjb250cm9sc3RhdGUiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgc3RhdGUsCiAgICAgIHByZXZpb3VzLAogICAgICBlbnRpcmVXb3JkOiB0aGlzLiNzdGF0ZT8uZW50aXJlV29yZCA/PyBudWxsLAogICAgICBtYXRjaGVzQ291bnQ6IHRoaXMuI3JlcXVlc3RNYXRjaGVzQ291bnQoKSwKICAgICAgcmF3UXVlcnk6IHRoaXMuI3N0YXRlPy5xdWVyeSA/PyBudWxsCiAgICB9KTsKICB9Cn0KCjsvLyAuL3dlYi9wZGZfZmluZF9iYXIuanMKCgpjb25zdCBNQVRDSEVTX0NPVU5UX0xJTUlUID0gMTAwMDsKY2xhc3MgUERGRmluZEJhciB7CiAgI21haW5Db250YWluZXI7CiAgI3Jlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKHRoaXMuI3Jlc2l6ZU9ic2VydmVyQ2FsbGJhY2suYmluZCh0aGlzKSk7CiAgY29uc3RydWN0b3Iob3B0aW9ucywgbWFpbkNvbnRhaW5lciwgZXZlbnRCdXMpIHsKICAgIHRoaXMub3BlbmVkID0gZmFsc2U7CiAgICB0aGlzLmJhciA9IG9wdGlvbnMuYmFyOwogICAgdGhpcy50b2dnbGVCdXR0b24gPSBvcHRpb25zLnRvZ2dsZUJ1dHRvbjsKICAgIHRoaXMuZmluZEZpZWxkID0gb3B0aW9ucy5maW5kRmllbGQ7CiAgICB0aGlzLmhpZ2hsaWdodEFsbCA9IG9wdGlvbnMuaGlnaGxpZ2h0QWxsQ2hlY2tib3g7CiAgICB0aGlzLmNhc2VTZW5zaXRpdmUgPSBvcHRpb25zLmNhc2VTZW5zaXRpdmVDaGVja2JveDsKICAgIHRoaXMubWF0Y2hEaWFjcml0aWNzID0gb3B0aW9ucy5tYXRjaERpYWNyaXRpY3NDaGVja2JveDsKICAgIHRoaXMuZW50aXJlV29yZCA9IG9wdGlvbnMuZW50aXJlV29yZENoZWNrYm94OwogICAgdGhpcy5maW5kTXNnID0gb3B0aW9ucy5maW5kTXNnOwogICAgdGhpcy5maW5kUmVzdWx0c0NvdW50ID0gb3B0aW9ucy5maW5kUmVzdWx0c0NvdW50OwogICAgdGhpcy5maW5kUHJldmlvdXNCdXR0b24gPSBvcHRpb25zLmZpbmRQcmV2aW91c0J1dHRvbjsKICAgIHRoaXMuZmluZE5leHRCdXR0b24gPSBvcHRpb25zLmZpbmROZXh0QnV0dG9uOwogICAgdGhpcy5ldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgdGhpcy4jbWFpbkNvbnRhaW5lciA9IG1haW5Db250YWluZXI7CiAgICBjb25zdCBjaGVja2VkSW5wdXRzID0gbmV3IE1hcChbW3RoaXMuaGlnaGxpZ2h0QWxsLCAiaGlnaGxpZ2h0YWxsY2hhbmdlIl0sIFt0aGlzLmNhc2VTZW5zaXRpdmUsICJjYXNlc2Vuc2l0aXZpdHljaGFuZ2UiXSwgW3RoaXMuZW50aXJlV29yZCwgImVudGlyZXdvcmRjaGFuZ2UiXSwgW3RoaXMubWF0Y2hEaWFjcml0aWNzLCAiZGlhY3JpdGljbWF0Y2hpbmdjaGFuZ2UiXV0pOwogICAgdGhpcy50b2dnbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIHRoaXMudG9nZ2xlKCk7CiAgICB9KTsKICAgIHRoaXMuZmluZEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKCkgPT4gewogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoIiIpOwogICAgfSk7CiAgICB0aGlzLmJhci5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgKHsKICAgICAga2V5Q29kZSwKICAgICAgc2hpZnRLZXksCiAgICAgIHRhcmdldAogICAgfSkgPT4gewogICAgICBzd2l0Y2ggKGtleUNvZGUpIHsKICAgICAgICBjYXNlIDEzOgogICAgICAgICAgaWYgKHRhcmdldCA9PT0gdGhpcy5maW5kRmllbGQpIHsKICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCJhZ2FpbiIsIHNoaWZ0S2V5KTsKICAgICAgICAgIH0gZWxzZSBpZiAoY2hlY2tlZElucHV0cy5oYXModGFyZ2V0KSkgewogICAgICAgICAgICB0YXJnZXQuY2hlY2tlZCA9ICF0YXJnZXQuY2hlY2tlZDsKICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGNoZWNrZWRJbnB1dHMuZ2V0KHRhcmdldCkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyNzoKICAgICAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuZmluZFByZXZpb3VzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoImFnYWluIiwgdHJ1ZSk7CiAgICB9KTsKICAgIHRoaXMuZmluZE5leHRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCgiYWdhaW4iLCBmYWxzZSk7CiAgICB9KTsKICAgIGZvciAoY29uc3QgW2VsZW0sIGV2dE5hbWVdIG9mIGNoZWNrZWRJbnB1dHMpIHsKICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZ0TmFtZSk7CiAgICAgIH0pOwogICAgfQogIH0KICByZXNldCgpIHsKICAgIHRoaXMudXBkYXRlVUlTdGF0ZSgpOwogIH0KICBkaXNwYXRjaEV2ZW50KHR5cGUsIGZpbmRQcmV2ID0gZmFsc2UpIHsKICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goImZpbmQiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgdHlwZSwKICAgICAgcXVlcnk6IHRoaXMuZmluZEZpZWxkLnZhbHVlLAogICAgICBjYXNlU2Vuc2l0aXZlOiB0aGlzLmNhc2VTZW5zaXRpdmUuY2hlY2tlZCwKICAgICAgZW50aXJlV29yZDogdGhpcy5lbnRpcmVXb3JkLmNoZWNrZWQsCiAgICAgIGhpZ2hsaWdodEFsbDogdGhpcy5oaWdobGlnaHRBbGwuY2hlY2tlZCwKICAgICAgZmluZFByZXZpb3VzOiBmaW5kUHJldiwKICAgICAgbWF0Y2hEaWFjcml0aWNzOiB0aGlzLm1hdGNoRGlhY3JpdGljcy5jaGVja2VkCiAgICB9KTsKICB9CiAgdXBkYXRlVUlTdGF0ZShzdGF0ZSwgcHJldmlvdXMsIG1hdGNoZXNDb3VudCkgewogICAgY29uc3QgewogICAgICBmaW5kRmllbGQsCiAgICAgIGZpbmRNc2cKICAgIH0gPSB0aGlzOwogICAgbGV0IGZpbmRNc2dJZCA9ICIiLAogICAgICBzdGF0dXMgPSAiIjsKICAgIHN3aXRjaCAoc3RhdGUpIHsKICAgICAgY2FzZSBGaW5kU3RhdGUuRk9VTkQ6CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgRmluZFN0YXRlLlBFTkRJTkc6CiAgICAgICAgc3RhdHVzID0gInBlbmRpbmciOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIEZpbmRTdGF0ZS5OT1RfRk9VTkQ6CiAgICAgICAgZmluZE1zZ0lkID0gInBkZmpzLWZpbmQtbm90LWZvdW5kIjsKICAgICAgICBzdGF0dXMgPSAibm90Rm91bmQiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIEZpbmRTdGF0ZS5XUkFQUEVEOgogICAgICAgIGZpbmRNc2dJZCA9IHByZXZpb3VzID8gInBkZmpzLWZpbmQtcmVhY2hlZC10b3AiIDogInBkZmpzLWZpbmQtcmVhY2hlZC1ib3R0b20iOwogICAgICAgIGJyZWFrOwogICAgfQogICAgZmluZEZpZWxkLnNldEF0dHJpYnV0ZSgiZGF0YS1zdGF0dXMiLCBzdGF0dXMpOwogICAgZmluZEZpZWxkLnNldEF0dHJpYnV0ZSgiYXJpYS1pbnZhbGlkIiwgc3RhdGUgPT09IEZpbmRTdGF0ZS5OT1RfRk9VTkQpOwogICAgZmluZE1zZy5zZXRBdHRyaWJ1dGUoImRhdGEtc3RhdHVzIiwgc3RhdHVzKTsKICAgIGlmIChmaW5kTXNnSWQpIHsKICAgICAgZmluZE1zZy5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsIGZpbmRNc2dJZCk7CiAgICB9IGVsc2UgewogICAgICBmaW5kTXNnLnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIik7CiAgICAgIGZpbmRNc2cudGV4dENvbnRlbnQgPSAiIjsKICAgIH0KICAgIHRoaXMudXBkYXRlUmVzdWx0c0NvdW50KG1hdGNoZXNDb3VudCk7CiAgfQogIHVwZGF0ZVJlc3VsdHNDb3VudCh7CiAgICBjdXJyZW50ID0gMCwKICAgIHRvdGFsID0gMAogIH0gPSB7fSkgewogICAgY29uc3QgewogICAgICBmaW5kUmVzdWx0c0NvdW50CiAgICB9ID0gdGhpczsKICAgIGlmICh0b3RhbCA+IDApIHsKICAgICAgY29uc3QgbGltaXQgPSBNQVRDSEVTX0NPVU5UX0xJTUlUOwogICAgICBmaW5kUmVzdWx0c0NvdW50LnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgdG90YWwgPiBsaW1pdCA/ICJwZGZqcy1maW5kLW1hdGNoLWNvdW50LWxpbWl0IiA6ICJwZGZqcy1maW5kLW1hdGNoLWNvdW50Iik7CiAgICAgIGZpbmRSZXN1bHRzQ291bnQuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4tYXJncyIsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICBsaW1pdCwKICAgICAgICBjdXJyZW50LAogICAgICAgIHRvdGFsCiAgICAgIH0pKTsKICAgIH0gZWxzZSB7CiAgICAgIGZpbmRSZXN1bHRzQ291bnQucmVtb3ZlQXR0cmlidXRlKCJkYXRhLWwxMG4taWQiKTsKICAgICAgZmluZFJlc3VsdHNDb3VudC50ZXh0Q29udGVudCA9ICIiOwogICAgfQogIH0KICBvcGVuKCkgewogICAgaWYgKCF0aGlzLm9wZW5lZCkgewogICAgICB0aGlzLiNyZXNpemVPYnNlcnZlci5vYnNlcnZlKHRoaXMuI21haW5Db250YWluZXIpOwogICAgICB0aGlzLiNyZXNpemVPYnNlcnZlci5vYnNlcnZlKHRoaXMuYmFyKTsKICAgICAgdGhpcy5vcGVuZWQgPSB0cnVlOwogICAgICB0b2dnbGVFeHBhbmRlZEJ0bih0aGlzLnRvZ2dsZUJ1dHRvbiwgdHJ1ZSwgdGhpcy5iYXIpOwogICAgfQogICAgdGhpcy5maW5kRmllbGQuc2VsZWN0KCk7CiAgICB0aGlzLmZpbmRGaWVsZC5mb2N1cygpOwogIH0KICBjbG9zZSgpIHsKICAgIGlmICghdGhpcy5vcGVuZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jcmVzaXplT2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgdGhpcy5vcGVuZWQgPSBmYWxzZTsKICAgIHRvZ2dsZUV4cGFuZGVkQnRuKHRoaXMudG9nZ2xlQnV0dG9uLCBmYWxzZSwgdGhpcy5iYXIpOwogICAgdGhpcy5ldmVudEJ1cy5kaXNwYXRjaCgiZmluZGJhcmNsb3NlIiwgewogICAgICBzb3VyY2U6IHRoaXMKICAgIH0pOwogIH0KICB0b2dnbGUoKSB7CiAgICBpZiAodGhpcy5vcGVuZWQpIHsKICAgICAgdGhpcy5jbG9zZSgpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5vcGVuKCk7CiAgICB9CiAgfQogICNyZXNpemVPYnNlcnZlckNhbGxiYWNrKCkgewogICAgY29uc3QgewogICAgICBiYXIKICAgIH0gPSB0aGlzOwogICAgYmFyLmNsYXNzTGlzdC5yZW1vdmUoIndyYXBDb250YWluZXJzIik7CiAgICBjb25zdCBmaW5kYmFySGVpZ2h0ID0gYmFyLmNsaWVudEhlaWdodDsKICAgIGNvbnN0IGlucHV0Q29udGFpbmVySGVpZ2h0ID0gYmFyLmZpcnN0RWxlbWVudENoaWxkLmNsaWVudEhlaWdodDsKICAgIGlmIChmaW5kYmFySGVpZ2h0ID4gaW5wdXRDb250YWluZXJIZWlnaHQpIHsKICAgICAgYmFyLmNsYXNzTGlzdC5hZGQoIndyYXBDb250YWluZXJzIik7CiAgICB9CiAgfQp9Cgo7Ly8gLi93ZWIvcGRmX2hpc3RvcnkuanMKCgoKY29uc3QgSEFTSF9DSEFOR0VfVElNRU9VVCA9IDEwMDA7CmNvbnN0IFBPU0lUSU9OX1VQREFURURfVEhSRVNIT0xEID0gNTA7CmNvbnN0IFVQREFURV9WSUVXQVJFQV9USU1FT1VUID0gMTAwMDsKZnVuY3Rpb24gZ2V0Q3VycmVudEhhc2goKSB7CiAgcmV0dXJuIGRvY3VtZW50LmxvY2F0aW9uLmhhc2g7Cn0KY2xhc3MgUERGSGlzdG9yeSB7CiAgI2V2ZW50QWJvcnRDb250cm9sbGVyID0gbnVsbDsKICBjb25zdHJ1Y3Rvcih7CiAgICBsaW5rU2VydmljZSwKICAgIGV2ZW50QnVzCiAgfSkgewogICAgdGhpcy5saW5rU2VydmljZSA9IGxpbmtTZXJ2aWNlOwogICAgdGhpcy5ldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgdGhpcy5faW5pdGlhbGl6ZWQgPSBmYWxzZTsKICAgIHRoaXMuX2ZpbmdlcnByaW50ID0gIiI7CiAgICB0aGlzLnJlc2V0KCk7CiAgICB0aGlzLmV2ZW50QnVzLl9vbigicGFnZXNpbml0IiwgKCkgPT4gewogICAgICB0aGlzLl9pc1BhZ2VzTG9hZGVkID0gZmFsc2U7CiAgICAgIHRoaXMuZXZlbnRCdXMuX29uKCJwYWdlc2xvYWRlZCIsIGV2dCA9PiB7CiAgICAgICAgdGhpcy5faXNQYWdlc0xvYWRlZCA9ICEhZXZ0LnBhZ2VzQ291bnQ7CiAgICAgIH0sIHsKICAgICAgICBvbmNlOiB0cnVlCiAgICAgIH0pOwogICAgfSk7CiAgfQogIGluaXRpYWxpemUoewogICAgZmluZ2VycHJpbnQsCiAgICByZXNldEhpc3RvcnkgPSBmYWxzZSwKICAgIHVwZGF0ZVVybCA9IGZhbHNlCiAgfSkgewogICAgaWYgKCFmaW5nZXJwcmludCB8fCB0eXBlb2YgZmluZ2VycHJpbnQgIT09ICJzdHJpbmciKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ1BERkhpc3RvcnkuaW5pdGlhbGl6ZTogVGhlICJmaW5nZXJwcmludCIgbXVzdCBiZSBhIG5vbi1lbXB0eSBzdHJpbmcuJyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9pbml0aWFsaXplZCkgewogICAgICB0aGlzLnJlc2V0KCk7CiAgICB9CiAgICBjb25zdCByZUluaXRpYWxpemVkID0gdGhpcy5fZmluZ2VycHJpbnQgIT09ICIiICYmIHRoaXMuX2ZpbmdlcnByaW50ICE9PSBmaW5nZXJwcmludDsKICAgIHRoaXMuX2ZpbmdlcnByaW50ID0gZmluZ2VycHJpbnQ7CiAgICB0aGlzLl91cGRhdGVVcmwgPSB1cGRhdGVVcmwgPT09IHRydWU7CiAgICB0aGlzLl9pbml0aWFsaXplZCA9IHRydWU7CiAgICB0aGlzLiNiaW5kRXZlbnRzKCk7CiAgICBjb25zdCBzdGF0ZSA9IHdpbmRvdy5oaXN0b3J5LnN0YXRlOwogICAgdGhpcy5fcG9wU3RhdGVJblByb2dyZXNzID0gZmFsc2U7CiAgICB0aGlzLl9ibG9ja0hhc2hDaGFuZ2UgPSAwOwogICAgdGhpcy5fY3VycmVudEhhc2ggPSBnZXRDdXJyZW50SGFzaCgpOwogICAgdGhpcy5fbnVtUG9zaXRpb25VcGRhdGVzID0gMDsKICAgIHRoaXMuX3VpZCA9IHRoaXMuX21heFVpZCA9IDA7CiAgICB0aGlzLl9kZXN0aW5hdGlvbiA9IG51bGw7CiAgICB0aGlzLl9wb3NpdGlvbiA9IG51bGw7CiAgICBpZiAoIXRoaXMuI2lzVmFsaWRTdGF0ZShzdGF0ZSwgdHJ1ZSkgfHwgcmVzZXRIaXN0b3J5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBoYXNoLAogICAgICAgIHBhZ2UsCiAgICAgICAgcm90YXRpb24KICAgICAgfSA9IHRoaXMuI3BhcnNlQ3VycmVudEhhc2godHJ1ZSk7CiAgICAgIGlmICghaGFzaCB8fCByZUluaXRpYWxpemVkIHx8IHJlc2V0SGlzdG9yeSkgewogICAgICAgIHRoaXMuI3B1c2hPclJlcGxhY2VTdGF0ZShudWxsLCB0cnVlKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy4jcHVzaE9yUmVwbGFjZVN0YXRlKHsKICAgICAgICBoYXNoLAogICAgICAgIHBhZ2UsCiAgICAgICAgcm90YXRpb24KICAgICAgfSwgdHJ1ZSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gc3RhdGUuZGVzdGluYXRpb247CiAgICB0aGlzLiN1cGRhdGVJbnRlcm5hbFN0YXRlKGRlc3RpbmF0aW9uLCBzdGF0ZS51aWQsIHRydWUpOwogICAgaWYgKGRlc3RpbmF0aW9uLnJvdGF0aW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy5faW5pdGlhbFJvdGF0aW9uID0gZGVzdGluYXRpb24ucm90YXRpb247CiAgICB9CiAgICBpZiAoZGVzdGluYXRpb24uZGVzdCkgewogICAgICB0aGlzLl9pbml0aWFsQm9va21hcmsgPSBKU09OLnN0cmluZ2lmeShkZXN0aW5hdGlvbi5kZXN0KTsKICAgICAgdGhpcy5fZGVzdGluYXRpb24ucGFnZSA9IG51bGw7CiAgICB9IGVsc2UgaWYgKGRlc3RpbmF0aW9uLmhhc2gpIHsKICAgICAgdGhpcy5faW5pdGlhbEJvb2ttYXJrID0gZGVzdGluYXRpb24uaGFzaDsKICAgIH0gZWxzZSBpZiAoZGVzdGluYXRpb24ucGFnZSkgewogICAgICB0aGlzLl9pbml0aWFsQm9va21hcmsgPSBgcGFnZT0ke2Rlc3RpbmF0aW9uLnBhZ2V9YDsKICAgIH0KICB9CiAgcmVzZXQoKSB7CiAgICBpZiAodGhpcy5faW5pdGlhbGl6ZWQpIHsKICAgICAgdGhpcy4jcGFnZUhpZGUoKTsKICAgICAgdGhpcy5faW5pdGlhbGl6ZWQgPSBmYWxzZTsKICAgICAgdGhpcy4jdW5iaW5kRXZlbnRzKCk7CiAgICB9CiAgICBpZiAodGhpcy5fdXBkYXRlVmlld2FyZWFUaW1lb3V0KSB7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLl91cGRhdGVWaWV3YXJlYVRpbWVvdXQpOwogICAgICB0aGlzLl91cGRhdGVWaWV3YXJlYVRpbWVvdXQgPSBudWxsOwogICAgfQogICAgdGhpcy5faW5pdGlhbEJvb2ttYXJrID0gbnVsbDsKICAgIHRoaXMuX2luaXRpYWxSb3RhdGlvbiA9IG51bGw7CiAgfQogIHB1c2goewogICAgbmFtZWREZXN0ID0gbnVsbCwKICAgIGV4cGxpY2l0RGVzdCwKICAgIHBhZ2VOdW1iZXIKICB9KSB7CiAgICBpZiAoIXRoaXMuX2luaXRpYWxpemVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChuYW1lZERlc3QgJiYgdHlwZW9mIG5hbWVkRGVzdCAhPT0gInN0cmluZyIpIHsKICAgICAgY29uc29sZS5lcnJvcigiUERGSGlzdG9yeS5wdXNoOiAiICsgYCIke25hbWVkRGVzdH0iIGlzIG5vdCBhIHZhbGlkIG5hbWVkRGVzdCBwYXJhbWV0ZXIuYCk7CiAgICAgIHJldHVybjsKICAgIH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkoZXhwbGljaXREZXN0KSkgewogICAgICBjb25zb2xlLmVycm9yKCJQREZIaXN0b3J5LnB1c2g6ICIgKyBgIiR7ZXhwbGljaXREZXN0fSIgaXMgbm90IGEgdmFsaWQgZXhwbGljaXREZXN0IHBhcmFtZXRlci5gKTsKICAgICAgcmV0dXJuOwogICAgfSBlbHNlIGlmICghdGhpcy4jaXNWYWxpZFBhZ2UocGFnZU51bWJlcikpIHsKICAgICAgaWYgKHBhZ2VOdW1iZXIgIT09IG51bGwgfHwgdGhpcy5fZGVzdGluYXRpb24pIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJQREZIaXN0b3J5LnB1c2g6ICIgKyBgIiR7cGFnZU51bWJlcn0iIGlzIG5vdCBhIHZhbGlkIHBhZ2VOdW1iZXIgcGFyYW1ldGVyLmApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgY29uc3QgaGFzaCA9IG5hbWVkRGVzdCB8fCBKU09OLnN0cmluZ2lmeShleHBsaWNpdERlc3QpOwogICAgaWYgKCFoYXNoKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBmb3JjZVJlcGxhY2UgPSBmYWxzZTsKICAgIGlmICh0aGlzLl9kZXN0aW5hdGlvbiAmJiAoaXNEZXN0SGFzaGVzRXF1YWwodGhpcy5fZGVzdGluYXRpb24uaGFzaCwgaGFzaCkgfHwgaXNEZXN0QXJyYXlzRXF1YWwodGhpcy5fZGVzdGluYXRpb24uZGVzdCwgZXhwbGljaXREZXN0KSkpIHsKICAgICAgaWYgKHRoaXMuX2Rlc3RpbmF0aW9uLnBhZ2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yY2VSZXBsYWNlID0gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLl9wb3BTdGF0ZUluUHJvZ3Jlc3MgJiYgIWZvcmNlUmVwbGFjZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNwdXNoT3JSZXBsYWNlU3RhdGUoewogICAgICBkZXN0OiBleHBsaWNpdERlc3QsCiAgICAgIGhhc2gsCiAgICAgIHBhZ2U6IHBhZ2VOdW1iZXIsCiAgICAgIHJvdGF0aW9uOiB0aGlzLmxpbmtTZXJ2aWNlLnJvdGF0aW9uCiAgICB9LCBmb3JjZVJlcGxhY2UpOwogICAgaWYgKCF0aGlzLl9wb3BTdGF0ZUluUHJvZ3Jlc3MpIHsKICAgICAgdGhpcy5fcG9wU3RhdGVJblByb2dyZXNzID0gdHJ1ZTsKICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB7CiAgICAgICAgdGhpcy5fcG9wU3RhdGVJblByb2dyZXNzID0gZmFsc2U7CiAgICAgIH0pOwogICAgfQogIH0KICBwdXNoUGFnZShwYWdlTnVtYmVyKSB7CiAgICBpZiAoIXRoaXMuX2luaXRpYWxpemVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpcy4jaXNWYWxpZFBhZ2UocGFnZU51bWJlcikpIHsKICAgICAgY29uc29sZS5lcnJvcihgUERGSGlzdG9yeS5wdXNoUGFnZTogIiR7cGFnZU51bWJlcn0iIGlzIG5vdCBhIHZhbGlkIHBhZ2UgbnVtYmVyLmApOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5fZGVzdGluYXRpb24/LnBhZ2UgPT09IHBhZ2VOdW1iZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX3BvcFN0YXRlSW5Qcm9ncmVzcykgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNwdXNoT3JSZXBsYWNlU3RhdGUoewogICAgICBkZXN0OiBudWxsLAogICAgICBoYXNoOiBgcGFnZT0ke3BhZ2VOdW1iZXJ9YCwKICAgICAgcGFnZTogcGFnZU51bWJlciwKICAgICAgcm90YXRpb246IHRoaXMubGlua1NlcnZpY2Uucm90YXRpb24KICAgIH0pOwogICAgaWYgKCF0aGlzLl9wb3BTdGF0ZUluUHJvZ3Jlc3MpIHsKICAgICAgdGhpcy5fcG9wU3RhdGVJblByb2dyZXNzID0gdHJ1ZTsKICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB7CiAgICAgICAgdGhpcy5fcG9wU3RhdGVJblByb2dyZXNzID0gZmFsc2U7CiAgICAgIH0pOwogICAgfQogIH0KICBwdXNoQ3VycmVudFBvc2l0aW9uKCkgewogICAgaWYgKCF0aGlzLl9pbml0aWFsaXplZCB8fCB0aGlzLl9wb3BTdGF0ZUluUHJvZ3Jlc3MpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jdHJ5UHVzaEN1cnJlbnRQb3NpdGlvbigpOwogIH0KICBiYWNrKCkgewogICAgaWYgKCF0aGlzLl9pbml0aWFsaXplZCB8fCB0aGlzLl9wb3BTdGF0ZUluUHJvZ3Jlc3MpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc3RhdGUgPSB3aW5kb3cuaGlzdG9yeS5zdGF0ZTsKICAgIGlmICh0aGlzLiNpc1ZhbGlkU3RhdGUoc3RhdGUpICYmIHN0YXRlLnVpZCA+IDApIHsKICAgICAgd2luZG93Lmhpc3RvcnkuYmFjaygpOwogICAgfQogIH0KICBmb3J3YXJkKCkgewogICAgaWYgKCF0aGlzLl9pbml0aWFsaXplZCB8fCB0aGlzLl9wb3BTdGF0ZUluUHJvZ3Jlc3MpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc3RhdGUgPSB3aW5kb3cuaGlzdG9yeS5zdGF0ZTsKICAgIGlmICh0aGlzLiNpc1ZhbGlkU3RhdGUoc3RhdGUpICYmIHN0YXRlLnVpZCA8IHRoaXMuX21heFVpZCkgewogICAgICB3aW5kb3cuaGlzdG9yeS5mb3J3YXJkKCk7CiAgICB9CiAgfQogIGdldCBwb3BTdGF0ZUluUHJvZ3Jlc3MoKSB7CiAgICByZXR1cm4gdGhpcy5faW5pdGlhbGl6ZWQgJiYgKHRoaXMuX3BvcFN0YXRlSW5Qcm9ncmVzcyB8fCB0aGlzLl9ibG9ja0hhc2hDaGFuZ2UgPiAwKTsKICB9CiAgZ2V0IGluaXRpYWxCb29rbWFyaygpIHsKICAgIHJldHVybiB0aGlzLl9pbml0aWFsaXplZCA/IHRoaXMuX2luaXRpYWxCb29rbWFyayA6IG51bGw7CiAgfQogIGdldCBpbml0aWFsUm90YXRpb24oKSB7CiAgICByZXR1cm4gdGhpcy5faW5pdGlhbGl6ZWQgPyB0aGlzLl9pbml0aWFsUm90YXRpb24gOiBudWxsOwogIH0KICAjcHVzaE9yUmVwbGFjZVN0YXRlKGRlc3RpbmF0aW9uLCBmb3JjZVJlcGxhY2UgPSBmYWxzZSkgewogICAgY29uc3Qgc2hvdWxkUmVwbGFjZSA9IGZvcmNlUmVwbGFjZSB8fCAhdGhpcy5fZGVzdGluYXRpb247CiAgICBjb25zdCBuZXdTdGF0ZSA9IHsKICAgICAgZmluZ2VycHJpbnQ6IHRoaXMuX2ZpbmdlcnByaW50LAogICAgICB1aWQ6IHNob3VsZFJlcGxhY2UgPyB0aGlzLl91aWQgOiB0aGlzLl91aWQgKyAxLAogICAgICBkZXN0aW5hdGlvbgogICAgfTsKICAgIHRoaXMuI3VwZGF0ZUludGVybmFsU3RhdGUoZGVzdGluYXRpb24sIG5ld1N0YXRlLnVpZCk7CiAgICBsZXQgbmV3VXJsOwogICAgaWYgKHRoaXMuX3VwZGF0ZVVybCAmJiBkZXN0aW5hdGlvbj8uaGFzaCkgewogICAgICBjb25zdCB7CiAgICAgICAgaHJlZiwKICAgICAgICBwcm90b2NvbAogICAgICB9ID0gZG9jdW1lbnQubG9jYXRpb247CiAgICAgIGlmIChwcm90b2NvbCAhPT0gImZpbGU6IikgewogICAgICAgIG5ld1VybCA9IHVwZGF0ZVVybEhhc2goaHJlZiwgZGVzdGluYXRpb24uaGFzaCk7CiAgICAgIH0KICAgIH0KICAgIGlmIChzaG91bGRSZXBsYWNlKSB7CiAgICAgIHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZShuZXdTdGF0ZSwgIiIsIG5ld1VybCk7CiAgICB9IGVsc2UgewogICAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUobmV3U3RhdGUsICIiLCBuZXdVcmwpOwogICAgfQogIH0KICAjdHJ5UHVzaEN1cnJlbnRQb3NpdGlvbih0ZW1wb3JhcnkgPSBmYWxzZSkgewogICAgaWYgKCF0aGlzLl9wb3NpdGlvbikgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgcG9zaXRpb24gPSB0aGlzLl9wb3NpdGlvbjsKICAgIGlmICh0ZW1wb3JhcnkpIHsKICAgICAgcG9zaXRpb24gPSBPYmplY3QuYXNzaWduKE9iamVjdC5jcmVhdGUobnVsbCksIHRoaXMuX3Bvc2l0aW9uKTsKICAgICAgcG9zaXRpb24udGVtcG9yYXJ5ID0gdHJ1ZTsKICAgIH0KICAgIGlmICghdGhpcy5fZGVzdGluYXRpb24pIHsKICAgICAgdGhpcy4jcHVzaE9yUmVwbGFjZVN0YXRlKHBvc2l0aW9uKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX2Rlc3RpbmF0aW9uLnRlbXBvcmFyeSkgewogICAgICB0aGlzLiNwdXNoT3JSZXBsYWNlU3RhdGUocG9zaXRpb24sIHRydWUpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5fZGVzdGluYXRpb24uaGFzaCA9PT0gcG9zaXRpb24uaGFzaCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXMuX2Rlc3RpbmF0aW9uLnBhZ2UgJiYgKFBPU0lUSU9OX1VQREFURURfVEhSRVNIT0xEIDw9IDAgfHwgdGhpcy5fbnVtUG9zaXRpb25VcGRhdGVzIDw9IFBPU0lUSU9OX1VQREFURURfVEhSRVNIT0xEKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgZm9yY2VSZXBsYWNlID0gZmFsc2U7CiAgICBpZiAodGhpcy5fZGVzdGluYXRpb24ucGFnZSA+PSBwb3NpdGlvbi5maXJzdCAmJiB0aGlzLl9kZXN0aW5hdGlvbi5wYWdlIDw9IHBvc2l0aW9uLnBhZ2UpIHsKICAgICAgaWYgKHRoaXMuX2Rlc3RpbmF0aW9uLmRlc3QgIT09IHVuZGVmaW5lZCB8fCAhdGhpcy5fZGVzdGluYXRpb24uZmlyc3QpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yY2VSZXBsYWNlID0gdHJ1ZTsKICAgIH0KICAgIHRoaXMuI3B1c2hPclJlcGxhY2VTdGF0ZShwb3NpdGlvbiwgZm9yY2VSZXBsYWNlKTsKICB9CiAgI2lzVmFsaWRQYWdlKHZhbCkgewogICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIodmFsKSAmJiB2YWwgPiAwICYmIHZhbCA8PSB0aGlzLmxpbmtTZXJ2aWNlLnBhZ2VzQ291bnQ7CiAgfQogICNpc1ZhbGlkU3RhdGUoc3RhdGUsIGNoZWNrUmVsb2FkID0gZmFsc2UpIHsKICAgIGlmICghc3RhdGUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHN0YXRlLmZpbmdlcnByaW50ICE9PSB0aGlzLl9maW5nZXJwcmludCkgewogICAgICBpZiAoY2hlY2tSZWxvYWQpIHsKICAgICAgICBpZiAodHlwZW9mIHN0YXRlLmZpbmdlcnByaW50ICE9PSAic3RyaW5nIiB8fCBzdGF0ZS5maW5nZXJwcmludC5sZW5ndGggIT09IHRoaXMuX2ZpbmdlcnByaW50Lmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBjb25zdCBbcGVyZkVudHJ5XSA9IHBlcmZvcm1hbmNlLmdldEVudHJpZXNCeVR5cGUoIm5hdmlnYXRpb24iKTsKICAgICAgICBpZiAocGVyZkVudHJ5Py50eXBlICE9PSAicmVsb2FkIikgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihzdGF0ZS51aWQpIHx8IHN0YXRlLnVpZCA8IDApIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHN0YXRlLmRlc3RpbmF0aW9uID09PSBudWxsIHx8IHR5cGVvZiBzdGF0ZS5kZXN0aW5hdGlvbiAhPT0gIm9iamVjdCIpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogICN1cGRhdGVJbnRlcm5hbFN0YXRlKGRlc3RpbmF0aW9uLCB1aWQsIHJlbW92ZVRlbXBvcmFyeSA9IGZhbHNlKSB7CiAgICBpZiAodGhpcy5fdXBkYXRlVmlld2FyZWFUaW1lb3V0KSB7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLl91cGRhdGVWaWV3YXJlYVRpbWVvdXQpOwogICAgICB0aGlzLl91cGRhdGVWaWV3YXJlYVRpbWVvdXQgPSBudWxsOwogICAgfQogICAgaWYgKHJlbW92ZVRlbXBvcmFyeSAmJiBkZXN0aW5hdGlvbj8udGVtcG9yYXJ5KSB7CiAgICAgIGRlbGV0ZSBkZXN0aW5hdGlvbi50ZW1wb3Jhcnk7CiAgICB9CiAgICB0aGlzLl9kZXN0aW5hdGlvbiA9IGRlc3RpbmF0aW9uOwogICAgdGhpcy5fdWlkID0gdWlkOwogICAgdGhpcy5fbWF4VWlkID0gTWF0aC5tYXgodGhpcy5fbWF4VWlkLCB1aWQpOwogICAgdGhpcy5fbnVtUG9zaXRpb25VcGRhdGVzID0gMDsKICB9CiAgI3BhcnNlQ3VycmVudEhhc2goY2hlY2tOYW1lZGRlc3QgPSBmYWxzZSkgewogICAgY29uc3QgaGFzaCA9IHVuZXNjYXBlKGdldEN1cnJlbnRIYXNoKCkpLnN1YnN0cmluZygxKTsKICAgIGNvbnN0IHBhcmFtcyA9IHBhcnNlUXVlcnlTdHJpbmcoaGFzaCk7CiAgICBjb25zdCBuYW1lZGRlc3QgPSBwYXJhbXMuZ2V0KCJuYW1lZGRlc3QiKSB8fCAiIjsKICAgIGxldCBwYWdlID0gcGFyYW1zLmdldCgicGFnZSIpIHwgMDsKICAgIGlmICghdGhpcy4jaXNWYWxpZFBhZ2UocGFnZSkgfHwgY2hlY2tOYW1lZGRlc3QgJiYgbmFtZWRkZXN0Lmxlbmd0aCA+IDApIHsKICAgICAgcGFnZSA9IG51bGw7CiAgICB9CiAgICByZXR1cm4gewogICAgICBoYXNoLAogICAgICBwYWdlLAogICAgICByb3RhdGlvbjogdGhpcy5saW5rU2VydmljZS5yb3RhdGlvbgogICAgfTsKICB9CiAgI3VwZGF0ZVZpZXdhcmVhKHsKICAgIGxvY2F0aW9uCiAgfSkgewogICAgaWYgKHRoaXMuX3VwZGF0ZVZpZXdhcmVhVGltZW91dCkgewogICAgICBjbGVhclRpbWVvdXQodGhpcy5fdXBkYXRlVmlld2FyZWFUaW1lb3V0KTsKICAgICAgdGhpcy5fdXBkYXRlVmlld2FyZWFUaW1lb3V0ID0gbnVsbDsKICAgIH0KICAgIHRoaXMuX3Bvc2l0aW9uID0gewogICAgICBoYXNoOiBsb2NhdGlvbi5wZGZPcGVuUGFyYW1zLnN1YnN0cmluZygxKSwKICAgICAgcGFnZTogdGhpcy5saW5rU2VydmljZS5wYWdlLAogICAgICBmaXJzdDogbG9jYXRpb24ucGFnZU51bWJlciwKICAgICAgcm90YXRpb246IGxvY2F0aW9uLnJvdGF0aW9uCiAgICB9OwogICAgaWYgKHRoaXMuX3BvcFN0YXRlSW5Qcm9ncmVzcykgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoUE9TSVRJT05fVVBEQVRFRF9USFJFU0hPTEQgPiAwICYmIHRoaXMuX2lzUGFnZXNMb2FkZWQgJiYgdGhpcy5fZGVzdGluYXRpb24gJiYgIXRoaXMuX2Rlc3RpbmF0aW9uLnBhZ2UpIHsKICAgICAgdGhpcy5fbnVtUG9zaXRpb25VcGRhdGVzKys7CiAgICB9CiAgICBpZiAoVVBEQVRFX1ZJRVdBUkVBX1RJTUVPVVQgPiAwKSB7CiAgICAgIHRoaXMuX3VwZGF0ZVZpZXdhcmVhVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGlmICghdGhpcy5fcG9wU3RhdGVJblByb2dyZXNzKSB7CiAgICAgICAgICB0aGlzLiN0cnlQdXNoQ3VycmVudFBvc2l0aW9uKHRydWUpOwogICAgICAgIH0KICAgICAgICB0aGlzLl91cGRhdGVWaWV3YXJlYVRpbWVvdXQgPSBudWxsOwogICAgICB9LCBVUERBVEVfVklFV0FSRUFfVElNRU9VVCk7CiAgICB9CiAgfQogICNwb3BTdGF0ZSh7CiAgICBzdGF0ZQogIH0pIHsKICAgIGNvbnN0IG5ld0hhc2ggPSBnZXRDdXJyZW50SGFzaCgpLAogICAgICBoYXNoQ2hhbmdlZCA9IHRoaXMuX2N1cnJlbnRIYXNoICE9PSBuZXdIYXNoOwogICAgdGhpcy5fY3VycmVudEhhc2ggPSBuZXdIYXNoOwogICAgaWYgKCFzdGF0ZSkgewogICAgICB0aGlzLl91aWQrKzsKICAgICAgY29uc3QgewogICAgICAgIGhhc2gsCiAgICAgICAgcGFnZSwKICAgICAgICByb3RhdGlvbgogICAgICB9ID0gdGhpcy4jcGFyc2VDdXJyZW50SGFzaCgpOwogICAgICB0aGlzLiNwdXNoT3JSZXBsYWNlU3RhdGUoewogICAgICAgIGhhc2gsCiAgICAgICAgcGFnZSwKICAgICAgICByb3RhdGlvbgogICAgICB9LCB0cnVlKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzLiNpc1ZhbGlkU3RhdGUoc3RhdGUpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX3BvcFN0YXRlSW5Qcm9ncmVzcyA9IHRydWU7CiAgICBpZiAoaGFzaENoYW5nZWQpIHsKICAgICAgdGhpcy5fYmxvY2tIYXNoQ2hhbmdlKys7CiAgICAgIHdhaXRPbkV2ZW50T3JUaW1lb3V0KHsKICAgICAgICB0YXJnZXQ6IHdpbmRvdywKICAgICAgICBuYW1lOiAiaGFzaGNoYW5nZSIsCiAgICAgICAgZGVsYXk6IEhBU0hfQ0hBTkdFX1RJTUVPVVQKICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgdGhpcy5fYmxvY2tIYXNoQ2hhbmdlLS07CiAgICAgIH0pOwogICAgfQogICAgY29uc3QgZGVzdGluYXRpb24gPSBzdGF0ZS5kZXN0aW5hdGlvbjsKICAgIHRoaXMuI3VwZGF0ZUludGVybmFsU3RhdGUoZGVzdGluYXRpb24sIHN0YXRlLnVpZCwgdHJ1ZSk7CiAgICBpZiAoaXNWYWxpZFJvdGF0aW9uKGRlc3RpbmF0aW9uLnJvdGF0aW9uKSkgewogICAgICB0aGlzLmxpbmtTZXJ2aWNlLnJvdGF0aW9uID0gZGVzdGluYXRpb24ucm90YXRpb247CiAgICB9CiAgICBpZiAoZGVzdGluYXRpb24uZGVzdCkgewogICAgICB0aGlzLmxpbmtTZXJ2aWNlLmdvVG9EZXN0aW5hdGlvbihkZXN0aW5hdGlvbi5kZXN0KTsKICAgIH0gZWxzZSBpZiAoZGVzdGluYXRpb24uaGFzaCkgewogICAgICB0aGlzLmxpbmtTZXJ2aWNlLnNldEhhc2goZGVzdGluYXRpb24uaGFzaCk7CiAgICB9IGVsc2UgaWYgKGRlc3RpbmF0aW9uLnBhZ2UpIHsKICAgICAgdGhpcy5saW5rU2VydmljZS5wYWdlID0gZGVzdGluYXRpb24ucGFnZTsKICAgIH0KICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKCkgPT4gewogICAgICB0aGlzLl9wb3BTdGF0ZUluUHJvZ3Jlc3MgPSBmYWxzZTsKICAgIH0pOwogIH0KICAjcGFnZUhpZGUoKSB7CiAgICBpZiAoIXRoaXMuX2Rlc3RpbmF0aW9uIHx8IHRoaXMuX2Rlc3RpbmF0aW9uLnRlbXBvcmFyeSkgewogICAgICB0aGlzLiN0cnlQdXNoQ3VycmVudFBvc2l0aW9uKCk7CiAgICB9CiAgfQogICNiaW5kRXZlbnRzKCkgewogICAgaWYgKHRoaXMuI2V2ZW50QWJvcnRDb250cm9sbGVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2V2ZW50QWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgY29uc3QgewogICAgICBzaWduYWwKICAgIH0gPSB0aGlzLiNldmVudEFib3J0Q29udHJvbGxlcjsKICAgIHRoaXMuZXZlbnRCdXMuX29uKCJ1cGRhdGV2aWV3YXJlYSIsIHRoaXMuI3VwZGF0ZVZpZXdhcmVhLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb3BzdGF0ZSIsIHRoaXMuI3BvcFN0YXRlLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwYWdlaGlkZSIsIHRoaXMuI3BhZ2VIaWRlLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICB9CiAgI3VuYmluZEV2ZW50cygpIHsKICAgIHRoaXMuI2V2ZW50QWJvcnRDb250cm9sbGVyPy5hYm9ydCgpOwogICAgdGhpcy4jZXZlbnRBYm9ydENvbnRyb2xsZXIgPSBudWxsOwogIH0KfQpmdW5jdGlvbiBpc0Rlc3RIYXNoZXNFcXVhbChkZXN0SGFzaCwgcHVzaEhhc2gpIHsKICBpZiAodHlwZW9mIGRlc3RIYXNoICE9PSAic3RyaW5nIiB8fCB0eXBlb2YgcHVzaEhhc2ggIT09ICJzdHJpbmciKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmIChkZXN0SGFzaCA9PT0gcHVzaEhhc2gpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBjb25zdCBuYW1lZGRlc3QgPSBwYXJzZVF1ZXJ5U3RyaW5nKGRlc3RIYXNoKS5nZXQoIm5hbWVkZGVzdCIpOwogIGlmIChuYW1lZGRlc3QgPT09IHB1c2hIYXNoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIGlzRGVzdEFycmF5c0VxdWFsKGZpcnN0RGVzdCwgc2Vjb25kRGVzdCkgewogIGZ1bmN0aW9uIGlzRW50cnlFcXVhbChmaXJzdCwgc2Vjb25kKSB7CiAgICBpZiAodHlwZW9mIGZpcnN0ICE9PSB0eXBlb2Ygc2Vjb25kKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KGZpcnN0KSB8fCBBcnJheS5pc0FycmF5KHNlY29uZCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKGZpcnN0ICE9PSBudWxsICYmIHR5cGVvZiBmaXJzdCA9PT0gIm9iamVjdCIgJiYgc2Vjb25kICE9PSBudWxsKSB7CiAgICAgIGlmIChPYmplY3Qua2V5cyhmaXJzdCkubGVuZ3RoICE9PSBPYmplY3Qua2V5cyhzZWNvbmQpLmxlbmd0aCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IGtleSBpbiBmaXJzdCkgewogICAgICAgIGlmICghaXNFbnRyeUVxdWFsKGZpcnN0W2tleV0sIHNlY29uZFtrZXldKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmaXJzdCA9PT0gc2Vjb25kIHx8IE51bWJlci5pc05hTihmaXJzdCkgJiYgTnVtYmVyLmlzTmFOKHNlY29uZCk7CiAgfQogIGlmICghKEFycmF5LmlzQXJyYXkoZmlyc3REZXN0KSAmJiBBcnJheS5pc0FycmF5KHNlY29uZERlc3QpKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAoZmlyc3REZXN0Lmxlbmd0aCAhPT0gc2Vjb25kRGVzdC5sZW5ndGgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gZmlyc3REZXN0Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGlmICghaXNFbnRyeUVxdWFsKGZpcnN0RGVzdFtpXSwgc2Vjb25kRGVzdFtpXSkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQoKOy8vIC4vd2ViL3BkZl9sYXllcl92aWV3ZXIuanMKCmNsYXNzIFBERkxheWVyVmlld2VyIGV4dGVuZHMgQmFzZVRyZWVWaWV3ZXIgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHN1cGVyKG9wdGlvbnMpOwogICAgdGhpcy5ldmVudEJ1cy5fb24oIm9wdGlvbmFsY29udGVudGNvbmZpZ2NoYW5nZWQiLCBldnQgPT4gewogICAgICB0aGlzLiN1cGRhdGVMYXllcnMoZXZ0LnByb21pc2UpOwogICAgfSk7CiAgICB0aGlzLmV2ZW50QnVzLl9vbigicmVzZXRsYXllcnMiLCAoKSA9PiB7CiAgICAgIHRoaXMuI3VwZGF0ZUxheWVycygpOwogICAgfSk7CiAgICB0aGlzLmV2ZW50QnVzLl9vbigidG9nZ2xlbGF5ZXJzdHJlZSIsIHRoaXMuX3RvZ2dsZUFsbFRyZWVJdGVtcy5iaW5kKHRoaXMpKTsKICB9CiAgcmVzZXQoKSB7CiAgICBzdXBlci5yZXNldCgpOwogICAgdGhpcy5fb3B0aW9uYWxDb250ZW50Q29uZmlnID0gbnVsbDsKICAgIHRoaXMuX29wdGlvbmFsQ29udGVudFZpc2liaWxpdHk/LmNsZWFyKCk7CiAgICB0aGlzLl9vcHRpb25hbENvbnRlbnRWaXNpYmlsaXR5ID0gbnVsbDsKICB9CiAgX2Rpc3BhdGNoRXZlbnQobGF5ZXJzQ291bnQpIHsKICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goImxheWVyc2xvYWRlZCIsIHsKICAgICAgc291cmNlOiB0aGlzLAogICAgICBsYXllcnNDb3VudAogICAgfSk7CiAgfQogIF9iaW5kTGluayhlbGVtZW50LCB7CiAgICBncm91cElkLAogICAgaW5wdXQKICB9KSB7CiAgICBjb25zdCBzZXRWaXNpYmlsaXR5ID0gKCkgPT4gewogICAgICBjb25zdCB2aXNpYmxlID0gaW5wdXQuY2hlY2tlZDsKICAgICAgdGhpcy5fb3B0aW9uYWxDb250ZW50Q29uZmlnLnNldFZpc2liaWxpdHkoZ3JvdXBJZCwgdmlzaWJsZSk7CiAgICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMuX29wdGlvbmFsQ29udGVudFZpc2liaWxpdHkuZ2V0KGdyb3VwSWQpOwogICAgICBpZiAoY2FjaGVkKSB7CiAgICAgICAgY2FjaGVkLnZpc2libGUgPSB2aXNpYmxlOwogICAgICB9CiAgICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goIm9wdGlvbmFsY29udGVudGNvbmZpZyIsIHsKICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgcHJvbWlzZTogUHJvbWlzZS5yZXNvbHZlKHRoaXMuX29wdGlvbmFsQ29udGVudENvbmZpZykKICAgICAgfSk7CiAgICB9OwogICAgZWxlbWVudC5vbmNsaWNrID0gZXZ0ID0+IHsKICAgICAgaWYgKGV2dC50YXJnZXQgPT09IGlucHV0KSB7CiAgICAgICAgc2V0VmlzaWJpbGl0eSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgaWYgKGV2dC50YXJnZXQgIT09IGVsZW1lbnQpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpbnB1dC5jaGVja2VkID0gIWlucHV0LmNoZWNrZWQ7CiAgICAgIHNldFZpc2liaWxpdHkoKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKICB9CiAgX3NldE5lc3RlZE5hbWUoZWxlbWVudCwgewogICAgbmFtZSA9IG51bGwKICB9KSB7CiAgICBpZiAodHlwZW9mIG5hbWUgPT09ICJzdHJpbmciKSB7CiAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSB0aGlzLl9ub3JtYWxpemVUZXh0Q29udGVudChuYW1lKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsICJwZGZqcy1hZGRpdGlvbmFsLWxheWVycyIpOwogICAgZWxlbWVudC5zdHlsZS5mb250U3R5bGUgPSAiaXRhbGljIjsKICAgIHRoaXMuX2wxMG4udHJhbnNsYXRlT25jZShlbGVtZW50KTsKICB9CiAgX2FkZFRvZ2dsZUJ1dHRvbihkaXYsIHsKICAgIG5hbWUgPSBudWxsCiAgfSkgewogICAgc3VwZXIuX2FkZFRvZ2dsZUJ1dHRvbihkaXYsIG5hbWUgPT09IG51bGwpOwogIH0KICBfdG9nZ2xlQWxsVHJlZUl0ZW1zKCkgewogICAgaWYgKCF0aGlzLl9vcHRpb25hbENvbnRlbnRDb25maWcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3VwZXIuX3RvZ2dsZUFsbFRyZWVJdGVtcygpOwogIH0KICByZW5kZXIoewogICAgb3B0aW9uYWxDb250ZW50Q29uZmlnLAogICAgcGRmRG9jdW1lbnQKICB9KSB7CiAgICBpZiAodGhpcy5fb3B0aW9uYWxDb250ZW50Q29uZmlnKSB7CiAgICAgIHRoaXMucmVzZXQoKTsKICAgIH0KICAgIHRoaXMuX29wdGlvbmFsQ29udGVudENvbmZpZyA9IG9wdGlvbmFsQ29udGVudENvbmZpZyB8fCBudWxsOwogICAgdGhpcy5fcGRmRG9jdW1lbnQgPSBwZGZEb2N1bWVudCB8fCBudWxsOwogICAgY29uc3QgZ3JvdXBzID0gb3B0aW9uYWxDb250ZW50Q29uZmlnPy5nZXRPcmRlcigpOwogICAgaWYgKCFncm91cHMpIHsKICAgICAgdGhpcy5fZGlzcGF0Y2hFdmVudCgwKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fb3B0aW9uYWxDb250ZW50VmlzaWJpbGl0eSA9IG5ldyBNYXAoKTsKICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAogICAgICBxdWV1ZSA9IFt7CiAgICAgICAgcGFyZW50OiBmcmFnbWVudCwKICAgICAgICBncm91cHMKICAgICAgfV07CiAgICBsZXQgbGF5ZXJzQ291bnQgPSAwLAogICAgICBoYXNBbnlOZXN0aW5nID0gZmFsc2U7CiAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBsZXZlbERhdGEgPSBxdWV1ZS5zaGlmdCgpOwogICAgICBmb3IgKGNvbnN0IGdyb3VwSWQgb2YgbGV2ZWxEYXRhLmdyb3VwcykgewogICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIGRpdi5jbGFzc05hbWUgPSAidHJlZUl0ZW0iOwogICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgZGl2LmFwcGVuZChlbGVtZW50KTsKICAgICAgICBpZiAodHlwZW9mIGdyb3VwSWQgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICBoYXNBbnlOZXN0aW5nID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuX2FkZFRvZ2dsZUJ1dHRvbihkaXYsIGdyb3VwSWQpOwogICAgICAgICAgdGhpcy5fc2V0TmVzdGVkTmFtZShlbGVtZW50LCBncm91cElkKTsKICAgICAgICAgIGNvbnN0IGl0ZW1zRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICBpdGVtc0Rpdi5jbGFzc05hbWUgPSAidHJlZUl0ZW1zIjsKICAgICAgICAgIGRpdi5hcHBlbmQoaXRlbXNEaXYpOwogICAgICAgICAgcXVldWUucHVzaCh7CiAgICAgICAgICAgIHBhcmVudDogaXRlbXNEaXYsCiAgICAgICAgICAgIGdyb3VwczogZ3JvdXBJZC5vcmRlcgogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGdyb3VwID0gb3B0aW9uYWxDb250ZW50Q29uZmlnLmdldEdyb3VwKGdyb3VwSWQpOwogICAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgICAgICAgdGhpcy5fYmluZExpbmsoZWxlbWVudCwgewogICAgICAgICAgICBncm91cElkLAogICAgICAgICAgICBpbnB1dAogICAgICAgICAgfSk7CiAgICAgICAgICBpbnB1dC50eXBlID0gImNoZWNrYm94IjsKICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBncm91cC52aXNpYmxlOwogICAgICAgICAgdGhpcy5fb3B0aW9uYWxDb250ZW50VmlzaWJpbGl0eS5zZXQoZ3JvdXBJZCwgewogICAgICAgICAgICBpbnB1dCwKICAgICAgICAgICAgdmlzaWJsZTogaW5wdXQuY2hlY2tlZAogICAgICAgICAgfSk7CiAgICAgICAgICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CiAgICAgICAgICBsYWJlbC50ZXh0Q29udGVudCA9IHRoaXMuX25vcm1hbGl6ZVRleHRDb250ZW50KGdyb3VwLm5hbWUpOwogICAgICAgICAgbGFiZWwuYXBwZW5kKGlucHV0KTsKICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKGxhYmVsKTsKICAgICAgICAgIGxheWVyc0NvdW50Kys7CiAgICAgICAgfQogICAgICAgIGxldmVsRGF0YS5wYXJlbnQuYXBwZW5kKGRpdik7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuX2ZpbmlzaFJlbmRlcmluZyhmcmFnbWVudCwgbGF5ZXJzQ291bnQsIGhhc0FueU5lc3RpbmcpOwogIH0KICBhc3luYyAjdXBkYXRlTGF5ZXJzKHByb21pc2UgPSBudWxsKSB7CiAgICBpZiAoIXRoaXMuX29wdGlvbmFsQ29udGVudENvbmZpZykgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwZGZEb2N1bWVudCA9IHRoaXMuX3BkZkRvY3VtZW50OwogICAgY29uc3Qgb3B0aW9uYWxDb250ZW50Q29uZmlnID0gYXdhaXQgKHByb21pc2UgfHwgcGRmRG9jdW1lbnQuZ2V0T3B0aW9uYWxDb250ZW50Q29uZmlnKHsKICAgICAgaW50ZW50OiAiZGlzcGxheSIKICAgIH0pKTsKICAgIGlmIChwZGZEb2N1bWVudCAhPT0gdGhpcy5fcGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHByb21pc2UpIHsKICAgICAgZm9yIChjb25zdCBbZ3JvdXBJZCwgY2FjaGVkXSBvZiB0aGlzLl9vcHRpb25hbENvbnRlbnRWaXNpYmlsaXR5KSB7CiAgICAgICAgY29uc3QgZ3JvdXAgPSBvcHRpb25hbENvbnRlbnRDb25maWcuZ2V0R3JvdXAoZ3JvdXBJZCk7CiAgICAgICAgaWYgKGdyb3VwICYmIGNhY2hlZC52aXNpYmxlICE9PSBncm91cC52aXNpYmxlKSB7CiAgICAgICAgICBjYWNoZWQuaW5wdXQuY2hlY2tlZCA9IGNhY2hlZC52aXNpYmxlID0gIWNhY2hlZC52aXNpYmxlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJvcHRpb25hbGNvbnRlbnRjb25maWciLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgcHJvbWlzZTogUHJvbWlzZS5yZXNvbHZlKG9wdGlvbmFsQ29udGVudENvbmZpZykKICAgIH0pOwogICAgdGhpcy5yZW5kZXIoewogICAgICBvcHRpb25hbENvbnRlbnRDb25maWcsCiAgICAgIHBkZkRvY3VtZW50OiB0aGlzLl9wZGZEb2N1bWVudAogICAgfSk7CiAgfQp9Cgo7Ly8gLi93ZWIvcGRmX291dGxpbmVfdmlld2VyLmpzCgoKY2xhc3MgUERGT3V0bGluZVZpZXdlciBleHRlbmRzIEJhc2VUcmVlVmlld2VyIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICBzdXBlcihvcHRpb25zKTsKICAgIHRoaXMubGlua1NlcnZpY2UgPSBvcHRpb25zLmxpbmtTZXJ2aWNlOwogICAgdGhpcy5kb3dubG9hZE1hbmFnZXIgPSBvcHRpb25zLmRvd25sb2FkTWFuYWdlcjsKICAgIHRoaXMuZXZlbnRCdXMuX29uKCJ0b2dnbGVvdXRsaW5ldHJlZSIsIHRoaXMuX3RvZ2dsZUFsbFRyZWVJdGVtcy5iaW5kKHRoaXMpKTsKICAgIHRoaXMuZXZlbnRCdXMuX29uKCJjdXJyZW50b3V0bGluZWl0ZW0iLCB0aGlzLl9jdXJyZW50T3V0bGluZUl0ZW0uYmluZCh0aGlzKSk7CiAgICB0aGlzLmV2ZW50QnVzLl9vbigicGFnZWNoYW5naW5nIiwgZXZ0ID0+IHsKICAgICAgdGhpcy5fY3VycmVudFBhZ2VOdW1iZXIgPSBldnQucGFnZU51bWJlcjsKICAgIH0pOwogICAgdGhpcy5ldmVudEJ1cy5fb24oInBhZ2VzbG9hZGVkIiwgZXZ0ID0+IHsKICAgICAgdGhpcy5faXNQYWdlc0xvYWRlZCA9ICEhZXZ0LnBhZ2VzQ291bnQ7CiAgICAgIHRoaXMuX2N1cnJlbnRPdXRsaW5lSXRlbUNhcGFiaWxpdHk/LnJlc29sdmUodGhpcy5faXNQYWdlc0xvYWRlZCk7CiAgICB9KTsKICAgIHRoaXMuZXZlbnRCdXMuX29uKCJzaWRlYmFydmlld2NoYW5nZWQiLCBldnQgPT4gewogICAgICB0aGlzLl9zaWRlYmFyVmlldyA9IGV2dC52aWV3OwogICAgfSk7CiAgfQogIHJlc2V0KCkgewogICAgc3VwZXIucmVzZXQoKTsKICAgIHRoaXMuX291dGxpbmUgPSBudWxsOwogICAgdGhpcy5fcGFnZU51bWJlclRvRGVzdEhhc2hDYXBhYmlsaXR5ID0gbnVsbDsKICAgIHRoaXMuX2N1cnJlbnRQYWdlTnVtYmVyID0gMTsKICAgIHRoaXMuX2lzUGFnZXNMb2FkZWQgPSBudWxsOwogICAgdGhpcy5fY3VycmVudE91dGxpbmVJdGVtQ2FwYWJpbGl0eT8ucmVzb2x2ZShmYWxzZSk7CiAgICB0aGlzLl9jdXJyZW50T3V0bGluZUl0ZW1DYXBhYmlsaXR5ID0gbnVsbDsKICB9CiAgX2Rpc3BhdGNoRXZlbnQob3V0bGluZUNvdW50KSB7CiAgICB0aGlzLl9jdXJyZW50T3V0bGluZUl0ZW1DYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICBpZiAob3V0bGluZUNvdW50ID09PSAwIHx8IHRoaXMuX3BkZkRvY3VtZW50Py5sb2FkaW5nUGFyYW1zLmRpc2FibGVBdXRvRmV0Y2gpIHsKICAgICAgdGhpcy5fY3VycmVudE91dGxpbmVJdGVtQ2FwYWJpbGl0eS5yZXNvbHZlKGZhbHNlKTsKICAgIH0gZWxzZSBpZiAodGhpcy5faXNQYWdlc0xvYWRlZCAhPT0gbnVsbCkgewogICAgICB0aGlzLl9jdXJyZW50T3V0bGluZUl0ZW1DYXBhYmlsaXR5LnJlc29sdmUodGhpcy5faXNQYWdlc0xvYWRlZCk7CiAgICB9CiAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJvdXRsaW5lbG9hZGVkIiwgewogICAgICBzb3VyY2U6IHRoaXMsCiAgICAgIG91dGxpbmVDb3VudCwKICAgICAgY3VycmVudE91dGxpbmVJdGVtUHJvbWlzZTogdGhpcy5fY3VycmVudE91dGxpbmVJdGVtQ2FwYWJpbGl0eS5wcm9taXNlCiAgICB9KTsKICB9CiAgX2JpbmRMaW5rKGVsZW1lbnQsIHsKICAgIHVybCwKICAgIG5ld1dpbmRvdywKICAgIGFjdGlvbiwKICAgIGF0dGFjaG1lbnQsCiAgICBkZXN0LAogICAgc2V0T0NHU3RhdGUKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIGxpbmtTZXJ2aWNlCiAgICB9ID0gdGhpczsKICAgIGlmICh1cmwpIHsKICAgICAgbGlua1NlcnZpY2UuYWRkTGlua0F0dHJpYnV0ZXMoZWxlbWVudCwgdXJsLCBuZXdXaW5kb3cpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoYWN0aW9uKSB7CiAgICAgIGVsZW1lbnQuaHJlZiA9IGxpbmtTZXJ2aWNlLmdldEFuY2hvclVybCgiIik7CiAgICAgIGVsZW1lbnQub25jbGljayA9ICgpID0+IHsKICAgICAgICBsaW5rU2VydmljZS5leGVjdXRlTmFtZWRBY3Rpb24oYWN0aW9uKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChhdHRhY2htZW50KSB7CiAgICAgIGVsZW1lbnQuaHJlZiA9IGxpbmtTZXJ2aWNlLmdldEFuY2hvclVybCgiIik7CiAgICAgIGVsZW1lbnQub25jbGljayA9ICgpID0+IHsKICAgICAgICB0aGlzLmRvd25sb2FkTWFuYWdlci5vcGVuT3JEb3dubG9hZERhdGEoYXR0YWNobWVudC5jb250ZW50LCBhdHRhY2htZW50LmZpbGVuYW1lKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChzZXRPQ0dTdGF0ZSkgewogICAgICBlbGVtZW50LmhyZWYgPSBsaW5rU2VydmljZS5nZXRBbmNob3JVcmwoIiIpOwogICAgICBlbGVtZW50Lm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgbGlua1NlcnZpY2UuZXhlY3V0ZVNldE9DR1N0YXRlKHNldE9DR1N0YXRlKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGVsZW1lbnQuaHJlZiA9IGxpbmtTZXJ2aWNlLmdldERlc3RpbmF0aW9uSGFzaChkZXN0KTsKICAgIGVsZW1lbnQub25jbGljayA9IGV2dCA9PiB7CiAgICAgIHRoaXMuX3VwZGF0ZUN1cnJlbnRUcmVlSXRlbShldnQudGFyZ2V0LnBhcmVudE5vZGUpOwogICAgICBpZiAoZGVzdCkgewogICAgICAgIGxpbmtTZXJ2aWNlLmdvVG9EZXN0aW5hdGlvbihkZXN0KTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwogIH0KICBfc2V0U3R5bGVzKGVsZW1lbnQsIHsKICAgIGJvbGQsCiAgICBpdGFsaWMKICB9KSB7CiAgICBpZiAoYm9sZCkgewogICAgICBlbGVtZW50LnN0eWxlLmZvbnRXZWlnaHQgPSAiYm9sZCI7CiAgICB9CiAgICBpZiAoaXRhbGljKSB7CiAgICAgIGVsZW1lbnQuc3R5bGUuZm9udFN0eWxlID0gIml0YWxpYyI7CiAgICB9CiAgfQogIF9hZGRUb2dnbGVCdXR0b24oZGl2LCB7CiAgICBjb3VudCwKICAgIGl0ZW1zCiAgfSkgewogICAgbGV0IGhpZGRlbiA9IGZhbHNlOwogICAgaWYgKGNvdW50IDwgMCkgewogICAgICBsZXQgdG90YWxDb3VudCA9IGl0ZW1zLmxlbmd0aDsKICAgICAgaWYgKHRvdGFsQ291bnQgPiAwKSB7CiAgICAgICAgY29uc3QgcXVldWUgPSBbLi4uaXRlbXNdOwogICAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGNvdW50OiBuZXN0ZWRDb3VudCwKICAgICAgICAgICAgaXRlbXM6IG5lc3RlZEl0ZW1zCiAgICAgICAgICB9ID0gcXVldWUuc2hpZnQoKTsKICAgICAgICAgIGlmIChuZXN0ZWRDb3VudCA+IDAgJiYgbmVzdGVkSXRlbXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB0b3RhbENvdW50ICs9IG5lc3RlZEl0ZW1zLmxlbmd0aDsKICAgICAgICAgICAgcXVldWUucHVzaCguLi5uZXN0ZWRJdGVtcyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChNYXRoLmFicyhjb3VudCkgPT09IHRvdGFsQ291bnQpIHsKICAgICAgICBoaWRkZW4gPSB0cnVlOwogICAgICB9CiAgICB9CiAgICBzdXBlci5fYWRkVG9nZ2xlQnV0dG9uKGRpdiwgaGlkZGVuKTsKICB9CiAgX3RvZ2dsZUFsbFRyZWVJdGVtcygpIHsKICAgIGlmICghdGhpcy5fb3V0bGluZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBzdXBlci5fdG9nZ2xlQWxsVHJlZUl0ZW1zKCk7CiAgfQogIHJlbmRlcih7CiAgICBvdXRsaW5lLAogICAgcGRmRG9jdW1lbnQKICB9KSB7CiAgICBpZiAodGhpcy5fb3V0bGluZSkgewogICAgICB0aGlzLnJlc2V0KCk7CiAgICB9CiAgICB0aGlzLl9vdXRsaW5lID0gb3V0bGluZSB8fCBudWxsOwogICAgdGhpcy5fcGRmRG9jdW1lbnQgPSBwZGZEb2N1bWVudCB8fCBudWxsOwogICAgaWYgKCFvdXRsaW5lKSB7CiAgICAgIHRoaXMuX2Rpc3BhdGNoRXZlbnQoMCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgY29uc3QgcXVldWUgPSBbewogICAgICBwYXJlbnQ6IGZyYWdtZW50LAogICAgICBpdGVtczogb3V0bGluZQogICAgfV07CiAgICBsZXQgb3V0bGluZUNvdW50ID0gMCwKICAgICAgaGFzQW55TmVzdGluZyA9IGZhbHNlOwogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgbGV2ZWxEYXRhID0gcXVldWUuc2hpZnQoKTsKICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGxldmVsRGF0YS5pdGVtcykgewogICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIGRpdi5jbGFzc05hbWUgPSAidHJlZUl0ZW0iOwogICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgdGhpcy5fYmluZExpbmsoZWxlbWVudCwgaXRlbSk7CiAgICAgICAgdGhpcy5fc2V0U3R5bGVzKGVsZW1lbnQsIGl0ZW0pOwogICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSB0aGlzLl9ub3JtYWxpemVUZXh0Q29udGVudChpdGVtLnRpdGxlKTsKICAgICAgICBkaXYuYXBwZW5kKGVsZW1lbnQpOwogICAgICAgIGlmIChpdGVtLml0ZW1zLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGhhc0FueU5lc3RpbmcgPSB0cnVlOwogICAgICAgICAgdGhpcy5fYWRkVG9nZ2xlQnV0dG9uKGRpdiwgaXRlbSk7CiAgICAgICAgICBjb25zdCBpdGVtc0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgaXRlbXNEaXYuY2xhc3NOYW1lID0gInRyZWVJdGVtcyI7CiAgICAgICAgICBkaXYuYXBwZW5kKGl0ZW1zRGl2KTsKICAgICAgICAgIHF1ZXVlLnB1c2goewogICAgICAgICAgICBwYXJlbnQ6IGl0ZW1zRGl2LAogICAgICAgICAgICBpdGVtczogaXRlbS5pdGVtcwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGxldmVsRGF0YS5wYXJlbnQuYXBwZW5kKGRpdik7CiAgICAgICAgb3V0bGluZUNvdW50Kys7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuX2ZpbmlzaFJlbmRlcmluZyhmcmFnbWVudCwgb3V0bGluZUNvdW50LCBoYXNBbnlOZXN0aW5nKTsKICB9CiAgYXN5bmMgX2N1cnJlbnRPdXRsaW5lSXRlbSgpIHsKICAgIGlmICghdGhpcy5faXNQYWdlc0xvYWRlZCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIl9jdXJyZW50T3V0bGluZUl0ZW06IEFsbCBwYWdlcyBoYXZlIG5vdCBiZWVuIGxvYWRlZC4iKTsKICAgIH0KICAgIGlmICghdGhpcy5fb3V0bGluZSB8fCAhdGhpcy5fcGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGFnZU51bWJlclRvRGVzdEhhc2ggPSBhd2FpdCB0aGlzLl9nZXRQYWdlTnVtYmVyVG9EZXN0SGFzaCh0aGlzLl9wZGZEb2N1bWVudCk7CiAgICBpZiAoIXBhZ2VOdW1iZXJUb0Rlc3RIYXNoKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX3VwZGF0ZUN1cnJlbnRUcmVlSXRlbShudWxsKTsKICAgIGlmICh0aGlzLl9zaWRlYmFyVmlldyAhPT0gU2lkZWJhclZpZXcuT1VUTElORSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGxldCBpID0gdGhpcy5fY3VycmVudFBhZ2VOdW1iZXI7IGkgPiAwOyBpLS0pIHsKICAgICAgY29uc3QgZGVzdEhhc2ggPSBwYWdlTnVtYmVyVG9EZXN0SGFzaC5nZXQoaSk7CiAgICAgIGlmICghZGVzdEhhc2gpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBsaW5rRWxlbWVudCA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYGFbaHJlZj0iJHtkZXN0SGFzaH0iXWApOwogICAgICBpZiAoIWxpbmtFbGVtZW50KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdGhpcy5fc2Nyb2xsVG9DdXJyZW50VHJlZUl0ZW0obGlua0VsZW1lbnQucGFyZW50Tm9kZSk7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICBhc3luYyBfZ2V0UGFnZU51bWJlclRvRGVzdEhhc2gocGRmRG9jdW1lbnQpIHsKICAgIGlmICh0aGlzLl9wYWdlTnVtYmVyVG9EZXN0SGFzaENhcGFiaWxpdHkpIHsKICAgICAgcmV0dXJuIHRoaXMuX3BhZ2VOdW1iZXJUb0Rlc3RIYXNoQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgfQogICAgdGhpcy5fcGFnZU51bWJlclRvRGVzdEhhc2hDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICBjb25zdCBwYWdlTnVtYmVyVG9EZXN0SGFzaCA9IG5ldyBNYXAoKSwKICAgICAgcGFnZU51bWJlck5lc3RpbmcgPSBuZXcgTWFwKCk7CiAgICBjb25zdCBxdWV1ZSA9IFt7CiAgICAgIG5lc3Rpbmc6IDAsCiAgICAgIGl0ZW1zOiB0aGlzLl9vdXRsaW5lCiAgICB9XTsKICAgIHdoaWxlIChxdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IGxldmVsRGF0YSA9IHF1ZXVlLnNoaWZ0KCksCiAgICAgICAgY3VycmVudE5lc3RpbmcgPSBsZXZlbERhdGEubmVzdGluZzsKICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgZGVzdCwKICAgICAgICBpdGVtcwogICAgICB9IG9mIGxldmVsRGF0YS5pdGVtcykgewogICAgICAgIGxldCBleHBsaWNpdERlc3QsIHBhZ2VOdW1iZXI7CiAgICAgICAgaWYgKHR5cGVvZiBkZXN0ID09PSAic3RyaW5nIikgewogICAgICAgICAgZXhwbGljaXREZXN0ID0gYXdhaXQgcGRmRG9jdW1lbnQuZ2V0RGVzdGluYXRpb24oZGVzdCk7CiAgICAgICAgICBpZiAocGRmRG9jdW1lbnQgIT09IHRoaXMuX3BkZkRvY3VtZW50KSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBleHBsaWNpdERlc3QgPSBkZXN0OwogICAgICAgIH0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShleHBsaWNpdERlc3QpKSB7CiAgICAgICAgICBjb25zdCBbZGVzdFJlZl0gPSBleHBsaWNpdERlc3Q7CiAgICAgICAgICBpZiAoZGVzdFJlZiAmJiB0eXBlb2YgZGVzdFJlZiA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgcGFnZU51bWJlciA9IHBkZkRvY3VtZW50LmNhY2hlZFBhZ2VOdW1iZXIoZGVzdFJlZik7CiAgICAgICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0ludGVnZXIoZGVzdFJlZikpIHsKICAgICAgICAgICAgcGFnZU51bWJlciA9IGRlc3RSZWYgKyAxOwogICAgICAgICAgfQogICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIocGFnZU51bWJlcikgJiYgKCFwYWdlTnVtYmVyVG9EZXN0SGFzaC5oYXMocGFnZU51bWJlcikgfHwgY3VycmVudE5lc3RpbmcgPiBwYWdlTnVtYmVyTmVzdGluZy5nZXQocGFnZU51bWJlcikpKSB7CiAgICAgICAgICAgIGNvbnN0IGRlc3RIYXNoID0gdGhpcy5saW5rU2VydmljZS5nZXREZXN0aW5hdGlvbkhhc2goZGVzdCk7CiAgICAgICAgICAgIHBhZ2VOdW1iZXJUb0Rlc3RIYXNoLnNldChwYWdlTnVtYmVyLCBkZXN0SGFzaCk7CiAgICAgICAgICAgIHBhZ2VOdW1iZXJOZXN0aW5nLnNldChwYWdlTnVtYmVyLCBjdXJyZW50TmVzdGluZyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBxdWV1ZS5wdXNoKHsKICAgICAgICAgICAgbmVzdGluZzogY3VycmVudE5lc3RpbmcgKyAxLAogICAgICAgICAgICBpdGVtcwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB0aGlzLl9wYWdlTnVtYmVyVG9EZXN0SGFzaENhcGFiaWxpdHkucmVzb2x2ZShwYWdlTnVtYmVyVG9EZXN0SGFzaC5zaXplID4gMCA/IHBhZ2VOdW1iZXJUb0Rlc3RIYXNoIDogbnVsbCk7CiAgICByZXR1cm4gdGhpcy5fcGFnZU51bWJlclRvRGVzdEhhc2hDYXBhYmlsaXR5LnByb21pc2U7CiAgfQp9Cgo7Ly8gLi93ZWIvcGRmX3ByZXNlbnRhdGlvbl9tb2RlLmpzCgoKY29uc3QgREVMQVlfQkVGT1JFX0hJRElOR19DT05UUk9MUyA9IDMwMDA7CmNvbnN0IEFDVElWRV9TRUxFQ1RPUiA9ICJwZGZQcmVzZW50YXRpb25Nb2RlIjsKY29uc3QgQ09OVFJPTFNfU0VMRUNUT1IgPSAicGRmUHJlc2VudGF0aW9uTW9kZUNvbnRyb2xzIjsKY29uc3QgTU9VU0VfU0NST0xMX0NPT0xET1dOX1RJTUUgPSA1MDsKY29uc3QgUEFHRV9TV0lUQ0hfVEhSRVNIT0xEID0gMC4xOwpjb25zdCBTV0lQRV9NSU5fRElTVEFOQ0VfVEhSRVNIT0xEID0gNTA7CmNvbnN0IFNXSVBFX0FOR0xFX1RIUkVTSE9MRCA9IE1hdGguUEkgLyA2OwpjbGFzcyBQREZQcmVzZW50YXRpb25Nb2RlIHsKICAjc3RhdGUgPSBQcmVzZW50YXRpb25Nb2RlU3RhdGUuVU5LTk9XTjsKICAjYXJncyA9IG51bGw7CiAgI2Z1bGxzY3JlZW5DaGFuZ2VBYm9ydENvbnRyb2xsZXIgPSBudWxsOwogICN3aW5kb3dBYm9ydENvbnRyb2xsZXIgPSBudWxsOwogIGNvbnN0cnVjdG9yKHsKICAgIGNvbnRhaW5lciwKICAgIHBkZlZpZXdlciwKICAgIGV2ZW50QnVzCiAgfSkgewogICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7CiAgICB0aGlzLnBkZlZpZXdlciA9IHBkZlZpZXdlcjsKICAgIHRoaXMuZXZlbnRCdXMgPSBldmVudEJ1czsKICAgIHRoaXMuY29udGV4dE1lbnVPcGVuID0gZmFsc2U7CiAgICB0aGlzLm1vdXNlU2Nyb2xsVGltZVN0YW1wID0gMDsKICAgIHRoaXMubW91c2VTY3JvbGxEZWx0YSA9IDA7CiAgICB0aGlzLnRvdWNoU3dpcGVTdGF0ZSA9IG51bGw7CiAgfQogIGFzeW5jIHJlcXVlc3QoKSB7CiAgICBjb25zdCB7CiAgICAgIGNvbnRhaW5lciwKICAgICAgcGRmVmlld2VyCiAgICB9ID0gdGhpczsKICAgIGlmICh0aGlzLmFjdGl2ZSB8fCAhcGRmVmlld2VyLnBhZ2VzQ291bnQgfHwgIWNvbnRhaW5lci5yZXF1ZXN0RnVsbHNjcmVlbikgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0aGlzLiNhZGRGdWxsc2NyZWVuQ2hhbmdlTGlzdGVuZXJzKCk7CiAgICB0aGlzLiNub3RpZnlTdGF0ZUNoYW5nZShQcmVzZW50YXRpb25Nb2RlU3RhdGUuQ0hBTkdJTkcpOwogICAgY29uc3QgcHJvbWlzZSA9IGNvbnRhaW5lci5yZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgdGhpcy4jYXJncyA9IHsKICAgICAgcGFnZU51bWJlcjogcGRmVmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyLAogICAgICBzY2FsZVZhbHVlOiBwZGZWaWV3ZXIuY3VycmVudFNjYWxlVmFsdWUsCiAgICAgIHNjcm9sbE1vZGU6IHBkZlZpZXdlci5zY3JvbGxNb2RlLAogICAgICBzcHJlYWRNb2RlOiBudWxsLAogICAgICBhbm5vdGF0aW9uRWRpdG9yTW9kZTogbnVsbAogICAgfTsKICAgIGlmIChwZGZWaWV3ZXIuc3ByZWFkTW9kZSAhPT0gU3ByZWFkTW9kZS5OT05FICYmICEocGRmVmlld2VyLnBhZ2VWaWV3c1JlYWR5ICYmIHBkZlZpZXdlci5oYXNFcXVhbFBhZ2VTaXplcykpIHsKICAgICAgY29uc29sZS53YXJuKCJJZ25vcmluZyBTcHJlYWQgbW9kZXMgd2hlbiBlbnRlcmluZyBQcmVzZW50YXRpb25Nb2RlLCAiICsgInNpbmNlIHRoZSBkb2N1bWVudCBtYXkgY29udGFpbiB2YXJ5aW5nIHBhZ2Ugc2l6ZXMuIik7CiAgICAgIHRoaXMuI2FyZ3Muc3ByZWFkTW9kZSA9IHBkZlZpZXdlci5zcHJlYWRNb2RlOwogICAgfQogICAgaWYgKHBkZlZpZXdlci5hbm5vdGF0aW9uRWRpdG9yTW9kZSAhPT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuRElTQUJMRSkgewogICAgICB0aGlzLiNhcmdzLmFubm90YXRpb25FZGl0b3JNb2RlID0gcGRmVmlld2VyLmFubm90YXRpb25FZGl0b3JNb2RlOwogICAgfQogICAgdHJ5IHsKICAgICAgYXdhaXQgcHJvbWlzZTsKICAgICAgcGRmVmlld2VyLmZvY3VzKCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBjYXRjaCB7CiAgICAgIHRoaXMuI3JlbW92ZUZ1bGxzY3JlZW5DaGFuZ2VMaXN0ZW5lcnMoKTsKICAgICAgdGhpcy4jbm90aWZ5U3RhdGVDaGFuZ2UoUHJlc2VudGF0aW9uTW9kZVN0YXRlLk5PUk1BTCk7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGdldCBhY3RpdmUoKSB7CiAgICByZXR1cm4gdGhpcy4jc3RhdGUgPT09IFByZXNlbnRhdGlvbk1vZGVTdGF0ZS5DSEFOR0lORyB8fCB0aGlzLiNzdGF0ZSA9PT0gUHJlc2VudGF0aW9uTW9kZVN0YXRlLkZVTExTQ1JFRU47CiAgfQogICNtb3VzZVdoZWVsKGV2dCkgewogICAgaWYgKCF0aGlzLmFjdGl2ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgIGNvbnN0IGRlbHRhID0gbm9ybWFsaXplV2hlZWxFdmVudERlbHRhKGV2dCk7CiAgICBjb25zdCBjdXJyZW50VGltZSA9IERhdGUubm93KCk7CiAgICBjb25zdCBzdG9yZWRUaW1lID0gdGhpcy5tb3VzZVNjcm9sbFRpbWVTdGFtcDsKICAgIGlmIChjdXJyZW50VGltZSA+IHN0b3JlZFRpbWUgJiYgY3VycmVudFRpbWUgLSBzdG9yZWRUaW1lIDwgTU9VU0VfU0NST0xMX0NPT0xET1dOX1RJTUUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMubW91c2VTY3JvbGxEZWx0YSA+IDAgJiYgZGVsdGEgPCAwIHx8IHRoaXMubW91c2VTY3JvbGxEZWx0YSA8IDAgJiYgZGVsdGEgPiAwKSB7CiAgICAgIHRoaXMuI3Jlc2V0TW91c2VTY3JvbGxTdGF0ZSgpOwogICAgfQogICAgdGhpcy5tb3VzZVNjcm9sbERlbHRhICs9IGRlbHRhOwogICAgaWYgKE1hdGguYWJzKHRoaXMubW91c2VTY3JvbGxEZWx0YSkgPj0gUEFHRV9TV0lUQ0hfVEhSRVNIT0xEKSB7CiAgICAgIGNvbnN0IHRvdGFsRGVsdGEgPSB0aGlzLm1vdXNlU2Nyb2xsRGVsdGE7CiAgICAgIHRoaXMuI3Jlc2V0TW91c2VTY3JvbGxTdGF0ZSgpOwogICAgICBjb25zdCBzdWNjZXNzID0gdG90YWxEZWx0YSA+IDAgPyB0aGlzLnBkZlZpZXdlci5wcmV2aW91c1BhZ2UoKSA6IHRoaXMucGRmVmlld2VyLm5leHRQYWdlKCk7CiAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgdGhpcy5tb3VzZVNjcm9sbFRpbWVTdGFtcCA9IGN1cnJlbnRUaW1lOwogICAgICB9CiAgICB9CiAgfQogICNub3RpZnlTdGF0ZUNoYW5nZShzdGF0ZSkgewogICAgdGhpcy4jc3RhdGUgPSBzdGF0ZTsKICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goInByZXNlbnRhdGlvbm1vZGVjaGFuZ2VkIiwgewogICAgICBzb3VyY2U6IHRoaXMsCiAgICAgIHN0YXRlCiAgICB9KTsKICB9CiAgI2VudGVyKCkgewogICAgdGhpcy4jbm90aWZ5U3RhdGVDaGFuZ2UoUHJlc2VudGF0aW9uTW9kZVN0YXRlLkZVTExTQ1JFRU4pOwogICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZChBQ1RJVkVfU0VMRUNUT1IpOwogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHRoaXMucGRmVmlld2VyLnNjcm9sbE1vZGUgPSBTY3JvbGxNb2RlLlBBR0U7CiAgICAgIGlmICh0aGlzLiNhcmdzLnNwcmVhZE1vZGUgIT09IG51bGwpIHsKICAgICAgICB0aGlzLnBkZlZpZXdlci5zcHJlYWRNb2RlID0gU3ByZWFkTW9kZS5OT05FOwogICAgICB9CiAgICAgIHRoaXMucGRmVmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyID0gdGhpcy4jYXJncy5wYWdlTnVtYmVyOwogICAgICB0aGlzLnBkZlZpZXdlci5jdXJyZW50U2NhbGVWYWx1ZSA9ICJwYWdlLWZpdCI7CiAgICAgIGlmICh0aGlzLiNhcmdzLmFubm90YXRpb25FZGl0b3JNb2RlICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5wZGZWaWV3ZXIuYW5ub3RhdGlvbkVkaXRvck1vZGUgPSB7CiAgICAgICAgICBtb2RlOiBBbm5vdGF0aW9uRWRpdG9yVHlwZS5OT05FCiAgICAgICAgfTsKICAgICAgfQogICAgfSwgMCk7CiAgICB0aGlzLiNhZGRXaW5kb3dMaXN0ZW5lcnMoKTsKICAgIHRoaXMuI3Nob3dDb250cm9scygpOwogICAgdGhpcy5jb250ZXh0TWVudU9wZW4gPSBmYWxzZTsKICAgIGRvY3VtZW50LmdldFNlbGVjdGlvbigpLmVtcHR5KCk7CiAgfQogICNleGl0KCkgewogICAgY29uc3QgcGFnZU51bWJlciA9IHRoaXMucGRmVmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyOwogICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShBQ1RJVkVfU0VMRUNUT1IpOwogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHRoaXMuI3JlbW92ZUZ1bGxzY3JlZW5DaGFuZ2VMaXN0ZW5lcnMoKTsKICAgICAgdGhpcy4jbm90aWZ5U3RhdGVDaGFuZ2UoUHJlc2VudGF0aW9uTW9kZVN0YXRlLk5PUk1BTCk7CiAgICAgIHRoaXMucGRmVmlld2VyLnNjcm9sbE1vZGUgPSB0aGlzLiNhcmdzLnNjcm9sbE1vZGU7CiAgICAgIGlmICh0aGlzLiNhcmdzLnNwcmVhZE1vZGUgIT09IG51bGwpIHsKICAgICAgICB0aGlzLnBkZlZpZXdlci5zcHJlYWRNb2RlID0gdGhpcy4jYXJncy5zcHJlYWRNb2RlOwogICAgICB9CiAgICAgIHRoaXMucGRmVmlld2VyLmN1cnJlbnRTY2FsZVZhbHVlID0gdGhpcy4jYXJncy5zY2FsZVZhbHVlOwogICAgICB0aGlzLnBkZlZpZXdlci5jdXJyZW50UGFnZU51bWJlciA9IHBhZ2VOdW1iZXI7CiAgICAgIGlmICh0aGlzLiNhcmdzLmFubm90YXRpb25FZGl0b3JNb2RlICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5wZGZWaWV3ZXIuYW5ub3RhdGlvbkVkaXRvck1vZGUgPSB7CiAgICAgICAgICBtb2RlOiB0aGlzLiNhcmdzLmFubm90YXRpb25FZGl0b3JNb2RlCiAgICAgICAgfTsKICAgICAgfQogICAgICB0aGlzLiNhcmdzID0gbnVsbDsKICAgIH0sIDApOwogICAgdGhpcy4jcmVtb3ZlV2luZG93TGlzdGVuZXJzKCk7CiAgICB0aGlzLiNoaWRlQ29udHJvbHMoKTsKICAgIHRoaXMuI3Jlc2V0TW91c2VTY3JvbGxTdGF0ZSgpOwogICAgdGhpcy5jb250ZXh0TWVudU9wZW4gPSBmYWxzZTsKICB9CiAgI21vdXNlRG93bihldnQpIHsKICAgIGlmICh0aGlzLmNvbnRleHRNZW51T3BlbikgewogICAgICB0aGlzLmNvbnRleHRNZW51T3BlbiA9IGZhbHNlOwogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGV2dC5idXR0b24gIT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGV2dC50YXJnZXQuaHJlZiAmJiBldnQudGFyZ2V0LnBhcmVudE5vZGU/Lmhhc0F0dHJpYnV0ZSgiZGF0YS1pbnRlcm5hbC1saW5rIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICBpZiAoZXZ0LnNoaWZ0S2V5KSB7CiAgICAgIHRoaXMucGRmVmlld2VyLnByZXZpb3VzUGFnZSgpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5wZGZWaWV3ZXIubmV4dFBhZ2UoKTsKICAgIH0KICB9CiAgI2NvbnRleHRNZW51KCkgewogICAgdGhpcy5jb250ZXh0TWVudU9wZW4gPSB0cnVlOwogIH0KICAjc2hvd0NvbnRyb2xzKCkgewogICAgaWYgKHRoaXMuY29udHJvbHNUaW1lb3V0KSB7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmNvbnRyb2xzVGltZW91dCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKENPTlRST0xTX1NFTEVDVE9SKTsKICAgIH0KICAgIHRoaXMuY29udHJvbHNUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoQ09OVFJPTFNfU0VMRUNUT1IpOwogICAgICBkZWxldGUgdGhpcy5jb250cm9sc1RpbWVvdXQ7CiAgICB9LCBERUxBWV9CRUZPUkVfSElESU5HX0NPTlRST0xTKTsKICB9CiAgI2hpZGVDb250cm9scygpIHsKICAgIGlmICghdGhpcy5jb250cm9sc1RpbWVvdXQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY2xlYXJUaW1lb3V0KHRoaXMuY29udHJvbHNUaW1lb3V0KTsKICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoQ09OVFJPTFNfU0VMRUNUT1IpOwogICAgZGVsZXRlIHRoaXMuY29udHJvbHNUaW1lb3V0OwogIH0KICAjcmVzZXRNb3VzZVNjcm9sbFN0YXRlKCkgewogICAgdGhpcy5tb3VzZVNjcm9sbFRpbWVTdGFtcCA9IDA7CiAgICB0aGlzLm1vdXNlU2Nyb2xsRGVsdGEgPSAwOwogIH0KICAjdG91Y2hTd2lwZShldnQpIHsKICAgIGlmICghdGhpcy5hY3RpdmUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGV2dC50b3VjaGVzLmxlbmd0aCA+IDEpIHsKICAgICAgdGhpcy50b3VjaFN3aXBlU3RhdGUgPSBudWxsOwogICAgICByZXR1cm47CiAgICB9CiAgICBzd2l0Y2ggKGV2dC50eXBlKSB7CiAgICAgIGNhc2UgInRvdWNoc3RhcnQiOgogICAgICAgIHRoaXMudG91Y2hTd2lwZVN0YXRlID0gewogICAgICAgICAgc3RhcnRYOiBldnQudG91Y2hlc1swXS5wYWdlWCwKICAgICAgICAgIHN0YXJ0WTogZXZ0LnRvdWNoZXNbMF0ucGFnZVksCiAgICAgICAgICBlbmRYOiBldnQudG91Y2hlc1swXS5wYWdlWCwKICAgICAgICAgIGVuZFk6IGV2dC50b3VjaGVzWzBdLnBhZ2VZCiAgICAgICAgfTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAidG91Y2htb3ZlIjoKICAgICAgICBpZiAodGhpcy50b3VjaFN3aXBlU3RhdGUgPT09IG51bGwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy50b3VjaFN3aXBlU3RhdGUuZW5kWCA9IGV2dC50b3VjaGVzWzBdLnBhZ2VYOwogICAgICAgIHRoaXMudG91Y2hTd2lwZVN0YXRlLmVuZFkgPSBldnQudG91Y2hlc1swXS5wYWdlWTsKICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAidG91Y2hlbmQiOgogICAgICAgIGlmICh0aGlzLnRvdWNoU3dpcGVTdGF0ZSA9PT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgZGVsdGEgPSAwOwogICAgICAgIGNvbnN0IGR4ID0gdGhpcy50b3VjaFN3aXBlU3RhdGUuZW5kWCAtIHRoaXMudG91Y2hTd2lwZVN0YXRlLnN0YXJ0WDsKICAgICAgICBjb25zdCBkeSA9IHRoaXMudG91Y2hTd2lwZVN0YXRlLmVuZFkgLSB0aGlzLnRvdWNoU3dpcGVTdGF0ZS5zdGFydFk7CiAgICAgICAgY29uc3QgYWJzQW5nbGUgPSBNYXRoLmFicyhNYXRoLmF0YW4yKGR5LCBkeCkpOwogICAgICAgIGlmIChNYXRoLmFicyhkeCkgPiBTV0lQRV9NSU5fRElTVEFOQ0VfVEhSRVNIT0xEICYmIChhYnNBbmdsZSA8PSBTV0lQRV9BTkdMRV9USFJFU0hPTEQgfHwgYWJzQW5nbGUgPj0gTWF0aC5QSSAtIFNXSVBFX0FOR0xFX1RIUkVTSE9MRCkpIHsKICAgICAgICAgIGRlbHRhID0gZHg7CiAgICAgICAgfSBlbHNlIGlmIChNYXRoLmFicyhkeSkgPiBTV0lQRV9NSU5fRElTVEFOQ0VfVEhSRVNIT0xEICYmIE1hdGguYWJzKGFic0FuZ2xlIC0gTWF0aC5QSSAvIDIpIDw9IFNXSVBFX0FOR0xFX1RIUkVTSE9MRCkgewogICAgICAgICAgZGVsdGEgPSBkeTsKICAgICAgICB9CiAgICAgICAgaWYgKGRlbHRhID4gMCkgewogICAgICAgICAgdGhpcy5wZGZWaWV3ZXIucHJldmlvdXNQYWdlKCk7CiAgICAgICAgfSBlbHNlIGlmIChkZWx0YSA8IDApIHsKICAgICAgICAgIHRoaXMucGRmVmlld2VyLm5leHRQYWdlKCk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgfQogIH0KICAjYWRkV2luZG93TGlzdGVuZXJzKCkgewogICAgaWYgKHRoaXMuI3dpbmRvd0Fib3J0Q29udHJvbGxlcikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiN3aW5kb3dBYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBjb25zdCB7CiAgICAgIHNpZ25hbAogICAgfSA9IHRoaXMuI3dpbmRvd0Fib3J0Q29udHJvbGxlcjsKICAgIGNvbnN0IHRvdWNoU3dpcGVCaW5kID0gdGhpcy4jdG91Y2hTd2lwZS5iaW5kKHRoaXMpOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIHRoaXMuI3Nob3dDb250cm9scy5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgdGhpcy4jbW91c2VEb3duLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ3aGVlbCIsIHRoaXMuI21vdXNlV2hlZWwuYmluZCh0aGlzKSwgewogICAgICBwYXNzaXZlOiBmYWxzZSwKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgdGhpcy4jcmVzZXRNb3VzZVNjcm9sbFN0YXRlLmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJjb250ZXh0bWVudSIsIHRoaXMuI2NvbnRleHRNZW51LmJpbmQodGhpcyksIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaHN0YXJ0IiwgdG91Y2hTd2lwZUJpbmQsIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaG1vdmUiLCB0b3VjaFN3aXBlQmluZCwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInRvdWNoZW5kIiwgdG91Y2hTd2lwZUJpbmQsIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICB9CiAgI3JlbW92ZVdpbmRvd0xpc3RlbmVycygpIHsKICAgIHRoaXMuI3dpbmRvd0Fib3J0Q29udHJvbGxlcj8uYWJvcnQoKTsKICAgIHRoaXMuI3dpbmRvd0Fib3J0Q29udHJvbGxlciA9IG51bGw7CiAgfQogICNhZGRGdWxsc2NyZWVuQ2hhbmdlTGlzdGVuZXJzKCkgewogICAgaWYgKHRoaXMuI2Z1bGxzY3JlZW5DaGFuZ2VBYm9ydENvbnRyb2xsZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jZnVsbHNjcmVlbkNoYW5nZUFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJmdWxsc2NyZWVuY2hhbmdlIiwgKCkgPT4gewogICAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHsKICAgICAgICB0aGlzLiNlbnRlcigpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuI2V4aXQoKTsKICAgICAgfQogICAgfSwgewogICAgICBzaWduYWw6IHRoaXMuI2Z1bGxzY3JlZW5DaGFuZ2VBYm9ydENvbnRyb2xsZXIuc2lnbmFsCiAgICB9KTsKICB9CiAgI3JlbW92ZUZ1bGxzY3JlZW5DaGFuZ2VMaXN0ZW5lcnMoKSB7CiAgICB0aGlzLiNmdWxsc2NyZWVuQ2hhbmdlQWJvcnRDb250cm9sbGVyPy5hYm9ydCgpOwogICAgdGhpcy4jZnVsbHNjcmVlbkNoYW5nZUFib3J0Q29udHJvbGxlciA9IG51bGw7CiAgfQp9Cgo7Ly8gLi93ZWIveGZhX2xheWVyX2J1aWxkZXIuanMKCmNsYXNzIFhmYUxheWVyQnVpbGRlciB7CiAgY29uc3RydWN0b3IoewogICAgcGRmUGFnZSwKICAgIGFubm90YXRpb25TdG9yYWdlID0gbnVsbCwKICAgIGxpbmtTZXJ2aWNlLAogICAgeGZhSHRtbCA9IG51bGwKICB9KSB7CiAgICB0aGlzLnBkZlBhZ2UgPSBwZGZQYWdlOwogICAgdGhpcy5hbm5vdGF0aW9uU3RvcmFnZSA9IGFubm90YXRpb25TdG9yYWdlOwogICAgdGhpcy5saW5rU2VydmljZSA9IGxpbmtTZXJ2aWNlOwogICAgdGhpcy54ZmFIdG1sID0geGZhSHRtbDsKICAgIHRoaXMuZGl2ID0gbnVsbDsKICAgIHRoaXMuX2NhbmNlbGxlZCA9IGZhbHNlOwogIH0KICBhc3luYyByZW5kZXIoewogICAgdmlld3BvcnQsCiAgICBpbnRlbnQgPSAiZGlzcGxheSIKICB9KSB7CiAgICBpZiAoaW50ZW50ID09PSAicHJpbnQiKSB7CiAgICAgIGNvbnN0IHBhcmFtZXRlcnMgPSB7CiAgICAgICAgdmlld3BvcnQ6IHZpZXdwb3J0LmNsb25lKHsKICAgICAgICAgIGRvbnRGbGlwOiB0cnVlCiAgICAgICAgfSksCiAgICAgICAgZGl2OiB0aGlzLmRpdiwKICAgICAgICB4ZmFIdG1sOiB0aGlzLnhmYUh0bWwsCiAgICAgICAgYW5ub3RhdGlvblN0b3JhZ2U6IHRoaXMuYW5ub3RhdGlvblN0b3JhZ2UsCiAgICAgICAgbGlua1NlcnZpY2U6IHRoaXMubGlua1NlcnZpY2UsCiAgICAgICAgaW50ZW50CiAgICAgIH07CiAgICAgIHRoaXMuZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIHBhcmFtZXRlcnMuZGl2ID0gdGhpcy5kaXY7CiAgICAgIHJldHVybiBYZmFMYXllci5yZW5kZXIocGFyYW1ldGVycyk7CiAgICB9CiAgICBjb25zdCB4ZmFIdG1sID0gYXdhaXQgdGhpcy5wZGZQYWdlLmdldFhmYSgpOwogICAgaWYgKHRoaXMuX2NhbmNlbGxlZCB8fCAheGZhSHRtbCkgewogICAgICByZXR1cm4gewogICAgICAgIHRleHREaXZzOiBbXQogICAgICB9OwogICAgfQogICAgY29uc3QgcGFyYW1ldGVycyA9IHsKICAgICAgdmlld3BvcnQ6IHZpZXdwb3J0LmNsb25lKHsKICAgICAgICBkb250RmxpcDogdHJ1ZQogICAgICB9KSwKICAgICAgZGl2OiB0aGlzLmRpdiwKICAgICAgeGZhSHRtbCwKICAgICAgYW5ub3RhdGlvblN0b3JhZ2U6IHRoaXMuYW5ub3RhdGlvblN0b3JhZ2UsCiAgICAgIGxpbmtTZXJ2aWNlOiB0aGlzLmxpbmtTZXJ2aWNlLAogICAgICBpbnRlbnQKICAgIH07CiAgICBpZiAodGhpcy5kaXYpIHsKICAgICAgcmV0dXJuIFhmYUxheWVyLnVwZGF0ZShwYXJhbWV0ZXJzKTsKICAgIH0KICAgIHRoaXMuZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBwYXJhbWV0ZXJzLmRpdiA9IHRoaXMuZGl2OwogICAgcmV0dXJuIFhmYUxheWVyLnJlbmRlcihwYXJhbWV0ZXJzKTsKICB9CiAgY2FuY2VsKCkgewogICAgdGhpcy5fY2FuY2VsbGVkID0gdHJ1ZTsKICB9CiAgaGlkZSgpIHsKICAgIGlmICghdGhpcy5kaXYpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5kaXYuaGlkZGVuID0gdHJ1ZTsKICB9Cn0KCjsvLyAuL3dlYi9wcmludF91dGlscy5qcwoKCgpmdW5jdGlvbiBnZXRYZmFIdG1sRm9yUHJpbnRpbmcocHJpbnRDb250YWluZXIsIHBkZkRvY3VtZW50KSB7CiAgY29uc3QgeGZhSHRtbCA9IHBkZkRvY3VtZW50LmFsbFhmYUh0bWw7CiAgY29uc3QgbGlua1NlcnZpY2UgPSBuZXcgU2ltcGxlTGlua1NlcnZpY2UoKTsKICBjb25zdCBzY2FsZSA9IE1hdGgucm91bmQoUGl4ZWxzUGVySW5jaC5QREZfVE9fQ1NTX1VOSVRTICogMTAwKSAvIDEwMDsKICBmb3IgKGNvbnN0IHhmYVBhZ2Ugb2YgeGZhSHRtbC5jaGlsZHJlbikgewogICAgY29uc3QgcGFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgcGFnZS5jbGFzc05hbWUgPSAieGZhUHJpbnRlZFBhZ2UiOwogICAgcHJpbnRDb250YWluZXIuYXBwZW5kKHBhZ2UpOwogICAgY29uc3QgYnVpbGRlciA9IG5ldyBYZmFMYXllckJ1aWxkZXIoewogICAgICBwZGZQYWdlOiBudWxsLAogICAgICBhbm5vdGF0aW9uU3RvcmFnZTogcGRmRG9jdW1lbnQuYW5ub3RhdGlvblN0b3JhZ2UsCiAgICAgIGxpbmtTZXJ2aWNlLAogICAgICB4ZmFIdG1sOiB4ZmFQYWdlCiAgICB9KTsKICAgIGNvbnN0IHZpZXdwb3J0ID0gZ2V0WGZhUGFnZVZpZXdwb3J0KHhmYVBhZ2UsIHsKICAgICAgc2NhbGUKICAgIH0pOwogICAgYnVpbGRlci5yZW5kZXIoewogICAgICB2aWV3cG9ydCwKICAgICAgaW50ZW50OiAicHJpbnQiCiAgICB9KTsKICAgIHBhZ2UuYXBwZW5kKGJ1aWxkZXIuZGl2KTsKICB9Cn0KCjsvLyAuL3dlYi9wZGZfcHJpbnRfc2VydmljZS5qcwoKCmxldCBhY3RpdmVTZXJ2aWNlID0gbnVsbDsKbGV0IGRpYWxvZyA9IG51bGw7CmxldCBvdmVybGF5TWFuYWdlciA9IG51bGw7CmxldCB2aWV3ZXJBcHAgPSB7CiAgaW5pdGlhbGl6ZWQ6IGZhbHNlCn07CmZ1bmN0aW9uIHJlbmRlclBhZ2UoYWN0aXZlU2VydmljZU9uRW50cnksIHBkZkRvY3VtZW50LCBwYWdlTnVtYmVyLCBzaXplLCBwcmludFJlc29sdXRpb24sIG9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UsIHByaW50QW5ub3RhdGlvblN0b3JhZ2VQcm9taXNlKSB7CiAgY29uc3Qgc2NyYXRjaENhbnZhcyA9IGFjdGl2ZVNlcnZpY2Uuc2NyYXRjaENhbnZhczsKICBjb25zdCBQUklOVF9VTklUUyA9IHByaW50UmVzb2x1dGlvbiAvIFBpeGVsc1BlckluY2guUERGOwogIHNjcmF0Y2hDYW52YXMud2lkdGggPSBNYXRoLmZsb29yKHNpemUud2lkdGggKiBQUklOVF9VTklUUyk7CiAgc2NyYXRjaENhbnZhcy5oZWlnaHQgPSBNYXRoLmZsb29yKHNpemUuaGVpZ2h0ICogUFJJTlRfVU5JVFMpOwogIGNvbnN0IGN0eCA9IHNjcmF0Y2hDYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICBjdHguc2F2ZSgpOwogIGN0eC5maWxsU3R5bGUgPSAicmdiKDI1NSwgMjU1LCAyNTUpIjsKICBjdHguZmlsbFJlY3QoMCwgMCwgc2NyYXRjaENhbnZhcy53aWR0aCwgc2NyYXRjaENhbnZhcy5oZWlnaHQpOwogIGN0eC5yZXN0b3JlKCk7CiAgcmV0dXJuIFByb21pc2UuYWxsKFtwZGZEb2N1bWVudC5nZXRQYWdlKHBhZ2VOdW1iZXIpLCBwcmludEFubm90YXRpb25TdG9yYWdlUHJvbWlzZV0pLnRoZW4oZnVuY3Rpb24gKFtwZGZQYWdlLCBwcmludEFubm90YXRpb25TdG9yYWdlXSkgewogICAgY29uc3QgcmVuZGVyQ29udGV4dCA9IHsKICAgICAgY2FudmFzQ29udGV4dDogY3R4LAogICAgICB0cmFuc2Zvcm06IFtQUklOVF9VTklUUywgMCwgMCwgUFJJTlRfVU5JVFMsIDAsIDBdLAogICAgICB2aWV3cG9ydDogcGRmUGFnZS5nZXRWaWV3cG9ydCh7CiAgICAgICAgc2NhbGU6IDEsCiAgICAgICAgcm90YXRpb246IHNpemUucm90YXRpb24KICAgICAgfSksCiAgICAgIGludGVudDogInByaW50IiwKICAgICAgYW5ub3RhdGlvbk1vZGU6IEFubm90YXRpb25Nb2RlLkVOQUJMRV9TVE9SQUdFLAogICAgICBvcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlLAogICAgICBwcmludEFubm90YXRpb25TdG9yYWdlCiAgICB9OwogICAgY29uc3QgcmVuZGVyVGFzayA9IHBkZlBhZ2UucmVuZGVyKHJlbmRlckNvbnRleHQpOwogICAgcmV0dXJuIHJlbmRlclRhc2sucHJvbWlzZS5jYXRjaChyZWFzb24gPT4gewogICAgICBpZiAoIShyZWFzb24gaW5zdGFuY2VvZiBSZW5kZXJpbmdDYW5jZWxsZWRFeGNlcHRpb24pKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihyZWFzb24pOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0pOwogIH0pOwp9CmNsYXNzIFBERlByaW50U2VydmljZSB7CiAgY29uc3RydWN0b3IoewogICAgcGRmRG9jdW1lbnQsCiAgICBwYWdlc092ZXJ2aWV3LAogICAgcHJpbnRDb250YWluZXIsCiAgICBwcmludFJlc29sdXRpb24sCiAgICBwcmludEFubm90YXRpb25TdG9yYWdlUHJvbWlzZSA9IG51bGwKICB9KSB7CiAgICB0aGlzLnBkZkRvY3VtZW50ID0gcGRmRG9jdW1lbnQ7CiAgICB0aGlzLnBhZ2VzT3ZlcnZpZXcgPSBwYWdlc092ZXJ2aWV3OwogICAgdGhpcy5wcmludENvbnRhaW5lciA9IHByaW50Q29udGFpbmVyOwogICAgdGhpcy5fcHJpbnRSZXNvbHV0aW9uID0gcHJpbnRSZXNvbHV0aW9uIHx8IDE1MDsKICAgIHRoaXMuX29wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UgPSBwZGZEb2N1bWVudC5nZXRPcHRpb25hbENvbnRlbnRDb25maWcoewogICAgICBpbnRlbnQ6ICJwcmludCIKICAgIH0pOwogICAgdGhpcy5fcHJpbnRBbm5vdGF0aW9uU3RvcmFnZVByb21pc2UgPSBwcmludEFubm90YXRpb25TdG9yYWdlUHJvbWlzZSB8fCBQcm9taXNlLnJlc29sdmUoKTsKICAgIHRoaXMuY3VycmVudFBhZ2UgPSAtMTsKICAgIHRoaXMuc2NyYXRjaENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogIH0KICBsYXlvdXQoKSB7CiAgICB0aGlzLnRocm93SWZJbmFjdGl2ZSgpOwogICAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKTsKICAgIGJvZHkuc2V0QXR0cmlidXRlKCJkYXRhLXBkZmpzcHJpbnRpbmciLCB0cnVlKTsKICAgIGNvbnN0IHsKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IHRoaXMucGFnZXNPdmVydmlld1swXTsKICAgIGNvbnN0IGhhc0VxdWFsUGFnZVNpemVzID0gdGhpcy5wYWdlc092ZXJ2aWV3LmV2ZXJ5KHNpemUgPT4gc2l6ZS53aWR0aCA9PT0gd2lkdGggJiYgc2l6ZS5oZWlnaHQgPT09IGhlaWdodCk7CiAgICBpZiAoIWhhc0VxdWFsUGFnZVNpemVzKSB7CiAgICAgIGNvbnNvbGUud2FybigiTm90IGFsbCBwYWdlcyBoYXZlIHRoZSBzYW1lIHNpemUuIFRoZSBwcmludGVkIHJlc3VsdCBtYXkgYmUgaW5jb3JyZWN0ISIpOwogICAgfQogICAgdGhpcy5wYWdlU3R5bGVTaGVldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7CiAgICB0aGlzLnBhZ2VTdHlsZVNoZWV0LnRleHRDb250ZW50ID0gYEBwYWdlIHsgc2l6ZTogJHt3aWR0aH1wdCAke2hlaWdodH1wdDt9YDsKICAgIGJvZHkuYXBwZW5kKHRoaXMucGFnZVN0eWxlU2hlZXQpOwogIH0KICBkZXN0cm95KCkgewogICAgaWYgKGFjdGl2ZVNlcnZpY2UgIT09IHRoaXMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5wcmludENvbnRhaW5lci50ZXh0Q29udGVudCA9ICIiOwogICAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKTsKICAgIGJvZHkucmVtb3ZlQXR0cmlidXRlKCJkYXRhLXBkZmpzcHJpbnRpbmciKTsKICAgIGlmICh0aGlzLnBhZ2VTdHlsZVNoZWV0KSB7CiAgICAgIHRoaXMucGFnZVN0eWxlU2hlZXQucmVtb3ZlKCk7CiAgICAgIHRoaXMucGFnZVN0eWxlU2hlZXQgPSBudWxsOwogICAgfQogICAgdGhpcy5zY3JhdGNoQ2FudmFzLndpZHRoID0gdGhpcy5zY3JhdGNoQ2FudmFzLmhlaWdodCA9IDA7CiAgICB0aGlzLnNjcmF0Y2hDYW52YXMgPSBudWxsOwogICAgYWN0aXZlU2VydmljZSA9IG51bGw7CiAgICBlbnN1cmVPdmVybGF5KCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIG92ZXJsYXlNYW5hZ2VyLmNsb3NlSWZBY3RpdmUoZGlhbG9nKTsKICAgIH0pOwogIH0KICByZW5kZXJQYWdlcygpIHsKICAgIGlmICh0aGlzLnBkZkRvY3VtZW50LmlzUHVyZVhmYSkgewogICAgICBnZXRYZmFIdG1sRm9yUHJpbnRpbmcodGhpcy5wcmludENvbnRhaW5lciwgdGhpcy5wZGZEb2N1bWVudCk7CiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgIH0KICAgIGNvbnN0IHBhZ2VDb3VudCA9IHRoaXMucGFnZXNPdmVydmlldy5sZW5ndGg7CiAgICBjb25zdCByZW5kZXJOZXh0UGFnZSA9IChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgdGhpcy50aHJvd0lmSW5hY3RpdmUoKTsKICAgICAgaWYgKCsrdGhpcy5jdXJyZW50UGFnZSA+PSBwYWdlQ291bnQpIHsKICAgICAgICByZW5kZXJQcm9ncmVzcyhwYWdlQ291bnQsIHBhZ2VDb3VudCk7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBpbmRleCA9IHRoaXMuY3VycmVudFBhZ2U7CiAgICAgIHJlbmRlclByb2dyZXNzKGluZGV4LCBwYWdlQ291bnQpOwogICAgICByZW5kZXJQYWdlKHRoaXMsIHRoaXMucGRmRG9jdW1lbnQsIGluZGV4ICsgMSwgdGhpcy5wYWdlc092ZXJ2aWV3W2luZGV4XSwgdGhpcy5fcHJpbnRSZXNvbHV0aW9uLCB0aGlzLl9vcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlLCB0aGlzLl9wcmludEFubm90YXRpb25TdG9yYWdlUHJvbWlzZSkudGhlbih0aGlzLnVzZVJlbmRlcmVkUGFnZS5iaW5kKHRoaXMpKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICByZW5kZXJOZXh0UGFnZShyZXNvbHZlLCByZWplY3QpOwogICAgICB9LCByZWplY3QpOwogICAgfTsKICAgIHJldHVybiBuZXcgUHJvbWlzZShyZW5kZXJOZXh0UGFnZSk7CiAgfQogIHVzZVJlbmRlcmVkUGFnZSgpIHsKICAgIHRoaXMudGhyb3dJZkluYWN0aXZlKCk7CiAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICAgIHRoaXMuc2NyYXRjaENhbnZhcy50b0Jsb2IoYmxvYiA9PiB7CiAgICAgIGltZy5zcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgfSk7CiAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICB3cmFwcGVyLmNsYXNzTmFtZSA9ICJwcmludGVkUGFnZSI7CiAgICB3cmFwcGVyLmFwcGVuZChpbWcpOwogICAgdGhpcy5wcmludENvbnRhaW5lci5hcHBlbmQod3JhcHBlcik7CiAgICBjb25zdCB7CiAgICAgIHByb21pc2UsCiAgICAgIHJlc29sdmUsCiAgICAgIHJlamVjdAogICAgfSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgaW1nLm9ubG9hZCA9IHJlc29sdmU7CiAgICBpbWcub25lcnJvciA9IHJlamVjdDsKICAgIHByb21pc2UuY2F0Y2goKCkgPT4ge30pLnRoZW4oKCkgPT4gewogICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKGltZy5zcmMpOwogICAgfSk7CiAgICByZXR1cm4gcHJvbWlzZTsKICB9CiAgcGVyZm9ybVByaW50KCkgewogICAgdGhpcy50aHJvd0lmSW5hY3RpdmUoKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZSkgewogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBwcmludC5jYWxsKHdpbmRvdyk7CiAgICAgICAgc2V0VGltZW91dChyZXNvbHZlLCAyMCk7CiAgICAgIH0sIDApOwogICAgfSk7CiAgfQogIGdldCBhY3RpdmUoKSB7CiAgICByZXR1cm4gdGhpcyA9PT0gYWN0aXZlU2VydmljZTsKICB9CiAgdGhyb3dJZkluYWN0aXZlKCkgewogICAgaWYgKCF0aGlzLmFjdGl2ZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoaXMgcHJpbnQgcmVxdWVzdCB3YXMgY2FuY2VsbGVkIG9yIGNvbXBsZXRlZC4iKTsKICAgIH0KICB9Cn0KY29uc3QgcHJpbnQgPSB3aW5kb3cucHJpbnQ7CndpbmRvdy5wcmludCA9IGZ1bmN0aW9uICgpIHsKICBpZiAoYWN0aXZlU2VydmljZSkgewogICAgY29uc29sZS53YXJuKCJJZ25vcmVkIHdpbmRvdy5wcmludCgpIGJlY2F1c2Ugb2YgYSBwZW5kaW5nIHByaW50IGpvYi4iKTsKICAgIHJldHVybjsKICB9CiAgZW5zdXJlT3ZlcmxheSgpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgaWYgKGFjdGl2ZVNlcnZpY2UpIHsKICAgICAgb3ZlcmxheU1hbmFnZXIub3BlbihkaWFsb2cpOwogICAgfQogIH0pOwogIHRyeSB7CiAgICBkaXNwYXRjaEV2ZW50KCJiZWZvcmVwcmludCIpOwogIH0gZmluYWxseSB7CiAgICBpZiAoIWFjdGl2ZVNlcnZpY2UpIHsKICAgICAgY29uc29sZS5lcnJvcigiRXhwZWN0ZWQgcHJpbnQgc2VydmljZSB0byBiZSBpbml0aWFsaXplZC4iKTsKICAgICAgZW5zdXJlT3ZlcmxheSgpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIG92ZXJsYXlNYW5hZ2VyLmNsb3NlSWZBY3RpdmUoZGlhbG9nKTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBhY3RpdmVTZXJ2aWNlT25FbnRyeSA9IGFjdGl2ZVNlcnZpY2U7CiAgICAgIGFjdGl2ZVNlcnZpY2UucmVuZGVyUGFnZXMoKS50aGVuKCgpID0+IGFjdGl2ZVNlcnZpY2VPbkVudHJ5LnBlcmZvcm1QcmludCgpKS5jYXRjaCgoKSA9PiB7fSkudGhlbigoKSA9PiB7CiAgICAgICAgaWYgKGFjdGl2ZVNlcnZpY2VPbkVudHJ5LmFjdGl2ZSkgewogICAgICAgICAgYWJvcnQoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KfTsKZnVuY3Rpb24gZGlzcGF0Y2hFdmVudChldmVudFR5cGUpIHsKICBjb25zdCBldmVudCA9IG5ldyBDdXN0b21FdmVudChldmVudFR5cGUsIHsKICAgIGJ1YmJsZXM6IGZhbHNlLAogICAgY2FuY2VsYWJsZTogZmFsc2UsCiAgICBkZXRhaWw6ICJjdXN0b20iCiAgfSk7CiAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwp9CmZ1bmN0aW9uIGFib3J0KCkgewogIGlmIChhY3RpdmVTZXJ2aWNlKSB7CiAgICBhY3RpdmVTZXJ2aWNlLmRlc3Ryb3koKTsKICAgIGRpc3BhdGNoRXZlbnQoImFmdGVycHJpbnQiKTsKICB9Cn0KZnVuY3Rpb24gcmVuZGVyUHJvZ3Jlc3MoaW5kZXgsIHRvdGFsKSB7CiAgZGlhbG9nIHx8PSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJpbnRTZXJ2aWNlRGlhbG9nIik7CiAgY29uc3QgcHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKDEwMCAqIGluZGV4IC8gdG90YWwpOwogIGNvbnN0IHByb2dyZXNzQmFyID0gZGlhbG9nLnF1ZXJ5U2VsZWN0b3IoInByb2dyZXNzIik7CiAgY29uc3QgcHJvZ3Jlc3NQZXJjID0gZGlhbG9nLnF1ZXJ5U2VsZWN0b3IoIi5yZWxhdGl2ZS1wcm9ncmVzcyIpOwogIHByb2dyZXNzQmFyLnZhbHVlID0gcHJvZ3Jlc3M7CiAgcHJvZ3Jlc3NQZXJjLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWFyZ3MiLCBKU09OLnN0cmluZ2lmeSh7CiAgICBwcm9ncmVzcwogIH0pKTsKfQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGZ1bmN0aW9uIChldmVudCkgewogIGlmIChldmVudC5rZXlDb2RlID09PSA4MCAmJiAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSAmJiAhZXZlbnQuYWx0S2V5ICYmICghZXZlbnQuc2hpZnRLZXkgfHwgd2luZG93LmNocm9tZSB8fCB3aW5kb3cub3BlcmEpKSB7CiAgICB3aW5kb3cucHJpbnQoKTsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICB9Cn0sIHRydWUpOwppZiAoIm9uYmVmb3JlcHJpbnQiIGluIHdpbmRvdykgewogIGNvbnN0IHN0b3BQcm9wYWdhdGlvbklmTmVlZGVkID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQuZGV0YWlsICE9PSAiY3VzdG9tIikgewogICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgIH0KICB9OwogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJiZWZvcmVwcmludCIsIHN0b3BQcm9wYWdhdGlvbklmTmVlZGVkKTsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiYWZ0ZXJwcmludCIsIHN0b3BQcm9wYWdhdGlvbklmTmVlZGVkKTsKfQpsZXQgb3ZlcmxheVByb21pc2U7CmZ1bmN0aW9uIGVuc3VyZU92ZXJsYXkoKSB7CiAgaWYgKCFvdmVybGF5UHJvbWlzZSkgewogICAgb3ZlcmxheU1hbmFnZXIgPSB2aWV3ZXJBcHAub3ZlcmxheU1hbmFnZXI7CiAgICBpZiAoIW92ZXJsYXlNYW5hZ2VyKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlIG92ZXJsYXkgbWFuYWdlciBoYXMgbm90IHlldCBiZWVuIGluaXRpYWxpemVkLiIpOwogICAgfQogICAgZGlhbG9nIHx8PSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJpbnRTZXJ2aWNlRGlhbG9nIik7CiAgICBvdmVybGF5UHJvbWlzZSA9IG92ZXJsYXlNYW5hZ2VyLnJlZ2lzdGVyKGRpYWxvZywgdHJ1ZSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJpbnRDYW5jZWwiKS5vbmNsaWNrID0gYWJvcnQ7CiAgICBkaWFsb2cuYWRkRXZlbnRMaXN0ZW5lcigiY2xvc2UiLCBhYm9ydCk7CiAgfQogIHJldHVybiBvdmVybGF5UHJvbWlzZTsKfQpjbGFzcyBQREZQcmludFNlcnZpY2VGYWN0b3J5IHsKICBzdGF0aWMgaW5pdEdsb2JhbHMoYXBwKSB7CiAgICB2aWV3ZXJBcHAgPSBhcHA7CiAgfQogIHN0YXRpYyBnZXQgc3VwcG9ydHNQcmludGluZygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgInN1cHBvcnRzUHJpbnRpbmciLCB0cnVlKTsKICB9CiAgc3RhdGljIGNyZWF0ZVByaW50U2VydmljZShwYXJhbXMpIHsKICAgIGlmIChhY3RpdmVTZXJ2aWNlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlIHByaW50IHNlcnZpY2UgaXMgY3JlYXRlZCBhbmQgYWN0aXZlLiIpOwogICAgfQogICAgcmV0dXJuIGFjdGl2ZVNlcnZpY2UgPSBuZXcgUERGUHJpbnRTZXJ2aWNlKHBhcmFtcyk7CiAgfQp9Cgo7Ly8gLi93ZWIvcGRmX3JlbmRlcmluZ19xdWV1ZS5qcwoKCmNvbnN0IENMRUFOVVBfVElNRU9VVCA9IDMwMDAwOwpjbGFzcyBQREZSZW5kZXJpbmdRdWV1ZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLnBkZlZpZXdlciA9IG51bGw7CiAgICB0aGlzLnBkZlRodW1ibmFpbFZpZXdlciA9IG51bGw7CiAgICB0aGlzLm9uSWRsZSA9IG51bGw7CiAgICB0aGlzLmhpZ2hlc3RQcmlvcml0eVBhZ2UgPSBudWxsOwogICAgdGhpcy5pZGxlVGltZW91dCA9IG51bGw7CiAgICB0aGlzLnByaW50aW5nID0gZmFsc2U7CiAgICB0aGlzLmlzVGh1bWJuYWlsVmlld0VuYWJsZWQgPSBmYWxzZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiaGFzVmlld2VyIiwgewogICAgICB2YWx1ZTogKCkgPT4gISF0aGlzLnBkZlZpZXdlcgogICAgfSk7CiAgfQogIHNldFZpZXdlcihwZGZWaWV3ZXIpIHsKICAgIHRoaXMucGRmVmlld2VyID0gcGRmVmlld2VyOwogIH0KICBzZXRUaHVtYm5haWxWaWV3ZXIocGRmVGh1bWJuYWlsVmlld2VyKSB7CiAgICB0aGlzLnBkZlRodW1ibmFpbFZpZXdlciA9IHBkZlRodW1ibmFpbFZpZXdlcjsKICB9CiAgaXNIaWdoZXN0UHJpb3JpdHkodmlldykgewogICAgcmV0dXJuIHRoaXMuaGlnaGVzdFByaW9yaXR5UGFnZSA9PT0gdmlldy5yZW5kZXJpbmdJZDsKICB9CiAgcmVuZGVySGlnaGVzdFByaW9yaXR5KGN1cnJlbnRseVZpc2libGVQYWdlcykgewogICAgaWYgKHRoaXMuaWRsZVRpbWVvdXQpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuaWRsZVRpbWVvdXQpOwogICAgICB0aGlzLmlkbGVUaW1lb3V0ID0gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLnBkZlZpZXdlci5mb3JjZVJlbmRlcmluZyhjdXJyZW50bHlWaXNpYmxlUGFnZXMpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLmlzVGh1bWJuYWlsVmlld0VuYWJsZWQgJiYgdGhpcy5wZGZUaHVtYm5haWxWaWV3ZXI/LmZvcmNlUmVuZGVyaW5nKCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMucHJpbnRpbmcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMub25JZGxlKSB7CiAgICAgIHRoaXMuaWRsZVRpbWVvdXQgPSBzZXRUaW1lb3V0KHRoaXMub25JZGxlLmJpbmQodGhpcyksIENMRUFOVVBfVElNRU9VVCk7CiAgICB9CiAgfQogIGdldEhpZ2hlc3RQcmlvcml0eSh2aXNpYmxlLCB2aWV3cywgc2Nyb2xsZWREb3duLCBwcmVSZW5kZXJFeHRyYSA9IGZhbHNlLCBpZ25vcmVEZXRhaWxWaWV3cyA9IGZhbHNlKSB7CiAgICBjb25zdCB2aXNpYmxlVmlld3MgPSB2aXNpYmxlLnZpZXdzLAogICAgICBudW1WaXNpYmxlID0gdmlzaWJsZVZpZXdzLmxlbmd0aDsKICAgIGlmIChudW1WaXNpYmxlID09PSAwKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1WaXNpYmxlOyBpKyspIHsKICAgICAgY29uc3QgdmlldyA9IHZpc2libGVWaWV3c1tpXS52aWV3OwogICAgICBpZiAoIXRoaXMuaXNWaWV3RmluaXNoZWQodmlldykpIHsKICAgICAgICByZXR1cm4gdmlldzsKICAgICAgfQogICAgfQogICAgaWYgKCFpZ25vcmVEZXRhaWxWaWV3cykgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVZpc2libGU7IGkrKykgewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGRldGFpbFZpZXcKICAgICAgICB9ID0gdmlzaWJsZVZpZXdzW2ldLnZpZXc7CiAgICAgICAgaWYgKGRldGFpbFZpZXcgJiYgIXRoaXMuaXNWaWV3RmluaXNoZWQoZGV0YWlsVmlldykpIHsKICAgICAgICAgIHJldHVybiBkZXRhaWxWaWV3OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29uc3QgZmlyc3RJZCA9IHZpc2libGUuZmlyc3QuaWQsCiAgICAgIGxhc3RJZCA9IHZpc2libGUubGFzdC5pZDsKICAgIGlmIChsYXN0SWQgLSBmaXJzdElkICsgMSA+IG51bVZpc2libGUpIHsKICAgICAgY29uc3QgdmlzaWJsZUlkcyA9IHZpc2libGUuaWRzOwogICAgICBmb3IgKGxldCBpID0gMSwgaWkgPSBsYXN0SWQgLSBmaXJzdElkOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IGhvbGVJZCA9IHNjcm9sbGVkRG93biA/IGZpcnN0SWQgKyBpIDogbGFzdElkIC0gaTsKICAgICAgICBpZiAodmlzaWJsZUlkcy5oYXMoaG9sZUlkKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGhvbGVWaWV3ID0gdmlld3NbaG9sZUlkIC0gMV07CiAgICAgICAgaWYgKCF0aGlzLmlzVmlld0ZpbmlzaGVkKGhvbGVWaWV3KSkgewogICAgICAgICAgcmV0dXJuIGhvbGVWaWV3OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IHByZVJlbmRlckluZGV4ID0gc2Nyb2xsZWREb3duID8gbGFzdElkIDogZmlyc3RJZCAtIDI7CiAgICBsZXQgcHJlUmVuZGVyVmlldyA9IHZpZXdzW3ByZVJlbmRlckluZGV4XTsKICAgIGlmIChwcmVSZW5kZXJWaWV3ICYmICF0aGlzLmlzVmlld0ZpbmlzaGVkKHByZVJlbmRlclZpZXcpKSB7CiAgICAgIHJldHVybiBwcmVSZW5kZXJWaWV3OwogICAgfQogICAgaWYgKHByZVJlbmRlckV4dHJhKSB7CiAgICAgIHByZVJlbmRlckluZGV4ICs9IHNjcm9sbGVkRG93biA/IDEgOiAtMTsKICAgICAgcHJlUmVuZGVyVmlldyA9IHZpZXdzW3ByZVJlbmRlckluZGV4XTsKICAgICAgaWYgKHByZVJlbmRlclZpZXcgJiYgIXRoaXMuaXNWaWV3RmluaXNoZWQocHJlUmVuZGVyVmlldykpIHsKICAgICAgICByZXR1cm4gcHJlUmVuZGVyVmlldzsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGlzVmlld0ZpbmlzaGVkKHZpZXcpIHsKICAgIHJldHVybiB2aWV3LnJlbmRlcmluZ1N0YXRlID09PSBSZW5kZXJpbmdTdGF0ZXMuRklOSVNIRUQ7CiAgfQogIHJlbmRlclZpZXcodmlldykgewogICAgc3dpdGNoICh2aWV3LnJlbmRlcmluZ1N0YXRlKSB7CiAgICAgIGNhc2UgUmVuZGVyaW5nU3RhdGVzLkZJTklTSEVEOgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgY2FzZSBSZW5kZXJpbmdTdGF0ZXMuUEFVU0VEOgogICAgICAgIHRoaXMuaGlnaGVzdFByaW9yaXR5UGFnZSA9IHZpZXcucmVuZGVyaW5nSWQ7CiAgICAgICAgdmlldy5yZXN1bWUoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBSZW5kZXJpbmdTdGF0ZXMuUlVOTklORzoKICAgICAgICB0aGlzLmhpZ2hlc3RQcmlvcml0eVBhZ2UgPSB2aWV3LnJlbmRlcmluZ0lkOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFJlbmRlcmluZ1N0YXRlcy5JTklUSUFMOgogICAgICAgIHRoaXMuaGlnaGVzdFByaW9yaXR5UGFnZSA9IHZpZXcucmVuZGVyaW5nSWQ7CiAgICAgICAgdmlldy5kcmF3KCkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgICB0aGlzLnJlbmRlckhpZ2hlc3RQcmlvcml0eSgpOwogICAgICAgIH0pLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnNvbGUuZXJyb3IoInJlbmRlclZpZXc6IiwgcmVhc29uKTsKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KfQoKOy8vIC4vd2ViL3BkZl9zY3JpcHRpbmdfbWFuYWdlci5qcwoKCmNsYXNzIFBERlNjcmlwdGluZ01hbmFnZXIgewogICNjbG9zZUNhcGFiaWxpdHkgPSBudWxsOwogICNkZXN0cm95Q2FwYWJpbGl0eSA9IG51bGw7CiAgI2RvY1Byb3BlcnRpZXMgPSBudWxsOwogICNldmVudEFib3J0Q29udHJvbGxlciA9IG51bGw7CiAgI2V2ZW50QnVzID0gbnVsbDsKICAjZXh0ZXJuYWxTZXJ2aWNlcyA9IG51bGw7CiAgI3BkZkRvY3VtZW50ID0gbnVsbDsKICAjcGRmVmlld2VyID0gbnVsbDsKICAjcmVhZHkgPSBmYWxzZTsKICAjc2NyaXB0aW5nID0gbnVsbDsKICAjd2lsbFByaW50Q2FwYWJpbGl0eSA9IG51bGw7CiAgY29uc3RydWN0b3IoewogICAgZXZlbnRCdXMsCiAgICBleHRlcm5hbFNlcnZpY2VzID0gbnVsbCwKICAgIGRvY1Byb3BlcnRpZXMgPSBudWxsCiAgfSkgewogICAgdGhpcy4jZXZlbnRCdXMgPSBldmVudEJ1czsKICAgIHRoaXMuI2V4dGVybmFsU2VydmljZXMgPSBleHRlcm5hbFNlcnZpY2VzOwogICAgdGhpcy4jZG9jUHJvcGVydGllcyA9IGRvY1Byb3BlcnRpZXM7CiAgfQogIHNldFZpZXdlcihwZGZWaWV3ZXIpIHsKICAgIHRoaXMuI3BkZlZpZXdlciA9IHBkZlZpZXdlcjsKICB9CiAgYXN5bmMgc2V0RG9jdW1lbnQocGRmRG9jdW1lbnQpIHsKICAgIGlmICh0aGlzLiNwZGZEb2N1bWVudCkgewogICAgICBhd2FpdCB0aGlzLiNkZXN0cm95U2NyaXB0aW5nKCk7CiAgICB9CiAgICB0aGlzLiNwZGZEb2N1bWVudCA9IHBkZkRvY3VtZW50OwogICAgaWYgKCFwZGZEb2N1bWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBbb2JqZWN0cywgY2FsY3VsYXRpb25PcmRlciwgZG9jQWN0aW9uc10gPSBhd2FpdCBQcm9taXNlLmFsbChbcGRmRG9jdW1lbnQuZ2V0RmllbGRPYmplY3RzKCksIHBkZkRvY3VtZW50LmdldENhbGN1bGF0aW9uT3JkZXJJZHMoKSwgcGRmRG9jdW1lbnQuZ2V0SlNBY3Rpb25zKCldKTsKICAgIGlmICghb2JqZWN0cyAmJiAhZG9jQWN0aW9ucykgewogICAgICBhd2FpdCB0aGlzLiNkZXN0cm95U2NyaXB0aW5nKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChwZGZEb2N1bWVudCAhPT0gdGhpcy4jcGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdHJ5IHsKICAgICAgdGhpcy4jc2NyaXB0aW5nID0gdGhpcy4jaW5pdFNjcmlwdGluZygpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5lcnJvcigic2V0RG9jdW1lbnQ6IiwgZXJyb3IpOwogICAgICBhd2FpdCB0aGlzLiNkZXN0cm95U2NyaXB0aW5nKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGV2ZW50QnVzID0gdGhpcy4jZXZlbnRCdXM7CiAgICB0aGlzLiNldmVudEFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGNvbnN0IHsKICAgICAgc2lnbmFsCiAgICB9ID0gdGhpcy4jZXZlbnRBYm9ydENvbnRyb2xsZXI7CiAgICBldmVudEJ1cy5fb24oInVwZGF0ZWZyb21zYW5kYm94IiwgZXZlbnQgPT4gewogICAgICBpZiAoZXZlbnQ/LnNvdXJjZSA9PT0gd2luZG93KSB7CiAgICAgICAgdGhpcy4jdXBkYXRlRnJvbVNhbmRib3goZXZlbnQuZGV0YWlsKTsKICAgICAgfQogICAgfSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgZXZlbnRCdXMuX29uKCJkaXNwYXRjaGV2ZW50aW5zYW5kYm94IiwgZXZlbnQgPT4gewogICAgICB0aGlzLiNzY3JpcHRpbmc/LmRpc3BhdGNoRXZlbnRJblNhbmRib3goZXZlbnQuZGV0YWlsKTsKICAgIH0sIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGV2ZW50QnVzLl9vbigicGFnZWNoYW5naW5nIiwgKHsKICAgICAgcGFnZU51bWJlciwKICAgICAgcHJldmlvdXMKICAgIH0pID0+IHsKICAgICAgaWYgKHBhZ2VOdW1iZXIgPT09IHByZXZpb3VzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuI2Rpc3BhdGNoUGFnZUNsb3NlKHByZXZpb3VzKTsKICAgICAgdGhpcy4jZGlzcGF0Y2hQYWdlT3BlbihwYWdlTnVtYmVyKTsKICAgIH0sIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGV2ZW50QnVzLl9vbigicGFnZXJlbmRlcmVkIiwgKHsKICAgICAgcGFnZU51bWJlcgogICAgfSkgPT4gewogICAgICBpZiAoIXRoaXMuX3BhZ2VPcGVuUGVuZGluZy5oYXMocGFnZU51bWJlcikpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHBhZ2VOdW1iZXIgIT09IHRoaXMuI3BkZlZpZXdlci5jdXJyZW50UGFnZU51bWJlcikgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLiNkaXNwYXRjaFBhZ2VPcGVuKHBhZ2VOdW1iZXIpOwogICAgfSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgZXZlbnRCdXMuX29uKCJwYWdlc2Rlc3Ryb3kiLCBhc3luYyAoKSA9PiB7CiAgICAgIGF3YWl0IHRoaXMuI2Rpc3BhdGNoUGFnZUNsb3NlKHRoaXMuI3BkZlZpZXdlci5jdXJyZW50UGFnZU51bWJlcik7CiAgICAgIGF3YWl0IHRoaXMuI3NjcmlwdGluZz8uZGlzcGF0Y2hFdmVudEluU2FuZGJveCh7CiAgICAgICAgaWQ6ICJkb2MiLAogICAgICAgIG5hbWU6ICJXaWxsQ2xvc2UiCiAgICAgIH0pOwogICAgICB0aGlzLiNjbG9zZUNhcGFiaWxpdHk/LnJlc29sdmUoKTsKICAgIH0sIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGRvY1Byb3BlcnRpZXMgPSBhd2FpdCB0aGlzLiNkb2NQcm9wZXJ0aWVzKHBkZkRvY3VtZW50KTsKICAgICAgaWYgKHBkZkRvY3VtZW50ICE9PSB0aGlzLiNwZGZEb2N1bWVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBhd2FpdCB0aGlzLiNzY3JpcHRpbmcuY3JlYXRlU2FuZGJveCh7CiAgICAgICAgb2JqZWN0cywKICAgICAgICBjYWxjdWxhdGlvbk9yZGVyLAogICAgICAgIGFwcEluZm86IHsKICAgICAgICAgIHBsYXRmb3JtOiBuYXZpZ2F0b3IucGxhdGZvcm0sCiAgICAgICAgICBsYW5ndWFnZTogbmF2aWdhdG9yLmxhbmd1YWdlCiAgICAgICAgfSwKICAgICAgICBkb2NJbmZvOiB7CiAgICAgICAgICAuLi5kb2NQcm9wZXJ0aWVzLAogICAgICAgICAgYWN0aW9uczogZG9jQWN0aW9ucwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKCJzYW5kYm94Y3JlYXRlZCIsIHsKICAgICAgICBzb3VyY2U6IHRoaXMKICAgICAgfSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCJzZXREb2N1bWVudDoiLCBlcnJvcik7CiAgICAgIGF3YWl0IHRoaXMuI2Rlc3Ryb3lTY3JpcHRpbmcoKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgYXdhaXQgdGhpcy4jc2NyaXB0aW5nPy5kaXNwYXRjaEV2ZW50SW5TYW5kYm94KHsKICAgICAgaWQ6ICJkb2MiLAogICAgICBuYW1lOiAiT3BlbiIKICAgIH0pOwogICAgYXdhaXQgdGhpcy4jZGlzcGF0Y2hQYWdlT3Blbih0aGlzLiNwZGZWaWV3ZXIuY3VycmVudFBhZ2VOdW1iZXIsIHRydWUpOwogICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB7CiAgICAgIGlmIChwZGZEb2N1bWVudCA9PT0gdGhpcy4jcGRmRG9jdW1lbnQpIHsKICAgICAgICB0aGlzLiNyZWFkeSA9IHRydWU7CiAgICAgIH0KICAgIH0pOwogIH0KICBhc3luYyBkaXNwYXRjaFdpbGxTYXZlKCkgewogICAgcmV0dXJuIHRoaXMuI3NjcmlwdGluZz8uZGlzcGF0Y2hFdmVudEluU2FuZGJveCh7CiAgICAgIGlkOiAiZG9jIiwKICAgICAgbmFtZTogIldpbGxTYXZlIgogICAgfSk7CiAgfQogIGFzeW5jIGRpc3BhdGNoRGlkU2F2ZSgpIHsKICAgIHJldHVybiB0aGlzLiNzY3JpcHRpbmc/LmRpc3BhdGNoRXZlbnRJblNhbmRib3goewogICAgICBpZDogImRvYyIsCiAgICAgIG5hbWU6ICJEaWRTYXZlIgogICAgfSk7CiAgfQogIGFzeW5jIGRpc3BhdGNoV2lsbFByaW50KCkgewogICAgaWYgKCF0aGlzLiNzY3JpcHRpbmcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgYXdhaXQgdGhpcy4jd2lsbFByaW50Q2FwYWJpbGl0eT8ucHJvbWlzZTsKICAgIHRoaXMuI3dpbGxQcmludENhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMuI3NjcmlwdGluZy5kaXNwYXRjaEV2ZW50SW5TYW5kYm94KHsKICAgICAgICBpZDogImRvYyIsCiAgICAgICAgbmFtZTogIldpbGxQcmludCIKICAgICAgfSk7CiAgICB9IGNhdGNoIChleCkgewogICAgICB0aGlzLiN3aWxsUHJpbnRDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgdGhpcy4jd2lsbFByaW50Q2FwYWJpbGl0eSA9IG51bGw7CiAgICAgIHRocm93IGV4OwogICAgfQogICAgYXdhaXQgdGhpcy4jd2lsbFByaW50Q2FwYWJpbGl0eS5wcm9taXNlOwogIH0KICBhc3luYyBkaXNwYXRjaERpZFByaW50KCkgewogICAgcmV0dXJuIHRoaXMuI3NjcmlwdGluZz8uZGlzcGF0Y2hFdmVudEluU2FuZGJveCh7CiAgICAgIGlkOiAiZG9jIiwKICAgICAgbmFtZTogIkRpZFByaW50IgogICAgfSk7CiAgfQogIGdldCBkZXN0cm95UHJvbWlzZSgpIHsKICAgIHJldHVybiB0aGlzLiNkZXN0cm95Q2FwYWJpbGl0eT8ucHJvbWlzZSB8fCBudWxsOwogIH0KICBnZXQgcmVhZHkoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZHk7CiAgfQogIGdldCBfcGFnZU9wZW5QZW5kaW5nKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX3BhZ2VPcGVuUGVuZGluZyIsIG5ldyBTZXQoKSk7CiAgfQogIGdldCBfdmlzaXRlZFBhZ2VzKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX3Zpc2l0ZWRQYWdlcyIsIG5ldyBNYXAoKSk7CiAgfQogIGFzeW5jICN1cGRhdGVGcm9tU2FuZGJveChkZXRhaWwpIHsKICAgIGNvbnN0IHBkZlZpZXdlciA9IHRoaXMuI3BkZlZpZXdlcjsKICAgIGNvbnN0IGlzSW5QcmVzZW50YXRpb25Nb2RlID0gcGRmVmlld2VyLmlzSW5QcmVzZW50YXRpb25Nb2RlIHx8IHBkZlZpZXdlci5pc0NoYW5naW5nUHJlc2VudGF0aW9uTW9kZTsKICAgIGNvbnN0IHsKICAgICAgaWQsCiAgICAgIHNpYmxpbmdzLAogICAgICBjb21tYW5kLAogICAgICB2YWx1ZQogICAgfSA9IGRldGFpbDsKICAgIGlmICghaWQpIHsKICAgICAgc3dpdGNoIChjb21tYW5kKSB7CiAgICAgICAgY2FzZSAiY2xlYXIiOgogICAgICAgICAgY29uc29sZS5jbGVhcigpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZXJyb3IiOgogICAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsYXlvdXQiOgogICAgICAgICAgaWYgKCFpc0luUHJlc2VudGF0aW9uTW9kZSkgewogICAgICAgICAgICBjb25zdCBtb2RlcyA9IGFwaVBhZ2VMYXlvdXRUb1ZpZXdlck1vZGVzKHZhbHVlKTsKICAgICAgICAgICAgcGRmVmlld2VyLnNwcmVhZE1vZGUgPSBtb2Rlcy5zcHJlYWRNb2RlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicGFnZS1udW0iOgogICAgICAgICAgcGRmVmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyID0gdmFsdWUgKyAxOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicHJpbnQiOgogICAgICAgICAgYXdhaXQgcGRmVmlld2VyLnBhZ2VzUHJvbWlzZTsKICAgICAgICAgIHRoaXMuI2V2ZW50QnVzLmRpc3BhdGNoKCJwcmludCIsIHsKICAgICAgICAgICAgc291cmNlOiB0aGlzCiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInByaW50bG4iOgogICAgICAgICAgY29uc29sZS5sb2codmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiem9vbSI6CiAgICAgICAgICBpZiAoIWlzSW5QcmVzZW50YXRpb25Nb2RlKSB7CiAgICAgICAgICAgIHBkZlZpZXdlci5jdXJyZW50U2NhbGVWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiU2F2ZUFzIjoKICAgICAgICAgIHRoaXMuI2V2ZW50QnVzLmRpc3BhdGNoKCJkb3dubG9hZCIsIHsKICAgICAgICAgICAgc291cmNlOiB0aGlzCiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkZpcnN0UGFnZSI6CiAgICAgICAgICBwZGZWaWV3ZXIuY3VycmVudFBhZ2VOdW1iZXIgPSAxOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiTGFzdFBhZ2UiOgogICAgICAgICAgcGRmVmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyID0gcGRmVmlld2VyLnBhZ2VzQ291bnQ7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJOZXh0UGFnZSI6CiAgICAgICAgICBwZGZWaWV3ZXIubmV4dFBhZ2UoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlByZXZQYWdlIjoKICAgICAgICAgIHBkZlZpZXdlci5wcmV2aW91c1BhZ2UoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlpvb21WaWV3SW4iOgogICAgICAgICAgaWYgKCFpc0luUHJlc2VudGF0aW9uTW9kZSkgewogICAgICAgICAgICBwZGZWaWV3ZXIuaW5jcmVhc2VTY2FsZSgpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiWm9vbVZpZXdPdXQiOgogICAgICAgICAgaWYgKCFpc0luUHJlc2VudGF0aW9uTW9kZSkgewogICAgICAgICAgICBwZGZWaWV3ZXIuZGVjcmVhc2VTY2FsZSgpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiV2lsbFByaW50RmluaXNoZWQiOgogICAgICAgICAgdGhpcy4jd2lsbFByaW50Q2FwYWJpbGl0eT8ucmVzb2x2ZSgpOwogICAgICAgICAgdGhpcy4jd2lsbFByaW50Q2FwYWJpbGl0eSA9IG51bGw7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoaXNJblByZXNlbnRhdGlvbk1vZGUgJiYgZGV0YWlsLmZvY3VzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGRlbGV0ZSBkZXRhaWwuaWQ7CiAgICBkZWxldGUgZGV0YWlsLnNpYmxpbmdzOwogICAgY29uc3QgaWRzID0gc2libGluZ3MgPyBbaWQsIC4uLnNpYmxpbmdzXSA6IFtpZF07CiAgICBmb3IgKGNvbnN0IGVsZW1lbnRJZCBvZiBpZHMpIHsKICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWVsZW1lbnQtaWQ9IiR7ZWxlbWVudElkfSJdYCk7CiAgICAgIGlmIChlbGVtZW50KSB7CiAgICAgICAgZWxlbWVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgidXBkYXRlZnJvbXNhbmRib3giLCB7CiAgICAgICAgICBkZXRhaWwKICAgICAgICB9KSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4jcGRmRG9jdW1lbnQ/LmFubm90YXRpb25TdG9yYWdlLnNldFZhbHVlKGVsZW1lbnRJZCwgZGV0YWlsKTsKICAgICAgfQogICAgfQogIH0KICBhc3luYyAjZGlzcGF0Y2hQYWdlT3BlbihwYWdlTnVtYmVyLCBpbml0aWFsaXplID0gZmFsc2UpIHsKICAgIGNvbnN0IHBkZkRvY3VtZW50ID0gdGhpcy4jcGRmRG9jdW1lbnQsCiAgICAgIHZpc2l0ZWRQYWdlcyA9IHRoaXMuX3Zpc2l0ZWRQYWdlczsKICAgIGlmIChpbml0aWFsaXplKSB7CiAgICAgIHRoaXMuI2Nsb3NlQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgfQogICAgaWYgKCF0aGlzLiNjbG9zZUNhcGFiaWxpdHkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGFnZVZpZXcgPSB0aGlzLiNwZGZWaWV3ZXIuZ2V0UGFnZVZpZXcocGFnZU51bWJlciAtIDEpOwogICAgaWYgKHBhZ2VWaWV3Py5yZW5kZXJpbmdTdGF0ZSAhPT0gUmVuZGVyaW5nU3RhdGVzLkZJTklTSEVEKSB7CiAgICAgIHRoaXMuX3BhZ2VPcGVuUGVuZGluZy5hZGQocGFnZU51bWJlcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX3BhZ2VPcGVuUGVuZGluZy5kZWxldGUocGFnZU51bWJlcik7CiAgICBjb25zdCBhY3Rpb25zUHJvbWlzZSA9IChhc3luYyAoKSA9PiB7CiAgICAgIGNvbnN0IGFjdGlvbnMgPSBhd2FpdCAoIXZpc2l0ZWRQYWdlcy5oYXMocGFnZU51bWJlcikgPyBwYWdlVmlldy5wZGZQYWdlPy5nZXRKU0FjdGlvbnMoKSA6IG51bGwpOwogICAgICBpZiAocGRmRG9jdW1lbnQgIT09IHRoaXMuI3BkZkRvY3VtZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGF3YWl0IHRoaXMuI3NjcmlwdGluZz8uZGlzcGF0Y2hFdmVudEluU2FuZGJveCh7CiAgICAgICAgaWQ6ICJwYWdlIiwKICAgICAgICBuYW1lOiAiUGFnZU9wZW4iLAogICAgICAgIHBhZ2VOdW1iZXIsCiAgICAgICAgYWN0aW9ucwogICAgICB9KTsKICAgIH0pKCk7CiAgICB2aXNpdGVkUGFnZXMuc2V0KHBhZ2VOdW1iZXIsIGFjdGlvbnNQcm9taXNlKTsKICB9CiAgYXN5bmMgI2Rpc3BhdGNoUGFnZUNsb3NlKHBhZ2VOdW1iZXIpIHsKICAgIGNvbnN0IHBkZkRvY3VtZW50ID0gdGhpcy4jcGRmRG9jdW1lbnQsCiAgICAgIHZpc2l0ZWRQYWdlcyA9IHRoaXMuX3Zpc2l0ZWRQYWdlczsKICAgIGlmICghdGhpcy4jY2xvc2VDYXBhYmlsaXR5KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9wYWdlT3BlblBlbmRpbmcuaGFzKHBhZ2VOdW1iZXIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFjdGlvbnNQcm9taXNlID0gdmlzaXRlZFBhZ2VzLmdldChwYWdlTnVtYmVyKTsKICAgIGlmICghYWN0aW9uc1Byb21pc2UpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdmlzaXRlZFBhZ2VzLnNldChwYWdlTnVtYmVyLCBudWxsKTsKICAgIGF3YWl0IGFjdGlvbnNQcm9taXNlOwogICAgaWYgKHBkZkRvY3VtZW50ICE9PSB0aGlzLiNwZGZEb2N1bWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBhd2FpdCB0aGlzLiNzY3JpcHRpbmc/LmRpc3BhdGNoRXZlbnRJblNhbmRib3goewogICAgICBpZDogInBhZ2UiLAogICAgICBuYW1lOiAiUGFnZUNsb3NlIiwKICAgICAgcGFnZU51bWJlcgogICAgfSk7CiAgfQogICNpbml0U2NyaXB0aW5nKCkgewogICAgdGhpcy4jZGVzdHJveUNhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIGlmICh0aGlzLiNzY3JpcHRpbmcpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCIjaW5pdFNjcmlwdGluZzogU2NyaXB0aW5nIGFscmVhZHkgZXhpc3RzLiIpOwogICAgfQogICAgcmV0dXJuIHRoaXMuI2V4dGVybmFsU2VydmljZXMuY3JlYXRlU2NyaXB0aW5nKCk7CiAgfQogIGFzeW5jICNkZXN0cm95U2NyaXB0aW5nKCkgewogICAgaWYgKCF0aGlzLiNzY3JpcHRpbmcpIHsKICAgICAgdGhpcy4jcGRmRG9jdW1lbnQgPSBudWxsOwogICAgICB0aGlzLiNkZXN0cm95Q2FwYWJpbGl0eT8ucmVzb2x2ZSgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy4jY2xvc2VDYXBhYmlsaXR5KSB7CiAgICAgIGF3YWl0IFByb21pc2UucmFjZShbdGhpcy4jY2xvc2VDYXBhYmlsaXR5LnByb21pc2UsIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgIHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCk7CiAgICAgIH0pXSkuY2F0Y2goKCkgPT4ge30pOwogICAgICB0aGlzLiNjbG9zZUNhcGFiaWxpdHkgPSBudWxsOwogICAgfQogICAgdGhpcy4jcGRmRG9jdW1lbnQgPSBudWxsOwogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy4jc2NyaXB0aW5nLmRlc3Ryb3lTYW5kYm94KCk7CiAgICB9IGNhdGNoIHt9CiAgICB0aGlzLiN3aWxsUHJpbnRDYXBhYmlsaXR5Py5yZWplY3QobmV3IEVycm9yKCJTY3JpcHRpbmcgZGVzdHJveWVkLiIpKTsKICAgIHRoaXMuI3dpbGxQcmludENhcGFiaWxpdHkgPSBudWxsOwogICAgdGhpcy4jZXZlbnRBYm9ydENvbnRyb2xsZXI/LmFib3J0KCk7CiAgICB0aGlzLiNldmVudEFib3J0Q29udHJvbGxlciA9IG51bGw7CiAgICB0aGlzLl9wYWdlT3BlblBlbmRpbmcuY2xlYXIoKTsKICAgIHRoaXMuX3Zpc2l0ZWRQYWdlcy5jbGVhcigpOwogICAgdGhpcy4jc2NyaXB0aW5nID0gbnVsbDsKICAgIHRoaXMuI3JlYWR5ID0gZmFsc2U7CiAgICB0aGlzLiNkZXN0cm95Q2FwYWJpbGl0eT8ucmVzb2x2ZSgpOwogIH0KfQoKOy8vIC4vd2ViL3BkZl9zaWRlYmFyLmpzCgpjb25zdCBTSURFQkFSX1dJRFRIX1ZBUiA9ICItLXNpZGViYXItd2lkdGgiOwpjb25zdCBTSURFQkFSX01JTl9XSURUSCA9IDIwMDsKY29uc3QgU0lERUJBUl9SRVNJWklOR19DTEFTUyA9ICJzaWRlYmFyUmVzaXppbmciOwpjb25zdCBVSV9OT1RJRklDQVRJT05fQ0xBU1MgPSAicGRmU2lkZWJhck5vdGlmaWNhdGlvbiI7CmNsYXNzIFBERlNpZGViYXIgewogICNpc1JUTCA9IGZhbHNlOwogICNtb3VzZUFDID0gbnVsbDsKICAjb3V0ZXJDb250YWluZXJXaWR0aCA9IG51bGw7CiAgI3dpZHRoID0gbnVsbDsKICBjb25zdHJ1Y3Rvcih7CiAgICBlbGVtZW50cywKICAgIGV2ZW50QnVzLAogICAgbDEwbgogIH0pIHsKICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7CiAgICB0aGlzLmFjdGl2ZSA9IFNpZGViYXJWaWV3LlRIVU1CUzsKICAgIHRoaXMuaXNJbml0aWFsVmlld1NldCA9IGZhbHNlOwogICAgdGhpcy5pc0luaXRpYWxFdmVudERpc3BhdGNoZWQgPSBmYWxzZTsKICAgIHRoaXMub25Ub2dnbGVkID0gbnVsbDsKICAgIHRoaXMub25VcGRhdGVUaHVtYm5haWxzID0gbnVsbDsKICAgIHRoaXMub3V0ZXJDb250YWluZXIgPSBlbGVtZW50cy5vdXRlckNvbnRhaW5lcjsKICAgIHRoaXMuc2lkZWJhckNvbnRhaW5lciA9IGVsZW1lbnRzLnNpZGViYXJDb250YWluZXI7CiAgICB0aGlzLnRvZ2dsZUJ1dHRvbiA9IGVsZW1lbnRzLnRvZ2dsZUJ1dHRvbjsKICAgIHRoaXMucmVzaXplciA9IGVsZW1lbnRzLnJlc2l6ZXI7CiAgICB0aGlzLnRodW1ibmFpbEJ1dHRvbiA9IGVsZW1lbnRzLnRodW1ibmFpbEJ1dHRvbjsKICAgIHRoaXMub3V0bGluZUJ1dHRvbiA9IGVsZW1lbnRzLm91dGxpbmVCdXR0b247CiAgICB0aGlzLmF0dGFjaG1lbnRzQnV0dG9uID0gZWxlbWVudHMuYXR0YWNobWVudHNCdXR0b247CiAgICB0aGlzLmxheWVyc0J1dHRvbiA9IGVsZW1lbnRzLmxheWVyc0J1dHRvbjsKICAgIHRoaXMudGh1bWJuYWlsVmlldyA9IGVsZW1lbnRzLnRodW1ibmFpbFZpZXc7CiAgICB0aGlzLm91dGxpbmVWaWV3ID0gZWxlbWVudHMub3V0bGluZVZpZXc7CiAgICB0aGlzLmF0dGFjaG1lbnRzVmlldyA9IGVsZW1lbnRzLmF0dGFjaG1lbnRzVmlldzsKICAgIHRoaXMubGF5ZXJzVmlldyA9IGVsZW1lbnRzLmxheWVyc1ZpZXc7CiAgICB0aGlzLl9jdXJyZW50T3V0bGluZUl0ZW1CdXR0b24gPSBlbGVtZW50cy5jdXJyZW50T3V0bGluZUl0ZW1CdXR0b247CiAgICB0aGlzLmV2ZW50QnVzID0gZXZlbnRCdXM7CiAgICB0aGlzLiNpc1JUTCA9IGwxMG4uZ2V0RGlyZWN0aW9uKCkgPT09ICJydGwiOwogICAgdGhpcy4jYWRkRXZlbnRMaXN0ZW5lcnMoKTsKICB9CiAgcmVzZXQoKSB7CiAgICB0aGlzLmlzSW5pdGlhbFZpZXdTZXQgPSBmYWxzZTsKICAgIHRoaXMuaXNJbml0aWFsRXZlbnREaXNwYXRjaGVkID0gZmFsc2U7CiAgICB0aGlzLiNoaWRlVUlOb3RpZmljYXRpb24odHJ1ZSk7CiAgICB0aGlzLnN3aXRjaFZpZXcoU2lkZWJhclZpZXcuVEhVTUJTKTsKICAgIHRoaXMub3V0bGluZUJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlOwogICAgdGhpcy5hdHRhY2htZW50c0J1dHRvbi5kaXNhYmxlZCA9IGZhbHNlOwogICAgdGhpcy5sYXllcnNCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTsKICAgIHRoaXMuX2N1cnJlbnRPdXRsaW5lSXRlbUJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7CiAgfQogIGdldCB2aXNpYmxlVmlldygpIHsKICAgIHJldHVybiB0aGlzLmlzT3BlbiA/IHRoaXMuYWN0aXZlIDogU2lkZWJhclZpZXcuTk9ORTsKICB9CiAgc2V0SW5pdGlhbFZpZXcodmlldyA9IFNpZGViYXJWaWV3Lk5PTkUpIHsKICAgIGlmICh0aGlzLmlzSW5pdGlhbFZpZXdTZXQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5pc0luaXRpYWxWaWV3U2V0ID0gdHJ1ZTsKICAgIGlmICh2aWV3ID09PSBTaWRlYmFyVmlldy5OT05FIHx8IHZpZXcgPT09IFNpZGViYXJWaWV3LlVOS05PV04pIHsKICAgICAgdGhpcy4jZGlzcGF0Y2hFdmVudCgpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnN3aXRjaFZpZXcodmlldywgdHJ1ZSk7CiAgICBpZiAoIXRoaXMuaXNJbml0aWFsRXZlbnREaXNwYXRjaGVkKSB7CiAgICAgIHRoaXMuI2Rpc3BhdGNoRXZlbnQoKTsKICAgIH0KICB9CiAgc3dpdGNoVmlldyh2aWV3LCBmb3JjZU9wZW4gPSBmYWxzZSkgewogICAgY29uc3QgaXNWaWV3Q2hhbmdlZCA9IHZpZXcgIT09IHRoaXMuYWN0aXZlOwogICAgbGV0IGZvcmNlUmVuZGVyaW5nID0gZmFsc2U7CiAgICBzd2l0Y2ggKHZpZXcpIHsKICAgICAgY2FzZSBTaWRlYmFyVmlldy5OT05FOgogICAgICAgIGlmICh0aGlzLmlzT3BlbikgewogICAgICAgICAgdGhpcy5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIGNhc2UgU2lkZWJhclZpZXcuVEhVTUJTOgogICAgICAgIGlmICh0aGlzLmlzT3BlbiAmJiBpc1ZpZXdDaGFuZ2VkKSB7CiAgICAgICAgICBmb3JjZVJlbmRlcmluZyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFNpZGViYXJWaWV3Lk9VVExJTkU6CiAgICAgICAgaWYgKHRoaXMub3V0bGluZUJ1dHRvbi5kaXNhYmxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSBTaWRlYmFyVmlldy5BVFRBQ0hNRU5UUzoKICAgICAgICBpZiAodGhpcy5hdHRhY2htZW50c0J1dHRvbi5kaXNhYmxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSBTaWRlYmFyVmlldy5MQVlFUlM6CiAgICAgICAgaWYgKHRoaXMubGF5ZXJzQnV0dG9uLmRpc2FibGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnNvbGUuZXJyb3IoYFBERlNpZGViYXIuc3dpdGNoVmlldzogIiR7dmlld30iIGlzIG5vdCBhIHZhbGlkIHZpZXcuYCk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5hY3RpdmUgPSB2aWV3OwogICAgdG9nZ2xlQ2hlY2tlZEJ0bih0aGlzLnRodW1ibmFpbEJ1dHRvbiwgdmlldyA9PT0gU2lkZWJhclZpZXcuVEhVTUJTLCB0aGlzLnRodW1ibmFpbFZpZXcpOwogICAgdG9nZ2xlQ2hlY2tlZEJ0bih0aGlzLm91dGxpbmVCdXR0b24sIHZpZXcgPT09IFNpZGViYXJWaWV3Lk9VVExJTkUsIHRoaXMub3V0bGluZVZpZXcpOwogICAgdG9nZ2xlQ2hlY2tlZEJ0bih0aGlzLmF0dGFjaG1lbnRzQnV0dG9uLCB2aWV3ID09PSBTaWRlYmFyVmlldy5BVFRBQ0hNRU5UUywgdGhpcy5hdHRhY2htZW50c1ZpZXcpOwogICAgdG9nZ2xlQ2hlY2tlZEJ0bih0aGlzLmxheWVyc0J1dHRvbiwgdmlldyA9PT0gU2lkZWJhclZpZXcuTEFZRVJTLCB0aGlzLmxheWVyc1ZpZXcpOwogICAgaWYgKGZvcmNlT3BlbiAmJiAhdGhpcy5pc09wZW4pIHsKICAgICAgdGhpcy5vcGVuKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChmb3JjZVJlbmRlcmluZykgewogICAgICB0aGlzLm9uVXBkYXRlVGh1bWJuYWlscygpOwogICAgICB0aGlzLm9uVG9nZ2xlZCgpOwogICAgfQogICAgaWYgKGlzVmlld0NoYW5nZWQpIHsKICAgICAgdGhpcy4jZGlzcGF0Y2hFdmVudCgpOwogICAgfQogIH0KICBvcGVuKCkgewogICAgaWYgKHRoaXMuaXNPcGVuKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTsKICAgIHRvZ2dsZUV4cGFuZGVkQnRuKHRoaXMudG9nZ2xlQnV0dG9uLCB0cnVlKTsKICAgIHRoaXMub3V0ZXJDb250YWluZXIuY2xhc3NMaXN0LmFkZCgic2lkZWJhck1vdmluZyIsICJzaWRlYmFyT3BlbiIpOwogICAgaWYgKHRoaXMuYWN0aXZlID09PSBTaWRlYmFyVmlldy5USFVNQlMpIHsKICAgICAgdGhpcy5vblVwZGF0ZVRodW1ibmFpbHMoKTsKICAgIH0KICAgIHRoaXMub25Ub2dnbGVkKCk7CiAgICB0aGlzLiNkaXNwYXRjaEV2ZW50KCk7CiAgICB0aGlzLiNoaWRlVUlOb3RpZmljYXRpb24oKTsKICB9CiAgY2xvc2UoZXZ0ID0gbnVsbCkgewogICAgaWYgKCF0aGlzLmlzT3BlbikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmlzT3BlbiA9IGZhbHNlOwogICAgdG9nZ2xlRXhwYW5kZWRCdG4odGhpcy50b2dnbGVCdXR0b24sIGZhbHNlKTsKICAgIHRoaXMub3V0ZXJDb250YWluZXIuY2xhc3NMaXN0LmFkZCgic2lkZWJhck1vdmluZyIpOwogICAgdGhpcy5vdXRlckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCJzaWRlYmFyT3BlbiIpOwogICAgdGhpcy5vblRvZ2dsZWQoKTsKICAgIHRoaXMuI2Rpc3BhdGNoRXZlbnQoKTsKICAgIGlmIChldnQ/LmRldGFpbCA+IDApIHsKICAgICAgdGhpcy50b2dnbGVCdXR0b24uYmx1cigpOwogICAgfQogIH0KICB0b2dnbGUoZXZ0ID0gbnVsbCkgewogICAgaWYgKHRoaXMuaXNPcGVuKSB7CiAgICAgIHRoaXMuY2xvc2UoZXZ0KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMub3BlbigpOwogICAgfQogIH0KICAjZGlzcGF0Y2hFdmVudCgpIHsKICAgIGlmICh0aGlzLmlzSW5pdGlhbFZpZXdTZXQpIHsKICAgICAgdGhpcy5pc0luaXRpYWxFdmVudERpc3BhdGNoZWQgfHw9IHRydWU7CiAgICB9CiAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJzaWRlYmFydmlld2NoYW5nZWQiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgdmlldzogdGhpcy52aXNpYmxlVmlldwogICAgfSk7CiAgfQogICNzaG93VUlOb3RpZmljYXRpb24oKSB7CiAgICB0aGlzLnRvZ2dsZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsICJwZGZqcy10b2dnbGUtc2lkZWJhci1ub3RpZmljYXRpb24tYnV0dG9uIik7CiAgICBpZiAoIXRoaXMuaXNPcGVuKSB7CiAgICAgIHRoaXMudG9nZ2xlQnV0dG9uLmNsYXNzTGlzdC5hZGQoVUlfTk9USUZJQ0FUSU9OX0NMQVNTKTsKICAgIH0KICB9CiAgI2hpZGVVSU5vdGlmaWNhdGlvbihyZXNldCA9IGZhbHNlKSB7CiAgICBpZiAodGhpcy5pc09wZW4gfHwgcmVzZXQpIHsKICAgICAgdGhpcy50b2dnbGVCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShVSV9OT1RJRklDQVRJT05fQ0xBU1MpOwogICAgfQogICAgaWYgKHJlc2V0KSB7CiAgICAgIHRoaXMudG9nZ2xlQnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgInBkZmpzLXRvZ2dsZS1zaWRlYmFyLWJ1dHRvbiIpOwogICAgfQogIH0KICAjYWRkRXZlbnRMaXN0ZW5lcnMoKSB7CiAgICBjb25zdCB7CiAgICAgIGV2ZW50QnVzLAogICAgICBvdXRlckNvbnRhaW5lcgogICAgfSA9IHRoaXM7CiAgICB0aGlzLnNpZGViYXJDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigidHJhbnNpdGlvbmVuZCIsIGV2dCA9PiB7CiAgICAgIGlmIChldnQudGFyZ2V0ID09PSB0aGlzLnNpZGViYXJDb250YWluZXIpIHsKICAgICAgICBvdXRlckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCJzaWRlYmFyTW92aW5nIik7CiAgICAgICAgZXZlbnRCdXMuZGlzcGF0Y2goInJlc2l6ZSIsIHsKICAgICAgICAgIHNvdXJjZTogdGhpcwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMudG9nZ2xlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXZ0ID0+IHsKICAgICAgdGhpcy50b2dnbGUoZXZ0KTsKICAgIH0pOwogICAgdGhpcy50aHVtYm5haWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIHRoaXMuc3dpdGNoVmlldyhTaWRlYmFyVmlldy5USFVNQlMpOwogICAgfSk7CiAgICB0aGlzLm91dGxpbmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIHRoaXMuc3dpdGNoVmlldyhTaWRlYmFyVmlldy5PVVRMSU5FKTsKICAgIH0pOwogICAgdGhpcy5vdXRsaW5lQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgKCkgPT4gewogICAgICBldmVudEJ1cy5kaXNwYXRjaCgidG9nZ2xlb3V0bGluZXRyZWUiLCB7CiAgICAgICAgc291cmNlOiB0aGlzCiAgICAgIH0pOwogICAgfSk7CiAgICB0aGlzLmF0dGFjaG1lbnRzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICB0aGlzLnN3aXRjaFZpZXcoU2lkZWJhclZpZXcuQVRUQUNITUVOVFMpOwogICAgfSk7CiAgICB0aGlzLmxheWVyc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgdGhpcy5zd2l0Y2hWaWV3KFNpZGViYXJWaWV3LkxBWUVSUyk7CiAgICB9KTsKICAgIHRoaXMubGF5ZXJzQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgKCkgPT4gewogICAgICBldmVudEJ1cy5kaXNwYXRjaCgicmVzZXRsYXllcnMiLCB7CiAgICAgICAgc291cmNlOiB0aGlzCiAgICAgIH0pOwogICAgfSk7CiAgICB0aGlzLl9jdXJyZW50T3V0bGluZUl0ZW1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKCJjdXJyZW50b3V0bGluZWl0ZW0iLCB7CiAgICAgICAgc291cmNlOiB0aGlzCiAgICAgIH0pOwogICAgfSk7CiAgICBjb25zdCBvblRyZWVMb2FkZWQgPSAoY291bnQsIGJ1dHRvbiwgdmlldykgPT4gewogICAgICBidXR0b24uZGlzYWJsZWQgPSAhY291bnQ7CiAgICAgIGlmIChjb3VudCkgewogICAgICAgIHRoaXMuI3Nob3dVSU5vdGlmaWNhdGlvbigpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuYWN0aXZlID09PSB2aWV3KSB7CiAgICAgICAgdGhpcy5zd2l0Y2hWaWV3KFNpZGViYXJWaWV3LlRIVU1CUyk7CiAgICAgIH0KICAgIH07CiAgICBldmVudEJ1cy5fb24oIm91dGxpbmVsb2FkZWQiLCBldnQgPT4gewogICAgICBvblRyZWVMb2FkZWQoZXZ0Lm91dGxpbmVDb3VudCwgdGhpcy5vdXRsaW5lQnV0dG9uLCBTaWRlYmFyVmlldy5PVVRMSU5FKTsKICAgICAgZXZ0LmN1cnJlbnRPdXRsaW5lSXRlbVByb21pc2UudGhlbihlbmFibGVkID0+IHsKICAgICAgICBpZiAoIXRoaXMuaXNJbml0aWFsVmlld1NldCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLl9jdXJyZW50T3V0bGluZUl0ZW1CdXR0b24uZGlzYWJsZWQgPSAhZW5hYmxlZDsKICAgICAgfSk7CiAgICB9KTsKICAgIGV2ZW50QnVzLl9vbigiYXR0YWNobWVudHNsb2FkZWQiLCBldnQgPT4gewogICAgICBvblRyZWVMb2FkZWQoZXZ0LmF0dGFjaG1lbnRzQ291bnQsIHRoaXMuYXR0YWNobWVudHNCdXR0b24sIFNpZGViYXJWaWV3LkFUVEFDSE1FTlRTKTsKICAgIH0pOwogICAgZXZlbnRCdXMuX29uKCJsYXllcnNsb2FkZWQiLCBldnQgPT4gewogICAgICBvblRyZWVMb2FkZWQoZXZ0LmxheWVyc0NvdW50LCB0aGlzLmxheWVyc0J1dHRvbiwgU2lkZWJhclZpZXcuTEFZRVJTKTsKICAgIH0pOwogICAgZXZlbnRCdXMuX29uKCJwcmVzZW50YXRpb25tb2RlY2hhbmdlZCIsIGV2dCA9PiB7CiAgICAgIGlmIChldnQuc3RhdGUgPT09IFByZXNlbnRhdGlvbk1vZGVTdGF0ZS5OT1JNQUwgJiYgdGhpcy52aXNpYmxlVmlldyA9PT0gU2lkZWJhclZpZXcuVEhVTUJTKSB7CiAgICAgICAgdGhpcy5vblVwZGF0ZVRodW1ibmFpbHMoKTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLnJlc2l6ZXIuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgZXZ0ID0+IHsKICAgICAgaWYgKGV2dC5idXR0b24gIT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgb3V0ZXJDb250YWluZXIuY2xhc3NMaXN0LmFkZChTSURFQkFSX1JFU0laSU5HX0NMQVNTKTsKICAgICAgdGhpcy4jbW91c2VBQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgICAgY29uc3Qgb3B0cyA9IHsKICAgICAgICBzaWduYWw6IHRoaXMuI21vdXNlQUMuc2lnbmFsCiAgICAgIH07CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCB0aGlzLiNtb3VzZU1vdmUuYmluZCh0aGlzKSwgb3B0cyk7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwgdGhpcy4jbW91c2VVcC5iaW5kKHRoaXMpLCBvcHRzKTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJsdXIiLCB0aGlzLiNtb3VzZVVwLmJpbmQodGhpcyksIG9wdHMpOwogICAgfSk7CiAgICBldmVudEJ1cy5fb24oInJlc2l6ZSIsIGV2dCA9PiB7CiAgICAgIGlmIChldnQuc291cmNlICE9PSB3aW5kb3cpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy4jb3V0ZXJDb250YWluZXJXaWR0aCA9IG51bGw7CiAgICAgIGlmICghdGhpcy4jd2lkdGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmlzT3BlbikgewogICAgICAgIHRoaXMuI3VwZGF0ZVdpZHRoKHRoaXMuI3dpZHRoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgb3V0ZXJDb250YWluZXIuY2xhc3NMaXN0LmFkZChTSURFQkFSX1JFU0laSU5HX0NMQVNTKTsKICAgICAgY29uc3QgdXBkYXRlZCA9IHRoaXMuI3VwZGF0ZVdpZHRoKHRoaXMuI3dpZHRoKTsKICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB7CiAgICAgICAgb3V0ZXJDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShTSURFQkFSX1JFU0laSU5HX0NMQVNTKTsKICAgICAgICBpZiAodXBkYXRlZCkgewogICAgICAgICAgZXZlbnRCdXMuZGlzcGF0Y2goInJlc2l6ZSIsIHsKICAgICAgICAgICAgc291cmNlOiB0aGlzCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfQogIGdldCBvdXRlckNvbnRhaW5lcldpZHRoKCkgewogICAgcmV0dXJuIHRoaXMuI291dGVyQ29udGFpbmVyV2lkdGggfHw9IHRoaXMub3V0ZXJDb250YWluZXIuY2xpZW50V2lkdGg7CiAgfQogICN1cGRhdGVXaWR0aCh3aWR0aCA9IDApIHsKICAgIGNvbnN0IG1heFdpZHRoID0gTWF0aC5mbG9vcih0aGlzLm91dGVyQ29udGFpbmVyV2lkdGggLyAyKTsKICAgIGlmICh3aWR0aCA+IG1heFdpZHRoKSB7CiAgICAgIHdpZHRoID0gbWF4V2lkdGg7CiAgICB9CiAgICBpZiAod2lkdGggPCBTSURFQkFSX01JTl9XSURUSCkgewogICAgICB3aWR0aCA9IFNJREVCQVJfTUlOX1dJRFRIOwogICAgfQogICAgaWYgKHdpZHRoID09PSB0aGlzLiN3aWR0aCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0aGlzLiN3aWR0aCA9IHdpZHRoOwogICAgZG9jU3R5bGUuc2V0UHJvcGVydHkoU0lERUJBUl9XSURUSF9WQVIsIGAke3dpZHRofXB4YCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgI21vdXNlTW92ZShldnQpIHsKICAgIGxldCB3aWR0aCA9IGV2dC5jbGllbnRYOwogICAgaWYgKHRoaXMuI2lzUlRMKSB7CiAgICAgIHdpZHRoID0gdGhpcy5vdXRlckNvbnRhaW5lcldpZHRoIC0gd2lkdGg7CiAgICB9CiAgICB0aGlzLiN1cGRhdGVXaWR0aCh3aWR0aCk7CiAgfQogICNtb3VzZVVwKGV2dCkgewogICAgdGhpcy5vdXRlckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFNJREVCQVJfUkVTSVpJTkdfQ0xBU1MpOwogICAgdGhpcy5ldmVudEJ1cy5kaXNwYXRjaCgicmVzaXplIiwgewogICAgICBzb3VyY2U6IHRoaXMKICAgIH0pOwogICAgdGhpcy4jbW91c2VBQz8uYWJvcnQoKTsKICAgIHRoaXMuI21vdXNlQUMgPSBudWxsOwogIH0KfQoKOy8vIC4vd2ViL3BkZl90aHVtYm5haWxfdmlldy5qcwoKCgpjb25zdCBEUkFXX1VQU0NBTEVfRkFDVE9SID0gMjsKY29uc3QgTUFYX05VTV9TQ0FMSU5HX1NURVBTID0gMzsKY29uc3QgVEhVTUJOQUlMX1dJRFRIID0gOTg7CmZ1bmN0aW9uIHplcm9DYW52YXMoYykgewogIGMud2lkdGggPSAwOwogIGMuaGVpZ2h0ID0gMDsKfQpjbGFzcyBUZW1wSW1hZ2VGYWN0b3J5IHsKICBzdGF0aWMgI3RlbXBDYW52YXMgPSBudWxsOwogIHN0YXRpYyBnZXRDYW52YXMod2lkdGgsIGhlaWdodCkgewogICAgY29uc3QgdGVtcENhbnZhcyA9IHRoaXMuI3RlbXBDYW52YXMgfHw9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgdGVtcENhbnZhcy53aWR0aCA9IHdpZHRoOwogICAgdGVtcENhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICBjb25zdCBjdHggPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICBhbHBoYTogZmFsc2UKICAgIH0pOwogICAgY3R4LnNhdmUoKTsKICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKDI1NSwgMjU1LCAyNTUpIjsKICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgIGN0eC5yZXN0b3JlKCk7CiAgICByZXR1cm4gW3RlbXBDYW52YXMsIHRlbXBDYW52YXMuZ2V0Q29udGV4dCgiMmQiKV07CiAgfQogIHN0YXRpYyBkZXN0cm95Q2FudmFzKCkgewogICAgaWYgKHRoaXMuI3RlbXBDYW52YXMpIHsKICAgICAgemVyb0NhbnZhcyh0aGlzLiN0ZW1wQ2FudmFzKTsKICAgIH0KICAgIHRoaXMuI3RlbXBDYW52YXMgPSBudWxsOwogIH0KfQpjbGFzcyBQREZUaHVtYm5haWxWaWV3IHsKICBjb25zdHJ1Y3Rvcih7CiAgICBjb250YWluZXIsCiAgICBldmVudEJ1cywKICAgIGlkLAogICAgZGVmYXVsdFZpZXdwb3J0LAogICAgb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZSwKICAgIGxpbmtTZXJ2aWNlLAogICAgcmVuZGVyaW5nUXVldWUsCiAgICBtYXhDYW52YXNQaXhlbHMsCiAgICBtYXhDYW52YXNEaW0sCiAgICBwYWdlQ29sb3JzLAogICAgZW5hYmxlSFdBCiAgfSkgewogICAgdGhpcy5pZCA9IGlkOwogICAgdGhpcy5yZW5kZXJpbmdJZCA9ICJ0aHVtYm5haWwiICsgaWQ7CiAgICB0aGlzLnBhZ2VMYWJlbCA9IG51bGw7CiAgICB0aGlzLnBkZlBhZ2UgPSBudWxsOwogICAgdGhpcy5yb3RhdGlvbiA9IDA7CiAgICB0aGlzLnZpZXdwb3J0ID0gZGVmYXVsdFZpZXdwb3J0OwogICAgdGhpcy5wZGZQYWdlUm90YXRlID0gZGVmYXVsdFZpZXdwb3J0LnJvdGF0aW9uOwogICAgdGhpcy5fb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZSA9IG9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UgfHwgbnVsbDsKICAgIHRoaXMubWF4Q2FudmFzUGl4ZWxzID0gbWF4Q2FudmFzUGl4ZWxzID8/IEFwcE9wdGlvbnMuZ2V0KCJtYXhDYW52YXNQaXhlbHMiKTsKICAgIHRoaXMubWF4Q2FudmFzRGltID0gbWF4Q2FudmFzRGltIHx8IEFwcE9wdGlvbnMuZ2V0KCJtYXhDYW52YXNEaW0iKTsKICAgIHRoaXMucGFnZUNvbG9ycyA9IHBhZ2VDb2xvcnMgfHwgbnVsbDsKICAgIHRoaXMuZW5hYmxlSFdBID0gZW5hYmxlSFdBIHx8IGZhbHNlOwogICAgdGhpcy5ldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgdGhpcy5saW5rU2VydmljZSA9IGxpbmtTZXJ2aWNlOwogICAgdGhpcy5yZW5kZXJpbmdRdWV1ZSA9IHJlbmRlcmluZ1F1ZXVlOwogICAgdGhpcy5yZW5kZXJUYXNrID0gbnVsbDsKICAgIHRoaXMucmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuSU5JVElBTDsKICAgIHRoaXMucmVzdW1lID0gbnVsbDsKICAgIGNvbnN0IGFuY2hvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgIGFuY2hvci5ocmVmID0gbGlua1NlcnZpY2UuZ2V0QW5jaG9yVXJsKCIjcGFnZT0iICsgaWQpOwogICAgYW5jaG9yLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgInBkZmpzLXRodW1iLXBhZ2UtdGl0bGUiKTsKICAgIGFuY2hvci5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1hcmdzIiwgdGhpcy4jcGFnZUwxMG5BcmdzKTsKICAgIGFuY2hvci5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICBsaW5rU2VydmljZS5nb1RvUGFnZShpZCk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICB0aGlzLmFuY2hvciA9IGFuY2hvcjsKICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgZGl2LmNsYXNzTmFtZSA9ICJ0aHVtYm5haWwiOwogICAgZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS1wYWdlLW51bWJlciIsIHRoaXMuaWQpOwogICAgdGhpcy5kaXYgPSBkaXY7CiAgICB0aGlzLiN1cGRhdGVEaW1zKCk7CiAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGltZy5jbGFzc05hbWUgPSAidGh1bWJuYWlsSW1hZ2UiOwogICAgdGhpcy5fcGxhY2Vob2xkZXJJbWcgPSBpbWc7CiAgICBkaXYuYXBwZW5kKGltZyk7CiAgICBhbmNob3IuYXBwZW5kKGRpdik7CiAgICBjb250YWluZXIuYXBwZW5kKGFuY2hvcik7CiAgfQogICN1cGRhdGVEaW1zKCkgewogICAgY29uc3QgewogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gdGhpcy52aWV3cG9ydDsKICAgIGNvbnN0IHJhdGlvID0gd2lkdGggLyBoZWlnaHQ7CiAgICB0aGlzLmNhbnZhc1dpZHRoID0gVEhVTUJOQUlMX1dJRFRIOwogICAgdGhpcy5jYW52YXNIZWlnaHQgPSB0aGlzLmNhbnZhc1dpZHRoIC8gcmF0aW8gfCAwOwogICAgdGhpcy5zY2FsZSA9IHRoaXMuY2FudmFzV2lkdGggLyB3aWR0aDsKICAgIGNvbnN0IHsKICAgICAgc3R5bGUKICAgIH0gPSB0aGlzLmRpdjsKICAgIHN0eWxlLnNldFByb3BlcnR5KCItLXRodW1ibmFpbC13aWR0aCIsIGAke3RoaXMuY2FudmFzV2lkdGh9cHhgKTsKICAgIHN0eWxlLnNldFByb3BlcnR5KCItLXRodW1ibmFpbC1oZWlnaHQiLCBgJHt0aGlzLmNhbnZhc0hlaWdodH1weGApOwogIH0KICBzZXRQZGZQYWdlKHBkZlBhZ2UpIHsKICAgIHRoaXMucGRmUGFnZSA9IHBkZlBhZ2U7CiAgICB0aGlzLnBkZlBhZ2VSb3RhdGUgPSBwZGZQYWdlLnJvdGF0ZTsKICAgIGNvbnN0IHRvdGFsUm90YXRpb24gPSAodGhpcy5yb3RhdGlvbiArIHRoaXMucGRmUGFnZVJvdGF0ZSkgJSAzNjA7CiAgICB0aGlzLnZpZXdwb3J0ID0gcGRmUGFnZS5nZXRWaWV3cG9ydCh7CiAgICAgIHNjYWxlOiAxLAogICAgICByb3RhdGlvbjogdG90YWxSb3RhdGlvbgogICAgfSk7CiAgICB0aGlzLnJlc2V0KCk7CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy5jYW5jZWxSZW5kZXJpbmcoKTsKICAgIHRoaXMucmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuSU5JVElBTDsKICAgIHRoaXMuZGl2LnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS1sb2FkZWQiKTsKICAgIHRoaXMuaW1hZ2U/LnJlcGxhY2VXaXRoKHRoaXMuX3BsYWNlaG9sZGVySW1nKTsKICAgIHRoaXMuI3VwZGF0ZURpbXMoKTsKICAgIGlmICh0aGlzLmltYWdlKSB7CiAgICAgIHRoaXMuaW1hZ2UucmVtb3ZlQXR0cmlidXRlKCJzcmMiKTsKICAgICAgZGVsZXRlIHRoaXMuaW1hZ2U7CiAgICB9CiAgfQogIHVwZGF0ZSh7CiAgICByb3RhdGlvbiA9IG51bGwKICB9KSB7CiAgICBpZiAodHlwZW9mIHJvdGF0aW9uID09PSAibnVtYmVyIikgewogICAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247CiAgICB9CiAgICBjb25zdCB0b3RhbFJvdGF0aW9uID0gKHRoaXMucm90YXRpb24gKyB0aGlzLnBkZlBhZ2VSb3RhdGUpICUgMzYwOwogICAgdGhpcy52aWV3cG9ydCA9IHRoaXMudmlld3BvcnQuY2xvbmUoewogICAgICBzY2FsZTogMSwKICAgICAgcm90YXRpb246IHRvdGFsUm90YXRpb24KICAgIH0pOwogICAgdGhpcy5yZXNldCgpOwogIH0KICBjYW5jZWxSZW5kZXJpbmcoKSB7CiAgICBpZiAodGhpcy5yZW5kZXJUYXNrKSB7CiAgICAgIHRoaXMucmVuZGVyVGFzay5jYW5jZWwoKTsKICAgICAgdGhpcy5yZW5kZXJUYXNrID0gbnVsbDsKICAgIH0KICAgIHRoaXMucmVzdW1lID0gbnVsbDsKICB9CiAgI2dldFBhZ2VEcmF3Q29udGV4dCh1cHNjYWxlRmFjdG9yID0gMSwgZW5hYmxlSFdBID0gdGhpcy5lbmFibGVIV0EpIHsKICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICBhbHBoYTogZmFsc2UsCiAgICAgIHdpbGxSZWFkRnJlcXVlbnRseTogIWVuYWJsZUhXQQogICAgfSk7CiAgICBjb25zdCBvdXRwdXRTY2FsZSA9IG5ldyBPdXRwdXRTY2FsZSgpOwogICAgY29uc3Qgd2lkdGggPSB1cHNjYWxlRmFjdG9yICogdGhpcy5jYW52YXNXaWR0aCwKICAgICAgaGVpZ2h0ID0gdXBzY2FsZUZhY3RvciAqIHRoaXMuY2FudmFzSGVpZ2h0OwogICAgb3V0cHV0U2NhbGUubGltaXRDYW52YXMod2lkdGgsIGhlaWdodCwgdGhpcy5tYXhDYW52YXNQaXhlbHMsIHRoaXMubWF4Q2FudmFzRGltKTsKICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoICogb3V0cHV0U2NhbGUuc3ggfCAwOwogICAgY2FudmFzLmhlaWdodCA9IGhlaWdodCAqIG91dHB1dFNjYWxlLnN5IHwgMDsKICAgIGNvbnN0IHRyYW5zZm9ybSA9IG91dHB1dFNjYWxlLnNjYWxlZCA/IFtvdXRwdXRTY2FsZS5zeCwgMCwgMCwgb3V0cHV0U2NhbGUuc3ksIDAsIDBdIDogbnVsbDsKICAgIHJldHVybiB7CiAgICAgIGN0eCwKICAgICAgY2FudmFzLAogICAgICB0cmFuc2Zvcm0KICAgIH07CiAgfQogICNjb252ZXJ0Q2FudmFzVG9JbWFnZShjYW52YXMpIHsKICAgIGlmICh0aGlzLnJlbmRlcmluZ1N0YXRlICE9PSBSZW5kZXJpbmdTdGF0ZXMuRklOSVNIRUQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCIjY29udmVydENhbnZhc1RvSW1hZ2U6IFJlbmRlcmluZyBoYXMgbm90IGZpbmlzaGVkLiIpOwogICAgfQogICAgY29uc3QgcmVkdWNlZENhbnZhcyA9IHRoaXMuI3JlZHVjZUltYWdlKGNhbnZhcyk7CiAgICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwogICAgaW1hZ2UuY2xhc3NOYW1lID0gInRodW1ibmFpbEltYWdlIjsKICAgIGltYWdlLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgInBkZmpzLXRodW1iLXBhZ2UtY2FudmFzIik7CiAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1hcmdzIiwgdGhpcy4jcGFnZUwxMG5BcmdzKTsKICAgIGltYWdlLnNyYyA9IHJlZHVjZWRDYW52YXMudG9EYXRhVVJMKCk7CiAgICB0aGlzLmltYWdlID0gaW1hZ2U7CiAgICB0aGlzLmRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtbG9hZGVkIiwgdHJ1ZSk7CiAgICB0aGlzLl9wbGFjZWhvbGRlckltZy5yZXBsYWNlV2l0aChpbWFnZSk7CiAgICB6ZXJvQ2FudmFzKHJlZHVjZWRDYW52YXMpOwogIH0KICBhc3luYyBkcmF3KCkgewogICAgaWYgKHRoaXMucmVuZGVyaW5nU3RhdGUgIT09IFJlbmRlcmluZ1N0YXRlcy5JTklUSUFMKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIk11c3QgYmUgaW4gbmV3IHN0YXRlIGJlZm9yZSBkcmF3aW5nIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgcGFnZUNvbG9ycywKICAgICAgcGRmUGFnZQogICAgfSA9IHRoaXM7CiAgICBpZiAoIXBkZlBhZ2UpIHsKICAgICAgdGhpcy5yZW5kZXJpbmdTdGF0ZSA9IFJlbmRlcmluZ1N0YXRlcy5GSU5JU0hFRDsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJwZGZQYWdlIGlzIG5vdCBsb2FkZWQiKTsKICAgIH0KICAgIHRoaXMucmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuUlVOTklORzsKICAgIGNvbnN0IHsKICAgICAgY3R4LAogICAgICBjYW52YXMsCiAgICAgIHRyYW5zZm9ybQogICAgfSA9IHRoaXMuI2dldFBhZ2VEcmF3Q29udGV4dChEUkFXX1VQU0NBTEVfRkFDVE9SKTsKICAgIGNvbnN0IGRyYXdWaWV3cG9ydCA9IHRoaXMudmlld3BvcnQuY2xvbmUoewogICAgICBzY2FsZTogRFJBV19VUFNDQUxFX0ZBQ1RPUiAqIHRoaXMuc2NhbGUKICAgIH0pOwogICAgY29uc3QgcmVuZGVyQ29udGludWVDYWxsYmFjayA9IGNvbnQgPT4gewogICAgICBpZiAoIXRoaXMucmVuZGVyaW5nUXVldWUuaXNIaWdoZXN0UHJpb3JpdHkodGhpcykpIHsKICAgICAgICB0aGlzLnJlbmRlcmluZ1N0YXRlID0gUmVuZGVyaW5nU3RhdGVzLlBBVVNFRDsKICAgICAgICB0aGlzLnJlc3VtZSA9ICgpID0+IHsKICAgICAgICAgIHRoaXMucmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuUlVOTklORzsKICAgICAgICAgIGNvbnQoKTsKICAgICAgICB9OwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb250KCk7CiAgICB9OwogICAgY29uc3QgcmVuZGVyQ29udGV4dCA9IHsKICAgICAgY2FudmFzQ29udGV4dDogY3R4LAogICAgICB0cmFuc2Zvcm0sCiAgICAgIHZpZXdwb3J0OiBkcmF3Vmlld3BvcnQsCiAgICAgIG9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2U6IHRoaXMuX29wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UsCiAgICAgIHBhZ2VDb2xvcnMKICAgIH07CiAgICBjb25zdCByZW5kZXJUYXNrID0gdGhpcy5yZW5kZXJUYXNrID0gcGRmUGFnZS5yZW5kZXIocmVuZGVyQ29udGV4dCk7CiAgICByZW5kZXJUYXNrLm9uQ29udGludWUgPSByZW5kZXJDb250aW51ZUNhbGxiYWNrOwogICAgbGV0IGVycm9yID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHJlbmRlclRhc2sucHJvbWlzZTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaWYgKGUgaW5zdGFuY2VvZiBSZW5kZXJpbmdDYW5jZWxsZWRFeGNlcHRpb24pIHsKICAgICAgICB6ZXJvQ2FudmFzKGNhbnZhcyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGVycm9yID0gZTsKICAgIH0gZmluYWxseSB7CiAgICAgIGlmIChyZW5kZXJUYXNrID09PSB0aGlzLnJlbmRlclRhc2spIHsKICAgICAgICB0aGlzLnJlbmRlclRhc2sgPSBudWxsOwogICAgICB9CiAgICB9CiAgICB0aGlzLnJlbmRlcmluZ1N0YXRlID0gUmVuZGVyaW5nU3RhdGVzLkZJTklTSEVEOwogICAgdGhpcy4jY29udmVydENhbnZhc1RvSW1hZ2UoY2FudmFzKTsKICAgIHplcm9DYW52YXMoY2FudmFzKTsKICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goInRodW1ibmFpbHJlbmRlcmVkIiwgewogICAgICBzb3VyY2U6IHRoaXMsCiAgICAgIHBhZ2VOdW1iZXI6IHRoaXMuaWQsCiAgICAgIHBkZlBhZ2UKICAgIH0pOwogICAgaWYgKGVycm9yKSB7CiAgICAgIHRocm93IGVycm9yOwogICAgfQogIH0KICBzZXRJbWFnZShwYWdlVmlldykgewogICAgaWYgKHRoaXMucmVuZGVyaW5nU3RhdGUgIT09IFJlbmRlcmluZ1N0YXRlcy5JTklUSUFMKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgdGh1bWJuYWlsQ2FudmFzOiBjYW52YXMsCiAgICAgIHBkZlBhZ2UsCiAgICAgIHNjYWxlCiAgICB9ID0gcGFnZVZpZXc7CiAgICBpZiAoIWNhbnZhcykgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXMucGRmUGFnZSkgewogICAgICB0aGlzLnNldFBkZlBhZ2UocGRmUGFnZSk7CiAgICB9CiAgICBpZiAoc2NhbGUgPCB0aGlzLnNjYWxlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMucmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuRklOSVNIRUQ7CiAgICB0aGlzLiNjb252ZXJ0Q2FudmFzVG9JbWFnZShjYW52YXMpOwogIH0KICAjZ2V0UmVkdWNlZEltYWdlRGltcyhjYW52YXMpIHsKICAgIGNvbnN0IHdpZHRoID0gY2FudmFzLndpZHRoIDw8IE1BWF9OVU1fU0NBTElOR19TVEVQUywKICAgICAgaGVpZ2h0ID0gY2FudmFzLmhlaWdodCA8PCBNQVhfTlVNX1NDQUxJTkdfU1RFUFM7CiAgICBjb25zdCBvdXRwdXRTY2FsZSA9IG5ldyBPdXRwdXRTY2FsZSgpOwogICAgb3V0cHV0U2NhbGUuc3ggPSBvdXRwdXRTY2FsZS5zeSA9IDE7CiAgICBvdXRwdXRTY2FsZS5saW1pdENhbnZhcyh3aWR0aCwgaGVpZ2h0LCB0aGlzLm1heENhbnZhc1BpeGVscywgdGhpcy5tYXhDYW52YXNEaW0pOwogICAgcmV0dXJuIFt3aWR0aCAqIG91dHB1dFNjYWxlLnN4IHwgMCwgaGVpZ2h0ICogb3V0cHV0U2NhbGUuc3kgfCAwXTsKICB9CiAgI3JlZHVjZUltYWdlKGltZykgewogICAgY29uc3QgewogICAgICBjdHgsCiAgICAgIGNhbnZhcwogICAgfSA9IHRoaXMuI2dldFBhZ2VEcmF3Q29udGV4dCgxLCB0cnVlKTsKICAgIGlmIChpbWcud2lkdGggPD0gMiAqIGNhbnZhcy53aWR0aCkgewogICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgaW1nLndpZHRoLCBpbWcuaGVpZ2h0LCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwogICAgICByZXR1cm4gY2FudmFzOwogICAgfQogICAgbGV0IFtyZWR1Y2VkV2lkdGgsIHJlZHVjZWRIZWlnaHRdID0gdGhpcy4jZ2V0UmVkdWNlZEltYWdlRGltcyhjYW52YXMpOwogICAgY29uc3QgW3JlZHVjZWRJbWFnZSwgcmVkdWNlZEltYWdlQ3R4XSA9IFRlbXBJbWFnZUZhY3RvcnkuZ2V0Q2FudmFzKHJlZHVjZWRXaWR0aCwgcmVkdWNlZEhlaWdodCk7CiAgICB3aGlsZSAocmVkdWNlZFdpZHRoID4gaW1nLndpZHRoIHx8IHJlZHVjZWRIZWlnaHQgPiBpbWcuaGVpZ2h0KSB7CiAgICAgIHJlZHVjZWRXaWR0aCA+Pj0gMTsKICAgICAgcmVkdWNlZEhlaWdodCA+Pj0gMTsKICAgIH0KICAgIHJlZHVjZWRJbWFnZUN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBpbWcud2lkdGgsIGltZy5oZWlnaHQsIDAsIDAsIHJlZHVjZWRXaWR0aCwgcmVkdWNlZEhlaWdodCk7CiAgICB3aGlsZSAocmVkdWNlZFdpZHRoID4gMiAqIGNhbnZhcy53aWR0aCkgewogICAgICByZWR1Y2VkSW1hZ2VDdHguZHJhd0ltYWdlKHJlZHVjZWRJbWFnZSwgMCwgMCwgcmVkdWNlZFdpZHRoLCByZWR1Y2VkSGVpZ2h0LCAwLCAwLCByZWR1Y2VkV2lkdGggPj4gMSwgcmVkdWNlZEhlaWdodCA+PiAxKTsKICAgICAgcmVkdWNlZFdpZHRoID4+PSAxOwogICAgICByZWR1Y2VkSGVpZ2h0ID4+PSAxOwogICAgfQogICAgY3R4LmRyYXdJbWFnZShyZWR1Y2VkSW1hZ2UsIDAsIDAsIHJlZHVjZWRXaWR0aCwgcmVkdWNlZEhlaWdodCwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgIHJldHVybiBjYW52YXM7CiAgfQogIGdldCAjcGFnZUwxMG5BcmdzKCkgewogICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHsKICAgICAgcGFnZTogdGhpcy5wYWdlTGFiZWwgPz8gdGhpcy5pZAogICAgfSk7CiAgfQogIHNldFBhZ2VMYWJlbChsYWJlbCkgewogICAgdGhpcy5wYWdlTGFiZWwgPSB0eXBlb2YgbGFiZWwgPT09ICJzdHJpbmciID8gbGFiZWwgOiBudWxsOwogICAgdGhpcy5hbmNob3Iuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4tYXJncyIsIHRoaXMuI3BhZ2VMMTBuQXJncyk7CiAgICBpZiAodGhpcy5yZW5kZXJpbmdTdGF0ZSAhPT0gUmVuZGVyaW5nU3RhdGVzLkZJTklTSEVEKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuaW1hZ2U/LnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWFyZ3MiLCB0aGlzLiNwYWdlTDEwbkFyZ3MpOwogIH0KfQoKOy8vIC4vd2ViL3BkZl90aHVtYm5haWxfdmlld2VyLmpzCgoKY29uc3QgVEhVTUJOQUlMX1NDUk9MTF9NQVJHSU4gPSAtMTk7CmNvbnN0IFRIVU1CTkFJTF9TRUxFQ1RFRF9DTEFTUyA9ICJzZWxlY3RlZCI7CmNsYXNzIFBERlRodW1ibmFpbFZpZXdlciB7CiAgY29uc3RydWN0b3IoewogICAgY29udGFpbmVyLAogICAgZXZlbnRCdXMsCiAgICBsaW5rU2VydmljZSwKICAgIHJlbmRlcmluZ1F1ZXVlLAogICAgbWF4Q2FudmFzUGl4ZWxzLAogICAgbWF4Q2FudmFzRGltLAogICAgcGFnZUNvbG9ycywKICAgIGFib3J0U2lnbmFsLAogICAgZW5hYmxlSFdBCiAgfSkgewogICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7CiAgICB0aGlzLmV2ZW50QnVzID0gZXZlbnRCdXM7CiAgICB0aGlzLmxpbmtTZXJ2aWNlID0gbGlua1NlcnZpY2U7CiAgICB0aGlzLnJlbmRlcmluZ1F1ZXVlID0gcmVuZGVyaW5nUXVldWU7CiAgICB0aGlzLm1heENhbnZhc1BpeGVscyA9IG1heENhbnZhc1BpeGVsczsKICAgIHRoaXMubWF4Q2FudmFzRGltID0gbWF4Q2FudmFzRGltOwogICAgdGhpcy5wYWdlQ29sb3JzID0gcGFnZUNvbG9ycyB8fCBudWxsOwogICAgdGhpcy5lbmFibGVIV0EgPSBlbmFibGVIV0EgfHwgZmFsc2U7CiAgICB0aGlzLnNjcm9sbCA9IHdhdGNoU2Nyb2xsKHRoaXMuY29udGFpbmVyLCB0aGlzLiNzY3JvbGxVcGRhdGVkLmJpbmQodGhpcyksIGFib3J0U2lnbmFsKTsKICAgIHRoaXMuI3Jlc2V0VmlldygpOwogIH0KICAjc2Nyb2xsVXBkYXRlZCgpIHsKICAgIHRoaXMucmVuZGVyaW5nUXVldWUucmVuZGVySGlnaGVzdFByaW9yaXR5KCk7CiAgfQogIGdldFRodW1ibmFpbChpbmRleCkgewogICAgcmV0dXJuIHRoaXMuX3RodW1ibmFpbHNbaW5kZXhdOwogIH0KICAjZ2V0VmlzaWJsZVRodW1icygpIHsKICAgIHJldHVybiBnZXRWaXNpYmxlRWxlbWVudHMoewogICAgICBzY3JvbGxFbDogdGhpcy5jb250YWluZXIsCiAgICAgIHZpZXdzOiB0aGlzLl90aHVtYm5haWxzCiAgICB9KTsKICB9CiAgc2Nyb2xsVGh1bWJuYWlsSW50b1ZpZXcocGFnZU51bWJlcikgewogICAgaWYgKCF0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHRodW1ibmFpbFZpZXcgPSB0aGlzLl90aHVtYm5haWxzW3BhZ2VOdW1iZXIgLSAxXTsKICAgIGlmICghdGh1bWJuYWlsVmlldykgewogICAgICBjb25zb2xlLmVycm9yKCdzY3JvbGxUaHVtYm5haWxJbnRvVmlldzogSW52YWxpZCAicGFnZU51bWJlciIgcGFyYW1ldGVyLicpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAocGFnZU51bWJlciAhPT0gdGhpcy5fY3VycmVudFBhZ2VOdW1iZXIpIHsKICAgICAgY29uc3QgcHJldlRodW1ibmFpbFZpZXcgPSB0aGlzLl90aHVtYm5haWxzW3RoaXMuX2N1cnJlbnRQYWdlTnVtYmVyIC0gMV07CiAgICAgIHByZXZUaHVtYm5haWxWaWV3LmRpdi5jbGFzc0xpc3QucmVtb3ZlKFRIVU1CTkFJTF9TRUxFQ1RFRF9DTEFTUyk7CiAgICAgIHRodW1ibmFpbFZpZXcuZGl2LmNsYXNzTGlzdC5hZGQoVEhVTUJOQUlMX1NFTEVDVEVEX0NMQVNTKTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgZmlyc3QsCiAgICAgIGxhc3QsCiAgICAgIHZpZXdzCiAgICB9ID0gdGhpcy4jZ2V0VmlzaWJsZVRodW1icygpOwogICAgaWYgKHZpZXdzLmxlbmd0aCA+IDApIHsKICAgICAgbGV0IHNob3VsZFNjcm9sbCA9IGZhbHNlOwogICAgICBpZiAocGFnZU51bWJlciA8PSBmaXJzdC5pZCB8fCBwYWdlTnVtYmVyID49IGxhc3QuaWQpIHsKICAgICAgICBzaG91bGRTY3JvbGwgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoY29uc3QgewogICAgICAgICAgaWQsCiAgICAgICAgICBwZXJjZW50CiAgICAgICAgfSBvZiB2aWV3cykgewogICAgICAgICAgaWYgKGlkICE9PSBwYWdlTnVtYmVyKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgc2hvdWxkU2Nyb2xsID0gcGVyY2VudCA8IDEwMDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc2hvdWxkU2Nyb2xsKSB7CiAgICAgICAgc2Nyb2xsSW50b1ZpZXcodGh1bWJuYWlsVmlldy5kaXYsIHsKICAgICAgICAgIHRvcDogVEhVTUJOQUlMX1NDUk9MTF9NQVJHSU4KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgdGhpcy5fY3VycmVudFBhZ2VOdW1iZXIgPSBwYWdlTnVtYmVyOwogIH0KICBnZXQgcGFnZXNSb3RhdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl9wYWdlc1JvdGF0aW9uOwogIH0KICBzZXQgcGFnZXNSb3RhdGlvbihyb3RhdGlvbikgewogICAgaWYgKCFpc1ZhbGlkUm90YXRpb24ocm90YXRpb24pKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCB0aHVtYm5haWxzIHJvdGF0aW9uIGFuZ2xlLiIpOwogICAgfQogICAgaWYgKCF0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9wYWdlc1JvdGF0aW9uID09PSByb3RhdGlvbikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9wYWdlc1JvdGF0aW9uID0gcm90YXRpb247CiAgICBjb25zdCB1cGRhdGVBcmdzID0gewogICAgICByb3RhdGlvbgogICAgfTsKICAgIGZvciAoY29uc3QgdGh1bWJuYWlsIG9mIHRoaXMuX3RodW1ibmFpbHMpIHsKICAgICAgdGh1bWJuYWlsLnVwZGF0ZSh1cGRhdGVBcmdzKTsKICAgIH0KICB9CiAgY2xlYW51cCgpIHsKICAgIGZvciAoY29uc3QgdGh1bWJuYWlsIG9mIHRoaXMuX3RodW1ibmFpbHMpIHsKICAgICAgaWYgKHRodW1ibmFpbC5yZW5kZXJpbmdTdGF0ZSAhPT0gUmVuZGVyaW5nU3RhdGVzLkZJTklTSEVEKSB7CiAgICAgICAgdGh1bWJuYWlsLnJlc2V0KCk7CiAgICAgIH0KICAgIH0KICAgIFRlbXBJbWFnZUZhY3RvcnkuZGVzdHJveUNhbnZhcygpOwogIH0KICAjcmVzZXRWaWV3KCkgewogICAgdGhpcy5fdGh1bWJuYWlscyA9IFtdOwogICAgdGhpcy5fY3VycmVudFBhZ2VOdW1iZXIgPSAxOwogICAgdGhpcy5fcGFnZUxhYmVscyA9IG51bGw7CiAgICB0aGlzLl9wYWdlc1JvdGF0aW9uID0gMDsKICAgIHRoaXMuY29udGFpbmVyLnRleHRDb250ZW50ID0gIiI7CiAgfQogIHNldERvY3VtZW50KHBkZkRvY3VtZW50KSB7CiAgICBpZiAodGhpcy5wZGZEb2N1bWVudCkgewogICAgICB0aGlzLiNjYW5jZWxSZW5kZXJpbmcoKTsKICAgICAgdGhpcy4jcmVzZXRWaWV3KCk7CiAgICB9CiAgICB0aGlzLnBkZkRvY3VtZW50ID0gcGRmRG9jdW1lbnQ7CiAgICBpZiAoIXBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGZpcnN0UGFnZVByb21pc2UgPSBwZGZEb2N1bWVudC5nZXRQYWdlKDEpOwogICAgY29uc3Qgb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZSA9IHBkZkRvY3VtZW50LmdldE9wdGlvbmFsQ29udGVudENvbmZpZyh7CiAgICAgIGludGVudDogImRpc3BsYXkiCiAgICB9KTsKICAgIGZpcnN0UGFnZVByb21pc2UudGhlbihmaXJzdFBkZlBhZ2UgPT4gewogICAgICBjb25zdCBwYWdlc0NvdW50ID0gcGRmRG9jdW1lbnQubnVtUGFnZXM7CiAgICAgIGNvbnN0IHZpZXdwb3J0ID0gZmlyc3RQZGZQYWdlLmdldFZpZXdwb3J0KHsKICAgICAgICBzY2FsZTogMQogICAgICB9KTsKICAgICAgZm9yIChsZXQgcGFnZU51bSA9IDE7IHBhZ2VOdW0gPD0gcGFnZXNDb3VudDsgKytwYWdlTnVtKSB7CiAgICAgICAgY29uc3QgdGh1bWJuYWlsID0gbmV3IFBERlRodW1ibmFpbFZpZXcoewogICAgICAgICAgY29udGFpbmVyOiB0aGlzLmNvbnRhaW5lciwKICAgICAgICAgIGV2ZW50QnVzOiB0aGlzLmV2ZW50QnVzLAogICAgICAgICAgaWQ6IHBhZ2VOdW0sCiAgICAgICAgICBkZWZhdWx0Vmlld3BvcnQ6IHZpZXdwb3J0LmNsb25lKCksCiAgICAgICAgICBvcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlLAogICAgICAgICAgbGlua1NlcnZpY2U6IHRoaXMubGlua1NlcnZpY2UsCiAgICAgICAgICByZW5kZXJpbmdRdWV1ZTogdGhpcy5yZW5kZXJpbmdRdWV1ZSwKICAgICAgICAgIG1heENhbnZhc1BpeGVsczogdGhpcy5tYXhDYW52YXNQaXhlbHMsCiAgICAgICAgICBtYXhDYW52YXNEaW06IHRoaXMubWF4Q2FudmFzRGltLAogICAgICAgICAgcGFnZUNvbG9yczogdGhpcy5wYWdlQ29sb3JzLAogICAgICAgICAgZW5hYmxlSFdBOiB0aGlzLmVuYWJsZUhXQQogICAgICAgIH0pOwogICAgICAgIHRoaXMuX3RodW1ibmFpbHMucHVzaCh0aHVtYm5haWwpOwogICAgICB9CiAgICAgIHRoaXMuX3RodW1ibmFpbHNbMF0/LnNldFBkZlBhZ2UoZmlyc3RQZGZQYWdlKTsKICAgICAgY29uc3QgdGh1bWJuYWlsVmlldyA9IHRoaXMuX3RodW1ibmFpbHNbdGhpcy5fY3VycmVudFBhZ2VOdW1iZXIgLSAxXTsKICAgICAgdGh1bWJuYWlsVmlldy5kaXYuY2xhc3NMaXN0LmFkZChUSFVNQk5BSUxfU0VMRUNURURfQ0xBU1MpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgY29uc29sZS5lcnJvcigiVW5hYmxlIHRvIGluaXRpYWxpemUgdGh1bWJuYWlsIHZpZXdlciIsIHJlYXNvbik7CiAgICB9KTsKICB9CiAgI2NhbmNlbFJlbmRlcmluZygpIHsKICAgIGZvciAoY29uc3QgdGh1bWJuYWlsIG9mIHRoaXMuX3RodW1ibmFpbHMpIHsKICAgICAgdGh1bWJuYWlsLmNhbmNlbFJlbmRlcmluZygpOwogICAgfQogIH0KICBzZXRQYWdlTGFiZWxzKGxhYmVscykgewogICAgaWYgKCF0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghbGFiZWxzKSB7CiAgICAgIHRoaXMuX3BhZ2VMYWJlbHMgPSBudWxsOwogICAgfSBlbHNlIGlmICghKEFycmF5LmlzQXJyYXkobGFiZWxzKSAmJiB0aGlzLnBkZkRvY3VtZW50Lm51bVBhZ2VzID09PSBsYWJlbHMubGVuZ3RoKSkgewogICAgICB0aGlzLl9wYWdlTGFiZWxzID0gbnVsbDsKICAgICAgY29uc29sZS5lcnJvcigiUERGVGh1bWJuYWlsVmlld2VyX3NldFBhZ2VMYWJlbHM6IEludmFsaWQgcGFnZSBsYWJlbHMuIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9wYWdlTGFiZWxzID0gbGFiZWxzOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy5fdGh1bWJuYWlscy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIHRoaXMuX3RodW1ibmFpbHNbaV0uc2V0UGFnZUxhYmVsKHRoaXMuX3BhZ2VMYWJlbHM/LltpXSA/PyBudWxsKTsKICAgIH0KICB9CiAgYXN5bmMgI2Vuc3VyZVBkZlBhZ2VMb2FkZWQodGh1bWJWaWV3KSB7CiAgICBpZiAodGh1bWJWaWV3LnBkZlBhZ2UpIHsKICAgICAgcmV0dXJuIHRodW1iVmlldy5wZGZQYWdlOwogICAgfQogICAgdHJ5IHsKICAgICAgY29uc3QgcGRmUGFnZSA9IGF3YWl0IHRoaXMucGRmRG9jdW1lbnQuZ2V0UGFnZSh0aHVtYlZpZXcuaWQpOwogICAgICBpZiAoIXRodW1iVmlldy5wZGZQYWdlKSB7CiAgICAgICAgdGh1bWJWaWV3LnNldFBkZlBhZ2UocGRmUGFnZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHBkZlBhZ2U7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgY29uc29sZS5lcnJvcigiVW5hYmxlIHRvIGdldCBwYWdlIGZvciB0aHVtYiB2aWV3IiwgcmVhc29uKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQogICNnZXRTY3JvbGxBaGVhZCh2aXNpYmxlKSB7CiAgICBpZiAodmlzaWJsZS5maXJzdD8uaWQgPT09IDEpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgaWYgKHZpc2libGUubGFzdD8uaWQgPT09IHRoaXMuX3RodW1ibmFpbHMubGVuZ3RoKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0aGlzLnNjcm9sbC5kb3duOwogIH0KICBmb3JjZVJlbmRlcmluZygpIHsKICAgIGNvbnN0IHZpc2libGVUaHVtYnMgPSB0aGlzLiNnZXRWaXNpYmxlVGh1bWJzKCk7CiAgICBjb25zdCBzY3JvbGxBaGVhZCA9IHRoaXMuI2dldFNjcm9sbEFoZWFkKHZpc2libGVUaHVtYnMpOwogICAgY29uc3QgdGh1bWJWaWV3ID0gdGhpcy5yZW5kZXJpbmdRdWV1ZS5nZXRIaWdoZXN0UHJpb3JpdHkodmlzaWJsZVRodW1icywgdGhpcy5fdGh1bWJuYWlscywgc2Nyb2xsQWhlYWQsIGZhbHNlLCB0cnVlKTsKICAgIGlmICh0aHVtYlZpZXcpIHsKICAgICAgdGhpcy4jZW5zdXJlUGRmUGFnZUxvYWRlZCh0aHVtYlZpZXcpLnRoZW4oKCkgPT4gewogICAgICAgIHRoaXMucmVuZGVyaW5nUXVldWUucmVuZGVyVmlldyh0aHVtYlZpZXcpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9Cgo7Ly8gLi93ZWIvYW5ub3RhdGlvbl9lZGl0b3JfbGF5ZXJfYnVpbGRlci5qcwoKCmNsYXNzIEFubm90YXRpb25FZGl0b3JMYXllckJ1aWxkZXIgewogICNhbm5vdGF0aW9uTGF5ZXIgPSBudWxsOwogICNkcmF3TGF5ZXIgPSBudWxsOwogICNvbkFwcGVuZCA9IG51bGw7CiAgI3N0cnVjdFRyZWVMYXllciA9IG51bGw7CiAgI3RleHRMYXllciA9IG51bGw7CiAgI3VpTWFuYWdlcjsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICB0aGlzLnBkZlBhZ2UgPSBvcHRpb25zLnBkZlBhZ2U7CiAgICB0aGlzLmFjY2Vzc2liaWxpdHlNYW5hZ2VyID0gb3B0aW9ucy5hY2Nlc3NpYmlsaXR5TWFuYWdlcjsKICAgIHRoaXMubDEwbiA9IG9wdGlvbnMubDEwbjsKICAgIHRoaXMubDEwbiB8fD0gbmV3IGdlbmVyaWNsMTBuX0dlbmVyaWNMMTBuKCk7CiAgICB0aGlzLmFubm90YXRpb25FZGl0b3JMYXllciA9IG51bGw7CiAgICB0aGlzLmRpdiA9IG51bGw7CiAgICB0aGlzLl9jYW5jZWxsZWQgPSBmYWxzZTsKICAgIHRoaXMuI3VpTWFuYWdlciA9IG9wdGlvbnMudWlNYW5hZ2VyOwogICAgdGhpcy4jYW5ub3RhdGlvbkxheWVyID0gb3B0aW9ucy5hbm5vdGF0aW9uTGF5ZXIgfHwgbnVsbDsKICAgIHRoaXMuI3RleHRMYXllciA9IG9wdGlvbnMudGV4dExheWVyIHx8IG51bGw7CiAgICB0aGlzLiNkcmF3TGF5ZXIgPSBvcHRpb25zLmRyYXdMYXllciB8fCBudWxsOwogICAgdGhpcy4jb25BcHBlbmQgPSBvcHRpb25zLm9uQXBwZW5kIHx8IG51bGw7CiAgICB0aGlzLiNzdHJ1Y3RUcmVlTGF5ZXIgPSBvcHRpb25zLnN0cnVjdFRyZWVMYXllciB8fCBudWxsOwogIH0KICBhc3luYyByZW5kZXIoewogICAgdmlld3BvcnQsCiAgICBpbnRlbnQgPSAiZGlzcGxheSIKICB9KSB7CiAgICBpZiAoaW50ZW50ICE9PSAiZGlzcGxheSIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX2NhbmNlbGxlZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjbG9uZWRWaWV3cG9ydCA9IHZpZXdwb3J0LmNsb25lKHsKICAgICAgZG9udEZsaXA6IHRydWUKICAgIH0pOwogICAgaWYgKHRoaXMuZGl2KSB7CiAgICAgIHRoaXMuYW5ub3RhdGlvbkVkaXRvckxheWVyLnVwZGF0ZSh7CiAgICAgICAgdmlld3BvcnQ6IGNsb25lZFZpZXdwb3J0CiAgICAgIH0pOwogICAgICB0aGlzLnNob3coKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZGl2ID0gdGhpcy5kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGRpdi5jbGFzc05hbWUgPSAiYW5ub3RhdGlvbkVkaXRvckxheWVyIjsKICAgIGRpdi5oaWRkZW4gPSB0cnVlOwogICAgZGl2LmRpciA9IHRoaXMuI3VpTWFuYWdlci5kaXJlY3Rpb247CiAgICB0aGlzLiNvbkFwcGVuZD8uKGRpdik7CiAgICB0aGlzLmFubm90YXRpb25FZGl0b3JMYXllciA9IG5ldyBBbm5vdGF0aW9uRWRpdG9yTGF5ZXIoewogICAgICB1aU1hbmFnZXI6IHRoaXMuI3VpTWFuYWdlciwKICAgICAgZGl2LAogICAgICBzdHJ1Y3RUcmVlTGF5ZXI6IHRoaXMuI3N0cnVjdFRyZWVMYXllciwKICAgICAgYWNjZXNzaWJpbGl0eU1hbmFnZXI6IHRoaXMuYWNjZXNzaWJpbGl0eU1hbmFnZXIsCiAgICAgIHBhZ2VJbmRleDogdGhpcy5wZGZQYWdlLnBhZ2VOdW1iZXIgLSAxLAogICAgICBsMTBuOiB0aGlzLmwxMG4sCiAgICAgIHZpZXdwb3J0OiBjbG9uZWRWaWV3cG9ydCwKICAgICAgYW5ub3RhdGlvbkxheWVyOiB0aGlzLiNhbm5vdGF0aW9uTGF5ZXIsCiAgICAgIHRleHRMYXllcjogdGhpcy4jdGV4dExheWVyLAogICAgICBkcmF3TGF5ZXI6IHRoaXMuI2RyYXdMYXllcgogICAgfSk7CiAgICBjb25zdCBwYXJhbWV0ZXJzID0gewogICAgICB2aWV3cG9ydDogY2xvbmVkVmlld3BvcnQsCiAgICAgIGRpdiwKICAgICAgYW5ub3RhdGlvbnM6IG51bGwsCiAgICAgIGludGVudAogICAgfTsKICAgIHRoaXMuYW5ub3RhdGlvbkVkaXRvckxheWVyLnJlbmRlcihwYXJhbWV0ZXJzKTsKICAgIHRoaXMuc2hvdygpOwogIH0KICBjYW5jZWwoKSB7CiAgICB0aGlzLl9jYW5jZWxsZWQgPSB0cnVlOwogICAgaWYgKCF0aGlzLmRpdikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmFubm90YXRpb25FZGl0b3JMYXllci5kZXN0cm95KCk7CiAgfQogIGhpZGUoKSB7CiAgICBpZiAoIXRoaXMuZGl2KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuYW5ub3RhdGlvbkVkaXRvckxheWVyLnBhdXNlKHRydWUpOwogICAgdGhpcy5kaXYuaGlkZGVuID0gdHJ1ZTsKICB9CiAgc2hvdygpIHsKICAgIGlmICghdGhpcy5kaXYgfHwgdGhpcy5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIuaXNJbnZpc2libGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5kaXYuaGlkZGVuID0gZmFsc2U7CiAgICB0aGlzLmFubm90YXRpb25FZGl0b3JMYXllci5wYXVzZShmYWxzZSk7CiAgfQp9Cgo7Ly8gLi93ZWIvYW5ub3RhdGlvbl9sYXllcl9idWlsZGVyLmpzCgoKY2xhc3MgQW5ub3RhdGlvbkxheWVyQnVpbGRlciB7CiAgI2Fubm90YXRpb25zID0gbnVsbDsKICAjZXh0ZXJuYWxIaWRlID0gZmFsc2U7CiAgI29uQXBwZW5kID0gbnVsbDsKICAjZXZlbnRBYm9ydENvbnRyb2xsZXIgPSBudWxsOwogICNsaW5rc0luamVjdGVkID0gZmFsc2U7CiAgY29uc3RydWN0b3IoewogICAgcGRmUGFnZSwKICAgIGxpbmtTZXJ2aWNlLAogICAgZG93bmxvYWRNYW5hZ2VyLAogICAgYW5ub3RhdGlvblN0b3JhZ2UgPSBudWxsLAogICAgaW1hZ2VSZXNvdXJjZXNQYXRoID0gIiIsCiAgICByZW5kZXJGb3JtcyA9IHRydWUsCiAgICBlbmFibGVTY3JpcHRpbmcgPSBmYWxzZSwKICAgIGhhc0pTQWN0aW9uc1Byb21pc2UgPSBudWxsLAogICAgZmllbGRPYmplY3RzUHJvbWlzZSA9IG51bGwsCiAgICBhbm5vdGF0aW9uQ2FudmFzTWFwID0gbnVsbCwKICAgIGFjY2Vzc2liaWxpdHlNYW5hZ2VyID0gbnVsbCwKICAgIGFubm90YXRpb25FZGl0b3JVSU1hbmFnZXIgPSBudWxsLAogICAgb25BcHBlbmQgPSBudWxsCiAgfSkgewogICAgdGhpcy5wZGZQYWdlID0gcGRmUGFnZTsKICAgIHRoaXMubGlua1NlcnZpY2UgPSBsaW5rU2VydmljZTsKICAgIHRoaXMuZG93bmxvYWRNYW5hZ2VyID0gZG93bmxvYWRNYW5hZ2VyOwogICAgdGhpcy5pbWFnZVJlc291cmNlc1BhdGggPSBpbWFnZVJlc291cmNlc1BhdGg7CiAgICB0aGlzLnJlbmRlckZvcm1zID0gcmVuZGVyRm9ybXM7CiAgICB0aGlzLmFubm90YXRpb25TdG9yYWdlID0gYW5ub3RhdGlvblN0b3JhZ2U7CiAgICB0aGlzLmVuYWJsZVNjcmlwdGluZyA9IGVuYWJsZVNjcmlwdGluZzsKICAgIHRoaXMuX2hhc0pTQWN0aW9uc1Byb21pc2UgPSBoYXNKU0FjdGlvbnNQcm9taXNlIHx8IFByb21pc2UucmVzb2x2ZShmYWxzZSk7CiAgICB0aGlzLl9maWVsZE9iamVjdHNQcm9taXNlID0gZmllbGRPYmplY3RzUHJvbWlzZSB8fCBQcm9taXNlLnJlc29sdmUobnVsbCk7CiAgICB0aGlzLl9hbm5vdGF0aW9uQ2FudmFzTWFwID0gYW5ub3RhdGlvbkNhbnZhc01hcDsKICAgIHRoaXMuX2FjY2Vzc2liaWxpdHlNYW5hZ2VyID0gYWNjZXNzaWJpbGl0eU1hbmFnZXI7CiAgICB0aGlzLl9hbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyID0gYW5ub3RhdGlvbkVkaXRvclVJTWFuYWdlcjsKICAgIHRoaXMuI29uQXBwZW5kID0gb25BcHBlbmQ7CiAgICB0aGlzLmFubm90YXRpb25MYXllciA9IG51bGw7CiAgICB0aGlzLmRpdiA9IG51bGw7CiAgICB0aGlzLl9jYW5jZWxsZWQgPSBmYWxzZTsKICAgIHRoaXMuX2V2ZW50QnVzID0gbGlua1NlcnZpY2UuZXZlbnRCdXM7CiAgfQogIGFzeW5jIHJlbmRlcih7CiAgICB2aWV3cG9ydCwKICAgIGludGVudCA9ICJkaXNwbGF5IiwKICAgIHN0cnVjdFRyZWVMYXllciA9IG51bGwKICB9KSB7CiAgICBpZiAodGhpcy5kaXYpIHsKICAgICAgaWYgKHRoaXMuX2NhbmNlbGxlZCB8fCAhdGhpcy5hbm5vdGF0aW9uTGF5ZXIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5hbm5vdGF0aW9uTGF5ZXIudXBkYXRlKHsKICAgICAgICB2aWV3cG9ydDogdmlld3BvcnQuY2xvbmUoewogICAgICAgICAgZG9udEZsaXA6IHRydWUKICAgICAgICB9KQogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgW2Fubm90YXRpb25zLCBoYXNKU0FjdGlvbnMsIGZpZWxkT2JqZWN0c10gPSBhd2FpdCBQcm9taXNlLmFsbChbdGhpcy5wZGZQYWdlLmdldEFubm90YXRpb25zKHsKICAgICAgaW50ZW50CiAgICB9KSwgdGhpcy5faGFzSlNBY3Rpb25zUHJvbWlzZSwgdGhpcy5fZmllbGRPYmplY3RzUHJvbWlzZV0pOwogICAgaWYgKHRoaXMuX2NhbmNlbGxlZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBkaXYgPSB0aGlzLmRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgZGl2LmNsYXNzTmFtZSA9ICJhbm5vdGF0aW9uTGF5ZXIiOwogICAgdGhpcy4jb25BcHBlbmQ/LihkaXYpOwogICAgaWYgKGFubm90YXRpb25zLmxlbmd0aCA9PT0gMCkgewogICAgICB0aGlzLiNhbm5vdGF0aW9ucyA9IGFubm90YXRpb25zOwogICAgICB0aGlzLmhpZGUodHJ1ZSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI2luaXRBbm5vdGF0aW9uTGF5ZXIodmlld3BvcnQsIHN0cnVjdFRyZWVMYXllcik7CiAgICBhd2FpdCB0aGlzLmFubm90YXRpb25MYXllci5yZW5kZXIoewogICAgICBhbm5vdGF0aW9ucywKICAgICAgaW1hZ2VSZXNvdXJjZXNQYXRoOiB0aGlzLmltYWdlUmVzb3VyY2VzUGF0aCwKICAgICAgcmVuZGVyRm9ybXM6IHRoaXMucmVuZGVyRm9ybXMsCiAgICAgIGxpbmtTZXJ2aWNlOiB0aGlzLmxpbmtTZXJ2aWNlLAogICAgICBkb3dubG9hZE1hbmFnZXI6IHRoaXMuZG93bmxvYWRNYW5hZ2VyLAogICAgICBhbm5vdGF0aW9uU3RvcmFnZTogdGhpcy5hbm5vdGF0aW9uU3RvcmFnZSwKICAgICAgZW5hYmxlU2NyaXB0aW5nOiB0aGlzLmVuYWJsZVNjcmlwdGluZywKICAgICAgaGFzSlNBY3Rpb25zLAogICAgICBmaWVsZE9iamVjdHMKICAgIH0pOwogICAgdGhpcy4jYW5ub3RhdGlvbnMgPSBhbm5vdGF0aW9uczsKICAgIGlmICh0aGlzLmxpbmtTZXJ2aWNlLmlzSW5QcmVzZW50YXRpb25Nb2RlKSB7CiAgICAgIHRoaXMuI3VwZGF0ZVByZXNlbnRhdGlvbk1vZGVTdGF0ZShQcmVzZW50YXRpb25Nb2RlU3RhdGUuRlVMTFNDUkVFTik7CiAgICB9CiAgICBpZiAoIXRoaXMuI2V2ZW50QWJvcnRDb250cm9sbGVyKSB7CiAgICAgIHRoaXMuI2V2ZW50QWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgICB0aGlzLl9ldmVudEJ1cz8uX29uKCJwcmVzZW50YXRpb25tb2RlY2hhbmdlZCIsIGV2dCA9PiB7CiAgICAgICAgdGhpcy4jdXBkYXRlUHJlc2VudGF0aW9uTW9kZVN0YXRlKGV2dC5zdGF0ZSk7CiAgICAgIH0sIHsKICAgICAgICBzaWduYWw6IHRoaXMuI2V2ZW50QWJvcnRDb250cm9sbGVyLnNpZ25hbAogICAgICB9KTsKICAgIH0KICB9CiAgI2luaXRBbm5vdGF0aW9uTGF5ZXIodmlld3BvcnQsIHN0cnVjdFRyZWVMYXllcikgewogICAgdGhpcy5hbm5vdGF0aW9uTGF5ZXIgPSBuZXcgQW5ub3RhdGlvbkxheWVyKHsKICAgICAgZGl2OiB0aGlzLmRpdiwKICAgICAgYWNjZXNzaWJpbGl0eU1hbmFnZXI6IHRoaXMuX2FjY2Vzc2liaWxpdHlNYW5hZ2VyLAogICAgICBhbm5vdGF0aW9uQ2FudmFzTWFwOiB0aGlzLl9hbm5vdGF0aW9uQ2FudmFzTWFwLAogICAgICBhbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyOiB0aGlzLl9hbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyLAogICAgICBwYWdlOiB0aGlzLnBkZlBhZ2UsCiAgICAgIHZpZXdwb3J0OiB2aWV3cG9ydC5jbG9uZSh7CiAgICAgICAgZG9udEZsaXA6IHRydWUKICAgICAgfSksCiAgICAgIHN0cnVjdFRyZWVMYXllcgogICAgfSk7CiAgfQogIGNhbmNlbCgpIHsKICAgIHRoaXMuX2NhbmNlbGxlZCA9IHRydWU7CiAgICB0aGlzLiNldmVudEFib3J0Q29udHJvbGxlcj8uYWJvcnQoKTsKICAgIHRoaXMuI2V2ZW50QWJvcnRDb250cm9sbGVyID0gbnVsbDsKICB9CiAgaGlkZShpbnRlcm5hbCA9IGZhbHNlKSB7CiAgICB0aGlzLiNleHRlcm5hbEhpZGUgPSAhaW50ZXJuYWw7CiAgICBpZiAoIXRoaXMuZGl2KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZGl2LmhpZGRlbiA9IHRydWU7CiAgfQogIGhhc0VkaXRhYmxlQW5ub3RhdGlvbnMoKSB7CiAgICByZXR1cm4gISF0aGlzLmFubm90YXRpb25MYXllcj8uaGFzRWRpdGFibGVBbm5vdGF0aW9ucygpOwogIH0KICBhc3luYyBpbmplY3RMaW5rQW5ub3RhdGlvbnMoewogICAgaW5mZXJyZWRMaW5rcywKICAgIHZpZXdwb3J0LAogICAgc3RydWN0VHJlZUxheWVyID0gbnVsbAogIH0pIHsKICAgIGlmICh0aGlzLiNhbm5vdGF0aW9ucyA9PT0gbnVsbCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoImByZW5kZXJgIG1ldGhvZCBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgYGluamVjdExpbmtBbm5vdGF0aW9uc2AuIik7CiAgICB9CiAgICBpZiAodGhpcy5fY2FuY2VsbGVkIHx8IHRoaXMuI2xpbmtzSW5qZWN0ZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jbGlua3NJbmplY3RlZCA9IHRydWU7CiAgICBjb25zdCBuZXdMaW5rcyA9IHRoaXMuI2Fubm90YXRpb25zLmxlbmd0aCA/IHRoaXMuI2NoZWNrSW5mZXJyZWRMaW5rcyhpbmZlcnJlZExpbmtzKSA6IGluZmVycmVkTGlua3M7CiAgICBpZiAoIW5ld0xpbmtzLmxlbmd0aCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXMuYW5ub3RhdGlvbkxheWVyKSB7CiAgICAgIHRoaXMuI2luaXRBbm5vdGF0aW9uTGF5ZXIodmlld3BvcnQsIHN0cnVjdFRyZWVMYXllcik7CiAgICAgIHNldExheWVyRGltZW5zaW9ucyh0aGlzLmRpdiwgdmlld3BvcnQpOwogICAgfQogICAgYXdhaXQgdGhpcy5hbm5vdGF0aW9uTGF5ZXIuYWRkTGlua0Fubm90YXRpb25zKG5ld0xpbmtzLCB0aGlzLmxpbmtTZXJ2aWNlKTsKICAgIGlmICghdGhpcy4jZXh0ZXJuYWxIaWRlKSB7CiAgICAgIHRoaXMuZGl2LmhpZGRlbiA9IGZhbHNlOwogICAgfQogIH0KICAjdXBkYXRlUHJlc2VudGF0aW9uTW9kZVN0YXRlKHN0YXRlKSB7CiAgICBpZiAoIXRoaXMuZGl2KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBkaXNhYmxlRm9ybUVsZW1lbnRzID0gZmFsc2U7CiAgICBzd2l0Y2ggKHN0YXRlKSB7CiAgICAgIGNhc2UgUHJlc2VudGF0aW9uTW9kZVN0YXRlLkZVTExTQ1JFRU46CiAgICAgICAgZGlzYWJsZUZvcm1FbGVtZW50cyA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgUHJlc2VudGF0aW9uTW9kZVN0YXRlLk5PUk1BTDoKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IHNlY3Rpb24gb2YgdGhpcy5kaXYuY2hpbGROb2RlcykgewogICAgICBpZiAoc2VjdGlvbi5oYXNBdHRyaWJ1dGUoImRhdGEtaW50ZXJuYWwtbGluayIpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc2VjdGlvbi5pbmVydCA9IGRpc2FibGVGb3JtRWxlbWVudHM7CiAgICB9CiAgfQogICNjaGVja0luZmVycmVkTGlua3MoaW5mZXJyZWRMaW5rcykgewogICAgZnVuY3Rpb24gYW5ub3RhdGlvblJlY3RzKGFubm90KSB7CiAgICAgIGlmICghYW5ub3QucXVhZFBvaW50cykgewogICAgICAgIHJldHVybiBbYW5ub3QucmVjdF07CiAgICAgIH0KICAgICAgY29uc3QgcmVjdHMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDIsIGlpID0gYW5ub3QucXVhZFBvaW50cy5sZW5ndGg7IGkgPCBpaTsgaSArPSA4KSB7CiAgICAgICAgY29uc3QgdHJYID0gYW5ub3QucXVhZFBvaW50c1tpXTsKICAgICAgICBjb25zdCB0clkgPSBhbm5vdC5xdWFkUG9pbnRzW2kgKyAxXTsKICAgICAgICBjb25zdCBibFggPSBhbm5vdC5xdWFkUG9pbnRzW2kgKyAyXTsKICAgICAgICBjb25zdCBibFkgPSBhbm5vdC5xdWFkUG9pbnRzW2kgKyAzXTsKICAgICAgICByZWN0cy5wdXNoKFtibFgsIGJsWSwgdHJYLCB0clldKTsKICAgICAgfQogICAgICByZXR1cm4gcmVjdHM7CiAgICB9CiAgICBmdW5jdGlvbiBpbnRlcnNlY3RBbm5vdGF0aW9ucyhhbm5vdDEsIGFubm90MikgewogICAgICBjb25zdCBpbnRlcnNlY3Rpb25zID0gW107CiAgICAgIGNvbnN0IGFubm90MVJlY3RzID0gYW5ub3RhdGlvblJlY3RzKGFubm90MSk7CiAgICAgIGNvbnN0IGFubm90MlJlY3RzID0gYW5ub3RhdGlvblJlY3RzKGFubm90Mik7CiAgICAgIGZvciAoY29uc3QgcmVjdDEgb2YgYW5ub3QxUmVjdHMpIHsKICAgICAgICBmb3IgKGNvbnN0IHJlY3QyIG9mIGFubm90MlJlY3RzKSB7CiAgICAgICAgICBjb25zdCBpbnRlcnNlY3Rpb24gPSBVdGlsLmludGVyc2VjdChyZWN0MSwgcmVjdDIpOwogICAgICAgICAgaWYgKGludGVyc2VjdGlvbikgewogICAgICAgICAgICBpbnRlcnNlY3Rpb25zLnB1c2goaW50ZXJzZWN0aW9uKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGludGVyc2VjdGlvbnM7CiAgICB9CiAgICBmdW5jdGlvbiBhcmVhUmVjdHMocmVjdHMpIHsKICAgICAgbGV0IHRvdGFsQXJlYSA9IDA7CiAgICAgIGZvciAoY29uc3QgcmVjdCBvZiByZWN0cykgewogICAgICAgIHRvdGFsQXJlYSArPSBNYXRoLmFicygocmVjdFsyXSAtIHJlY3RbMF0pICogKHJlY3RbM10gLSByZWN0WzFdKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRvdGFsQXJlYTsKICAgIH0KICAgIHJldHVybiBpbmZlcnJlZExpbmtzLmZpbHRlcihsaW5rID0+IHsKICAgICAgbGV0IGxpbmtBcmVhUmVjdHM7CiAgICAgIGZvciAoY29uc3QgYW5ub3RhdGlvbiBvZiB0aGlzLiNhbm5vdGF0aW9ucykgewogICAgICAgIGlmIChhbm5vdGF0aW9uLmFubm90YXRpb25UeXBlICE9PSBBbm5vdGF0aW9uVHlwZS5MSU5LIHx8ICFhbm5vdGF0aW9uLnVybCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGludGVyc2VjdGlvbnMgPSBpbnRlcnNlY3RBbm5vdGF0aW9ucyhhbm5vdGF0aW9uLCBsaW5rKTsKICAgICAgICBpZiAoaW50ZXJzZWN0aW9ucy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBsaW5rQXJlYVJlY3RzID8/PSBhcmVhUmVjdHMoYW5ub3RhdGlvblJlY3RzKGxpbmspKTsKICAgICAgICBpZiAoYXJlYVJlY3RzKGludGVyc2VjdGlvbnMpIC8gbGlua0FyZWFSZWN0cyA+IDAuNSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0pOwogIH0KfQoKOy8vIC4vd2ViL2F1dG9saW5rZXIuanMKCgpmdW5jdGlvbiBET01SZWN0VG9QREYoewogIHdpZHRoLAogIGhlaWdodCwKICBsZWZ0LAogIHRvcAp9LCBwZGZQYWdlVmlldykgewogIGlmICh3aWR0aCA9PT0gMCB8fCBoZWlnaHQgPT09IDApIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBwYWdlQm94ID0gcGRmUGFnZVZpZXcudGV4dExheWVyLmRpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICBjb25zdCBib3R0b21MZWZ0ID0gcGRmUGFnZVZpZXcuZ2V0UGFnZVBvaW50KGxlZnQgLSBwYWdlQm94LmxlZnQsIHRvcCAtIHBhZ2VCb3gudG9wKTsKICBjb25zdCB0b3BSaWdodCA9IHBkZlBhZ2VWaWV3LmdldFBhZ2VQb2ludChsZWZ0IC0gcGFnZUJveC5sZWZ0ICsgd2lkdGgsIHRvcCAtIHBhZ2VCb3gudG9wICsgaGVpZ2h0KTsKICByZXR1cm4gVXRpbC5ub3JtYWxpemVSZWN0KFtib3R0b21MZWZ0WzBdLCBib3R0b21MZWZ0WzFdLCB0b3BSaWdodFswXSwgdG9wUmlnaHRbMV1dKTsKfQpmdW5jdGlvbiBjYWxjdWxhdGVMaW5rUG9zaXRpb24ocmFuZ2UsIHBkZlBhZ2VWaWV3KSB7CiAgY29uc3QgcmFuZ2VSZWN0cyA9IHJhbmdlLmdldENsaWVudFJlY3RzKCk7CiAgaWYgKHJhbmdlUmVjdHMubGVuZ3RoID09PSAxKSB7CiAgICByZXR1cm4gewogICAgICByZWN0OiBET01SZWN0VG9QREYocmFuZ2VSZWN0c1swXSwgcGRmUGFnZVZpZXcpCiAgICB9OwogIH0KICBjb25zdCByZWN0ID0gW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldOwogIGNvbnN0IHF1YWRQb2ludHMgPSBbXTsKICBsZXQgaSA9IDA7CiAgZm9yIChjb25zdCBkb21SZWN0IG9mIHJhbmdlUmVjdHMpIHsKICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBET01SZWN0VG9QREYoZG9tUmVjdCwgcGRmUGFnZVZpZXcpOwogICAgaWYgKG5vcm1hbGl6ZWQgPT09IG51bGwpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBxdWFkUG9pbnRzW2ldID0gcXVhZFBvaW50c1tpICsgNF0gPSBub3JtYWxpemVkWzBdOwogICAgcXVhZFBvaW50c1tpICsgMV0gPSBxdWFkUG9pbnRzW2kgKyAzXSA9IG5vcm1hbGl6ZWRbM107CiAgICBxdWFkUG9pbnRzW2kgKyAyXSA9IHF1YWRQb2ludHNbaSArIDZdID0gbm9ybWFsaXplZFsyXTsKICAgIHF1YWRQb2ludHNbaSArIDVdID0gcXVhZFBvaW50c1tpICsgN10gPSBub3JtYWxpemVkWzFdOwogICAgVXRpbC5yZWN0Qm91bmRpbmdCb3goLi4ubm9ybWFsaXplZCwgcmVjdCk7CiAgICBpICs9IDg7CiAgfQogIHJldHVybiB7CiAgICBxdWFkUG9pbnRzLAogICAgcmVjdAogIH07Cn0KZnVuY3Rpb24gdGV4dFBvc2l0aW9uKGNvbnRhaW5lciwgb2Zmc2V0KSB7CiAgbGV0IGN1cnJlbnRDb250YWluZXIgPSBjb250YWluZXI7CiAgZG8gewogICAgaWYgKGN1cnJlbnRDb250YWluZXIubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFKSB7CiAgICAgIGNvbnN0IGN1cnJlbnRMZW5ndGggPSBjdXJyZW50Q29udGFpbmVyLnRleHRDb250ZW50Lmxlbmd0aDsKICAgICAgaWYgKG9mZnNldCA8PSBjdXJyZW50TGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIFtjdXJyZW50Q29udGFpbmVyLCBvZmZzZXRdOwogICAgICB9CiAgICAgIG9mZnNldCAtPSBjdXJyZW50TGVuZ3RoOwogICAgfSBlbHNlIGlmIChjdXJyZW50Q29udGFpbmVyLmZpcnN0Q2hpbGQpIHsKICAgICAgY3VycmVudENvbnRhaW5lciA9IGN1cnJlbnRDb250YWluZXIuZmlyc3RDaGlsZDsKICAgICAgY29udGludWU7CiAgICB9CiAgICB3aGlsZSAoIWN1cnJlbnRDb250YWluZXIubmV4dFNpYmxpbmcgJiYgY3VycmVudENvbnRhaW5lciAhPT0gY29udGFpbmVyKSB7CiAgICAgIGN1cnJlbnRDb250YWluZXIgPSBjdXJyZW50Q29udGFpbmVyLnBhcmVudE5vZGU7CiAgICB9CiAgICBpZiAoY3VycmVudENvbnRhaW5lciAhPT0gY29udGFpbmVyKSB7CiAgICAgIGN1cnJlbnRDb250YWluZXIgPSBjdXJyZW50Q29udGFpbmVyLm5leHRTaWJsaW5nOwogICAgfQogIH0gd2hpbGUgKGN1cnJlbnRDb250YWluZXIgIT09IGNvbnRhaW5lcik7CiAgdGhyb3cgbmV3IEVycm9yKCJPZmZzZXQgaXMgYmlnZ2VyIHRoYW4gY29udGFpbmVyJ3MgY29udGVudHMgbGVuZ3RoLiIpOwp9CmZ1bmN0aW9uIGNyZWF0ZUxpbmtBbm5vdGF0aW9uKHsKICB1cmwsCiAgaW5kZXgsCiAgbGVuZ3RoCn0sIHBkZlBhZ2VWaWV3LCBpZCkgewogIGNvbnN0IGhpZ2hsaWdodGVyID0gcGRmUGFnZVZpZXcuX3RleHRIaWdobGlnaHRlcjsKICBjb25zdCBbewogICAgYmVnaW4sCiAgICBlbmQKICB9XSA9IGhpZ2hsaWdodGVyLl9jb252ZXJ0TWF0Y2hlcyhbaW5kZXhdLCBbbGVuZ3RoXSk7CiAgY29uc3QgcmFuZ2UgPSBuZXcgUmFuZ2UoKTsKICByYW5nZS5zZXRTdGFydCguLi50ZXh0UG9zaXRpb24oaGlnaGxpZ2h0ZXIudGV4dERpdnNbYmVnaW4uZGl2SWR4XSwgYmVnaW4ub2Zmc2V0KSk7CiAgcmFuZ2Uuc2V0RW5kKC4uLnRleHRQb3NpdGlvbihoaWdobGlnaHRlci50ZXh0RGl2c1tlbmQuZGl2SWR4XSwgZW5kLm9mZnNldCkpOwogIHJldHVybiB7CiAgICBpZDogYGluZmVycmVkX2xpbmtfJHtpZH1gLAogICAgdW5zYWZlVXJsOiB1cmwsCiAgICB1cmwsCiAgICBhbm5vdGF0aW9uVHlwZTogQW5ub3RhdGlvblR5cGUuTElOSywKICAgIHJvdGF0aW9uOiAwLAogICAgLi4uY2FsY3VsYXRlTGlua1Bvc2l0aW9uKHJhbmdlLCBwZGZQYWdlVmlldyksCiAgICBib3JkZXJTdHlsZTogbnVsbAogIH07Cn0KY2xhc3MgQXV0b2xpbmtlciB7CiAgc3RhdGljICNpbmRleCA9IDA7CiAgc3RhdGljICNyZWdleDsKICBzdGF0aWMgZmluZExpbmtzKHRleHQpIHsKICAgIHRoaXMuI3JlZ2V4ID8/PSAvXGIoPzpodHRwcz86XC9cL3xtYWlsdG86fHd3d1wuKSg/OltcUy0tW1xwe1B9PD5dXXxcL3xbXFMtLVtcW1xdXV0rW1xTLS1bXHB7UH08Pl1dKSt8XGJbXFMtLVtAXHB7UHN9XHB7UGV9PD5dXStAKFtcUy0tW1xwe1B9PD5dXSsoPzpcLltcUy0tW1xwe1B9PD5dXSspKykvZ212OwogICAgY29uc3QgW25vcm1hbGl6ZWRUZXh0LCBkaWZmc10gPSBub3JtYWxpemUodGV4dCk7CiAgICBjb25zdCBtYXRjaGVzID0gbm9ybWFsaXplZFRleHQubWF0Y2hBbGwodGhpcy4jcmVnZXgpOwogICAgY29uc3QgbGlua3MgPSBbXTsKICAgIGZvciAoY29uc3QgbWF0Y2ggb2YgbWF0Y2hlcykgewogICAgICBjb25zdCBbdXJsLCBlbWFpbERvbWFpbl0gPSBtYXRjaDsKICAgICAgbGV0IHJhdzsKICAgICAgaWYgKHVybC5zdGFydHNXaXRoKCJ3d3cuIikgfHwgdXJsLnN0YXJ0c1dpdGgoImh0dHA6Ly8iKSB8fCB1cmwuc3RhcnRzV2l0aCgiaHR0cHM6Ly8iKSkgewogICAgICAgIHJhdyA9IHVybDsKICAgICAgfSBlbHNlIGlmIChVUkwuY2FuUGFyc2UoYGh0dHA6Ly8ke2VtYWlsRG9tYWlufWApKSB7CiAgICAgICAgcmF3ID0gdXJsLnN0YXJ0c1dpdGgoIm1haWx0bzoiKSA/IHVybCA6IGBtYWlsdG86JHt1cmx9YDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBhYnNvbHV0ZVVSTCA9IGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwocmF3LCBudWxsLCB7CiAgICAgICAgYWRkRGVmYXVsdFByb3RvY29sOiB0cnVlCiAgICAgIH0pOwogICAgICBpZiAoYWJzb2x1dGVVUkwpIHsKICAgICAgICBjb25zdCBbaW5kZXgsIGxlbmd0aF0gPSBnZXRPcmlnaW5hbEluZGV4KGRpZmZzLCBtYXRjaC5pbmRleCwgdXJsLmxlbmd0aCk7CiAgICAgICAgbGlua3MucHVzaCh7CiAgICAgICAgICB1cmw6IGFic29sdXRlVVJMLmhyZWYsCiAgICAgICAgICBpbmRleCwKICAgICAgICAgIGxlbmd0aAogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbGlua3M7CiAgfQogIHN0YXRpYyBwcm9jZXNzTGlua3MocGRmUGFnZVZpZXcpIHsKICAgIHJldHVybiB0aGlzLmZpbmRMaW5rcyhwZGZQYWdlVmlldy5fdGV4dEhpZ2hsaWdodGVyLnRleHRDb250ZW50SXRlbXNTdHIuam9pbigiXG4iKSkubWFwKGxpbmsgPT4gY3JlYXRlTGlua0Fubm90YXRpb24obGluaywgcGRmUGFnZVZpZXcsIHRoaXMuI2luZGV4KyspKTsKICB9Cn0KCjsvLyAuL3dlYi9iYXNlX3BkZl9wYWdlX3ZpZXcuanMKCgpjbGFzcyBCYXNlUERGUGFnZVZpZXcgewogICNlbmFibGVIV0EgPSBmYWxzZTsKICAjbG9hZGluZ0lkID0gbnVsbDsKICAjbWluRHVyYXRpb25Ub1VwZGF0ZUNhbnZhcyA9IDA7CiAgI3JlbmRlckVycm9yID0gbnVsbDsKICAjcmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuSU5JVElBTDsKICAjc2hvd0NhbnZhcyA9IG51bGw7CiAgI3N0YXJ0VGltZSA9IDA7CiAgI3RlbXBDYW52YXMgPSBudWxsOwogIGNhbnZhcyA9IG51bGw7CiAgZGl2ID0gbnVsbDsKICBldmVudEJ1cyA9IG51bGw7CiAgaWQgPSBudWxsOwogIHBhZ2VDb2xvcnMgPSBudWxsOwogIHJlbmRlcmluZ1F1ZXVlID0gbnVsbDsKICByZW5kZXJUYXNrID0gbnVsbDsKICByZXN1bWUgPSBudWxsOwogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHRoaXMuI2VuYWJsZUhXQSA9ICNlbmFibGVIV0EgaW4gb3B0aW9ucyA/IG9wdGlvbnMuI2VuYWJsZUhXQSA6IG9wdGlvbnMuZW5hYmxlSFdBIHx8IGZhbHNlOwogICAgdGhpcy5ldmVudEJ1cyA9IG9wdGlvbnMuZXZlbnRCdXM7CiAgICB0aGlzLmlkID0gb3B0aW9ucy5pZDsKICAgIHRoaXMucGFnZUNvbG9ycyA9IG9wdGlvbnMucGFnZUNvbG9ycyB8fCBudWxsOwogICAgdGhpcy5yZW5kZXJpbmdRdWV1ZSA9IG9wdGlvbnMucmVuZGVyaW5nUXVldWU7CiAgICB0aGlzLiNtaW5EdXJhdGlvblRvVXBkYXRlQ2FudmFzID0gb3B0aW9ucy5taW5EdXJhdGlvblRvVXBkYXRlQ2FudmFzID8/IDUwMDsKICB9CiAgZ2V0IHJlbmRlcmluZ1N0YXRlKCkgewogICAgcmV0dXJuIHRoaXMuI3JlbmRlcmluZ1N0YXRlOwogIH0KICBzZXQgcmVuZGVyaW5nU3RhdGUoc3RhdGUpIHsKICAgIGlmIChzdGF0ZSA9PT0gdGhpcy4jcmVuZGVyaW5nU3RhdGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jcmVuZGVyaW5nU3RhdGUgPSBzdGF0ZTsKICAgIGlmICh0aGlzLiNsb2FkaW5nSWQpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuI2xvYWRpbmdJZCk7CiAgICAgIHRoaXMuI2xvYWRpbmdJZCA9IG51bGw7CiAgICB9CiAgICBzd2l0Y2ggKHN0YXRlKSB7CiAgICAgIGNhc2UgUmVuZGVyaW5nU3RhdGVzLlBBVVNFRDoKICAgICAgICB0aGlzLmRpdi5jbGFzc0xpc3QucmVtb3ZlKCJsb2FkaW5nIik7CiAgICAgICAgdGhpcy4jc3RhcnRUaW1lID0gMDsKICAgICAgICB0aGlzLiNzaG93Q2FudmFzPy4oZmFsc2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFJlbmRlcmluZ1N0YXRlcy5SVU5OSU5HOgogICAgICAgIHRoaXMuZGl2LmNsYXNzTGlzdC5hZGQoImxvYWRpbmdJY29uIik7CiAgICAgICAgdGhpcy4jbG9hZGluZ0lkID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmRpdi5jbGFzc0xpc3QuYWRkKCJsb2FkaW5nIik7CiAgICAgICAgICB0aGlzLiNsb2FkaW5nSWQgPSBudWxsOwogICAgICAgIH0sIDApOwogICAgICAgIHRoaXMuI3N0YXJ0VGltZSA9IERhdGUubm93KCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgUmVuZGVyaW5nU3RhdGVzLklOSVRJQUw6CiAgICAgIGNhc2UgUmVuZGVyaW5nU3RhdGVzLkZJTklTSEVEOgogICAgICAgIHRoaXMuZGl2LmNsYXNzTGlzdC5yZW1vdmUoImxvYWRpbmdJY29uIiwgImxvYWRpbmciKTsKICAgICAgICB0aGlzLiNzdGFydFRpbWUgPSAwOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KICBfY3JlYXRlQ2FudmFzKG9uU2hvdywgaGlkZVVudGlsQ29tcGxldGUgPSBmYWxzZSkgewogICAgY29uc3QgewogICAgICBwYWdlQ29sb3JzCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IGhhc0hDTSA9ICEhKHBhZ2VDb2xvcnM/LmJhY2tncm91bmQgJiYgcGFnZUNvbG9ycz8uZm9yZWdyb3VuZCk7CiAgICBjb25zdCBwcmV2Q2FudmFzID0gdGhpcy5jYW52YXM7CiAgICBjb25zdCB1cGRhdGVPbkZpcnN0U2hvdyA9ICFwcmV2Q2FudmFzICYmICFoYXNIQ00gJiYgIWhpZGVVbnRpbENvbXBsZXRlOwogICAgbGV0IGNhbnZhcyA9IHRoaXMuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICB0aGlzLiNzaG93Q2FudmFzID0gaXNMYXN0U2hvdyA9PiB7CiAgICAgIGlmICh1cGRhdGVPbkZpcnN0U2hvdykgewogICAgICAgIGxldCB0ZW1wQ2FudmFzID0gdGhpcy4jdGVtcENhbnZhczsKICAgICAgICBpZiAoIWlzTGFzdFNob3cgJiYgdGhpcy4jbWluRHVyYXRpb25Ub1VwZGF0ZUNhbnZhcyA+IDApIHsKICAgICAgICAgIGlmIChEYXRlLm5vdygpIC0gdGhpcy4jc3RhcnRUaW1lIDwgdGhpcy4jbWluRHVyYXRpb25Ub1VwZGF0ZUNhbnZhcykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXRlbXBDYW52YXMpIHsKICAgICAgICAgICAgdGVtcENhbnZhcyA9IHRoaXMuI3RlbXBDYW52YXMgPSBjYW52YXM7CiAgICAgICAgICAgIGNhbnZhcyA9IHRoaXMuY2FudmFzID0gY2FudmFzLmNsb25lTm9kZShmYWxzZSk7CiAgICAgICAgICAgIG9uU2hvdyhjYW52YXMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodGVtcENhbnZhcykgewogICAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICAgICAgICBhbHBoYTogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgICAgY3R4LmRyYXdJbWFnZSh0ZW1wQ2FudmFzLCAwLCAwKTsKICAgICAgICAgIGlmIChpc0xhc3RTaG93KSB7CiAgICAgICAgICAgIHRoaXMuI3Jlc2V0VGVtcENhbnZhcygpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy4jc3RhcnRUaW1lID0gRGF0ZS5ub3coKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgb25TaG93KGNhbnZhcyk7CiAgICAgICAgdGhpcy4jc2hvd0NhbnZhcyA9IG51bGw7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghaXNMYXN0U2hvdykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAocHJldkNhbnZhcykgewogICAgICAgIHByZXZDYW52YXMucmVwbGFjZVdpdGgoY2FudmFzKTsKICAgICAgICBwcmV2Q2FudmFzLndpZHRoID0gcHJldkNhbnZhcy5oZWlnaHQgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIG9uU2hvdyhjYW52YXMpOwogICAgICB9CiAgICB9OwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICBhbHBoYTogZmFsc2UsCiAgICAgIHdpbGxSZWFkRnJlcXVlbnRseTogIXRoaXMuI2VuYWJsZUhXQQogICAgfSk7CiAgICByZXR1cm4gewogICAgICBjYW52YXMsCiAgICAgIHByZXZDYW52YXMsCiAgICAgIGN0eAogICAgfTsKICB9CiAgI3JlbmRlckNvbnRpbnVlQ2FsbGJhY2sgPSBjb250ID0+IHsKICAgIHRoaXMuI3Nob3dDYW52YXM/LihmYWxzZSk7CiAgICBpZiAodGhpcy5yZW5kZXJpbmdRdWV1ZSAmJiAhdGhpcy5yZW5kZXJpbmdRdWV1ZS5pc0hpZ2hlc3RQcmlvcml0eSh0aGlzKSkgewogICAgICB0aGlzLnJlbmRlcmluZ1N0YXRlID0gUmVuZGVyaW5nU3RhdGVzLlBBVVNFRDsKICAgICAgdGhpcy5yZXN1bWUgPSAoKSA9PiB7CiAgICAgICAgdGhpcy5yZW5kZXJpbmdTdGF0ZSA9IFJlbmRlcmluZ1N0YXRlcy5SVU5OSU5HOwogICAgICAgIGNvbnQoKTsKICAgICAgfTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29udCgpOwogIH07CiAgX3Jlc2V0Q2FudmFzKCkgewogICAgY29uc3QgewogICAgICBjYW52YXMKICAgIH0gPSB0aGlzOwogICAgaWYgKCFjYW52YXMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY2FudmFzLnJlbW92ZSgpOwogICAgY2FudmFzLndpZHRoID0gY2FudmFzLmhlaWdodCA9IDA7CiAgICB0aGlzLmNhbnZhcyA9IG51bGw7CiAgICB0aGlzLiNyZXNldFRlbXBDYW52YXMoKTsKICB9CiAgI3Jlc2V0VGVtcENhbnZhcygpIHsKICAgIGlmICh0aGlzLiN0ZW1wQ2FudmFzKSB7CiAgICAgIHRoaXMuI3RlbXBDYW52YXMud2lkdGggPSB0aGlzLiN0ZW1wQ2FudmFzLmhlaWdodCA9IDA7CiAgICAgIHRoaXMuI3RlbXBDYW52YXMgPSBudWxsOwogICAgfQogIH0KICBhc3luYyBfZHJhd0NhbnZhcyhvcHRpb25zLCBvbkNhbmNlbCwgb25GaW5pc2gpIHsKICAgIGNvbnN0IHJlbmRlclRhc2sgPSB0aGlzLnJlbmRlclRhc2sgPSB0aGlzLnBkZlBhZ2UucmVuZGVyKG9wdGlvbnMpOwogICAgcmVuZGVyVGFzay5vbkNvbnRpbnVlID0gdGhpcy4jcmVuZGVyQ29udGludWVDYWxsYmFjazsKICAgIHJlbmRlclRhc2sub25FcnJvciA9IGVycm9yID0+IHsKICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uKSB7CiAgICAgICAgb25DYW5jZWwoKTsKICAgICAgICB0aGlzLiNyZW5kZXJFcnJvciA9IG51bGw7CiAgICAgIH0KICAgIH07CiAgICBsZXQgZXJyb3IgPSBudWxsOwogICAgdHJ5IHsKICAgICAgYXdhaXQgcmVuZGVyVGFzay5wcm9taXNlOwogICAgICB0aGlzLiNzaG93Q2FudmFzPy4odHJ1ZSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGlmIChlIGluc3RhbmNlb2YgUmVuZGVyaW5nQ2FuY2VsbGVkRXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGVycm9yID0gZTsKICAgICAgdGhpcy4jc2hvd0NhbnZhcz8uKHRydWUpOwogICAgfSBmaW5hbGx5IHsKICAgICAgdGhpcy4jcmVuZGVyRXJyb3IgPSBlcnJvcjsKICAgICAgaWYgKHJlbmRlclRhc2sgPT09IHRoaXMucmVuZGVyVGFzaykgewogICAgICAgIHRoaXMucmVuZGVyVGFzayA9IG51bGw7CiAgICAgIH0KICAgIH0KICAgIHRoaXMucmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuRklOSVNIRUQ7CiAgICBvbkZpbmlzaChyZW5kZXJUYXNrKTsKICAgIGlmIChlcnJvcikgewogICAgICB0aHJvdyBlcnJvcjsKICAgIH0KICB9CiAgY2FuY2VsUmVuZGVyaW5nKHsKICAgIGNhbmNlbEV4dHJhRGVsYXkgPSAwCiAgfSA9IHt9KSB7CiAgICBpZiAodGhpcy5yZW5kZXJUYXNrKSB7CiAgICAgIHRoaXMucmVuZGVyVGFzay5jYW5jZWwoY2FuY2VsRXh0cmFEZWxheSk7CiAgICAgIHRoaXMucmVuZGVyVGFzayA9IG51bGw7CiAgICB9CiAgICB0aGlzLnJlc3VtZSA9IG51bGw7CiAgfQogIGRpc3BhdGNoUGFnZVJlbmRlcigpIHsKICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goInBhZ2VyZW5kZXIiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgcGFnZU51bWJlcjogdGhpcy5pZAogICAgfSk7CiAgfQogIGRpc3BhdGNoUGFnZVJlbmRlcmVkKGNzc1RyYW5zZm9ybSwgaXNEZXRhaWxWaWV3KSB7CiAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJwYWdlcmVuZGVyZWQiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgcGFnZU51bWJlcjogdGhpcy5pZCwKICAgICAgY3NzVHJhbnNmb3JtLAogICAgICBpc0RldGFpbFZpZXcsCiAgICAgIHRpbWVzdGFtcDogcGVyZm9ybWFuY2Uubm93KCksCiAgICAgIGVycm9yOiB0aGlzLiNyZW5kZXJFcnJvcgogICAgfSk7CiAgfQp9Cgo7Ly8gLi93ZWIvZHJhd19sYXllcl9idWlsZGVyLmpzCgpjbGFzcyBEcmF3TGF5ZXJCdWlsZGVyIHsKICAjZHJhd0xheWVyID0gbnVsbDsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICB0aGlzLnBhZ2VJbmRleCA9IG9wdGlvbnMucGFnZUluZGV4OwogIH0KICBhc3luYyByZW5kZXIoewogICAgaW50ZW50ID0gImRpc3BsYXkiCiAgfSkgewogICAgaWYgKGludGVudCAhPT0gImRpc3BsYXkiIHx8IHRoaXMuI2RyYXdMYXllciB8fCB0aGlzLl9jYW5jZWxsZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jZHJhd0xheWVyID0gbmV3IERyYXdMYXllcih7CiAgICAgIHBhZ2VJbmRleDogdGhpcy5wYWdlSW5kZXgKICAgIH0pOwogIH0KICBjYW5jZWwoKSB7CiAgICB0aGlzLl9jYW5jZWxsZWQgPSB0cnVlOwogICAgaWYgKCF0aGlzLiNkcmF3TGF5ZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jZHJhd0xheWVyLmRlc3Ryb3koKTsKICAgIHRoaXMuI2RyYXdMYXllciA9IG51bGw7CiAgfQogIHNldFBhcmVudChwYXJlbnQpIHsKICAgIHRoaXMuI2RyYXdMYXllcj8uc2V0UGFyZW50KHBhcmVudCk7CiAgfQogIGdldERyYXdMYXllcigpIHsKICAgIHJldHVybiB0aGlzLiNkcmF3TGF5ZXI7CiAgfQp9Cgo7Ly8gLi93ZWIvcGRmX3BhZ2VfZGV0YWlsX3ZpZXcuanMKCgoKY2xhc3MgUERGUGFnZURldGFpbFZpZXcgZXh0ZW5kcyBCYXNlUERGUGFnZVZpZXcgewogICNkZXRhaWxBcmVhID0gbnVsbDsKICByZW5kZXJpbmdDYW5jZWxsZWQgPSBmYWxzZTsKICBjb25zdHJ1Y3Rvcih7CiAgICBwYWdlVmlldwogIH0pIHsKICAgIHN1cGVyKHBhZ2VWaWV3KTsKICAgIHRoaXMucGFnZVZpZXcgPSBwYWdlVmlldzsKICAgIHRoaXMucmVuZGVyaW5nSWQgPSAiZGV0YWlsIiArIHRoaXMuaWQ7CiAgICB0aGlzLmRpdiA9IHBhZ2VWaWV3LmRpdjsKICB9CiAgc2V0UGRmUGFnZShwZGZQYWdlKSB7CiAgICB0aGlzLnBhZ2VWaWV3LnNldFBkZlBhZ2UocGRmUGFnZSk7CiAgfQogIGdldCBwZGZQYWdlKCkgewogICAgcmV0dXJuIHRoaXMucGFnZVZpZXcucGRmUGFnZTsKICB9CiAgZ2V0IHJlbmRlcmluZ1N0YXRlKCkgewogICAgcmV0dXJuIHN1cGVyLnJlbmRlcmluZ1N0YXRlOwogIH0KICBzZXQgcmVuZGVyaW5nU3RhdGUodmFsdWUpIHsKICAgIHRoaXMucmVuZGVyaW5nQ2FuY2VsbGVkID0gZmFsc2U7CiAgICBzdXBlci5yZW5kZXJpbmdTdGF0ZSA9IHZhbHVlOwogIH0KICByZXNldCh7CiAgICBrZWVwQ2FudmFzID0gZmFsc2UKICB9ID0ge30pIHsKICAgIGNvbnN0IHJlbmRlcmluZ0NhbmNlbGxlZCA9IHRoaXMucmVuZGVyaW5nQ2FuY2VsbGVkIHx8IHRoaXMucmVuZGVyaW5nU3RhdGUgPT09IFJlbmRlcmluZ1N0YXRlcy5SVU5OSU5HIHx8IHRoaXMucmVuZGVyaW5nU3RhdGUgPT09IFJlbmRlcmluZ1N0YXRlcy5QQVVTRUQ7CiAgICB0aGlzLmNhbmNlbFJlbmRlcmluZygpOwogICAgdGhpcy5yZW5kZXJpbmdTdGF0ZSA9IFJlbmRlcmluZ1N0YXRlcy5JTklUSUFMOwogICAgdGhpcy5yZW5kZXJpbmdDYW5jZWxsZWQgPSByZW5kZXJpbmdDYW5jZWxsZWQ7CiAgICBpZiAoIWtlZXBDYW52YXMpIHsKICAgICAgdGhpcy5fcmVzZXRDYW52YXMoKTsKICAgIH0KICB9CiAgI3Nob3VsZFJlbmRlckRpZmZlcmVudEFyZWEodmlzaWJsZUFyZWEpIHsKICAgIGlmICghdGhpcy4jZGV0YWlsQXJlYSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGNvbnN0IG1pbkRldGFpbFggPSB0aGlzLiNkZXRhaWxBcmVhLm1pblg7CiAgICBjb25zdCBtaW5EZXRhaWxZID0gdGhpcy4jZGV0YWlsQXJlYS5taW5ZOwogICAgY29uc3QgbWF4RGV0YWlsWCA9IHRoaXMuI2RldGFpbEFyZWEud2lkdGggKyBtaW5EZXRhaWxYOwogICAgY29uc3QgbWF4RGV0YWlsWSA9IHRoaXMuI2RldGFpbEFyZWEuaGVpZ2h0ICsgbWluRGV0YWlsWTsKICAgIGlmICh2aXNpYmxlQXJlYS5taW5YIDwgbWluRGV0YWlsWCB8fCB2aXNpYmxlQXJlYS5taW5ZIDwgbWluRGV0YWlsWSB8fCB2aXNpYmxlQXJlYS5tYXhYID4gbWF4RGV0YWlsWCB8fCB2aXNpYmxlQXJlYS5tYXhZID4gbWF4RGV0YWlsWSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgd2lkdGg6IG1heFdpZHRoLAogICAgICBoZWlnaHQ6IG1heEhlaWdodCwKICAgICAgc2NhbGUKICAgIH0gPSB0aGlzLnBhZ2VWaWV3LnZpZXdwb3J0OwogICAgaWYgKHRoaXMuI2RldGFpbEFyZWEuc2NhbGUgIT09IHNjYWxlKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgY29uc3QgcGFkZGluZ0xlZnRTaXplID0gdmlzaWJsZUFyZWEubWluWCAtIG1pbkRldGFpbFg7CiAgICBjb25zdCBwYWRkaW5nUmlnaHRTaXplID0gbWF4RGV0YWlsWCAtIHZpc2libGVBcmVhLm1heFg7CiAgICBjb25zdCBwYWRkaW5nVG9wU2l6ZSA9IHZpc2libGVBcmVhLm1pblkgLSBtaW5EZXRhaWxZOwogICAgY29uc3QgcGFkZGluZ0JvdHRvbVNpemUgPSBtYXhEZXRhaWxZIC0gdmlzaWJsZUFyZWEubWF4WTsKICAgIGNvbnN0IE1PVkVNRU5UX1RIUkVTSE9MRCA9IDAuNTsKICAgIGNvbnN0IHJhdGlvID0gKDEgKyBNT1ZFTUVOVF9USFJFU0hPTEQpIC8gTU9WRU1FTlRfVEhSRVNIT0xEOwogICAgaWYgKG1pbkRldGFpbFggPiAwICYmIHBhZGRpbmdSaWdodFNpemUgLyBwYWRkaW5nTGVmdFNpemUgPiByYXRpbyB8fCBtYXhEZXRhaWxYIDwgbWF4V2lkdGggJiYgcGFkZGluZ0xlZnRTaXplIC8gcGFkZGluZ1JpZ2h0U2l6ZSA+IHJhdGlvIHx8IG1pbkRldGFpbFkgPiAwICYmIHBhZGRpbmdCb3R0b21TaXplIC8gcGFkZGluZ1RvcFNpemUgPiByYXRpbyB8fCBtYXhEZXRhaWxZIDwgbWF4SGVpZ2h0ICYmIHBhZGRpbmdUb3BTaXplIC8gcGFkZGluZ0JvdHRvbVNpemUgPiByYXRpbykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgdXBkYXRlKHsKICAgIHZpc2libGVBcmVhID0gbnVsbCwKICAgIHVuZGVybHlpbmdWaWV3VXBkYXRlZCA9IGZhbHNlCiAgfSA9IHt9KSB7CiAgICBpZiAodW5kZXJseWluZ1ZpZXdVcGRhdGVkKSB7CiAgICAgIHRoaXMuY2FuY2VsUmVuZGVyaW5nKCk7CiAgICAgIHRoaXMucmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuSU5JVElBTDsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzLiNzaG91bGRSZW5kZXJEaWZmZXJlbnRBcmVhKHZpc2libGVBcmVhKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHZpZXdwb3J0LAogICAgICBtYXhDYW52YXNQaXhlbHMsCiAgICAgIGNhcENhbnZhc0FyZWFGYWN0b3IKICAgIH0gPSB0aGlzLnBhZ2VWaWV3OwogICAgY29uc3QgdmlzaWJsZVdpZHRoID0gdmlzaWJsZUFyZWEubWF4WCAtIHZpc2libGVBcmVhLm1pblg7CiAgICBjb25zdCB2aXNpYmxlSGVpZ2h0ID0gdmlzaWJsZUFyZWEubWF4WSAtIHZpc2libGVBcmVhLm1pblk7CiAgICBjb25zdCB2aXNpYmxlUGl4ZWxzID0gdmlzaWJsZVdpZHRoICogdmlzaWJsZUhlaWdodCAqIE91dHB1dFNjYWxlLnBpeGVsUmF0aW8gKiogMjsKICAgIGNvbnN0IG1heERldGFpbFRvVmlzaWJsZUxpbmVhclJhdGlvID0gTWF0aC5zcXJ0KE91dHB1dFNjYWxlLmNhcFBpeGVscyhtYXhDYW52YXNQaXhlbHMsIGNhcENhbnZhc0FyZWFGYWN0b3IpIC8gdmlzaWJsZVBpeGVscyk7CiAgICBjb25zdCBtYXhPdmVyZmxvd1NjYWxlID0gKG1heERldGFpbFRvVmlzaWJsZUxpbmVhclJhdGlvIC0gMSkgLyAyOwogICAgbGV0IG92ZXJmbG93U2NhbGUgPSBNYXRoLm1pbigxLCBtYXhPdmVyZmxvd1NjYWxlKTsKICAgIGlmIChvdmVyZmxvd1NjYWxlIDwgMCkgewogICAgICBvdmVyZmxvd1NjYWxlID0gMDsKICAgIH0KICAgIGNvbnN0IG92ZXJmbG93V2lkdGggPSB2aXNpYmxlV2lkdGggKiBvdmVyZmxvd1NjYWxlOwogICAgY29uc3Qgb3ZlcmZsb3dIZWlnaHQgPSB2aXNpYmxlSGVpZ2h0ICogb3ZlcmZsb3dTY2FsZTsKICAgIGNvbnN0IG1pblggPSBNYXRoLm1heCgwLCB2aXNpYmxlQXJlYS5taW5YIC0gb3ZlcmZsb3dXaWR0aCk7CiAgICBjb25zdCBtYXhYID0gTWF0aC5taW4odmlld3BvcnQud2lkdGgsIHZpc2libGVBcmVhLm1heFggKyBvdmVyZmxvd1dpZHRoKTsKICAgIGNvbnN0IG1pblkgPSBNYXRoLm1heCgwLCB2aXNpYmxlQXJlYS5taW5ZIC0gb3ZlcmZsb3dIZWlnaHQpOwogICAgY29uc3QgbWF4WSA9IE1hdGgubWluKHZpZXdwb3J0LmhlaWdodCwgdmlzaWJsZUFyZWEubWF4WSArIG92ZXJmbG93SGVpZ2h0KTsKICAgIGNvbnN0IHdpZHRoID0gbWF4WCAtIG1pblg7CiAgICBjb25zdCBoZWlnaHQgPSBtYXhZIC0gbWluWTsKICAgIHRoaXMuI2RldGFpbEFyZWEgPSB7CiAgICAgIG1pblgsCiAgICAgIG1pblksCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQsCiAgICAgIHNjYWxlOiB2aWV3cG9ydC5zY2FsZQogICAgfTsKICAgIHRoaXMucmVzZXQoewogICAgICBrZWVwQ2FudmFzOiB0cnVlCiAgICB9KTsKICB9CiAgYXN5bmMgZHJhdygpIHsKICAgIGlmICh0aGlzLnBhZ2VWaWV3LmRldGFpbFZpZXcgIT09IHRoaXMpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGNvbnN0IGhpZGVVbnRpbENvbXBsZXRlID0gdGhpcy5wYWdlVmlldy5yZW5kZXJpbmdTdGF0ZSA9PT0gUmVuZGVyaW5nU3RhdGVzLkZJTklTSEVEIHx8IHRoaXMucmVuZGVyaW5nU3RhdGUgPT09IFJlbmRlcmluZ1N0YXRlcy5GSU5JU0hFRDsKICAgIGlmICh0aGlzLnJlbmRlcmluZ1N0YXRlICE9PSBSZW5kZXJpbmdTdGF0ZXMuSU5JVElBTCkgewogICAgICBjb25zb2xlLmVycm9yKCJNdXN0IGJlIGluIG5ldyBzdGF0ZSBiZWZvcmUgZHJhd2luZyIpOwogICAgICB0aGlzLnJlc2V0KCk7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGRpdiwKICAgICAgcGRmUGFnZSwKICAgICAgdmlld3BvcnQKICAgIH0gPSB0aGlzLnBhZ2VWaWV3OwogICAgaWYgKCFwZGZQYWdlKSB7CiAgICAgIHRoaXMucmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuRklOSVNIRUQ7CiAgICAgIHRocm93IG5ldyBFcnJvcigicGRmUGFnZSBpcyBub3QgbG9hZGVkIik7CiAgICB9CiAgICB0aGlzLnJlbmRlcmluZ1N0YXRlID0gUmVuZGVyaW5nU3RhdGVzLlJVTk5JTkc7CiAgICBjb25zdCBjYW52YXNXcmFwcGVyID0gdGhpcy5wYWdlVmlldy5fZW5zdXJlQ2FudmFzV3JhcHBlcigpOwogICAgY29uc3QgewogICAgICBjYW52YXMsCiAgICAgIHByZXZDYW52YXMsCiAgICAgIGN0eAogICAgfSA9IHRoaXMuX2NyZWF0ZUNhbnZhcyhuZXdDYW52YXMgPT4gewogICAgICBpZiAoY2FudmFzV3JhcHBlci5maXJzdEVsZW1lbnRDaGlsZD8udGFnTmFtZSA9PT0gIkNBTlZBUyIpIHsKICAgICAgICBjYW52YXNXcmFwcGVyLmZpcnN0RWxlbWVudENoaWxkLmFmdGVyKG5ld0NhbnZhcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FudmFzV3JhcHBlci5wcmVwZW5kKG5ld0NhbnZhcyk7CiAgICAgIH0KICAgIH0sIGhpZGVVbnRpbENvbXBsZXRlKTsKICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGUoImFyaWEtaGlkZGVuIiwgInRydWUiKTsKICAgIGNvbnN0IHsKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IHZpZXdwb3J0OwogICAgY29uc3QgYXJlYSA9IHRoaXMuI2RldGFpbEFyZWE7CiAgICBjb25zdCB7CiAgICAgIHBpeGVsUmF0aW8KICAgIH0gPSBPdXRwdXRTY2FsZTsKICAgIGNvbnN0IHRyYW5zZm9ybSA9IFtwaXhlbFJhdGlvLCAwLCAwLCBwaXhlbFJhdGlvLCAtYXJlYS5taW5YICogcGl4ZWxSYXRpbywgLWFyZWEubWluWSAqIHBpeGVsUmF0aW9dOwogICAgY2FudmFzLndpZHRoID0gYXJlYS53aWR0aCAqIHBpeGVsUmF0aW87CiAgICBjYW52YXMuaGVpZ2h0ID0gYXJlYS5oZWlnaHQgKiBwaXhlbFJhdGlvOwogICAgY29uc3QgewogICAgICBzdHlsZQogICAgfSA9IGNhbnZhczsKICAgIHN0eWxlLndpZHRoID0gYCR7YXJlYS53aWR0aCAqIDEwMCAvIHdpZHRofSVgOwogICAgc3R5bGUuaGVpZ2h0ID0gYCR7YXJlYS5oZWlnaHQgKiAxMDAgLyBoZWlnaHR9JWA7CiAgICBzdHlsZS50b3AgPSBgJHthcmVhLm1pblkgKiAxMDAgLyBoZWlnaHR9JWA7CiAgICBzdHlsZS5sZWZ0ID0gYCR7YXJlYS5taW5YICogMTAwIC8gd2lkdGh9JWA7CiAgICBjb25zdCByZW5kZXJpbmdQcm9taXNlID0gdGhpcy5fZHJhd0NhbnZhcyh0aGlzLnBhZ2VWaWV3Ll9nZXRSZW5kZXJpbmdDb250ZXh0KGN0eCwgdHJhbnNmb3JtKSwgKCkgPT4gewogICAgICB0aGlzLmNhbnZhcz8ucmVtb3ZlKCk7CiAgICAgIHRoaXMuY2FudmFzID0gcHJldkNhbnZhczsKICAgIH0sICgpID0+IHsKICAgICAgdGhpcy5kaXNwYXRjaFBhZ2VSZW5kZXJlZChmYWxzZSwgdHJ1ZSk7CiAgICB9KTsKICAgIGRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtbG9hZGVkIiwgdHJ1ZSk7CiAgICB0aGlzLmRpc3BhdGNoUGFnZVJlbmRlcigpOwogICAgcmV0dXJuIHJlbmRlcmluZ1Byb21pc2U7CiAgfQp9Cgo7Ly8gLi93ZWIvc3RydWN0X3RyZWVfbGF5ZXJfYnVpbGRlci5qcwoKY29uc3QgUERGX1JPTEVfVE9fSFRNTF9ST0xFID0gewogIERvY3VtZW50OiBudWxsLAogIERvY3VtZW50RnJhZ21lbnQ6IG51bGwsCiAgUGFydDogImdyb3VwIiwKICBTZWN0OiAiZ3JvdXAiLAogIERpdjogImdyb3VwIiwKICBBc2lkZTogIm5vdGUiLAogIE5vblN0cnVjdDogIm5vbmUiLAogIFA6IG51bGwsCiAgSDogImhlYWRpbmciLAogIFRpdGxlOiBudWxsLAogIEZFTm90ZTogIm5vdGUiLAogIFN1YjogImdyb3VwIiwKICBMYmw6IG51bGwsCiAgU3BhbjogbnVsbCwKICBFbTogbnVsbCwKICBTdHJvbmc6IG51bGwsCiAgTGluazogImxpbmsiLAogIEFubm90OiAibm90ZSIsCiAgRm9ybTogImZvcm0iLAogIFJ1Ynk6IG51bGwsCiAgUkI6IG51bGwsCiAgUlQ6IG51bGwsCiAgUlA6IG51bGwsCiAgV2FyaWNodTogbnVsbCwKICBXVDogbnVsbCwKICBXUDogbnVsbCwKICBMOiAibGlzdCIsCiAgTEk6ICJsaXN0aXRlbSIsCiAgTEJvZHk6IG51bGwsCiAgVGFibGU6ICJ0YWJsZSIsCiAgVFI6ICJyb3ciLAogIFRIOiAiY29sdW1uaGVhZGVyIiwKICBURDogImNlbGwiLAogIFRIZWFkOiAiY29sdW1uaGVhZGVyIiwKICBUQm9keTogbnVsbCwKICBURm9vdDogbnVsbCwKICBDYXB0aW9uOiBudWxsLAogIEZpZ3VyZTogImZpZ3VyZSIsCiAgRm9ybXVsYTogbnVsbCwKICBBcnRpZmFjdDogbnVsbAp9Owpjb25zdCBIRUFESU5HX1BBVFRFUk4gPSAvXkgoXGQrKSQvOwpjbGFzcyBTdHJ1Y3RUcmVlTGF5ZXJCdWlsZGVyIHsKICAjcHJvbWlzZTsKICAjdHJlZURvbSA9IG51bGw7CiAgI3RyZWVQcm9taXNlOwogICNlbGVtZW50QXR0cmlidXRlcyA9IG5ldyBNYXAoKTsKICAjcmF3RGltczsKICAjZWxlbWVudHNUb0FkZFRvVGV4dExheWVyID0gbnVsbDsKICBjb25zdHJ1Y3RvcihwZGZQYWdlLCByYXdEaW1zKSB7CiAgICB0aGlzLiNwcm9taXNlID0gcGRmUGFnZS5nZXRTdHJ1Y3RUcmVlKCk7CiAgICB0aGlzLiNyYXdEaW1zID0gcmF3RGltczsKICB9CiAgYXN5bmMgcmVuZGVyKCkgewogICAgaWYgKHRoaXMuI3RyZWVQcm9taXNlKSB7CiAgICAgIHJldHVybiB0aGlzLiN0cmVlUHJvbWlzZTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgcHJvbWlzZSwKICAgICAgcmVzb2x2ZSwKICAgICAgcmVqZWN0CiAgICB9ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICB0aGlzLiN0cmVlUHJvbWlzZSA9IHByb21pc2U7CiAgICB0cnkgewogICAgICB0aGlzLiN0cmVlRG9tID0gdGhpcy4jd2Fsayhhd2FpdCB0aGlzLiNwcm9taXNlKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIHJlamVjdChleCk7CiAgICB9CiAgICB0aGlzLiNwcm9taXNlID0gbnVsbDsKICAgIHRoaXMuI3RyZWVEb20/LmNsYXNzTGlzdC5hZGQoInN0cnVjdFRyZWUiKTsKICAgIHJlc29sdmUodGhpcy4jdHJlZURvbSk7CiAgICByZXR1cm4gcHJvbWlzZTsKICB9CiAgYXN5bmMgZ2V0QXJpYUF0dHJpYnV0ZXMoYW5ub3RhdGlvbklkKSB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnJlbmRlcigpOwogICAgICByZXR1cm4gdGhpcy4jZWxlbWVudEF0dHJpYnV0ZXMuZ2V0KGFubm90YXRpb25JZCk7CiAgICB9IGNhdGNoIHt9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgaGlkZSgpIHsKICAgIGlmICh0aGlzLiN0cmVlRG9tICYmICF0aGlzLiN0cmVlRG9tLmhpZGRlbikgewogICAgICB0aGlzLiN0cmVlRG9tLmhpZGRlbiA9IHRydWU7CiAgICB9CiAgfQogIHNob3coKSB7CiAgICBpZiAodGhpcy4jdHJlZURvbT8uaGlkZGVuKSB7CiAgICAgIHRoaXMuI3RyZWVEb20uaGlkZGVuID0gZmFsc2U7CiAgICB9CiAgfQogICNzZXRBdHRyaWJ1dGVzKHN0cnVjdEVsZW1lbnQsIGh0bWxFbGVtZW50KSB7CiAgICBjb25zdCB7CiAgICAgIGFsdCwKICAgICAgaWQsCiAgICAgIGxhbmcKICAgIH0gPSBzdHJ1Y3RFbGVtZW50OwogICAgaWYgKGFsdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGxldCBhZGRlZCA9IGZhbHNlOwogICAgICBjb25zdCBsYWJlbCA9IHJlbW92ZU51bGxDaGFyYWN0ZXJzKGFsdCk7CiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygc3RydWN0RWxlbWVudC5jaGlsZHJlbikgewogICAgICAgIGlmIChjaGlsZC50eXBlID09PSAiYW5ub3RhdGlvbiIpIHsKICAgICAgICAgIGxldCBhdHRycyA9IHRoaXMuI2VsZW1lbnRBdHRyaWJ1dGVzLmdldChjaGlsZC5pZCk7CiAgICAgICAgICBpZiAoIWF0dHJzKSB7CiAgICAgICAgICAgIGF0dHJzID0gbmV3IE1hcCgpOwogICAgICAgICAgICB0aGlzLiNlbGVtZW50QXR0cmlidXRlcy5zZXQoY2hpbGQuaWQsIGF0dHJzKTsKICAgICAgICAgIH0KICAgICAgICAgIGF0dHJzLnNldCgiYXJpYS1sYWJlbCIsIGxhYmVsKTsKICAgICAgICAgIGFkZGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCFhZGRlZCkgewogICAgICAgIGh0bWxFbGVtZW50LnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsIGxhYmVsKTsKICAgICAgfQogICAgfQogICAgaWYgKGlkICE9PSB1bmRlZmluZWQpIHsKICAgICAgaHRtbEVsZW1lbnQuc2V0QXR0cmlidXRlKCJhcmlhLW93bnMiLCBpZCk7CiAgICB9CiAgICBpZiAobGFuZyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGh0bWxFbGVtZW50LnNldEF0dHJpYnV0ZSgibGFuZyIsIHJlbW92ZU51bGxDaGFyYWN0ZXJzKGxhbmcsIHRydWUpKTsKICAgIH0KICB9CiAgI2FkZEltYWdlSW5UZXh0TGF5ZXIobm9kZSwgZWxlbWVudCkgewogICAgY29uc3QgewogICAgICBhbHQsCiAgICAgIGJib3gsCiAgICAgIGNoaWxkcmVuCiAgICB9ID0gbm9kZTsKICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW4/LlswXTsKICAgIGlmICghdGhpcy4jcmF3RGltcyB8fCAhYWx0IHx8ICFiYm94IHx8IGNoaWxkPy50eXBlICE9PSAiY29udGVudCIpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgewogICAgICBpZAogICAgfSA9IGNoaWxkOwogICAgaWYgKCFpZCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgiYXJpYS1vd25zIiwgaWQpOwogICAgY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgKHRoaXMuI2VsZW1lbnRzVG9BZGRUb1RleHRMYXllciB8fD0gbmV3IE1hcCgpKS5zZXQoaWQsIGltZyk7CiAgICBpbWcuc2V0QXR0cmlidXRlKCJyb2xlIiwgImltZyIpOwogICAgaW1nLnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsIHJlbW92ZU51bGxDaGFyYWN0ZXJzKGFsdCkpOwogICAgY29uc3QgewogICAgICBwYWdlSGVpZ2h0LAogICAgICBwYWdlWCwKICAgICAgcGFnZVkKICAgIH0gPSB0aGlzLiNyYXdEaW1zOwogICAgY29uc3QgY2FsYyA9ICJjYWxjKHZhcigtLXRvdGFsLXNjYWxlLWZhY3RvcikgKiI7CiAgICBjb25zdCB7CiAgICAgIHN0eWxlCiAgICB9ID0gaW1nOwogICAgc3R5bGUud2lkdGggPSBgJHtjYWxjfSR7YmJveFsyXSAtIGJib3hbMF19cHgpYDsKICAgIHN0eWxlLmhlaWdodCA9IGAke2NhbGN9JHtiYm94WzNdIC0gYmJveFsxXX1weClgOwogICAgc3R5bGUubGVmdCA9IGAke2NhbGN9JHtiYm94WzBdIC0gcGFnZVh9cHgpYDsKICAgIHN0eWxlLnRvcCA9IGAke2NhbGN9JHtwYWdlSGVpZ2h0IC0gYmJveFszXSArIHBhZ2VZfXB4KWA7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgYWRkRWxlbWVudHNUb1RleHRMYXllcigpIHsKICAgIGlmICghdGhpcy4jZWxlbWVudHNUb0FkZFRvVGV4dExheWVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgW2lkLCBpbWddIG9mIHRoaXMuI2VsZW1lbnRzVG9BZGRUb1RleHRMYXllcikgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk/LmFwcGVuZChpbWcpOwogICAgfQogICAgdGhpcy4jZWxlbWVudHNUb0FkZFRvVGV4dExheWVyLmNsZWFyKCk7CiAgICB0aGlzLiNlbGVtZW50c1RvQWRkVG9UZXh0TGF5ZXIgPSBudWxsOwogIH0KICAjd2Fsayhub2RlKSB7CiAgICBpZiAoIW5vZGUpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgaWYgKCJyb2xlIiBpbiBub2RlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICByb2xlCiAgICAgIH0gPSBub2RlOwogICAgICBjb25zdCBtYXRjaCA9IHJvbGUubWF0Y2goSEVBRElOR19QQVRURVJOKTsKICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoInJvbGUiLCAiaGVhZGluZyIpOwogICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCJhcmlhLWxldmVsIiwgbWF0Y2hbMV0pOwogICAgICB9IGVsc2UgaWYgKFBERl9ST0xFX1RPX0hUTUxfUk9MRVtyb2xlXSkgewogICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCJyb2xlIiwgUERGX1JPTEVfVE9fSFRNTF9ST0xFW3JvbGVdKTsKICAgICAgfQogICAgICBpZiAocm9sZSA9PT0gIkZpZ3VyZSIgJiYgdGhpcy4jYWRkSW1hZ2VJblRleHRMYXllcihub2RlLCBlbGVtZW50KSkgewogICAgICAgIHJldHVybiBlbGVtZW50OwogICAgICB9CiAgICB9CiAgICB0aGlzLiNzZXRBdHRyaWJ1dGVzKG5vZGUsIGVsZW1lbnQpOwogICAgaWYgKG5vZGUuY2hpbGRyZW4pIHsKICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09PSAxICYmICJpZCIgaW4gbm9kZS5jaGlsZHJlblswXSkgewogICAgICAgIHRoaXMuI3NldEF0dHJpYnV0ZXMobm9kZS5jaGlsZHJlblswXSwgZWxlbWVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjb25zdCBraWQgb2Ygbm9kZS5jaGlsZHJlbikgewogICAgICAgICAgZWxlbWVudC5hcHBlbmQodGhpcy4jd2FsayhraWQpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbGVtZW50OwogIH0KfQoKOy8vIC4vd2ViL3RleHRfYWNjZXNzaWJpbGl0eS5qcwoKY2xhc3MgVGV4dEFjY2Vzc2liaWxpdHlNYW5hZ2VyIHsKICAjZW5hYmxlZCA9IGZhbHNlOwogICN0ZXh0Q2hpbGRyZW4gPSBudWxsOwogICN0ZXh0Tm9kZXMgPSBuZXcgTWFwKCk7CiAgI3dhaXRpbmdFbGVtZW50cyA9IG5ldyBNYXAoKTsKICBzZXRUZXh0TWFwcGluZyh0ZXh0RGl2cykgewogICAgdGhpcy4jdGV4dENoaWxkcmVuID0gdGV4dERpdnM7CiAgfQogIHN0YXRpYyAjY29tcGFyZUVsZW1lbnRQb3NpdGlvbnMoZTEsIGUyKSB7CiAgICBjb25zdCByZWN0MSA9IGUxLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgY29uc3QgcmVjdDIgPSBlMi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGlmIChyZWN0MS53aWR0aCA9PT0gMCAmJiByZWN0MS5oZWlnaHQgPT09IDApIHsKICAgICAgcmV0dXJuICsxOwogICAgfQogICAgaWYgKHJlY3QyLndpZHRoID09PSAwICYmIHJlY3QyLmhlaWdodCA9PT0gMCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBjb25zdCB0b3AxID0gcmVjdDEueTsKICAgIGNvbnN0IGJvdDEgPSByZWN0MS55ICsgcmVjdDEuaGVpZ2h0OwogICAgY29uc3QgbWlkMSA9IHJlY3QxLnkgKyByZWN0MS5oZWlnaHQgLyAyOwogICAgY29uc3QgdG9wMiA9IHJlY3QyLnk7CiAgICBjb25zdCBib3QyID0gcmVjdDIueSArIHJlY3QyLmhlaWdodDsKICAgIGNvbnN0IG1pZDIgPSByZWN0Mi55ICsgcmVjdDIuaGVpZ2h0IC8gMjsKICAgIGlmIChtaWQxIDw9IHRvcDIgJiYgbWlkMiA+PSBib3QxKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIGlmIChtaWQyIDw9IHRvcDEgJiYgbWlkMSA+PSBib3QyKSB7CiAgICAgIHJldHVybiArMTsKICAgIH0KICAgIGNvbnN0IGNlbnRlclgxID0gcmVjdDEueCArIHJlY3QxLndpZHRoIC8gMjsKICAgIGNvbnN0IGNlbnRlclgyID0gcmVjdDIueCArIHJlY3QyLndpZHRoIC8gMjsKICAgIHJldHVybiBjZW50ZXJYMSAtIGNlbnRlclgyOwogIH0KICBlbmFibGUoKSB7CiAgICBpZiAodGhpcy4jZW5hYmxlZCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlRleHRBY2Nlc3NpYmlsaXR5TWFuYWdlciBpcyBhbHJlYWR5IGVuYWJsZWQuIik7CiAgICB9CiAgICBpZiAoIXRoaXMuI3RleHRDaGlsZHJlbikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlRleHQgZGl2cyBhbmQgc3RyaW5ncyBoYXZlIG5vdCBiZWVuIHNldC4iKTsKICAgIH0KICAgIHRoaXMuI2VuYWJsZWQgPSB0cnVlOwogICAgdGhpcy4jdGV4dENoaWxkcmVuID0gdGhpcy4jdGV4dENoaWxkcmVuLnNsaWNlKCk7CiAgICB0aGlzLiN0ZXh0Q2hpbGRyZW4uc29ydChUZXh0QWNjZXNzaWJpbGl0eU1hbmFnZXIuI2NvbXBhcmVFbGVtZW50UG9zaXRpb25zKTsKICAgIGlmICh0aGlzLiN0ZXh0Tm9kZXMuc2l6ZSA+IDApIHsKICAgICAgY29uc3QgdGV4dENoaWxkcmVuID0gdGhpcy4jdGV4dENoaWxkcmVuOwogICAgICBmb3IgKGNvbnN0IFtpZCwgbm9kZUluZGV4XSBvZiB0aGlzLiN0ZXh0Tm9kZXMpIHsKICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgIGlmICghZWxlbWVudCkgewogICAgICAgICAgdGhpcy4jdGV4dE5vZGVzLmRlbGV0ZShpZCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdGhpcy4jYWRkSWRUb0FyaWFPd25zKGlkLCB0ZXh0Q2hpbGRyZW5bbm9kZUluZGV4XSk7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgW2VsZW1lbnQsIGlzUmVtb3ZhYmxlXSBvZiB0aGlzLiN3YWl0aW5nRWxlbWVudHMpIHsKICAgICAgdGhpcy5hZGRQb2ludGVySW5UZXh0TGF5ZXIoZWxlbWVudCwgaXNSZW1vdmFibGUpOwogICAgfQogICAgdGhpcy4jd2FpdGluZ0VsZW1lbnRzLmNsZWFyKCk7CiAgfQogIGRpc2FibGUoKSB7CiAgICBpZiAoIXRoaXMuI2VuYWJsZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jd2FpdGluZ0VsZW1lbnRzLmNsZWFyKCk7CiAgICB0aGlzLiN0ZXh0Q2hpbGRyZW4gPSBudWxsOwogICAgdGhpcy4jZW5hYmxlZCA9IGZhbHNlOwogIH0KICByZW1vdmVQb2ludGVySW5UZXh0TGF5ZXIoZWxlbWVudCkgewogICAgaWYgKCF0aGlzLiNlbmFibGVkKSB7CiAgICAgIHRoaXMuI3dhaXRpbmdFbGVtZW50cy5kZWxldGUoZWxlbWVudCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy4jdGV4dENoaWxkcmVuOwogICAgaWYgKCFjaGlsZHJlbiB8fCBjaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgewogICAgICBpZAogICAgfSA9IGVsZW1lbnQ7CiAgICBjb25zdCBub2RlSW5kZXggPSB0aGlzLiN0ZXh0Tm9kZXMuZ2V0KGlkKTsKICAgIGlmIChub2RlSW5kZXggPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBub2RlID0gY2hpbGRyZW5bbm9kZUluZGV4XTsKICAgIHRoaXMuI3RleHROb2Rlcy5kZWxldGUoaWQpOwogICAgbGV0IG93bnMgPSBub2RlLmdldEF0dHJpYnV0ZSgiYXJpYS1vd25zIik7CiAgICBpZiAob3ducz8uaW5jbHVkZXMoaWQpKSB7CiAgICAgIG93bnMgPSBvd25zLnNwbGl0KCIgIikuZmlsdGVyKHggPT4geCAhPT0gaWQpLmpvaW4oIiAiKTsKICAgICAgaWYgKG93bnMpIHsKICAgICAgICBub2RlLnNldEF0dHJpYnV0ZSgiYXJpYS1vd25zIiwgb3ducyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoImFyaWEtb3ducyIpOwogICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCJyb2xlIiwgInByZXNlbnRhdGlvbiIpOwogICAgICB9CiAgICB9CiAgfQogICNhZGRJZFRvQXJpYU93bnMoaWQsIG5vZGUpIHsKICAgIGNvbnN0IG93bnMgPSBub2RlLmdldEF0dHJpYnV0ZSgiYXJpYS1vd25zIik7CiAgICBpZiAoIW93bnM/LmluY2x1ZGVzKGlkKSkgewogICAgICBub2RlLnNldEF0dHJpYnV0ZSgiYXJpYS1vd25zIiwgb3ducyA/IGAke293bnN9ICR7aWR9YCA6IGlkKTsKICAgIH0KICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKCJyb2xlIik7CiAgfQogIGFkZFBvaW50ZXJJblRleHRMYXllcihlbGVtZW50LCBpc1JlbW92YWJsZSkgewogICAgY29uc3QgewogICAgICBpZAogICAgfSA9IGVsZW1lbnQ7CiAgICBpZiAoIWlkKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKCF0aGlzLiNlbmFibGVkKSB7CiAgICAgIHRoaXMuI3dhaXRpbmdFbGVtZW50cy5zZXQoZWxlbWVudCwgaXNSZW1vdmFibGUpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChpc1JlbW92YWJsZSkgewogICAgICB0aGlzLnJlbW92ZVBvaW50ZXJJblRleHRMYXllcihlbGVtZW50KTsKICAgIH0KICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy4jdGV4dENoaWxkcmVuOwogICAgaWYgKCFjaGlsZHJlbiB8fCBjaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBpbmRleCA9IGJpbmFyeVNlYXJjaEZpcnN0SXRlbShjaGlsZHJlbiwgbm9kZSA9PiBUZXh0QWNjZXNzaWJpbGl0eU1hbmFnZXIuI2NvbXBhcmVFbGVtZW50UG9zaXRpb25zKGVsZW1lbnQsIG5vZGUpIDwgMCk7CiAgICBjb25zdCBub2RlSW5kZXggPSBNYXRoLm1heCgwLCBpbmRleCAtIDEpOwogICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltub2RlSW5kZXhdOwogICAgdGhpcy4jYWRkSWRUb0FyaWFPd25zKGlkLCBjaGlsZCk7CiAgICB0aGlzLiN0ZXh0Tm9kZXMuc2V0KGlkLCBub2RlSW5kZXgpOwogICAgY29uc3QgcGFyZW50ID0gY2hpbGQucGFyZW50Tm9kZTsKICAgIHJldHVybiBwYXJlbnQ/LmNsYXNzTGlzdC5jb250YWlucygibWFya2VkQ29udGVudCIpID8gcGFyZW50LmlkIDogbnVsbDsKICB9CiAgbW92ZUVsZW1lbnRJbkRPTShjb250YWluZXIsIGVsZW1lbnQsIGNvbnRlbnRFbGVtZW50LCBpc1JlbW92YWJsZSkgewogICAgY29uc3QgaWQgPSB0aGlzLmFkZFBvaW50ZXJJblRleHRMYXllcihjb250ZW50RWxlbWVudCwgaXNSZW1vdmFibGUpOwogICAgaWYgKCFjb250YWluZXIuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgIGNvbnRhaW5lci5hcHBlbmQoZWxlbWVudCk7CiAgICAgIHJldHVybiBpZDsKICAgIH0KICAgIGNvbnN0IGNoaWxkcmVuID0gQXJyYXkuZnJvbShjb250YWluZXIuY2hpbGROb2RlcykuZmlsdGVyKG5vZGUgPT4gbm9kZSAhPT0gZWxlbWVudCk7CiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBpZDsKICAgIH0KICAgIGNvbnN0IGVsZW1lbnRUb0NvbXBhcmUgPSBjb250ZW50RWxlbWVudCB8fCBlbGVtZW50OwogICAgY29uc3QgaW5kZXggPSBiaW5hcnlTZWFyY2hGaXJzdEl0ZW0oY2hpbGRyZW4sIG5vZGUgPT4gVGV4dEFjY2Vzc2liaWxpdHlNYW5hZ2VyLiNjb21wYXJlRWxlbWVudFBvc2l0aW9ucyhlbGVtZW50VG9Db21wYXJlLCBub2RlKSA8IDApOwogICAgaWYgKGluZGV4ID09PSAwKSB7CiAgICAgIGNoaWxkcmVuWzBdLmJlZm9yZShlbGVtZW50KTsKICAgIH0gZWxzZSB7CiAgICAgIGNoaWxkcmVuW2luZGV4IC0gMV0uYWZ0ZXIoZWxlbWVudCk7CiAgICB9CiAgICByZXR1cm4gaWQ7CiAgfQp9Cgo7Ly8gLi93ZWIvdGV4dF9oaWdobGlnaHRlci5qcwpjbGFzcyBUZXh0SGlnaGxpZ2h0ZXIgewogICNldmVudEFib3J0Q29udHJvbGxlciA9IG51bGw7CiAgY29uc3RydWN0b3IoewogICAgZmluZENvbnRyb2xsZXIsCiAgICBldmVudEJ1cywKICAgIHBhZ2VJbmRleAogIH0pIHsKICAgIHRoaXMuZmluZENvbnRyb2xsZXIgPSBmaW5kQ29udHJvbGxlcjsKICAgIHRoaXMubWF0Y2hlcyA9IFtdOwogICAgdGhpcy5ldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgdGhpcy5wYWdlSWR4ID0gcGFnZUluZGV4OwogICAgdGhpcy50ZXh0RGl2cyA9IG51bGw7CiAgICB0aGlzLnRleHRDb250ZW50SXRlbXNTdHIgPSBudWxsOwogICAgdGhpcy5lbmFibGVkID0gZmFsc2U7CiAgfQogIHNldFRleHRNYXBwaW5nKGRpdnMsIHRleHRzKSB7CiAgICB0aGlzLnRleHREaXZzID0gZGl2czsKICAgIHRoaXMudGV4dENvbnRlbnRJdGVtc1N0ciA9IHRleHRzOwogIH0KICBlbmFibGUoKSB7CiAgICBpZiAoIXRoaXMudGV4dERpdnMgfHwgIXRoaXMudGV4dENvbnRlbnRJdGVtc1N0cikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlRleHQgZGl2cyBhbmQgc3RyaW5ncyBoYXZlIG5vdCBiZWVuIHNldC4iKTsKICAgIH0KICAgIGlmICh0aGlzLmVuYWJsZWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJUZXh0SGlnaGxpZ2h0ZXIgaXMgYWxyZWFkeSBlbmFibGVkLiIpOwogICAgfQogICAgdGhpcy5lbmFibGVkID0gdHJ1ZTsKICAgIGlmICghdGhpcy4jZXZlbnRBYm9ydENvbnRyb2xsZXIpIHsKICAgICAgdGhpcy4jZXZlbnRBYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICAgIHRoaXMuZXZlbnRCdXMuX29uKCJ1cGRhdGV0ZXh0bGF5ZXJtYXRjaGVzIiwgZXZ0ID0+IHsKICAgICAgICBpZiAoZXZ0LnBhZ2VJbmRleCA9PT0gdGhpcy5wYWdlSWR4IHx8IGV2dC5wYWdlSW5kZXggPT09IC0xKSB7CiAgICAgICAgICB0aGlzLl91cGRhdGVNYXRjaGVzKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgc2lnbmFsOiB0aGlzLiNldmVudEFib3J0Q29udHJvbGxlci5zaWduYWwKICAgICAgfSk7CiAgICB9CiAgICB0aGlzLl91cGRhdGVNYXRjaGVzKCk7CiAgfQogIGRpc2FibGUoKSB7CiAgICBpZiAoIXRoaXMuZW5hYmxlZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmVuYWJsZWQgPSBmYWxzZTsKICAgIHRoaXMuI2V2ZW50QWJvcnRDb250cm9sbGVyPy5hYm9ydCgpOwogICAgdGhpcy4jZXZlbnRBYm9ydENvbnRyb2xsZXIgPSBudWxsOwogICAgdGhpcy5fdXBkYXRlTWF0Y2hlcyh0cnVlKTsKICB9CiAgX2NvbnZlcnRNYXRjaGVzKG1hdGNoZXMsIG1hdGNoZXNMZW5ndGgpIHsKICAgIGlmICghbWF0Y2hlcykgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHRleHRDb250ZW50SXRlbXNTdHIKICAgIH0gPSB0aGlzOwogICAgbGV0IGkgPSAwLAogICAgICBpSW5kZXggPSAwOwogICAgY29uc3QgZW5kID0gdGV4dENvbnRlbnRJdGVtc1N0ci5sZW5ndGggLSAxOwogICAgY29uc3QgcmVzdWx0ID0gW107CiAgICBmb3IgKGxldCBtID0gMCwgbW0gPSBtYXRjaGVzLmxlbmd0aDsgbSA8IG1tOyBtKyspIHsKICAgICAgbGV0IG1hdGNoSWR4ID0gbWF0Y2hlc1ttXTsKICAgICAgd2hpbGUgKGkgIT09IGVuZCAmJiBtYXRjaElkeCA+PSBpSW5kZXggKyB0ZXh0Q29udGVudEl0ZW1zU3RyW2ldLmxlbmd0aCkgewogICAgICAgIGlJbmRleCArPSB0ZXh0Q29udGVudEl0ZW1zU3RyW2ldLmxlbmd0aDsKICAgICAgICBpKys7CiAgICAgIH0KICAgICAgaWYgKGkgPT09IHRleHRDb250ZW50SXRlbXNTdHIubGVuZ3RoKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiQ291bGQgbm90IGZpbmQgYSBtYXRjaGluZyBtYXBwaW5nIik7CiAgICAgIH0KICAgICAgY29uc3QgbWF0Y2ggPSB7CiAgICAgICAgYmVnaW46IHsKICAgICAgICAgIGRpdklkeDogaSwKICAgICAgICAgIG9mZnNldDogbWF0Y2hJZHggLSBpSW5kZXgKICAgICAgICB9CiAgICAgIH07CiAgICAgIG1hdGNoSWR4ICs9IG1hdGNoZXNMZW5ndGhbbV07CiAgICAgIHdoaWxlIChpICE9PSBlbmQgJiYgbWF0Y2hJZHggPiBpSW5kZXggKyB0ZXh0Q29udGVudEl0ZW1zU3RyW2ldLmxlbmd0aCkgewogICAgICAgIGlJbmRleCArPSB0ZXh0Q29udGVudEl0ZW1zU3RyW2ldLmxlbmd0aDsKICAgICAgICBpKys7CiAgICAgIH0KICAgICAgbWF0Y2guZW5kID0gewogICAgICAgIGRpdklkeDogaSwKICAgICAgICBvZmZzZXQ6IG1hdGNoSWR4IC0gaUluZGV4CiAgICAgIH07CiAgICAgIHJlc3VsdC5wdXNoKG1hdGNoKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIF9yZW5kZXJNYXRjaGVzKG1hdGNoZXMpIHsKICAgIGlmIChtYXRjaGVzLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGZpbmRDb250cm9sbGVyLAogICAgICBwYWdlSWR4CiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHsKICAgICAgdGV4dENvbnRlbnRJdGVtc1N0ciwKICAgICAgdGV4dERpdnMKICAgIH0gPSB0aGlzOwogICAgY29uc3QgaXNTZWxlY3RlZFBhZ2UgPSBwYWdlSWR4ID09PSBmaW5kQ29udHJvbGxlci5zZWxlY3RlZC5wYWdlSWR4OwogICAgY29uc3Qgc2VsZWN0ZWRNYXRjaElkeCA9IGZpbmRDb250cm9sbGVyLnNlbGVjdGVkLm1hdGNoSWR4OwogICAgY29uc3QgaGlnaGxpZ2h0QWxsID0gZmluZENvbnRyb2xsZXIuc3RhdGUuaGlnaGxpZ2h0QWxsOwogICAgbGV0IHByZXZFbmQgPSBudWxsOwogICAgY29uc3QgaW5maW5pdHkgPSB7CiAgICAgIGRpdklkeDogLTEsCiAgICAgIG9mZnNldDogdW5kZWZpbmVkCiAgICB9OwogICAgZnVuY3Rpb24gYmVnaW5UZXh0KGJlZ2luLCBjbGFzc05hbWUpIHsKICAgICAgY29uc3QgZGl2SWR4ID0gYmVnaW4uZGl2SWR4OwogICAgICB0ZXh0RGl2c1tkaXZJZHhdLnRleHRDb250ZW50ID0gIiI7CiAgICAgIHJldHVybiBhcHBlbmRUZXh0VG9EaXYoZGl2SWR4LCAwLCBiZWdpbi5vZmZzZXQsIGNsYXNzTmFtZSk7CiAgICB9CiAgICBmdW5jdGlvbiBhcHBlbmRUZXh0VG9EaXYoZGl2SWR4LCBmcm9tT2Zmc2V0LCB0b09mZnNldCwgY2xhc3NOYW1lKSB7CiAgICAgIGxldCBkaXYgPSB0ZXh0RGl2c1tkaXZJZHhdOwogICAgICBpZiAoZGl2Lm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSkgewogICAgICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICAgICAgZGl2LmJlZm9yZShzcGFuKTsKICAgICAgICBzcGFuLmFwcGVuZChkaXYpOwogICAgICAgIHRleHREaXZzW2RpdklkeF0gPSBzcGFuOwogICAgICAgIGRpdiA9IHNwYW47CiAgICAgIH0KICAgICAgY29uc3QgY29udGVudCA9IHRleHRDb250ZW50SXRlbXNTdHJbZGl2SWR4XS5zdWJzdHJpbmcoZnJvbU9mZnNldCwgdG9PZmZzZXQpOwogICAgICBjb25zdCBub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY29udGVudCk7CiAgICAgIGlmIChjbGFzc05hbWUpIHsKICAgICAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgICAgIHNwYW4uY2xhc3NOYW1lID0gYCR7Y2xhc3NOYW1lfSBhcHBlbmRlZGA7CiAgICAgICAgc3Bhbi5hcHBlbmQobm9kZSk7CiAgICAgICAgZGl2LmFwcGVuZChzcGFuKTsKICAgICAgICBpZiAoY2xhc3NOYW1lLmluY2x1ZGVzKCJzZWxlY3RlZCIpKSB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGxlZnQKICAgICAgICAgIH0gPSBzcGFuLmdldENsaWVudFJlY3RzKClbMF07CiAgICAgICAgICBjb25zdCBwYXJlbnRMZWZ0ID0gZGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7CiAgICAgICAgICByZXR1cm4gbGVmdCAtIHBhcmVudExlZnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGRpdi5hcHBlbmQobm9kZSk7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgbGV0IGkwID0gc2VsZWN0ZWRNYXRjaElkeCwKICAgICAgaTEgPSBpMCArIDE7CiAgICBpZiAoaGlnaGxpZ2h0QWxsKSB7CiAgICAgIGkwID0gMDsKICAgICAgaTEgPSBtYXRjaGVzLmxlbmd0aDsKICAgIH0gZWxzZSBpZiAoIWlzU2VsZWN0ZWRQYWdlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBsYXN0RGl2SWR4ID0gLTE7CiAgICBsZXQgbGFzdE9mZnNldCA9IC0xOwogICAgZm9yIChsZXQgaSA9IGkwOyBpIDwgaTE7IGkrKykgewogICAgICBjb25zdCBtYXRjaCA9IG1hdGNoZXNbaV07CiAgICAgIGNvbnN0IGJlZ2luID0gbWF0Y2guYmVnaW47CiAgICAgIGlmIChiZWdpbi5kaXZJZHggPT09IGxhc3REaXZJZHggJiYgYmVnaW4ub2Zmc2V0ID09PSBsYXN0T2Zmc2V0KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGFzdERpdklkeCA9IGJlZ2luLmRpdklkeDsKICAgICAgbGFzdE9mZnNldCA9IGJlZ2luLm9mZnNldDsKICAgICAgY29uc3QgZW5kID0gbWF0Y2guZW5kOwogICAgICBjb25zdCBpc1NlbGVjdGVkID0gaXNTZWxlY3RlZFBhZ2UgJiYgaSA9PT0gc2VsZWN0ZWRNYXRjaElkeDsKICAgICAgY29uc3QgaGlnaGxpZ2h0U3VmZml4ID0gaXNTZWxlY3RlZCA/ICIgc2VsZWN0ZWQiIDogIiI7CiAgICAgIGxldCBzZWxlY3RlZExlZnQgPSAwOwogICAgICBpZiAoIXByZXZFbmQgfHwgYmVnaW4uZGl2SWR4ICE9PSBwcmV2RW5kLmRpdklkeCkgewogICAgICAgIGlmIChwcmV2RW5kICE9PSBudWxsKSB7CiAgICAgICAgICBhcHBlbmRUZXh0VG9EaXYocHJldkVuZC5kaXZJZHgsIHByZXZFbmQub2Zmc2V0LCBpbmZpbml0eS5vZmZzZXQpOwogICAgICAgIH0KICAgICAgICBiZWdpblRleHQoYmVnaW4pOwogICAgICB9IGVsc2UgewogICAgICAgIGFwcGVuZFRleHRUb0RpdihwcmV2RW5kLmRpdklkeCwgcHJldkVuZC5vZmZzZXQsIGJlZ2luLm9mZnNldCk7CiAgICAgIH0KICAgICAgaWYgKGJlZ2luLmRpdklkeCA9PT0gZW5kLmRpdklkeCkgewogICAgICAgIHNlbGVjdGVkTGVmdCA9IGFwcGVuZFRleHRUb0RpdihiZWdpbi5kaXZJZHgsIGJlZ2luLm9mZnNldCwgZW5kLm9mZnNldCwgImhpZ2hsaWdodCIgKyBoaWdobGlnaHRTdWZmaXgpOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbGVjdGVkTGVmdCA9IGFwcGVuZFRleHRUb0RpdihiZWdpbi5kaXZJZHgsIGJlZ2luLm9mZnNldCwgaW5maW5pdHkub2Zmc2V0LCAiaGlnaGxpZ2h0IGJlZ2luIiArIGhpZ2hsaWdodFN1ZmZpeCk7CiAgICAgICAgZm9yIChsZXQgbjAgPSBiZWdpbi5kaXZJZHggKyAxLCBuMSA9IGVuZC5kaXZJZHg7IG4wIDwgbjE7IG4wKyspIHsKICAgICAgICAgIHRleHREaXZzW24wXS5jbGFzc05hbWUgPSAiaGlnaGxpZ2h0IG1pZGRsZSIgKyBoaWdobGlnaHRTdWZmaXg7CiAgICAgICAgfQogICAgICAgIGJlZ2luVGV4dChlbmQsICJoaWdobGlnaHQgZW5kIiArIGhpZ2hsaWdodFN1ZmZpeCk7CiAgICAgIH0KICAgICAgcHJldkVuZCA9IGVuZDsKICAgICAgaWYgKGlzU2VsZWN0ZWQpIHsKICAgICAgICBmaW5kQ29udHJvbGxlci5zY3JvbGxNYXRjaEludG9WaWV3KHsKICAgICAgICAgIGVsZW1lbnQ6IHRleHREaXZzW2JlZ2luLmRpdklkeF0sCiAgICAgICAgICBzZWxlY3RlZExlZnQsCiAgICAgICAgICBwYWdlSW5kZXg6IHBhZ2VJZHgsCiAgICAgICAgICBtYXRjaEluZGV4OiBzZWxlY3RlZE1hdGNoSWR4CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChwcmV2RW5kKSB7CiAgICAgIGFwcGVuZFRleHRUb0RpdihwcmV2RW5kLmRpdklkeCwgcHJldkVuZC5vZmZzZXQsIGluZmluaXR5Lm9mZnNldCk7CiAgICB9CiAgfQogIF91cGRhdGVNYXRjaGVzKHJlc2V0ID0gZmFsc2UpIHsKICAgIGlmICghdGhpcy5lbmFibGVkICYmICFyZXNldCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGZpbmRDb250cm9sbGVyLAogICAgICBtYXRjaGVzLAogICAgICBwYWdlSWR4CiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHsKICAgICAgdGV4dENvbnRlbnRJdGVtc1N0ciwKICAgICAgdGV4dERpdnMKICAgIH0gPSB0aGlzOwogICAgbGV0IGNsZWFyZWRVbnRpbERpdklkeCA9IC0xOwogICAgZm9yIChjb25zdCBtYXRjaCBvZiBtYXRjaGVzKSB7CiAgICAgIGNvbnN0IGJlZ2luID0gTWF0aC5tYXgoY2xlYXJlZFVudGlsRGl2SWR4LCBtYXRjaC5iZWdpbi5kaXZJZHgpOwogICAgICBmb3IgKGxldCBuID0gYmVnaW4sIGVuZCA9IG1hdGNoLmVuZC5kaXZJZHg7IG4gPD0gZW5kOyBuKyspIHsKICAgICAgICBjb25zdCBkaXYgPSB0ZXh0RGl2c1tuXTsKICAgICAgICBkaXYudGV4dENvbnRlbnQgPSB0ZXh0Q29udGVudEl0ZW1zU3RyW25dOwogICAgICAgIGRpdi5jbGFzc05hbWUgPSAiIjsKICAgICAgfQogICAgICBjbGVhcmVkVW50aWxEaXZJZHggPSBtYXRjaC5lbmQuZGl2SWR4ICsgMTsKICAgIH0KICAgIGlmICghZmluZENvbnRyb2xsZXI/LmhpZ2hsaWdodE1hdGNoZXMgfHwgcmVzZXQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGFnZU1hdGNoZXMgPSBmaW5kQ29udHJvbGxlci5wYWdlTWF0Y2hlc1twYWdlSWR4XSB8fCBudWxsOwogICAgY29uc3QgcGFnZU1hdGNoZXNMZW5ndGggPSBmaW5kQ29udHJvbGxlci5wYWdlTWF0Y2hlc0xlbmd0aFtwYWdlSWR4XSB8fCBudWxsOwogICAgdGhpcy5tYXRjaGVzID0gdGhpcy5fY29udmVydE1hdGNoZXMocGFnZU1hdGNoZXMsIHBhZ2VNYXRjaGVzTGVuZ3RoKTsKICAgIHRoaXMuX3JlbmRlck1hdGNoZXModGhpcy5tYXRjaGVzKTsKICB9Cn0KCjsvLyAuL3dlYi90ZXh0X2xheWVyX2J1aWxkZXIuanMKCgpjbGFzcyBUZXh0TGF5ZXJCdWlsZGVyIHsKICAjZW5hYmxlUGVybWlzc2lvbnMgPSBmYWxzZTsKICAjb25BcHBlbmQgPSBudWxsOwogICNyZW5kZXJpbmdEb25lID0gZmFsc2U7CiAgI3RleHRMYXllciA9IG51bGw7CiAgc3RhdGljICN0ZXh0TGF5ZXJzID0gbmV3IE1hcCgpOwogIHN0YXRpYyAjc2VsZWN0aW9uQ2hhbmdlQWJvcnRDb250cm9sbGVyID0gbnVsbDsKICBjb25zdHJ1Y3Rvcih7CiAgICBwZGZQYWdlLAogICAgaGlnaGxpZ2h0ZXIgPSBudWxsLAogICAgYWNjZXNzaWJpbGl0eU1hbmFnZXIgPSBudWxsLAogICAgZW5hYmxlUGVybWlzc2lvbnMgPSBmYWxzZSwKICAgIG9uQXBwZW5kID0gbnVsbAogIH0pIHsKICAgIHRoaXMucGRmUGFnZSA9IHBkZlBhZ2U7CiAgICB0aGlzLmhpZ2hsaWdodGVyID0gaGlnaGxpZ2h0ZXI7CiAgICB0aGlzLmFjY2Vzc2liaWxpdHlNYW5hZ2VyID0gYWNjZXNzaWJpbGl0eU1hbmFnZXI7CiAgICB0aGlzLiNlbmFibGVQZXJtaXNzaW9ucyA9IGVuYWJsZVBlcm1pc3Npb25zID09PSB0cnVlOwogICAgdGhpcy4jb25BcHBlbmQgPSBvbkFwcGVuZDsKICAgIHRoaXMuZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICB0aGlzLmRpdi50YWJJbmRleCA9IDA7CiAgICB0aGlzLmRpdi5jbGFzc05hbWUgPSAidGV4dExheWVyIjsKICB9CiAgYXN5bmMgcmVuZGVyKHsKICAgIHZpZXdwb3J0LAogICAgdGV4dENvbnRlbnRQYXJhbXMgPSBudWxsCiAgfSkgewogICAgaWYgKHRoaXMuI3JlbmRlcmluZ0RvbmUgJiYgdGhpcy4jdGV4dExheWVyKSB7CiAgICAgIHRoaXMuI3RleHRMYXllci51cGRhdGUoewogICAgICAgIHZpZXdwb3J0LAogICAgICAgIG9uQmVmb3JlOiB0aGlzLmhpZGUuYmluZCh0aGlzKQogICAgICB9KTsKICAgICAgdGhpcy5zaG93KCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuY2FuY2VsKCk7CiAgICB0aGlzLiN0ZXh0TGF5ZXIgPSBuZXcgVGV4dExheWVyKHsKICAgICAgdGV4dENvbnRlbnRTb3VyY2U6IHRoaXMucGRmUGFnZS5zdHJlYW1UZXh0Q29udGVudCh0ZXh0Q29udGVudFBhcmFtcyB8fCB7CiAgICAgICAgaW5jbHVkZU1hcmtlZENvbnRlbnQ6IHRydWUsCiAgICAgICAgZGlzYWJsZU5vcm1hbGl6YXRpb246IHRydWUKICAgICAgfSksCiAgICAgIGNvbnRhaW5lcjogdGhpcy5kaXYsCiAgICAgIHZpZXdwb3J0CiAgICB9KTsKICAgIGNvbnN0IHsKICAgICAgdGV4dERpdnMsCiAgICAgIHRleHRDb250ZW50SXRlbXNTdHIKICAgIH0gPSB0aGlzLiN0ZXh0TGF5ZXI7CiAgICB0aGlzLmhpZ2hsaWdodGVyPy5zZXRUZXh0TWFwcGluZyh0ZXh0RGl2cywgdGV4dENvbnRlbnRJdGVtc1N0cik7CiAgICB0aGlzLmFjY2Vzc2liaWxpdHlNYW5hZ2VyPy5zZXRUZXh0TWFwcGluZyh0ZXh0RGl2cyk7CiAgICBhd2FpdCB0aGlzLiN0ZXh0TGF5ZXIucmVuZGVyKCk7CiAgICB0aGlzLiNyZW5kZXJpbmdEb25lID0gdHJ1ZTsKICAgIGNvbnN0IGVuZE9mQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgZW5kT2ZDb250ZW50LmNsYXNzTmFtZSA9ICJlbmRPZkNvbnRlbnQiOwogICAgdGhpcy5kaXYuYXBwZW5kKGVuZE9mQ29udGVudCk7CiAgICB0aGlzLiNiaW5kTW91c2UoZW5kT2ZDb250ZW50KTsKICAgIHRoaXMuI29uQXBwZW5kPy4odGhpcy5kaXYpOwogICAgdGhpcy5oaWdobGlnaHRlcj8uZW5hYmxlKCk7CiAgICB0aGlzLmFjY2Vzc2liaWxpdHlNYW5hZ2VyPy5lbmFibGUoKTsKICB9CiAgaGlkZSgpIHsKICAgIGlmICghdGhpcy5kaXYuaGlkZGVuICYmIHRoaXMuI3JlbmRlcmluZ0RvbmUpIHsKICAgICAgdGhpcy5oaWdobGlnaHRlcj8uZGlzYWJsZSgpOwogICAgICB0aGlzLmRpdi5oaWRkZW4gPSB0cnVlOwogICAgfQogIH0KICBzaG93KCkgewogICAgaWYgKHRoaXMuZGl2LmhpZGRlbiAmJiB0aGlzLiNyZW5kZXJpbmdEb25lKSB7CiAgICAgIHRoaXMuZGl2LmhpZGRlbiA9IGZhbHNlOwogICAgICB0aGlzLmhpZ2hsaWdodGVyPy5lbmFibGUoKTsKICAgIH0KICB9CiAgY2FuY2VsKCkgewogICAgdGhpcy4jdGV4dExheWVyPy5jYW5jZWwoKTsKICAgIHRoaXMuI3RleHRMYXllciA9IG51bGw7CiAgICB0aGlzLmhpZ2hsaWdodGVyPy5kaXNhYmxlKCk7CiAgICB0aGlzLmFjY2Vzc2liaWxpdHlNYW5hZ2VyPy5kaXNhYmxlKCk7CiAgICBUZXh0TGF5ZXJCdWlsZGVyLiNyZW1vdmVHbG9iYWxTZWxlY3Rpb25MaXN0ZW5lcih0aGlzLmRpdik7CiAgfQogICNiaW5kTW91c2UoZW5kKSB7CiAgICBjb25zdCB7CiAgICAgIGRpdgogICAgfSA9IHRoaXM7CiAgICBkaXYuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgKCkgPT4gewogICAgICBkaXYuY2xhc3NMaXN0LmFkZCgic2VsZWN0aW5nIik7CiAgICB9KTsKICAgIGRpdi5hZGRFdmVudExpc3RlbmVyKCJjb3B5IiwgZXZlbnQgPT4gewogICAgICBpZiAoIXRoaXMuI2VuYWJsZVBlcm1pc3Npb25zKSB7CiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCk7CiAgICAgICAgZXZlbnQuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCJ0ZXh0L3BsYWluIiwgcmVtb3ZlTnVsbENoYXJhY3RlcnMobm9ybWFsaXplVW5pY29kZShzZWxlY3Rpb24udG9TdHJpbmcoKSkpKTsKICAgICAgfQogICAgICBzdG9wRXZlbnQoZXZlbnQpOwogICAgfSk7CiAgICBUZXh0TGF5ZXJCdWlsZGVyLiN0ZXh0TGF5ZXJzLnNldChkaXYsIGVuZCk7CiAgICBUZXh0TGF5ZXJCdWlsZGVyLiNlbmFibGVHbG9iYWxTZWxlY3Rpb25MaXN0ZW5lcigpOwogIH0KICBzdGF0aWMgI3JlbW92ZUdsb2JhbFNlbGVjdGlvbkxpc3RlbmVyKHRleHRMYXllckRpdikgewogICAgdGhpcy4jdGV4dExheWVycy5kZWxldGUodGV4dExheWVyRGl2KTsKICAgIGlmICh0aGlzLiN0ZXh0TGF5ZXJzLnNpemUgPT09IDApIHsKICAgICAgdGhpcy4jc2VsZWN0aW9uQ2hhbmdlQWJvcnRDb250cm9sbGVyPy5hYm9ydCgpOwogICAgICB0aGlzLiNzZWxlY3Rpb25DaGFuZ2VBYm9ydENvbnRyb2xsZXIgPSBudWxsOwogICAgfQogIH0KICBzdGF0aWMgI2VuYWJsZUdsb2JhbFNlbGVjdGlvbkxpc3RlbmVyKCkgewogICAgaWYgKHRoaXMuI3NlbGVjdGlvbkNoYW5nZUFib3J0Q29udHJvbGxlcikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNzZWxlY3Rpb25DaGFuZ2VBYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBjb25zdCB7CiAgICAgIHNpZ25hbAogICAgfSA9IHRoaXMuI3NlbGVjdGlvbkNoYW5nZUFib3J0Q29udHJvbGxlcjsKICAgIGNvbnN0IHJlc2V0ID0gKGVuZCwgdGV4dExheWVyKSA9PiB7CiAgICAgIHRleHRMYXllci5hcHBlbmQoZW5kKTsKICAgICAgZW5kLnN0eWxlLndpZHRoID0gIiI7CiAgICAgIGVuZC5zdHlsZS5oZWlnaHQgPSAiIjsKICAgICAgdGV4dExheWVyLmNsYXNzTGlzdC5yZW1vdmUoInNlbGVjdGluZyIpOwogICAgfTsKICAgIGxldCBpc1BvaW50ZXJEb3duID0gZmFsc2U7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsICgpID0+IHsKICAgICAgaXNQb2ludGVyRG93biA9IHRydWU7CiAgICB9LCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCAoKSA9PiB7CiAgICAgIGlzUG9pbnRlckRvd24gPSBmYWxzZTsKICAgICAgdGhpcy4jdGV4dExheWVycy5mb3JFYWNoKHJlc2V0KTsKICAgIH0sIHsKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJibHVyIiwgKCkgPT4gewogICAgICBpc1BvaW50ZXJEb3duID0gZmFsc2U7CiAgICAgIHRoaXMuI3RleHRMYXllcnMuZm9yRWFjaChyZXNldCk7CiAgICB9LCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXl1cCIsICgpID0+IHsKICAgICAgaWYgKCFpc1BvaW50ZXJEb3duKSB7CiAgICAgICAgdGhpcy4jdGV4dExheWVycy5mb3JFYWNoKHJlc2V0KTsKICAgICAgfQogICAgfSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgdmFyIGlzRmlyZWZveCwgcHJldlJhbmdlOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigic2VsZWN0aW9uY2hhbmdlIiwgKCkgPT4gewogICAgICBjb25zdCBzZWxlY3Rpb24gPSBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKTsKICAgICAgaWYgKHNlbGVjdGlvbi5yYW5nZUNvdW50ID09PSAwKSB7CiAgICAgICAgdGhpcy4jdGV4dExheWVycy5mb3JFYWNoKHJlc2V0KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgYWN0aXZlVGV4dExheWVycyA9IG5ldyBTZXQoKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3Rpb24ucmFuZ2VDb3VudDsgaSsrKSB7CiAgICAgICAgY29uc3QgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0UmFuZ2VBdChpKTsKICAgICAgICBmb3IgKGNvbnN0IHRleHRMYXllckRpdiBvZiB0aGlzLiN0ZXh0TGF5ZXJzLmtleXMoKSkgewogICAgICAgICAgaWYgKCFhY3RpdmVUZXh0TGF5ZXJzLmhhcyh0ZXh0TGF5ZXJEaXYpICYmIHJhbmdlLmludGVyc2VjdHNOb2RlKHRleHRMYXllckRpdikpIHsKICAgICAgICAgICAgYWN0aXZlVGV4dExheWVycy5hZGQodGV4dExheWVyRGl2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBbdGV4dExheWVyRGl2LCBlbmREaXZdIG9mIHRoaXMuI3RleHRMYXllcnMpIHsKICAgICAgICBpZiAoYWN0aXZlVGV4dExheWVycy5oYXModGV4dExheWVyRGl2KSkgewogICAgICAgICAgdGV4dExheWVyRGl2LmNsYXNzTGlzdC5hZGQoInNlbGVjdGluZyIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXNldChlbmREaXYsIHRleHRMYXllckRpdik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlzRmlyZWZveCA/Pz0gZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLiN0ZXh0TGF5ZXJzLnZhbHVlcygpLm5leHQoKS52YWx1ZSkuZ2V0UHJvcGVydHlWYWx1ZSgiLW1vei11c2VyLXNlbGVjdCIpID09PSAibm9uZSI7CiAgICAgIGlmIChpc0ZpcmVmb3gpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKTsKICAgICAgY29uc3QgbW9kaWZ5U3RhcnQgPSBwcmV2UmFuZ2UgJiYgKHJhbmdlLmNvbXBhcmVCb3VuZGFyeVBvaW50cyhSYW5nZS5FTkRfVE9fRU5ELCBwcmV2UmFuZ2UpID09PSAwIHx8IHJhbmdlLmNvbXBhcmVCb3VuZGFyeVBvaW50cyhSYW5nZS5TVEFSVF9UT19FTkQsIHByZXZSYW5nZSkgPT09IDApOwogICAgICBsZXQgYW5jaG9yID0gbW9kaWZ5U3RhcnQgPyByYW5nZS5zdGFydENvbnRhaW5lciA6IHJhbmdlLmVuZENvbnRhaW5lcjsKICAgICAgaWYgKGFuY2hvci5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpIHsKICAgICAgICBhbmNob3IgPSBhbmNob3IucGFyZW50Tm9kZTsKICAgICAgfQogICAgICBpZiAoIW1vZGlmeVN0YXJ0ICYmIHJhbmdlLmVuZE9mZnNldCA9PT0gMCkgewogICAgICAgIGRvIHsKICAgICAgICAgIHdoaWxlICghYW5jaG9yLnByZXZpb3VzU2libGluZykgewogICAgICAgICAgICBhbmNob3IgPSBhbmNob3IucGFyZW50Tm9kZTsKICAgICAgICAgIH0KICAgICAgICAgIGFuY2hvciA9IGFuY2hvci5wcmV2aW91c1NpYmxpbmc7CiAgICAgICAgfSB3aGlsZSAoIWFuY2hvci5jaGlsZE5vZGVzLmxlbmd0aCk7CiAgICAgIH0KICAgICAgY29uc3QgcGFyZW50VGV4dExheWVyID0gYW5jaG9yLnBhcmVudEVsZW1lbnQ/LmNsb3Nlc3QoIi50ZXh0TGF5ZXIiKTsKICAgICAgY29uc3QgZW5kRGl2ID0gdGhpcy4jdGV4dExheWVycy5nZXQocGFyZW50VGV4dExheWVyKTsKICAgICAgaWYgKGVuZERpdikgewogICAgICAgIGVuZERpdi5zdHlsZS53aWR0aCA9IHBhcmVudFRleHRMYXllci5zdHlsZS53aWR0aDsKICAgICAgICBlbmREaXYuc3R5bGUuaGVpZ2h0ID0gcGFyZW50VGV4dExheWVyLnN0eWxlLmhlaWdodDsKICAgICAgICBhbmNob3IucGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoZW5kRGl2LCBtb2RpZnlTdGFydCA/IGFuY2hvciA6IGFuY2hvci5uZXh0U2libGluZyk7CiAgICAgIH0KICAgICAgcHJldlJhbmdlID0gcmFuZ2UuY2xvbmVSYW5nZSgpOwogICAgfSwgewogICAgICBzaWduYWwKICAgIH0pOwogIH0KfQoKOy8vIC4vd2ViL3BkZl9wYWdlX3ZpZXcuanMKCgoKCgoKCgoKCgoKCgoKCmNvbnN0IERFRkFVTFRfTEFZRVJfUFJPUEVSVElFUyA9IG51bGw7CmNvbnN0IExBWUVSU19PUkRFUiA9IG5ldyBNYXAoW1siY2FudmFzV3JhcHBlciIsIDBdLCBbInRleHRMYXllciIsIDFdLCBbImFubm90YXRpb25MYXllciIsIDJdLCBbImFubm90YXRpb25FZGl0b3JMYXllciIsIDNdLCBbInhmYUxheWVyIiwgM11dKTsKY2xhc3MgUERGUGFnZVZpZXcgZXh0ZW5kcyBCYXNlUERGUGFnZVZpZXcgewogICNhbm5vdGF0aW9uTW9kZSA9IEFubm90YXRpb25Nb2RlLkVOQUJMRV9GT1JNUzsKICAjY2FudmFzV3JhcHBlciA9IG51bGw7CiAgI2VuYWJsZUF1dG9MaW5raW5nID0gdHJ1ZTsKICAjaGFzUmVzdHJpY3RlZFNjYWxpbmcgPSBmYWxzZTsKICAjaXNFZGl0aW5nID0gZmFsc2U7CiAgI2xheWVyUHJvcGVydGllcyA9IG51bGw7CiAgI25lZWRzUmVzdHJpY3RlZFNjYWxpbmcgPSBmYWxzZTsKICAjb3JpZ2luYWxWaWV3cG9ydCA9IG51bGw7CiAgI3ByZXZpb3VzUm90YXRpb24gPSBudWxsOwogICNzY2FsZVJvdW5kWCA9IDE7CiAgI3NjYWxlUm91bmRZID0gMTsKICAjdGV4dExheWVyTW9kZSA9IFRleHRMYXllck1vZGUuRU5BQkxFOwogICN1c2VyVW5pdCA9IDE7CiAgI3VzZVRodW1ibmFpbENhbnZhcyA9IHsKICAgIGRpcmVjdERyYXdpbmc6IHRydWUsCiAgICBpbml0aWFsT3B0aW9uYWxDb250ZW50OiB0cnVlLAogICAgcmVndWxhckFubm90YXRpb25zOiB0cnVlCiAgfTsKICAjbGF5ZXJzID0gW251bGwsIG51bGwsIG51bGwsIG51bGxdOwogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHN1cGVyKG9wdGlvbnMpOwogICAgY29uc3QgY29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXI7CiAgICBjb25zdCBkZWZhdWx0Vmlld3BvcnQgPSBvcHRpb25zLmRlZmF1bHRWaWV3cG9ydDsKICAgIHRoaXMucmVuZGVyaW5nSWQgPSAicGFnZSIgKyB0aGlzLmlkOwogICAgdGhpcy4jbGF5ZXJQcm9wZXJ0aWVzID0gb3B0aW9ucy5sYXllclByb3BlcnRpZXMgfHwgREVGQVVMVF9MQVlFUl9QUk9QRVJUSUVTOwogICAgdGhpcy5wZGZQYWdlID0gbnVsbDsKICAgIHRoaXMucGFnZUxhYmVsID0gbnVsbDsKICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgdGhpcy5zY2FsZSA9IG9wdGlvbnMuc2NhbGUgfHwgREVGQVVMVF9TQ0FMRTsKICAgIHRoaXMudmlld3BvcnQgPSBkZWZhdWx0Vmlld3BvcnQ7CiAgICB0aGlzLnBkZlBhZ2VSb3RhdGUgPSBkZWZhdWx0Vmlld3BvcnQucm90YXRpb247CiAgICB0aGlzLl9vcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlID0gb3B0aW9ucy5vcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlIHx8IG51bGw7CiAgICB0aGlzLiN0ZXh0TGF5ZXJNb2RlID0gb3B0aW9ucy50ZXh0TGF5ZXJNb2RlID8/IFRleHRMYXllck1vZGUuRU5BQkxFOwogICAgdGhpcy4jYW5ub3RhdGlvbk1vZGUgPSBvcHRpb25zLmFubm90YXRpb25Nb2RlID8/IEFubm90YXRpb25Nb2RlLkVOQUJMRV9GT1JNUzsKICAgIHRoaXMuaW1hZ2VSZXNvdXJjZXNQYXRoID0gb3B0aW9ucy5pbWFnZVJlc291cmNlc1BhdGggfHwgIiI7CiAgICB0aGlzLmVuYWJsZURldGFpbENhbnZhcyA9IG9wdGlvbnMuZW5hYmxlRGV0YWlsQ2FudmFzID8/IHRydWU7CiAgICB0aGlzLm1heENhbnZhc1BpeGVscyA9IG9wdGlvbnMubWF4Q2FudmFzUGl4ZWxzID8/IEFwcE9wdGlvbnMuZ2V0KCJtYXhDYW52YXNQaXhlbHMiKTsKICAgIHRoaXMubWF4Q2FudmFzRGltID0gb3B0aW9ucy5tYXhDYW52YXNEaW0gfHwgQXBwT3B0aW9ucy5nZXQoIm1heENhbnZhc0RpbSIpOwogICAgdGhpcy5jYXBDYW52YXNBcmVhRmFjdG9yID0gb3B0aW9ucy5jYXBDYW52YXNBcmVhRmFjdG9yID8/IEFwcE9wdGlvbnMuZ2V0KCJjYXBDYW52YXNBcmVhRmFjdG9yIik7CiAgICB0aGlzLiNlbmFibGVBdXRvTGlua2luZyA9IG9wdGlvbnMuZW5hYmxlQXV0b0xpbmtpbmcgIT09IGZhbHNlOwogICAgdGhpcy5sMTBuID0gb3B0aW9ucy5sMTBuOwogICAgdGhpcy5sMTBuIHx8PSBuZXcgZ2VuZXJpY2wxMG5fR2VuZXJpY0wxMG4oKTsKICAgIHRoaXMuX2lzU3RhbmRhbG9uZSA9ICF0aGlzLnJlbmRlcmluZ1F1ZXVlPy5oYXNWaWV3ZXIoKTsKICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjsKICAgIHRoaXMuX2Fubm90YXRpb25DYW52YXNNYXAgPSBudWxsOwogICAgdGhpcy5hbm5vdGF0aW9uTGF5ZXIgPSBudWxsOwogICAgdGhpcy5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIgPSBudWxsOwogICAgdGhpcy50ZXh0TGF5ZXIgPSBudWxsOwogICAgdGhpcy54ZmFMYXllciA9IG51bGw7CiAgICB0aGlzLnN0cnVjdFRyZWVMYXllciA9IG51bGw7CiAgICB0aGlzLmRyYXdMYXllciA9IG51bGw7CiAgICB0aGlzLmRldGFpbFZpZXcgPSBudWxsOwogICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBkaXYuY2xhc3NOYW1lID0gInBhZ2UiOwogICAgZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS1wYWdlLW51bWJlciIsIHRoaXMuaWQpOwogICAgZGl2LnNldEF0dHJpYnV0ZSgicm9sZSIsICJyZWdpb24iKTsKICAgIGRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsICJwZGZqcy1wYWdlLWxhbmRtYXJrIik7CiAgICBkaXYuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4tYXJncyIsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgcGFnZTogdGhpcy5pZAogICAgfSkpOwogICAgdGhpcy5kaXYgPSBkaXY7CiAgICB0aGlzLiNzZXREaW1lbnNpb25zKCk7CiAgICBjb250YWluZXI/LmFwcGVuZChkaXYpOwogICAgaWYgKHRoaXMuX2lzU3RhbmRhbG9uZSkgewogICAgICBjb250YWluZXI/LnN0eWxlLnNldFByb3BlcnR5KCItLXNjYWxlLWZhY3RvciIsIHRoaXMuc2NhbGUgKiBQaXhlbHNQZXJJbmNoLlBERl9UT19DU1NfVU5JVFMpOwogICAgICBpZiAodGhpcy5wYWdlQ29sb3JzPy5iYWNrZ3JvdW5kKSB7CiAgICAgICAgY29udGFpbmVyPy5zdHlsZS5zZXRQcm9wZXJ0eSgiLS1wYWdlLWJnLWNvbG9yIiwgdGhpcy5wYWdlQ29sb3JzLmJhY2tncm91bmQpOwogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBvcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlCiAgICAgIH0gPSBvcHRpb25zOwogICAgICBpZiAob3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZSkgewogICAgICAgIG9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UudGhlbihvcHRpb25hbENvbnRlbnRDb25maWcgPT4gewogICAgICAgICAgaWYgKG9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UgIT09IHRoaXMuX29wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy4jdXNlVGh1bWJuYWlsQ2FudmFzLmluaXRpYWxPcHRpb25hbENvbnRlbnQgPSBvcHRpb25hbENvbnRlbnRDb25maWcuaGFzSW5pdGlhbFZpc2liaWxpdHk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKCFvcHRpb25zLmwxMG4pIHsKICAgICAgICB0aGlzLmwxMG4udHJhbnNsYXRlKHRoaXMuZGl2KTsKICAgICAgfQogICAgfQogIH0KICAjYWRkTGF5ZXIoZGl2LCBuYW1lKSB7CiAgICBjb25zdCBwb3MgPSBMQVlFUlNfT1JERVIuZ2V0KG5hbWUpOwogICAgY29uc3Qgb2xkRGl2ID0gdGhpcy4jbGF5ZXJzW3Bvc107CiAgICB0aGlzLiNsYXllcnNbcG9zXSA9IGRpdjsKICAgIGlmIChvbGREaXYpIHsKICAgICAgb2xkRGl2LnJlcGxhY2VXaXRoKGRpdik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAobGV0IGkgPSBwb3MgLSAxOyBpID49IDA7IGktLSkgewogICAgICBjb25zdCBsYXllciA9IHRoaXMuI2xheWVyc1tpXTsKICAgICAgaWYgKGxheWVyKSB7CiAgICAgICAgbGF5ZXIuYWZ0ZXIoZGl2KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZGl2LnByZXBlbmQoZGl2KTsKICB9CiAgI3NldERpbWVuc2lvbnMoKSB7CiAgICBjb25zdCB7CiAgICAgIGRpdiwKICAgICAgdmlld3BvcnQKICAgIH0gPSB0aGlzOwogICAgaWYgKHZpZXdwb3J0LnVzZXJVbml0ICE9PSB0aGlzLiN1c2VyVW5pdCkgewogICAgICBpZiAodmlld3BvcnQudXNlclVuaXQgIT09IDEpIHsKICAgICAgICBkaXYuc3R5bGUuc2V0UHJvcGVydHkoIi0tdXNlci11bml0Iiwgdmlld3BvcnQudXNlclVuaXQpOwogICAgICB9IGVsc2UgewogICAgICAgIGRpdi5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgiLS11c2VyLXVuaXQiKTsKICAgICAgfQogICAgICB0aGlzLiN1c2VyVW5pdCA9IHZpZXdwb3J0LnVzZXJVbml0OwogICAgfQogICAgaWYgKHRoaXMucGRmUGFnZSkgewogICAgICBpZiAodGhpcy4jcHJldmlvdXNSb3RhdGlvbiA9PT0gdmlld3BvcnQucm90YXRpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy4jcHJldmlvdXNSb3RhdGlvbiA9IHZpZXdwb3J0LnJvdGF0aW9uOwogICAgfQogICAgc2V0TGF5ZXJEaW1lbnNpb25zKGRpdiwgdmlld3BvcnQsIHRydWUsIGZhbHNlKTsKICB9CiAgc2V0UGRmUGFnZShwZGZQYWdlKSB7CiAgICBpZiAodGhpcy5faXNTdGFuZGFsb25lICYmICh0aGlzLnBhZ2VDb2xvcnM/LmZvcmVncm91bmQgPT09ICJDYW52YXNUZXh0IiB8fCB0aGlzLnBhZ2VDb2xvcnM/LmJhY2tncm91bmQgPT09ICJDYW52YXMiKSkgewogICAgICB0aGlzLl9jb250YWluZXI/LnN0eWxlLnNldFByb3BlcnR5KCItLWhjbS1oaWdobGlnaHQtZmlsdGVyIiwgcGRmUGFnZS5maWx0ZXJGYWN0b3J5LmFkZEhpZ2hsaWdodEhDTUZpbHRlcigiaGlnaGxpZ2h0IiwgIkNhbnZhc1RleHQiLCAiQ2FudmFzIiwgIkhpZ2hsaWdodFRleHQiLCAiSGlnaGxpZ2h0IikpOwogICAgICB0aGlzLl9jb250YWluZXI/LnN0eWxlLnNldFByb3BlcnR5KCItLWhjbS1oaWdobGlnaHQtc2VsZWN0ZWQtZmlsdGVyIiwgcGRmUGFnZS5maWx0ZXJGYWN0b3J5LmFkZEhpZ2hsaWdodEhDTUZpbHRlcigiaGlnaGxpZ2h0X3NlbGVjdGVkIiwgIkNhbnZhc1RleHQiLCAiQ2FudmFzIiwgIkhpZ2hsaWdodFRleHQiLCAiSGlnaGxpZ2h0IikpOwogICAgfQogICAgdGhpcy5wZGZQYWdlID0gcGRmUGFnZTsKICAgIHRoaXMucGRmUGFnZVJvdGF0ZSA9IHBkZlBhZ2Uucm90YXRlOwogICAgY29uc3QgdG90YWxSb3RhdGlvbiA9ICh0aGlzLnJvdGF0aW9uICsgdGhpcy5wZGZQYWdlUm90YXRlKSAlIDM2MDsKICAgIHRoaXMudmlld3BvcnQgPSBwZGZQYWdlLmdldFZpZXdwb3J0KHsKICAgICAgc2NhbGU6IHRoaXMuc2NhbGUgKiBQaXhlbHNQZXJJbmNoLlBERl9UT19DU1NfVU5JVFMsCiAgICAgIHJvdGF0aW9uOiB0b3RhbFJvdGF0aW9uCiAgICB9KTsKICAgIHRoaXMuI3NldERpbWVuc2lvbnMoKTsKICAgIHRoaXMucmVzZXQoKTsKICB9CiAgZGVzdHJveSgpIHsKICAgIHRoaXMucmVzZXQoKTsKICAgIHRoaXMucGRmUGFnZT8uY2xlYW51cCgpOwogIH0KICBoYXNFZGl0YWJsZUFubm90YXRpb25zKCkgewogICAgcmV0dXJuICEhdGhpcy5hbm5vdGF0aW9uTGF5ZXI/Lmhhc0VkaXRhYmxlQW5ub3RhdGlvbnMoKTsKICB9CiAgZ2V0IF90ZXh0SGlnaGxpZ2h0ZXIoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfdGV4dEhpZ2hsaWdodGVyIiwgbmV3IFRleHRIaWdobGlnaHRlcih7CiAgICAgIHBhZ2VJbmRleDogdGhpcy5pZCAtIDEsCiAgICAgIGV2ZW50QnVzOiB0aGlzLmV2ZW50QnVzLAogICAgICBmaW5kQ29udHJvbGxlcjogdGhpcy4jbGF5ZXJQcm9wZXJ0aWVzLmZpbmRDb250cm9sbGVyCiAgICB9KSk7CiAgfQogICNkaXNwYXRjaExheWVyUmVuZGVyZWQobmFtZSwgZXJyb3IpIHsKICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2gobmFtZSwgewogICAgICBzb3VyY2U6IHRoaXMsCiAgICAgIHBhZ2VOdW1iZXI6IHRoaXMuaWQsCiAgICAgIGVycm9yCiAgICB9KTsKICB9CiAgYXN5bmMgI3JlbmRlckFubm90YXRpb25MYXllcigpIHsKICAgIGxldCBlcnJvciA9IG51bGw7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLmFubm90YXRpb25MYXllci5yZW5kZXIoewogICAgICAgIHZpZXdwb3J0OiB0aGlzLnZpZXdwb3J0LAogICAgICAgIGludGVudDogImRpc3BsYXkiLAogICAgICAgIHN0cnVjdFRyZWVMYXllcjogdGhpcy5zdHJ1Y3RUcmVlTGF5ZXIKICAgICAgfSk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBjb25zb2xlLmVycm9yKCIjcmVuZGVyQW5ub3RhdGlvbkxheWVyOiIsIGV4KTsKICAgICAgZXJyb3IgPSBleDsKICAgIH0gZmluYWxseSB7CiAgICAgIHRoaXMuI2Rpc3BhdGNoTGF5ZXJSZW5kZXJlZCgiYW5ub3RhdGlvbmxheWVycmVuZGVyZWQiLCBlcnJvcik7CiAgICB9CiAgfQogIGFzeW5jICNyZW5kZXJBbm5vdGF0aW9uRWRpdG9yTGF5ZXIoKSB7CiAgICBsZXQgZXJyb3IgPSBudWxsOwogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIucmVuZGVyKHsKICAgICAgICB2aWV3cG9ydDogdGhpcy52aWV3cG9ydCwKICAgICAgICBpbnRlbnQ6ICJkaXNwbGF5IgogICAgICB9KTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIiNyZW5kZXJBbm5vdGF0aW9uRWRpdG9yTGF5ZXI6IiwgZXgpOwogICAgICBlcnJvciA9IGV4OwogICAgfSBmaW5hbGx5IHsKICAgICAgdGhpcy4jZGlzcGF0Y2hMYXllclJlbmRlcmVkKCJhbm5vdGF0aW9uZWRpdG9ybGF5ZXJyZW5kZXJlZCIsIGVycm9yKTsKICAgIH0KICB9CiAgYXN5bmMgI3JlbmRlckRyYXdMYXllcigpIHsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMuZHJhd0xheWVyLnJlbmRlcih7CiAgICAgICAgaW50ZW50OiAiZGlzcGxheSIKICAgICAgfSk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBjb25zb2xlLmVycm9yKCIjcmVuZGVyRHJhd0xheWVyOiIsIGV4KTsKICAgIH0KICB9CiAgYXN5bmMgI3JlbmRlclhmYUxheWVyKCkgewogICAgbGV0IGVycm9yID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMueGZhTGF5ZXIucmVuZGVyKHsKICAgICAgICB2aWV3cG9ydDogdGhpcy52aWV3cG9ydCwKICAgICAgICBpbnRlbnQ6ICJkaXNwbGF5IgogICAgICB9KTsKICAgICAgaWYgKHJlc3VsdD8udGV4dERpdnMgJiYgdGhpcy5fdGV4dEhpZ2hsaWdodGVyKSB7CiAgICAgICAgdGhpcy4jYnVpbGRYZmFUZXh0Q29udGVudEl0ZW1zKHJlc3VsdC50ZXh0RGl2cyk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIiNyZW5kZXJYZmFMYXllcjoiLCBleCk7CiAgICAgIGVycm9yID0gZXg7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAodGhpcy54ZmFMYXllcj8uZGl2KSB7CiAgICAgICAgdGhpcy5sMTBuLnBhdXNlKCk7CiAgICAgICAgdGhpcy4jYWRkTGF5ZXIodGhpcy54ZmFMYXllci5kaXYsICJ4ZmFMYXllciIpOwogICAgICAgIHRoaXMubDEwbi5yZXN1bWUoKTsKICAgICAgfQogICAgICB0aGlzLiNkaXNwYXRjaExheWVyUmVuZGVyZWQoInhmYWxheWVycmVuZGVyZWQiLCBlcnJvcik7CiAgICB9CiAgfQogIGFzeW5jICNyZW5kZXJUZXh0TGF5ZXIoKSB7CiAgICBpZiAoIXRoaXMudGV4dExheWVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBlcnJvciA9IG51bGw7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnRleHRMYXllci5yZW5kZXIoewogICAgICAgIHZpZXdwb3J0OiB0aGlzLnZpZXdwb3J0CiAgICAgIH0pOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc29sZS5lcnJvcigiI3JlbmRlclRleHRMYXllcjoiLCBleCk7CiAgICAgIGVycm9yID0gZXg7CiAgICB9CiAgICB0aGlzLiNkaXNwYXRjaExheWVyUmVuZGVyZWQoInRleHRsYXllcnJlbmRlcmVkIiwgZXJyb3IpOwogICAgdGhpcy4jcmVuZGVyU3RydWN0VHJlZUxheWVyKCk7CiAgfQogIGFzeW5jICNyZW5kZXJTdHJ1Y3RUcmVlTGF5ZXIoKSB7CiAgICBpZiAoIXRoaXMudGV4dExheWVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHRyZWVEb20gPSBhd2FpdCB0aGlzLnN0cnVjdFRyZWVMYXllcj8ucmVuZGVyKCk7CiAgICBpZiAodHJlZURvbSkgewogICAgICB0aGlzLmwxMG4ucGF1c2UoKTsKICAgICAgdGhpcy5zdHJ1Y3RUcmVlTGF5ZXI/LmFkZEVsZW1lbnRzVG9UZXh0TGF5ZXIoKTsKICAgICAgaWYgKHRoaXMuY2FudmFzICYmIHRyZWVEb20ucGFyZW50Tm9kZSAhPT0gdGhpcy5jYW52YXMpIHsKICAgICAgICB0aGlzLmNhbnZhcy5hcHBlbmQodHJlZURvbSk7CiAgICAgIH0KICAgICAgdGhpcy5sMTBuLnJlc3VtZSgpOwogICAgfQogICAgdGhpcy5zdHJ1Y3RUcmVlTGF5ZXI/LnNob3coKTsKICB9CiAgYXN5bmMgI2J1aWxkWGZhVGV4dENvbnRlbnRJdGVtcyh0ZXh0RGl2cykgewogICAgY29uc3QgdGV4dCA9IGF3YWl0IHRoaXMucGRmUGFnZS5nZXRUZXh0Q29udGVudCgpOwogICAgY29uc3QgaXRlbXMgPSBbXTsKICAgIGZvciAoY29uc3QgaXRlbSBvZiB0ZXh0Lml0ZW1zKSB7CiAgICAgIGl0ZW1zLnB1c2goaXRlbS5zdHIpOwogICAgfQogICAgdGhpcy5fdGV4dEhpZ2hsaWdodGVyLnNldFRleHRNYXBwaW5nKHRleHREaXZzLCBpdGVtcyk7CiAgICB0aGlzLl90ZXh0SGlnaGxpZ2h0ZXIuZW5hYmxlKCk7CiAgfQogIGFzeW5jICNpbmplY3RMaW5rQW5ub3RhdGlvbnModGV4dExheWVyUHJvbWlzZSkgewogICAgbGV0IGVycm9yID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRleHRMYXllclByb21pc2U7CiAgICAgIGlmICghdGhpcy5hbm5vdGF0aW9uTGF5ZXIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgYXdhaXQgdGhpcy5hbm5vdGF0aW9uTGF5ZXIuaW5qZWN0TGlua0Fubm90YXRpb25zKHsKICAgICAgICBpbmZlcnJlZExpbmtzOiBBdXRvbGlua2VyLnByb2Nlc3NMaW5rcyh0aGlzKSwKICAgICAgICB2aWV3cG9ydDogdGhpcy52aWV3cG9ydCwKICAgICAgICBzdHJ1Y3RUcmVlTGF5ZXI6IHRoaXMuc3RydWN0VHJlZUxheWVyCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgY29uc29sZS5lcnJvcigiI2luamVjdExpbmtBbm5vdGF0aW9uczoiLCBleCk7CiAgICAgIGVycm9yID0gZXg7CiAgICB9CiAgfQogIF9yZXNldENhbnZhcygpIHsKICAgIHN1cGVyLl9yZXNldENhbnZhcygpOwogICAgdGhpcy4jb3JpZ2luYWxWaWV3cG9ydCA9IG51bGw7CiAgfQogIHJlc2V0KHsKICAgIGtlZXBBbm5vdGF0aW9uTGF5ZXIgPSBmYWxzZSwKICAgIGtlZXBBbm5vdGF0aW9uRWRpdG9yTGF5ZXIgPSBmYWxzZSwKICAgIGtlZXBYZmFMYXllciA9IGZhbHNlLAogICAga2VlcFRleHRMYXllciA9IGZhbHNlLAogICAga2VlcENhbnZhc1dyYXBwZXIgPSBmYWxzZSwKICAgIHByZXNlcnZlRGV0YWlsVmlld1N0YXRlID0gZmFsc2UKICB9ID0ge30pIHsKICAgIHRoaXMuY2FuY2VsUmVuZGVyaW5nKHsKICAgICAga2VlcEFubm90YXRpb25MYXllciwKICAgICAga2VlcEFubm90YXRpb25FZGl0b3JMYXllciwKICAgICAga2VlcFhmYUxheWVyLAogICAgICBrZWVwVGV4dExheWVyCiAgICB9KTsKICAgIHRoaXMucmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuSU5JVElBTDsKICAgIGNvbnN0IGRpdiA9IHRoaXMuZGl2OwogICAgY29uc3QgY2hpbGROb2RlcyA9IGRpdi5jaGlsZE5vZGVzLAogICAgICBhbm5vdGF0aW9uTGF5ZXJOb2RlID0ga2VlcEFubm90YXRpb25MYXllciAmJiB0aGlzLmFubm90YXRpb25MYXllcj8uZGl2IHx8IG51bGwsCiAgICAgIGFubm90YXRpb25FZGl0b3JMYXllck5vZGUgPSBrZWVwQW5ub3RhdGlvbkVkaXRvckxheWVyICYmIHRoaXMuYW5ub3RhdGlvbkVkaXRvckxheWVyPy5kaXYgfHwgbnVsbCwKICAgICAgeGZhTGF5ZXJOb2RlID0ga2VlcFhmYUxheWVyICYmIHRoaXMueGZhTGF5ZXI/LmRpdiB8fCBudWxsLAogICAgICB0ZXh0TGF5ZXJOb2RlID0ga2VlcFRleHRMYXllciAmJiB0aGlzLnRleHRMYXllcj8uZGl2IHx8IG51bGwsCiAgICAgIGNhbnZhc1dyYXBwZXJOb2RlID0ga2VlcENhbnZhc1dyYXBwZXIgJiYgdGhpcy4jY2FudmFzV3JhcHBlciB8fCBudWxsOwogICAgZm9yIChsZXQgaSA9IGNoaWxkTm9kZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgY29uc3Qgbm9kZSA9IGNoaWxkTm9kZXNbaV07CiAgICAgIHN3aXRjaCAobm9kZSkgewogICAgICAgIGNhc2UgYW5ub3RhdGlvbkxheWVyTm9kZToKICAgICAgICBjYXNlIGFubm90YXRpb25FZGl0b3JMYXllck5vZGU6CiAgICAgICAgY2FzZSB4ZmFMYXllck5vZGU6CiAgICAgICAgY2FzZSB0ZXh0TGF5ZXJOb2RlOgogICAgICAgIGNhc2UgY2FudmFzV3JhcHBlck5vZGU6CiAgICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBub2RlLnJlbW92ZSgpOwogICAgICBjb25zdCBsYXllckluZGV4ID0gdGhpcy4jbGF5ZXJzLmluZGV4T2Yobm9kZSk7CiAgICAgIGlmIChsYXllckluZGV4ID49IDApIHsKICAgICAgICB0aGlzLiNsYXllcnNbbGF5ZXJJbmRleF0gPSBudWxsOwogICAgICB9CiAgICB9CiAgICBkaXYucmVtb3ZlQXR0cmlidXRlKCJkYXRhLWxvYWRlZCIpOwogICAgaWYgKGFubm90YXRpb25MYXllck5vZGUpIHsKICAgICAgdGhpcy5hbm5vdGF0aW9uTGF5ZXIuaGlkZSgpOwogICAgfQogICAgaWYgKGFubm90YXRpb25FZGl0b3JMYXllck5vZGUpIHsKICAgICAgdGhpcy5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIuaGlkZSgpOwogICAgfQogICAgaWYgKHhmYUxheWVyTm9kZSkgewogICAgICB0aGlzLnhmYUxheWVyLmhpZGUoKTsKICAgIH0KICAgIGlmICh0ZXh0TGF5ZXJOb2RlKSB7CiAgICAgIHRoaXMudGV4dExheWVyLmhpZGUoKTsKICAgIH0KICAgIHRoaXMuc3RydWN0VHJlZUxheWVyPy5oaWRlKCk7CiAgICBpZiAoIWtlZXBDYW52YXNXcmFwcGVyICYmIHRoaXMuI2NhbnZhc1dyYXBwZXIpIHsKICAgICAgdGhpcy4jY2FudmFzV3JhcHBlciA9IG51bGw7CiAgICAgIHRoaXMuX3Jlc2V0Q2FudmFzKCk7CiAgICB9CiAgICBpZiAoIXByZXNlcnZlRGV0YWlsVmlld1N0YXRlKSB7CiAgICAgIHRoaXMuZGV0YWlsVmlldz8ucmVzZXQoewogICAgICAgIGtlZXBDYW52YXM6IGtlZXBDYW52YXNXcmFwcGVyCiAgICAgIH0pOwogICAgICBpZiAoIWtlZXBDYW52YXNXcmFwcGVyKSB7CiAgICAgICAgdGhpcy5kZXRhaWxWaWV3ID0gbnVsbDsKICAgICAgfQogICAgfQogIH0KICB0b2dnbGVFZGl0aW5nTW9kZShpc0VkaXRpbmcpIHsKICAgIHRoaXMuI2lzRWRpdGluZyA9IGlzRWRpdGluZzsKICAgIGlmICghdGhpcy5oYXNFZGl0YWJsZUFubm90YXRpb25zKCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5yZXNldCh7CiAgICAgIGtlZXBBbm5vdGF0aW9uTGF5ZXI6IHRydWUsCiAgICAgIGtlZXBBbm5vdGF0aW9uRWRpdG9yTGF5ZXI6IHRydWUsCiAgICAgIGtlZXBYZmFMYXllcjogdHJ1ZSwKICAgICAga2VlcFRleHRMYXllcjogdHJ1ZSwKICAgICAga2VlcENhbnZhc1dyYXBwZXI6IHRydWUKICAgIH0pOwogIH0KICB1cGRhdGVWaXNpYmxlQXJlYSh2aXNpYmxlQXJlYSkgewogICAgaWYgKHRoaXMuZW5hYmxlRGV0YWlsQ2FudmFzKSB7CiAgICAgIGlmICh0aGlzLiNuZWVkc1Jlc3RyaWN0ZWRTY2FsaW5nICYmIHRoaXMubWF4Q2FudmFzUGl4ZWxzID4gMCAmJiB2aXNpYmxlQXJlYSkgewogICAgICAgIHRoaXMuZGV0YWlsVmlldyA/Pz0gbmV3IFBERlBhZ2VEZXRhaWxWaWV3KHsKICAgICAgICAgIHBhZ2VWaWV3OiB0aGlzCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5kZXRhaWxWaWV3LnVwZGF0ZSh7CiAgICAgICAgICB2aXNpYmxlQXJlYQogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZGV0YWlsVmlldykgewogICAgICAgIHRoaXMuZGV0YWlsVmlldy5yZXNldCgpOwogICAgICAgIHRoaXMuZGV0YWlsVmlldyA9IG51bGw7CiAgICAgIH0KICAgIH0KICB9CiAgdXBkYXRlKHsKICAgIHNjYWxlID0gMCwKICAgIHJvdGF0aW9uID0gbnVsbCwKICAgIG9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UgPSBudWxsLAogICAgZHJhd2luZ0RlbGF5ID0gLTEKICB9KSB7CiAgICB0aGlzLnNjYWxlID0gc2NhbGUgfHwgdGhpcy5zY2FsZTsKICAgIGlmICh0eXBlb2Ygcm90YXRpb24gPT09ICJudW1iZXIiKSB7CiAgICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjsKICAgIH0KICAgIGlmIChvcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlIGluc3RhbmNlb2YgUHJvbWlzZSkgewogICAgICB0aGlzLl9vcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlID0gb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZTsKICAgICAgb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZS50aGVuKG9wdGlvbmFsQ29udGVudENvbmZpZyA9PiB7CiAgICAgICAgaWYgKG9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UgIT09IHRoaXMuX29wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy4jdXNlVGh1bWJuYWlsQ2FudmFzLmluaXRpYWxPcHRpb25hbENvbnRlbnQgPSBvcHRpb25hbENvbnRlbnRDb25maWcuaGFzSW5pdGlhbFZpc2liaWxpdHk7CiAgICAgIH0pOwogICAgfQogICAgdGhpcy4jdXNlVGh1bWJuYWlsQ2FudmFzLmRpcmVjdERyYXdpbmcgPSB0cnVlOwogICAgY29uc3QgdG90YWxSb3RhdGlvbiA9ICh0aGlzLnJvdGF0aW9uICsgdGhpcy5wZGZQYWdlUm90YXRlKSAlIDM2MDsKICAgIHRoaXMudmlld3BvcnQgPSB0aGlzLnZpZXdwb3J0LmNsb25lKHsKICAgICAgc2NhbGU6IHRoaXMuc2NhbGUgKiBQaXhlbHNQZXJJbmNoLlBERl9UT19DU1NfVU5JVFMsCiAgICAgIHJvdGF0aW9uOiB0b3RhbFJvdGF0aW9uCiAgICB9KTsKICAgIHRoaXMuI3NldERpbWVuc2lvbnMoKTsKICAgIGlmICh0aGlzLl9pc1N0YW5kYWxvbmUpIHsKICAgICAgdGhpcy5fY29udGFpbmVyPy5zdHlsZS5zZXRQcm9wZXJ0eSgiLS1zY2FsZS1mYWN0b3IiLCB0aGlzLnZpZXdwb3J0LnNjYWxlKTsKICAgIH0KICAgIHRoaXMuI2NvbXB1dGVTY2FsZSgpOwogICAgaWYgKHRoaXMuY2FudmFzKSB7CiAgICAgIGNvbnN0IG9ubHlDc3Nab29tID0gdGhpcy4jaGFzUmVzdHJpY3RlZFNjYWxpbmcgJiYgdGhpcy4jbmVlZHNSZXN0cmljdGVkU2NhbGluZzsKICAgICAgY29uc3QgcG9zdHBvbmVEcmF3aW5nID0gZHJhd2luZ0RlbGF5ID49IDAgJiYgZHJhd2luZ0RlbGF5IDwgMTAwMDsKICAgICAgaWYgKHBvc3Rwb25lRHJhd2luZyB8fCBvbmx5Q3NzWm9vbSkgewogICAgICAgIGlmIChwb3N0cG9uZURyYXdpbmcgJiYgIW9ubHlDc3Nab29tICYmIHRoaXMucmVuZGVyaW5nU3RhdGUgIT09IFJlbmRlcmluZ1N0YXRlcy5GSU5JU0hFRCkgewogICAgICAgICAgdGhpcy5jYW5jZWxSZW5kZXJpbmcoewogICAgICAgICAgICBrZWVwQW5ub3RhdGlvbkxheWVyOiB0cnVlLAogICAgICAgICAgICBrZWVwQW5ub3RhdGlvbkVkaXRvckxheWVyOiB0cnVlLAogICAgICAgICAgICBrZWVwWGZhTGF5ZXI6IHRydWUsCiAgICAgICAgICAgIGtlZXBUZXh0TGF5ZXI6IHRydWUsCiAgICAgICAgICAgIGNhbmNlbEV4dHJhRGVsYXk6IGRyYXdpbmdEZWxheQogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLnJlbmRlcmluZ1N0YXRlID0gUmVuZGVyaW5nU3RhdGVzLkZJTklTSEVEOwogICAgICAgICAgdGhpcy4jdXNlVGh1bWJuYWlsQ2FudmFzLmRpcmVjdERyYXdpbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5jc3NUcmFuc2Zvcm0oewogICAgICAgICAgcmVkcmF3QW5ub3RhdGlvbkxheWVyOiB0cnVlLAogICAgICAgICAgcmVkcmF3QW5ub3RhdGlvbkVkaXRvckxheWVyOiB0cnVlLAogICAgICAgICAgcmVkcmF3WGZhTGF5ZXI6IHRydWUsCiAgICAgICAgICByZWRyYXdUZXh0TGF5ZXI6ICFwb3N0cG9uZURyYXdpbmcsCiAgICAgICAgICBoaWRlVGV4dExheWVyOiBwb3N0cG9uZURyYXdpbmcKICAgICAgICB9KTsKICAgICAgICBpZiAoIXBvc3Rwb25lRHJhd2luZykgewogICAgICAgICAgdGhpcy5kZXRhaWxWaWV3Py51cGRhdGUoewogICAgICAgICAgICB1bmRlcmx5aW5nVmlld1VwZGF0ZWQ6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5kaXNwYXRjaFBhZ2VSZW5kZXJlZCh0cnVlLCBmYWxzZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgdGhpcy5jc3NUcmFuc2Zvcm0oe30pOwogICAgdGhpcy5yZXNldCh7CiAgICAgIGtlZXBBbm5vdGF0aW9uTGF5ZXI6IHRydWUsCiAgICAgIGtlZXBBbm5vdGF0aW9uRWRpdG9yTGF5ZXI6IHRydWUsCiAgICAgIGtlZXBYZmFMYXllcjogdHJ1ZSwKICAgICAga2VlcFRleHRMYXllcjogdHJ1ZSwKICAgICAga2VlcENhbnZhc1dyYXBwZXI6IHRydWUsCiAgICAgIHByZXNlcnZlRGV0YWlsVmlld1N0YXRlOiB0cnVlCiAgICB9KTsKICAgIHRoaXMuZGV0YWlsVmlldz8udXBkYXRlKHsKICAgICAgdW5kZXJseWluZ1ZpZXdVcGRhdGVkOiB0cnVlCiAgICB9KTsKICB9CiAgI2NvbXB1dGVTY2FsZSgpIHsKICAgIGNvbnN0IHsKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfSA9IHRoaXMudmlld3BvcnQ7CiAgICBjb25zdCBvdXRwdXRTY2FsZSA9IHRoaXMub3V0cHV0U2NhbGUgPSBuZXcgT3V0cHV0U2NhbGUoKTsKICAgIGlmICh0aGlzLm1heENhbnZhc1BpeGVscyA9PT0gMCkgewogICAgICBjb25zdCBpbnZTY2FsZSA9IDEgLyB0aGlzLnNjYWxlOwogICAgICBvdXRwdXRTY2FsZS5zeCAqPSBpbnZTY2FsZTsKICAgICAgb3V0cHV0U2NhbGUuc3kgKj0gaW52U2NhbGU7CiAgICAgIHRoaXMuI25lZWRzUmVzdHJpY3RlZFNjYWxpbmcgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy4jbmVlZHNSZXN0cmljdGVkU2NhbGluZyA9IG91dHB1dFNjYWxlLmxpbWl0Q2FudmFzKHdpZHRoLCBoZWlnaHQsIHRoaXMubWF4Q2FudmFzUGl4ZWxzLCB0aGlzLm1heENhbnZhc0RpbSwgdGhpcy5jYXBDYW52YXNBcmVhRmFjdG9yKTsKICAgIH0KICB9CiAgY2FuY2VsUmVuZGVyaW5nKHsKICAgIGtlZXBBbm5vdGF0aW9uTGF5ZXIgPSBmYWxzZSwKICAgIGtlZXBBbm5vdGF0aW9uRWRpdG9yTGF5ZXIgPSBmYWxzZSwKICAgIGtlZXBYZmFMYXllciA9IGZhbHNlLAogICAga2VlcFRleHRMYXllciA9IGZhbHNlLAogICAgY2FuY2VsRXh0cmFEZWxheSA9IDAKICB9ID0ge30pIHsKICAgIHN1cGVyLmNhbmNlbFJlbmRlcmluZyh7CiAgICAgIGNhbmNlbEV4dHJhRGVsYXkKICAgIH0pOwogICAgaWYgKHRoaXMudGV4dExheWVyICYmICgha2VlcFRleHRMYXllciB8fCAhdGhpcy50ZXh0TGF5ZXIuZGl2KSkgewogICAgICB0aGlzLnRleHRMYXllci5jYW5jZWwoKTsKICAgICAgdGhpcy50ZXh0TGF5ZXIgPSBudWxsOwogICAgfQogICAgaWYgKHRoaXMuYW5ub3RhdGlvbkxheWVyICYmICgha2VlcEFubm90YXRpb25MYXllciB8fCAhdGhpcy5hbm5vdGF0aW9uTGF5ZXIuZGl2KSkgewogICAgICB0aGlzLmFubm90YXRpb25MYXllci5jYW5jZWwoKTsKICAgICAgdGhpcy5hbm5vdGF0aW9uTGF5ZXIgPSBudWxsOwogICAgICB0aGlzLl9hbm5vdGF0aW9uQ2FudmFzTWFwID0gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLnN0cnVjdFRyZWVMYXllciAmJiAhdGhpcy50ZXh0TGF5ZXIpIHsKICAgICAgdGhpcy5zdHJ1Y3RUcmVlTGF5ZXIgPSBudWxsOwogICAgfQogICAgaWYgKHRoaXMuYW5ub3RhdGlvbkVkaXRvckxheWVyICYmICgha2VlcEFubm90YXRpb25FZGl0b3JMYXllciB8fCAhdGhpcy5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIuZGl2KSkgewogICAgICBpZiAodGhpcy5kcmF3TGF5ZXIpIHsKICAgICAgICB0aGlzLmRyYXdMYXllci5jYW5jZWwoKTsKICAgICAgICB0aGlzLmRyYXdMYXllciA9IG51bGw7CiAgICAgIH0KICAgICAgdGhpcy5hbm5vdGF0aW9uRWRpdG9yTGF5ZXIuY2FuY2VsKCk7CiAgICAgIHRoaXMuYW5ub3RhdGlvbkVkaXRvckxheWVyID0gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLnhmYUxheWVyICYmICgha2VlcFhmYUxheWVyIHx8ICF0aGlzLnhmYUxheWVyLmRpdikpIHsKICAgICAgdGhpcy54ZmFMYXllci5jYW5jZWwoKTsKICAgICAgdGhpcy54ZmFMYXllciA9IG51bGw7CiAgICAgIHRoaXMuX3RleHRIaWdobGlnaHRlcj8uZGlzYWJsZSgpOwogICAgfQogIH0KICBjc3NUcmFuc2Zvcm0oewogICAgcmVkcmF3QW5ub3RhdGlvbkxheWVyID0gZmFsc2UsCiAgICByZWRyYXdBbm5vdGF0aW9uRWRpdG9yTGF5ZXIgPSBmYWxzZSwKICAgIHJlZHJhd1hmYUxheWVyID0gZmFsc2UsCiAgICByZWRyYXdUZXh0TGF5ZXIgPSBmYWxzZSwKICAgIGhpZGVUZXh0TGF5ZXIgPSBmYWxzZQogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgY2FudmFzCiAgICB9ID0gdGhpczsKICAgIGlmICghY2FudmFzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG9yaWdpbmFsVmlld3BvcnQgPSB0aGlzLiNvcmlnaW5hbFZpZXdwb3J0OwogICAgaWYgKHRoaXMudmlld3BvcnQgIT09IG9yaWdpbmFsVmlld3BvcnQpIHsKICAgICAgY29uc3QgcmVsYXRpdmVSb3RhdGlvbiA9ICgzNjAgKyB0aGlzLnZpZXdwb3J0LnJvdGF0aW9uIC0gb3JpZ2luYWxWaWV3cG9ydC5yb3RhdGlvbikgJSAzNjA7CiAgICAgIGlmIChyZWxhdGl2ZVJvdGF0aW9uID09PSA5MCB8fCByZWxhdGl2ZVJvdGF0aW9uID09PSAyNzApIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICB3aWR0aCwKICAgICAgICAgIGhlaWdodAogICAgICAgIH0gPSB0aGlzLnZpZXdwb3J0OwogICAgICAgIGNvbnN0IHNjYWxlWCA9IGhlaWdodCAvIHdpZHRoOwogICAgICAgIGNvbnN0IHNjYWxlWSA9IHdpZHRoIC8gaGVpZ2h0OwogICAgICAgIGNhbnZhcy5zdHlsZS50cmFuc2Zvcm0gPSBgcm90YXRlKCR7cmVsYXRpdmVSb3RhdGlvbn1kZWcpIHNjYWxlKCR7c2NhbGVYfSwke3NjYWxlWX0pYDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYW52YXMuc3R5bGUudHJhbnNmb3JtID0gcmVsYXRpdmVSb3RhdGlvbiA9PT0gMCA/ICIiIDogYHJvdGF0ZSgke3JlbGF0aXZlUm90YXRpb259ZGVnKWA7CiAgICAgIH0KICAgIH0KICAgIGlmIChyZWRyYXdBbm5vdGF0aW9uTGF5ZXIgJiYgdGhpcy5hbm5vdGF0aW9uTGF5ZXIpIHsKICAgICAgdGhpcy4jcmVuZGVyQW5ub3RhdGlvbkxheWVyKCk7CiAgICB9CiAgICBpZiAocmVkcmF3QW5ub3RhdGlvbkVkaXRvckxheWVyICYmIHRoaXMuYW5ub3RhdGlvbkVkaXRvckxheWVyKSB7CiAgICAgIGlmICh0aGlzLmRyYXdMYXllcikgewogICAgICAgIHRoaXMuI3JlbmRlckRyYXdMYXllcigpOwogICAgICB9CiAgICAgIHRoaXMuI3JlbmRlckFubm90YXRpb25FZGl0b3JMYXllcigpOwogICAgfQogICAgaWYgKHJlZHJhd1hmYUxheWVyICYmIHRoaXMueGZhTGF5ZXIpIHsKICAgICAgdGhpcy4jcmVuZGVyWGZhTGF5ZXIoKTsKICAgIH0KICAgIGlmICh0aGlzLnRleHRMYXllcikgewogICAgICBpZiAoaGlkZVRleHRMYXllcikgewogICAgICAgIHRoaXMudGV4dExheWVyLmhpZGUoKTsKICAgICAgICB0aGlzLnN0cnVjdFRyZWVMYXllcj8uaGlkZSgpOwogICAgICB9IGVsc2UgaWYgKHJlZHJhd1RleHRMYXllcikgewogICAgICAgIHRoaXMuI3JlbmRlclRleHRMYXllcigpOwogICAgICB9CiAgICB9CiAgfQogIGdldCB3aWR0aCgpIHsKICAgIHJldHVybiB0aGlzLnZpZXdwb3J0LndpZHRoOwogIH0KICBnZXQgaGVpZ2h0KCkgewogICAgcmV0dXJuIHRoaXMudmlld3BvcnQuaGVpZ2h0OwogIH0KICBnZXRQYWdlUG9pbnQoeCwgeSkgewogICAgcmV0dXJuIHRoaXMudmlld3BvcnQuY29udmVydFRvUGRmUG9pbnQoeCwgeSk7CiAgfQogIF9lbnN1cmVDYW52YXNXcmFwcGVyKCkgewogICAgbGV0IGNhbnZhc1dyYXBwZXIgPSB0aGlzLiNjYW52YXNXcmFwcGVyOwogICAgaWYgKCFjYW52YXNXcmFwcGVyKSB7CiAgICAgIGNhbnZhc1dyYXBwZXIgPSB0aGlzLiNjYW52YXNXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGNhbnZhc1dyYXBwZXIuY2xhc3NMaXN0LmFkZCgiY2FudmFzV3JhcHBlciIpOwogICAgICB0aGlzLiNhZGRMYXllcihjYW52YXNXcmFwcGVyLCAiY2FudmFzV3JhcHBlciIpOwogICAgfQogICAgcmV0dXJuIGNhbnZhc1dyYXBwZXI7CiAgfQogIF9nZXRSZW5kZXJpbmdDb250ZXh0KGNhbnZhc0NvbnRleHQsIHRyYW5zZm9ybSkgewogICAgcmV0dXJuIHsKICAgICAgY2FudmFzQ29udGV4dCwKICAgICAgdHJhbnNmb3JtLAogICAgICB2aWV3cG9ydDogdGhpcy52aWV3cG9ydCwKICAgICAgYW5ub3RhdGlvbk1vZGU6IHRoaXMuI2Fubm90YXRpb25Nb2RlLAogICAgICBvcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlOiB0aGlzLl9vcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlLAogICAgICBhbm5vdGF0aW9uQ2FudmFzTWFwOiB0aGlzLl9hbm5vdGF0aW9uQ2FudmFzTWFwLAogICAgICBwYWdlQ29sb3JzOiB0aGlzLnBhZ2VDb2xvcnMsCiAgICAgIGlzRWRpdGluZzogdGhpcy4jaXNFZGl0aW5nCiAgICB9OwogIH0KICBhc3luYyBkcmF3KCkgewogICAgaWYgKHRoaXMucmVuZGVyaW5nU3RhdGUgIT09IFJlbmRlcmluZ1N0YXRlcy5JTklUSUFMKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIk11c3QgYmUgaW4gbmV3IHN0YXRlIGJlZm9yZSBkcmF3aW5nIik7CiAgICAgIHRoaXMucmVzZXQoKTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgZGl2LAogICAgICBsMTBuLAogICAgICBwZGZQYWdlLAogICAgICB2aWV3cG9ydAogICAgfSA9IHRoaXM7CiAgICBpZiAoIXBkZlBhZ2UpIHsKICAgICAgdGhpcy5yZW5kZXJpbmdTdGF0ZSA9IFJlbmRlcmluZ1N0YXRlcy5GSU5JU0hFRDsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJwZGZQYWdlIGlzIG5vdCBsb2FkZWQiKTsKICAgIH0KICAgIHRoaXMucmVuZGVyaW5nU3RhdGUgPSBSZW5kZXJpbmdTdGF0ZXMuUlVOTklORzsKICAgIGNvbnN0IGNhbnZhc1dyYXBwZXIgPSB0aGlzLl9lbnN1cmVDYW52YXNXcmFwcGVyKCk7CiAgICBpZiAoIXRoaXMudGV4dExheWVyICYmIHRoaXMuI3RleHRMYXllck1vZGUgIT09IFRleHRMYXllck1vZGUuRElTQUJMRSAmJiAhcGRmUGFnZS5pc1B1cmVYZmEpIHsKICAgICAgdGhpcy5fYWNjZXNzaWJpbGl0eU1hbmFnZXIgfHw9IG5ldyBUZXh0QWNjZXNzaWJpbGl0eU1hbmFnZXIoKTsKICAgICAgdGhpcy50ZXh0TGF5ZXIgPSBuZXcgVGV4dExheWVyQnVpbGRlcih7CiAgICAgICAgcGRmUGFnZSwKICAgICAgICBoaWdobGlnaHRlcjogdGhpcy5fdGV4dEhpZ2hsaWdodGVyLAogICAgICAgIGFjY2Vzc2liaWxpdHlNYW5hZ2VyOiB0aGlzLl9hY2Nlc3NpYmlsaXR5TWFuYWdlciwKICAgICAgICBlbmFibGVQZXJtaXNzaW9uczogdGhpcy4jdGV4dExheWVyTW9kZSA9PT0gVGV4dExheWVyTW9kZS5FTkFCTEVfUEVSTUlTU0lPTlMsCiAgICAgICAgb25BcHBlbmQ6IHRleHRMYXllckRpdiA9PiB7CiAgICAgICAgICB0aGlzLmwxMG4ucGF1c2UoKTsKICAgICAgICAgIHRoaXMuI2FkZExheWVyKHRleHRMYXllckRpdiwgInRleHRMYXllciIpOwogICAgICAgICAgdGhpcy5sMTBuLnJlc3VtZSgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICBpZiAoIXRoaXMuYW5ub3RhdGlvbkxheWVyICYmIHRoaXMuI2Fubm90YXRpb25Nb2RlICE9PSBBbm5vdGF0aW9uTW9kZS5ESVNBQkxFKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBhbm5vdGF0aW9uU3RvcmFnZSwKICAgICAgICBhbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyLAogICAgICAgIGRvd25sb2FkTWFuYWdlciwKICAgICAgICBlbmFibGVTY3JpcHRpbmcsCiAgICAgICAgZmllbGRPYmplY3RzUHJvbWlzZSwKICAgICAgICBoYXNKU0FjdGlvbnNQcm9taXNlLAogICAgICAgIGxpbmtTZXJ2aWNlCiAgICAgIH0gPSB0aGlzLiNsYXllclByb3BlcnRpZXM7CiAgICAgIHRoaXMuX2Fubm90YXRpb25DYW52YXNNYXAgfHw9IG5ldyBNYXAoKTsKICAgICAgdGhpcy5hbm5vdGF0aW9uTGF5ZXIgPSBuZXcgQW5ub3RhdGlvbkxheWVyQnVpbGRlcih7CiAgICAgICAgcGRmUGFnZSwKICAgICAgICBhbm5vdGF0aW9uU3RvcmFnZSwKICAgICAgICBpbWFnZVJlc291cmNlc1BhdGg6IHRoaXMuaW1hZ2VSZXNvdXJjZXNQYXRoLAogICAgICAgIHJlbmRlckZvcm1zOiB0aGlzLiNhbm5vdGF0aW9uTW9kZSA9PT0gQW5ub3RhdGlvbk1vZGUuRU5BQkxFX0ZPUk1TLAogICAgICAgIGxpbmtTZXJ2aWNlLAogICAgICAgIGRvd25sb2FkTWFuYWdlciwKICAgICAgICBlbmFibGVTY3JpcHRpbmcsCiAgICAgICAgaGFzSlNBY3Rpb25zUHJvbWlzZSwKICAgICAgICBmaWVsZE9iamVjdHNQcm9taXNlLAogICAgICAgIGFubm90YXRpb25DYW52YXNNYXA6IHRoaXMuX2Fubm90YXRpb25DYW52YXNNYXAsCiAgICAgICAgYWNjZXNzaWJpbGl0eU1hbmFnZXI6IHRoaXMuX2FjY2Vzc2liaWxpdHlNYW5hZ2VyLAogICAgICAgIGFubm90YXRpb25FZGl0b3JVSU1hbmFnZXIsCiAgICAgICAgb25BcHBlbmQ6IGFubm90YXRpb25MYXllckRpdiA9PiB7CiAgICAgICAgICB0aGlzLiNhZGRMYXllcihhbm5vdGF0aW9uTGF5ZXJEaXYsICJhbm5vdGF0aW9uTGF5ZXIiKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgY29uc3QgewogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gdmlld3BvcnQ7CiAgICB0aGlzLiNvcmlnaW5hbFZpZXdwb3J0ID0gdmlld3BvcnQ7CiAgICBjb25zdCB7CiAgICAgIGNhbnZhcywKICAgICAgcHJldkNhbnZhcywKICAgICAgY3R4CiAgICB9ID0gdGhpcy5fY3JlYXRlQ2FudmFzKG5ld0NhbnZhcyA9PiB7CiAgICAgIGNhbnZhc1dyYXBwZXIucHJlcGVuZChuZXdDYW52YXMpOwogICAgfSk7CiAgICBjYW52YXMuc2V0QXR0cmlidXRlKCJyb2xlIiwgInByZXNlbnRhdGlvbiIpOwogICAgaWYgKCF0aGlzLm91dHB1dFNjYWxlKSB7CiAgICAgIHRoaXMuI2NvbXB1dGVTY2FsZSgpOwogICAgfQogICAgY29uc3QgewogICAgICBvdXRwdXRTY2FsZQogICAgfSA9IHRoaXM7CiAgICB0aGlzLiNoYXNSZXN0cmljdGVkU2NhbGluZyA9IHRoaXMuI25lZWRzUmVzdHJpY3RlZFNjYWxpbmc7CiAgICBjb25zdCBzZnggPSBhcHByb3hpbWF0ZUZyYWN0aW9uKG91dHB1dFNjYWxlLnN4KTsKICAgIGNvbnN0IHNmeSA9IGFwcHJveGltYXRlRnJhY3Rpb24ob3V0cHV0U2NhbGUuc3kpOwogICAgY29uc3QgY2FudmFzV2lkdGggPSBjYW52YXMud2lkdGggPSBmbG9vclRvRGl2aWRlKGNhbGNSb3VuZCh3aWR0aCAqIG91dHB1dFNjYWxlLnN4KSwgc2Z4WzBdKTsKICAgIGNvbnN0IGNhbnZhc0hlaWdodCA9IGNhbnZhcy5oZWlnaHQgPSBmbG9vclRvRGl2aWRlKGNhbGNSb3VuZChoZWlnaHQgKiBvdXRwdXRTY2FsZS5zeSksIHNmeVswXSk7CiAgICBjb25zdCBwYWdlV2lkdGggPSBmbG9vclRvRGl2aWRlKGNhbGNSb3VuZCh3aWR0aCksIHNmeFsxXSk7CiAgICBjb25zdCBwYWdlSGVpZ2h0ID0gZmxvb3JUb0RpdmlkZShjYWxjUm91bmQoaGVpZ2h0KSwgc2Z5WzFdKTsKICAgIG91dHB1dFNjYWxlLnN4ID0gY2FudmFzV2lkdGggLyBwYWdlV2lkdGg7CiAgICBvdXRwdXRTY2FsZS5zeSA9IGNhbnZhc0hlaWdodCAvIHBhZ2VIZWlnaHQ7CiAgICBpZiAodGhpcy4jc2NhbGVSb3VuZFggIT09IHNmeFsxXSkgewogICAgICBkaXYuc3R5bGUuc2V0UHJvcGVydHkoIi0tc2NhbGUtcm91bmQteCIsIGAke3NmeFsxXX1weGApOwogICAgICB0aGlzLiNzY2FsZVJvdW5kWCA9IHNmeFsxXTsKICAgIH0KICAgIGlmICh0aGlzLiNzY2FsZVJvdW5kWSAhPT0gc2Z5WzFdKSB7CiAgICAgIGRpdi5zdHlsZS5zZXRQcm9wZXJ0eSgiLS1zY2FsZS1yb3VuZC15IiwgYCR7c2Z5WzFdfXB4YCk7CiAgICAgIHRoaXMuI3NjYWxlUm91bmRZID0gc2Z5WzFdOwogICAgfQogICAgY29uc3QgdHJhbnNmb3JtID0gb3V0cHV0U2NhbGUuc2NhbGVkID8gW291dHB1dFNjYWxlLnN4LCAwLCAwLCBvdXRwdXRTY2FsZS5zeSwgMCwgMF0gOiBudWxsOwogICAgY29uc3QgcmVzdWx0UHJvbWlzZSA9IHRoaXMuX2RyYXdDYW52YXModGhpcy5fZ2V0UmVuZGVyaW5nQ29udGV4dChjdHgsIHRyYW5zZm9ybSksICgpID0+IHsKICAgICAgcHJldkNhbnZhcz8ucmVtb3ZlKCk7CiAgICAgIHRoaXMuX3Jlc2V0Q2FudmFzKCk7CiAgICB9LCByZW5kZXJUYXNrID0+IHsKICAgICAgdGhpcy4jdXNlVGh1bWJuYWlsQ2FudmFzLnJlZ3VsYXJBbm5vdGF0aW9ucyA9ICFyZW5kZXJUYXNrLnNlcGFyYXRlQW5ub3RzOwogICAgICB0aGlzLmRpc3BhdGNoUGFnZVJlbmRlcmVkKGZhbHNlLCBmYWxzZSk7CiAgICB9KS50aGVuKGFzeW5jICgpID0+IHsKICAgICAgdGhpcy5zdHJ1Y3RUcmVlTGF5ZXIgfHw9IG5ldyBTdHJ1Y3RUcmVlTGF5ZXJCdWlsZGVyKHBkZlBhZ2UsIHZpZXdwb3J0LnJhd0RpbXMpOwogICAgICBjb25zdCB0ZXh0TGF5ZXJQcm9taXNlID0gdGhpcy4jcmVuZGVyVGV4dExheWVyKCk7CiAgICAgIGlmICh0aGlzLmFubm90YXRpb25MYXllcikgewogICAgICAgIGF3YWl0IHRoaXMuI3JlbmRlckFubm90YXRpb25MYXllcigpOwogICAgICAgIGlmICh0aGlzLiNlbmFibGVBdXRvTGlua2luZyAmJiB0aGlzLmFubm90YXRpb25MYXllciAmJiB0aGlzLnRleHRMYXllcikgewogICAgICAgICAgYXdhaXQgdGhpcy4jaW5qZWN0TGlua0Fubm90YXRpb25zKHRleHRMYXllclByb21pc2UpOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgYW5ub3RhdGlvbkVkaXRvclVJTWFuYWdlcgogICAgICB9ID0gdGhpcy4jbGF5ZXJQcm9wZXJ0aWVzOwogICAgICBpZiAoIWFubm90YXRpb25FZGl0b3JVSU1hbmFnZXIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5kcmF3TGF5ZXIgfHw9IG5ldyBEcmF3TGF5ZXJCdWlsZGVyKHsKICAgICAgICBwYWdlSW5kZXg6IHRoaXMuaWQKICAgICAgfSk7CiAgICAgIGF3YWl0IHRoaXMuI3JlbmRlckRyYXdMYXllcigpOwogICAgICB0aGlzLmRyYXdMYXllci5zZXRQYXJlbnQoY2FudmFzV3JhcHBlcik7CiAgICAgIHRoaXMuYW5ub3RhdGlvbkVkaXRvckxheWVyIHx8PSBuZXcgQW5ub3RhdGlvbkVkaXRvckxheWVyQnVpbGRlcih7CiAgICAgICAgdWlNYW5hZ2VyOiBhbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyLAogICAgICAgIHBkZlBhZ2UsCiAgICAgICAgbDEwbiwKICAgICAgICBzdHJ1Y3RUcmVlTGF5ZXI6IHRoaXMuc3RydWN0VHJlZUxheWVyLAogICAgICAgIGFjY2Vzc2liaWxpdHlNYW5hZ2VyOiB0aGlzLl9hY2Nlc3NpYmlsaXR5TWFuYWdlciwKICAgICAgICBhbm5vdGF0aW9uTGF5ZXI6IHRoaXMuYW5ub3RhdGlvbkxheWVyPy5hbm5vdGF0aW9uTGF5ZXIsCiAgICAgICAgdGV4dExheWVyOiB0aGlzLnRleHRMYXllciwKICAgICAgICBkcmF3TGF5ZXI6IHRoaXMuZHJhd0xheWVyLmdldERyYXdMYXllcigpLAogICAgICAgIG9uQXBwZW5kOiBhbm5vdGF0aW9uRWRpdG9yTGF5ZXJEaXYgPT4gewogICAgICAgICAgdGhpcy4jYWRkTGF5ZXIoYW5ub3RhdGlvbkVkaXRvckxheWVyRGl2LCAiYW5ub3RhdGlvbkVkaXRvckxheWVyIik7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy4jcmVuZGVyQW5ub3RhdGlvbkVkaXRvckxheWVyKCk7CiAgICB9KTsKICAgIGlmIChwZGZQYWdlLmlzUHVyZVhmYSkgewogICAgICBpZiAoIXRoaXMueGZhTGF5ZXIpIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBhbm5vdGF0aW9uU3RvcmFnZSwKICAgICAgICAgIGxpbmtTZXJ2aWNlCiAgICAgICAgfSA9IHRoaXMuI2xheWVyUHJvcGVydGllczsKICAgICAgICB0aGlzLnhmYUxheWVyID0gbmV3IFhmYUxheWVyQnVpbGRlcih7CiAgICAgICAgICBwZGZQYWdlLAogICAgICAgICAgYW5ub3RhdGlvblN0b3JhZ2UsCiAgICAgICAgICBsaW5rU2VydmljZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMuI3JlbmRlclhmYUxheWVyKCk7CiAgICB9CiAgICBkaXYuc2V0QXR0cmlidXRlKCJkYXRhLWxvYWRlZCIsIHRydWUpOwogICAgdGhpcy5kaXNwYXRjaFBhZ2VSZW5kZXIoKTsKICAgIHJldHVybiByZXN1bHRQcm9taXNlOwogIH0KICBzZXRQYWdlTGFiZWwobGFiZWwpIHsKICAgIHRoaXMucGFnZUxhYmVsID0gdHlwZW9mIGxhYmVsID09PSAic3RyaW5nIiA/IGxhYmVsIDogbnVsbDsKICAgIHRoaXMuZGl2LnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWFyZ3MiLCBKU09OLnN0cmluZ2lmeSh7CiAgICAgIHBhZ2U6IHRoaXMucGFnZUxhYmVsID8/IHRoaXMuaWQKICAgIH0pKTsKICAgIGlmICh0aGlzLnBhZ2VMYWJlbCAhPT0gbnVsbCkgewogICAgICB0aGlzLmRpdi5zZXRBdHRyaWJ1dGUoImRhdGEtcGFnZS1sYWJlbCIsIHRoaXMucGFnZUxhYmVsKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGl2LnJlbW92ZUF0dHJpYnV0ZSgiZGF0YS1wYWdlLWxhYmVsIik7CiAgICB9CiAgfQogIGdldCB0aHVtYm5haWxDYW52YXMoKSB7CiAgICBjb25zdCB7CiAgICAgIGRpcmVjdERyYXdpbmcsCiAgICAgIGluaXRpYWxPcHRpb25hbENvbnRlbnQsCiAgICAgIHJlZ3VsYXJBbm5vdGF0aW9ucwogICAgfSA9IHRoaXMuI3VzZVRodW1ibmFpbENhbnZhczsKICAgIHJldHVybiBkaXJlY3REcmF3aW5nICYmIGluaXRpYWxPcHRpb25hbENvbnRlbnQgJiYgcmVndWxhckFubm90YXRpb25zID8gdGhpcy5jYW52YXMgOiBudWxsOwogIH0KfQoKOy8vIC4vd2ViL3BkZl92aWV3ZXIuanMKCgoKCgoKY29uc3QgREVGQVVMVF9DQUNIRV9TSVpFID0gMTA7CmNvbnN0IFBhZ2VzQ291bnRMaW1pdCA9IHsKICBGT1JDRV9TQ1JPTExfTU9ERV9QQUdFOiAxMDAwMCwKICBGT1JDRV9MQVpZX1BBR0VfSU5JVDogNTAwMCwKICBQQVVTRV9FQUdFUl9QQUdFX0lOSVQ6IDI1MAp9OwpmdW5jdGlvbiBpc1ZhbGlkQW5ub3RhdGlvbkVkaXRvck1vZGUobW9kZSkgewogIHJldHVybiBPYmplY3QudmFsdWVzKEFubm90YXRpb25FZGl0b3JUeXBlKS5pbmNsdWRlcyhtb2RlKSAmJiBtb2RlICE9PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ESVNBQkxFOwp9CmNsYXNzIFBERlBhZ2VWaWV3QnVmZmVyIHsKICAjYnVmID0gbmV3IFNldCgpOwogICNzaXplID0gMDsKICBjb25zdHJ1Y3RvcihzaXplKSB7CiAgICB0aGlzLiNzaXplID0gc2l6ZTsKICB9CiAgcHVzaCh2aWV3KSB7CiAgICBjb25zdCBidWYgPSB0aGlzLiNidWY7CiAgICBpZiAoYnVmLmhhcyh2aWV3KSkgewogICAgICBidWYuZGVsZXRlKHZpZXcpOwogICAgfQogICAgYnVmLmFkZCh2aWV3KTsKICAgIGlmIChidWYuc2l6ZSA+IHRoaXMuI3NpemUpIHsKICAgICAgdGhpcy4jZGVzdHJveUZpcnN0VmlldygpOwogICAgfQogIH0KICByZXNpemUobmV3U2l6ZSwgaWRzVG9LZWVwID0gbnVsbCkgewogICAgdGhpcy4jc2l6ZSA9IG5ld1NpemU7CiAgICBjb25zdCBidWYgPSB0aGlzLiNidWY7CiAgICBpZiAoaWRzVG9LZWVwKSB7CiAgICAgIGNvbnN0IGlpID0gYnVmLnNpemU7CiAgICAgIGxldCBpID0gMTsKICAgICAgZm9yIChjb25zdCB2aWV3IG9mIGJ1ZikgewogICAgICAgIGlmIChpZHNUb0tlZXAuaGFzKHZpZXcuaWQpKSB7CiAgICAgICAgICBidWYuZGVsZXRlKHZpZXcpOwogICAgICAgICAgYnVmLmFkZCh2aWV3KTsKICAgICAgICB9CiAgICAgICAgaWYgKCsraSA+IGlpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHdoaWxlIChidWYuc2l6ZSA+IHRoaXMuI3NpemUpIHsKICAgICAgdGhpcy4jZGVzdHJveUZpcnN0VmlldygpOwogICAgfQogIH0KICBoYXModmlldykgewogICAgcmV0dXJuIHRoaXMuI2J1Zi5oYXModmlldyk7CiAgfQogIFtTeW1ib2wuaXRlcmF0b3JdKCkgewogICAgcmV0dXJuIHRoaXMuI2J1Zi5rZXlzKCk7CiAgfQogICNkZXN0cm95Rmlyc3RWaWV3KCkgewogICAgY29uc3QgZmlyc3RWaWV3ID0gdGhpcy4jYnVmLmtleXMoKS5uZXh0KCkudmFsdWU7CiAgICBmaXJzdFZpZXc/LmRlc3Ryb3koKTsKICAgIHRoaXMuI2J1Zi5kZWxldGUoZmlyc3RWaWV3KTsKICB9Cn0KY2xhc3MgUERGVmlld2VyIHsKICAjYnVmZmVyID0gbnVsbDsKICAjYWx0VGV4dE1hbmFnZXIgPSBudWxsOwogICNhbm5vdGF0aW9uRWRpdG9ySGlnaGxpZ2h0Q29sb3JzID0gbnVsbDsKICAjYW5ub3RhdGlvbkVkaXRvck1vZGUgPSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5OT05FOwogICNhbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyID0gbnVsbDsKICAjYW5ub3RhdGlvbk1vZGUgPSBBbm5vdGF0aW9uTW9kZS5FTkFCTEVfRk9STVM7CiAgI2NvbnRhaW5lclRvcExlZnQgPSBudWxsOwogICNlZGl0b3JVbmRvQmFyID0gbnVsbDsKICAjZW5hYmxlSFdBID0gZmFsc2U7CiAgI2VuYWJsZUhpZ2hsaWdodEZsb2F0aW5nQnV0dG9uID0gZmFsc2U7CiAgI2VuYWJsZVBlcm1pc3Npb25zID0gZmFsc2U7CiAgI2VuYWJsZVVwZGF0ZWRBZGRJbWFnZSA9IGZhbHNlOwogICNlbmFibGVOZXdBbHRUZXh0V2hlbkFkZGluZ0ltYWdlID0gZmFsc2U7CiAgI2VuYWJsZUF1dG9MaW5raW5nID0gdHJ1ZTsKICAjZXZlbnRBYm9ydENvbnRyb2xsZXIgPSBudWxsOwogICNtaW5EdXJhdGlvblRvVXBkYXRlQ2FudmFzID0gMDsKICAjbWxNYW5hZ2VyID0gbnVsbDsKICAjc2Nyb2xsVGltZW91dElkID0gbnVsbDsKICAjc3dpdGNoQW5ub3RhdGlvbkVkaXRvck1vZGVBQyA9IG51bGw7CiAgI3N3aXRjaEFubm90YXRpb25FZGl0b3JNb2RlVGltZW91dElkID0gbnVsbDsKICAjZ2V0QWxsVGV4dEluUHJvZ3Jlc3MgPSBmYWxzZTsKICAjaGlkZGVuQ29weUVsZW1lbnQgPSBudWxsOwogICNpbnRlcnJ1cHRDb3B5Q29uZGl0aW9uID0gZmFsc2U7CiAgI3ByZXZpb3VzQ29udGFpbmVySGVpZ2h0ID0gMDsKICAjcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIodGhpcy4jcmVzaXplT2JzZXJ2ZXJDYWxsYmFjay5iaW5kKHRoaXMpKTsKICAjc2Nyb2xsTW9kZVBhZ2VTdGF0ZSA9IG51bGw7CiAgI3NjYWxlVGltZW91dElkID0gbnVsbDsKICAjc2lnbmF0dXJlTWFuYWdlciA9IG51bGw7CiAgI3N1cHBvcnRzUGluY2hUb1pvb20gPSB0cnVlOwogICN0ZXh0TGF5ZXJNb2RlID0gVGV4dExheWVyTW9kZS5FTkFCTEU7CiAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgY29uc3Qgdmlld2VyVmVyc2lvbiA9ICI1LjMuMzEiOwogICAgaWYgKHZlcnNpb24gIT09IHZpZXdlclZlcnNpb24pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgQVBJIHZlcnNpb24gIiR7dmVyc2lvbn0iIGRvZXMgbm90IG1hdGNoIHRoZSBWaWV3ZXIgdmVyc2lvbiAiJHt2aWV3ZXJWZXJzaW9ufSIuYCk7CiAgICB9CiAgICB0aGlzLmNvbnRhaW5lciA9IG9wdGlvbnMuY29udGFpbmVyOwogICAgdGhpcy52aWV3ZXIgPSBvcHRpb25zLnZpZXdlciB8fCBvcHRpb25zLmNvbnRhaW5lci5maXJzdEVsZW1lbnRDaGlsZDsKICAgIGlmICh0aGlzLmNvbnRhaW5lcj8udGFnTmFtZSAhPT0gIkRJViIgfHwgdGhpcy52aWV3ZXI/LnRhZ05hbWUgIT09ICJESVYiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBgY29udGFpbmVyYCBhbmQvb3IgYHZpZXdlcmAgb3B0aW9uLiIpOwogICAgfQogICAgaWYgKHRoaXMuY29udGFpbmVyLm9mZnNldFBhcmVudCAmJiBnZXRDb21wdXRlZFN0eWxlKHRoaXMuY29udGFpbmVyKS5wb3NpdGlvbiAhPT0gImFic29sdXRlIikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBgY29udGFpbmVyYCBtdXN0IGJlIGFic29sdXRlbHkgcG9zaXRpb25lZC4iKTsKICAgIH0KICAgIHRoaXMuI3Jlc2l6ZU9ic2VydmVyLm9ic2VydmUodGhpcy5jb250YWluZXIpOwogICAgdGhpcy5ldmVudEJ1cyA9IG9wdGlvbnMuZXZlbnRCdXM7CiAgICB0aGlzLmxpbmtTZXJ2aWNlID0gb3B0aW9ucy5saW5rU2VydmljZSB8fCBuZXcgU2ltcGxlTGlua1NlcnZpY2UoKTsKICAgIHRoaXMuZG93bmxvYWRNYW5hZ2VyID0gb3B0aW9ucy5kb3dubG9hZE1hbmFnZXIgfHwgbnVsbDsKICAgIHRoaXMuZmluZENvbnRyb2xsZXIgPSBvcHRpb25zLmZpbmRDb250cm9sbGVyIHx8IG51bGw7CiAgICB0aGlzLiNhbHRUZXh0TWFuYWdlciA9IG9wdGlvbnMuYWx0VGV4dE1hbmFnZXIgfHwgbnVsbDsKICAgIHRoaXMuI3NpZ25hdHVyZU1hbmFnZXIgPSBvcHRpb25zLnNpZ25hdHVyZU1hbmFnZXIgfHwgbnVsbDsKICAgIHRoaXMuI2VkaXRvclVuZG9CYXIgPSBvcHRpb25zLmVkaXRvclVuZG9CYXIgfHwgbnVsbDsKICAgIGlmICh0aGlzLmZpbmRDb250cm9sbGVyKSB7CiAgICAgIHRoaXMuZmluZENvbnRyb2xsZXIub25Jc1BhZ2VWaXNpYmxlID0gcGFnZU51bWJlciA9PiB0aGlzLl9nZXRWaXNpYmxlUGFnZXMoKS5pZHMuaGFzKHBhZ2VOdW1iZXIpOwogICAgfQogICAgdGhpcy5fc2NyaXB0aW5nTWFuYWdlciA9IG9wdGlvbnMuc2NyaXB0aW5nTWFuYWdlciB8fCBudWxsOwogICAgdGhpcy4jdGV4dExheWVyTW9kZSA9IG9wdGlvbnMudGV4dExheWVyTW9kZSA/PyBUZXh0TGF5ZXJNb2RlLkVOQUJMRTsKICAgIHRoaXMuI2Fubm90YXRpb25Nb2RlID0gb3B0aW9ucy5hbm5vdGF0aW9uTW9kZSA/PyBBbm5vdGF0aW9uTW9kZS5FTkFCTEVfRk9STVM7CiAgICB0aGlzLiNhbm5vdGF0aW9uRWRpdG9yTW9kZSA9IG9wdGlvbnMuYW5ub3RhdGlvbkVkaXRvck1vZGUgPz8gQW5ub3RhdGlvbkVkaXRvclR5cGUuTk9ORTsKICAgIHRoaXMuI2Fubm90YXRpb25FZGl0b3JIaWdobGlnaHRDb2xvcnMgPSBvcHRpb25zLmFubm90YXRpb25FZGl0b3JIaWdobGlnaHRDb2xvcnMgfHwgbnVsbDsKICAgIHRoaXMuI2VuYWJsZUhpZ2hsaWdodEZsb2F0aW5nQnV0dG9uID0gb3B0aW9ucy5lbmFibGVIaWdobGlnaHRGbG9hdGluZ0J1dHRvbiA9PT0gdHJ1ZTsKICAgIHRoaXMuI2VuYWJsZVVwZGF0ZWRBZGRJbWFnZSA9IG9wdGlvbnMuZW5hYmxlVXBkYXRlZEFkZEltYWdlID09PSB0cnVlOwogICAgdGhpcy4jZW5hYmxlTmV3QWx0VGV4dFdoZW5BZGRpbmdJbWFnZSA9IG9wdGlvbnMuZW5hYmxlTmV3QWx0VGV4dFdoZW5BZGRpbmdJbWFnZSA9PT0gdHJ1ZTsKICAgIHRoaXMuaW1hZ2VSZXNvdXJjZXNQYXRoID0gb3B0aW9ucy5pbWFnZVJlc291cmNlc1BhdGggfHwgIiI7CiAgICB0aGlzLmVuYWJsZVByaW50QXV0b1JvdGF0ZSA9IG9wdGlvbnMuZW5hYmxlUHJpbnRBdXRvUm90YXRlIHx8IGZhbHNlOwogICAgdGhpcy5yZW1vdmVQYWdlQm9yZGVycyA9IG9wdGlvbnMucmVtb3ZlUGFnZUJvcmRlcnMgfHwgZmFsc2U7CiAgICB0aGlzLm1heENhbnZhc1BpeGVscyA9IG9wdGlvbnMubWF4Q2FudmFzUGl4ZWxzOwogICAgdGhpcy5tYXhDYW52YXNEaW0gPSBvcHRpb25zLm1heENhbnZhc0RpbTsKICAgIHRoaXMuY2FwQ2FudmFzQXJlYUZhY3RvciA9IG9wdGlvbnMuY2FwQ2FudmFzQXJlYUZhY3RvcjsKICAgIHRoaXMuZW5hYmxlRGV0YWlsQ2FudmFzID0gb3B0aW9ucy5lbmFibGVEZXRhaWxDYW52YXMgPz8gdHJ1ZTsKICAgIHRoaXMubDEwbiA9IG9wdGlvbnMubDEwbjsKICAgIHRoaXMubDEwbiB8fD0gbmV3IGdlbmVyaWNsMTBuX0dlbmVyaWNMMTBuKCk7CiAgICB0aGlzLiNlbmFibGVQZXJtaXNzaW9ucyA9IG9wdGlvbnMuZW5hYmxlUGVybWlzc2lvbnMgfHwgZmFsc2U7CiAgICB0aGlzLnBhZ2VDb2xvcnMgPSBvcHRpb25zLnBhZ2VDb2xvcnMgfHwgbnVsbDsKICAgIHRoaXMuI21sTWFuYWdlciA9IG9wdGlvbnMubWxNYW5hZ2VyIHx8IG51bGw7CiAgICB0aGlzLiNlbmFibGVIV0EgPSBvcHRpb25zLmVuYWJsZUhXQSB8fCBmYWxzZTsKICAgIHRoaXMuI3N1cHBvcnRzUGluY2hUb1pvb20gPSBvcHRpb25zLnN1cHBvcnRzUGluY2hUb1pvb20gIT09IGZhbHNlOwogICAgdGhpcy4jZW5hYmxlQXV0b0xpbmtpbmcgPSBvcHRpb25zLmVuYWJsZUF1dG9MaW5raW5nICE9PSBmYWxzZTsKICAgIHRoaXMuI21pbkR1cmF0aW9uVG9VcGRhdGVDYW52YXMgPSBvcHRpb25zLm1pbkR1cmF0aW9uVG9VcGRhdGVDYW52YXMgPz8gNTAwOwogICAgdGhpcy5kZWZhdWx0UmVuZGVyaW5nUXVldWUgPSAhb3B0aW9ucy5yZW5kZXJpbmdRdWV1ZTsKICAgIGlmICh0aGlzLmRlZmF1bHRSZW5kZXJpbmdRdWV1ZSkgewogICAgICB0aGlzLnJlbmRlcmluZ1F1ZXVlID0gbmV3IFBERlJlbmRlcmluZ1F1ZXVlKCk7CiAgICAgIHRoaXMucmVuZGVyaW5nUXVldWUuc2V0Vmlld2VyKHRoaXMpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5yZW5kZXJpbmdRdWV1ZSA9IG9wdGlvbnMucmVuZGVyaW5nUXVldWU7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGFib3J0U2lnbmFsCiAgICB9ID0gb3B0aW9uczsKICAgIGFib3J0U2lnbmFsPy5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsICgpID0+IHsKICAgICAgdGhpcy4jcmVzaXplT2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgICB0aGlzLiNyZXNpemVPYnNlcnZlciA9IG51bGw7CiAgICB9LCB7CiAgICAgIG9uY2U6IHRydWUKICAgIH0pOwogICAgdGhpcy5zY3JvbGwgPSB3YXRjaFNjcm9sbCh0aGlzLmNvbnRhaW5lciwgdGhpcy5fc2Nyb2xsVXBkYXRlLmJpbmQodGhpcyksIGFib3J0U2lnbmFsKTsKICAgIHRoaXMucHJlc2VudGF0aW9uTW9kZVN0YXRlID0gUHJlc2VudGF0aW9uTW9kZVN0YXRlLlVOS05PV047CiAgICB0aGlzLl9yZXNldFZpZXcoKTsKICAgIGlmICh0aGlzLnJlbW92ZVBhZ2VCb3JkZXJzKSB7CiAgICAgIHRoaXMudmlld2VyLmNsYXNzTGlzdC5hZGQoInJlbW92ZVBhZ2VCb3JkZXJzIik7CiAgICB9CiAgICB0aGlzLiN1cGRhdGVDb250YWluZXJIZWlnaHRDc3MoKTsKICAgIHRoaXMuZXZlbnRCdXMuX29uKCJ0aHVtYm5haWxyZW5kZXJlZCIsICh7CiAgICAgIHBhZ2VOdW1iZXIsCiAgICAgIHBkZlBhZ2UKICAgIH0pID0+IHsKICAgICAgY29uc3QgcGFnZVZpZXcgPSB0aGlzLl9wYWdlc1twYWdlTnVtYmVyIC0gMV07CiAgICAgIGlmICghdGhpcy4jYnVmZmVyLmhhcyhwYWdlVmlldykpIHsKICAgICAgICBwZGZQYWdlPy5jbGVhbnVwKCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFvcHRpb25zLmwxMG4pIHsKICAgICAgdGhpcy5sMTBuLnRyYW5zbGF0ZSh0aGlzLmNvbnRhaW5lcik7CiAgICB9CiAgfQogIGdldCBwYWdlc0NvdW50KCkgewogICAgcmV0dXJuIHRoaXMuX3BhZ2VzLmxlbmd0aDsKICB9CiAgZ2V0UGFnZVZpZXcoaW5kZXgpIHsKICAgIHJldHVybiB0aGlzLl9wYWdlc1tpbmRleF07CiAgfQogIGdldENhY2hlZFBhZ2VWaWV3cygpIHsKICAgIHJldHVybiBuZXcgU2V0KHRoaXMuI2J1ZmZlcik7CiAgfQogIGdldCBwYWdlVmlld3NSZWFkeSgpIHsKICAgIHJldHVybiB0aGlzLl9wYWdlcy5ldmVyeShwYWdlVmlldyA9PiBwYWdlVmlldz8ucGRmUGFnZSk7CiAgfQogIGdldCByZW5kZXJGb3JtcygpIHsKICAgIHJldHVybiB0aGlzLiNhbm5vdGF0aW9uTW9kZSA9PT0gQW5ub3RhdGlvbk1vZGUuRU5BQkxFX0ZPUk1TOwogIH0KICBnZXQgZW5hYmxlU2NyaXB0aW5nKCkgewogICAgcmV0dXJuICEhdGhpcy5fc2NyaXB0aW5nTWFuYWdlcjsKICB9CiAgZ2V0IGN1cnJlbnRQYWdlTnVtYmVyKCkgewogICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRQYWdlTnVtYmVyOwogIH0KICBzZXQgY3VycmVudFBhZ2VOdW1iZXIodmFsKSB7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIodmFsKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcGFnZSBudW1iZXIuIik7CiAgICB9CiAgICBpZiAoIXRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzLl9zZXRDdXJyZW50UGFnZU51bWJlcih2YWwsIHRydWUpKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoYGN1cnJlbnRQYWdlTnVtYmVyOiAiJHt2YWx9IiBpcyBub3QgYSB2YWxpZCBwYWdlLmApOwogICAgfQogIH0KICBfc2V0Q3VycmVudFBhZ2VOdW1iZXIodmFsLCByZXNldEN1cnJlbnRQYWdlVmlldyA9IGZhbHNlKSB7CiAgICBpZiAodGhpcy5fY3VycmVudFBhZ2VOdW1iZXIgPT09IHZhbCkgewogICAgICBpZiAocmVzZXRDdXJyZW50UGFnZVZpZXcpIHsKICAgICAgICB0aGlzLiNyZXNldEN1cnJlbnRQYWdlVmlldygpOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKCEoMCA8IHZhbCAmJiB2YWwgPD0gdGhpcy5wYWdlc0NvdW50KSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCBwcmV2aW91cyA9IHRoaXMuX2N1cnJlbnRQYWdlTnVtYmVyOwogICAgdGhpcy5fY3VycmVudFBhZ2VOdW1iZXIgPSB2YWw7CiAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJwYWdlY2hhbmdpbmciLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgcGFnZU51bWJlcjogdmFsLAogICAgICBwYWdlTGFiZWw6IHRoaXMuX3BhZ2VMYWJlbHM/Llt2YWwgLSAxXSA/PyBudWxsLAogICAgICBwcmV2aW91cwogICAgfSk7CiAgICBpZiAocmVzZXRDdXJyZW50UGFnZVZpZXcpIHsKICAgICAgdGhpcy4jcmVzZXRDdXJyZW50UGFnZVZpZXcoKTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBnZXQgY3VycmVudFBhZ2VMYWJlbCgpIHsKICAgIHJldHVybiB0aGlzLl9wYWdlTGFiZWxzPy5bdGhpcy5fY3VycmVudFBhZ2VOdW1iZXIgLSAxXSA/PyBudWxsOwogIH0KICBzZXQgY3VycmVudFBhZ2VMYWJlbCh2YWwpIHsKICAgIGlmICghdGhpcy5wZGZEb2N1bWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgcGFnZSA9IHZhbCB8IDA7CiAgICBpZiAodGhpcy5fcGFnZUxhYmVscykgewogICAgICBjb25zdCBpID0gdGhpcy5fcGFnZUxhYmVscy5pbmRleE9mKHZhbCk7CiAgICAgIGlmIChpID49IDApIHsKICAgICAgICBwYWdlID0gaSArIDE7CiAgICAgIH0KICAgIH0KICAgIGlmICghdGhpcy5fc2V0Q3VycmVudFBhZ2VOdW1iZXIocGFnZSwgdHJ1ZSkpIHsKICAgICAgY29uc29sZS5lcnJvcihgY3VycmVudFBhZ2VMYWJlbDogIiR7dmFsfSIgaXMgbm90IGEgdmFsaWQgcGFnZS5gKTsKICAgIH0KICB9CiAgZ2V0IGN1cnJlbnRTY2FsZSgpIHsKICAgIHJldHVybiB0aGlzLl9jdXJyZW50U2NhbGUgIT09IFVOS05PV05fU0NBTEUgPyB0aGlzLl9jdXJyZW50U2NhbGUgOiBERUZBVUxUX1NDQUxFOwogIH0KICBzZXQgY3VycmVudFNjYWxlKHZhbCkgewogICAgaWYgKGlzTmFOKHZhbCkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIG51bWVyaWMgc2NhbGUuIik7CiAgICB9CiAgICBpZiAoIXRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jc2V0U2NhbGUodmFsLCB7CiAgICAgIG5vU2Nyb2xsOiBmYWxzZQogICAgfSk7CiAgfQogIGdldCBjdXJyZW50U2NhbGVWYWx1ZSgpIHsKICAgIHJldHVybiB0aGlzLl9jdXJyZW50U2NhbGVWYWx1ZTsKICB9CiAgc2V0IGN1cnJlbnRTY2FsZVZhbHVlKHZhbCkgewogICAgaWYgKCF0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI3NldFNjYWxlKHZhbCwgewogICAgICBub1Njcm9sbDogZmFsc2UKICAgIH0pOwogIH0KICBnZXQgcGFnZXNSb3RhdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl9wYWdlc1JvdGF0aW9uOwogIH0KICBzZXQgcGFnZXNSb3RhdGlvbihyb3RhdGlvbikgewogICAgaWYgKCFpc1ZhbGlkUm90YXRpb24ocm90YXRpb24pKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwYWdlcyByb3RhdGlvbiBhbmdsZS4iKTsKICAgIH0KICAgIGlmICghdGhpcy5wZGZEb2N1bWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICByb3RhdGlvbiAlPSAzNjA7CiAgICBpZiAocm90YXRpb24gPCAwKSB7CiAgICAgIHJvdGF0aW9uICs9IDM2MDsKICAgIH0KICAgIGlmICh0aGlzLl9wYWdlc1JvdGF0aW9uID09PSByb3RhdGlvbikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9wYWdlc1JvdGF0aW9uID0gcm90YXRpb247CiAgICBjb25zdCBwYWdlTnVtYmVyID0gdGhpcy5fY3VycmVudFBhZ2VOdW1iZXI7CiAgICB0aGlzLnJlZnJlc2godHJ1ZSwgewogICAgICByb3RhdGlvbgogICAgfSk7CiAgICBpZiAodGhpcy5fY3VycmVudFNjYWxlVmFsdWUpIHsKICAgICAgdGhpcy4jc2V0U2NhbGUodGhpcy5fY3VycmVudFNjYWxlVmFsdWUsIHsKICAgICAgICBub1Njcm9sbDogdHJ1ZQogICAgICB9KTsKICAgIH0KICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goInJvdGF0aW9uY2hhbmdpbmciLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgcGFnZXNSb3RhdGlvbjogcm90YXRpb24sCiAgICAgIHBhZ2VOdW1iZXIKICAgIH0pOwogICAgaWYgKHRoaXMuZGVmYXVsdFJlbmRlcmluZ1F1ZXVlKSB7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CiAgfQogIGdldCBmaXJzdFBhZ2VQcm9taXNlKCkgewogICAgcmV0dXJuIHRoaXMucGRmRG9jdW1lbnQgPyB0aGlzLl9maXJzdFBhZ2VDYXBhYmlsaXR5LnByb21pc2UgOiBudWxsOwogIH0KICBnZXQgb25lUGFnZVJlbmRlcmVkKCkgewogICAgcmV0dXJuIHRoaXMucGRmRG9jdW1lbnQgPyB0aGlzLl9vbmVQYWdlUmVuZGVyZWRDYXBhYmlsaXR5LnByb21pc2UgOiBudWxsOwogIH0KICBnZXQgcGFnZXNQcm9taXNlKCkgewogICAgcmV0dXJuIHRoaXMucGRmRG9jdW1lbnQgPyB0aGlzLl9wYWdlc0NhcGFiaWxpdHkucHJvbWlzZSA6IG51bGw7CiAgfQogIGdldCBfbGF5ZXJQcm9wZXJ0aWVzKCkgewogICAgY29uc3Qgc2VsZiA9IHRoaXM7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfbGF5ZXJQcm9wZXJ0aWVzIiwgewogICAgICBnZXQgYW5ub3RhdGlvbkVkaXRvclVJTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gc2VsZi4jYW5ub3RhdGlvbkVkaXRvclVJTWFuYWdlcjsKICAgICAgfSwKICAgICAgZ2V0IGFubm90YXRpb25TdG9yYWdlKCkgewogICAgICAgIHJldHVybiBzZWxmLnBkZkRvY3VtZW50Py5hbm5vdGF0aW9uU3RvcmFnZTsKICAgICAgfSwKICAgICAgZ2V0IGRvd25sb2FkTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gc2VsZi5kb3dubG9hZE1hbmFnZXI7CiAgICAgIH0sCiAgICAgIGdldCBlbmFibGVTY3JpcHRpbmcoKSB7CiAgICAgICAgcmV0dXJuICEhc2VsZi5fc2NyaXB0aW5nTWFuYWdlcjsKICAgICAgfSwKICAgICAgZ2V0IGZpZWxkT2JqZWN0c1Byb21pc2UoKSB7CiAgICAgICAgcmV0dXJuIHNlbGYucGRmRG9jdW1lbnQ/LmdldEZpZWxkT2JqZWN0cygpOwogICAgICB9LAogICAgICBnZXQgZmluZENvbnRyb2xsZXIoKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuZmluZENvbnRyb2xsZXI7CiAgICAgIH0sCiAgICAgIGdldCBoYXNKU0FjdGlvbnNQcm9taXNlKCkgewogICAgICAgIHJldHVybiBzZWxmLnBkZkRvY3VtZW50Py5oYXNKU0FjdGlvbnMoKTsKICAgICAgfSwKICAgICAgZ2V0IGxpbmtTZXJ2aWNlKCkgewogICAgICAgIHJldHVybiBzZWxmLmxpbmtTZXJ2aWNlOwogICAgICB9CiAgICB9KTsKICB9CiAgI2luaXRpYWxpemVQZXJtaXNzaW9ucyhwZXJtaXNzaW9ucykgewogICAgY29uc3QgcGFyYW1zID0gewogICAgICBhbm5vdGF0aW9uRWRpdG9yTW9kZTogdGhpcy4jYW5ub3RhdGlvbkVkaXRvck1vZGUsCiAgICAgIGFubm90YXRpb25Nb2RlOiB0aGlzLiNhbm5vdGF0aW9uTW9kZSwKICAgICAgdGV4dExheWVyTW9kZTogdGhpcy4jdGV4dExheWVyTW9kZQogICAgfTsKICAgIGlmICghcGVybWlzc2lvbnMpIHsKICAgICAgcmV0dXJuIHBhcmFtczsKICAgIH0KICAgIGlmICghcGVybWlzc2lvbnMuaW5jbHVkZXMoUGVybWlzc2lvbkZsYWcuQ09QWSkgJiYgdGhpcy4jdGV4dExheWVyTW9kZSA9PT0gVGV4dExheWVyTW9kZS5FTkFCTEUpIHsKICAgICAgcGFyYW1zLnRleHRMYXllck1vZGUgPSBUZXh0TGF5ZXJNb2RlLkVOQUJMRV9QRVJNSVNTSU9OUzsKICAgIH0KICAgIGlmICghcGVybWlzc2lvbnMuaW5jbHVkZXMoUGVybWlzc2lvbkZsYWcuTU9ESUZZX0NPTlRFTlRTKSkgewogICAgICBwYXJhbXMuYW5ub3RhdGlvbkVkaXRvck1vZGUgPSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ESVNBQkxFOwogICAgfQogICAgaWYgKCFwZXJtaXNzaW9ucy5pbmNsdWRlcyhQZXJtaXNzaW9uRmxhZy5NT0RJRllfQU5OT1RBVElPTlMpICYmICFwZXJtaXNzaW9ucy5pbmNsdWRlcyhQZXJtaXNzaW9uRmxhZy5GSUxMX0lOVEVSQUNUSVZFX0ZPUk1TKSAmJiB0aGlzLiNhbm5vdGF0aW9uTW9kZSA9PT0gQW5ub3RhdGlvbk1vZGUuRU5BQkxFX0ZPUk1TKSB7CiAgICAgIHBhcmFtcy5hbm5vdGF0aW9uTW9kZSA9IEFubm90YXRpb25Nb2RlLkVOQUJMRTsKICAgIH0KICAgIHJldHVybiBwYXJhbXM7CiAgfQogIGFzeW5jICNvbmVQYWdlUmVuZGVyZWRPckZvcmNlRmV0Y2goc2lnbmFsKSB7CiAgICBpZiAoZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlID09PSAiaGlkZGVuIiB8fCAhdGhpcy5jb250YWluZXIub2Zmc2V0UGFyZW50IHx8IHRoaXMuX2dldFZpc2libGVQYWdlcygpLnZpZXdzLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBoaWRkZW5DYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCksCiAgICAgIGFjID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigidmlzaWJpbGl0eWNoYW5nZSIsICgpID0+IHsKICAgICAgaWYgKGRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSA9PT0gImhpZGRlbiIpIHsKICAgICAgICBoaWRkZW5DYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgfQogICAgfSwgewogICAgICBzaWduYWw6IEFib3J0U2lnbmFsLmFueShbc2lnbmFsLCBhYy5zaWduYWxdKQogICAgfSk7CiAgICBhd2FpdCBQcm9taXNlLnJhY2UoW3RoaXMuX29uZVBhZ2VSZW5kZXJlZENhcGFiaWxpdHkucHJvbWlzZSwgaGlkZGVuQ2FwYWJpbGl0eS5wcm9taXNlXSk7CiAgICBhYy5hYm9ydCgpOwogIH0KICBhc3luYyBnZXRBbGxUZXh0KCkgewogICAgY29uc3QgdGV4dHMgPSBbXTsKICAgIGNvbnN0IGJ1ZmZlciA9IFtdOwogICAgZm9yIChsZXQgcGFnZU51bSA9IDEsIHBhZ2VzQ291bnQgPSB0aGlzLnBkZkRvY3VtZW50Lm51bVBhZ2VzOyBwYWdlTnVtIDw9IHBhZ2VzQ291bnQ7ICsrcGFnZU51bSkgewogICAgICBpZiAodGhpcy4jaW50ZXJydXB0Q29weUNvbmRpdGlvbikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgICBjb25zdCBwYWdlID0gYXdhaXQgdGhpcy5wZGZEb2N1bWVudC5nZXRQYWdlKHBhZ2VOdW0pOwogICAgICBjb25zdCB7CiAgICAgICAgaXRlbXMKICAgICAgfSA9IGF3YWl0IHBhZ2UuZ2V0VGV4dENvbnRlbnQoKTsKICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7CiAgICAgICAgaWYgKGl0ZW0uc3RyKSB7CiAgICAgICAgICBidWZmZXIucHVzaChpdGVtLnN0cik7CiAgICAgICAgfQogICAgICAgIGlmIChpdGVtLmhhc0VPTCkgewogICAgICAgICAgYnVmZmVyLnB1c2goIlxuIik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRleHRzLnB1c2gocmVtb3ZlTnVsbENoYXJhY3RlcnMoYnVmZmVyLmpvaW4oIiIpKSk7CiAgICB9CiAgICByZXR1cm4gdGV4dHMuam9pbigiXG4iKTsKICB9CiAgI2NvcHlDYWxsYmFjayh0ZXh0TGF5ZXJNb2RlLCBldmVudCkgewogICAgY29uc3Qgc2VsZWN0aW9uID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCk7CiAgICBjb25zdCB7CiAgICAgIGZvY3VzTm9kZSwKICAgICAgYW5jaG9yTm9kZQogICAgfSA9IHNlbGVjdGlvbjsKICAgIGlmIChhbmNob3JOb2RlICYmIGZvY3VzTm9kZSAmJiBzZWxlY3Rpb24uY29udGFpbnNOb2RlKHRoaXMuI2hpZGRlbkNvcHlFbGVtZW50KSkgewogICAgICBpZiAodGhpcy4jZ2V0QWxsVGV4dEluUHJvZ3Jlc3MgfHwgdGV4dExheWVyTW9kZSA9PT0gVGV4dExheWVyTW9kZS5FTkFCTEVfUEVSTUlTU0lPTlMpIHsKICAgICAgICBzdG9wRXZlbnQoZXZlbnQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLiNnZXRBbGxUZXh0SW5Qcm9ncmVzcyA9IHRydWU7CiAgICAgIGNvbnN0IHsKICAgICAgICBjbGFzc0xpc3QKICAgICAgfSA9IHRoaXMudmlld2VyOwogICAgICBjbGFzc0xpc3QuYWRkKCJjb3B5QWxsIik7CiAgICAgIGNvbnN0IGFjID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGV2ID0+IHRoaXMuI2ludGVycnVwdENvcHlDb25kaXRpb24gPSBldi5rZXkgPT09ICJFc2NhcGUiLCB7CiAgICAgICAgc2lnbmFsOiBhYy5zaWduYWwKICAgICAgfSk7CiAgICAgIHRoaXMuZ2V0QWxsVGV4dCgpLnRoZW4oYXN5bmMgdGV4dCA9PiB7CiAgICAgICAgaWYgKHRleHQgIT09IG51bGwpIHsKICAgICAgICAgIGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHRleHQpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgICBjb25zb2xlLndhcm4oYFNvbWV0aGluZyBnb2VzIHdyb25nIHdoZW4gZXh0cmFjdGluZyB0aGUgdGV4dDogJHtyZWFzb24ubWVzc2FnZX1gKTsKICAgICAgfSkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgdGhpcy4jZ2V0QWxsVGV4dEluUHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgICB0aGlzLiNpbnRlcnJ1cHRDb3B5Q29uZGl0aW9uID0gZmFsc2U7CiAgICAgICAgYWMuYWJvcnQoKTsKICAgICAgICBjbGFzc0xpc3QucmVtb3ZlKCJjb3B5QWxsIik7CiAgICAgIH0pOwogICAgICBzdG9wRXZlbnQoZXZlbnQpOwogICAgfQogIH0KICBzZXREb2N1bWVudChwZGZEb2N1bWVudCkgewogICAgaWYgKHRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgdGhpcy5ldmVudEJ1cy5kaXNwYXRjaCgicGFnZXNkZXN0cm95IiwgewogICAgICAgIHNvdXJjZTogdGhpcwogICAgICB9KTsKICAgICAgdGhpcy5fY2FuY2VsUmVuZGVyaW5nKCk7CiAgICAgIHRoaXMuX3Jlc2V0VmlldygpOwogICAgICB0aGlzLmZpbmRDb250cm9sbGVyPy5zZXREb2N1bWVudChudWxsKTsKICAgICAgdGhpcy5fc2NyaXB0aW5nTWFuYWdlcj8uc2V0RG9jdW1lbnQobnVsbCk7CiAgICAgIHRoaXMuI2Fubm90YXRpb25FZGl0b3JVSU1hbmFnZXI/LmRlc3Ryb3koKTsKICAgICAgdGhpcy4jYW5ub3RhdGlvbkVkaXRvclVJTWFuYWdlciA9IG51bGw7CiAgICB9CiAgICB0aGlzLnBkZkRvY3VtZW50ID0gcGRmRG9jdW1lbnQ7CiAgICBpZiAoIXBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBhZ2VzQ291bnQgPSBwZGZEb2N1bWVudC5udW1QYWdlczsKICAgIGNvbnN0IGZpcnN0UGFnZVByb21pc2UgPSBwZGZEb2N1bWVudC5nZXRQYWdlKDEpOwogICAgY29uc3Qgb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZSA9IHBkZkRvY3VtZW50LmdldE9wdGlvbmFsQ29udGVudENvbmZpZyh7CiAgICAgIGludGVudDogImRpc3BsYXkiCiAgICB9KTsKICAgIGNvbnN0IHBlcm1pc3Npb25zUHJvbWlzZSA9IHRoaXMuI2VuYWJsZVBlcm1pc3Npb25zID8gcGRmRG9jdW1lbnQuZ2V0UGVybWlzc2lvbnMoKSA6IFByb21pc2UucmVzb2x2ZSgpOwogICAgY29uc3QgewogICAgICBldmVudEJ1cywKICAgICAgcGFnZUNvbG9ycywKICAgICAgdmlld2VyCiAgICB9ID0gdGhpczsKICAgIHRoaXMuI2V2ZW50QWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgY29uc3QgewogICAgICBzaWduYWwKICAgIH0gPSB0aGlzLiNldmVudEFib3J0Q29udHJvbGxlcjsKICAgIGlmIChwYWdlc0NvdW50ID4gUGFnZXNDb3VudExpbWl0LkZPUkNFX1NDUk9MTF9NT0RFX1BBR0UpIHsKICAgICAgY29uc29sZS53YXJuKCJGb3JjaW5nIFBBR0Utc2Nyb2xsaW5nIGZvciBwZXJmb3JtYW5jZSByZWFzb25zLCBnaXZlbiB0aGUgbGVuZ3RoIG9mIHRoZSBkb2N1bWVudC4iKTsKICAgICAgY29uc3QgbW9kZSA9IHRoaXMuX3Njcm9sbE1vZGUgPSBTY3JvbGxNb2RlLlBBR0U7CiAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKCJzY3JvbGxtb2RlY2hhbmdlZCIsIHsKICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgbW9kZQogICAgICB9KTsKICAgIH0KICAgIHRoaXMuX3BhZ2VzQ2FwYWJpbGl0eS5wcm9taXNlLnRoZW4oKCkgPT4gewogICAgICBldmVudEJ1cy5kaXNwYXRjaCgicGFnZXNsb2FkZWQiLCB7CiAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgIHBhZ2VzQ291bnQKICAgICAgfSk7CiAgICB9LCAoKSA9PiB7fSk7CiAgICBjb25zdCBvbkJlZm9yZURyYXcgPSBldnQgPT4gewogICAgICBjb25zdCBwYWdlVmlldyA9IHRoaXMuX3BhZ2VzW2V2dC5wYWdlTnVtYmVyIC0gMV07CiAgICAgIGlmICghcGFnZVZpZXcpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy4jYnVmZmVyLnB1c2gocGFnZVZpZXcpOwogICAgfTsKICAgIGV2ZW50QnVzLl9vbigicGFnZXJlbmRlciIsIG9uQmVmb3JlRHJhdywgewogICAgICBzaWduYWwKICAgIH0pOwogICAgY29uc3Qgb25BZnRlckRyYXcgPSBldnQgPT4gewogICAgICBpZiAoZXZ0LmNzc1RyYW5zZm9ybSB8fCBldnQuaXNEZXRhaWxWaWV3KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuX29uZVBhZ2VSZW5kZXJlZENhcGFiaWxpdHkucmVzb2x2ZSh7CiAgICAgICAgdGltZXN0YW1wOiBldnQudGltZXN0YW1wCiAgICAgIH0pOwogICAgICBldmVudEJ1cy5fb2ZmKCJwYWdlcmVuZGVyZWQiLCBvbkFmdGVyRHJhdyk7CiAgICB9OwogICAgZXZlbnRCdXMuX29uKCJwYWdlcmVuZGVyZWQiLCBvbkFmdGVyRHJhdywgewogICAgICBzaWduYWwKICAgIH0pOwogICAgUHJvbWlzZS5hbGwoW2ZpcnN0UGFnZVByb21pc2UsIHBlcm1pc3Npb25zUHJvbWlzZV0pLnRoZW4oKFtmaXJzdFBkZlBhZ2UsIHBlcm1pc3Npb25zXSkgPT4gewogICAgICBpZiAocGRmRG9jdW1lbnQgIT09IHRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5fZmlyc3RQYWdlQ2FwYWJpbGl0eS5yZXNvbHZlKGZpcnN0UGRmUGFnZSk7CiAgICAgIHRoaXMuX29wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UgPSBvcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlOwogICAgICBjb25zdCB7CiAgICAgICAgYW5ub3RhdGlvbkVkaXRvck1vZGUsCiAgICAgICAgYW5ub3RhdGlvbk1vZGUsCiAgICAgICAgdGV4dExheWVyTW9kZQogICAgICB9ID0gdGhpcy4jaW5pdGlhbGl6ZVBlcm1pc3Npb25zKHBlcm1pc3Npb25zKTsKICAgICAgaWYgKHRleHRMYXllck1vZGUgIT09IFRleHRMYXllck1vZGUuRElTQUJMRSkgewogICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLiNoaWRkZW5Db3B5RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIGVsZW1lbnQuaWQgPSAiaGlkZGVuQ29weUVsZW1lbnQiOwogICAgICAgIHZpZXdlci5iZWZvcmUoZWxlbWVudCk7CiAgICAgIH0KICAgICAgaWYgKGFubm90YXRpb25FZGl0b3JNb2RlICE9PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ESVNBQkxFKSB7CiAgICAgICAgY29uc3QgbW9kZSA9IGFubm90YXRpb25FZGl0b3JNb2RlOwogICAgICAgIGlmIChwZGZEb2N1bWVudC5pc1B1cmVYZmEpIHsKICAgICAgICAgIGNvbnNvbGUud2FybigiV2FybmluZzogWEZBLWVkaXRpbmcgaXMgbm90IGltcGxlbWVudGVkLiIpOwogICAgICAgIH0gZWxzZSBpZiAoaXNWYWxpZEFubm90YXRpb25FZGl0b3JNb2RlKG1vZGUpKSB7CiAgICAgICAgICB0aGlzLiNhbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyID0gbmV3IEFubm90YXRpb25FZGl0b3JVSU1hbmFnZXIodGhpcy5jb250YWluZXIsIHZpZXdlciwgdGhpcy4jYWx0VGV4dE1hbmFnZXIsIHRoaXMuI3NpZ25hdHVyZU1hbmFnZXIsIGV2ZW50QnVzLCBwZGZEb2N1bWVudCwgcGFnZUNvbG9ycywgdGhpcy4jYW5ub3RhdGlvbkVkaXRvckhpZ2hsaWdodENvbG9ycywgdGhpcy4jZW5hYmxlSGlnaGxpZ2h0RmxvYXRpbmdCdXR0b24sIHRoaXMuI2VuYWJsZVVwZGF0ZWRBZGRJbWFnZSwgdGhpcy4jZW5hYmxlTmV3QWx0VGV4dFdoZW5BZGRpbmdJbWFnZSwgdGhpcy4jbWxNYW5hZ2VyLCB0aGlzLiNlZGl0b3JVbmRvQmFyLCB0aGlzLiNzdXBwb3J0c1BpbmNoVG9ab29tKTsKICAgICAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKCJhbm5vdGF0aW9uZWRpdG9ydWltYW5hZ2VyIiwgewogICAgICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgICAgIHVpTWFuYWdlcjogdGhpcy4jYW5ub3RhdGlvbkVkaXRvclVJTWFuYWdlcgogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAobW9kZSAhPT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuTk9ORSkgewogICAgICAgICAgICB0aGlzLiNwcmVsb2FkRWRpdGluZ0RhdGEobW9kZSk7CiAgICAgICAgICAgIHRoaXMuI2Fubm90YXRpb25FZGl0b3JVSU1hbmFnZXIudXBkYXRlTW9kZShtb2RlKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5lcnJvcihgSW52YWxpZCBBbm5vdGF0aW9uRWRpdG9yIG1vZGU6ICR7bW9kZX1gKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3Qgdmlld2VyRWxlbWVudCA9IHRoaXMuX3Njcm9sbE1vZGUgPT09IFNjcm9sbE1vZGUuUEFHRSA/IG51bGwgOiB2aWV3ZXI7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5jdXJyZW50U2NhbGU7CiAgICAgIGNvbnN0IHZpZXdwb3J0ID0gZmlyc3RQZGZQYWdlLmdldFZpZXdwb3J0KHsKICAgICAgICBzY2FsZTogc2NhbGUgKiBQaXhlbHNQZXJJbmNoLlBERl9UT19DU1NfVU5JVFMKICAgICAgfSk7CiAgICAgIHZpZXdlci5zdHlsZS5zZXRQcm9wZXJ0eSgiLS1zY2FsZS1mYWN0b3IiLCB2aWV3cG9ydC5zY2FsZSk7CiAgICAgIGlmIChwYWdlQ29sb3JzPy5iYWNrZ3JvdW5kKSB7CiAgICAgICAgdmlld2VyLnN0eWxlLnNldFByb3BlcnR5KCItLXBhZ2UtYmctY29sb3IiLCBwYWdlQ29sb3JzLmJhY2tncm91bmQpOwogICAgICB9CiAgICAgIGlmIChwYWdlQ29sb3JzPy5mb3JlZ3JvdW5kID09PSAiQ2FudmFzVGV4dCIgfHwgcGFnZUNvbG9ycz8uYmFja2dyb3VuZCA9PT0gIkNhbnZhcyIpIHsKICAgICAgICB2aWV3ZXIuc3R5bGUuc2V0UHJvcGVydHkoIi0taGNtLWhpZ2hsaWdodC1maWx0ZXIiLCBwZGZEb2N1bWVudC5maWx0ZXJGYWN0b3J5LmFkZEhpZ2hsaWdodEhDTUZpbHRlcigiaGlnaGxpZ2h0IiwgIkNhbnZhc1RleHQiLCAiQ2FudmFzIiwgIkhpZ2hsaWdodFRleHQiLCAiSGlnaGxpZ2h0IikpOwogICAgICAgIHZpZXdlci5zdHlsZS5zZXRQcm9wZXJ0eSgiLS1oY20taGlnaGxpZ2h0LXNlbGVjdGVkLWZpbHRlciIsIHBkZkRvY3VtZW50LmZpbHRlckZhY3RvcnkuYWRkSGlnaGxpZ2h0SENNRmlsdGVyKCJoaWdobGlnaHRfc2VsZWN0ZWQiLCAiQ2FudmFzVGV4dCIsICJDYW52YXMiLCAiSGlnaGxpZ2h0VGV4dCIsICJCdXR0b25UZXh0IikpOwogICAgICB9CiAgICAgIGZvciAobGV0IHBhZ2VOdW0gPSAxOyBwYWdlTnVtIDw9IHBhZ2VzQ291bnQ7ICsrcGFnZU51bSkgewogICAgICAgIGNvbnN0IHBhZ2VWaWV3ID0gbmV3IFBERlBhZ2VWaWV3KHsKICAgICAgICAgIGNvbnRhaW5lcjogdmlld2VyRWxlbWVudCwKICAgICAgICAgIGV2ZW50QnVzLAogICAgICAgICAgaWQ6IHBhZ2VOdW0sCiAgICAgICAgICBzY2FsZSwKICAgICAgICAgIGRlZmF1bHRWaWV3cG9ydDogdmlld3BvcnQuY2xvbmUoKSwKICAgICAgICAgIG9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UsCiAgICAgICAgICByZW5kZXJpbmdRdWV1ZTogdGhpcy5yZW5kZXJpbmdRdWV1ZSwKICAgICAgICAgIHRleHRMYXllck1vZGUsCiAgICAgICAgICBhbm5vdGF0aW9uTW9kZSwKICAgICAgICAgIGltYWdlUmVzb3VyY2VzUGF0aDogdGhpcy5pbWFnZVJlc291cmNlc1BhdGgsCiAgICAgICAgICBtYXhDYW52YXNQaXhlbHM6IHRoaXMubWF4Q2FudmFzUGl4ZWxzLAogICAgICAgICAgbWF4Q2FudmFzRGltOiB0aGlzLm1heENhbnZhc0RpbSwKICAgICAgICAgIGNhcENhbnZhc0FyZWFGYWN0b3I6IHRoaXMuY2FwQ2FudmFzQXJlYUZhY3RvciwKICAgICAgICAgIGVuYWJsZURldGFpbENhbnZhczogdGhpcy5lbmFibGVEZXRhaWxDYW52YXMsCiAgICAgICAgICBwYWdlQ29sb3JzLAogICAgICAgICAgbDEwbjogdGhpcy5sMTBuLAogICAgICAgICAgbGF5ZXJQcm9wZXJ0aWVzOiB0aGlzLl9sYXllclByb3BlcnRpZXMsCiAgICAgICAgICBlbmFibGVIV0E6IHRoaXMuI2VuYWJsZUhXQSwKICAgICAgICAgIGVuYWJsZUF1dG9MaW5raW5nOiB0aGlzLiNlbmFibGVBdXRvTGlua2luZywKICAgICAgICAgIG1pbkR1cmF0aW9uVG9VcGRhdGVDYW52YXM6IHRoaXMuI21pbkR1cmF0aW9uVG9VcGRhdGVDYW52YXMKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9wYWdlcy5wdXNoKHBhZ2VWaWV3KTsKICAgICAgfQogICAgICB0aGlzLl9wYWdlc1swXT8uc2V0UGRmUGFnZShmaXJzdFBkZlBhZ2UpOwogICAgICBpZiAodGhpcy5fc2Nyb2xsTW9kZSA9PT0gU2Nyb2xsTW9kZS5QQUdFKSB7CiAgICAgICAgdGhpcy4jZW5zdXJlUGFnZVZpZXdWaXNpYmxlKCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fc3ByZWFkTW9kZSAhPT0gU3ByZWFkTW9kZS5OT05FKSB7CiAgICAgICAgdGhpcy5fdXBkYXRlU3ByZWFkTW9kZSgpOwogICAgICB9CiAgICAgIHRoaXMuI29uZVBhZ2VSZW5kZXJlZE9yRm9yY2VGZXRjaChzaWduYWwpLnRoZW4oYXN5bmMgKCkgPT4gewogICAgICAgIGlmIChwZGZEb2N1bWVudCAhPT0gdGhpcy5wZGZEb2N1bWVudCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmZpbmRDb250cm9sbGVyPy5zZXREb2N1bWVudChwZGZEb2N1bWVudCk7CiAgICAgICAgdGhpcy5fc2NyaXB0aW5nTWFuYWdlcj8uc2V0RG9jdW1lbnQocGRmRG9jdW1lbnQpOwogICAgICAgIGlmICh0aGlzLiNoaWRkZW5Db3B5RWxlbWVudCkgewogICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY29weSIsIHRoaXMuI2NvcHlDYWxsYmFjay5iaW5kKHRoaXMsIHRleHRMYXllck1vZGUpLCB7CiAgICAgICAgICAgIHNpZ25hbAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLiNhbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyKSB7CiAgICAgICAgICBldmVudEJ1cy5kaXNwYXRjaCgiYW5ub3RhdGlvbmVkaXRvcm1vZGVjaGFuZ2VkIiwgewogICAgICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgICAgIG1vZGU6IHRoaXMuI2Fubm90YXRpb25FZGl0b3JNb2RlCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHBkZkRvY3VtZW50LmxvYWRpbmdQYXJhbXMuZGlzYWJsZUF1dG9GZXRjaCB8fCBwYWdlc0NvdW50ID4gUGFnZXNDb3VudExpbWl0LkZPUkNFX0xBWllfUEFHRV9JTklUKSB7CiAgICAgICAgICB0aGlzLl9wYWdlc0NhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgZ2V0UGFnZXNMZWZ0ID0gcGFnZXNDb3VudCAtIDE7CiAgICAgICAgaWYgKGdldFBhZ2VzTGVmdCA8PSAwKSB7CiAgICAgICAgICB0aGlzLl9wYWdlc0NhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBwYWdlTnVtID0gMjsgcGFnZU51bSA8PSBwYWdlc0NvdW50OyArK3BhZ2VOdW0pIHsKICAgICAgICAgIGNvbnN0IHByb21pc2UgPSBwZGZEb2N1bWVudC5nZXRQYWdlKHBhZ2VOdW0pLnRoZW4ocGRmUGFnZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHBhZ2VWaWV3ID0gdGhpcy5fcGFnZXNbcGFnZU51bSAtIDFdOwogICAgICAgICAgICBpZiAoIXBhZ2VWaWV3LnBkZlBhZ2UpIHsKICAgICAgICAgICAgICBwYWdlVmlldy5zZXRQZGZQYWdlKHBkZlBhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgtLWdldFBhZ2VzTGVmdCA9PT0gMCkgewogICAgICAgICAgICAgIHRoaXMuX3BhZ2VzQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHJlYXNvbiA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFVuYWJsZSB0byBnZXQgcGFnZSAke3BhZ2VOdW19IHRvIGluaXRpYWxpemUgdmlld2VyYCwgcmVhc29uKTsKICAgICAgICAgICAgaWYgKC0tZ2V0UGFnZXNMZWZ0ID09PSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5fcGFnZXNDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAocGFnZU51bSAlIFBhZ2VzQ291bnRMaW1pdC5QQVVTRV9FQUdFUl9QQUdFX0lOSVQgPT09IDApIHsKICAgICAgICAgICAgYXdhaXQgcHJvbWlzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgICBldmVudEJ1cy5kaXNwYXRjaCgicGFnZXNpbml0IiwgewogICAgICAgIHNvdXJjZTogdGhpcwogICAgICB9KTsKICAgICAgcGRmRG9jdW1lbnQuZ2V0TWV0YWRhdGEoKS50aGVuKCh7CiAgICAgICAgaW5mbwogICAgICB9KSA9PiB7CiAgICAgICAgaWYgKHBkZkRvY3VtZW50ICE9PSB0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChpbmZvLkxhbmd1YWdlKSB7CiAgICAgICAgICB2aWV3ZXIubGFuZyA9IGluZm8uTGFuZ3VhZ2U7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgaWYgKHRoaXMuZGVmYXVsdFJlbmRlcmluZ1F1ZXVlKSB7CiAgICAgICAgdGhpcy51cGRhdGUoKTsKICAgICAgfQogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgY29uc29sZS5lcnJvcigiVW5hYmxlIHRvIGluaXRpYWxpemUgdmlld2VyIiwgcmVhc29uKTsKICAgICAgdGhpcy5fcGFnZXNDYXBhYmlsaXR5LnJlamVjdChyZWFzb24pOwogICAgfSk7CiAgfQogIHNldFBhZ2VMYWJlbHMobGFiZWxzKSB7CiAgICBpZiAoIXRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCFsYWJlbHMpIHsKICAgICAgdGhpcy5fcGFnZUxhYmVscyA9IG51bGw7CiAgICB9IGVsc2UgaWYgKCEoQXJyYXkuaXNBcnJheShsYWJlbHMpICYmIHRoaXMucGRmRG9jdW1lbnQubnVtUGFnZXMgPT09IGxhYmVscy5sZW5ndGgpKSB7CiAgICAgIHRoaXMuX3BhZ2VMYWJlbHMgPSBudWxsOwogICAgICBjb25zb2xlLmVycm9yKGBzZXRQYWdlTGFiZWxzOiBJbnZhbGlkIHBhZ2UgbGFiZWxzLmApOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fcGFnZUxhYmVscyA9IGxhYmVsczsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHRoaXMuX3BhZ2VzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgdGhpcy5fcGFnZXNbaV0uc2V0UGFnZUxhYmVsKHRoaXMuX3BhZ2VMYWJlbHM/LltpXSA/PyBudWxsKTsKICAgIH0KICB9CiAgX3Jlc2V0VmlldygpIHsKICAgIHRoaXMuX3BhZ2VzID0gW107CiAgICB0aGlzLl9jdXJyZW50UGFnZU51bWJlciA9IDE7CiAgICB0aGlzLl9jdXJyZW50U2NhbGUgPSBVTktOT1dOX1NDQUxFOwogICAgdGhpcy5fY3VycmVudFNjYWxlVmFsdWUgPSBudWxsOwogICAgdGhpcy5fcGFnZUxhYmVscyA9IG51bGw7CiAgICB0aGlzLiNidWZmZXIgPSBuZXcgUERGUGFnZVZpZXdCdWZmZXIoREVGQVVMVF9DQUNIRV9TSVpFKTsKICAgIHRoaXMuX2xvY2F0aW9uID0gbnVsbDsKICAgIHRoaXMuX3BhZ2VzUm90YXRpb24gPSAwOwogICAgdGhpcy5fb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZSA9IG51bGw7CiAgICB0aGlzLl9maXJzdFBhZ2VDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICB0aGlzLl9vbmVQYWdlUmVuZGVyZWRDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICB0aGlzLl9wYWdlc0NhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgIHRoaXMuX3Njcm9sbE1vZGUgPSBTY3JvbGxNb2RlLlZFUlRJQ0FMOwogICAgdGhpcy5fcHJldmlvdXNTY3JvbGxNb2RlID0gU2Nyb2xsTW9kZS5VTktOT1dOOwogICAgdGhpcy5fc3ByZWFkTW9kZSA9IFNwcmVhZE1vZGUuTk9ORTsKICAgIHRoaXMuI3Njcm9sbE1vZGVQYWdlU3RhdGUgPSB7CiAgICAgIHByZXZpb3VzUGFnZU51bWJlcjogMSwKICAgICAgc2Nyb2xsRG93bjogdHJ1ZSwKICAgICAgcGFnZXM6IFtdCiAgICB9OwogICAgdGhpcy4jZXZlbnRBYm9ydENvbnRyb2xsZXI/LmFib3J0KCk7CiAgICB0aGlzLiNldmVudEFib3J0Q29udHJvbGxlciA9IG51bGw7CiAgICB0aGlzLnZpZXdlci50ZXh0Q29udGVudCA9ICIiOwogICAgdGhpcy5fdXBkYXRlU2Nyb2xsTW9kZSgpOwogICAgdGhpcy52aWV3ZXIucmVtb3ZlQXR0cmlidXRlKCJsYW5nIik7CiAgICB0aGlzLiNoaWRkZW5Db3B5RWxlbWVudD8ucmVtb3ZlKCk7CiAgICB0aGlzLiNoaWRkZW5Db3B5RWxlbWVudCA9IG51bGw7CiAgICB0aGlzLiNjbGVhbnVwVGltZW91dHMoKTsKICAgIHRoaXMuI2NsZWFudXBTd2l0Y2hBbm5vdGF0aW9uRWRpdG9yTW9kZSgpOwogIH0KICAjZW5zdXJlUGFnZVZpZXdWaXNpYmxlKCkgewogICAgaWYgKHRoaXMuX3Njcm9sbE1vZGUgIT09IFNjcm9sbE1vZGUuUEFHRSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIiNlbnN1cmVQYWdlVmlld1Zpc2libGU6IEludmFsaWQgc2Nyb2xsTW9kZSB2YWx1ZS4iKTsKICAgIH0KICAgIGNvbnN0IHBhZ2VOdW1iZXIgPSB0aGlzLl9jdXJyZW50UGFnZU51bWJlciwKICAgICAgc3RhdGUgPSB0aGlzLiNzY3JvbGxNb2RlUGFnZVN0YXRlLAogICAgICB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKICAgIHZpZXdlci50ZXh0Q29udGVudCA9ICIiOwogICAgc3RhdGUucGFnZXMubGVuZ3RoID0gMDsKICAgIGlmICh0aGlzLl9zcHJlYWRNb2RlID09PSBTcHJlYWRNb2RlLk5PTkUgJiYgIXRoaXMuaXNJblByZXNlbnRhdGlvbk1vZGUpIHsKICAgICAgY29uc3QgcGFnZVZpZXcgPSB0aGlzLl9wYWdlc1twYWdlTnVtYmVyIC0gMV07CiAgICAgIHZpZXdlci5hcHBlbmQocGFnZVZpZXcuZGl2KTsKICAgICAgc3RhdGUucGFnZXMucHVzaChwYWdlVmlldyk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBwYWdlSW5kZXhTZXQgPSBuZXcgU2V0KCksCiAgICAgICAgcGFyaXR5ID0gdGhpcy5fc3ByZWFkTW9kZSAtIDE7CiAgICAgIGlmIChwYXJpdHkgPT09IC0xKSB7CiAgICAgICAgcGFnZUluZGV4U2V0LmFkZChwYWdlTnVtYmVyIC0gMSk7CiAgICAgIH0gZWxzZSBpZiAocGFnZU51bWJlciAlIDIgIT09IHBhcml0eSkgewogICAgICAgIHBhZ2VJbmRleFNldC5hZGQocGFnZU51bWJlciAtIDEpOwogICAgICAgIHBhZ2VJbmRleFNldC5hZGQocGFnZU51bWJlcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGFnZUluZGV4U2V0LmFkZChwYWdlTnVtYmVyIC0gMik7CiAgICAgICAgcGFnZUluZGV4U2V0LmFkZChwYWdlTnVtYmVyIC0gMSk7CiAgICAgIH0KICAgICAgY29uc3Qgc3ByZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIHNwcmVhZC5jbGFzc05hbWUgPSAic3ByZWFkIjsKICAgICAgaWYgKHRoaXMuaXNJblByZXNlbnRhdGlvbk1vZGUpIHsKICAgICAgICBjb25zdCBkdW1teVBhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBkdW1teVBhZ2UuY2xhc3NOYW1lID0gImR1bW15UGFnZSI7CiAgICAgICAgc3ByZWFkLmFwcGVuZChkdW1teVBhZ2UpOwogICAgICB9CiAgICAgIGZvciAoY29uc3QgaSBvZiBwYWdlSW5kZXhTZXQpIHsKICAgICAgICBjb25zdCBwYWdlVmlldyA9IHRoaXMuX3BhZ2VzW2ldOwogICAgICAgIGlmICghcGFnZVZpZXcpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBzcHJlYWQuYXBwZW5kKHBhZ2VWaWV3LmRpdik7CiAgICAgICAgc3RhdGUucGFnZXMucHVzaChwYWdlVmlldyk7CiAgICAgIH0KICAgICAgdmlld2VyLmFwcGVuZChzcHJlYWQpOwogICAgfQogICAgc3RhdGUuc2Nyb2xsRG93biA9IHBhZ2VOdW1iZXIgPj0gc3RhdGUucHJldmlvdXNQYWdlTnVtYmVyOwogICAgc3RhdGUucHJldmlvdXNQYWdlTnVtYmVyID0gcGFnZU51bWJlcjsKICB9CiAgX3Njcm9sbFVwZGF0ZSgpIHsKICAgIGlmICh0aGlzLnBhZ2VzQ291bnQgPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuI3Njcm9sbFRpbWVvdXRJZCkgewogICAgICBjbGVhclRpbWVvdXQodGhpcy4jc2Nyb2xsVGltZW91dElkKTsKICAgIH0KICAgIHRoaXMuI3Njcm9sbFRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICB0aGlzLiNzY3JvbGxUaW1lb3V0SWQgPSBudWxsOwogICAgICB0aGlzLnVwZGF0ZSgpOwogICAgfSwgMTAwKTsKICAgIHRoaXMudXBkYXRlKCk7CiAgfQogICNzY3JvbGxJbnRvVmlldyhwYWdlVmlldywgcGFnZVNwb3QgPSBudWxsKSB7CiAgICBjb25zdCB7CiAgICAgIGRpdiwKICAgICAgaWQKICAgIH0gPSBwYWdlVmlldzsKICAgIGlmICh0aGlzLl9jdXJyZW50UGFnZU51bWJlciAhPT0gaWQpIHsKICAgICAgdGhpcy5fc2V0Q3VycmVudFBhZ2VOdW1iZXIoaWQpOwogICAgfQogICAgaWYgKHRoaXMuX3Njcm9sbE1vZGUgPT09IFNjcm9sbE1vZGUuUEFHRSkgewogICAgICB0aGlzLiNlbnN1cmVQYWdlVmlld1Zpc2libGUoKTsKICAgICAgdGhpcy51cGRhdGUoKTsKICAgIH0KICAgIGlmICghcGFnZVNwb3QgJiYgIXRoaXMuaXNJblByZXNlbnRhdGlvbk1vZGUpIHsKICAgICAgY29uc3QgbGVmdCA9IGRpdi5vZmZzZXRMZWZ0ICsgZGl2LmNsaWVudExlZnQsCiAgICAgICAgcmlnaHQgPSBsZWZ0ICsgZGl2LmNsaWVudFdpZHRoOwogICAgICBjb25zdCB7CiAgICAgICAgc2Nyb2xsTGVmdCwKICAgICAgICBjbGllbnRXaWR0aAogICAgICB9ID0gdGhpcy5jb250YWluZXI7CiAgICAgIGlmICh0aGlzLl9zY3JvbGxNb2RlID09PSBTY3JvbGxNb2RlLkhPUklaT05UQUwgfHwgbGVmdCA8IHNjcm9sbExlZnQgfHwgcmlnaHQgPiBzY3JvbGxMZWZ0ICsgY2xpZW50V2lkdGgpIHsKICAgICAgICBwYWdlU3BvdCA9IHsKICAgICAgICAgIGxlZnQ6IDAsCiAgICAgICAgICB0b3A6IDAKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICBzY3JvbGxJbnRvVmlldyhkaXYsIHBhZ2VTcG90KTsKICAgIGlmICghdGhpcy5fY3VycmVudFNjYWxlVmFsdWUgJiYgdGhpcy5fbG9jYXRpb24pIHsKICAgICAgdGhpcy5fbG9jYXRpb24gPSBudWxsOwogICAgfQogIH0KICAjaXNTYW1lU2NhbGUobmV3U2NhbGUpIHsKICAgIHJldHVybiBuZXdTY2FsZSA9PT0gdGhpcy5fY3VycmVudFNjYWxlIHx8IE1hdGguYWJzKG5ld1NjYWxlIC0gdGhpcy5fY3VycmVudFNjYWxlKSA8IDFlLTE1OwogIH0KICAjc2V0U2NhbGVVcGRhdGVQYWdlcyhuZXdTY2FsZSwgbmV3VmFsdWUsIHsKICAgIG5vU2Nyb2xsID0gZmFsc2UsCiAgICBwcmVzZXQgPSBmYWxzZSwKICAgIGRyYXdpbmdEZWxheSA9IC0xLAogICAgb3JpZ2luID0gbnVsbAogIH0pIHsKICAgIHRoaXMuX2N1cnJlbnRTY2FsZVZhbHVlID0gbmV3VmFsdWUudG9TdHJpbmcoKTsKICAgIGlmICh0aGlzLiNpc1NhbWVTY2FsZShuZXdTY2FsZSkpIHsKICAgICAgaWYgKHByZXNldCkgewogICAgICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goInNjYWxlY2hhbmdpbmciLCB7CiAgICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgICBzY2FsZTogbmV3U2NhbGUsCiAgICAgICAgICBwcmVzZXRWYWx1ZTogbmV3VmFsdWUKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnZpZXdlci5zdHlsZS5zZXRQcm9wZXJ0eSgiLS1zY2FsZS1mYWN0b3IiLCBuZXdTY2FsZSAqIFBpeGVsc1BlckluY2guUERGX1RPX0NTU19VTklUUyk7CiAgICBjb25zdCBwb3N0cG9uZURyYXdpbmcgPSBkcmF3aW5nRGVsYXkgPj0gMCAmJiBkcmF3aW5nRGVsYXkgPCAxMDAwOwogICAgdGhpcy5yZWZyZXNoKHRydWUsIHsKICAgICAgc2NhbGU6IG5ld1NjYWxlLAogICAgICBkcmF3aW5nRGVsYXk6IHBvc3Rwb25lRHJhd2luZyA/IGRyYXdpbmdEZWxheSA6IC0xCiAgICB9KTsKICAgIGlmIChwb3N0cG9uZURyYXdpbmcpIHsKICAgICAgdGhpcy4jc2NhbGVUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLiNzY2FsZVRpbWVvdXRJZCA9IG51bGw7CiAgICAgICAgdGhpcy5yZWZyZXNoKCk7CiAgICAgIH0sIGRyYXdpbmdEZWxheSk7CiAgICB9CiAgICBjb25zdCBwcmV2aW91c1NjYWxlID0gdGhpcy5fY3VycmVudFNjYWxlOwogICAgdGhpcy5fY3VycmVudFNjYWxlID0gbmV3U2NhbGU7CiAgICBpZiAoIW5vU2Nyb2xsKSB7CiAgICAgIGxldCBwYWdlID0gdGhpcy5fY3VycmVudFBhZ2VOdW1iZXIsCiAgICAgICAgZGVzdDsKICAgICAgaWYgKHRoaXMuX2xvY2F0aW9uICYmICEodGhpcy5pc0luUHJlc2VudGF0aW9uTW9kZSB8fCB0aGlzLmlzQ2hhbmdpbmdQcmVzZW50YXRpb25Nb2RlKSkgewogICAgICAgIHBhZ2UgPSB0aGlzLl9sb2NhdGlvbi5wYWdlTnVtYmVyOwogICAgICAgIGRlc3QgPSBbbnVsbCwgewogICAgICAgICAgbmFtZTogIlhZWiIKICAgICAgICB9LCB0aGlzLl9sb2NhdGlvbi5sZWZ0LCB0aGlzLl9sb2NhdGlvbi50b3AsIG51bGxdOwogICAgICB9CiAgICAgIHRoaXMuc2Nyb2xsUGFnZUludG9WaWV3KHsKICAgICAgICBwYWdlTnVtYmVyOiBwYWdlLAogICAgICAgIGRlc3RBcnJheTogZGVzdCwKICAgICAgICBhbGxvd05lZ2F0aXZlT2Zmc2V0OiB0cnVlCiAgICAgIH0pOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShvcmlnaW4pKSB7CiAgICAgICAgY29uc3Qgc2NhbGVEaWZmID0gbmV3U2NhbGUgLyBwcmV2aW91c1NjYWxlIC0gMTsKICAgICAgICBjb25zdCBbdG9wLCBsZWZ0XSA9IHRoaXMuY29udGFpbmVyVG9wTGVmdDsKICAgICAgICB0aGlzLmNvbnRhaW5lci5zY3JvbGxMZWZ0ICs9IChvcmlnaW5bMF0gLSBsZWZ0KSAqIHNjYWxlRGlmZjsKICAgICAgICB0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AgKz0gKG9yaWdpblsxXSAtIHRvcCkgKiBzY2FsZURpZmY7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goInNjYWxlY2hhbmdpbmciLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgc2NhbGU6IG5ld1NjYWxlLAogICAgICBwcmVzZXRWYWx1ZTogcHJlc2V0ID8gbmV3VmFsdWUgOiB1bmRlZmluZWQKICAgIH0pOwogICAgaWYgKHRoaXMuZGVmYXVsdFJlbmRlcmluZ1F1ZXVlKSB7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CiAgfQogIGdldCAjcGFnZVdpZHRoU2NhbGVGYWN0b3IoKSB7CiAgICBpZiAodGhpcy5fc3ByZWFkTW9kZSAhPT0gU3ByZWFkTW9kZS5OT05FICYmIHRoaXMuX3Njcm9sbE1vZGUgIT09IFNjcm9sbE1vZGUuSE9SSVpPTlRBTCkgewogICAgICByZXR1cm4gMjsKICAgIH0KICAgIHJldHVybiAxOwogIH0KICAjc2V0U2NhbGUodmFsdWUsIG9wdGlvbnMpIHsKICAgIGxldCBzY2FsZSA9IHBhcnNlRmxvYXQodmFsdWUpOwogICAgaWYgKHNjYWxlID4gMCkgewogICAgICBvcHRpb25zLnByZXNldCA9IGZhbHNlOwogICAgICB0aGlzLiNzZXRTY2FsZVVwZGF0ZVBhZ2VzKHNjYWxlLCB2YWx1ZSwgb3B0aW9ucyk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBjdXJyZW50UGFnZSA9IHRoaXMuX3BhZ2VzW3RoaXMuX2N1cnJlbnRQYWdlTnVtYmVyIC0gMV07CiAgICAgIGlmICghY3VycmVudFBhZ2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbGV0IGhQYWRkaW5nID0gU0NST0xMQkFSX1BBRERJTkcsCiAgICAgICAgdlBhZGRpbmcgPSBWRVJUSUNBTF9QQURESU5HOwogICAgICBpZiAodGhpcy5pc0luUHJlc2VudGF0aW9uTW9kZSkgewogICAgICAgIGhQYWRkaW5nID0gdlBhZGRpbmcgPSA0OwogICAgICAgIGlmICh0aGlzLl9zcHJlYWRNb2RlICE9PSBTcHJlYWRNb2RlLk5PTkUpIHsKICAgICAgICAgIGhQYWRkaW5nICo9IDI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMucmVtb3ZlUGFnZUJvcmRlcnMpIHsKICAgICAgICBoUGFkZGluZyA9IHZQYWRkaW5nID0gMDsKICAgICAgfSBlbHNlIGlmICh0aGlzLl9zY3JvbGxNb2RlID09PSBTY3JvbGxNb2RlLkhPUklaT05UQUwpIHsKICAgICAgICBbaFBhZGRpbmcsIHZQYWRkaW5nXSA9IFt2UGFkZGluZywgaFBhZGRpbmddOwogICAgICB9CiAgICAgIGNvbnN0IHBhZ2VXaWR0aFNjYWxlID0gKHRoaXMuY29udGFpbmVyLmNsaWVudFdpZHRoIC0gaFBhZGRpbmcpIC8gY3VycmVudFBhZ2Uud2lkdGggKiBjdXJyZW50UGFnZS5zY2FsZSAvIHRoaXMuI3BhZ2VXaWR0aFNjYWxlRmFjdG9yOwogICAgICBjb25zdCBwYWdlSGVpZ2h0U2NhbGUgPSAodGhpcy5jb250YWluZXIuY2xpZW50SGVpZ2h0IC0gdlBhZGRpbmcpIC8gY3VycmVudFBhZ2UuaGVpZ2h0ICogY3VycmVudFBhZ2Uuc2NhbGU7CiAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICBjYXNlICJwYWdlLWFjdHVhbCI6CiAgICAgICAgICBzY2FsZSA9IDE7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJwYWdlLXdpZHRoIjoKICAgICAgICAgIHNjYWxlID0gcGFnZVdpZHRoU2NhbGU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJwYWdlLWhlaWdodCI6CiAgICAgICAgICBzY2FsZSA9IHBhZ2VIZWlnaHRTY2FsZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInBhZ2UtZml0IjoKICAgICAgICAgIHNjYWxlID0gTWF0aC5taW4ocGFnZVdpZHRoU2NhbGUsIHBhZ2VIZWlnaHRTY2FsZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJhdXRvIjoKICAgICAgICAgIGNvbnN0IGhvcml6b250YWxTY2FsZSA9IGlzUG9ydHJhaXRPcmllbnRhdGlvbihjdXJyZW50UGFnZSkgPyBwYWdlV2lkdGhTY2FsZSA6IE1hdGgubWluKHBhZ2VIZWlnaHRTY2FsZSwgcGFnZVdpZHRoU2NhbGUpOwogICAgICAgICAgc2NhbGUgPSBNYXRoLm1pbihNQVhfQVVUT19TQ0FMRSwgaG9yaXpvbnRhbFNjYWxlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBjb25zb2xlLmVycm9yKGAjc2V0U2NhbGU6ICIke3ZhbHVlfSIgaXMgYW4gdW5rbm93biB6b29tIHZhbHVlLmApOwogICAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIG9wdGlvbnMucHJlc2V0ID0gdHJ1ZTsKICAgICAgdGhpcy4jc2V0U2NhbGVVcGRhdGVQYWdlcyhzY2FsZSwgdmFsdWUsIG9wdGlvbnMpOwogICAgfQogIH0KICAjcmVzZXRDdXJyZW50UGFnZVZpZXcoKSB7CiAgICBjb25zdCBwYWdlVmlldyA9IHRoaXMuX3BhZ2VzW3RoaXMuX2N1cnJlbnRQYWdlTnVtYmVyIC0gMV07CiAgICBpZiAodGhpcy5pc0luUHJlc2VudGF0aW9uTW9kZSkgewogICAgICB0aGlzLiNzZXRTY2FsZSh0aGlzLl9jdXJyZW50U2NhbGVWYWx1ZSwgewogICAgICAgIG5vU2Nyb2xsOiB0cnVlCiAgICAgIH0pOwogICAgfQogICAgdGhpcy4jc2Nyb2xsSW50b1ZpZXcocGFnZVZpZXcpOwogIH0KICBwYWdlTGFiZWxUb1BhZ2VOdW1iZXIobGFiZWwpIHsKICAgIGlmICghdGhpcy5fcGFnZUxhYmVscykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGkgPSB0aGlzLl9wYWdlTGFiZWxzLmluZGV4T2YobGFiZWwpOwogICAgaWYgKGkgPCAwKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuIGkgKyAxOwogIH0KICBzY3JvbGxQYWdlSW50b1ZpZXcoewogICAgcGFnZU51bWJlciwKICAgIGRlc3RBcnJheSA9IG51bGwsCiAgICBhbGxvd05lZ2F0aXZlT2Zmc2V0ID0gZmFsc2UsCiAgICBpZ25vcmVEZXN0aW5hdGlvblpvb20gPSBmYWxzZQogIH0pIHsKICAgIGlmICghdGhpcy5wZGZEb2N1bWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwYWdlVmlldyA9IE51bWJlci5pc0ludGVnZXIocGFnZU51bWJlcikgJiYgdGhpcy5fcGFnZXNbcGFnZU51bWJlciAtIDFdOwogICAgaWYgKCFwYWdlVmlldykgewogICAgICBjb25zb2xlLmVycm9yKGBzY3JvbGxQYWdlSW50b1ZpZXc6ICIke3BhZ2VOdW1iZXJ9IiBpcyBub3QgYSB2YWxpZCBwYWdlTnVtYmVyIHBhcmFtZXRlci5gKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuaXNJblByZXNlbnRhdGlvbk1vZGUgfHwgIWRlc3RBcnJheSkgewogICAgICB0aGlzLl9zZXRDdXJyZW50UGFnZU51bWJlcihwYWdlTnVtYmVyLCB0cnVlKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IHggPSAwLAogICAgICB5ID0gMDsKICAgIGxldCB3aWR0aCA9IDAsCiAgICAgIGhlaWdodCA9IDAsCiAgICAgIHdpZHRoU2NhbGUsCiAgICAgIGhlaWdodFNjYWxlOwogICAgY29uc3QgY2hhbmdlT3JpZW50YXRpb24gPSBwYWdlVmlldy5yb3RhdGlvbiAlIDE4MCAhPT0gMDsKICAgIGNvbnN0IHBhZ2VXaWR0aCA9IChjaGFuZ2VPcmllbnRhdGlvbiA/IHBhZ2VWaWV3LmhlaWdodCA6IHBhZ2VWaWV3LndpZHRoKSAvIHBhZ2VWaWV3LnNjYWxlIC8gUGl4ZWxzUGVySW5jaC5QREZfVE9fQ1NTX1VOSVRTOwogICAgY29uc3QgcGFnZUhlaWdodCA9IChjaGFuZ2VPcmllbnRhdGlvbiA/IHBhZ2VWaWV3LndpZHRoIDogcGFnZVZpZXcuaGVpZ2h0KSAvIHBhZ2VWaWV3LnNjYWxlIC8gUGl4ZWxzUGVySW5jaC5QREZfVE9fQ1NTX1VOSVRTOwogICAgbGV0IHNjYWxlID0gMDsKICAgIHN3aXRjaCAoZGVzdEFycmF5WzFdLm5hbWUpIHsKICAgICAgY2FzZSAiWFlaIjoKICAgICAgICB4ID0gZGVzdEFycmF5WzJdOwogICAgICAgIHkgPSBkZXN0QXJyYXlbM107CiAgICAgICAgc2NhbGUgPSBkZXN0QXJyYXlbNF07CiAgICAgICAgeCA9IHggIT09IG51bGwgPyB4IDogMDsKICAgICAgICB5ID0geSAhPT0gbnVsbCA/IHkgOiBwYWdlSGVpZ2h0OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJGaXQiOgogICAgICBjYXNlICJGaXRCIjoKICAgICAgICBzY2FsZSA9ICJwYWdlLWZpdCI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIkZpdEgiOgogICAgICBjYXNlICJGaXRCSCI6CiAgICAgICAgeSA9IGRlc3RBcnJheVsyXTsKICAgICAgICBzY2FsZSA9ICJwYWdlLXdpZHRoIjsKICAgICAgICBpZiAoeSA9PT0gbnVsbCAmJiB0aGlzLl9sb2NhdGlvbikgewogICAgICAgICAgeCA9IHRoaXMuX2xvY2F0aW9uLmxlZnQ7CiAgICAgICAgICB5ID0gdGhpcy5fbG9jYXRpb24udG9wOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHkgIT09ICJudW1iZXIiIHx8IHkgPCAwKSB7CiAgICAgICAgICB5ID0gcGFnZUhlaWdodDsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIkZpdFYiOgogICAgICBjYXNlICJGaXRCViI6CiAgICAgICAgeCA9IGRlc3RBcnJheVsyXTsKICAgICAgICB3aWR0aCA9IHBhZ2VXaWR0aDsKICAgICAgICBoZWlnaHQgPSBwYWdlSGVpZ2h0OwogICAgICAgIHNjYWxlID0gInBhZ2UtaGVpZ2h0IjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiRml0UiI6CiAgICAgICAgeCA9IGRlc3RBcnJheVsyXTsKICAgICAgICB5ID0gZGVzdEFycmF5WzNdOwogICAgICAgIHdpZHRoID0gZGVzdEFycmF5WzRdIC0geDsKICAgICAgICBoZWlnaHQgPSBkZXN0QXJyYXlbNV0gLSB5OwogICAgICAgIGxldCBoUGFkZGluZyA9IFNDUk9MTEJBUl9QQURESU5HLAogICAgICAgICAgdlBhZGRpbmcgPSBWRVJUSUNBTF9QQURESU5HOwogICAgICAgIGlmICh0aGlzLnJlbW92ZVBhZ2VCb3JkZXJzKSB7CiAgICAgICAgICBoUGFkZGluZyA9IHZQYWRkaW5nID0gMDsKICAgICAgICB9CiAgICAgICAgd2lkdGhTY2FsZSA9ICh0aGlzLmNvbnRhaW5lci5jbGllbnRXaWR0aCAtIGhQYWRkaW5nKSAvIHdpZHRoIC8gUGl4ZWxzUGVySW5jaC5QREZfVE9fQ1NTX1VOSVRTOwogICAgICAgIGhlaWdodFNjYWxlID0gKHRoaXMuY29udGFpbmVyLmNsaWVudEhlaWdodCAtIHZQYWRkaW5nKSAvIGhlaWdodCAvIFBpeGVsc1BlckluY2guUERGX1RPX0NTU19VTklUUzsKICAgICAgICBzY2FsZSA9IE1hdGgubWluKE1hdGguYWJzKHdpZHRoU2NhbGUpLCBNYXRoLmFicyhoZWlnaHRTY2FsZSkpOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnNvbGUuZXJyb3IoYHNjcm9sbFBhZ2VJbnRvVmlldzogIiR7ZGVzdEFycmF5WzFdLm5hbWV9IiBpcyBub3QgYSB2YWxpZCBkZXN0aW5hdGlvbiB0eXBlLmApOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghaWdub3JlRGVzdGluYXRpb25ab29tKSB7CiAgICAgIGlmIChzY2FsZSAmJiBzY2FsZSAhPT0gdGhpcy5fY3VycmVudFNjYWxlKSB7CiAgICAgICAgdGhpcy5jdXJyZW50U2NhbGVWYWx1ZSA9IHNjYWxlOwogICAgICB9IGVsc2UgaWYgKHRoaXMuX2N1cnJlbnRTY2FsZSA9PT0gVU5LTk9XTl9TQ0FMRSkgewogICAgICAgIHRoaXMuY3VycmVudFNjYWxlVmFsdWUgPSBERUZBVUxUX1NDQUxFX1ZBTFVFOwogICAgICB9CiAgICB9CiAgICBpZiAoc2NhbGUgPT09ICJwYWdlLWZpdCIgJiYgIWRlc3RBcnJheVs0XSkgewogICAgICB0aGlzLiNzY3JvbGxJbnRvVmlldyhwYWdlVmlldyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGJvdW5kaW5nUmVjdCA9IFtwYWdlVmlldy52aWV3cG9ydC5jb252ZXJ0VG9WaWV3cG9ydFBvaW50KHgsIHkpLCBwYWdlVmlldy52aWV3cG9ydC5jb252ZXJ0VG9WaWV3cG9ydFBvaW50KHggKyB3aWR0aCwgeSArIGhlaWdodCldOwogICAgbGV0IGxlZnQgPSBNYXRoLm1pbihib3VuZGluZ1JlY3RbMF1bMF0sIGJvdW5kaW5nUmVjdFsxXVswXSk7CiAgICBsZXQgdG9wID0gTWF0aC5taW4oYm91bmRpbmdSZWN0WzBdWzFdLCBib3VuZGluZ1JlY3RbMV1bMV0pOwogICAgaWYgKCFhbGxvd05lZ2F0aXZlT2Zmc2V0KSB7CiAgICAgIGxlZnQgPSBNYXRoLm1heChsZWZ0LCAwKTsKICAgICAgdG9wID0gTWF0aC5tYXgodG9wLCAwKTsKICAgIH0KICAgIHRoaXMuI3Njcm9sbEludG9WaWV3KHBhZ2VWaWV3LCB7CiAgICAgIGxlZnQsCiAgICAgIHRvcAogICAgfSk7CiAgfQogIF91cGRhdGVMb2NhdGlvbihmaXJzdFBhZ2UpIHsKICAgIGNvbnN0IGN1cnJlbnRTY2FsZSA9IHRoaXMuX2N1cnJlbnRTY2FsZTsKICAgIGNvbnN0IGN1cnJlbnRTY2FsZVZhbHVlID0gdGhpcy5fY3VycmVudFNjYWxlVmFsdWU7CiAgICBjb25zdCBub3JtYWxpemVkU2NhbGVWYWx1ZSA9IHBhcnNlRmxvYXQoY3VycmVudFNjYWxlVmFsdWUpID09PSBjdXJyZW50U2NhbGUgPyBNYXRoLnJvdW5kKGN1cnJlbnRTY2FsZSAqIDEwMDAwKSAvIDEwMCA6IGN1cnJlbnRTY2FsZVZhbHVlOwogICAgY29uc3QgcGFnZU51bWJlciA9IGZpcnN0UGFnZS5pZDsKICAgIGNvbnN0IGN1cnJlbnRQYWdlVmlldyA9IHRoaXMuX3BhZ2VzW3BhZ2VOdW1iZXIgLSAxXTsKICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyOwogICAgY29uc3QgdG9wTGVmdCA9IGN1cnJlbnRQYWdlVmlldy5nZXRQYWdlUG9pbnQoY29udGFpbmVyLnNjcm9sbExlZnQgLSBmaXJzdFBhZ2UueCwgY29udGFpbmVyLnNjcm9sbFRvcCAtIGZpcnN0UGFnZS55KTsKICAgIGNvbnN0IGludExlZnQgPSBNYXRoLnJvdW5kKHRvcExlZnRbMF0pOwogICAgY29uc3QgaW50VG9wID0gTWF0aC5yb3VuZCh0b3BMZWZ0WzFdKTsKICAgIGxldCBwZGZPcGVuUGFyYW1zID0gYCNwYWdlPSR7cGFnZU51bWJlcn1gOwogICAgaWYgKCF0aGlzLmlzSW5QcmVzZW50YXRpb25Nb2RlKSB7CiAgICAgIHBkZk9wZW5QYXJhbXMgKz0gYCZ6b29tPSR7bm9ybWFsaXplZFNjYWxlVmFsdWV9LCR7aW50TGVmdH0sJHtpbnRUb3B9YDsKICAgIH0KICAgIHRoaXMuX2xvY2F0aW9uID0gewogICAgICBwYWdlTnVtYmVyLAogICAgICBzY2FsZTogbm9ybWFsaXplZFNjYWxlVmFsdWUsCiAgICAgIHRvcDogaW50VG9wLAogICAgICBsZWZ0OiBpbnRMZWZ0LAogICAgICByb3RhdGlvbjogdGhpcy5fcGFnZXNSb3RhdGlvbiwKICAgICAgcGRmT3BlblBhcmFtcwogICAgfTsKICB9CiAgdXBkYXRlKCkgewogICAgY29uc3QgdmlzaWJsZSA9IHRoaXMuX2dldFZpc2libGVQYWdlcygpOwogICAgY29uc3QgdmlzaWJsZVBhZ2VzID0gdmlzaWJsZS52aWV3cywKICAgICAgbnVtVmlzaWJsZVBhZ2VzID0gdmlzaWJsZVBhZ2VzLmxlbmd0aDsKICAgIGlmIChudW1WaXNpYmxlUGFnZXMgPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbmV3Q2FjaGVTaXplID0gTWF0aC5tYXgoREVGQVVMVF9DQUNIRV9TSVpFLCAyICogbnVtVmlzaWJsZVBhZ2VzICsgMSk7CiAgICB0aGlzLiNidWZmZXIucmVzaXplKG5ld0NhY2hlU2l6ZSwgdmlzaWJsZS5pZHMpOwogICAgZm9yIChjb25zdCB7CiAgICAgIHZpZXcsCiAgICAgIHZpc2libGVBcmVhCiAgICB9IG9mIHZpc2libGVQYWdlcykgewogICAgICB2aWV3LnVwZGF0ZVZpc2libGVBcmVhKHZpc2libGVBcmVhKTsKICAgIH0KICAgIGZvciAoY29uc3QgdmlldyBvZiB0aGlzLiNidWZmZXIpIHsKICAgICAgaWYgKCF2aXNpYmxlLmlkcy5oYXModmlldy5pZCkpIHsKICAgICAgICB2aWV3LnVwZGF0ZVZpc2libGVBcmVhKG51bGwpOwogICAgICB9CiAgICB9CiAgICB0aGlzLnJlbmRlcmluZ1F1ZXVlLnJlbmRlckhpZ2hlc3RQcmlvcml0eSh2aXNpYmxlKTsKICAgIGNvbnN0IGlzU2ltcGxlTGF5b3V0ID0gdGhpcy5fc3ByZWFkTW9kZSA9PT0gU3ByZWFkTW9kZS5OT05FICYmICh0aGlzLl9zY3JvbGxNb2RlID09PSBTY3JvbGxNb2RlLlBBR0UgfHwgdGhpcy5fc2Nyb2xsTW9kZSA9PT0gU2Nyb2xsTW9kZS5WRVJUSUNBTCk7CiAgICBjb25zdCBjdXJyZW50SWQgPSB0aGlzLl9jdXJyZW50UGFnZU51bWJlcjsKICAgIGxldCBzdGlsbEZ1bGx5VmlzaWJsZSA9IGZhbHNlOwogICAgZm9yIChjb25zdCBwYWdlIG9mIHZpc2libGVQYWdlcykgewogICAgICBpZiAocGFnZS5wZXJjZW50IDwgMTAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHBhZ2UuaWQgPT09IGN1cnJlbnRJZCAmJiBpc1NpbXBsZUxheW91dCkgewogICAgICAgIHN0aWxsRnVsbHlWaXNpYmxlID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgdGhpcy5fc2V0Q3VycmVudFBhZ2VOdW1iZXIoc3RpbGxGdWxseVZpc2libGUgPyBjdXJyZW50SWQgOiB2aXNpYmxlUGFnZXNbMF0uaWQpOwogICAgdGhpcy5fdXBkYXRlTG9jYXRpb24odmlzaWJsZS5maXJzdCk7CiAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJ1cGRhdGV2aWV3YXJlYSIsIHsKICAgICAgc291cmNlOiB0aGlzLAogICAgICBsb2NhdGlvbjogdGhpcy5fbG9jYXRpb24KICAgIH0pOwogIH0KICAjc3dpdGNoVG9FZGl0QW5ub3RhdGlvbk1vZGUoKSB7CiAgICBjb25zdCB2aXNpYmxlID0gdGhpcy5fZ2V0VmlzaWJsZVBhZ2VzKCk7CiAgICBjb25zdCBwYWdlc1RvUmVmcmVzaCA9IFtdOwogICAgY29uc3QgewogICAgICBpZHMsCiAgICAgIHZpZXdzCiAgICB9ID0gdmlzaWJsZTsKICAgIGZvciAoY29uc3QgcGFnZSBvZiB2aWV3cykgewogICAgICBjb25zdCB7CiAgICAgICAgdmlldwogICAgICB9ID0gcGFnZTsKICAgICAgaWYgKCF2aWV3Lmhhc0VkaXRhYmxlQW5ub3RhdGlvbnMoKSkgewogICAgICAgIGlkcy5kZWxldGUodmlldy5pZCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgcGFnZXNUb1JlZnJlc2gucHVzaChwYWdlKTsKICAgIH0KICAgIGlmIChwYWdlc1RvUmVmcmVzaC5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICB0aGlzLnJlbmRlcmluZ1F1ZXVlLnJlbmRlckhpZ2hlc3RQcmlvcml0eSh7CiAgICAgIGZpcnN0OiBwYWdlc1RvUmVmcmVzaFswXSwKICAgICAgbGFzdDogcGFnZXNUb1JlZnJlc2guYXQoLTEpLAogICAgICB2aWV3czogcGFnZXNUb1JlZnJlc2gsCiAgICAgIGlkcwogICAgfSk7CiAgICByZXR1cm4gaWRzOwogIH0KICBjb250YWluc0VsZW1lbnQoZWxlbWVudCkgewogICAgcmV0dXJuIHRoaXMuY29udGFpbmVyLmNvbnRhaW5zKGVsZW1lbnQpOwogIH0KICBmb2N1cygpIHsKICAgIHRoaXMuY29udGFpbmVyLmZvY3VzKCk7CiAgfQogIGdldCBfaXNDb250YWluZXJSdGwoKSB7CiAgICByZXR1cm4gZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmNvbnRhaW5lcikuZGlyZWN0aW9uID09PSAicnRsIjsKICB9CiAgZ2V0IGlzSW5QcmVzZW50YXRpb25Nb2RlKCkgewogICAgcmV0dXJuIHRoaXMucHJlc2VudGF0aW9uTW9kZVN0YXRlID09PSBQcmVzZW50YXRpb25Nb2RlU3RhdGUuRlVMTFNDUkVFTjsKICB9CiAgZ2V0IGlzQ2hhbmdpbmdQcmVzZW50YXRpb25Nb2RlKCkgewogICAgcmV0dXJuIHRoaXMucHJlc2VudGF0aW9uTW9kZVN0YXRlID09PSBQcmVzZW50YXRpb25Nb2RlU3RhdGUuQ0hBTkdJTkc7CiAgfQogIGdldCBpc0hvcml6b250YWxTY3JvbGxiYXJFbmFibGVkKCkgewogICAgcmV0dXJuIHRoaXMuaXNJblByZXNlbnRhdGlvbk1vZGUgPyBmYWxzZSA6IHRoaXMuY29udGFpbmVyLnNjcm9sbFdpZHRoID4gdGhpcy5jb250YWluZXIuY2xpZW50V2lkdGg7CiAgfQogIGdldCBpc1ZlcnRpY2FsU2Nyb2xsYmFyRW5hYmxlZCgpIHsKICAgIHJldHVybiB0aGlzLmlzSW5QcmVzZW50YXRpb25Nb2RlID8gZmFsc2UgOiB0aGlzLmNvbnRhaW5lci5zY3JvbGxIZWlnaHQgPiB0aGlzLmNvbnRhaW5lci5jbGllbnRIZWlnaHQ7CiAgfQogIF9nZXRWaXNpYmxlUGFnZXMoKSB7CiAgICBjb25zdCB2aWV3cyA9IHRoaXMuX3Njcm9sbE1vZGUgPT09IFNjcm9sbE1vZGUuUEFHRSA/IHRoaXMuI3Njcm9sbE1vZGVQYWdlU3RhdGUucGFnZXMgOiB0aGlzLl9wYWdlcywKICAgICAgaG9yaXpvbnRhbCA9IHRoaXMuX3Njcm9sbE1vZGUgPT09IFNjcm9sbE1vZGUuSE9SSVpPTlRBTCwKICAgICAgcnRsID0gaG9yaXpvbnRhbCAmJiB0aGlzLl9pc0NvbnRhaW5lclJ0bDsKICAgIHJldHVybiBnZXRWaXNpYmxlRWxlbWVudHMoewogICAgICBzY3JvbGxFbDogdGhpcy5jb250YWluZXIsCiAgICAgIHZpZXdzLAogICAgICBzb3J0QnlWaXNpYmlsaXR5OiB0cnVlLAogICAgICBob3Jpem9udGFsLAogICAgICBydGwKICAgIH0pOwogIH0KICBjbGVhbnVwKCkgewogICAgZm9yIChjb25zdCBwYWdlVmlldyBvZiB0aGlzLl9wYWdlcykgewogICAgICBpZiAocGFnZVZpZXcucmVuZGVyaW5nU3RhdGUgIT09IFJlbmRlcmluZ1N0YXRlcy5GSU5JU0hFRCkgewogICAgICAgIHBhZ2VWaWV3LnJlc2V0KCk7CiAgICAgIH0KICAgIH0KICB9CiAgX2NhbmNlbFJlbmRlcmluZygpIHsKICAgIGZvciAoY29uc3QgcGFnZVZpZXcgb2YgdGhpcy5fcGFnZXMpIHsKICAgICAgcGFnZVZpZXcuY2FuY2VsUmVuZGVyaW5nKCk7CiAgICB9CiAgfQogIGFzeW5jICNlbnN1cmVQZGZQYWdlTG9hZGVkKHBhZ2VWaWV3KSB7CiAgICBpZiAocGFnZVZpZXcucGRmUGFnZSkgewogICAgICByZXR1cm4gcGFnZVZpZXcucGRmUGFnZTsKICAgIH0KICAgIHRyeSB7CiAgICAgIGNvbnN0IHBkZlBhZ2UgPSBhd2FpdCB0aGlzLnBkZkRvY3VtZW50LmdldFBhZ2UocGFnZVZpZXcuaWQpOwogICAgICBpZiAoIXBhZ2VWaWV3LnBkZlBhZ2UpIHsKICAgICAgICBwYWdlVmlldy5zZXRQZGZQYWdlKHBkZlBhZ2UpOwogICAgICB9CiAgICAgIHJldHVybiBwZGZQYWdlOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIlVuYWJsZSB0byBnZXQgcGFnZSBmb3IgcGFnZSB2aWV3IiwgcmVhc29uKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQogICNnZXRTY3JvbGxBaGVhZCh2aXNpYmxlKSB7CiAgICBpZiAodmlzaWJsZS5maXJzdD8uaWQgPT09IDEpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgaWYgKHZpc2libGUubGFzdD8uaWQgPT09IHRoaXMucGFnZXNDb3VudCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBzd2l0Y2ggKHRoaXMuX3Njcm9sbE1vZGUpIHsKICAgICAgY2FzZSBTY3JvbGxNb2RlLlBBR0U6CiAgICAgICAgcmV0dXJuIHRoaXMuI3Njcm9sbE1vZGVQYWdlU3RhdGUuc2Nyb2xsRG93bjsKICAgICAgY2FzZSBTY3JvbGxNb2RlLkhPUklaT05UQUw6CiAgICAgICAgcmV0dXJuIHRoaXMuc2Nyb2xsLnJpZ2h0OwogICAgfQogICAgcmV0dXJuIHRoaXMuc2Nyb2xsLmRvd247CiAgfQogIGZvcmNlUmVuZGVyaW5nKGN1cnJlbnRseVZpc2libGVQYWdlcykgewogICAgY29uc3QgdmlzaWJsZVBhZ2VzID0gY3VycmVudGx5VmlzaWJsZVBhZ2VzIHx8IHRoaXMuX2dldFZpc2libGVQYWdlcygpOwogICAgY29uc3Qgc2Nyb2xsQWhlYWQgPSB0aGlzLiNnZXRTY3JvbGxBaGVhZCh2aXNpYmxlUGFnZXMpOwogICAgY29uc3QgcHJlUmVuZGVyRXh0cmEgPSB0aGlzLl9zcHJlYWRNb2RlICE9PSBTcHJlYWRNb2RlLk5PTkUgJiYgdGhpcy5fc2Nyb2xsTW9kZSAhPT0gU2Nyb2xsTW9kZS5IT1JJWk9OVEFMOwogICAgY29uc3QgaWdub3JlRGV0YWlsVmlld3MgPSB0aGlzLiNzY2FsZVRpbWVvdXRJZCAhPT0gbnVsbCB8fCB0aGlzLiNzY3JvbGxUaW1lb3V0SWQgIT09IG51bGwgJiYgdmlzaWJsZVBhZ2VzLnZpZXdzLnNvbWUocGFnZSA9PiBwYWdlLmRldGFpbFZpZXc/LnJlbmRlcmluZ0NhbmNlbGxlZCk7CiAgICBjb25zdCBwYWdlVmlldyA9IHRoaXMucmVuZGVyaW5nUXVldWUuZ2V0SGlnaGVzdFByaW9yaXR5KHZpc2libGVQYWdlcywgdGhpcy5fcGFnZXMsIHNjcm9sbEFoZWFkLCBwcmVSZW5kZXJFeHRyYSwgaWdub3JlRGV0YWlsVmlld3MpOwogICAgaWYgKHBhZ2VWaWV3KSB7CiAgICAgIHRoaXMuI2Vuc3VyZVBkZlBhZ2VMb2FkZWQocGFnZVZpZXcpLnRoZW4oKCkgPT4gewogICAgICAgIHRoaXMucmVuZGVyaW5nUXVldWUucmVuZGVyVmlldyhwYWdlVmlldyk7CiAgICAgIH0pOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0IGhhc0VxdWFsUGFnZVNpemVzKCkgewogICAgY29uc3QgZmlyc3RQYWdlVmlldyA9IHRoaXMuX3BhZ2VzWzBdOwogICAgZm9yIChsZXQgaSA9IDEsIGlpID0gdGhpcy5fcGFnZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBwYWdlVmlldyA9IHRoaXMuX3BhZ2VzW2ldOwogICAgICBpZiAocGFnZVZpZXcud2lkdGggIT09IGZpcnN0UGFnZVZpZXcud2lkdGggfHwgcGFnZVZpZXcuaGVpZ2h0ICE9PSBmaXJzdFBhZ2VWaWV3LmhlaWdodCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIGdldFBhZ2VzT3ZlcnZpZXcoKSB7CiAgICBsZXQgaW5pdGlhbE9yaWVudGF0aW9uOwogICAgcmV0dXJuIHRoaXMuX3BhZ2VzLm1hcChwYWdlVmlldyA9PiB7CiAgICAgIGNvbnN0IHZpZXdwb3J0ID0gcGFnZVZpZXcucGRmUGFnZS5nZXRWaWV3cG9ydCh7CiAgICAgICAgc2NhbGU6IDEKICAgICAgfSk7CiAgICAgIGNvbnN0IG9yaWVudGF0aW9uID0gaXNQb3J0cmFpdE9yaWVudGF0aW9uKHZpZXdwb3J0KTsKICAgICAgaWYgKGluaXRpYWxPcmllbnRhdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaW5pdGlhbE9yaWVudGF0aW9uID0gb3JpZW50YXRpb247CiAgICAgIH0gZWxzZSBpZiAodGhpcy5lbmFibGVQcmludEF1dG9Sb3RhdGUgJiYgb3JpZW50YXRpb24gIT09IGluaXRpYWxPcmllbnRhdGlvbikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB3aWR0aDogdmlld3BvcnQuaGVpZ2h0LAogICAgICAgICAgaGVpZ2h0OiB2aWV3cG9ydC53aWR0aCwKICAgICAgICAgIHJvdGF0aW9uOiAodmlld3BvcnQucm90YXRpb24gLSA5MCkgJSAzNjAKICAgICAgICB9OwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgd2lkdGg6IHZpZXdwb3J0LndpZHRoLAogICAgICAgIGhlaWdodDogdmlld3BvcnQuaGVpZ2h0LAogICAgICAgIHJvdGF0aW9uOiB2aWV3cG9ydC5yb3RhdGlvbgogICAgICB9OwogICAgfSk7CiAgfQogIGdldCBvcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlKCkgewogICAgaWYgKCF0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7CiAgICB9CiAgICBpZiAoIXRoaXMuX29wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UpIHsKICAgICAgY29uc29sZS5lcnJvcigib3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZTogTm90IGluaXRpYWxpemVkIHlldC4iKTsKICAgICAgcmV0dXJuIHRoaXMucGRmRG9jdW1lbnQuZ2V0T3B0aW9uYWxDb250ZW50Q29uZmlnKHsKICAgICAgICBpbnRlbnQ6ICJkaXNwbGF5IgogICAgICB9KTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9vcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlOwogIH0KICBzZXQgb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZShwcm9taXNlKSB7CiAgICBpZiAoIShwcm9taXNlIGluc3RhbmNlb2YgUHJvbWlzZSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIG9wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2U6ICR7cHJvbWlzZX1gKTsKICAgIH0KICAgIGlmICghdGhpcy5wZGZEb2N1bWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXMuX29wdGlvbmFsQ29udGVudENvbmZpZ1Byb21pc2UpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZSA9IHByb21pc2U7CiAgICB0aGlzLnJlZnJlc2goZmFsc2UsIHsKICAgICAgb3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZTogcHJvbWlzZQogICAgfSk7CiAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJvcHRpb25hbGNvbnRlbnRjb25maWdjaGFuZ2VkIiwgewogICAgICBzb3VyY2U6IHRoaXMsCiAgICAgIHByb21pc2UKICAgIH0pOwogIH0KICBnZXQgc2Nyb2xsTW9kZSgpIHsKICAgIHJldHVybiB0aGlzLl9zY3JvbGxNb2RlOwogIH0KICBzZXQgc2Nyb2xsTW9kZShtb2RlKSB7CiAgICBpZiAodGhpcy5fc2Nyb2xsTW9kZSA9PT0gbW9kZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIWlzVmFsaWRTY3JvbGxNb2RlKG1vZGUpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzY3JvbGwgbW9kZTogJHttb2RlfWApOwogICAgfQogICAgaWYgKHRoaXMucGFnZXNDb3VudCA+IFBhZ2VzQ291bnRMaW1pdC5GT1JDRV9TQ1JPTExfTU9ERV9QQUdFKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX3ByZXZpb3VzU2Nyb2xsTW9kZSA9IHRoaXMuX3Njcm9sbE1vZGU7CiAgICB0aGlzLl9zY3JvbGxNb2RlID0gbW9kZTsKICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goInNjcm9sbG1vZGVjaGFuZ2VkIiwgewogICAgICBzb3VyY2U6IHRoaXMsCiAgICAgIG1vZGUKICAgIH0pOwogICAgdGhpcy5fdXBkYXRlU2Nyb2xsTW9kZSh0aGlzLl9jdXJyZW50UGFnZU51bWJlcik7CiAgfQogIF91cGRhdGVTY3JvbGxNb2RlKHBhZ2VOdW1iZXIgPSBudWxsKSB7CiAgICBjb25zdCBzY3JvbGxNb2RlID0gdGhpcy5fc2Nyb2xsTW9kZSwKICAgICAgdmlld2VyID0gdGhpcy52aWV3ZXI7CiAgICB2aWV3ZXIuY2xhc3NMaXN0LnRvZ2dsZSgic2Nyb2xsSG9yaXpvbnRhbCIsIHNjcm9sbE1vZGUgPT09IFNjcm9sbE1vZGUuSE9SSVpPTlRBTCk7CiAgICB2aWV3ZXIuY2xhc3NMaXN0LnRvZ2dsZSgic2Nyb2xsV3JhcHBlZCIsIHNjcm9sbE1vZGUgPT09IFNjcm9sbE1vZGUuV1JBUFBFRCk7CiAgICBpZiAoIXRoaXMucGRmRG9jdW1lbnQgfHwgIXBhZ2VOdW1iZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHNjcm9sbE1vZGUgPT09IFNjcm9sbE1vZGUuUEFHRSkgewogICAgICB0aGlzLiNlbnN1cmVQYWdlVmlld1Zpc2libGUoKTsKICAgIH0gZWxzZSBpZiAodGhpcy5fcHJldmlvdXNTY3JvbGxNb2RlID09PSBTY3JvbGxNb2RlLlBBR0UpIHsKICAgICAgdGhpcy5fdXBkYXRlU3ByZWFkTW9kZSgpOwogICAgfQogICAgaWYgKHRoaXMuX2N1cnJlbnRTY2FsZVZhbHVlICYmIGlzTmFOKHRoaXMuX2N1cnJlbnRTY2FsZVZhbHVlKSkgewogICAgICB0aGlzLiNzZXRTY2FsZSh0aGlzLl9jdXJyZW50U2NhbGVWYWx1ZSwgewogICAgICAgIG5vU2Nyb2xsOiB0cnVlCiAgICAgIH0pOwogICAgfQogICAgdGhpcy5fc2V0Q3VycmVudFBhZ2VOdW1iZXIocGFnZU51bWJlciwgdHJ1ZSk7CiAgICB0aGlzLnVwZGF0ZSgpOwogIH0KICBnZXQgc3ByZWFkTW9kZSgpIHsKICAgIHJldHVybiB0aGlzLl9zcHJlYWRNb2RlOwogIH0KICBzZXQgc3ByZWFkTW9kZShtb2RlKSB7CiAgICBpZiAodGhpcy5fc3ByZWFkTW9kZSA9PT0gbW9kZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIWlzVmFsaWRTcHJlYWRNb2RlKG1vZGUpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzcHJlYWQgbW9kZTogJHttb2RlfWApOwogICAgfQogICAgdGhpcy5fc3ByZWFkTW9kZSA9IG1vZGU7CiAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJzcHJlYWRtb2RlY2hhbmdlZCIsIHsKICAgICAgc291cmNlOiB0aGlzLAogICAgICBtb2RlCiAgICB9KTsKICAgIHRoaXMuX3VwZGF0ZVNwcmVhZE1vZGUodGhpcy5fY3VycmVudFBhZ2VOdW1iZXIpOwogIH0KICBfdXBkYXRlU3ByZWFkTW9kZShwYWdlTnVtYmVyID0gbnVsbCkgewogICAgaWYgKCF0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHZpZXdlciA9IHRoaXMudmlld2VyLAogICAgICBwYWdlcyA9IHRoaXMuX3BhZ2VzOwogICAgaWYgKHRoaXMuX3Njcm9sbE1vZGUgPT09IFNjcm9sbE1vZGUuUEFHRSkgewogICAgICB0aGlzLiNlbnN1cmVQYWdlVmlld1Zpc2libGUoKTsKICAgIH0gZWxzZSB7CiAgICAgIHZpZXdlci50ZXh0Q29udGVudCA9ICIiOwogICAgICBpZiAodGhpcy5fc3ByZWFkTW9kZSA9PT0gU3ByZWFkTW9kZS5OT05FKSB7CiAgICAgICAgZm9yIChjb25zdCBwYWdlVmlldyBvZiB0aGlzLl9wYWdlcykgewogICAgICAgICAgdmlld2VyLmFwcGVuZChwYWdlVmlldy5kaXYpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBwYXJpdHkgPSB0aGlzLl9zcHJlYWRNb2RlIC0gMTsKICAgICAgICBsZXQgc3ByZWFkID0gbnVsbDsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBwYWdlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICBpZiAoc3ByZWFkID09PSBudWxsKSB7CiAgICAgICAgICAgIHNwcmVhZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICBzcHJlYWQuY2xhc3NOYW1lID0gInNwcmVhZCI7CiAgICAgICAgICAgIHZpZXdlci5hcHBlbmQoc3ByZWFkKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaSAlIDIgPT09IHBhcml0eSkgewogICAgICAgICAgICBzcHJlYWQgPSBzcHJlYWQuY2xvbmVOb2RlKGZhbHNlKTsKICAgICAgICAgICAgdmlld2VyLmFwcGVuZChzcHJlYWQpOwogICAgICAgICAgfQogICAgICAgICAgc3ByZWFkLmFwcGVuZChwYWdlc1tpXS5kaXYpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKCFwYWdlTnVtYmVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9jdXJyZW50U2NhbGVWYWx1ZSAmJiBpc05hTih0aGlzLl9jdXJyZW50U2NhbGVWYWx1ZSkpIHsKICAgICAgdGhpcy4jc2V0U2NhbGUodGhpcy5fY3VycmVudFNjYWxlVmFsdWUsIHsKICAgICAgICBub1Njcm9sbDogdHJ1ZQogICAgICB9KTsKICAgIH0KICAgIHRoaXMuX3NldEN1cnJlbnRQYWdlTnVtYmVyKHBhZ2VOdW1iZXIsIHRydWUpOwogICAgdGhpcy51cGRhdGUoKTsKICB9CiAgX2dldFBhZ2VBZHZhbmNlKGN1cnJlbnRQYWdlTnVtYmVyLCBwcmV2aW91cyA9IGZhbHNlKSB7CiAgICBzd2l0Y2ggKHRoaXMuX3Njcm9sbE1vZGUpIHsKICAgICAgY2FzZSBTY3JvbGxNb2RlLldSQVBQRUQ6CiAgICAgICAgewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgIHZpZXdzCiAgICAgICAgICAgIH0gPSB0aGlzLl9nZXRWaXNpYmxlUGFnZXMoKSwKICAgICAgICAgICAgcGFnZUxheW91dCA9IG5ldyBNYXAoKTsKICAgICAgICAgIGZvciAoY29uc3QgewogICAgICAgICAgICBpZCwKICAgICAgICAgICAgeSwKICAgICAgICAgICAgcGVyY2VudCwKICAgICAgICAgICAgd2lkdGhQZXJjZW50CiAgICAgICAgICB9IG9mIHZpZXdzKSB7CiAgICAgICAgICAgIGlmIChwZXJjZW50ID09PSAwIHx8IHdpZHRoUGVyY2VudCA8IDEwMCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCB5QXJyYXkgPSBwYWdlTGF5b3V0LmdldCh5KTsKICAgICAgICAgICAgaWYgKCF5QXJyYXkpIHsKICAgICAgICAgICAgICBwYWdlTGF5b3V0LnNldCh5LCB5QXJyYXkgfHw9IFtdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB5QXJyYXkucHVzaChpZCk7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGNvbnN0IHlBcnJheSBvZiBwYWdlTGF5b3V0LnZhbHVlcygpKSB7CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IHlBcnJheS5pbmRleE9mKGN1cnJlbnRQYWdlTnVtYmVyKTsKICAgICAgICAgICAgaWYgKGN1cnJlbnRJbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBudW1QYWdlcyA9IHlBcnJheS5sZW5ndGg7CiAgICAgICAgICAgIGlmIChudW1QYWdlcyA9PT0gMSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwcmV2aW91cykgewogICAgICAgICAgICAgIGZvciAobGV0IGkgPSBjdXJyZW50SW5kZXggLSAxLCBpaSA9IDA7IGkgPj0gaWk7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudElkID0geUFycmF5W2ldLAogICAgICAgICAgICAgICAgICBleHBlY3RlZElkID0geUFycmF5W2kgKyAxXSAtIDE7CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudElkIDwgZXhwZWN0ZWRJZCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFBhZ2VOdW1iZXIgLSBleHBlY3RlZElkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBmb3IgKGxldCBpID0gY3VycmVudEluZGV4ICsgMSwgaWkgPSBudW1QYWdlczsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJZCA9IHlBcnJheVtpXSwKICAgICAgICAgICAgICAgICAgZXhwZWN0ZWRJZCA9IHlBcnJheVtpIC0gMV0gKyAxOwogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRJZCA+IGV4cGVjdGVkSWQpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4cGVjdGVkSWQgLSBjdXJyZW50UGFnZU51bWJlcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHByZXZpb3VzKSB7CiAgICAgICAgICAgICAgY29uc3QgZmlyc3RJZCA9IHlBcnJheVswXTsKICAgICAgICAgICAgICBpZiAoZmlyc3RJZCA8IGN1cnJlbnRQYWdlTnVtYmVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFBhZ2VOdW1iZXIgLSBmaXJzdElkICsgMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc3QgbGFzdElkID0geUFycmF5W251bVBhZ2VzIC0gMV07CiAgICAgICAgICAgICAgaWYgKGxhc3RJZCA+IGN1cnJlbnRQYWdlTnVtYmVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGFzdElkIC0gY3VycmVudFBhZ2VOdW1iZXIgKyAxOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSBTY3JvbGxNb2RlLkhPUklaT05UQUw6CiAgICAgICAgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIFNjcm9sbE1vZGUuUEFHRToKICAgICAgY2FzZSBTY3JvbGxNb2RlLlZFUlRJQ0FMOgogICAgICAgIHsKICAgICAgICAgIGlmICh0aGlzLl9zcHJlYWRNb2RlID09PSBTcHJlYWRNb2RlLk5PTkUpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBwYXJpdHkgPSB0aGlzLl9zcHJlYWRNb2RlIC0gMTsKICAgICAgICAgIGlmIChwcmV2aW91cyAmJiBjdXJyZW50UGFnZU51bWJlciAlIDIgIT09IHBhcml0eSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0gZWxzZSBpZiAoIXByZXZpb3VzICYmIGN1cnJlbnRQYWdlTnVtYmVyICUgMiA9PT0gcGFyaXR5KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgIHZpZXdzCiAgICAgICAgICAgIH0gPSB0aGlzLl9nZXRWaXNpYmxlUGFnZXMoKSwKICAgICAgICAgICAgZXhwZWN0ZWRJZCA9IHByZXZpb3VzID8gY3VycmVudFBhZ2VOdW1iZXIgLSAxIDogY3VycmVudFBhZ2VOdW1iZXIgKyAxOwogICAgICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBwZXJjZW50LAogICAgICAgICAgICB3aWR0aFBlcmNlbnQKICAgICAgICAgIH0gb2Ygdmlld3MpIHsKICAgICAgICAgICAgaWYgKGlkICE9PSBleHBlY3RlZElkKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBlcmNlbnQgPiAwICYmIHdpZHRoUGVyY2VudCA9PT0gMTAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIDI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gMTsKICB9CiAgbmV4dFBhZ2UoKSB7CiAgICBjb25zdCBjdXJyZW50UGFnZU51bWJlciA9IHRoaXMuX2N1cnJlbnRQYWdlTnVtYmVyLAogICAgICBwYWdlc0NvdW50ID0gdGhpcy5wYWdlc0NvdW50OwogICAgaWYgKGN1cnJlbnRQYWdlTnVtYmVyID49IHBhZ2VzQ291bnQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgYWR2YW5jZSA9IHRoaXMuX2dldFBhZ2VBZHZhbmNlKGN1cnJlbnRQYWdlTnVtYmVyLCBmYWxzZSkgfHwgMTsKICAgIHRoaXMuY3VycmVudFBhZ2VOdW1iZXIgPSBNYXRoLm1pbihjdXJyZW50UGFnZU51bWJlciArIGFkdmFuY2UsIHBhZ2VzQ291bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIHByZXZpb3VzUGFnZSgpIHsKICAgIGNvbnN0IGN1cnJlbnRQYWdlTnVtYmVyID0gdGhpcy5fY3VycmVudFBhZ2VOdW1iZXI7CiAgICBpZiAoY3VycmVudFBhZ2VOdW1iZXIgPD0gMSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCBhZHZhbmNlID0gdGhpcy5fZ2V0UGFnZUFkdmFuY2UoY3VycmVudFBhZ2VOdW1iZXIsIHRydWUpIHx8IDE7CiAgICB0aGlzLmN1cnJlbnRQYWdlTnVtYmVyID0gTWF0aC5tYXgoY3VycmVudFBhZ2VOdW1iZXIgLSBhZHZhbmNlLCAxKTsKICAgIHJldHVybiB0cnVlOwogIH0KICB1cGRhdGVTY2FsZSh7CiAgICBkcmF3aW5nRGVsYXksCiAgICBzY2FsZUZhY3RvciA9IG51bGwsCiAgICBzdGVwcyA9IG51bGwsCiAgICBvcmlnaW4KICB9KSB7CiAgICBpZiAoc3RlcHMgPT09IG51bGwgJiYgc2NhbGVGYWN0b3IgPT09IG51bGwpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHVwZGF0ZVNjYWxlIG9wdGlvbnM6IGVpdGhlciBgc3RlcHNgIG9yIGBzY2FsZUZhY3RvcmAgbXVzdCBiZSBwcm92aWRlZC4iKTsKICAgIH0KICAgIGlmICghdGhpcy5wZGZEb2N1bWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgbmV3U2NhbGUgPSB0aGlzLl9jdXJyZW50U2NhbGU7CiAgICBpZiAoc2NhbGVGYWN0b3IgPiAwICYmIHNjYWxlRmFjdG9yICE9PSAxKSB7CiAgICAgIG5ld1NjYWxlID0gTWF0aC5yb3VuZChuZXdTY2FsZSAqIHNjYWxlRmFjdG9yICogMTAwKSAvIDEwMDsKICAgIH0gZWxzZSBpZiAoc3RlcHMpIHsKICAgICAgY29uc3QgZGVsdGEgPSBzdGVwcyA+IDAgPyBERUZBVUxUX1NDQUxFX0RFTFRBIDogMSAvIERFRkFVTFRfU0NBTEVfREVMVEE7CiAgICAgIGNvbnN0IHJvdW5kID0gc3RlcHMgPiAwID8gTWF0aC5jZWlsIDogTWF0aC5mbG9vcjsKICAgICAgc3RlcHMgPSBNYXRoLmFicyhzdGVwcyk7CiAgICAgIGRvIHsKICAgICAgICBuZXdTY2FsZSA9IHJvdW5kKChuZXdTY2FsZSAqIGRlbHRhKS50b0ZpeGVkKDIpICogMTApIC8gMTA7CiAgICAgIH0gd2hpbGUgKC0tc3RlcHMgPiAwKTsKICAgIH0KICAgIG5ld1NjYWxlID0gTWF0aENsYW1wKG5ld1NjYWxlLCBNSU5fU0NBTEUsIE1BWF9TQ0FMRSk7CiAgICB0aGlzLiNzZXRTY2FsZShuZXdTY2FsZSwgewogICAgICBub1Njcm9sbDogZmFsc2UsCiAgICAgIGRyYXdpbmdEZWxheSwKICAgICAgb3JpZ2luCiAgICB9KTsKICB9CiAgaW5jcmVhc2VTY2FsZShvcHRpb25zID0ge30pIHsKICAgIHRoaXMudXBkYXRlU2NhbGUoewogICAgICAuLi5vcHRpb25zLAogICAgICBzdGVwczogb3B0aW9ucy5zdGVwcyA/PyAxCiAgICB9KTsKICB9CiAgZGVjcmVhc2VTY2FsZShvcHRpb25zID0ge30pIHsKICAgIHRoaXMudXBkYXRlU2NhbGUoewogICAgICAuLi5vcHRpb25zLAogICAgICBzdGVwczogLShvcHRpb25zLnN0ZXBzID8/IDEpCiAgICB9KTsKICB9CiAgI3VwZGF0ZUNvbnRhaW5lckhlaWdodENzcyhoZWlnaHQgPSB0aGlzLmNvbnRhaW5lci5jbGllbnRIZWlnaHQpIHsKICAgIGlmIChoZWlnaHQgIT09IHRoaXMuI3ByZXZpb3VzQ29udGFpbmVySGVpZ2h0KSB7CiAgICAgIHRoaXMuI3ByZXZpb3VzQ29udGFpbmVySGVpZ2h0ID0gaGVpZ2h0OwogICAgICBkb2NTdHlsZS5zZXRQcm9wZXJ0eSgiLS12aWV3ZXItY29udGFpbmVyLWhlaWdodCIsIGAke2hlaWdodH1weGApOwogICAgfQogIH0KICAjcmVzaXplT2JzZXJ2ZXJDYWxsYmFjayhlbnRyaWVzKSB7CiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHsKICAgICAgaWYgKGVudHJ5LnRhcmdldCA9PT0gdGhpcy5jb250YWluZXIpIHsKICAgICAgICB0aGlzLiN1cGRhdGVDb250YWluZXJIZWlnaHRDc3MoTWF0aC5mbG9vcihlbnRyeS5ib3JkZXJCb3hTaXplWzBdLmJsb2NrU2l6ZSkpOwogICAgICAgIHRoaXMuI2NvbnRhaW5lclRvcExlZnQgPSBudWxsOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIGdldCBjb250YWluZXJUb3BMZWZ0KCkgewogICAgcmV0dXJuIHRoaXMuI2NvbnRhaW5lclRvcExlZnQgfHw9IFt0aGlzLmNvbnRhaW5lci5vZmZzZXRUb3AsIHRoaXMuY29udGFpbmVyLm9mZnNldExlZnRdOwogIH0KICAjY2xlYW51cFRpbWVvdXRzKCkgewogICAgaWYgKHRoaXMuI3NjYWxlVGltZW91dElkICE9PSBudWxsKSB7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLiNzY2FsZVRpbWVvdXRJZCk7CiAgICAgIHRoaXMuI3NjYWxlVGltZW91dElkID0gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLiNzY3JvbGxUaW1lb3V0SWQgIT09IG51bGwpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuI3Njcm9sbFRpbWVvdXRJZCk7CiAgICAgIHRoaXMuI3Njcm9sbFRpbWVvdXRJZCA9IG51bGw7CiAgICB9CiAgfQogICNjbGVhbnVwU3dpdGNoQW5ub3RhdGlvbkVkaXRvck1vZGUoKSB7CiAgICB0aGlzLiNzd2l0Y2hBbm5vdGF0aW9uRWRpdG9yTW9kZUFDPy5hYm9ydCgpOwogICAgdGhpcy4jc3dpdGNoQW5ub3RhdGlvbkVkaXRvck1vZGVBQyA9IG51bGw7CiAgICBpZiAodGhpcy4jc3dpdGNoQW5ub3RhdGlvbkVkaXRvck1vZGVUaW1lb3V0SWQgIT09IG51bGwpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuI3N3aXRjaEFubm90YXRpb25FZGl0b3JNb2RlVGltZW91dElkKTsKICAgICAgdGhpcy4jc3dpdGNoQW5ub3RhdGlvbkVkaXRvck1vZGVUaW1lb3V0SWQgPSBudWxsOwogICAgfQogIH0KICAjcHJlbG9hZEVkaXRpbmdEYXRhKG1vZGUpIHsKICAgIHN3aXRjaCAobW9kZSkgewogICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLlNUQU1QOgogICAgICAgIHRoaXMuI21sTWFuYWdlcj8ubG9hZE1vZGVsKCJhbHRUZXh0Iik7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuU0lHTkFUVVJFOgogICAgICAgIHRoaXMuI3NpZ25hdHVyZU1hbmFnZXI/LmxvYWRTaWduYXR1cmVzKCk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQogIGdldCBhbm5vdGF0aW9uRWRpdG9yTW9kZSgpIHsKICAgIHJldHVybiB0aGlzLiNhbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyID8gdGhpcy4jYW5ub3RhdGlvbkVkaXRvck1vZGUgOiBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ESVNBQkxFOwogIH0KICBzZXQgYW5ub3RhdGlvbkVkaXRvck1vZGUoewogICAgbW9kZSwKICAgIGVkaXRJZCA9IG51bGwsCiAgICBpc0Zyb21LZXlib2FyZCA9IGZhbHNlCiAgfSkgewogICAgaWYgKCF0aGlzLiNhbm5vdGF0aW9uRWRpdG9yVUlNYW5hZ2VyKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIEFubm90YXRpb25FZGl0b3IgaXMgbm90IGVuYWJsZWQuYCk7CiAgICB9CiAgICBpZiAodGhpcy4jYW5ub3RhdGlvbkVkaXRvck1vZGUgPT09IG1vZGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCFpc1ZhbGlkQW5ub3RhdGlvbkVkaXRvck1vZGUobW9kZSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIEFubm90YXRpb25FZGl0b3IgbW9kZTogJHttb2RlfWApOwogICAgfQogICAgaWYgKCF0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuI3ByZWxvYWRFZGl0aW5nRGF0YShtb2RlKTsKICAgIGNvbnN0IHsKICAgICAgZXZlbnRCdXMsCiAgICAgIHBkZkRvY3VtZW50CiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHVwZGF0ZXIgPSBhc3luYyAoKSA9PiB7CiAgICAgIHRoaXMuI2NsZWFudXBTd2l0Y2hBbm5vdGF0aW9uRWRpdG9yTW9kZSgpOwogICAgICB0aGlzLiNhbm5vdGF0aW9uRWRpdG9yTW9kZSA9IG1vZGU7CiAgICAgIGF3YWl0IHRoaXMuI2Fubm90YXRpb25FZGl0b3JVSU1hbmFnZXIudXBkYXRlTW9kZShtb2RlLCBlZGl0SWQsIGlzRnJvbUtleWJvYXJkKTsKICAgICAgaWYgKG1vZGUgIT09IHRoaXMuI2Fubm90YXRpb25FZGl0b3JNb2RlIHx8IHBkZkRvY3VtZW50ICE9PSB0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKCJhbm5vdGF0aW9uZWRpdG9ybW9kZWNoYW5nZWQiLCB7CiAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgIG1vZGUKICAgICAgfSk7CiAgICB9OwogICAgaWYgKG1vZGUgPT09IEFubm90YXRpb25FZGl0b3JUeXBlLk5PTkUgfHwgdGhpcy4jYW5ub3RhdGlvbkVkaXRvck1vZGUgPT09IEFubm90YXRpb25FZGl0b3JUeXBlLk5PTkUpIHsKICAgICAgY29uc3QgaXNFZGl0aW5nID0gbW9kZSAhPT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuTk9ORTsKICAgICAgaWYgKCFpc0VkaXRpbmcpIHsKICAgICAgICB0aGlzLnBkZkRvY3VtZW50LmFubm90YXRpb25TdG9yYWdlLnJlc2V0TW9kaWZpZWRJZHMoKTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IHBhZ2VWaWV3IG9mIHRoaXMuX3BhZ2VzKSB7CiAgICAgICAgcGFnZVZpZXcudG9nZ2xlRWRpdGluZ01vZGUoaXNFZGl0aW5nKTsKICAgICAgfQogICAgICBjb25zdCBpZHNUb1JlZnJlc2ggPSB0aGlzLiNzd2l0Y2hUb0VkaXRBbm5vdGF0aW9uTW9kZSgpOwogICAgICBpZiAoaXNFZGl0aW5nICYmIGlkc1RvUmVmcmVzaCkgewogICAgICAgIHRoaXMuI2NsZWFudXBTd2l0Y2hBbm5vdGF0aW9uRWRpdG9yTW9kZSgpOwogICAgICAgIHRoaXMuI3N3aXRjaEFubm90YXRpb25FZGl0b3JNb2RlQUMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICAgICAgY29uc3Qgc2lnbmFsID0gQWJvcnRTaWduYWwuYW55KFt0aGlzLiNldmVudEFib3J0Q29udHJvbGxlci5zaWduYWwsIHRoaXMuI3N3aXRjaEFubm90YXRpb25FZGl0b3JNb2RlQUMuc2lnbmFsXSk7CiAgICAgICAgZXZlbnRCdXMuX29uKCJwYWdlcmVuZGVyZWQiLCAoewogICAgICAgICAgcGFnZU51bWJlcgogICAgICAgIH0pID0+IHsKICAgICAgICAgIGlkc1RvUmVmcmVzaC5kZWxldGUocGFnZU51bWJlcik7CiAgICAgICAgICBpZiAoaWRzVG9SZWZyZXNoLnNpemUgPT09IDApIHsKICAgICAgICAgICAgdGhpcy4jc3dpdGNoQW5ub3RhdGlvbkVkaXRvck1vZGVUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KHVwZGF0ZXIsIDApOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIHNpZ25hbAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgdXBkYXRlcigpOwogIH0KICByZWZyZXNoKG5vVXBkYXRlID0gZmFsc2UsIHVwZGF0ZUFyZ3MgPSBPYmplY3QuY3JlYXRlKG51bGwpKSB7CiAgICBpZiAoIXRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBwYWdlVmlldyBvZiB0aGlzLl9wYWdlcykgewogICAgICBwYWdlVmlldy51cGRhdGUodXBkYXRlQXJncyk7CiAgICB9CiAgICB0aGlzLiNjbGVhbnVwVGltZW91dHMoKTsKICAgIGlmICghbm9VcGRhdGUpIHsKICAgICAgdGhpcy51cGRhdGUoKTsKICAgIH0KICB9Cn0KCjsvLyAuL3dlYi9zZWNvbmRhcnlfdG9vbGJhci5qcwoKCmNsYXNzIFNlY29uZGFyeVRvb2xiYXIgewogICNvcHRzOwogIGNvbnN0cnVjdG9yKG9wdGlvbnMsIGV2ZW50QnVzKSB7CiAgICB0aGlzLiNvcHRzID0gb3B0aW9uczsKICAgIGNvbnN0IGJ1dHRvbnMgPSBbewogICAgICBlbGVtZW50OiBvcHRpb25zLnByZXNlbnRhdGlvbk1vZGVCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogInByZXNlbnRhdGlvbm1vZGUiLAogICAgICBjbG9zZTogdHJ1ZQogICAgfSwgewogICAgICBlbGVtZW50OiBvcHRpb25zLnByaW50QnV0dG9uLAogICAgICBldmVudE5hbWU6ICJwcmludCIsCiAgICAgIGNsb3NlOiB0cnVlCiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuZG93bmxvYWRCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogImRvd25sb2FkIiwKICAgICAgY2xvc2U6IHRydWUKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy52aWV3Qm9va21hcmtCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogbnVsbCwKICAgICAgY2xvc2U6IHRydWUKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy5maXJzdFBhZ2VCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogImZpcnN0cGFnZSIsCiAgICAgIGNsb3NlOiB0cnVlCiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMubGFzdFBhZ2VCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogImxhc3RwYWdlIiwKICAgICAgY2xvc2U6IHRydWUKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy5wYWdlUm90YXRlQ3dCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogInJvdGF0ZWN3IiwKICAgICAgY2xvc2U6IGZhbHNlCiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMucGFnZVJvdGF0ZUNjd0J1dHRvbiwKICAgICAgZXZlbnROYW1lOiAicm90YXRlY2N3IiwKICAgICAgY2xvc2U6IGZhbHNlCiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuY3Vyc29yU2VsZWN0VG9vbEJ1dHRvbiwKICAgICAgZXZlbnROYW1lOiAic3dpdGNoY3Vyc29ydG9vbCIsCiAgICAgIGV2ZW50RGV0YWlsczogewogICAgICAgIHRvb2w6IEN1cnNvclRvb2wuU0VMRUNUCiAgICAgIH0sCiAgICAgIGNsb3NlOiB0cnVlCiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuY3Vyc29ySGFuZFRvb2xCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogInN3aXRjaGN1cnNvcnRvb2wiLAogICAgICBldmVudERldGFpbHM6IHsKICAgICAgICB0b29sOiBDdXJzb3JUb29sLkhBTkQKICAgICAgfSwKICAgICAgY2xvc2U6IHRydWUKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy5zY3JvbGxQYWdlQnV0dG9uLAogICAgICBldmVudE5hbWU6ICJzd2l0Y2hzY3JvbGxtb2RlIiwKICAgICAgZXZlbnREZXRhaWxzOiB7CiAgICAgICAgbW9kZTogU2Nyb2xsTW9kZS5QQUdFCiAgICAgIH0sCiAgICAgIGNsb3NlOiB0cnVlCiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuc2Nyb2xsVmVydGljYWxCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogInN3aXRjaHNjcm9sbG1vZGUiLAogICAgICBldmVudERldGFpbHM6IHsKICAgICAgICBtb2RlOiBTY3JvbGxNb2RlLlZFUlRJQ0FMCiAgICAgIH0sCiAgICAgIGNsb3NlOiB0cnVlCiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuc2Nyb2xsSG9yaXpvbnRhbEJ1dHRvbiwKICAgICAgZXZlbnROYW1lOiAic3dpdGNoc2Nyb2xsbW9kZSIsCiAgICAgIGV2ZW50RGV0YWlsczogewogICAgICAgIG1vZGU6IFNjcm9sbE1vZGUuSE9SSVpPTlRBTAogICAgICB9LAogICAgICBjbG9zZTogdHJ1ZQogICAgfSwgewogICAgICBlbGVtZW50OiBvcHRpb25zLnNjcm9sbFdyYXBwZWRCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogInN3aXRjaHNjcm9sbG1vZGUiLAogICAgICBldmVudERldGFpbHM6IHsKICAgICAgICBtb2RlOiBTY3JvbGxNb2RlLldSQVBQRUQKICAgICAgfSwKICAgICAgY2xvc2U6IHRydWUKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy5zcHJlYWROb25lQnV0dG9uLAogICAgICBldmVudE5hbWU6ICJzd2l0Y2hzcHJlYWRtb2RlIiwKICAgICAgZXZlbnREZXRhaWxzOiB7CiAgICAgICAgbW9kZTogU3ByZWFkTW9kZS5OT05FCiAgICAgIH0sCiAgICAgIGNsb3NlOiB0cnVlCiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuc3ByZWFkT2RkQnV0dG9uLAogICAgICBldmVudE5hbWU6ICJzd2l0Y2hzcHJlYWRtb2RlIiwKICAgICAgZXZlbnREZXRhaWxzOiB7CiAgICAgICAgbW9kZTogU3ByZWFkTW9kZS5PREQKICAgICAgfSwKICAgICAgY2xvc2U6IHRydWUKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy5zcHJlYWRFdmVuQnV0dG9uLAogICAgICBldmVudE5hbWU6ICJzd2l0Y2hzcHJlYWRtb2RlIiwKICAgICAgZXZlbnREZXRhaWxzOiB7CiAgICAgICAgbW9kZTogU3ByZWFkTW9kZS5FVkVOCiAgICAgIH0sCiAgICAgIGNsb3NlOiB0cnVlCiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuaW1hZ2VBbHRUZXh0U2V0dGluZ3NCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogImltYWdlYWx0dGV4dHNldHRpbmdzIiwKICAgICAgY2xvc2U6IHRydWUKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy5kb2N1bWVudFByb3BlcnRpZXNCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogImRvY3VtZW50cHJvcGVydGllcyIsCiAgICAgIGNsb3NlOiB0cnVlCiAgICB9XTsKICAgIGJ1dHRvbnMucHVzaCh7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMub3BlbkZpbGVCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogIm9wZW5maWxlIiwKICAgICAgY2xvc2U6IHRydWUKICAgIH0pOwogICAgdGhpcy5ldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgdGhpcy5vcGVuZWQgPSBmYWxzZTsKICAgIHRoaXMuI2JpbmRMaXN0ZW5lcnMoYnV0dG9ucyk7CiAgICB0aGlzLnJlc2V0KCk7CiAgfQogIGdldCBpc09wZW4oKSB7CiAgICByZXR1cm4gdGhpcy5vcGVuZWQ7CiAgfQogIHNldFBhZ2VOdW1iZXIocGFnZU51bWJlcikgewogICAgdGhpcy5wYWdlTnVtYmVyID0gcGFnZU51bWJlcjsKICAgIHRoaXMuI3VwZGF0ZVVJU3RhdGUoKTsKICB9CiAgc2V0UGFnZXNDb3VudChwYWdlc0NvdW50KSB7CiAgICB0aGlzLnBhZ2VzQ291bnQgPSBwYWdlc0NvdW50OwogICAgdGhpcy4jdXBkYXRlVUlTdGF0ZSgpOwogIH0KICByZXNldCgpIHsKICAgIHRoaXMucGFnZU51bWJlciA9IDA7CiAgICB0aGlzLnBhZ2VzQ291bnQgPSAwOwogICAgdGhpcy4jdXBkYXRlVUlTdGF0ZSgpOwogICAgdGhpcy5ldmVudEJ1cy5kaXNwYXRjaCgic3dpdGNoY3Vyc29ydG9vbCIsIHsKICAgICAgc291cmNlOiB0aGlzLAogICAgICByZXNldDogdHJ1ZQogICAgfSk7CiAgICB0aGlzLiNzY3JvbGxNb2RlQ2hhbmdlZCh7CiAgICAgIG1vZGU6IFNjcm9sbE1vZGUuVkVSVElDQUwKICAgIH0pOwogICAgdGhpcy4jc3ByZWFkTW9kZUNoYW5nZWQoewogICAgICBtb2RlOiBTcHJlYWRNb2RlLk5PTkUKICAgIH0pOwogIH0KICAjdXBkYXRlVUlTdGF0ZSgpIHsKICAgIGNvbnN0IHsKICAgICAgZmlyc3RQYWdlQnV0dG9uLAogICAgICBsYXN0UGFnZUJ1dHRvbiwKICAgICAgcGFnZVJvdGF0ZUN3QnV0dG9uLAogICAgICBwYWdlUm90YXRlQ2N3QnV0dG9uCiAgICB9ID0gdGhpcy4jb3B0czsKICAgIGZpcnN0UGFnZUJ1dHRvbi5kaXNhYmxlZCA9IHRoaXMucGFnZU51bWJlciA8PSAxOwogICAgbGFzdFBhZ2VCdXR0b24uZGlzYWJsZWQgPSB0aGlzLnBhZ2VOdW1iZXIgPj0gdGhpcy5wYWdlc0NvdW50OwogICAgcGFnZVJvdGF0ZUN3QnV0dG9uLmRpc2FibGVkID0gdGhpcy5wYWdlc0NvdW50ID09PSAwOwogICAgcGFnZVJvdGF0ZUNjd0J1dHRvbi5kaXNhYmxlZCA9IHRoaXMucGFnZXNDb3VudCA9PT0gMDsKICB9CiAgI2JpbmRMaXN0ZW5lcnMoYnV0dG9ucykgewogICAgY29uc3QgewogICAgICBldmVudEJ1cwogICAgfSA9IHRoaXM7CiAgICBjb25zdCB7CiAgICAgIHRvZ2dsZUJ1dHRvbgogICAgfSA9IHRoaXMuI29wdHM7CiAgICB0b2dnbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLnRvZ2dsZS5iaW5kKHRoaXMpKTsKICAgIGZvciAoY29uc3QgewogICAgICBlbGVtZW50LAogICAgICBldmVudE5hbWUsCiAgICAgIGNsb3NlLAogICAgICBldmVudERldGFpbHMKICAgIH0gb2YgYnV0dG9ucykgewogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXZ0ID0+IHsKICAgICAgICBpZiAoZXZlbnROYW1lICE9PSBudWxsKSB7CiAgICAgICAgICBldmVudEJ1cy5kaXNwYXRjaChldmVudE5hbWUsIHsKICAgICAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgICAgICAuLi5ldmVudERldGFpbHMKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAoY2xvc2UpIHsKICAgICAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgZXZlbnRCdXMuZGlzcGF0Y2goInJlcG9ydHRlbGVtZXRyeSIsIHsKICAgICAgICAgIHNvdXJjZTogdGhpcywKICAgICAgICAgIGRldGFpbHM6IHsKICAgICAgICAgICAgdHlwZTogImJ1dHRvbnMiLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgaWQ6IGVsZW1lbnQuaWQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIGV2ZW50QnVzLl9vbigiY3Vyc29ydG9vbGNoYW5nZWQiLCB0aGlzLiNjdXJzb3JUb29sQ2hhbmdlZC5iaW5kKHRoaXMpKTsKICAgIGV2ZW50QnVzLl9vbigic2Nyb2xsbW9kZWNoYW5nZWQiLCB0aGlzLiNzY3JvbGxNb2RlQ2hhbmdlZC5iaW5kKHRoaXMpKTsKICAgIGV2ZW50QnVzLl9vbigic3ByZWFkbW9kZWNoYW5nZWQiLCB0aGlzLiNzcHJlYWRNb2RlQ2hhbmdlZC5iaW5kKHRoaXMpKTsKICB9CiAgI2N1cnNvclRvb2xDaGFuZ2VkKHsKICAgIHRvb2wsCiAgICBkaXNhYmxlZAogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgY3Vyc29yU2VsZWN0VG9vbEJ1dHRvbiwKICAgICAgY3Vyc29ySGFuZFRvb2xCdXR0b24KICAgIH0gPSB0aGlzLiNvcHRzOwogICAgdG9nZ2xlQ2hlY2tlZEJ0bihjdXJzb3JTZWxlY3RUb29sQnV0dG9uLCB0b29sID09PSBDdXJzb3JUb29sLlNFTEVDVCk7CiAgICB0b2dnbGVDaGVja2VkQnRuKGN1cnNvckhhbmRUb29sQnV0dG9uLCB0b29sID09PSBDdXJzb3JUb29sLkhBTkQpOwogICAgY3Vyc29yU2VsZWN0VG9vbEJ1dHRvbi5kaXNhYmxlZCA9IGRpc2FibGVkOwogICAgY3Vyc29ySGFuZFRvb2xCdXR0b24uZGlzYWJsZWQgPSBkaXNhYmxlZDsKICB9CiAgI3Njcm9sbE1vZGVDaGFuZ2VkKHsKICAgIG1vZGUKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIHNjcm9sbFBhZ2VCdXR0b24sCiAgICAgIHNjcm9sbFZlcnRpY2FsQnV0dG9uLAogICAgICBzY3JvbGxIb3Jpem9udGFsQnV0dG9uLAogICAgICBzY3JvbGxXcmFwcGVkQnV0dG9uLAogICAgICBzcHJlYWROb25lQnV0dG9uLAogICAgICBzcHJlYWRPZGRCdXR0b24sCiAgICAgIHNwcmVhZEV2ZW5CdXR0b24KICAgIH0gPSB0aGlzLiNvcHRzOwogICAgdG9nZ2xlQ2hlY2tlZEJ0bihzY3JvbGxQYWdlQnV0dG9uLCBtb2RlID09PSBTY3JvbGxNb2RlLlBBR0UpOwogICAgdG9nZ2xlQ2hlY2tlZEJ0bihzY3JvbGxWZXJ0aWNhbEJ1dHRvbiwgbW9kZSA9PT0gU2Nyb2xsTW9kZS5WRVJUSUNBTCk7CiAgICB0b2dnbGVDaGVja2VkQnRuKHNjcm9sbEhvcml6b250YWxCdXR0b24sIG1vZGUgPT09IFNjcm9sbE1vZGUuSE9SSVpPTlRBTCk7CiAgICB0b2dnbGVDaGVja2VkQnRuKHNjcm9sbFdyYXBwZWRCdXR0b24sIG1vZGUgPT09IFNjcm9sbE1vZGUuV1JBUFBFRCk7CiAgICBjb25zdCBmb3JjZVNjcm9sbE1vZGVQYWdlID0gdGhpcy5wYWdlc0NvdW50ID4gUGFnZXNDb3VudExpbWl0LkZPUkNFX1NDUk9MTF9NT0RFX1BBR0U7CiAgICBzY3JvbGxQYWdlQnV0dG9uLmRpc2FibGVkID0gZm9yY2VTY3JvbGxNb2RlUGFnZTsKICAgIHNjcm9sbFZlcnRpY2FsQnV0dG9uLmRpc2FibGVkID0gZm9yY2VTY3JvbGxNb2RlUGFnZTsKICAgIHNjcm9sbEhvcml6b250YWxCdXR0b24uZGlzYWJsZWQgPSBmb3JjZVNjcm9sbE1vZGVQYWdlOwogICAgc2Nyb2xsV3JhcHBlZEJ1dHRvbi5kaXNhYmxlZCA9IGZvcmNlU2Nyb2xsTW9kZVBhZ2U7CiAgICBjb25zdCBpc0hvcml6b250YWwgPSBtb2RlID09PSBTY3JvbGxNb2RlLkhPUklaT05UQUw7CiAgICBzcHJlYWROb25lQnV0dG9uLmRpc2FibGVkID0gaXNIb3Jpem9udGFsOwogICAgc3ByZWFkT2RkQnV0dG9uLmRpc2FibGVkID0gaXNIb3Jpem9udGFsOwogICAgc3ByZWFkRXZlbkJ1dHRvbi5kaXNhYmxlZCA9IGlzSG9yaXpvbnRhbDsKICB9CiAgI3NwcmVhZE1vZGVDaGFuZ2VkKHsKICAgIG1vZGUKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIHNwcmVhZE5vbmVCdXR0b24sCiAgICAgIHNwcmVhZE9kZEJ1dHRvbiwKICAgICAgc3ByZWFkRXZlbkJ1dHRvbgogICAgfSA9IHRoaXMuI29wdHM7CiAgICB0b2dnbGVDaGVja2VkQnRuKHNwcmVhZE5vbmVCdXR0b24sIG1vZGUgPT09IFNwcmVhZE1vZGUuTk9ORSk7CiAgICB0b2dnbGVDaGVja2VkQnRuKHNwcmVhZE9kZEJ1dHRvbiwgbW9kZSA9PT0gU3ByZWFkTW9kZS5PREQpOwogICAgdG9nZ2xlQ2hlY2tlZEJ0bihzcHJlYWRFdmVuQnV0dG9uLCBtb2RlID09PSBTcHJlYWRNb2RlLkVWRU4pOwogIH0KICBvcGVuKCkgewogICAgaWYgKHRoaXMub3BlbmVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMub3BlbmVkID0gdHJ1ZTsKICAgIGNvbnN0IHsKICAgICAgdG9nZ2xlQnV0dG9uLAogICAgICB0b29sYmFyCiAgICB9ID0gdGhpcy4jb3B0czsKICAgIHRvZ2dsZUV4cGFuZGVkQnRuKHRvZ2dsZUJ1dHRvbiwgdHJ1ZSwgdG9vbGJhcik7CiAgfQogIGNsb3NlKCkgewogICAgaWYgKCF0aGlzLm9wZW5lZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLm9wZW5lZCA9IGZhbHNlOwogICAgY29uc3QgewogICAgICB0b2dnbGVCdXR0b24sCiAgICAgIHRvb2xiYXIKICAgIH0gPSB0aGlzLiNvcHRzOwogICAgdG9nZ2xlRXhwYW5kZWRCdG4odG9nZ2xlQnV0dG9uLCBmYWxzZSwgdG9vbGJhcik7CiAgfQogIHRvZ2dsZSgpIHsKICAgIGlmICh0aGlzLm9wZW5lZCkgewogICAgICB0aGlzLmNsb3NlKCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLm9wZW4oKTsKICAgIH0KICB9Cn0KCjsvLyAuL3dlYi9zaWduYXR1cmVfbWFuYWdlci5qcwoKY29uc3QgREVGQVVMVF9IRUlHSFRfSU5fUEFHRSA9IDQwOwpjbGFzcyBTaWduYXR1cmVNYW5hZ2VyIHsKICAjYWRkQnV0dG9uOwogICN0YWJzVG9BbHRUZXh0ID0gbnVsbDsKICAjY2xlYXJCdXR0b247CiAgI2NsZWFyRGVzY3JpcHRpb247CiAgI2N1cnJlbnRFZGl0b3I7CiAgI2Rlc2NyaXB0aW9uOwogICNkaWFsb2c7CiAgI2RyYXdDdXJ2ZXMgPSBudWxsOwogICNkcmF3UGxhY2Vob2xkZXI7CiAgI2RyYXdQYXRoID0gbnVsbDsKICAjZHJhd1BhdGhTdHJpbmcgPSAiIjsKICAjZHJhd1BvaW50cyA9IG51bGw7CiAgI2RyYXdTVkc7CiAgI2RyYXdUaGlja25lc3M7CiAgI2Vycm9yQmFyOwogICNleHRyYWN0ZWRTaWduYXR1cmVEYXRhID0gbnVsbDsKICAjaW1hZ2VQYXRoID0gbnVsbDsKICAjaW1hZ2VQaWNrZXI7CiAgI2ltYWdlUGlja2VyTGluazsKICAjaW1hZ2VQbGFjZWhvbGRlcjsKICAjaW1hZ2VTVkc7CiAgI3NhdmVDaGVja2JveDsKICAjc2F2ZUNvbnRhaW5lcjsKICAjdGFiQnV0dG9uczsKICAjYWRkU2lnbmF0dXJlVG9vbGJhckJ1dHRvbjsKICAjbG9hZFNpZ25hdHVyZXNQcm9taXNlID0gbnVsbDsKICAjdHlwZUlucHV0OwogICNjdXJyZW50VGFiID0gbnVsbDsKICAjY3VycmVudFRhYkFDID0gbnVsbDsKICAjaGFzRGVzY3JpcHRpb25DaGFuZ2VkID0gZmFsc2U7CiAgI2V2ZW50QnVzOwogICNsMTBuOwogICNvdmVybGF5TWFuYWdlcjsKICAjZWRpdERlc2NyaXB0aW9uRGlhbG9nOwogICNzaWduYXR1cmVTdG9yYWdlOwogICN1aU1hbmFnZXIgPSBudWxsOwogIHN0YXRpYyAjbDEwbkRlc2NyaXB0aW9uID0gbnVsbDsKICBjb25zdHJ1Y3Rvcih7CiAgICBkaWFsb2csCiAgICBwYW5lbHMsCiAgICB0eXBlQnV0dG9uLAogICAgdHlwZUlucHV0LAogICAgZHJhd0J1dHRvbiwKICAgIGRyYXdQbGFjZWhvbGRlciwKICAgIGRyYXdTVkcsCiAgICBkcmF3VGhpY2tuZXNzLAogICAgaW1hZ2VCdXR0b24sCiAgICBpbWFnZVNWRywKICAgIGltYWdlUGxhY2Vob2xkZXIsCiAgICBpbWFnZVBpY2tlciwKICAgIGltYWdlUGlja2VyTGluaywKICAgIGRlc2NyaXB0aW9uLAogICAgY2xlYXJCdXR0b24sCiAgICBjYW5jZWxCdXR0b24sCiAgICBhZGRCdXR0b24sCiAgICBlcnJvckNsb3NlQnV0dG9uLAogICAgZXJyb3JCYXIsCiAgICBzYXZlQ2hlY2tib3gsCiAgICBzYXZlQ29udGFpbmVyCiAgfSwgZWRpdFNpZ25hdHVyZUVsZW1lbnRzLCBhZGRTaWduYXR1cmVUb29sYmFyQnV0dG9uLCBvdmVybGF5TWFuYWdlciwgbDEwbiwgc2lnbmF0dXJlU3RvcmFnZSwgZXZlbnRCdXMpIHsKICAgIHRoaXMuI2FkZEJ1dHRvbiA9IGFkZEJ1dHRvbjsKICAgIHRoaXMuI2NsZWFyQnV0dG9uID0gY2xlYXJCdXR0b247CiAgICB0aGlzLiNjbGVhckRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb24ubGFzdEVsZW1lbnRDaGlsZDsKICAgIHRoaXMuI2Rlc2NyaXB0aW9uID0gZGVzY3JpcHRpb24uZmlyc3RFbGVtZW50Q2hpbGQ7CiAgICB0aGlzLiNkaWFsb2cgPSBkaWFsb2c7CiAgICB0aGlzLiNkcmF3U1ZHID0gZHJhd1NWRzsKICAgIHRoaXMuI2RyYXdQbGFjZWhvbGRlciA9IGRyYXdQbGFjZWhvbGRlcjsKICAgIHRoaXMuI2RyYXdUaGlja25lc3MgPSBkcmF3VGhpY2tuZXNzOwogICAgdGhpcy4jZXJyb3JCYXIgPSBlcnJvckJhcjsKICAgIHRoaXMuI2ltYWdlU1ZHID0gaW1hZ2VTVkc7CiAgICB0aGlzLiNpbWFnZVBsYWNlaG9sZGVyID0gaW1hZ2VQbGFjZWhvbGRlcjsKICAgIHRoaXMuI2ltYWdlUGlja2VyID0gaW1hZ2VQaWNrZXI7CiAgICB0aGlzLiNpbWFnZVBpY2tlckxpbmsgPSBpbWFnZVBpY2tlckxpbms7CiAgICB0aGlzLiNvdmVybGF5TWFuYWdlciA9IG92ZXJsYXlNYW5hZ2VyOwogICAgdGhpcy4jc2F2ZUNoZWNrYm94ID0gc2F2ZUNoZWNrYm94OwogICAgdGhpcy4jc2F2ZUNvbnRhaW5lciA9IHNhdmVDb250YWluZXI7CiAgICB0aGlzLiNhZGRTaWduYXR1cmVUb29sYmFyQnV0dG9uID0gYWRkU2lnbmF0dXJlVG9vbGJhckJ1dHRvbjsKICAgIHRoaXMuI3R5cGVJbnB1dCA9IHR5cGVJbnB1dDsKICAgIHRoaXMuI2wxMG4gPSBsMTBuOwogICAgdGhpcy4jc2lnbmF0dXJlU3RvcmFnZSA9IHNpZ25hdHVyZVN0b3JhZ2U7CiAgICB0aGlzLiNldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgdGhpcy4jZWRpdERlc2NyaXB0aW9uRGlhbG9nID0gbmV3IEVkaXREZXNjcmlwdGlvbkRpYWxvZyhlZGl0U2lnbmF0dXJlRWxlbWVudHMsIG92ZXJsYXlNYW5hZ2VyKTsKICAgIFNpZ25hdHVyZU1hbmFnZXIuI2wxMG5EZXNjcmlwdGlvbiB8fD0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgIHNpZ25hdHVyZTogInBkZmpzLWVkaXRvci1hZGQtc2lnbmF0dXJlLWRlc2NyaXB0aW9uLWRlZmF1bHQtd2hlbi1kcmF3aW5nIgogICAgfSk7CiAgICBkaWFsb2cuYWRkRXZlbnRMaXN0ZW5lcigiY2xvc2UiLCB0aGlzLiNjbG9zZS5iaW5kKHRoaXMpKTsKICAgIGRpYWxvZy5hZGRFdmVudExpc3RlbmVyKCJjb250ZXh0bWVudSIsIGUgPT4gewogICAgICBjb25zdCB7CiAgICAgICAgdGFyZ2V0CiAgICAgIH0gPSBlOwogICAgICBpZiAodGFyZ2V0ICE9PSB0aGlzLiN0eXBlSW5wdXQgJiYgdGFyZ2V0ICE9PSB0aGlzLiNkZXNjcmlwdGlvbikgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgfQogICAgfSk7CiAgICBkaWFsb2cuYWRkRXZlbnRMaXN0ZW5lcigiZHJvcCIsIGUgPT4gewogICAgICBzdG9wRXZlbnQoZSk7CiAgICB9KTsKICAgIGNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuI2NhbmNlbC5iaW5kKHRoaXMpKTsKICAgIGFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuI2FkZC5iaW5kKHRoaXMpKTsKICAgIGNsZWFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICB0aGlzLiNyZXBvcnRUZWxlbWV0cnkoewogICAgICAgIHR5cGU6ICJzaWduYXR1cmUiLAogICAgICAgIGFjdGlvbjogInBkZmpzLnNpZ25hdHVyZS5jbGVhciIsCiAgICAgICAgZGF0YTogewogICAgICAgICAgdHlwZTogdGhpcy4jY3VycmVudFRhYgogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuI2luaXRUYWIobnVsbCk7CiAgICB9LCB7CiAgICAgIHBhc3NpdmU6IHRydWUKICAgIH0pOwogICAgdGhpcy4jZGVzY3JpcHRpb24uYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAoKSA9PiB7CiAgICAgIHRoaXMuI2NsZWFyRGVzY3JpcHRpb24uZGlzYWJsZWQgPSB0aGlzLiNkZXNjcmlwdGlvbi52YWx1ZSA9PT0gIiI7CiAgICB9LCB7CiAgICAgIHBhc3NpdmU6IHRydWUKICAgIH0pOwogICAgdGhpcy4jY2xlYXJEZXNjcmlwdGlvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgdGhpcy4jZGVzY3JpcHRpb24udmFsdWUgPSAiIjsKICAgICAgdGhpcy4jY2xlYXJEZXNjcmlwdGlvbi5kaXNhYmxlZCA9IHRydWU7CiAgICB9LCB7CiAgICAgIHBhc3NpdmU6IHRydWUKICAgIH0pOwogICAgZXJyb3JDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgZXJyb3JCYXIuaGlkZGVuID0gdHJ1ZTsKICAgIH0sIHsKICAgICAgcGFzc2l2ZTogdHJ1ZQogICAgfSk7CiAgICB0aGlzLiNpbml0VGFiQnV0dG9ucyh0eXBlQnV0dG9uLCBkcmF3QnV0dG9uLCBpbWFnZUJ1dHRvbiwgcGFuZWxzKTsKICAgIGltYWdlUGlja2VyLmFjY2VwdCA9IFN1cHBvcnRlZEltYWdlTWltZVR5cGVzLmpvaW4oIiwiKTsKICAgIGV2ZW50QnVzLl9vbigic3RvcmVkc2lnbmF0dXJlc2NoYW5nZWQiLCB0aGlzLiNzaWduYXR1cmVzQ2hhbmdlZC5iaW5kKHRoaXMpKTsKICAgIG92ZXJsYXlNYW5hZ2VyLnJlZ2lzdGVyKGRpYWxvZyk7CiAgfQogICNpbml0VGFiQnV0dG9ucyh0eXBlQnV0dG9uLCBkcmF3QnV0dG9uLCBpbWFnZUJ1dHRvbiwgcGFuZWxzKSB7CiAgICBjb25zdCBidXR0b25zID0gdGhpcy4jdGFiQnV0dG9ucyA9IG5ldyBNYXAoW1sidHlwZSIsIHR5cGVCdXR0b25dLCBbImRyYXciLCBkcmF3QnV0dG9uXSwgWyJpbWFnZSIsIGltYWdlQnV0dG9uXV0pOwogICAgY29uc3QgdGFiQ2FsbGJhY2sgPSBlID0+IHsKICAgICAgZm9yIChjb25zdCBbbmFtZSwgYnV0dG9uXSBvZiBidXR0b25zKSB7CiAgICAgICAgaWYgKGJ1dHRvbiA9PT0gZS50YXJnZXQpIHsKICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtc2VsZWN0ZWQiLCB0cnVlKTsKICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoInRhYmluZGV4IiwgMCk7CiAgICAgICAgICBwYW5lbHMuc2V0QXR0cmlidXRlKCJkYXRhLXNlbGVjdGVkIiwgbmFtZSk7CiAgICAgICAgICB0aGlzLiNpbml0VGFiKG5hbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKCJhcmlhLXNlbGVjdGVkIiwgZmFsc2UpOwogICAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgidGFiaW5kZXgiLCAtMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgY29uc3QgYnV0dG9uc0FycmF5ID0gQXJyYXkuZnJvbShidXR0b25zLnZhbHVlcygpKTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGJ1dHRvbnNBcnJheS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGJ1dHRvbiA9IGJ1dHRvbnNBcnJheVtpXTsKICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGFiQ2FsbGJhY2ssIHsKICAgICAgICBwYXNzaXZlOiB0cnVlCiAgICAgIH0pOwogICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsICh7CiAgICAgICAga2V5CiAgICAgIH0pID0+IHsKICAgICAgICBpZiAoa2V5ICE9PSAiQXJyb3dMZWZ0IiAmJiBrZXkgIT09ICJBcnJvd1JpZ2h0IikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBidXR0b25zQXJyYXlbaSArIChrZXkgPT09ICJBcnJvd0xlZnQiID8gLTEgOiAxKV0/LmZvY3VzKCk7CiAgICAgIH0sIHsKICAgICAgICBwYXNzaXZlOiB0cnVlCiAgICAgIH0pOwogICAgfQogIH0KICAjcmVzZXRDb21tb24oKSB7CiAgICB0aGlzLiNoYXNEZXNjcmlwdGlvbkNoYW5nZWQgPSBmYWxzZTsKICAgIHRoaXMuI2Rlc2NyaXB0aW9uLnZhbHVlID0gIiI7CiAgICBpZiAodGhpcy4jY3VycmVudFRhYikgewogICAgICB0aGlzLiN0YWJzVG9BbHRUZXh0LmdldCh0aGlzLiNjdXJyZW50VGFiKS52YWx1ZSA9ICIiOwogICAgfQogIH0KICAjcmVzZXRUYWIobmFtZSkgewogICAgc3dpdGNoIChuYW1lKSB7CiAgICAgIGNhc2UgInR5cGUiOgogICAgICAgIHRoaXMuI3R5cGVJbnB1dC52YWx1ZSA9ICIiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJkcmF3IjoKICAgICAgICB0aGlzLiNkcmF3Q3VydmVzID0gbnVsbDsKICAgICAgICB0aGlzLiNkcmF3UG9pbnRzID0gbnVsbDsKICAgICAgICB0aGlzLiNkcmF3UGF0aFN0cmluZyA9ICIiOwogICAgICAgIHRoaXMuI2RyYXdQYXRoPy5yZW1vdmUoKTsKICAgICAgICB0aGlzLiNkcmF3UGF0aCA9IG51bGw7CiAgICAgICAgdGhpcy4jZHJhd1BsYWNlaG9sZGVyLmhpZGRlbiA9IGZhbHNlOwogICAgICAgIHRoaXMuI2RyYXdUaGlja25lc3MudmFsdWUgPSAxOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJpbWFnZSI6CiAgICAgICAgdGhpcy4jaW1hZ2VQbGFjZWhvbGRlci5oaWRkZW4gPSBmYWxzZTsKICAgICAgICB0aGlzLiNpbWFnZVBhdGg/LnJlbW92ZSgpOwogICAgICAgIHRoaXMuI2ltYWdlUGF0aCA9IG51bGw7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQogICNpbml0VGFiKG5hbWUpIHsKICAgIGlmIChuYW1lICYmIHRoaXMuI2N1cnJlbnRUYWIgPT09IG5hbWUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuI2N1cnJlbnRUYWIpIHsKICAgICAgdGhpcy4jdGFic1RvQWx0VGV4dC5nZXQodGhpcy4jY3VycmVudFRhYikudmFsdWUgPSB0aGlzLiNkZXNjcmlwdGlvbi52YWx1ZTsKICAgIH0KICAgIGlmIChuYW1lKSB7CiAgICAgIHRoaXMuI2N1cnJlbnRUYWIgPSBuYW1lOwogICAgfQogICAgdGhpcy4jZXJyb3JCYXIuaGlkZGVuID0gdHJ1ZTsKICAgIGNvbnN0IHJlc2V0ID0gIW5hbWU7CiAgICBpZiAocmVzZXQpIHsKICAgICAgdGhpcy4jcmVzZXRDb21tb24oKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuI2Rlc2NyaXB0aW9uLnZhbHVlID0gdGhpcy4jdGFic1RvQWx0VGV4dC5nZXQodGhpcy4jY3VycmVudFRhYikudmFsdWU7CiAgICB9CiAgICB0aGlzLiNjbGVhckRlc2NyaXB0aW9uLmRpc2FibGVkID0gdGhpcy4jZGVzY3JpcHRpb24udmFsdWUgPT09ICIiOwogICAgdGhpcy4jY3VycmVudFRhYkFDPy5hYm9ydCgpOwogICAgdGhpcy4jY3VycmVudFRhYkFDID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgc3dpdGNoICh0aGlzLiNjdXJyZW50VGFiKSB7CiAgICAgIGNhc2UgInR5cGUiOgogICAgICAgIHRoaXMuI2luaXRUeXBlVGFiKHJlc2V0KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiZHJhdyI6CiAgICAgICAgdGhpcy4jaW5pdERyYXdUYWIocmVzZXQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJpbWFnZSI6CiAgICAgICAgdGhpcy4jaW5pdEltYWdlVGFiKHJlc2V0KTsKICAgICAgICBicmVhazsKICAgIH0KICB9CiAgI2Rpc2FibGVCdXR0b25zKHZhbHVlKSB7CiAgICB0aGlzLiNzYXZlQ2hlY2tib3guZGlzYWJsZWQgPSB0aGlzLiNjbGVhckJ1dHRvbi5kaXNhYmxlZCA9IHRoaXMuI2FkZEJ1dHRvbi5kaXNhYmxlZCA9IHRoaXMuI2Rlc2NyaXB0aW9uLmRpc2FibGVkID0gIXZhbHVlOwogIH0KICAjaW5pdFR5cGVUYWIocmVzZXQpIHsKICAgIGlmIChyZXNldCkgewogICAgICB0aGlzLiNyZXNldFRhYigidHlwZSIpOwogICAgfQogICAgdGhpcy4jZGlzYWJsZUJ1dHRvbnModGhpcy4jdHlwZUlucHV0LnZhbHVlKTsKICAgIGNvbnN0IHsKICAgICAgc2lnbmFsCiAgICB9ID0gdGhpcy4jY3VycmVudFRhYkFDOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgcGFzc2l2ZTogdHJ1ZSwKICAgICAgc2lnbmFsCiAgICB9OwogICAgdGhpcy4jdHlwZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKCkgPT4gewogICAgICBjb25zdCB7CiAgICAgICAgdmFsdWUKICAgICAgfSA9IHRoaXMuI3R5cGVJbnB1dDsKICAgICAgaWYgKCF0aGlzLiNoYXNEZXNjcmlwdGlvbkNoYW5nZWQpIHsKICAgICAgICB0aGlzLiN0YWJzVG9BbHRUZXh0LmdldCgidHlwZSIpLmRlZmF1bHQgPSB0aGlzLiNkZXNjcmlwdGlvbi52YWx1ZSA9IHZhbHVlOwogICAgICAgIHRoaXMuI2NsZWFyRGVzY3JpcHRpb24uZGlzYWJsZWQgPSB2YWx1ZSA9PT0gIiI7CiAgICAgIH0KICAgICAgdGhpcy4jZGlzYWJsZUJ1dHRvbnModmFsdWUpOwogICAgfSwgb3B0aW9ucyk7CiAgICB0aGlzLiNkZXNjcmlwdGlvbi5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHsKICAgICAgdGhpcy4jaGFzRGVzY3JpcHRpb25DaGFuZ2VkID0gdGhpcy4jdHlwZUlucHV0LnZhbHVlICE9PSB0aGlzLiNkZXNjcmlwdGlvbi52YWx1ZTsKICAgIH0sIG9wdGlvbnMpOwogIH0KICAjaW5pdERyYXdUYWIocmVzZXQpIHsKICAgIGlmIChyZXNldCkgewogICAgICB0aGlzLiNyZXNldFRhYigiZHJhdyIpOwogICAgfQogICAgdGhpcy4jZGlzYWJsZUJ1dHRvbnModGhpcy4jZHJhd1BhdGgpOwogICAgY29uc3QgewogICAgICBzaWduYWwKICAgIH0gPSB0aGlzLiNjdXJyZW50VGFiQUM7CiAgICBjb25zdCBvcHRpb25zID0gewogICAgICBzaWduYWwKICAgIH07CiAgICBsZXQgY3VycmVudFBvaW50ZXJJZCA9IE5hTjsKICAgIGNvbnN0IGRyYXdDYWxsYmFjayA9IGUgPT4gewogICAgICBjb25zdCB7CiAgICAgICAgcG9pbnRlcklkCiAgICAgIH0gPSBlOwogICAgICBpZiAoIWlzTmFOKGN1cnJlbnRQb2ludGVySWQpICYmIGN1cnJlbnRQb2ludGVySWQgIT09IHBvaW50ZXJJZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjdXJyZW50UG9pbnRlcklkID0gcG9pbnRlcklkOwogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHRoaXMuI2RyYXdTVkcuc2V0UG9pbnRlckNhcHR1cmUocG9pbnRlcklkKTsKICAgICAgY29uc3QgewogICAgICAgIHdpZHRoOiBkcmF3V2lkdGgsCiAgICAgICAgaGVpZ2h0OiBkcmF3SGVpZ2h0CiAgICAgIH0gPSB0aGlzLiNkcmF3U1ZHLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICBsZXQgewogICAgICAgIG9mZnNldFgsCiAgICAgICAgb2Zmc2V0WQogICAgICB9ID0gZTsKICAgICAgb2Zmc2V0WCA9IE1hdGgucm91bmQob2Zmc2V0WCk7CiAgICAgIG9mZnNldFkgPSBNYXRoLnJvdW5kKG9mZnNldFkpOwogICAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMuI2RyYXdQbGFjZWhvbGRlcikgewogICAgICAgIHRoaXMuI2RyYXdQbGFjZWhvbGRlci5oaWRkZW4gPSB0cnVlOwogICAgICB9CiAgICAgIGlmICghdGhpcy4jZHJhd0N1cnZlcykgewogICAgICAgIHRoaXMuI2RyYXdDdXJ2ZXMgPSB7CiAgICAgICAgICB3aWR0aDogZHJhd1dpZHRoLAogICAgICAgICAgaGVpZ2h0OiBkcmF3SGVpZ2h0LAogICAgICAgICAgdGhpY2tuZXNzOiBwYXJzZUludCh0aGlzLiNkcmF3VGhpY2tuZXNzLnZhbHVlKSwKICAgICAgICAgIGN1cnZlczogW10KICAgICAgICB9OwogICAgICAgIHRoaXMuI2Rpc2FibGVCdXR0b25zKHRydWUpOwogICAgICAgIGNvbnN0IHN2Z0ZhY3RvcnkgPSBuZXcgRE9NU1ZHRmFjdG9yeSgpOwogICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLiNkcmF3UGF0aCA9IHN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgicGF0aCIpOwogICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCJzdHJva2Utd2lkdGgiLCB0aGlzLiNkcmF3VGhpY2tuZXNzLnZhbHVlKTsKICAgICAgICB0aGlzLiNkcmF3U1ZHLmFwcGVuZChwYXRoKTsKICAgICAgICB0aGlzLiNkcmF3U1ZHLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgZHJhd0NhbGxiYWNrLCBvcHRpb25zKTsKICAgICAgICB0aGlzLiNkcmF3UGxhY2Vob2xkZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBkcmF3Q2FsbGJhY2spOwogICAgICAgIGlmICh0aGlzLiNkZXNjcmlwdGlvbi52YWx1ZSA9PT0gIiIpIHsKICAgICAgICAgIHRoaXMuI2wxMG4uZ2V0KFNpZ25hdHVyZU1hbmFnZXIuI2wxMG5EZXNjcmlwdGlvbi5zaWduYXR1cmUpLnRoZW4oZGVzY3JpcHRpb24gPT4gewogICAgICAgICAgICB0aGlzLiN0YWJzVG9BbHRUZXh0LmdldCgiZHJhdyIpLmRlZmF1bHQgPSBkZXNjcmlwdGlvbjsKICAgICAgICAgICAgdGhpcy4jZGVzY3JpcHRpb24udmFsdWUgfHw9IGRlc2NyaXB0aW9uOwogICAgICAgICAgICB0aGlzLiNjbGVhckRlc2NyaXB0aW9uLmRpc2FibGVkID0gdGhpcy4jZGVzY3JpcHRpb24udmFsdWUgPT09ICIiOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuI2RyYXdQb2ludHMgPSBbb2Zmc2V0WCwgb2Zmc2V0WV07CiAgICAgIHRoaXMuI2RyYXdDdXJ2ZXMuY3VydmVzLnB1c2goewogICAgICAgIHBvaW50czogdGhpcy4jZHJhd1BvaW50cwogICAgICB9KTsKICAgICAgdGhpcy4jZHJhd1BhdGhTdHJpbmcgKz0gYE0gJHtvZmZzZXRYfSAke29mZnNldFl9YDsKICAgICAgdGhpcy4jZHJhd1BhdGguc2V0QXR0cmlidXRlKCJkIiwgdGhpcy4jZHJhd1BhdGhTdHJpbmcpOwogICAgICBjb25zdCBmaW5pc2hEcmF3QUMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICAgIGNvbnN0IGxpc3RlbmVyRHJhd09wdGlvbnMgPSB7CiAgICAgICAgc2lnbmFsOiBBYm9ydFNpZ25hbC5hbnkoW3NpZ25hbCwgZmluaXNoRHJhd0FDLnNpZ25hbF0pCiAgICAgIH07CiAgICAgIHRoaXMuI2RyYXdTVkcuYWRkRXZlbnRMaXN0ZW5lcigiY29udGV4dG1lbnUiLCBub0NvbnRleHRNZW51LCBsaXN0ZW5lckRyYXdPcHRpb25zKTsKICAgICAgdGhpcy4jZHJhd1NWRy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIGV2dCA9PiB7CiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgbGV0IHsKICAgICAgICAgIG9mZnNldFg6IHgsCiAgICAgICAgICBvZmZzZXRZOiB5CiAgICAgICAgfSA9IGV2dDsKICAgICAgICB4ID0gTWF0aC5yb3VuZCh4KTsKICAgICAgICB5ID0gTWF0aC5yb3VuZCh5KTsKICAgICAgICBjb25zdCBkcmF3UG9pbnRzID0gdGhpcy4jZHJhd1BvaW50czsKICAgICAgICBpZiAoeCA8IDAgfHwgeSA8IDAgfHwgeCA+IGRyYXdXaWR0aCB8fCB5ID4gZHJhd0hlaWdodCB8fCB4ID09PSBkcmF3UG9pbnRzLmF0KC0yKSAmJiB5ID09PSBkcmF3UG9pbnRzLmF0KC0xKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoZHJhd1BvaW50cy5sZW5ndGggPj0gNCkgewogICAgICAgICAgY29uc3QgW3gxLCB5MSwgeDIsIHkyXSA9IGRyYXdQb2ludHMuc2xpY2UoLTQpOwogICAgICAgICAgdGhpcy4jZHJhd1BhdGhTdHJpbmcgKz0gYEMkeyh4MSArIDUgKiB4MikgLyA2fSAkeyh5MSArIDUgKiB5MikgLyA2fSAkeyg1ICogeDIgKyB4KSAvIDZ9ICR7KDUgKiB5MiArIHkpIC8gNn0gJHsoeDIgKyB4KSAvIDJ9ICR7KHkyICsgeSkgLyAyfWA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuI2RyYXdQYXRoU3RyaW5nICs9IGBMJHt4fSAke3l9YDsKICAgICAgICB9CiAgICAgICAgZHJhd1BvaW50cy5wdXNoKHgsIHkpOwogICAgICAgIHRoaXMuI2RyYXdQYXRoLnNldEF0dHJpYnV0ZSgiZCIsIHRoaXMuI2RyYXdQYXRoU3RyaW5nKTsKICAgICAgfSwgbGlzdGVuZXJEcmF3T3B0aW9ucyk7CiAgICAgIHRoaXMuI2RyYXdTVkcuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgZXZ0ID0+IHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBwb2ludGVySWQ6IHBJZAogICAgICAgIH0gPSBldnQ7CiAgICAgICAgaWYgKCFpc05hTihjdXJyZW50UG9pbnRlcklkKSAmJiBjdXJyZW50UG9pbnRlcklkICE9PSBwSWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY3VycmVudFBvaW50ZXJJZCA9IE5hTjsKICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB0aGlzLiNkcmF3U1ZHLnJlbGVhc2VQb2ludGVyQ2FwdHVyZShwSWQpOwogICAgICAgIGZpbmlzaERyYXdBQy5hYm9ydCgpOwogICAgICAgIGlmICh0aGlzLiNkcmF3UG9pbnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgdGhpcy4jZHJhd1BhdGhTdHJpbmcgKz0gYEwke3RoaXMuI2RyYXdQb2ludHNbMF19ICR7dGhpcy4jZHJhd1BvaW50c1sxXX1gOwogICAgICAgICAgdGhpcy4jZHJhd1BhdGguc2V0QXR0cmlidXRlKCJkIiwgdGhpcy4jZHJhd1BhdGhTdHJpbmcpOwogICAgICAgIH0KICAgICAgfSwgbGlzdGVuZXJEcmF3T3B0aW9ucyk7CiAgICB9OwogICAgaWYgKHRoaXMuI2RyYXdDdXJ2ZXMpIHsKICAgICAgdGhpcy4jZHJhd1NWRy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIGRyYXdDYWxsYmFjaywgb3B0aW9ucyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLiNkcmF3UGxhY2Vob2xkZXIuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBkcmF3Q2FsbGJhY2ssIG9wdGlvbnMpOwogICAgfQogICAgdGhpcy4jZHJhd1RoaWNrbmVzcy5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHsKICAgICAgY29uc3QgewogICAgICAgIHZhbHVlOiB0aGlja25lc3MKICAgICAgfSA9IHRoaXMuI2RyYXdUaGlja25lc3M7CiAgICAgIHRoaXMuI2RyYXdUaGlja25lc3Muc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4tYXJncyIsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICB0aGlja25lc3MKICAgICAgfSkpOwogICAgICBpZiAoIXRoaXMuI2RyYXdDdXJ2ZXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy4jZHJhd1BhdGguc2V0QXR0cmlidXRlKCJzdHJva2Utd2lkdGgiLCB0aGlja25lc3MpOwogICAgICB0aGlzLiNkcmF3Q3VydmVzLnRoaWNrbmVzcyA9IHRoaWNrbmVzczsKICAgIH0sIG9wdGlvbnMpOwogIH0KICAjaW5pdEltYWdlVGFiKHJlc2V0KSB7CiAgICBpZiAocmVzZXQpIHsKICAgICAgdGhpcy4jcmVzZXRUYWIoImltYWdlIik7CiAgICB9CiAgICB0aGlzLiNkaXNhYmxlQnV0dG9ucyh0aGlzLiNpbWFnZVBhdGgpOwogICAgY29uc3QgewogICAgICBzaWduYWwKICAgIH0gPSB0aGlzLiNjdXJyZW50VGFiQUM7CiAgICBjb25zdCBvcHRpb25zID0gewogICAgICBzaWduYWwKICAgIH07CiAgICBjb25zdCBwYXNzaXZlT3B0aW9ucyA9IHsKICAgICAgcGFzc2l2ZTogdHJ1ZSwKICAgICAgc2lnbmFsCiAgICB9OwogICAgdGhpcy4jaW1hZ2VQaWNrZXJMaW5rLmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBlID0+IHsKICAgICAgY29uc3QgewogICAgICAgIGtleQogICAgICB9ID0gZTsKICAgICAgaWYgKGtleSA9PT0gIkVudGVyIiB8fCBrZXkgPT09ICIgIikgewogICAgICAgIHN0b3BFdmVudChlKTsKICAgICAgICB0aGlzLiNpbWFnZVBpY2tlci5jbGljaygpOwogICAgICB9CiAgICB9LCBvcHRpb25zKTsKICAgIHRoaXMuI2ltYWdlUGlja2VyLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICB0aGlzLiNkaWFsb2cuY2xhc3NMaXN0LnRvZ2dsZSgid2FpdGluZyIsIHRydWUpOwogICAgfSwgcGFzc2l2ZU9wdGlvbnMpOwogICAgdGhpcy4jaW1hZ2VQaWNrZXIuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgYXN5bmMgKCkgPT4gewogICAgICBjb25zdCBmaWxlID0gdGhpcy4jaW1hZ2VQaWNrZXIuZmlsZXM/LlswXTsKICAgICAgaWYgKCFmaWxlIHx8ICFTdXBwb3J0ZWRJbWFnZU1pbWVUeXBlcy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7CiAgICAgICAgdGhpcy4jZXJyb3JCYXIuaGlkZGVuID0gZmFsc2U7CiAgICAgICAgdGhpcy4jZGlhbG9nLmNsYXNzTGlzdC50b2dnbGUoIndhaXRpbmciLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGF3YWl0IHRoaXMuI2V4dHJhY3RTaWduYXR1cmUoZmlsZSk7CiAgICB9LCBwYXNzaXZlT3B0aW9ucyk7CiAgICB0aGlzLiNpbWFnZVBpY2tlci5hZGRFdmVudExpc3RlbmVyKCJjYW5jZWwiLCAoKSA9PiB7CiAgICAgIHRoaXMuI2RpYWxvZy5jbGFzc0xpc3QudG9nZ2xlKCJ3YWl0aW5nIiwgZmFsc2UpOwogICAgfSwgcGFzc2l2ZU9wdGlvbnMpOwogICAgdGhpcy4jaW1hZ2VQbGFjZWhvbGRlci5hZGRFdmVudExpc3RlbmVyKCJkcmFnb3ZlciIsIGUgPT4gewogICAgICBjb25zdCB7CiAgICAgICAgZGF0YVRyYW5zZmVyCiAgICAgIH0gPSBlOwogICAgICBmb3IgKGNvbnN0IHsKICAgICAgICB0eXBlCiAgICAgIH0gb2YgZGF0YVRyYW5zZmVyLml0ZW1zKSB7CiAgICAgICAgaWYgKCFTdXBwb3J0ZWRJbWFnZU1pbWVUeXBlcy5pbmNsdWRlcyh0eXBlKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gZGF0YVRyYW5zZmVyLmVmZmVjdEFsbG93ZWQgPT09ICJjb3B5IiA/ICJjb3B5IiA6ICJtb3ZlIjsKICAgICAgICBzdG9wRXZlbnQoZSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gIm5vbmUiOwogICAgfSwgb3B0aW9ucyk7CiAgICB0aGlzLiNpbWFnZVBsYWNlaG9sZGVyLmFkZEV2ZW50TGlzdGVuZXIoImRyb3AiLCBlID0+IHsKICAgICAgY29uc3QgewogICAgICAgIGRhdGFUcmFuc2ZlcjogewogICAgICAgICAgZmlsZXMKICAgICAgICB9CiAgICAgIH0gPSBlOwogICAgICBpZiAoIWZpbGVzPy5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7CiAgICAgICAgaWYgKFN1cHBvcnRlZEltYWdlTWltZVR5cGVzLmluY2x1ZGVzKGZpbGUudHlwZSkpIHsKICAgICAgICAgIHRoaXMuI2V4dHJhY3RTaWduYXR1cmUoZmlsZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgc3RvcEV2ZW50KGUpOwogICAgICB0aGlzLiNkaWFsb2cuY2xhc3NMaXN0LnRvZ2dsZSgid2FpdGluZyIsIHRydWUpOwogICAgfSwgb3B0aW9ucyk7CiAgfQogIGFzeW5jICNleHRyYWN0U2lnbmF0dXJlKGZpbGUpIHsKICAgIGxldCBkYXRhOwogICAgdHJ5IHsKICAgICAgZGF0YSA9IGF3YWl0IHRoaXMuI3VpTWFuYWdlci5pbWFnZU1hbmFnZXIuZ2V0RnJvbUZpbGUoZmlsZSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIlNpZ25hdHVyZU1hbmFnZXIuI2V4dHJhY3RTaWduYXR1cmUuIiwgZSk7CiAgICB9CiAgICBpZiAoIWRhdGEpIHsKICAgICAgdGhpcy4jZXJyb3JCYXIuaGlkZGVuID0gZmFsc2U7CiAgICAgIHRoaXMuI2RpYWxvZy5jbGFzc0xpc3QudG9nZ2xlKCJ3YWl0aW5nIiwgZmFsc2UpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIG91dGxpbmUKICAgIH0gPSB0aGlzLiNleHRyYWN0ZWRTaWduYXR1cmVEYXRhID0gdGhpcy4jY3VycmVudEVkaXRvci5nZXRGcm9tSW1hZ2UoZGF0YS5iaXRtYXApOwogICAgaWYgKCFvdXRsaW5lKSB7CiAgICAgIHRoaXMuI2RpYWxvZy5jbGFzc0xpc3QudG9nZ2xlKCJ3YWl0aW5nIiwgZmFsc2UpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNpbWFnZVBsYWNlaG9sZGVyLmhpZGRlbiA9IHRydWU7CiAgICB0aGlzLiNkaXNhYmxlQnV0dG9ucyh0cnVlKTsKICAgIGNvbnN0IHN2Z0ZhY3RvcnkgPSBuZXcgRE9NU1ZHRmFjdG9yeSgpOwogICAgY29uc3QgcGF0aCA9IHRoaXMuI2ltYWdlUGF0aCA9IHN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgicGF0aCIpOwogICAgdGhpcy4jaW1hZ2VTVkcuc2V0QXR0cmlidXRlKCJ2aWV3Qm94Iiwgb3V0bGluZS52aWV3Qm94KTsKICAgIHRoaXMuI2ltYWdlU1ZHLnNldEF0dHJpYnV0ZSgicHJlc2VydmVBc3BlY3RSYXRpbyIsICJ4TWlkWU1pZCBtZWV0Iik7CiAgICB0aGlzLiNpbWFnZVNWRy5hcHBlbmQocGF0aCk7CiAgICBwYXRoLnNldEF0dHJpYnV0ZSgiZCIsIG91dGxpbmUudG9TVkdQYXRoKCkpOwogICAgdGhpcy4jdGFic1RvQWx0VGV4dC5nZXQoImltYWdlIikuZGVmYXVsdCA9IGZpbGUubmFtZTsKICAgIGlmICh0aGlzLiNkZXNjcmlwdGlvbi52YWx1ZSA9PT0gIiIpIHsKICAgICAgdGhpcy4jZGVzY3JpcHRpb24udmFsdWUgPSBmaWxlLm5hbWUgfHwgIiI7CiAgICAgIHRoaXMuI2NsZWFyRGVzY3JpcHRpb24uZGlzYWJsZWQgPSB0aGlzLiNkZXNjcmlwdGlvbi52YWx1ZSA9PT0gIiI7CiAgICB9CiAgICB0aGlzLiNkaWFsb2cuY2xhc3NMaXN0LnRvZ2dsZSgid2FpdGluZyIsIGZhbHNlKTsKICB9CiAgI2dldE91dGxpbmVGb3JUeXBlKCkgewogICAgcmV0dXJuIHRoaXMuI2N1cnJlbnRFZGl0b3IuZ2V0RnJvbVRleHQodGhpcy4jdHlwZUlucHV0LnZhbHVlLCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLiN0eXBlSW5wdXQpKTsKICB9CiAgI2dldE91dGxpbmVGb3JEcmF3KCkgewogICAgY29uc3QgewogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gdGhpcy4jZHJhd1NWRy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIHJldHVybiB0aGlzLiNjdXJyZW50RWRpdG9yLmdldERyYXduU2lnbmF0dXJlKHRoaXMuI2RyYXdDdXJ2ZXMsIHdpZHRoLCBoZWlnaHQpOwogIH0KICAjcmVwb3J0VGVsZW1ldHJ5KGRhdGEpIHsKICAgIHRoaXMuI2V2ZW50QnVzLmRpc3BhdGNoKCJyZXBvcnR0ZWxlbWV0cnkiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgZGV0YWlsczogewogICAgICAgIHR5cGU6ICJlZGl0aW5nIiwKICAgICAgICBkYXRhCiAgICAgIH0KICAgIH0pOwogIH0KICAjYWRkVG9vbGJhckJ1dHRvbihzaWduYXR1cmVEYXRhLCB1dWlkLCBkZXNjcmlwdGlvbikgewogICAgY29uc3QgewogICAgICBjdXJ2ZXMsCiAgICAgIGFyZUNvbnRvdXJzLAogICAgICB0aGlja25lc3MsCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSBzaWduYXR1cmVEYXRhOwogICAgY29uc3QgbWF4RGltID0gTWF0aC5tYXgod2lkdGgsIGhlaWdodCk7CiAgICBjb25zdCBvdXRsaW5lRGF0YSA9IFNpZ25hdHVyZUV4dHJhY3Rvci5wcm9jZXNzRHJhd25MaW5lcyh7CiAgICAgIGxpbmVzOiB7CiAgICAgICAgY3VydmVzLAogICAgICAgIHRoaWNrbmVzcywKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQKICAgICAgfSwKICAgICAgcGFnZVdpZHRoOiBtYXhEaW0sCiAgICAgIHBhZ2VIZWlnaHQ6IG1heERpbSwKICAgICAgcm90YXRpb246IDAsCiAgICAgIGlubmVyTWFyZ2luOiAwLAogICAgICBtdXN0U21vb3RoOiBmYWxzZSwKICAgICAgYXJlQ29udG91cnMKICAgIH0pOwogICAgaWYgKCFvdXRsaW5lRGF0YSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIG91dGxpbmUKICAgIH0gPSBvdXRsaW5lRGF0YTsKICAgIGNvbnN0IHN2Z0ZhY3RvcnkgPSBuZXcgRE9NU1ZHRmFjdG9yeSgpOwogICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgdGhpcy4jZXZlbnRCdXMuZGlzcGF0Y2goInN3aXRjaGFubm90YXRpb25lZGl0b3JwYXJhbXMiLCB7CiAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgIHR5cGU6IEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlLkNSRUFURSwKICAgICAgICB2YWx1ZTogewogICAgICAgICAgc2lnbmF0dXJlRGF0YTogewogICAgICAgICAgICBsaW5lczogewogICAgICAgICAgICAgIGN1cnZlcywKICAgICAgICAgICAgICB0aGlja25lc3MsCiAgICAgICAgICAgICAgd2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG11c3RTbW9vdGg6IGZhbHNlLAogICAgICAgICAgICBhcmVDb250b3VycywKICAgICAgICAgICAgZGVzY3JpcHRpb24sCiAgICAgICAgICAgIHV1aWQsCiAgICAgICAgICAgIGhlaWdodEluUGFnZTogREVGQVVMVF9IRUlHSFRfSU5fUEFHRQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgIGRpdi5hcHBlbmQoYnV0dG9uKTsKICAgIGRpdi5jbGFzc0xpc3QuYWRkKCJ0b29sYmFyQWRkU2lnbmF0dXJlQnV0dG9uQ29udGFpbmVyIik7CiAgICBjb25zdCBzdmcgPSBzdmdGYWN0b3J5LmNyZWF0ZSgxLCAxLCB0cnVlKTsKICAgIGJ1dHRvbi5hcHBlbmQoc3ZnKTsKICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICBzcGFuLmFyaWFIaWRkZW4gPSB0cnVlOwogICAgYnV0dG9uLmFwcGVuZChzcGFuKTsKICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJ0b29sYmFyQWRkU2lnbmF0dXJlQnV0dG9uIik7CiAgICBidXR0b24udHlwZSA9ICJidXR0b24iOwogICAgc3Bhbi50ZXh0Q29udGVudCA9IGRlc2NyaXB0aW9uOwogICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWlkIiwgInBkZmpzLWVkaXRvci1hZGQtc2F2ZWQtc2lnbmF0dXJlLWJ1dHRvbiIpOwogICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWFyZ3MiLCBKU09OLnN0cmluZ2lmeSh7CiAgICAgIGRlc2NyaXB0aW9uCiAgICB9KSk7CiAgICBidXR0b24udGFiSW5kZXggPSAwOwogICAgY29uc3QgcGF0aCA9IHN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgicGF0aCIpOwogICAgc3ZnLmFwcGVuZChwYXRoKTsKICAgIHN2Zy5zZXRBdHRyaWJ1dGUoInZpZXdCb3giLCBvdXRsaW5lLnZpZXdCb3gpOwogICAgc3ZnLnNldEF0dHJpYnV0ZSgicHJlc2VydmVBc3BlY3RSYXRpbyIsICJ4TWlkWU1pZCBtZWV0Iik7CiAgICBpZiAoYXJlQ29udG91cnMpIHsKICAgICAgcGF0aC5jbGFzc0xpc3QuYWRkKCJjb250b3VycyIpOwogICAgfQogICAgcGF0aC5zZXRBdHRyaWJ1dGUoImQiLCBvdXRsaW5lLnRvU1ZHUGF0aCgpKTsKICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgZGl2LmFwcGVuZChkZWxldGVCdXR0b24pOwogICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoInRvb2xiYXJCdXR0b24iLCAiZGVsZXRlQnV0dG9uIik7CiAgICBkZWxldGVCdXR0b24uc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCAicGRmanMtZWRpdG9yLWRlbGV0ZS1zaWduYXR1cmUtYnV0dG9uMSIpOwogICAgZGVsZXRlQnV0dG9uLnR5cGUgPSAiYnV0dG9uIjsKICAgIGRlbGV0ZUJ1dHRvbi50YWJJbmRleCA9IDA7CiAgICBkZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBhc3luYyAoKSA9PiB7CiAgICAgIGlmIChhd2FpdCB0aGlzLiNzaWduYXR1cmVTdG9yYWdlLmRlbGV0ZSh1dWlkKSkgewogICAgICAgIGRpdi5yZW1vdmUoKTsKICAgICAgICB0aGlzLiNyZXBvcnRUZWxlbWV0cnkoewogICAgICAgICAgdHlwZTogInNpZ25hdHVyZSIsCiAgICAgICAgICBhY3Rpb246ICJwZGZqcy5zaWduYXR1cmUuZGVsZXRlX3NhdmVkIiwKICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgc2F2ZWRDb3VudDogYXdhaXQgdGhpcy4jc2lnbmF0dXJlU3RvcmFnZS5zaXplKCkKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgICBjb25zdCBkZWxldGVTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgZGVsZXRlQnV0dG9uLmFwcGVuZChkZWxldGVTcGFuKTsKICAgIGRlbGV0ZVNwYW4uc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCAicGRmanMtZWRpdG9yLWRlbGV0ZS1zaWduYXR1cmUtYnV0dG9uLWxhYmVsMSIpOwogICAgdGhpcy4jYWRkU2lnbmF0dXJlVG9vbGJhckJ1dHRvbi5iZWZvcmUoZGl2KTsKICB9CiAgYXN5bmMgI3NpZ25hdHVyZXNDaGFuZ2VkKCkgewogICAgY29uc3QgcGFyZW50ID0gdGhpcy4jYWRkU2lnbmF0dXJlVG9vbGJhckJ1dHRvbi5wYXJlbnRFbGVtZW50OwogICAgd2hpbGUgKHBhcmVudC5maXJzdEVsZW1lbnRDaGlsZCAhPT0gdGhpcy4jYWRkU2lnbmF0dXJlVG9vbGJhckJ1dHRvbikgewogICAgICBwYXJlbnQuZmlyc3RFbGVtZW50Q2hpbGQucmVtb3ZlKCk7CiAgICB9CiAgICB0aGlzLiNsb2FkU2lnbmF0dXJlc1Byb21pc2UgPSBudWxsOwogICAgYXdhaXQgdGhpcy5sb2FkU2lnbmF0dXJlcyh0cnVlKTsKICB9CiAgZ2V0U2lnbmF0dXJlKHBhcmFtcykgewogICAgcmV0dXJuIHRoaXMub3BlbihwYXJhbXMpOwogIH0KICBhc3luYyBsb2FkU2lnbmF0dXJlcyhyZWxvYWQgPSBmYWxzZSkgewogICAgaWYgKCF0aGlzLiNhZGRTaWduYXR1cmVUb29sYmFyQnV0dG9uIHx8ICFyZWxvYWQgJiYgdGhpcy4jYWRkU2lnbmF0dXJlVG9vbGJhckJ1dHRvbi5wcmV2aW91c0VsZW1lbnRTaWJsaW5nIHx8ICF0aGlzLiNzaWduYXR1cmVTdG9yYWdlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpcy4jbG9hZFNpZ25hdHVyZXNQcm9taXNlKSB7CiAgICAgIHRoaXMuI2xvYWRTaWduYXR1cmVzUHJvbWlzZSA9IHRoaXMuI3NpZ25hdHVyZVN0b3JhZ2UuZ2V0QWxsKCkudGhlbihhc3luYyBzaWduYXR1cmVzID0+IFtzaWduYXR1cmVzLCBhd2FpdCBQcm9taXNlLmFsbChBcnJheS5mcm9tKHNpZ25hdHVyZXMudmFsdWVzKCksICh7CiAgICAgICAgc2lnbmF0dXJlRGF0YQogICAgICB9KSA9PiBTaWduYXR1cmVFeHRyYWN0b3IuZGVjb21wcmVzc1NpZ25hdHVyZShzaWduYXR1cmVEYXRhKSkpXSk7CiAgICAgIGlmICghcmVsb2FkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICBjb25zdCBbc2lnbmF0dXJlcywgc2lnbmF0dXJlc0RhdGFdID0gYXdhaXQgdGhpcy4jbG9hZFNpZ25hdHVyZXNQcm9taXNlOwogICAgdGhpcy4jbG9hZFNpZ25hdHVyZXNQcm9taXNlID0gbnVsbDsKICAgIGxldCBpID0gMDsKICAgIGZvciAoY29uc3QgW3V1aWQsIHsKICAgICAgZGVzY3JpcHRpb24KICAgIH1dIG9mIHNpZ25hdHVyZXMpIHsKICAgICAgY29uc3QgZGF0YSA9IHNpZ25hdHVyZXNEYXRhW2krK107CiAgICAgIGlmICghZGF0YSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGRhdGEuY3VydmVzID0gZGF0YS5vdXRsaW5lcy5tYXAocG9pbnRzID0+ICh7CiAgICAgICAgcG9pbnRzCiAgICAgIH0pKTsKICAgICAgZGVsZXRlIGRhdGEub3V0bGluZXM7CiAgICAgIHRoaXMuI2FkZFRvb2xiYXJCdXR0b24oZGF0YSwgdXVpZCwgZGVzY3JpcHRpb24pOwogICAgfQogIH0KICBhc3luYyByZW5kZXJFZGl0QnV0dG9uKGVkaXRvcikgewogICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICBidXR0b24uY2xhc3NMaXN0LmFkZCgiYWx0VGV4dCIsICJlZGl0RGVzY3JpcHRpb24iKTsKICAgIGJ1dHRvbi50YWJJbmRleCA9IDA7CiAgICBidXR0b24udGl0bGUgPSBlZGl0b3IuZGVzY3JpcHRpb247CiAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgYnV0dG9uLmFwcGVuZChzcGFuKTsKICAgIHNwYW4uc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCAicGRmanMtZWRpdG9yLWFkZC1zaWduYXR1cmUtZWRpdC1idXR0b24tbGFiZWwiKTsKICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgdGhpcy4jZWRpdERlc2NyaXB0aW9uRGlhbG9nLm9wZW4oZWRpdG9yKTsKICAgIH0sIHsKICAgICAgcGFzc2l2ZTogdHJ1ZQogICAgfSk7CiAgICByZXR1cm4gYnV0dG9uOwogIH0KICBhc3luYyBvcGVuKHsKICAgIHVpTWFuYWdlciwKICAgIGVkaXRvcgogIH0pIHsKICAgIHRoaXMuI3RhYnNUb0FsdFRleHQgfHw9IG5ldyBNYXAodGhpcy4jdGFiQnV0dG9ucy5rZXlzKCkubWFwKG5hbWUgPT4gW25hbWUsIHsKICAgICAgdmFsdWU6ICIiLAogICAgICBkZWZhdWx0OiAiIgogICAgfV0pKTsKICAgIHRoaXMuI3VpTWFuYWdlciA9IHVpTWFuYWdlcjsKICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IgPSBlZGl0b3I7CiAgICB0aGlzLiN1aU1hbmFnZXIucmVtb3ZlRWRpdExpc3RlbmVycygpOwogICAgY29uc3QgaXNTdG9yYWdlRnVsbCA9IGF3YWl0IHRoaXMuI3NpZ25hdHVyZVN0b3JhZ2UuaXNGdWxsKCk7CiAgICB0aGlzLiNzYXZlQ29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoImZ1bGxTdG9yYWdlIiwgaXNTdG9yYWdlRnVsbCk7CiAgICB0aGlzLiNzYXZlQ2hlY2tib3guY2hlY2tlZCA9ICFpc1N0b3JhZ2VGdWxsOwogICAgYXdhaXQgdGhpcy4jb3ZlcmxheU1hbmFnZXIub3Blbih0aGlzLiNkaWFsb2cpOwogICAgY29uc3QgdGFiVHlwZSA9IHRoaXMuI3RhYkJ1dHRvbnMuZ2V0KCJ0eXBlIik7CiAgICB0YWJUeXBlLmZvY3VzKCk7CiAgICB0YWJUeXBlLmNsaWNrKCk7CiAgfQogICNjYW5jZWwoKSB7CiAgICB0aGlzLiNmaW5pc2goKTsKICB9CiAgI2ZpbmlzaCgpIHsKICAgIHRoaXMuI292ZXJsYXlNYW5hZ2VyLmNsb3NlSWZBY3RpdmUodGhpcy4jZGlhbG9nKTsKICB9CiAgI2Nsb3NlKCkgewogICAgaWYgKHRoaXMuI2N1cnJlbnRFZGl0b3IuX2RyYXdJZCA9PT0gbnVsbCkgewogICAgICB0aGlzLiNjdXJyZW50RWRpdG9yLnJlbW92ZSgpOwogICAgfQogICAgdGhpcy4jdWlNYW5hZ2VyPy5hZGRFZGl0TGlzdGVuZXJzKCk7CiAgICB0aGlzLiNjdXJyZW50VGFiQUM/LmFib3J0KCk7CiAgICB0aGlzLiNjdXJyZW50VGFiQUMgPSBudWxsOwogICAgdGhpcy4jdWlNYW5hZ2VyID0gbnVsbDsKICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IgPSBudWxsOwogICAgdGhpcy4jcmVzZXRDb21tb24oKTsKICAgIGZvciAoY29uc3QgW25hbWVdIG9mIHRoaXMuI3RhYkJ1dHRvbnMpIHsKICAgICAgdGhpcy4jcmVzZXRUYWIobmFtZSk7CiAgICB9CiAgICB0aGlzLiNkaXNhYmxlQnV0dG9ucyhmYWxzZSk7CiAgICB0aGlzLiNjdXJyZW50VGFiID0gbnVsbDsKICAgIHRoaXMuI3RhYnNUb0FsdFRleHQgPSBudWxsOwogIH0KICBhc3luYyAjYWRkKCkgewogICAgbGV0IGRhdGE7CiAgICBjb25zdCB0eXBlID0gdGhpcy4jY3VycmVudFRhYjsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICJ0eXBlIjoKICAgICAgICBkYXRhID0gdGhpcy4jZ2V0T3V0bGluZUZvclR5cGUoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiZHJhdyI6CiAgICAgICAgZGF0YSA9IHRoaXMuI2dldE91dGxpbmVGb3JEcmF3KCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImltYWdlIjoKICAgICAgICBkYXRhID0gdGhpcy4jZXh0cmFjdGVkU2lnbmF0dXJlRGF0YTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGxldCB1dWlkID0gbnVsbDsKICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gdGhpcy4jZGVzY3JpcHRpb24udmFsdWU7CiAgICBpZiAodGhpcy4jc2F2ZUNoZWNrYm94LmNoZWNrZWQpIHsKICAgICAgY29uc3QgewogICAgICAgIG5ld0N1cnZlcywKICAgICAgICBhcmVDb250b3VycywKICAgICAgICB0aGlja25lc3MsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0gPSBkYXRhOwogICAgICBjb25zdCBzaWduYXR1cmVEYXRhID0gYXdhaXQgU2lnbmF0dXJlRXh0cmFjdG9yLmNvbXByZXNzU2lnbmF0dXJlKHsKICAgICAgICBvdXRsaW5lczogbmV3Q3VydmVzLAogICAgICAgIGFyZUNvbnRvdXJzLAogICAgICAgIHRoaWNrbmVzcywKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQKICAgICAgfSk7CiAgICAgIHV1aWQgPSBhd2FpdCB0aGlzLiNzaWduYXR1cmVTdG9yYWdlLmNyZWF0ZSh7CiAgICAgICAgZGVzY3JpcHRpb24sCiAgICAgICAgc2lnbmF0dXJlRGF0YQogICAgICB9KTsKICAgICAgaWYgKHV1aWQpIHsKICAgICAgICB0aGlzLiNhZGRUb29sYmFyQnV0dG9uKHsKICAgICAgICAgIGN1cnZlczogbmV3Q3VydmVzLm1hcChwb2ludHMgPT4gKHsKICAgICAgICAgICAgcG9pbnRzCiAgICAgICAgICB9KSksCiAgICAgICAgICBhcmVDb250b3VycywKICAgICAgICAgIHRoaWNrbmVzcywKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0CiAgICAgICAgfSwgdXVpZCwgZGVzY3JpcHRpb24pOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUud2FybigiU2lnbmF0dXJlTWFuYWdlci5hZGQ6IGNhbm5vdCBzYXZlIHRoZSBzaWduYXR1cmUuIik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGFsdFRleHQgPSB0aGlzLiN0YWJzVG9BbHRUZXh0LmdldCh0eXBlKTsKICAgIHRoaXMuI3JlcG9ydFRlbGVtZXRyeSh7CiAgICAgIHR5cGU6ICJzaWduYXR1cmUiLAogICAgICBhY3Rpb246ICJwZGZqcy5zaWduYXR1cmUuY3JlYXRlZCIsCiAgICAgIGRhdGE6IHsKICAgICAgICB0eXBlLAogICAgICAgIHNhdmVkOiAhIXV1aWQsCiAgICAgICAgc2F2ZWRDb3VudDogYXdhaXQgdGhpcy4jc2lnbmF0dXJlU3RvcmFnZS5zaXplKCksCiAgICAgICAgZGVzY3JpcHRpb25DaGFuZ2VkOiBkZXNjcmlwdGlvbiAhPT0gYWx0VGV4dC5kZWZhdWx0CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy4jY3VycmVudEVkaXRvci5hZGRTaWduYXR1cmUoZGF0YSwgREVGQVVMVF9IRUlHSFRfSU5fUEFHRSwgdGhpcy4jZGVzY3JpcHRpb24udmFsdWUsIHV1aWQpOwogICAgdGhpcy4jZmluaXNoKCk7CiAgfQogIGRlc3Ryb3koKSB7CiAgICB0aGlzLiN1aU1hbmFnZXIgPSBudWxsOwogICAgdGhpcy4jZmluaXNoKCk7CiAgfQp9CmNsYXNzIEVkaXREZXNjcmlwdGlvbkRpYWxvZyB7CiAgI2N1cnJlbnRFZGl0b3I7CiAgI3ByZXZpb3VzRGVzY3JpcHRpb247CiAgI2Rlc2NyaXB0aW9uOwogICNkaWFsb2c7CiAgI292ZXJsYXlNYW5hZ2VyOwogICNzaWduYXR1cmVTVkc7CiAgI3VpTWFuYWdlcjsKICBjb25zdHJ1Y3Rvcih7CiAgICBkaWFsb2csCiAgICBkZXNjcmlwdGlvbiwKICAgIGNhbmNlbEJ1dHRvbiwKICAgIHVwZGF0ZUJ1dHRvbiwKICAgIGVkaXRTaWduYXR1cmVWaWV3CiAgfSwgb3ZlcmxheU1hbmFnZXIpIHsKICAgIGNvbnN0IGRlc2NyaXB0aW9uSW5wdXQgPSB0aGlzLiNkZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uLmZpcnN0RWxlbWVudENoaWxkOwogICAgdGhpcy4jc2lnbmF0dXJlU1ZHID0gZWRpdFNpZ25hdHVyZVZpZXc7CiAgICB0aGlzLiNkaWFsb2cgPSBkaWFsb2c7CiAgICB0aGlzLiNvdmVybGF5TWFuYWdlciA9IG92ZXJsYXlNYW5hZ2VyOwogICAgZGlhbG9nLmFkZEV2ZW50TGlzdGVuZXIoImNsb3NlIiwgdGhpcy4jY2xvc2UuYmluZCh0aGlzKSk7CiAgICBkaWFsb2cuYWRkRXZlbnRMaXN0ZW5lcigiY29udGV4dG1lbnUiLCBlID0+IHsKICAgICAgaWYgKGUudGFyZ2V0ICE9PSB0aGlzLiNkZXNjcmlwdGlvbikgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgfQogICAgfSk7CiAgICBjYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLiNjYW5jZWwuYmluZCh0aGlzKSk7CiAgICB1cGRhdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCB0aGlzLiN1cGRhdGUuYmluZCh0aGlzKSk7CiAgICBjb25zdCBjbGVhckRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb24ubGFzdEVsZW1lbnRDaGlsZDsKICAgIGNsZWFyRGVzY3JpcHRpb24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIGRlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSAiIjsKICAgICAgY2xlYXJEZXNjcmlwdGlvbi5kaXNhYmxlZCA9IHRydWU7CiAgICAgIHVwZGF0ZUJ1dHRvbi5kaXNhYmxlZCA9IHRoaXMuI3ByZXZpb3VzRGVzY3JpcHRpb24gPT09ICIiOwogICAgfSk7CiAgICBkZXNjcmlwdGlvbklucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKCkgPT4gewogICAgICBjb25zdCB7CiAgICAgICAgdmFsdWUKICAgICAgfSA9IGRlc2NyaXB0aW9uSW5wdXQ7CiAgICAgIGNsZWFyRGVzY3JpcHRpb24uZGlzYWJsZWQgPSB2YWx1ZSA9PT0gIiI7CiAgICAgIHVwZGF0ZUJ1dHRvbi5kaXNhYmxlZCA9IHZhbHVlID09PSB0aGlzLiNwcmV2aW91c0Rlc2NyaXB0aW9uOwogICAgICBlZGl0U2lnbmF0dXJlVmlldy5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiLCB2YWx1ZSk7CiAgICB9LCB7CiAgICAgIHBhc3NpdmU6IHRydWUKICAgIH0pOwogICAgb3ZlcmxheU1hbmFnZXIucmVnaXN0ZXIoZGlhbG9nKTsKICB9CiAgYXN5bmMgb3BlbihlZGl0b3IpIHsKICAgIHRoaXMuI3VpTWFuYWdlciA9IGVkaXRvci5fdWlNYW5hZ2VyOwogICAgdGhpcy4jY3VycmVudEVkaXRvciA9IGVkaXRvcjsKICAgIHRoaXMuI3ByZXZpb3VzRGVzY3JpcHRpb24gPSB0aGlzLiNkZXNjcmlwdGlvbi52YWx1ZSA9IGVkaXRvci5kZXNjcmlwdGlvbjsKICAgIHRoaXMuI2Rlc2NyaXB0aW9uLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJpbnB1dCIpKTsKICAgIHRoaXMuI3VpTWFuYWdlci5yZW1vdmVFZGl0TGlzdGVuZXJzKCk7CiAgICBjb25zdCB7CiAgICAgIGFyZUNvbnRvdXJzLAogICAgICBvdXRsaW5lCiAgICB9ID0gZWRpdG9yLmdldFNpZ25hdHVyZVByZXZpZXcoKTsKICAgIGNvbnN0IHN2Z0ZhY3RvcnkgPSBuZXcgRE9NU1ZHRmFjdG9yeSgpOwogICAgY29uc3QgcGF0aCA9IHN2Z0ZhY3RvcnkuY3JlYXRlRWxlbWVudCgicGF0aCIpOwogICAgdGhpcy4jc2lnbmF0dXJlU1ZHLmFwcGVuZChwYXRoKTsKICAgIHRoaXMuI3NpZ25hdHVyZVNWRy5zZXRBdHRyaWJ1dGUoInZpZXdCb3giLCBvdXRsaW5lLnZpZXdCb3gpOwogICAgcGF0aC5zZXRBdHRyaWJ1dGUoImQiLCBvdXRsaW5lLnRvU1ZHUGF0aCgpKTsKICAgIGlmIChhcmVDb250b3VycykgewogICAgICBwYXRoLmNsYXNzTGlzdC5hZGQoImNvbnRvdXJzIik7CiAgICB9CiAgICBhd2FpdCB0aGlzLiNvdmVybGF5TWFuYWdlci5vcGVuKHRoaXMuI2RpYWxvZyk7CiAgfQogIGFzeW5jICN1cGRhdGUoKSB7CiAgICB0aGlzLiNjdXJyZW50RWRpdG9yLl9yZXBvcnRUZWxlbWV0cnkoewogICAgICBhY3Rpb246ICJwZGZqcy5zaWduYXR1cmUuZWRpdF9kZXNjcmlwdGlvbiIsCiAgICAgIGRhdGE6IHsKICAgICAgICBoYXNCZWVuQ2hhbmdlZDogdHJ1ZQogICAgICB9CiAgICB9KTsKICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IuZGVzY3JpcHRpb24gPSB0aGlzLiNkZXNjcmlwdGlvbi52YWx1ZTsKICAgIHRoaXMuI2ZpbmlzaCgpOwogIH0KICAjY2FuY2VsKCkgewogICAgdGhpcy4jY3VycmVudEVkaXRvci5fcmVwb3J0VGVsZW1ldHJ5KHsKICAgICAgYWN0aW9uOiAicGRmanMuc2lnbmF0dXJlLmVkaXRfZGVzY3JpcHRpb24iLAogICAgICBkYXRhOiB7CiAgICAgICAgaGFzQmVlbkNoYW5nZWQ6IGZhbHNlCiAgICAgIH0KICAgIH0pOwogICAgdGhpcy4jZmluaXNoKCk7CiAgfQogICNmaW5pc2goKSB7CiAgICB0aGlzLiNvdmVybGF5TWFuYWdlci5jbG9zZUlmQWN0aXZlKHRoaXMuI2RpYWxvZyk7CiAgfQogICNjbG9zZSgpIHsKICAgIHRoaXMuI3VpTWFuYWdlcj8uYWRkRWRpdExpc3RlbmVycygpOwogICAgdGhpcy4jdWlNYW5hZ2VyID0gbnVsbDsKICAgIHRoaXMuI2N1cnJlbnRFZGl0b3IgPSBudWxsOwogICAgdGhpcy4jc2lnbmF0dXJlU1ZHLmZpcnN0RWxlbWVudENoaWxkLnJlbW92ZSgpOwogIH0KfQoKOy8vIC4vd2ViL3Rvb2xiYXIuanMKCgpjbGFzcyBUb29sYmFyIHsKICAjY29sb3JQaWNrZXIgPSBudWxsOwogICNvcHRzOwogIGNvbnN0cnVjdG9yKG9wdGlvbnMsIGV2ZW50QnVzLCB0b29sYmFyRGVuc2l0eSA9IDApIHsKICAgIHRoaXMuI29wdHMgPSBvcHRpb25zOwogICAgdGhpcy5ldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgY29uc3QgYnV0dG9ucyA9IFt7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMucHJldmlvdXMsCiAgICAgIGV2ZW50TmFtZTogInByZXZpb3VzcGFnZSIKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy5uZXh0LAogICAgICBldmVudE5hbWU6ICJuZXh0cGFnZSIKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy56b29tSW4sCiAgICAgIGV2ZW50TmFtZTogInpvb21pbiIKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy56b29tT3V0LAogICAgICBldmVudE5hbWU6ICJ6b29tb3V0IgogICAgfSwgewogICAgICBlbGVtZW50OiBvcHRpb25zLnByaW50LAogICAgICBldmVudE5hbWU6ICJwcmludCIKICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy5kb3dubG9hZCwKICAgICAgZXZlbnROYW1lOiAiZG93bmxvYWQiCiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuZWRpdG9yRnJlZVRleHRCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogInN3aXRjaGFubm90YXRpb25lZGl0b3Jtb2RlIiwKICAgICAgZXZlbnREZXRhaWxzOiB7CiAgICAgICAgZ2V0IG1vZGUoKSB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGNsYXNzTGlzdAogICAgICAgICAgfSA9IG9wdGlvbnMuZWRpdG9yRnJlZVRleHRCdXR0b247CiAgICAgICAgICByZXR1cm4gY2xhc3NMaXN0LmNvbnRhaW5zKCJ0b2dnbGVkIikgPyBBbm5vdGF0aW9uRWRpdG9yVHlwZS5OT05FIDogQW5ub3RhdGlvbkVkaXRvclR5cGUuRlJFRVRFWFQ7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuZWRpdG9ySGlnaGxpZ2h0QnV0dG9uLAogICAgICBldmVudE5hbWU6ICJzd2l0Y2hhbm5vdGF0aW9uZWRpdG9ybW9kZSIsCiAgICAgIGV2ZW50RGV0YWlsczogewogICAgICAgIGdldCBtb2RlKCkgewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBjbGFzc0xpc3QKICAgICAgICAgIH0gPSBvcHRpb25zLmVkaXRvckhpZ2hsaWdodEJ1dHRvbjsKICAgICAgICAgIHJldHVybiBjbGFzc0xpc3QuY29udGFpbnMoInRvZ2dsZWQiKSA/IEFubm90YXRpb25FZGl0b3JUeXBlLk5PTkUgOiBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ISUdITElHSFQ7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuZWRpdG9ySW5rQnV0dG9uLAogICAgICBldmVudE5hbWU6ICJzd2l0Y2hhbm5vdGF0aW9uZWRpdG9ybW9kZSIsCiAgICAgIGV2ZW50RGV0YWlsczogewogICAgICAgIGdldCBtb2RlKCkgewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBjbGFzc0xpc3QKICAgICAgICAgIH0gPSBvcHRpb25zLmVkaXRvcklua0J1dHRvbjsKICAgICAgICAgIHJldHVybiBjbGFzc0xpc3QuY29udGFpbnMoInRvZ2dsZWQiKSA/IEFubm90YXRpb25FZGl0b3JUeXBlLk5PTkUgOiBBbm5vdGF0aW9uRWRpdG9yVHlwZS5JTks7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGVsZW1lbnQ6IG9wdGlvbnMuZWRpdG9yU3RhbXBCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogInN3aXRjaGFubm90YXRpb25lZGl0b3Jtb2RlIiwKICAgICAgZXZlbnREZXRhaWxzOiB7CiAgICAgICAgZ2V0IG1vZGUoKSB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGNsYXNzTGlzdAogICAgICAgICAgfSA9IG9wdGlvbnMuZWRpdG9yU3RhbXBCdXR0b247CiAgICAgICAgICByZXR1cm4gY2xhc3NMaXN0LmNvbnRhaW5zKCJ0b2dnbGVkIikgPyBBbm5vdGF0aW9uRWRpdG9yVHlwZS5OT05FIDogQW5ub3RhdGlvbkVkaXRvclR5cGUuU1RBTVA7CiAgICAgICAgfQogICAgICB9LAogICAgICB0ZWxlbWV0cnk6IHsKICAgICAgICB0eXBlOiAiZWRpdGluZyIsCiAgICAgICAgZGF0YTogewogICAgICAgICAgYWN0aW9uOiAicGRmanMuaW1hZ2UuaWNvbl9jbGljayIKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAgZWxlbWVudDogb3B0aW9ucy5lZGl0b3JTaWduYXR1cmVCdXR0b24sCiAgICAgIGV2ZW50TmFtZTogInN3aXRjaGFubm90YXRpb25lZGl0b3Jtb2RlIiwKICAgICAgZXZlbnREZXRhaWxzOiB7CiAgICAgICAgZ2V0IG1vZGUoKSB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGNsYXNzTGlzdAogICAgICAgICAgfSA9IG9wdGlvbnMuZWRpdG9yU2lnbmF0dXJlQnV0dG9uOwogICAgICAgICAgcmV0dXJuIGNsYXNzTGlzdC5jb250YWlucygidG9nZ2xlZCIpID8gQW5ub3RhdGlvbkVkaXRvclR5cGUuTk9ORSA6IEFubm90YXRpb25FZGl0b3JUeXBlLlNJR05BVFVSRTsKICAgICAgICB9CiAgICAgIH0KICAgIH1dOwogICAgdGhpcy4jYmluZExpc3RlbmVycyhidXR0b25zKTsKICAgIHRoaXMuI3VwZGF0ZVRvb2xiYXJEZW5zaXR5KHsKICAgICAgdmFsdWU6IHRvb2xiYXJEZW5zaXR5CiAgICB9KTsKICAgIHRoaXMucmVzZXQoKTsKICB9CiAgI3VwZGF0ZVRvb2xiYXJEZW5zaXR5KHsKICAgIHZhbHVlCiAgfSkgewogICAgbGV0IG5hbWUgPSAibm9ybWFsIjsKICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgY2FzZSAxOgogICAgICAgIG5hbWUgPSAiY29tcGFjdCI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjoKICAgICAgICBuYW1lID0gInRvdWNoIjsKICAgICAgICBicmVhazsKICAgIH0KICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtdG9vbGJhci1kZW5zaXR5IiwgbmFtZSk7CiAgfQogIHNldFBhZ2VOdW1iZXIocGFnZU51bWJlciwgcGFnZUxhYmVsKSB7CiAgICB0aGlzLnBhZ2VOdW1iZXIgPSBwYWdlTnVtYmVyOwogICAgdGhpcy5wYWdlTGFiZWwgPSBwYWdlTGFiZWw7CiAgICB0aGlzLiN1cGRhdGVVSVN0YXRlKGZhbHNlKTsKICB9CiAgc2V0UGFnZXNDb3VudChwYWdlc0NvdW50LCBoYXNQYWdlTGFiZWxzKSB7CiAgICB0aGlzLnBhZ2VzQ291bnQgPSBwYWdlc0NvdW50OwogICAgdGhpcy5oYXNQYWdlTGFiZWxzID0gaGFzUGFnZUxhYmVsczsKICAgIHRoaXMuI3VwZGF0ZVVJU3RhdGUodHJ1ZSk7CiAgfQogIHNldFBhZ2VTY2FsZShwYWdlU2NhbGVWYWx1ZSwgcGFnZVNjYWxlKSB7CiAgICB0aGlzLnBhZ2VTY2FsZVZhbHVlID0gKHBhZ2VTY2FsZVZhbHVlIHx8IHBhZ2VTY2FsZSkudG9TdHJpbmcoKTsKICAgIHRoaXMucGFnZVNjYWxlID0gcGFnZVNjYWxlOwogICAgdGhpcy4jdXBkYXRlVUlTdGF0ZShmYWxzZSk7CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy4jY29sb3JQaWNrZXIgPSBudWxsOwogICAgdGhpcy5wYWdlTnVtYmVyID0gMDsKICAgIHRoaXMucGFnZUxhYmVsID0gbnVsbDsKICAgIHRoaXMuaGFzUGFnZUxhYmVscyA9IGZhbHNlOwogICAgdGhpcy5wYWdlc0NvdW50ID0gMDsKICAgIHRoaXMucGFnZVNjYWxlVmFsdWUgPSBERUZBVUxUX1NDQUxFX1ZBTFVFOwogICAgdGhpcy5wYWdlU2NhbGUgPSBERUZBVUxUX1NDQUxFOwogICAgdGhpcy4jdXBkYXRlVUlTdGF0ZSh0cnVlKTsKICAgIHRoaXMudXBkYXRlTG9hZGluZ0luZGljYXRvclN0YXRlKCk7CiAgICB0aGlzLiNlZGl0b3JNb2RlQ2hhbmdlZCh7CiAgICAgIG1vZGU6IEFubm90YXRpb25FZGl0b3JUeXBlLkRJU0FCTEUKICAgIH0pOwogIH0KICAjYmluZExpc3RlbmVycyhidXR0b25zKSB7CiAgICBjb25zdCB7CiAgICAgIGV2ZW50QnVzCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHsKICAgICAgZWRpdG9ySGlnaGxpZ2h0Q29sb3JQaWNrZXIsCiAgICAgIGVkaXRvckhpZ2hsaWdodEJ1dHRvbiwKICAgICAgcGFnZU51bWJlciwKICAgICAgc2NhbGVTZWxlY3QKICAgIH0gPSB0aGlzLiNvcHRzOwogICAgY29uc3Qgc2VsZiA9IHRoaXM7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgZWxlbWVudCwKICAgICAgZXZlbnROYW1lLAogICAgICBldmVudERldGFpbHMsCiAgICAgIHRlbGVtZXRyeQogICAgfSBvZiBidXR0b25zKSB7CiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBldnQgPT4gewogICAgICAgIGlmIChldmVudE5hbWUgIT09IG51bGwpIHsKICAgICAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKGV2ZW50TmFtZSwgewogICAgICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgICAgIC4uLmV2ZW50RGV0YWlscywKICAgICAgICAgICAgaXNGcm9tS2V5Ym9hcmQ6IGV2dC5kZXRhaWwgPT09IDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAodGVsZW1ldHJ5KSB7CiAgICAgICAgICBldmVudEJ1cy5kaXNwYXRjaCgicmVwb3J0dGVsZW1ldHJ5IiwgewogICAgICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgICAgIGRldGFpbHM6IHRlbGVtZXRyeQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIHBhZ2VOdW1iZXIuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuc2VsZWN0KCk7CiAgICB9KTsKICAgIHBhZ2VOdW1iZXIuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZnVuY3Rpb24gKCkgewogICAgICBldmVudEJ1cy5kaXNwYXRjaCgicGFnZW51bWJlcmNoYW5nZWQiLCB7CiAgICAgICAgc291cmNlOiBzZWxmLAogICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlCiAgICAgIH0pOwogICAgfSk7CiAgICBzY2FsZVNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLnZhbHVlID09PSAiY3VzdG9tIikgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBldmVudEJ1cy5kaXNwYXRjaCgic2NhbGVjaGFuZ2VkIiwgewogICAgICAgIHNvdXJjZTogc2VsZiwKICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZQogICAgICB9KTsKICAgIH0pOwogICAgc2NhbGVTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoewogICAgICB0YXJnZXQKICAgIH0pIHsKICAgICAgaWYgKHRoaXMudmFsdWUgPT09IHNlbGYucGFnZVNjYWxlVmFsdWUgJiYgdGFyZ2V0LnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PT0gIk9QVElPTiIpIHsKICAgICAgICB0aGlzLmJsdXIoKTsKICAgICAgfQogICAgfSk7CiAgICBzY2FsZVNlbGVjdC5vbmNvbnRleHRtZW51ID0gbm9Db250ZXh0TWVudTsKICAgIGV2ZW50QnVzLl9vbigiYW5ub3RhdGlvbmVkaXRvcm1vZGVjaGFuZ2VkIiwgdGhpcy4jZWRpdG9yTW9kZUNoYW5nZWQuYmluZCh0aGlzKSk7CiAgICBldmVudEJ1cy5fb24oInNob3dhbm5vdGF0aW9uZWRpdG9ydWkiLCAoewogICAgICBtb2RlCiAgICB9KSA9PiB7CiAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuSElHSExJR0hUOgogICAgICAgICAgZWRpdG9ySGlnaGxpZ2h0QnV0dG9uLmNsaWNrKCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSk7CiAgICBldmVudEJ1cy5fb24oInRvb2xiYXJkZW5zaXR5IiwgdGhpcy4jdXBkYXRlVG9vbGJhckRlbnNpdHkuYmluZCh0aGlzKSk7CiAgICBpZiAoZWRpdG9ySGlnaGxpZ2h0Q29sb3JQaWNrZXIpIHsKICAgICAgZXZlbnRCdXMuX29uKCJhbm5vdGF0aW9uZWRpdG9ydWltYW5hZ2VyIiwgKHsKICAgICAgICB1aU1hbmFnZXIKICAgICAgfSkgPT4gewogICAgICAgIGNvbnN0IGNwID0gdGhpcy4jY29sb3JQaWNrZXIgPSBuZXcgQ29sb3JQaWNrZXIoewogICAgICAgICAgdWlNYW5hZ2VyCiAgICAgICAgfSk7CiAgICAgICAgdWlNYW5hZ2VyLnNldE1haW5IaWdobGlnaHRDb2xvclBpY2tlcihjcCk7CiAgICAgICAgZWRpdG9ySGlnaGxpZ2h0Q29sb3JQaWNrZXIuYXBwZW5kKGNwLnJlbmRlck1haW5Ecm9wZG93bigpKTsKICAgICAgfSk7CiAgICAgIGV2ZW50QnVzLl9vbigibWFpbmhpZ2hsaWdodGNvbG9ycGlja2VydXBkYXRlY29sb3IiLCAoewogICAgICAgIHZhbHVlCiAgICAgIH0pID0+IHsKICAgICAgICB0aGlzLiNjb2xvclBpY2tlcj8udXBkYXRlQ29sb3IodmFsdWUpOwogICAgICB9KTsKICAgIH0KICB9CiAgI2VkaXRvck1vZGVDaGFuZ2VkKHsKICAgIG1vZGUKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIGVkaXRvckZyZWVUZXh0QnV0dG9uLAogICAgICBlZGl0b3JGcmVlVGV4dFBhcmFtc1Rvb2xiYXIsCiAgICAgIGVkaXRvckhpZ2hsaWdodEJ1dHRvbiwKICAgICAgZWRpdG9ySGlnaGxpZ2h0UGFyYW1zVG9vbGJhciwKICAgICAgZWRpdG9ySW5rQnV0dG9uLAogICAgICBlZGl0b3JJbmtQYXJhbXNUb29sYmFyLAogICAgICBlZGl0b3JTdGFtcEJ1dHRvbiwKICAgICAgZWRpdG9yU3RhbXBQYXJhbXNUb29sYmFyLAogICAgICBlZGl0b3JTaWduYXR1cmVCdXR0b24sCiAgICAgIGVkaXRvclNpZ25hdHVyZVBhcmFtc1Rvb2xiYXIKICAgIH0gPSB0aGlzLiNvcHRzOwogICAgdG9nZ2xlRXhwYW5kZWRCdG4oZWRpdG9yRnJlZVRleHRCdXR0b24sIG1vZGUgPT09IEFubm90YXRpb25FZGl0b3JUeXBlLkZSRUVURVhULCBlZGl0b3JGcmVlVGV4dFBhcmFtc1Rvb2xiYXIpOwogICAgdG9nZ2xlRXhwYW5kZWRCdG4oZWRpdG9ySGlnaGxpZ2h0QnV0dG9uLCBtb2RlID09PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ISUdITElHSFQsIGVkaXRvckhpZ2hsaWdodFBhcmFtc1Rvb2xiYXIpOwogICAgdG9nZ2xlRXhwYW5kZWRCdG4oZWRpdG9ySW5rQnV0dG9uLCBtb2RlID09PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5JTkssIGVkaXRvcklua1BhcmFtc1Rvb2xiYXIpOwogICAgdG9nZ2xlRXhwYW5kZWRCdG4oZWRpdG9yU3RhbXBCdXR0b24sIG1vZGUgPT09IEFubm90YXRpb25FZGl0b3JUeXBlLlNUQU1QLCBlZGl0b3JTdGFtcFBhcmFtc1Rvb2xiYXIpOwogICAgdG9nZ2xlRXhwYW5kZWRCdG4oZWRpdG9yU2lnbmF0dXJlQnV0dG9uLCBtb2RlID09PSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5TSUdOQVRVUkUsIGVkaXRvclNpZ25hdHVyZVBhcmFtc1Rvb2xiYXIpOwogICAgY29uc3QgaXNEaXNhYmxlID0gbW9kZSA9PT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuRElTQUJMRTsKICAgIGVkaXRvckZyZWVUZXh0QnV0dG9uLmRpc2FibGVkID0gaXNEaXNhYmxlOwogICAgZWRpdG9ySGlnaGxpZ2h0QnV0dG9uLmRpc2FibGVkID0gaXNEaXNhYmxlOwogICAgZWRpdG9ySW5rQnV0dG9uLmRpc2FibGVkID0gaXNEaXNhYmxlOwogICAgZWRpdG9yU3RhbXBCdXR0b24uZGlzYWJsZWQgPSBpc0Rpc2FibGU7CiAgICBlZGl0b3JTaWduYXR1cmVCdXR0b24uZGlzYWJsZWQgPSBpc0Rpc2FibGU7CiAgfQogICN1cGRhdGVVSVN0YXRlKHJlc2V0TnVtUGFnZXMgPSBmYWxzZSkgewogICAgY29uc3QgewogICAgICBwYWdlTnVtYmVyLAogICAgICBwYWdlc0NvdW50LAogICAgICBwYWdlU2NhbGVWYWx1ZSwKICAgICAgcGFnZVNjYWxlCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IG9wdHMgPSB0aGlzLiNvcHRzOwogICAgaWYgKHJlc2V0TnVtUGFnZXMpIHsKICAgICAgaWYgKHRoaXMuaGFzUGFnZUxhYmVscykgewogICAgICAgIG9wdHMucGFnZU51bWJlci50eXBlID0gInRleHQiOwogICAgICAgIG9wdHMubnVtUGFnZXMuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4taWQiLCAicGRmanMtcGFnZS1vZi1wYWdlcyIpOwogICAgICB9IGVsc2UgewogICAgICAgIG9wdHMucGFnZU51bWJlci50eXBlID0gIm51bWJlciI7CiAgICAgICAgb3B0cy5udW1QYWdlcy5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1pZCIsICJwZGZqcy1vZi1wYWdlcyIpOwogICAgICAgIG9wdHMubnVtUGFnZXMuc2V0QXR0cmlidXRlKCJkYXRhLWwxMG4tYXJncyIsIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgIHBhZ2VzQ291bnQKICAgICAgICB9KSk7CiAgICAgIH0KICAgICAgb3B0cy5wYWdlTnVtYmVyLm1heCA9IHBhZ2VzQ291bnQ7CiAgICB9CiAgICBpZiAodGhpcy5oYXNQYWdlTGFiZWxzKSB7CiAgICAgIG9wdHMucGFnZU51bWJlci52YWx1ZSA9IHRoaXMucGFnZUxhYmVsOwogICAgICBvcHRzLm51bVBhZ2VzLnNldEF0dHJpYnV0ZSgiZGF0YS1sMTBuLWFyZ3MiLCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgcGFnZU51bWJlciwKICAgICAgICBwYWdlc0NvdW50CiAgICAgIH0pKTsKICAgIH0gZWxzZSB7CiAgICAgIG9wdHMucGFnZU51bWJlci52YWx1ZSA9IHBhZ2VOdW1iZXI7CiAgICB9CiAgICBvcHRzLnByZXZpb3VzLmRpc2FibGVkID0gcGFnZU51bWJlciA8PSAxOwogICAgb3B0cy5uZXh0LmRpc2FibGVkID0gcGFnZU51bWJlciA+PSBwYWdlc0NvdW50OwogICAgb3B0cy56b29tT3V0LmRpc2FibGVkID0gcGFnZVNjYWxlIDw9IE1JTl9TQ0FMRTsKICAgIG9wdHMuem9vbUluLmRpc2FibGVkID0gcGFnZVNjYWxlID49IE1BWF9TQ0FMRTsKICAgIGxldCBwcmVkZWZpbmVkVmFsdWVGb3VuZCA9IGZhbHNlOwogICAgZm9yIChjb25zdCBvcHRpb24gb2Ygb3B0cy5zY2FsZVNlbGVjdC5vcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb24udmFsdWUgIT09IHBhZ2VTY2FsZVZhbHVlKSB7CiAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgb3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgcHJlZGVmaW5lZFZhbHVlRm91bmQgPSB0cnVlOwogICAgfQogICAgaWYgKCFwcmVkZWZpbmVkVmFsdWVGb3VuZCkgewogICAgICBvcHRzLmN1c3RvbVNjYWxlT3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgb3B0cy5jdXN0b21TY2FsZU9wdGlvbi5zZXRBdHRyaWJ1dGUoImRhdGEtbDEwbi1hcmdzIiwgSlNPTi5zdHJpbmdpZnkoewogICAgICAgIHNjYWxlOiBNYXRoLnJvdW5kKHBhZ2VTY2FsZSAqIDEwMDAwKSAvIDEwMAogICAgICB9KSk7CiAgICB9CiAgfQogIHVwZGF0ZUxvYWRpbmdJbmRpY2F0b3JTdGF0ZShsb2FkaW5nID0gZmFsc2UpIHsKICAgIGNvbnN0IHsKICAgICAgcGFnZU51bWJlcgogICAgfSA9IHRoaXMuI29wdHM7CiAgICBwYWdlTnVtYmVyLmNsYXNzTGlzdC50b2dnbGUoImxvYWRpbmciLCBsb2FkaW5nKTsKICB9Cn0KCjsvLyAuL3dlYi92aWV3X2hpc3RvcnkuanMKY29uc3QgREVGQVVMVF9WSUVXX0hJU1RPUllfQ0FDSEVfU0laRSA9IDIwOwpjbGFzcyBWaWV3SGlzdG9yeSB7CiAgY29uc3RydWN0b3IoZmluZ2VycHJpbnQsIGNhY2hlU2l6ZSA9IERFRkFVTFRfVklFV19ISVNUT1JZX0NBQ0hFX1NJWkUpIHsKICAgIHRoaXMuZmluZ2VycHJpbnQgPSBmaW5nZXJwcmludDsKICAgIHRoaXMuY2FjaGVTaXplID0gY2FjaGVTaXplOwogICAgdGhpcy5faW5pdGlhbGl6ZWRQcm9taXNlID0gdGhpcy5fcmVhZEZyb21TdG9yYWdlKCkudGhlbihkYXRhYmFzZVN0ciA9PiB7CiAgICAgIGNvbnN0IGRhdGFiYXNlID0gSlNPTi5wYXJzZShkYXRhYmFzZVN0ciB8fCAie30iKTsKICAgICAgbGV0IGluZGV4ID0gLTE7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShkYXRhYmFzZS5maWxlcykpIHsKICAgICAgICBkYXRhYmFzZS5maWxlcyA9IFtdOwogICAgICB9IGVsc2UgewogICAgICAgIHdoaWxlIChkYXRhYmFzZS5maWxlcy5sZW5ndGggPj0gdGhpcy5jYWNoZVNpemUpIHsKICAgICAgICAgIGRhdGFiYXNlLmZpbGVzLnNoaWZ0KCk7CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGRhdGFiYXNlLmZpbGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGJyYW5jaCA9IGRhdGFiYXNlLmZpbGVzW2ldOwogICAgICAgICAgaWYgKGJyYW5jaC5maW5nZXJwcmludCA9PT0gdGhpcy5maW5nZXJwcmludCkgewogICAgICAgICAgICBpbmRleCA9IGk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaW5kZXggPT09IC0xKSB7CiAgICAgICAgaW5kZXggPSBkYXRhYmFzZS5maWxlcy5wdXNoKHsKICAgICAgICAgIGZpbmdlcnByaW50OiB0aGlzLmZpbmdlcnByaW50CiAgICAgICAgfSkgLSAxOwogICAgICB9CiAgICAgIHRoaXMuZmlsZSA9IGRhdGFiYXNlLmZpbGVzW2luZGV4XTsKICAgICAgdGhpcy5kYXRhYmFzZSA9IGRhdGFiYXNlOwogICAgfSk7CiAgfQogIGFzeW5jIF93cml0ZVRvU3RvcmFnZSgpIHsKICAgIGNvbnN0IGRhdGFiYXNlU3RyID0gSlNPTi5zdHJpbmdpZnkodGhpcy5kYXRhYmFzZSk7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgicGRmanMuaGlzdG9yeSIsIGRhdGFiYXNlU3RyKTsKICB9CiAgYXN5bmMgX3JlYWRGcm9tU3RvcmFnZSgpIHsKICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgicGRmanMuaGlzdG9yeSIpOwogIH0KICBhc3luYyBzZXQobmFtZSwgdmFsKSB7CiAgICBhd2FpdCB0aGlzLl9pbml0aWFsaXplZFByb21pc2U7CiAgICB0aGlzLmZpbGVbbmFtZV0gPSB2YWw7CiAgICByZXR1cm4gdGhpcy5fd3JpdGVUb1N0b3JhZ2UoKTsKICB9CiAgYXN5bmMgc2V0TXVsdGlwbGUocHJvcGVydGllcykgewogICAgYXdhaXQgdGhpcy5faW5pdGlhbGl6ZWRQcm9taXNlOwogICAgZm9yIChjb25zdCBuYW1lIGluIHByb3BlcnRpZXMpIHsKICAgICAgdGhpcy5maWxlW25hbWVdID0gcHJvcGVydGllc1tuYW1lXTsKICAgIH0KICAgIHJldHVybiB0aGlzLl93cml0ZVRvU3RvcmFnZSgpOwogIH0KICBhc3luYyBnZXQobmFtZSwgZGVmYXVsdFZhbHVlKSB7CiAgICBhd2FpdCB0aGlzLl9pbml0aWFsaXplZFByb21pc2U7CiAgICBjb25zdCB2YWwgPSB0aGlzLmZpbGVbbmFtZV07CiAgICByZXR1cm4gdmFsICE9PSB1bmRlZmluZWQgPyB2YWwgOiBkZWZhdWx0VmFsdWU7CiAgfQogIGFzeW5jIGdldE11bHRpcGxlKHByb3BlcnRpZXMpIHsKICAgIGF3YWl0IHRoaXMuX2luaXRpYWxpemVkUHJvbWlzZTsKICAgIGNvbnN0IHZhbHVlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBmb3IgKGNvbnN0IG5hbWUgaW4gcHJvcGVydGllcykgewogICAgICBjb25zdCB2YWwgPSB0aGlzLmZpbGVbbmFtZV07CiAgICAgIHZhbHVlc1tuYW1lXSA9IHZhbCAhPT0gdW5kZWZpbmVkID8gdmFsIDogcHJvcGVydGllc1tuYW1lXTsKICAgIH0KICAgIHJldHVybiB2YWx1ZXM7CiAgfQp9Cgo7Ly8gLi93ZWIvYXBwLmpzCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpjb25zdCBGT1JDRV9QQUdFU19MT0FERURfVElNRU9VVCA9IDEwMDAwOwpjb25zdCBWaWV3T25Mb2FkID0gewogIFVOS05PV046IC0xLAogIFBSRVZJT1VTOiAwLAogIElOSVRJQUw6IDEKfTsKY29uc3QgUERGVmlld2VyQXBwbGljYXRpb24gPSB7CiAgaW5pdGlhbEJvb2ttYXJrOiBkb2N1bWVudC5sb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKSwKICBfaW5pdGlhbGl6ZWRDYXBhYmlsaXR5OiB7CiAgICAuLi5Qcm9taXNlLndpdGhSZXNvbHZlcnMoKSwKICAgIHNldHRsZWQ6IGZhbHNlCiAgfSwKICBhcHBDb25maWc6IG51bGwsCiAgcGRmRG9jdW1lbnQ6IG51bGwsCiAgcGRmTG9hZGluZ1Rhc2s6IG51bGwsCiAgcHJpbnRTZXJ2aWNlOiBudWxsLAogIHBkZlZpZXdlcjogbnVsbCwKICBwZGZUaHVtYm5haWxWaWV3ZXI6IG51bGwsCiAgcGRmUmVuZGVyaW5nUXVldWU6IG51bGwsCiAgcGRmUHJlc2VudGF0aW9uTW9kZTogbnVsbCwKICBwZGZEb2N1bWVudFByb3BlcnRpZXM6IG51bGwsCiAgcGRmTGlua1NlcnZpY2U6IG51bGwsCiAgcGRmSGlzdG9yeTogbnVsbCwKICBwZGZTaWRlYmFyOiBudWxsLAogIHBkZk91dGxpbmVWaWV3ZXI6IG51bGwsCiAgcGRmQXR0YWNobWVudFZpZXdlcjogbnVsbCwKICBwZGZMYXllclZpZXdlcjogbnVsbCwKICBwZGZDdXJzb3JUb29sczogbnVsbCwKICBwZGZTY3JpcHRpbmdNYW5hZ2VyOiBudWxsLAogIHN0b3JlOiBudWxsLAogIGRvd25sb2FkTWFuYWdlcjogbnVsbCwKICBvdmVybGF5TWFuYWdlcjogbnVsbCwKICBwcmVmZXJlbmNlczogbmV3IFByZWZlcmVuY2VzKCksCiAgdG9vbGJhcjogbnVsbCwKICBzZWNvbmRhcnlUb29sYmFyOiBudWxsLAogIGV2ZW50QnVzOiBudWxsLAogIGwxMG46IG51bGwsCiAgYW5ub3RhdGlvbkVkaXRvclBhcmFtczogbnVsbCwKICBpbWFnZUFsdFRleHRTZXR0aW5nczogbnVsbCwKICBpc0luaXRpYWxWaWV3U2V0OiBmYWxzZSwKICBpc1ZpZXdlckVtYmVkZGVkOiB3aW5kb3cucGFyZW50ICE9PSB3aW5kb3csCiAgdXJsOiAiIiwKICBiYXNlVXJsOiAiIiwKICBtbE1hbmFnZXI6IG51bGwsCiAgX2Rvd25sb2FkVXJsOiAiIiwKICBfZXZlbnRCdXNBYm9ydENvbnRyb2xsZXI6IG51bGwsCiAgX3dpbmRvd0Fib3J0Q29udHJvbGxlcjogbnVsbCwKICBfZ2xvYmFsQWJvcnRDb250cm9sbGVyOiBuZXcgQWJvcnRDb250cm9sbGVyKCksCiAgZG9jdW1lbnRJbmZvOiBudWxsLAogIG1ldGFkYXRhOiBudWxsLAogIF9jb250ZW50RGlzcG9zaXRpb25GaWxlbmFtZTogbnVsbCwKICBfY29udGVudExlbmd0aDogbnVsbCwKICBfc2F2ZUluUHJvZ3Jlc3M6IGZhbHNlLAogIF93aGVlbFVudXNlZFRpY2tzOiAwLAogIF93aGVlbFVudXNlZEZhY3RvcjogMSwKICBfdG91Y2hNYW5hZ2VyOiBudWxsLAogIF90b3VjaFVudXNlZFRpY2tzOiAwLAogIF90b3VjaFVudXNlZEZhY3RvcjogMSwKICBfUERGQnVnOiBudWxsLAogIF9oYXNBbm5vdGF0aW9uRWRpdG9yczogZmFsc2UsCiAgX3RpdGxlOiBkb2N1bWVudC50aXRsZSwKICBfcHJpbnRBbm5vdGF0aW9uU3RvcmFnZVByb21pc2U6IG51bGwsCiAgX2lzQ3RybEtleURvd246IGZhbHNlLAogIF9jYXJldEJyb3dzaW5nOiBudWxsLAogIF9pc1Njcm9sbGluZzogZmFsc2UsCiAgZWRpdG9yVW5kb0JhcjogbnVsbCwKICBhc3luYyBpbml0aWFsaXplKGFwcENvbmZpZykgewogICAgdGhpcy5hcHBDb25maWcgPSBhcHBDb25maWc7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnByZWZlcmVuY2VzLmluaXRpYWxpemVkUHJvbWlzZTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoImluaXRpYWxpemU6IiwgZXgpOwogICAgfQogICAgaWYgKEFwcE9wdGlvbnMuZ2V0KCJwZGZCdWdFbmFibGVkIikpIHsKICAgICAgYXdhaXQgdGhpcy5fcGFyc2VIYXNoUGFyYW1zKCk7CiAgICB9CiAgICBsZXQgbW9kZTsKICAgIHN3aXRjaCAoQXBwT3B0aW9ucy5nZXQoInZpZXdlckNzc1RoZW1lIikpIHsKICAgICAgY2FzZSAxOgogICAgICAgIG1vZGUgPSAibGlnaHQiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI6CiAgICAgICAgbW9kZSA9ICJkYXJrIjsKICAgICAgICBicmVhazsKICAgIH0KICAgIGlmIChtb2RlKSB7CiAgICAgIGRvY1N0eWxlLnNldFByb3BlcnR5KCJjb2xvci1zY2hlbWUiLCBtb2RlKTsKICAgIH0KICAgIHRoaXMubDEwbiA9IGF3YWl0IHRoaXMuZXh0ZXJuYWxTZXJ2aWNlcy5jcmVhdGVMMTBuKCk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaHRtbCIpWzBdLmRpciA9IHRoaXMubDEwbi5nZXREaXJlY3Rpb24oKTsKICAgIHRoaXMubDEwbi50cmFuc2xhdGUoYXBwQ29uZmlnLmFwcENvbnRhaW5lciB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpOwogICAgaWYgKHRoaXMuaXNWaWV3ZXJFbWJlZGRlZCAmJiBBcHBPcHRpb25zLmdldCgiZXh0ZXJuYWxMaW5rVGFyZ2V0IikgPT09IExpbmtUYXJnZXQuTk9ORSkgewogICAgICBBcHBPcHRpb25zLnNldCgiZXh0ZXJuYWxMaW5rVGFyZ2V0IiwgTGlua1RhcmdldC5UT1ApOwogICAgfQogICAgYXdhaXQgdGhpcy5faW5pdGlhbGl6ZVZpZXdlckNvbXBvbmVudHMoKTsKICAgIHRoaXMuYmluZEV2ZW50cygpOwogICAgdGhpcy5iaW5kV2luZG93RXZlbnRzKCk7CiAgICB0aGlzLl9pbml0aWFsaXplZENhcGFiaWxpdHkuc2V0dGxlZCA9IHRydWU7CiAgICB0aGlzLl9pbml0aWFsaXplZENhcGFiaWxpdHkucmVzb2x2ZSgpOwogIH0sCiAgYXN5bmMgX3BhcnNlSGFzaFBhcmFtcygpIHsKICAgIGNvbnN0IGhhc2ggPSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKTsKICAgIGlmICghaGFzaCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgICAgbWFpbkNvbnRhaW5lciwKICAgICAgICB2aWV3ZXJDb250YWluZXIKICAgICAgfSA9IHRoaXMuYXBwQ29uZmlnLAogICAgICBwYXJhbXMgPSBwYXJzZVF1ZXJ5U3RyaW5nKGhhc2gpOwogICAgY29uc3QgbG9hZFBERkJ1ZyA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKHRoaXMuX1BERkJ1ZykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgUERGQnVnCiAgICAgIH0gPSBhd2FpdCBpbXBvcnQoCiAgICAgIC8qd2VicGFja0lnbm9yZTogdHJ1ZSovCiAgICAgIC8qQHZpdGUtaWdub3JlKi8KICAgICAgQXBwT3B0aW9ucy5nZXQoImRlYnVnZ2VyU3JjIikpOwogICAgICB0aGlzLl9QREZCdWcgPSBQREZCdWc7CiAgICB9OwogICAgaWYgKHBhcmFtcy5nZXQoImRpc2FibGV3b3JrZXIiKSA9PT0gInRydWUiKSB7CiAgICAgIHRyeSB7CiAgICAgICAgR2xvYmFsV29ya2VyT3B0aW9ucy53b3JrZXJTcmMgfHw9IEFwcE9wdGlvbnMuZ2V0KCJ3b3JrZXJTcmMiKTsKICAgICAgICBhd2FpdCBpbXBvcnQoCiAgICAgICAgLyp3ZWJwYWNrSWdub3JlOiB0cnVlKi8KICAgICAgICAvKkB2aXRlLWlnbm9yZSovCiAgICAgICAgUERGV29ya2VyLndvcmtlclNyYyk7CiAgICAgICAgQXBwT3B0aW9ucy5zZXQoIndvcmtlclBvcnQiLCBudWxsKTsKICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJfcGFyc2VIYXNoUGFyYW1zOiIsIGV4KTsKICAgICAgfQogICAgfQogICAgaWYgKHBhcmFtcy5oYXMoInRleHRsYXllciIpKSB7CiAgICAgIHN3aXRjaCAocGFyYW1zLmdldCgidGV4dGxheWVyIikpIHsKICAgICAgICBjYXNlICJvZmYiOgogICAgICAgICAgQXBwT3B0aW9ucy5zZXQoInRleHRMYXllck1vZGUiLCBUZXh0TGF5ZXJNb2RlLkRJU0FCTEUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidmlzaWJsZSI6CiAgICAgICAgY2FzZSAic2hhZG93IjoKICAgICAgICBjYXNlICJob3ZlciI6CiAgICAgICAgICB2aWV3ZXJDb250YWluZXIuY2xhc3NMaXN0LmFkZChgdGV4dExheWVyLSR7cGFyYW1zLmdldCgidGV4dGxheWVyIil9YCk7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBhd2FpdCBsb2FkUERGQnVnKCk7CiAgICAgICAgICAgIHRoaXMuX1BERkJ1Zy5sb2FkQ1NTKCk7CiAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJfcGFyc2VIYXNoUGFyYW1zOiIsIGV4KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAocGFyYW1zLmhhcygicGRmYnVnIikpIHsKICAgICAgY29uc3QgZW5hYmxlZCA9IHBhcmFtcy5nZXQoInBkZmJ1ZyIpLnNwbGl0KCIsIik7CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgbG9hZFBERkJ1ZygpOwogICAgICAgIHRoaXMuX1BERkJ1Zy5pbml0KG1haW5Db250YWluZXIsIGVuYWJsZWQpOwogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIl9wYXJzZUhhc2hQYXJhbXM6IiwgZXgpOwogICAgICB9CiAgICAgIGNvbnN0IGRlYnVnT3B0cyA9IHsKICAgICAgICBwZGZCdWc6IHRydWUsCiAgICAgICAgZm9udEV4dHJhUHJvcGVydGllczogdHJ1ZQogICAgICB9OwogICAgICBpZiAoZ2xvYmFsVGhpcy5TdGVwcGVyTWFuYWdlcj8uZW5hYmxlZCkgewogICAgICAgIGRlYnVnT3B0cy5taW5EdXJhdGlvblRvVXBkYXRlQ2FudmFzID0gMDsKICAgICAgfQogICAgICBBcHBPcHRpb25zLnNldEFsbChkZWJ1Z09wdHMpOwogICAgfQogICAgaWYgKHBhcmFtcy5oYXMoImxvY2FsZSIpKSB7CiAgICAgIEFwcE9wdGlvbnMuc2V0KCJsb2NhbGVQcm9wZXJ0aWVzIiwgewogICAgICAgIGxhbmc6IHBhcmFtcy5nZXQoImxvY2FsZSIpCiAgICAgIH0pOwogICAgfQogICAgY29uc3Qgb3B0cyA9IHsKICAgICAgZGlzYWJsZUF1dG9GZXRjaDogeCA9PiB4ID09PSAidHJ1ZSIsCiAgICAgIGRpc2FibGVGb250RmFjZTogeCA9PiB4ID09PSAidHJ1ZSIsCiAgICAgIGRpc2FibGVIaXN0b3J5OiB4ID0+IHggPT09ICJ0cnVlIiwKICAgICAgZGlzYWJsZVJhbmdlOiB4ID0+IHggPT09ICJ0cnVlIiwKICAgICAgZGlzYWJsZVN0cmVhbTogeCA9PiB4ID09PSAidHJ1ZSIsCiAgICAgIHZlcmJvc2l0eTogeCA9PiB4IHwgMAogICAgfTsKICAgIGZvciAoY29uc3QgbmFtZSBpbiBvcHRzKSB7CiAgICAgIGNvbnN0IGNoZWNrID0gb3B0c1tuYW1lXSwKICAgICAgICBrZXkgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgIGlmIChwYXJhbXMuaGFzKGtleSkpIHsKICAgICAgICBBcHBPcHRpb25zLnNldChuYW1lLCBjaGVjayhwYXJhbXMuZ2V0KGtleSkpKTsKICAgICAgfQogICAgfQogIH0sCiAgYXN5bmMgX2luaXRpYWxpemVWaWV3ZXJDb21wb25lbnRzKCkgewogICAgY29uc3QgewogICAgICBhcHBDb25maWcsCiAgICAgIGV4dGVybmFsU2VydmljZXMsCiAgICAgIGwxMG4sCiAgICAgIG1sTWFuYWdlcgogICAgfSA9IHRoaXM7CiAgICBjb25zdCBhYm9ydFNpZ25hbCA9IHRoaXMuX2dsb2JhbEFib3J0Q29udHJvbGxlci5zaWduYWw7CiAgICBjb25zdCBldmVudEJ1cyA9IG5ldyBFdmVudEJ1cygpOwogICAgdGhpcy5ldmVudEJ1cyA9IEFwcE9wdGlvbnMuZXZlbnRCdXMgPSBldmVudEJ1czsKICAgIG1sTWFuYWdlcj8uc2V0RXZlbnRCdXMoZXZlbnRCdXMsIGFib3J0U2lnbmFsKTsKICAgIGNvbnN0IG92ZXJsYXlNYW5hZ2VyID0gdGhpcy5vdmVybGF5TWFuYWdlciA9IG5ldyBPdmVybGF5TWFuYWdlcigpOwogICAgY29uc3QgcmVuZGVyaW5nUXVldWUgPSB0aGlzLnBkZlJlbmRlcmluZ1F1ZXVlID0gbmV3IFBERlJlbmRlcmluZ1F1ZXVlKCk7CiAgICByZW5kZXJpbmdRdWV1ZS5vbklkbGUgPSB0aGlzLl9jbGVhbnVwLmJpbmQodGhpcyk7CiAgICBjb25zdCBsaW5rU2VydmljZSA9IHRoaXMucGRmTGlua1NlcnZpY2UgPSBuZXcgUERGTGlua1NlcnZpY2UoewogICAgICBldmVudEJ1cywKICAgICAgZXh0ZXJuYWxMaW5rVGFyZ2V0OiBBcHBPcHRpb25zLmdldCgiZXh0ZXJuYWxMaW5rVGFyZ2V0IiksCiAgICAgIGV4dGVybmFsTGlua1JlbDogQXBwT3B0aW9ucy5nZXQoImV4dGVybmFsTGlua1JlbCIpLAogICAgICBpZ25vcmVEZXN0aW5hdGlvblpvb206IEFwcE9wdGlvbnMuZ2V0KCJpZ25vcmVEZXN0aW5hdGlvblpvb20iKQogICAgfSk7CiAgICBjb25zdCBkb3dubG9hZE1hbmFnZXIgPSB0aGlzLmRvd25sb2FkTWFuYWdlciA9IG5ldyBEb3dubG9hZE1hbmFnZXIoKTsKICAgIGNvbnN0IGZpbmRDb250cm9sbGVyID0gdGhpcy5maW5kQ29udHJvbGxlciA9IG5ldyBQREZGaW5kQ29udHJvbGxlcih7CiAgICAgIGxpbmtTZXJ2aWNlLAogICAgICBldmVudEJ1cywKICAgICAgdXBkYXRlTWF0Y2hlc0NvdW50T25Qcm9ncmVzczogdHJ1ZQogICAgfSk7CiAgICBjb25zdCBwZGZTY3JpcHRpbmdNYW5hZ2VyID0gdGhpcy5wZGZTY3JpcHRpbmdNYW5hZ2VyID0gbmV3IFBERlNjcmlwdGluZ01hbmFnZXIoewogICAgICBldmVudEJ1cywKICAgICAgZXh0ZXJuYWxTZXJ2aWNlcywKICAgICAgZG9jUHJvcGVydGllczogdGhpcy5fc2NyaXB0aW5nRG9jUHJvcGVydGllcy5iaW5kKHRoaXMpCiAgICB9KTsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGFwcENvbmZpZy5tYWluQ29udGFpbmVyLAogICAgICB2aWV3ZXIgPSBhcHBDb25maWcudmlld2VyQ29udGFpbmVyOwogICAgY29uc3QgYW5ub3RhdGlvbkVkaXRvck1vZGUgPSBBcHBPcHRpb25zLmdldCgiYW5ub3RhdGlvbkVkaXRvck1vZGUiKTsKICAgIGNvbnN0IHBhZ2VDb2xvcnMgPSBBcHBPcHRpb25zLmdldCgiZm9yY2VQYWdlQ29sb3JzIikgfHwgd2luZG93Lm1hdGNoTWVkaWEoIihmb3JjZWQtY29sb3JzOiBhY3RpdmUpIikubWF0Y2hlcyA/IHsKICAgICAgYmFja2dyb3VuZDogQXBwT3B0aW9ucy5nZXQoInBhZ2VDb2xvcnNCYWNrZ3JvdW5kIiksCiAgICAgIGZvcmVncm91bmQ6IEFwcE9wdGlvbnMuZ2V0KCJwYWdlQ29sb3JzRm9yZWdyb3VuZCIpCiAgICB9IDogbnVsbDsKICAgIGxldCBhbHRUZXh0TWFuYWdlcjsKICAgIGlmIChBcHBPcHRpb25zLmdldCgiZW5hYmxlVXBkYXRlZEFkZEltYWdlIikpIHsKICAgICAgYWx0VGV4dE1hbmFnZXIgPSBhcHBDb25maWcubmV3QWx0VGV4dERpYWxvZyA/IG5ldyBOZXdBbHRUZXh0TWFuYWdlcihhcHBDb25maWcubmV3QWx0VGV4dERpYWxvZywgb3ZlcmxheU1hbmFnZXIsIGV2ZW50QnVzKSA6IG51bGw7CiAgICB9IGVsc2UgewogICAgICBhbHRUZXh0TWFuYWdlciA9IGFwcENvbmZpZy5hbHRUZXh0RGlhbG9nID8gbmV3IEFsdFRleHRNYW5hZ2VyKGFwcENvbmZpZy5hbHRUZXh0RGlhbG9nLCBjb250YWluZXIsIG92ZXJsYXlNYW5hZ2VyLCBldmVudEJ1cykgOiBudWxsOwogICAgfQogICAgaWYgKGFwcENvbmZpZy5lZGl0b3JVbmRvQmFyKSB7CiAgICAgIHRoaXMuZWRpdG9yVW5kb0JhciA9IG5ldyBFZGl0b3JVbmRvQmFyKGFwcENvbmZpZy5lZGl0b3JVbmRvQmFyLCBldmVudEJ1cyk7CiAgICB9CiAgICBjb25zdCBzaWduYXR1cmVNYW5hZ2VyID0gQXBwT3B0aW9ucy5nZXQoImVuYWJsZVNpZ25hdHVyZUVkaXRvciIpICYmIGFwcENvbmZpZy5hZGRTaWduYXR1cmVEaWFsb2cgPyBuZXcgU2lnbmF0dXJlTWFuYWdlcihhcHBDb25maWcuYWRkU2lnbmF0dXJlRGlhbG9nLCBhcHBDb25maWcuZWRpdFNpZ25hdHVyZURpYWxvZywgYXBwQ29uZmlnLmFubm90YXRpb25FZGl0b3JQYXJhbXM/LmVkaXRvclNpZ25hdHVyZUFkZFNpZ25hdHVyZSB8fCBudWxsLCBvdmVybGF5TWFuYWdlciwgbDEwbiwgZXh0ZXJuYWxTZXJ2aWNlcy5jcmVhdGVTaWduYXR1cmVTdG9yYWdlKGV2ZW50QnVzLCBhYm9ydFNpZ25hbCksIGV2ZW50QnVzKSA6IG51bGw7CiAgICBjb25zdCBlbmFibGVIV0EgPSBBcHBPcHRpb25zLmdldCgiZW5hYmxlSFdBIiksCiAgICAgIG1heENhbnZhc1BpeGVscyA9IEFwcE9wdGlvbnMuZ2V0KCJtYXhDYW52YXNQaXhlbHMiKSwKICAgICAgbWF4Q2FudmFzRGltID0gQXBwT3B0aW9ucy5nZXQoIm1heENhbnZhc0RpbSIpLAogICAgICBjYXBDYW52YXNBcmVhRmFjdG9yID0gQXBwT3B0aW9ucy5nZXQoImNhcENhbnZhc0FyZWFGYWN0b3IiKTsKICAgIGNvbnN0IHBkZlZpZXdlciA9IHRoaXMucGRmVmlld2VyID0gbmV3IFBERlZpZXdlcih7CiAgICAgIGNvbnRhaW5lciwKICAgICAgdmlld2VyLAogICAgICBldmVudEJ1cywKICAgICAgcmVuZGVyaW5nUXVldWUsCiAgICAgIGxpbmtTZXJ2aWNlLAogICAgICBkb3dubG9hZE1hbmFnZXIsCiAgICAgIGFsdFRleHRNYW5hZ2VyLAogICAgICBzaWduYXR1cmVNYW5hZ2VyLAogICAgICBlZGl0b3JVbmRvQmFyOiB0aGlzLmVkaXRvclVuZG9CYXIsCiAgICAgIGZpbmRDb250cm9sbGVyLAogICAgICBzY3JpcHRpbmdNYW5hZ2VyOiBBcHBPcHRpb25zLmdldCgiZW5hYmxlU2NyaXB0aW5nIikgJiYgcGRmU2NyaXB0aW5nTWFuYWdlciwKICAgICAgbDEwbiwKICAgICAgdGV4dExheWVyTW9kZTogQXBwT3B0aW9ucy5nZXQoInRleHRMYXllck1vZGUiKSwKICAgICAgYW5ub3RhdGlvbk1vZGU6IEFwcE9wdGlvbnMuZ2V0KCJhbm5vdGF0aW9uTW9kZSIpLAogICAgICBhbm5vdGF0aW9uRWRpdG9yTW9kZSwKICAgICAgYW5ub3RhdGlvbkVkaXRvckhpZ2hsaWdodENvbG9yczogQXBwT3B0aW9ucy5nZXQoImhpZ2hsaWdodEVkaXRvckNvbG9ycyIpLAogICAgICBlbmFibGVIaWdobGlnaHRGbG9hdGluZ0J1dHRvbjogQXBwT3B0aW9ucy5nZXQoImVuYWJsZUhpZ2hsaWdodEZsb2F0aW5nQnV0dG9uIiksCiAgICAgIGVuYWJsZVVwZGF0ZWRBZGRJbWFnZTogQXBwT3B0aW9ucy5nZXQoImVuYWJsZVVwZGF0ZWRBZGRJbWFnZSIpLAogICAgICBlbmFibGVOZXdBbHRUZXh0V2hlbkFkZGluZ0ltYWdlOiBBcHBPcHRpb25zLmdldCgiZW5hYmxlTmV3QWx0VGV4dFdoZW5BZGRpbmdJbWFnZSIpLAogICAgICBpbWFnZVJlc291cmNlc1BhdGg6IEFwcE9wdGlvbnMuZ2V0KCJpbWFnZVJlc291cmNlc1BhdGgiKSwKICAgICAgZW5hYmxlUHJpbnRBdXRvUm90YXRlOiBBcHBPcHRpb25zLmdldCgiZW5hYmxlUHJpbnRBdXRvUm90YXRlIiksCiAgICAgIG1heENhbnZhc1BpeGVscywKICAgICAgbWF4Q2FudmFzRGltLAogICAgICBjYXBDYW52YXNBcmVhRmFjdG9yLAogICAgICBlbmFibGVEZXRhaWxDYW52YXM6IEFwcE9wdGlvbnMuZ2V0KCJlbmFibGVEZXRhaWxDYW52YXMiKSwKICAgICAgZW5hYmxlUGVybWlzc2lvbnM6IEFwcE9wdGlvbnMuZ2V0KCJlbmFibGVQZXJtaXNzaW9ucyIpLAogICAgICBwYWdlQ29sb3JzLAogICAgICBtbE1hbmFnZXIsCiAgICAgIGFib3J0U2lnbmFsLAogICAgICBlbmFibGVIV0EsCiAgICAgIHN1cHBvcnRzUGluY2hUb1pvb206IHRoaXMuc3VwcG9ydHNQaW5jaFRvWm9vbSwKICAgICAgZW5hYmxlQXV0b0xpbmtpbmc6IEFwcE9wdGlvbnMuZ2V0KCJlbmFibGVBdXRvTGlua2luZyIpLAogICAgICBtaW5EdXJhdGlvblRvVXBkYXRlQ2FudmFzOiBBcHBPcHRpb25zLmdldCgibWluRHVyYXRpb25Ub1VwZGF0ZUNhbnZhcyIpCiAgICB9KTsKICAgIHJlbmRlcmluZ1F1ZXVlLnNldFZpZXdlcihwZGZWaWV3ZXIpOwogICAgbGlua1NlcnZpY2Uuc2V0Vmlld2VyKHBkZlZpZXdlcik7CiAgICBwZGZTY3JpcHRpbmdNYW5hZ2VyLnNldFZpZXdlcihwZGZWaWV3ZXIpOwogICAgaWYgKGFwcENvbmZpZy5zaWRlYmFyPy50aHVtYm5haWxWaWV3KSB7CiAgICAgIHRoaXMucGRmVGh1bWJuYWlsVmlld2VyID0gbmV3IFBERlRodW1ibmFpbFZpZXdlcih7CiAgICAgICAgY29udGFpbmVyOiBhcHBDb25maWcuc2lkZWJhci50aHVtYm5haWxWaWV3LAogICAgICAgIGV2ZW50QnVzLAogICAgICAgIHJlbmRlcmluZ1F1ZXVlLAogICAgICAgIGxpbmtTZXJ2aWNlLAogICAgICAgIG1heENhbnZhc1BpeGVscywKICAgICAgICBtYXhDYW52YXNEaW0sCiAgICAgICAgcGFnZUNvbG9ycywKICAgICAgICBhYm9ydFNpZ25hbCwKICAgICAgICBlbmFibGVIV0EKICAgICAgfSk7CiAgICAgIHJlbmRlcmluZ1F1ZXVlLnNldFRodW1ibmFpbFZpZXdlcih0aGlzLnBkZlRodW1ibmFpbFZpZXdlcik7CiAgICB9CiAgICBpZiAoIXRoaXMuaXNWaWV3ZXJFbWJlZGRlZCAmJiAhQXBwT3B0aW9ucy5nZXQoImRpc2FibGVIaXN0b3J5IikpIHsKICAgICAgdGhpcy5wZGZIaXN0b3J5ID0gbmV3IFBERkhpc3RvcnkoewogICAgICAgIGxpbmtTZXJ2aWNlLAogICAgICAgIGV2ZW50QnVzCiAgICAgIH0pOwogICAgICBsaW5rU2VydmljZS5zZXRIaXN0b3J5KHRoaXMucGRmSGlzdG9yeSk7CiAgICB9CiAgICBpZiAoIXRoaXMuc3VwcG9ydHNJbnRlZ3JhdGVkRmluZCAmJiBhcHBDb25maWcuZmluZEJhcikgewogICAgICB0aGlzLmZpbmRCYXIgPSBuZXcgUERGRmluZEJhcihhcHBDb25maWcuZmluZEJhciwgYXBwQ29uZmlnLnByaW5jaXBhbENvbnRhaW5lciwgZXZlbnRCdXMpOwogICAgfQogICAgaWYgKGFwcENvbmZpZy5hbm5vdGF0aW9uRWRpdG9yUGFyYW1zKSB7CiAgICAgIGlmIChhbm5vdGF0aW9uRWRpdG9yTW9kZSAhPT0gQW5ub3RhdGlvbkVkaXRvclR5cGUuRElTQUJMRSkgewogICAgICAgIGNvbnN0IGVkaXRvclNpZ25hdHVyZUJ1dHRvbiA9IGFwcENvbmZpZy50b29sYmFyPy5lZGl0b3JTaWduYXR1cmVCdXR0b247CiAgICAgICAgaWYgKGVkaXRvclNpZ25hdHVyZUJ1dHRvbiAmJiBBcHBPcHRpb25zLmdldCgiZW5hYmxlU2lnbmF0dXJlRWRpdG9yIikpIHsKICAgICAgICAgIGVkaXRvclNpZ25hdHVyZUJ1dHRvbi5wYXJlbnRFbGVtZW50LmhpZGRlbiA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICB0aGlzLmFubm90YXRpb25FZGl0b3JQYXJhbXMgPSBuZXcgQW5ub3RhdGlvbkVkaXRvclBhcmFtcyhhcHBDb25maWcuYW5ub3RhdGlvbkVkaXRvclBhcmFtcywgZXZlbnRCdXMpOwogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoY29uc3QgaWQgb2YgWyJlZGl0b3JNb2RlQnV0dG9ucyIsICJlZGl0b3JNb2RlU2VwYXJhdG9yIl0pIHsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAobWxNYW5hZ2VyICYmIGFwcENvbmZpZy5zZWNvbmRhcnlUb29sYmFyPy5pbWFnZUFsdFRleHRTZXR0aW5nc0J1dHRvbikgewogICAgICB0aGlzLmltYWdlQWx0VGV4dFNldHRpbmdzID0gbmV3IEltYWdlQWx0VGV4dFNldHRpbmdzKGFwcENvbmZpZy5hbHRUZXh0U2V0dGluZ3NEaWFsb2csIG92ZXJsYXlNYW5hZ2VyLCBldmVudEJ1cywgbWxNYW5hZ2VyKTsKICAgIH0KICAgIGlmIChhcHBDb25maWcuZG9jdW1lbnRQcm9wZXJ0aWVzKSB7CiAgICAgIHRoaXMucGRmRG9jdW1lbnRQcm9wZXJ0aWVzID0gbmV3IFBERkRvY3VtZW50UHJvcGVydGllcyhhcHBDb25maWcuZG9jdW1lbnRQcm9wZXJ0aWVzLCBvdmVybGF5TWFuYWdlciwgZXZlbnRCdXMsIGwxMG4sICgpID0+IHRoaXMuX2RvY0ZpbGVuYW1lLCAoKSA9PiB0aGlzLl9kb2NUaXRsZSk7CiAgICB9CiAgICBpZiAoYXBwQ29uZmlnLnNlY29uZGFyeVRvb2xiYXI/LmN1cnNvckhhbmRUb29sQnV0dG9uKSB7CiAgICAgIHRoaXMucGRmQ3Vyc29yVG9vbHMgPSBuZXcgUERGQ3Vyc29yVG9vbHMoewogICAgICAgIGNvbnRhaW5lciwKICAgICAgICBldmVudEJ1cywKICAgICAgICBjdXJzb3JUb29sT25Mb2FkOiBBcHBPcHRpb25zLmdldCgiY3Vyc29yVG9vbE9uTG9hZCIpCiAgICAgIH0pOwogICAgfQogICAgaWYgKGFwcENvbmZpZy50b29sYmFyKSB7CiAgICAgIHRoaXMudG9vbGJhciA9IG5ldyBUb29sYmFyKGFwcENvbmZpZy50b29sYmFyLCBldmVudEJ1cywgQXBwT3B0aW9ucy5nZXQoInRvb2xiYXJEZW5zaXR5IikpOwogICAgfQogICAgaWYgKGFwcENvbmZpZy5zZWNvbmRhcnlUb29sYmFyKSB7CiAgICAgIGlmIChBcHBPcHRpb25zLmdldCgiZW5hYmxlQWx0VGV4dCIpKSB7CiAgICAgICAgYXBwQ29uZmlnLnNlY29uZGFyeVRvb2xiYXIuaW1hZ2VBbHRUZXh0U2V0dGluZ3NCdXR0b24/LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOwogICAgICAgIGFwcENvbmZpZy5zZWNvbmRhcnlUb29sYmFyLmltYWdlQWx0VGV4dFNldHRpbmdzU2VwYXJhdG9yPy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKICAgICAgfQogICAgICB0aGlzLnNlY29uZGFyeVRvb2xiYXIgPSBuZXcgU2Vjb25kYXJ5VG9vbGJhcihhcHBDb25maWcuc2Vjb25kYXJ5VG9vbGJhciwgZXZlbnRCdXMpOwogICAgfQogICAgaWYgKHRoaXMuc3VwcG9ydHNGdWxsc2NyZWVuICYmIGFwcENvbmZpZy5zZWNvbmRhcnlUb29sYmFyPy5wcmVzZW50YXRpb25Nb2RlQnV0dG9uKSB7CiAgICAgIHRoaXMucGRmUHJlc2VudGF0aW9uTW9kZSA9IG5ldyBQREZQcmVzZW50YXRpb25Nb2RlKHsKICAgICAgICBjb250YWluZXIsCiAgICAgICAgcGRmVmlld2VyLAogICAgICAgIGV2ZW50QnVzCiAgICAgIH0pOwogICAgfQogICAgaWYgKGFwcENvbmZpZy5wYXNzd29yZE92ZXJsYXkpIHsKICAgICAgdGhpcy5wYXNzd29yZFByb21wdCA9IG5ldyBQYXNzd29yZFByb21wdChhcHBDb25maWcucGFzc3dvcmRPdmVybGF5LCBvdmVybGF5TWFuYWdlciwgdGhpcy5pc1ZpZXdlckVtYmVkZGVkKTsKICAgIH0KICAgIGlmIChhcHBDb25maWcuc2lkZWJhcj8ub3V0bGluZVZpZXcpIHsKICAgICAgdGhpcy5wZGZPdXRsaW5lVmlld2VyID0gbmV3IFBERk91dGxpbmVWaWV3ZXIoewogICAgICAgIGNvbnRhaW5lcjogYXBwQ29uZmlnLnNpZGViYXIub3V0bGluZVZpZXcsCiAgICAgICAgZXZlbnRCdXMsCiAgICAgICAgbDEwbiwKICAgICAgICBsaW5rU2VydmljZSwKICAgICAgICBkb3dubG9hZE1hbmFnZXIKICAgICAgfSk7CiAgICB9CiAgICBpZiAoYXBwQ29uZmlnLnNpZGViYXI/LmF0dGFjaG1lbnRzVmlldykgewogICAgICB0aGlzLnBkZkF0dGFjaG1lbnRWaWV3ZXIgPSBuZXcgUERGQXR0YWNobWVudFZpZXdlcih7CiAgICAgICAgY29udGFpbmVyOiBhcHBDb25maWcuc2lkZWJhci5hdHRhY2htZW50c1ZpZXcsCiAgICAgICAgZXZlbnRCdXMsCiAgICAgICAgbDEwbiwKICAgICAgICBkb3dubG9hZE1hbmFnZXIKICAgICAgfSk7CiAgICB9CiAgICBpZiAoYXBwQ29uZmlnLnNpZGViYXI/LmxheWVyc1ZpZXcpIHsKICAgICAgdGhpcy5wZGZMYXllclZpZXdlciA9IG5ldyBQREZMYXllclZpZXdlcih7CiAgICAgICAgY29udGFpbmVyOiBhcHBDb25maWcuc2lkZWJhci5sYXllcnNWaWV3LAogICAgICAgIGV2ZW50QnVzLAogICAgICAgIGwxMG4KICAgICAgfSk7CiAgICB9CiAgICBpZiAoYXBwQ29uZmlnLnNpZGViYXIpIHsKICAgICAgdGhpcy5wZGZTaWRlYmFyID0gbmV3IFBERlNpZGViYXIoewogICAgICAgIGVsZW1lbnRzOiBhcHBDb25maWcuc2lkZWJhciwKICAgICAgICBldmVudEJ1cywKICAgICAgICBsMTBuCiAgICAgIH0pOwogICAgICB0aGlzLnBkZlNpZGViYXIub25Ub2dnbGVkID0gdGhpcy5mb3JjZVJlbmRlcmluZy5iaW5kKHRoaXMpOwogICAgICB0aGlzLnBkZlNpZGViYXIub25VcGRhdGVUaHVtYm5haWxzID0gKCkgPT4gewogICAgICAgIGZvciAoY29uc3QgcGFnZVZpZXcgb2YgcGRmVmlld2VyLmdldENhY2hlZFBhZ2VWaWV3cygpKSB7CiAgICAgICAgICBpZiAocGFnZVZpZXcucmVuZGVyaW5nU3RhdGUgPT09IFJlbmRlcmluZ1N0YXRlcy5GSU5JU0hFRCkgewogICAgICAgICAgICB0aGlzLnBkZlRodW1ibmFpbFZpZXdlci5nZXRUaHVtYm5haWwocGFnZVZpZXcuaWQgLSAxKT8uc2V0SW1hZ2UocGFnZVZpZXcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLnBkZlRodW1ibmFpbFZpZXdlci5zY3JvbGxUaHVtYm5haWxJbnRvVmlldyhwZGZWaWV3ZXIuY3VycmVudFBhZ2VOdW1iZXIpOwogICAgICB9OwogICAgfQogIH0sCiAgYXN5bmMgcnVuKGNvbmZpZykgewogICAgYXdhaXQgdGhpcy5pbml0aWFsaXplKGNvbmZpZyk7CiAgICBjb25zdCB7CiAgICAgIGFwcENvbmZpZywKICAgICAgZXZlbnRCdXMKICAgIH0gPSB0aGlzOwogICAgbGV0IGZpbGU7CiAgICBjb25zdCBxdWVyeVN0cmluZyA9IGRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7CiAgICBjb25zdCBwYXJhbXMgPSBwYXJzZVF1ZXJ5U3RyaW5nKHF1ZXJ5U3RyaW5nKTsKICAgIGZpbGUgPSBwYXJhbXMuZ2V0KCJmaWxlIikgPz8gQXBwT3B0aW9ucy5nZXQoImRlZmF1bHRVcmwiKTsKICAgIHZhbGlkYXRlRmlsZVVSTChmaWxlKTsKICAgIGNvbnN0IGZpbGVJbnB1dCA9IHRoaXMuX29wZW5GaWxlSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgZmlsZUlucHV0LmlkID0gImZpbGVJbnB1dCI7CiAgICBmaWxlSW5wdXQuaGlkZGVuID0gdHJ1ZTsKICAgIGZpbGVJbnB1dC50eXBlID0gImZpbGUiOwogICAgZmlsZUlucHV0LnZhbHVlID0gbnVsbDsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kKGZpbGVJbnB1dCk7CiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZnVuY3Rpb24gKGV2dCkgewogICAgICBjb25zdCB7CiAgICAgICAgZmlsZXMKICAgICAgfSA9IGV2dC50YXJnZXQ7CiAgICAgIGlmICghZmlsZXMgfHwgZmlsZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKCJmaWxlaW5wdXRjaGFuZ2UiLCB7CiAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgIGZpbGVJbnB1dDogZXZ0LnRhcmdldAogICAgICB9KTsKICAgIH0pOwogICAgYXBwQ29uZmlnLm1haW5Db250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ292ZXIiLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBldnQuZGF0YVRyYW5zZmVyLml0ZW1zKSB7CiAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gImFwcGxpY2F0aW9uL3BkZiIpIHsKICAgICAgICAgIGV2dC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9IGV2dC5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9PT0gImNvcHkiID8gImNvcHkiIDogIm1vdmUiOwogICAgICAgICAgc3RvcEV2ZW50KGV2dCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIGFwcENvbmZpZy5tYWluQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoImRyb3AiLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIGlmIChldnQuZGF0YVRyYW5zZmVyLmZpbGVzPy5bMF0udHlwZSAhPT0gImFwcGxpY2F0aW9uL3BkZiIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgc3RvcEV2ZW50KGV2dCk7CiAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKCJmaWxlaW5wdXRjaGFuZ2UiLCB7CiAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgIGZpbGVJbnB1dDogZXZ0LmRhdGFUcmFuc2ZlcgogICAgICB9KTsKICAgIH0pOwogICAgaWYgKCFBcHBPcHRpb25zLmdldCgic3VwcG9ydHNEb2N1bWVudEZvbnRzIikpIHsKICAgICAgQXBwT3B0aW9ucy5zZXQoImRpc2FibGVGb250RmFjZSIsIHRydWUpOwogICAgICB0aGlzLmwxMG4uZ2V0KCJwZGZqcy13ZWItZm9udHMtZGlzYWJsZWQiKS50aGVuKG1zZyA9PiB7CiAgICAgICAgY29uc29sZS53YXJuKG1zZyk7CiAgICAgIH0pOwogICAgfQogICAgaWYgKCF0aGlzLnN1cHBvcnRzUHJpbnRpbmcpIHsKICAgICAgYXBwQ29uZmlnLnRvb2xiYXI/LnByaW50Py5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgICAgYXBwQ29uZmlnLnNlY29uZGFyeVRvb2xiYXI/LnByaW50QnV0dG9uLmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgfQogICAgaWYgKCF0aGlzLnN1cHBvcnRzRnVsbHNjcmVlbikgewogICAgICBhcHBDb25maWcuc2Vjb25kYXJ5VG9vbGJhcj8ucHJlc2VudGF0aW9uTW9kZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgIH0KICAgIGlmICh0aGlzLnN1cHBvcnRzSW50ZWdyYXRlZEZpbmQpIHsKICAgICAgYXBwQ29uZmlnLmZpbmRCYXI/LnRvZ2dsZUJ1dHRvbj8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICB9CiAgICBpZiAoZmlsZSkgewogICAgICB0aGlzLm9wZW4oewogICAgICAgIHVybDogZmlsZQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX2hpZGVWaWV3Qm9va21hcmsoKTsKICAgIH0KICB9LAogIGdldCBleHRlcm5hbFNlcnZpY2VzKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZXh0ZXJuYWxTZXJ2aWNlcyIsIG5ldyBFeHRlcm5hbFNlcnZpY2VzKCkpOwogIH0sCiAgZ2V0IGluaXRpYWxpemVkKCkgewogICAgcmV0dXJuIHRoaXMuX2luaXRpYWxpemVkQ2FwYWJpbGl0eS5zZXR0bGVkOwogIH0sCiAgZ2V0IGluaXRpYWxpemVkUHJvbWlzZSgpIHsKICAgIHJldHVybiB0aGlzLl9pbml0aWFsaXplZENhcGFiaWxpdHkucHJvbWlzZTsKICB9LAogIHVwZGF0ZVpvb20oc3RlcHMsIHNjYWxlRmFjdG9yLCBvcmlnaW4pIHsKICAgIGlmICh0aGlzLnBkZlZpZXdlci5pc0luUHJlc2VudGF0aW9uTW9kZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnBkZlZpZXdlci51cGRhdGVTY2FsZSh7CiAgICAgIGRyYXdpbmdEZWxheTogQXBwT3B0aW9ucy5nZXQoImRlZmF1bHRab29tRGVsYXkiKSwKICAgICAgc3RlcHMsCiAgICAgIHNjYWxlRmFjdG9yLAogICAgICBvcmlnaW4KICAgIH0pOwogIH0sCiAgem9vbUluKCkgewogICAgdGhpcy51cGRhdGVab29tKDEpOwogIH0sCiAgem9vbU91dCgpIHsKICAgIHRoaXMudXBkYXRlWm9vbSgtMSk7CiAgfSwKICB6b29tUmVzZXQoKSB7CiAgICBpZiAodGhpcy5wZGZWaWV3ZXIuaXNJblByZXNlbnRhdGlvbk1vZGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5wZGZWaWV3ZXIuY3VycmVudFNjYWxlVmFsdWUgPSBERUZBVUxUX1NDQUxFX1ZBTFVFOwogIH0sCiAgdG91Y2hQaW5jaENhbGxiYWNrKG9yaWdpbiwgcHJldkRpc3RhbmNlLCBkaXN0YW5jZSkgewogICAgaWYgKHRoaXMuc3VwcG9ydHNQaW5jaFRvWm9vbSkgewogICAgICBjb25zdCBuZXdTY2FsZUZhY3RvciA9IHRoaXMuX2FjY3VtdWxhdGVGYWN0b3IodGhpcy5wZGZWaWV3ZXIuY3VycmVudFNjYWxlLCBkaXN0YW5jZSAvIHByZXZEaXN0YW5jZSwgIl90b3VjaFVudXNlZEZhY3RvciIpOwogICAgICB0aGlzLnVwZGF0ZVpvb20obnVsbCwgbmV3U2NhbGVGYWN0b3IsIG9yaWdpbik7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBQSVhFTFNfUEVSX0xJTkVfU0NBTEUgPSAzMDsKICAgICAgY29uc3QgdGlja3MgPSB0aGlzLl9hY2N1bXVsYXRlVGlja3MoKGRpc3RhbmNlIC0gcHJldkRpc3RhbmNlKSAvIFBJWEVMU19QRVJfTElORV9TQ0FMRSwgIl90b3VjaFVudXNlZFRpY2tzIik7CiAgICAgIHRoaXMudXBkYXRlWm9vbSh0aWNrcywgbnVsbCwgb3JpZ2luKTsKICAgIH0KICB9LAogIHRvdWNoUGluY2hFbmRDYWxsYmFjaygpIHsKICAgIHRoaXMuX3RvdWNoVW51c2VkVGlja3MgPSAwOwogICAgdGhpcy5fdG91Y2hVbnVzZWRGYWN0b3IgPSAxOwogIH0sCiAgZ2V0IHBhZ2VzQ291bnQoKSB7CiAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudCA/IHRoaXMucGRmRG9jdW1lbnQubnVtUGFnZXMgOiAwOwogIH0sCiAgZ2V0IHBhZ2UoKSB7CiAgICByZXR1cm4gdGhpcy5wZGZWaWV3ZXIuY3VycmVudFBhZ2VOdW1iZXI7CiAgfSwKICBzZXQgcGFnZSh2YWwpIHsKICAgIHRoaXMucGRmVmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyID0gdmFsOwogIH0sCiAgZ2V0IHN1cHBvcnRzUHJpbnRpbmcoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJzdXBwb3J0c1ByaW50aW5nIiwgQXBwT3B0aW9ucy5nZXQoInN1cHBvcnRzUHJpbnRpbmciKSAmJiBQREZQcmludFNlcnZpY2VGYWN0b3J5LnN1cHBvcnRzUHJpbnRpbmcpOwogIH0sCiAgZ2V0IHN1cHBvcnRzRnVsbHNjcmVlbigpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgInN1cHBvcnRzRnVsbHNjcmVlbiIsIGRvY3VtZW50LmZ1bGxzY3JlZW5FbmFibGVkKTsKICB9LAogIGdldCBzdXBwb3J0c1BpbmNoVG9ab29tKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAic3VwcG9ydHNQaW5jaFRvWm9vbSIsIEFwcE9wdGlvbnMuZ2V0KCJzdXBwb3J0c1BpbmNoVG9ab29tIikpOwogIH0sCiAgZ2V0IHN1cHBvcnRzSW50ZWdyYXRlZEZpbmQoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJzdXBwb3J0c0ludGVncmF0ZWRGaW5kIiwgQXBwT3B0aW9ucy5nZXQoInN1cHBvcnRzSW50ZWdyYXRlZEZpbmQiKSk7CiAgfSwKICBnZXQgbG9hZGluZ0JhcigpIHsKICAgIGNvbnN0IGJhckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9hZGluZ0JhciIpOwogICAgY29uc3QgYmFyID0gYmFyRWxlbWVudCA/IG5ldyBQcm9ncmVzc0JhcihiYXJFbGVtZW50KSA6IG51bGw7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJsb2FkaW5nQmFyIiwgYmFyKTsKICB9LAogIGdldCBzdXBwb3J0c01vdXNlV2hlZWxab29tQ3RybEtleSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgInN1cHBvcnRzTW91c2VXaGVlbFpvb21DdHJsS2V5IiwgQXBwT3B0aW9ucy5nZXQoInN1cHBvcnRzTW91c2VXaGVlbFpvb21DdHJsS2V5IikpOwogIH0sCiAgZ2V0IHN1cHBvcnRzTW91c2VXaGVlbFpvb21NZXRhS2V5KCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAic3VwcG9ydHNNb3VzZVdoZWVsWm9vbU1ldGFLZXkiLCBBcHBPcHRpb25zLmdldCgic3VwcG9ydHNNb3VzZVdoZWVsWm9vbU1ldGFLZXkiKSk7CiAgfSwKICBnZXQgc3VwcG9ydHNDYXJldEJyb3dzaW5nTW9kZSgpIHsKICAgIHJldHVybiBBcHBPcHRpb25zLmdldCgic3VwcG9ydHNDYXJldEJyb3dzaW5nTW9kZSIpOwogIH0sCiAgbW92ZUNhcmV0KGlzVXAsIHNlbGVjdCkgewogICAgdGhpcy5fY2FyZXRCcm93c2luZyB8fD0gbmV3IENhcmV0QnJvd3NpbmdNb2RlKHRoaXMuX2dsb2JhbEFib3J0Q29udHJvbGxlci5zaWduYWwsIHRoaXMuYXBwQ29uZmlnLm1haW5Db250YWluZXIsIHRoaXMuYXBwQ29uZmlnLnZpZXdlckNvbnRhaW5lciwgdGhpcy5hcHBDb25maWcudG9vbGJhcj8uY29udGFpbmVyKTsKICAgIHRoaXMuX2NhcmV0QnJvd3NpbmcubW92ZUNhcmV0KGlzVXAsIHNlbGVjdCk7CiAgfSwKICBzZXRUaXRsZVVzaW5nVXJsKHVybCA9ICIiLCBkb3dubG9hZFVybCA9IG51bGwpIHsKICAgIHRoaXMudXJsID0gdXJsOwogICAgdGhpcy5iYXNlVXJsID0gdXBkYXRlVXJsSGFzaCh1cmwsICIiLCB0cnVlKTsKICAgIGlmIChkb3dubG9hZFVybCkgewogICAgICB0aGlzLl9kb3dubG9hZFVybCA9IGRvd25sb2FkVXJsID09PSB1cmwgPyB0aGlzLmJhc2VVcmwgOiB1cGRhdGVVcmxIYXNoKGRvd25sb2FkVXJsLCAiIiwgdHJ1ZSk7CiAgICB9CiAgICBpZiAoaXNEYXRhU2NoZW1lKHVybCkpIHsKICAgICAgdGhpcy5faGlkZVZpZXdCb29rbWFyaygpOwogICAgfQogICAgbGV0IHRpdGxlID0gcGRmanNfZ2V0UGRmRmlsZW5hbWVGcm9tVXJsKHVybCwgIiIpOwogICAgaWYgKCF0aXRsZSkgewogICAgICB0cnkgewogICAgICAgIHRpdGxlID0gZGVjb2RlVVJJQ29tcG9uZW50KGdldEZpbGVuYW1lRnJvbVVybCh1cmwpKTsKICAgICAgfSBjYXRjaCB7fQogICAgfQogICAgdGhpcy5zZXRUaXRsZSh0aXRsZSB8fCB1cmwpOwogIH0sCiAgc2V0VGl0bGUodGl0bGUgPSB0aGlzLl90aXRsZSkgewogICAgdGhpcy5fdGl0bGUgPSB0aXRsZTsKICAgIGlmICh0aGlzLmlzVmlld2VyRW1iZWRkZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZWRpdG9ySW5kaWNhdG9yID0gdGhpcy5faGFzQW5ub3RhdGlvbkVkaXRvcnMgJiYgIXRoaXMucGRmUmVuZGVyaW5nUXVldWUucHJpbnRpbmc7CiAgICBkb2N1bWVudC50aXRsZSA9IGAke2VkaXRvckluZGljYXRvciA/ICIqICIgOiAiIn0ke3RpdGxlfWA7CiAgfSwKICBnZXQgX2RvY0ZpbGVuYW1lKCkgewogICAgcmV0dXJuIHRoaXMuX2NvbnRlbnREaXNwb3NpdGlvbkZpbGVuYW1lIHx8IHBkZmpzX2dldFBkZkZpbGVuYW1lRnJvbVVybCh0aGlzLnVybCk7CiAgfSwKICBnZXQgX2RvY1RpdGxlKCkgewogICAgY29uc3QgewogICAgICBkb2N1bWVudEluZm8sCiAgICAgIG1ldGFkYXRhCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHRpdGxlID0gbWV0YWRhdGE/LmdldCgiZGM6dGl0bGUiKTsKICAgIGlmICh0aXRsZSkgewogICAgICBpZiAodGl0bGUgIT09ICJVbnRpdGxlZCIgJiYgIS9bXHVGRkYwLVx1RkZGRl0vZy50ZXN0KHRpdGxlKSkgewogICAgICAgIHJldHVybiB0aXRsZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRvY3VtZW50SW5mby5UaXRsZTsKICB9LAogIF9oaWRlVmlld0Jvb2ttYXJrKCkgewogICAgY29uc3QgewogICAgICBzZWNvbmRhcnlUb29sYmFyCiAgICB9ID0gdGhpcy5hcHBDb25maWc7CiAgICBzZWNvbmRhcnlUb29sYmFyPy52aWV3Qm9va21hcmtCdXR0b24uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICBpZiAoc2Vjb25kYXJ5VG9vbGJhcj8ucHJlc2VudGF0aW9uTW9kZUJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoImhpZGRlbiIpKSB7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3Qm9va21hcmtTZXBhcmF0b3IiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICB9CiAgfSwKICBhc3luYyBjbG9zZSgpIHsKICAgIHRoaXMuX3VuYmxvY2tEb2N1bWVudExvYWRFdmVudCgpOwogICAgdGhpcy5faGlkZVZpZXdCb29rbWFyaygpOwogICAgaWYgKCF0aGlzLnBkZkxvYWRpbmdUYXNrKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLnBkZkRvY3VtZW50Py5hbm5vdGF0aW9uU3RvcmFnZS5zaXplID4gMCAmJiB0aGlzLl9hbm5vdGF0aW9uU3RvcmFnZU1vZGlmaWVkKSB7CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgdGhpcy5zYXZlKCk7CiAgICAgIH0gY2F0Y2gge30KICAgIH0KICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICBwcm9taXNlcy5wdXNoKHRoaXMucGRmTG9hZGluZ1Rhc2suZGVzdHJveSgpKTsKICAgIHRoaXMucGRmTG9hZGluZ1Rhc2sgPSBudWxsOwogICAgaWYgKHRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgdGhpcy5wZGZEb2N1bWVudCA9IG51bGw7CiAgICAgIHRoaXMucGRmVGh1bWJuYWlsVmlld2VyPy5zZXREb2N1bWVudChudWxsKTsKICAgICAgdGhpcy5wZGZWaWV3ZXIuc2V0RG9jdW1lbnQobnVsbCk7CiAgICAgIHRoaXMucGRmTGlua1NlcnZpY2Uuc2V0RG9jdW1lbnQobnVsbCk7CiAgICAgIHRoaXMucGRmRG9jdW1lbnRQcm9wZXJ0aWVzPy5zZXREb2N1bWVudChudWxsKTsKICAgIH0KICAgIHRoaXMucGRmTGlua1NlcnZpY2UuZXh0ZXJuYWxMaW5rRW5hYmxlZCA9IHRydWU7CiAgICB0aGlzLnN0b3JlID0gbnVsbDsKICAgIHRoaXMuaXNJbml0aWFsVmlld1NldCA9IGZhbHNlOwogICAgdGhpcy51cmwgPSAiIjsKICAgIHRoaXMuYmFzZVVybCA9ICIiOwogICAgdGhpcy5fZG93bmxvYWRVcmwgPSAiIjsKICAgIHRoaXMuZG9jdW1lbnRJbmZvID0gbnVsbDsKICAgIHRoaXMubWV0YWRhdGEgPSBudWxsOwogICAgdGhpcy5fY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWUgPSBudWxsOwogICAgdGhpcy5fY29udGVudExlbmd0aCA9IG51bGw7CiAgICB0aGlzLl9zYXZlSW5Qcm9ncmVzcyA9IGZhbHNlOwogICAgdGhpcy5faGFzQW5ub3RhdGlvbkVkaXRvcnMgPSBmYWxzZTsKICAgIHByb21pc2VzLnB1c2godGhpcy5wZGZTY3JpcHRpbmdNYW5hZ2VyLmRlc3Ryb3lQcm9taXNlLCB0aGlzLnBhc3N3b3JkUHJvbXB0LmNsb3NlKCkpOwogICAgdGhpcy5zZXRUaXRsZSgpOwogICAgdGhpcy5wZGZTaWRlYmFyPy5yZXNldCgpOwogICAgdGhpcy5wZGZPdXRsaW5lVmlld2VyPy5yZXNldCgpOwogICAgdGhpcy5wZGZBdHRhY2htZW50Vmlld2VyPy5yZXNldCgpOwogICAgdGhpcy5wZGZMYXllclZpZXdlcj8ucmVzZXQoKTsKICAgIHRoaXMucGRmSGlzdG9yeT8ucmVzZXQoKTsKICAgIHRoaXMuZmluZEJhcj8ucmVzZXQoKTsKICAgIHRoaXMudG9vbGJhcj8ucmVzZXQoKTsKICAgIHRoaXMuc2Vjb25kYXJ5VG9vbGJhcj8ucmVzZXQoKTsKICAgIHRoaXMuX1BERkJ1Zz8uY2xlYW51cCgpOwogICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogIH0sCiAgYXN5bmMgb3BlbihhcmdzKSB7CiAgICBpZiAodGhpcy5wZGZMb2FkaW5nVGFzaykgewogICAgICBhd2FpdCB0aGlzLmNsb3NlKCk7CiAgICB9CiAgICBjb25zdCB3b3JrZXJQYXJhbXMgPSBBcHBPcHRpb25zLmdldEFsbChPcHRpb25LaW5kLldPUktFUik7CiAgICBPYmplY3QuYXNzaWduKEdsb2JhbFdvcmtlck9wdGlvbnMsIHdvcmtlclBhcmFtcyk7CiAgICBpZiAoYXJncy51cmwpIHsKICAgICAgdGhpcy5zZXRUaXRsZVVzaW5nVXJsKGFyZ3Mub3JpZ2luYWxVcmwgfHwgYXJncy51cmwsIGFyZ3MudXJsKTsKICAgIH0KICAgIGNvbnN0IGFwaVBhcmFtcyA9IEFwcE9wdGlvbnMuZ2V0QWxsKE9wdGlvbktpbmQuQVBJKTsKICAgIGNvbnN0IGxvYWRpbmdUYXNrID0gZ2V0RG9jdW1lbnQoewogICAgICAuLi5hcGlQYXJhbXMsCiAgICAgIC4uLmFyZ3MKICAgIH0pOwogICAgdGhpcy5wZGZMb2FkaW5nVGFzayA9IGxvYWRpbmdUYXNrOwogICAgbG9hZGluZ1Rhc2sub25QYXNzd29yZCA9ICh1cGRhdGVDYWxsYmFjaywgcmVhc29uKSA9PiB7CiAgICAgIGlmICh0aGlzLmlzVmlld2VyRW1iZWRkZWQpIHsKICAgICAgICB0aGlzLl91bmJsb2NrRG9jdW1lbnRMb2FkRXZlbnQoKTsKICAgICAgfQogICAgICB0aGlzLnBkZkxpbmtTZXJ2aWNlLmV4dGVybmFsTGlua0VuYWJsZWQgPSBmYWxzZTsKICAgICAgdGhpcy5wYXNzd29yZFByb21wdC5zZXRVcGRhdGVDYWxsYmFjayh1cGRhdGVDYWxsYmFjaywgcmVhc29uKTsKICAgICAgdGhpcy5wYXNzd29yZFByb21wdC5vcGVuKCk7CiAgICB9OwogICAgbG9hZGluZ1Rhc2sub25Qcm9ncmVzcyA9ICh7CiAgICAgIGxvYWRlZCwKICAgICAgdG90YWwKICAgIH0pID0+IHsKICAgICAgdGhpcy5wcm9ncmVzcyhsb2FkZWQgLyB0b3RhbCk7CiAgICB9OwogICAgcmV0dXJuIGxvYWRpbmdUYXNrLnByb21pc2UudGhlbihwZGZEb2N1bWVudCA9PiB7CiAgICAgIHRoaXMubG9hZChwZGZEb2N1bWVudCk7CiAgICB9LCByZWFzb24gPT4gewogICAgICBpZiAobG9hZGluZ1Rhc2sgIT09IHRoaXMucGRmTG9hZGluZ1Rhc2spIHsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGxldCBrZXkgPSAicGRmanMtbG9hZGluZy1lcnJvciI7CiAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBJbnZhbGlkUERGRXhjZXB0aW9uKSB7CiAgICAgICAga2V5ID0gInBkZmpzLWludmFsaWQtZmlsZS1lcnJvciI7CiAgICAgIH0gZWxzZSBpZiAocmVhc29uIGluc3RhbmNlb2YgUmVzcG9uc2VFeGNlcHRpb24pIHsKICAgICAgICBrZXkgPSByZWFzb24ubWlzc2luZyA/ICJwZGZqcy1taXNzaW5nLWZpbGUtZXJyb3IiIDogInBkZmpzLXVuZXhwZWN0ZWQtcmVzcG9uc2UtZXJyb3IiOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9kb2N1bWVudEVycm9yKGtleSwgewogICAgICAgIG1lc3NhZ2U6IHJlYXNvbi5tZXNzYWdlCiAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgfSk7CiAgICB9KTsKICB9LAogIGFzeW5jIGRvd25sb2FkKCkgewogICAgbGV0IGRhdGE7CiAgICB0cnkgewogICAgICBkYXRhID0gYXdhaXQgKHRoaXMucGRmRG9jdW1lbnQgPyB0aGlzLnBkZkRvY3VtZW50LmdldERhdGEoKSA6IHRoaXMucGRmTG9hZGluZ1Rhc2suZ2V0RGF0YSgpKTsKICAgIH0gY2F0Y2gge30KICAgIHRoaXMuZG93bmxvYWRNYW5hZ2VyLmRvd25sb2FkKGRhdGEsIHRoaXMuX2Rvd25sb2FkVXJsLCB0aGlzLl9kb2NGaWxlbmFtZSk7CiAgfSwKICBhc3luYyBzYXZlKCkgewogICAgaWYgKHRoaXMuX3NhdmVJblByb2dyZXNzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX3NhdmVJblByb2dyZXNzID0gdHJ1ZTsKICAgIGF3YWl0IHRoaXMucGRmU2NyaXB0aW5nTWFuYWdlci5kaXNwYXRjaFdpbGxTYXZlKCk7CiAgICB0cnkgewogICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5wZGZEb2N1bWVudC5zYXZlRG9jdW1lbnQoKTsKICAgICAgdGhpcy5kb3dubG9hZE1hbmFnZXIuZG93bmxvYWQoZGF0YSwgdGhpcy5fZG93bmxvYWRVcmwsIHRoaXMuX2RvY0ZpbGVuYW1lKTsKICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICBjb25zb2xlLmVycm9yKGBFcnJvciB3aGVuIHNhdmluZyB0aGUgZG9jdW1lbnQ6YCwgcmVhc29uKTsKICAgICAgYXdhaXQgdGhpcy5kb3dubG9hZCgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgYXdhaXQgdGhpcy5wZGZTY3JpcHRpbmdNYW5hZ2VyLmRpc3BhdGNoRGlkU2F2ZSgpOwogICAgICB0aGlzLl9zYXZlSW5Qcm9ncmVzcyA9IGZhbHNlOwogICAgfQogICAgaWYgKHRoaXMuX2hhc0Fubm90YXRpb25FZGl0b3JzKSB7CiAgICAgIHRoaXMuZXh0ZXJuYWxTZXJ2aWNlcy5yZXBvcnRUZWxlbWV0cnkoewogICAgICAgIHR5cGU6ICJlZGl0aW5nIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICB0eXBlOiAic2F2ZSIsCiAgICAgICAgICBzdGF0czogdGhpcy5wZGZEb2N1bWVudD8uYW5ub3RhdGlvblN0b3JhZ2UuZWRpdG9yU3RhdHMKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sCiAgYXN5bmMgZG93bmxvYWRPclNhdmUoKSB7CiAgICBjb25zdCB7CiAgICAgIGNsYXNzTGlzdAogICAgfSA9IHRoaXMuYXBwQ29uZmlnLmFwcENvbnRhaW5lcjsKICAgIGNsYXNzTGlzdC5hZGQoIndhaXQiKTsKICAgIGF3YWl0ICh0aGlzLnBkZkRvY3VtZW50Py5hbm5vdGF0aW9uU3RvcmFnZS5zaXplID4gMCA/IHRoaXMuc2F2ZSgpIDogdGhpcy5kb3dubG9hZCgpKTsKICAgIGNsYXNzTGlzdC5yZW1vdmUoIndhaXQiKTsKICB9LAogIGFzeW5jIF9kb2N1bWVudEVycm9yKGtleSwgbW9yZUluZm8gPSBudWxsKSB7CiAgICB0aGlzLl91bmJsb2NrRG9jdW1lbnRMb2FkRXZlbnQoKTsKICAgIGNvbnN0IG1lc3NhZ2UgPSBhd2FpdCB0aGlzLl9vdGhlckVycm9yKGtleSB8fCAicGRmanMtbG9hZGluZy1lcnJvciIsIG1vcmVJbmZvKTsKICAgIHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goImRvY3VtZW50ZXJyb3IiLCB7CiAgICAgIHNvdXJjZTogdGhpcywKICAgICAgbWVzc2FnZSwKICAgICAgcmVhc29uOiBtb3JlSW5mbz8ubWVzc2FnZSA/PyBudWxsCiAgICB9KTsKICB9LAogIGFzeW5jIF9vdGhlckVycm9yKGtleSwgbW9yZUluZm8gPSBudWxsKSB7CiAgICBjb25zdCBtZXNzYWdlID0gYXdhaXQgdGhpcy5sMTBuLmdldChrZXkpOwogICAgY29uc3QgbW9yZUluZm9UZXh0ID0gW2BQREYuanMgdiR7dmVyc2lvbiB8fCAiPyJ9IChidWlsZDogJHtidWlsZCB8fCAiPyJ9KWBdOwogICAgaWYgKG1vcmVJbmZvKSB7CiAgICAgIG1vcmVJbmZvVGV4dC5wdXNoKGBNZXNzYWdlOiAke21vcmVJbmZvLm1lc3NhZ2V9YCk7CiAgICAgIGlmIChtb3JlSW5mby5zdGFjaykgewogICAgICAgIG1vcmVJbmZvVGV4dC5wdXNoKGBTdGFjazogJHttb3JlSW5mby5zdGFja31gKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAobW9yZUluZm8uZmlsZW5hbWUpIHsKICAgICAgICAgIG1vcmVJbmZvVGV4dC5wdXNoKGBGaWxlOiAke21vcmVJbmZvLmZpbGVuYW1lfWApOwogICAgICAgIH0KICAgICAgICBpZiAobW9yZUluZm8ubGluZU51bWJlcikgewogICAgICAgICAgbW9yZUluZm9UZXh0LnB1c2goYExpbmU6ICR7bW9yZUluZm8ubGluZU51bWJlcn1gKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbnNvbGUuZXJyb3IoYCR7bWVzc2FnZX1cblxuJHttb3JlSW5mb1RleHQuam9pbigiXG4iKX1gKTsKICAgIHJldHVybiBtZXNzYWdlOwogIH0sCiAgcHJvZ3Jlc3MobGV2ZWwpIHsKICAgIGNvbnN0IHBlcmNlbnQgPSBNYXRoLnJvdW5kKGxldmVsICogMTAwKTsKICAgIGlmICghdGhpcy5sb2FkaW5nQmFyIHx8IHBlcmNlbnQgPD0gdGhpcy5sb2FkaW5nQmFyLnBlcmNlbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5sb2FkaW5nQmFyLnBlcmNlbnQgPSBwZXJjZW50OwogICAgaWYgKHRoaXMucGRmRG9jdW1lbnQ/LmxvYWRpbmdQYXJhbXMuZGlzYWJsZUF1dG9GZXRjaCA/PyBBcHBPcHRpb25zLmdldCgiZGlzYWJsZUF1dG9GZXRjaCIpKSB7CiAgICAgIHRoaXMubG9hZGluZ0Jhci5zZXREaXNhYmxlQXV0b0ZldGNoKCk7CiAgICB9CiAgfSwKICBsb2FkKHBkZkRvY3VtZW50KSB7CiAgICB0aGlzLnBkZkRvY3VtZW50ID0gcGRmRG9jdW1lbnQ7CiAgICBwZGZEb2N1bWVudC5nZXREb3dubG9hZEluZm8oKS50aGVuKCh7CiAgICAgIGxlbmd0aAogICAgfSkgPT4gewogICAgICB0aGlzLl9jb250ZW50TGVuZ3RoID0gbGVuZ3RoOwogICAgICB0aGlzLmxvYWRpbmdCYXI/LmhpZGUoKTsKICAgICAgZmlyc3RQYWdlUHJvbWlzZS50aGVuKCgpID0+IHsKICAgICAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJkb2N1bWVudGxvYWRlZCIsIHsKICAgICAgICAgIHNvdXJjZTogdGhpcwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogICAgY29uc3QgcGFnZUxheW91dFByb21pc2UgPSBwZGZEb2N1bWVudC5nZXRQYWdlTGF5b3V0KCkuY2F0Y2goKCkgPT4ge30pOwogICAgY29uc3QgcGFnZU1vZGVQcm9taXNlID0gcGRmRG9jdW1lbnQuZ2V0UGFnZU1vZGUoKS5jYXRjaCgoKSA9PiB7fSk7CiAgICBjb25zdCBvcGVuQWN0aW9uUHJvbWlzZSA9IHBkZkRvY3VtZW50LmdldE9wZW5BY3Rpb24oKS5jYXRjaCgoKSA9PiB7fSk7CiAgICB0aGlzLnRvb2xiYXI/LnNldFBhZ2VzQ291bnQocGRmRG9jdW1lbnQubnVtUGFnZXMsIGZhbHNlKTsKICAgIHRoaXMuc2Vjb25kYXJ5VG9vbGJhcj8uc2V0UGFnZXNDb3VudChwZGZEb2N1bWVudC5udW1QYWdlcyk7CiAgICB0aGlzLnBkZkxpbmtTZXJ2aWNlLnNldERvY3VtZW50KHBkZkRvY3VtZW50KTsKICAgIHRoaXMucGRmRG9jdW1lbnRQcm9wZXJ0aWVzPy5zZXREb2N1bWVudChwZGZEb2N1bWVudCk7CiAgICBjb25zdCBwZGZWaWV3ZXIgPSB0aGlzLnBkZlZpZXdlcjsKICAgIHBkZlZpZXdlci5zZXREb2N1bWVudChwZGZEb2N1bWVudCk7CiAgICBjb25zdCB7CiAgICAgIGZpcnN0UGFnZVByb21pc2UsCiAgICAgIG9uZVBhZ2VSZW5kZXJlZCwKICAgICAgcGFnZXNQcm9taXNlCiAgICB9ID0gcGRmVmlld2VyOwogICAgdGhpcy5wZGZUaHVtYm5haWxWaWV3ZXI/LnNldERvY3VtZW50KHBkZkRvY3VtZW50KTsKICAgIGNvbnN0IHN0b3JlZFByb21pc2UgPSAodGhpcy5zdG9yZSA9IG5ldyBWaWV3SGlzdG9yeShwZGZEb2N1bWVudC5maW5nZXJwcmludHNbMF0pKS5nZXRNdWx0aXBsZSh7CiAgICAgIHBhZ2U6IG51bGwsCiAgICAgIHpvb206IERFRkFVTFRfU0NBTEVfVkFMVUUsCiAgICAgIHNjcm9sbExlZnQ6ICIwIiwKICAgICAgc2Nyb2xsVG9wOiAiMCIsCiAgICAgIHJvdGF0aW9uOiBudWxsLAogICAgICBzaWRlYmFyVmlldzogU2lkZWJhclZpZXcuVU5LTk9XTiwKICAgICAgc2Nyb2xsTW9kZTogU2Nyb2xsTW9kZS5VTktOT1dOLAogICAgICBzcHJlYWRNb2RlOiBTcHJlYWRNb2RlLlVOS05PV04KICAgIH0pLmNhdGNoKCgpID0+IHt9KTsKICAgIGZpcnN0UGFnZVByb21pc2UudGhlbihwZGZQYWdlID0+IHsKICAgICAgdGhpcy5sb2FkaW5nQmFyPy5zZXRXaWR0aCh0aGlzLmFwcENvbmZpZy52aWV3ZXJDb250YWluZXIpOwogICAgICB0aGlzLl9pbml0aWFsaXplQW5ub3RhdGlvblN0b3JhZ2VDYWxsYmFja3MocGRmRG9jdW1lbnQpOwogICAgICBQcm9taXNlLmFsbChbYW5pbWF0aW9uU3RhcnRlZCwgc3RvcmVkUHJvbWlzZSwgcGFnZUxheW91dFByb21pc2UsIHBhZ2VNb2RlUHJvbWlzZSwgb3BlbkFjdGlvblByb21pc2VdKS50aGVuKGFzeW5jIChbdGltZVN0YW1wLCBzdG9yZWQsIHBhZ2VMYXlvdXQsIHBhZ2VNb2RlLCBvcGVuQWN0aW9uXSkgPT4gewogICAgICAgIGNvbnN0IHZpZXdPbkxvYWQgPSBBcHBPcHRpb25zLmdldCgidmlld09uTG9hZCIpOwogICAgICAgIHRoaXMuX2luaXRpYWxpemVQZGZIaXN0b3J5KHsKICAgICAgICAgIGZpbmdlcnByaW50OiBwZGZEb2N1bWVudC5maW5nZXJwcmludHNbMF0sCiAgICAgICAgICB2aWV3T25Mb2FkLAogICAgICAgICAgaW5pdGlhbERlc3Q6IG9wZW5BY3Rpb24/LmRlc3QKICAgICAgICB9KTsKICAgICAgICBjb25zdCBpbml0aWFsQm9va21hcmsgPSB0aGlzLmluaXRpYWxCb29rbWFyazsKICAgICAgICBjb25zdCB6b29tID0gQXBwT3B0aW9ucy5nZXQoImRlZmF1bHRab29tVmFsdWUiKTsKICAgICAgICBsZXQgaGFzaCA9IHpvb20gPyBgem9vbT0ke3pvb219YCA6IG51bGw7CiAgICAgICAgbGV0IHJvdGF0aW9uID0gbnVsbDsKICAgICAgICBsZXQgc2lkZWJhclZpZXcgPSBBcHBPcHRpb25zLmdldCgic2lkZWJhclZpZXdPbkxvYWQiKTsKICAgICAgICBsZXQgc2Nyb2xsTW9kZSA9IEFwcE9wdGlvbnMuZ2V0KCJzY3JvbGxNb2RlT25Mb2FkIik7CiAgICAgICAgbGV0IHNwcmVhZE1vZGUgPSBBcHBPcHRpb25zLmdldCgic3ByZWFkTW9kZU9uTG9hZCIpOwogICAgICAgIGlmIChzdG9yZWQ/LnBhZ2UgJiYgdmlld09uTG9hZCAhPT0gVmlld09uTG9hZC5JTklUSUFMKSB7CiAgICAgICAgICBoYXNoID0gYHBhZ2U9JHtzdG9yZWQucGFnZX0mem9vbT0ke3pvb20gfHwgc3RvcmVkLnpvb219LGAgKyBgJHtzdG9yZWQuc2Nyb2xsTGVmdH0sJHtzdG9yZWQuc2Nyb2xsVG9wfWA7CiAgICAgICAgICByb3RhdGlvbiA9IHBhcnNlSW50KHN0b3JlZC5yb3RhdGlvbiwgMTApOwogICAgICAgICAgaWYgKHNpZGViYXJWaWV3ID09PSBTaWRlYmFyVmlldy5VTktOT1dOKSB7CiAgICAgICAgICAgIHNpZGViYXJWaWV3ID0gc3RvcmVkLnNpZGViYXJWaWV3IHwgMDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzY3JvbGxNb2RlID09PSBTY3JvbGxNb2RlLlVOS05PV04pIHsKICAgICAgICAgICAgc2Nyb2xsTW9kZSA9IHN0b3JlZC5zY3JvbGxNb2RlIHwgMDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzcHJlYWRNb2RlID09PSBTcHJlYWRNb2RlLlVOS05PV04pIHsKICAgICAgICAgICAgc3ByZWFkTW9kZSA9IHN0b3JlZC5zcHJlYWRNb2RlIHwgMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHBhZ2VNb2RlICYmIHNpZGViYXJWaWV3ID09PSBTaWRlYmFyVmlldy5VTktOT1dOKSB7CiAgICAgICAgICBzaWRlYmFyVmlldyA9IGFwaVBhZ2VNb2RlVG9TaWRlYmFyVmlldyhwYWdlTW9kZSk7CiAgICAgICAgfQogICAgICAgIGlmIChwYWdlTGF5b3V0ICYmIHNjcm9sbE1vZGUgPT09IFNjcm9sbE1vZGUuVU5LTk9XTiAmJiBzcHJlYWRNb2RlID09PSBTcHJlYWRNb2RlLlVOS05PV04pIHsKICAgICAgICAgIGNvbnN0IG1vZGVzID0gYXBpUGFnZUxheW91dFRvVmlld2VyTW9kZXMocGFnZUxheW91dCk7CiAgICAgICAgICBzcHJlYWRNb2RlID0gbW9kZXMuc3ByZWFkTW9kZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zZXRJbml0aWFsVmlldyhoYXNoLCB7CiAgICAgICAgICByb3RhdGlvbiwKICAgICAgICAgIHNpZGViYXJWaWV3LAogICAgICAgICAgc2Nyb2xsTW9kZSwKICAgICAgICAgIHNwcmVhZE1vZGUKICAgICAgICB9KTsKICAgICAgICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJkb2N1bWVudGluaXQiLCB7CiAgICAgICAgICBzb3VyY2U6IHRoaXMKICAgICAgICB9KTsKICAgICAgICBpZiAoIXRoaXMuaXNWaWV3ZXJFbWJlZGRlZCkgewogICAgICAgICAgcGRmVmlld2VyLmZvY3VzKCk7CiAgICAgICAgfQogICAgICAgIGF3YWl0IFByb21pc2UucmFjZShbcGFnZXNQcm9taXNlLCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgIHNldFRpbWVvdXQocmVzb2x2ZSwgRk9SQ0VfUEFHRVNfTE9BREVEX1RJTUVPVVQpOwogICAgICAgIH0pXSk7CiAgICAgICAgaWYgKCFpbml0aWFsQm9va21hcmsgJiYgIWhhc2gpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHBkZlZpZXdlci5oYXNFcXVhbFBhZ2VTaXplcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmluaXRpYWxCb29rbWFyayA9IGluaXRpYWxCb29rbWFyazsKICAgICAgICBwZGZWaWV3ZXIuY3VycmVudFNjYWxlVmFsdWUgPSBwZGZWaWV3ZXIuY3VycmVudFNjYWxlVmFsdWU7CiAgICAgICAgdGhpcy5zZXRJbml0aWFsVmlldyhoYXNoKTsKICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgIHRoaXMuc2V0SW5pdGlhbFZpZXcoKTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgcGRmVmlld2VyLnVwZGF0ZSgpOwogICAgICB9KTsKICAgIH0pOwogICAgcGFnZXNQcm9taXNlLnRoZW4oKCkgPT4gewogICAgICB0aGlzLl91bmJsb2NrRG9jdW1lbnRMb2FkRXZlbnQoKTsKICAgICAgdGhpcy5faW5pdGlhbGl6ZUF1dG9QcmludChwZGZEb2N1bWVudCwgb3BlbkFjdGlvblByb21pc2UpOwogICAgfSwgcmVhc29uID0+IHsKICAgICAgdGhpcy5fZG9jdW1lbnRFcnJvcigicGRmanMtbG9hZGluZy1lcnJvciIsIHsKICAgICAgICBtZXNzYWdlOiByZWFzb24ubWVzc2FnZQogICAgICB9KTsKICAgIH0pOwogICAgb25lUGFnZVJlbmRlcmVkLnRoZW4oZGF0YSA9PiB7CiAgICAgIHRoaXMuZXh0ZXJuYWxTZXJ2aWNlcy5yZXBvcnRUZWxlbWV0cnkoewogICAgICAgIHR5cGU6ICJwYWdlSW5mbyIsCiAgICAgICAgdGltZXN0YW1wOiBkYXRhLnRpbWVzdGFtcAogICAgICB9KTsKICAgICAgaWYgKHRoaXMucGRmT3V0bGluZVZpZXdlcikgewogICAgICAgIHBkZkRvY3VtZW50LmdldE91dGxpbmUoKS50aGVuKG91dGxpbmUgPT4gewogICAgICAgICAgaWYgKHBkZkRvY3VtZW50ICE9PSB0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMucGRmT3V0bGluZVZpZXdlci5yZW5kZXIoewogICAgICAgICAgICBvdXRsaW5lLAogICAgICAgICAgICBwZGZEb2N1bWVudAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMucGRmQXR0YWNobWVudFZpZXdlcikgewogICAgICAgIHBkZkRvY3VtZW50LmdldEF0dGFjaG1lbnRzKCkudGhlbihhdHRhY2htZW50cyA9PiB7CiAgICAgICAgICBpZiAocGRmRG9jdW1lbnQgIT09IHRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5wZGZBdHRhY2htZW50Vmlld2VyLnJlbmRlcih7CiAgICAgICAgICAgIGF0dGFjaG1lbnRzCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAodGhpcy5wZGZMYXllclZpZXdlcikgewogICAgICAgIHBkZlZpZXdlci5vcHRpb25hbENvbnRlbnRDb25maWdQcm9taXNlLnRoZW4ob3B0aW9uYWxDb250ZW50Q29uZmlnID0+IHsKICAgICAgICAgIGlmIChwZGZEb2N1bWVudCAhPT0gdGhpcy5wZGZEb2N1bWVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnBkZkxheWVyVmlld2VyLnJlbmRlcih7CiAgICAgICAgICAgIG9wdGlvbmFsQ29udGVudENvbmZpZywKICAgICAgICAgICAgcGRmRG9jdW1lbnQKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuX2luaXRpYWxpemVQYWdlTGFiZWxzKHBkZkRvY3VtZW50KTsKICAgIHRoaXMuX2luaXRpYWxpemVNZXRhZGF0YShwZGZEb2N1bWVudCk7CiAgfSwKICBhc3luYyBfc2NyaXB0aW5nRG9jUHJvcGVydGllcyhwZGZEb2N1bWVudCkgewogICAgaWYgKCF0aGlzLmRvY3VtZW50SW5mbykgewogICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICB0aGlzLmV2ZW50QnVzLl9vbigibWV0YWRhdGFsb2FkZWQiLCByZXNvbHZlLCB7CiAgICAgICAgICBvbmNlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICBpZiAocGRmRG9jdW1lbnQgIT09IHRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgaWYgKCF0aGlzLl9jb250ZW50TGVuZ3RoKSB7CiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgIHRoaXMuZXZlbnRCdXMuX29uKCJkb2N1bWVudGxvYWRlZCIsIHJlc29sdmUsIHsKICAgICAgICAgIG9uY2U6IHRydWUKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIGlmIChwZGZEb2N1bWVudCAhPT0gdGhpcy5wZGZEb2N1bWVudCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICAuLi50aGlzLmRvY3VtZW50SW5mbywKICAgICAgYmFzZVVSTDogdGhpcy5iYXNlVXJsLAogICAgICBmaWxlc2l6ZTogdGhpcy5fY29udGVudExlbmd0aCwKICAgICAgZmlsZW5hbWU6IHRoaXMuX2RvY0ZpbGVuYW1lLAogICAgICBtZXRhZGF0YTogdGhpcy5tZXRhZGF0YT8uZ2V0UmF3KCksCiAgICAgIGF1dGhvcnM6IHRoaXMubWV0YWRhdGE/LmdldCgiZGM6Y3JlYXRvciIpLAogICAgICBudW1QYWdlczogdGhpcy5wYWdlc0NvdW50LAogICAgICBVUkw6IHRoaXMudXJsCiAgICB9OwogIH0sCiAgYXN5bmMgX2luaXRpYWxpemVBdXRvUHJpbnQocGRmRG9jdW1lbnQsIG9wZW5BY3Rpb25Qcm9taXNlKSB7CiAgICBjb25zdCBbb3BlbkFjdGlvbiwganNBY3Rpb25zXSA9IGF3YWl0IFByb21pc2UuYWxsKFtvcGVuQWN0aW9uUHJvbWlzZSwgdGhpcy5wZGZWaWV3ZXIuZW5hYmxlU2NyaXB0aW5nID8gbnVsbCA6IHBkZkRvY3VtZW50LmdldEpTQWN0aW9ucygpXSk7CiAgICBpZiAocGRmRG9jdW1lbnQgIT09IHRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IHRyaWdnZXJBdXRvUHJpbnQgPSBvcGVuQWN0aW9uPy5hY3Rpb24gPT09ICJQcmludCI7CiAgICBpZiAoanNBY3Rpb25zKSB7CiAgICAgIGNvbnNvbGUud2FybigiV2FybmluZzogSmF2YVNjcmlwdCBzdXBwb3J0IGlzIG5vdCBlbmFibGVkIik7CiAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBqc0FjdGlvbnMpIHsKICAgICAgICBpZiAodHJpZ2dlckF1dG9QcmludCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAobmFtZSkgewogICAgICAgICAgY2FzZSAiV2lsbENsb3NlIjoKICAgICAgICAgIGNhc2UgIldpbGxTYXZlIjoKICAgICAgICAgIGNhc2UgIkRpZFNhdmUiOgogICAgICAgICAgY2FzZSAiV2lsbFByaW50IjoKICAgICAgICAgIGNhc2UgIkRpZFByaW50IjoKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRyaWdnZXJBdXRvUHJpbnQgPSBqc0FjdGlvbnNbbmFtZV0uc29tZShqcyA9PiBBdXRvUHJpbnRSZWdFeHAudGVzdChqcykpOwogICAgICB9CiAgICB9CiAgICBpZiAodHJpZ2dlckF1dG9QcmludCkgewogICAgICB0aGlzLnRyaWdnZXJQcmludGluZygpOwogICAgfQogIH0sCiAgYXN5bmMgX2luaXRpYWxpemVNZXRhZGF0YShwZGZEb2N1bWVudCkgewogICAgY29uc3QgewogICAgICBpbmZvLAogICAgICBtZXRhZGF0YSwKICAgICAgY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWUsCiAgICAgIGNvbnRlbnRMZW5ndGgKICAgIH0gPSBhd2FpdCBwZGZEb2N1bWVudC5nZXRNZXRhZGF0YSgpOwogICAgaWYgKHBkZkRvY3VtZW50ICE9PSB0aGlzLnBkZkRvY3VtZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZG9jdW1lbnRJbmZvID0gaW5mbzsKICAgIHRoaXMubWV0YWRhdGEgPSBtZXRhZGF0YTsKICAgIHRoaXMuX2NvbnRlbnREaXNwb3NpdGlvbkZpbGVuYW1lID8/PSBjb250ZW50RGlzcG9zaXRpb25GaWxlbmFtZTsKICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPz89IGNvbnRlbnRMZW5ndGg7CiAgICBjb25zb2xlLmxvZyhgUERGICR7cGRmRG9jdW1lbnQuZmluZ2VycHJpbnRzWzBdfSBbJHtpbmZvLlBERkZvcm1hdFZlcnNpb259IGAgKyBgJHsobWV0YWRhdGE/LmdldCgicGRmOnByb2R1Y2VyIikgfHwgaW5mby5Qcm9kdWNlciB8fCAiLSIpLnRyaW0oKX0gLyBgICsgYCR7KG1ldGFkYXRhPy5nZXQoInhtcDpjcmVhdG9ydG9vbCIpIHx8IGluZm8uQ3JlYXRvciB8fCAiLSIpLnRyaW0oKX1gICsgYF0gKFBERi5qczogJHt2ZXJzaW9uIHx8ICI/In0gWyR7YnVpbGQgfHwgIj8ifV0pYCk7CiAgICBjb25zdCBwZGZUaXRsZSA9IHRoaXMuX2RvY1RpdGxlOwogICAgaWYgKHBkZlRpdGxlKSB7CiAgICAgIHRoaXMuc2V0VGl0bGUoYCR7cGRmVGl0bGV9IC0gJHt0aGlzLl9jb250ZW50RGlzcG9zaXRpb25GaWxlbmFtZSB8fCB0aGlzLl90aXRsZX1gKTsKICAgIH0gZWxzZSBpZiAodGhpcy5fY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWUpIHsKICAgICAgdGhpcy5zZXRUaXRsZSh0aGlzLl9jb250ZW50RGlzcG9zaXRpb25GaWxlbmFtZSk7CiAgICB9CiAgICBpZiAoaW5mby5Jc1hGQVByZXNlbnQgJiYgIWluZm8uSXNBY3JvRm9ybVByZXNlbnQgJiYgIXBkZkRvY3VtZW50LmlzUHVyZVhmYSkgewogICAgICBpZiAocGRmRG9jdW1lbnQubG9hZGluZ1BhcmFtcy5lbmFibGVYZmEpIHsKICAgICAgICBjb25zb2xlLndhcm4oIldhcm5pbmc6IFhGQSBGb3JlZ3JvdW5kIGRvY3VtZW50cyBhcmUgbm90IHN1cHBvcnRlZCIpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUud2FybigiV2FybmluZzogWEZBIHN1cHBvcnQgaXMgbm90IGVuYWJsZWQiKTsKICAgICAgfQogICAgfSBlbHNlIGlmICgoaW5mby5Jc0Fjcm9Gb3JtUHJlc2VudCB8fCBpbmZvLklzWEZBUHJlc2VudCkgJiYgIXRoaXMucGRmVmlld2VyLnJlbmRlckZvcm1zKSB7CiAgICAgIGNvbnNvbGUud2FybigiV2FybmluZzogSW50ZXJhY3RpdmUgZm9ybSBzdXBwb3J0IGlzIG5vdCBlbmFibGVkIik7CiAgICB9CiAgICBpZiAoaW5mby5Jc1NpZ25hdHVyZXNQcmVzZW50KSB7CiAgICAgIGNvbnNvbGUud2FybigiV2FybmluZzogRGlnaXRhbCBzaWduYXR1cmVzIHZhbGlkYXRpb24gaXMgbm90IHN1cHBvcnRlZCIpOwogICAgfQogICAgdGhpcy5ldmVudEJ1cy5kaXNwYXRjaCgibWV0YWRhdGFsb2FkZWQiLCB7CiAgICAgIHNvdXJjZTogdGhpcwogICAgfSk7CiAgfSwKICBhc3luYyBfaW5pdGlhbGl6ZVBhZ2VMYWJlbHMocGRmRG9jdW1lbnQpIHsKICAgIGNvbnN0IGxhYmVscyA9IGF3YWl0IHBkZkRvY3VtZW50LmdldFBhZ2VMYWJlbHMoKTsKICAgIGlmIChwZGZEb2N1bWVudCAhPT0gdGhpcy5wZGZEb2N1bWVudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIWxhYmVscyB8fCBBcHBPcHRpb25zLmdldCgiZGlzYWJsZVBhZ2VMYWJlbHMiKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBudW1MYWJlbHMgPSBsYWJlbHMubGVuZ3RoOwogICAgbGV0IHN0YW5kYXJkTGFiZWxzID0gMCwKICAgICAgZW1wdHlMYWJlbHMgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1MYWJlbHM7IGkrKykgewogICAgICBjb25zdCBsYWJlbCA9IGxhYmVsc1tpXTsKICAgICAgaWYgKGxhYmVsID09PSAoaSArIDEpLnRvU3RyaW5nKCkpIHsKICAgICAgICBzdGFuZGFyZExhYmVscysrOwogICAgICB9IGVsc2UgaWYgKGxhYmVsID09PSAiIikgewogICAgICAgIGVtcHR5TGFiZWxzKys7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmIChzdGFuZGFyZExhYmVscyA+PSBudW1MYWJlbHMgfHwgZW1wdHlMYWJlbHMgPj0gbnVtTGFiZWxzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgcGRmVmlld2VyLAogICAgICBwZGZUaHVtYm5haWxWaWV3ZXIsCiAgICAgIHRvb2xiYXIKICAgIH0gPSB0aGlzOwogICAgcGRmVmlld2VyLnNldFBhZ2VMYWJlbHMobGFiZWxzKTsKICAgIHBkZlRodW1ibmFpbFZpZXdlcj8uc2V0UGFnZUxhYmVscyhsYWJlbHMpOwogICAgdG9vbGJhcj8uc2V0UGFnZXNDb3VudChudW1MYWJlbHMsIHRydWUpOwogICAgdG9vbGJhcj8uc2V0UGFnZU51bWJlcihwZGZWaWV3ZXIuY3VycmVudFBhZ2VOdW1iZXIsIHBkZlZpZXdlci5jdXJyZW50UGFnZUxhYmVsKTsKICB9LAogIF9pbml0aWFsaXplUGRmSGlzdG9yeSh7CiAgICBmaW5nZXJwcmludCwKICAgIHZpZXdPbkxvYWQsCiAgICBpbml0aWFsRGVzdCA9IG51bGwKICB9KSB7CiAgICBpZiAoIXRoaXMucGRmSGlzdG9yeSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnBkZkhpc3RvcnkuaW5pdGlhbGl6ZSh7CiAgICAgIGZpbmdlcnByaW50LAogICAgICByZXNldEhpc3Rvcnk6IHZpZXdPbkxvYWQgPT09IFZpZXdPbkxvYWQuSU5JVElBTCwKICAgICAgdXBkYXRlVXJsOiBBcHBPcHRpb25zLmdldCgiaGlzdG9yeVVwZGF0ZVVybCIpCiAgICB9KTsKICAgIGlmICh0aGlzLnBkZkhpc3RvcnkuaW5pdGlhbEJvb2ttYXJrKSB7CiAgICAgIHRoaXMuaW5pdGlhbEJvb2ttYXJrID0gdGhpcy5wZGZIaXN0b3J5LmluaXRpYWxCb29rbWFyazsKICAgICAgdGhpcy5pbml0aWFsUm90YXRpb24gPSB0aGlzLnBkZkhpc3RvcnkuaW5pdGlhbFJvdGF0aW9uOwogICAgfQogICAgaWYgKGluaXRpYWxEZXN0ICYmICF0aGlzLmluaXRpYWxCb29rbWFyayAmJiB2aWV3T25Mb2FkID09PSBWaWV3T25Mb2FkLlVOS05PV04pIHsKICAgICAgdGhpcy5pbml0aWFsQm9va21hcmsgPSBKU09OLnN0cmluZ2lmeShpbml0aWFsRGVzdCk7CiAgICAgIHRoaXMucGRmSGlzdG9yeS5wdXNoKHsKICAgICAgICBleHBsaWNpdERlc3Q6IGluaXRpYWxEZXN0LAogICAgICAgIHBhZ2VOdW1iZXI6IG51bGwKICAgICAgfSk7CiAgICB9CiAgfSwKICBfaW5pdGlhbGl6ZUFubm90YXRpb25TdG9yYWdlQ2FsbGJhY2tzKHBkZkRvY3VtZW50KSB7CiAgICBpZiAocGRmRG9jdW1lbnQgIT09IHRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgewogICAgICBhbm5vdGF0aW9uU3RvcmFnZQogICAgfSA9IHBkZkRvY3VtZW50OwogICAgYW5ub3RhdGlvblN0b3JhZ2Uub25TZXRNb2RpZmllZCA9ICgpID0+IHsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIGJlZm9yZVVubG9hZCk7CiAgICAgIHRoaXMuX2Fubm90YXRpb25TdG9yYWdlTW9kaWZpZWQgPSB0cnVlOwogICAgfTsKICAgIGFubm90YXRpb25TdG9yYWdlLm9uUmVzZXRNb2RpZmllZCA9ICgpID0+IHsKICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIGJlZm9yZVVubG9hZCk7CiAgICAgIGRlbGV0ZSB0aGlzLl9hbm5vdGF0aW9uU3RvcmFnZU1vZGlmaWVkOwogICAgfTsKICAgIGFubm90YXRpb25TdG9yYWdlLm9uQW5ub3RhdGlvbkVkaXRvciA9IHR5cGVTdHIgPT4gewogICAgICB0aGlzLl9oYXNBbm5vdGF0aW9uRWRpdG9ycyA9ICEhdHlwZVN0cjsKICAgICAgdGhpcy5zZXRUaXRsZSgpOwogICAgfTsKICB9LAogIHNldEluaXRpYWxWaWV3KHN0b3JlZEhhc2gsIHsKICAgIHJvdGF0aW9uLAogICAgc2lkZWJhclZpZXcsCiAgICBzY3JvbGxNb2RlLAogICAgc3ByZWFkTW9kZQogIH0gPSB7fSkgewogICAgY29uc3Qgc2V0Um90YXRpb24gPSBhbmdsZSA9PiB7CiAgICAgIGlmIChpc1ZhbGlkUm90YXRpb24oYW5nbGUpKSB7CiAgICAgICAgdGhpcy5wZGZWaWV3ZXIucGFnZXNSb3RhdGlvbiA9IGFuZ2xlOwogICAgICB9CiAgICB9OwogICAgY29uc3Qgc2V0Vmlld2VyTW9kZXMgPSAoc2Nyb2xsLCBzcHJlYWQpID0+IHsKICAgICAgaWYgKGlzVmFsaWRTY3JvbGxNb2RlKHNjcm9sbCkpIHsKICAgICAgICB0aGlzLnBkZlZpZXdlci5zY3JvbGxNb2RlID0gc2Nyb2xsOwogICAgICB9CiAgICAgIGlmIChpc1ZhbGlkU3ByZWFkTW9kZShzcHJlYWQpKSB7CiAgICAgICAgdGhpcy5wZGZWaWV3ZXIuc3ByZWFkTW9kZSA9IHNwcmVhZDsKICAgICAgfQogICAgfTsKICAgIHRoaXMuaXNJbml0aWFsVmlld1NldCA9IHRydWU7CiAgICB0aGlzLnBkZlNpZGViYXI/LnNldEluaXRpYWxWaWV3KHNpZGViYXJWaWV3KTsKICAgIHNldFZpZXdlck1vZGVzKHNjcm9sbE1vZGUsIHNwcmVhZE1vZGUpOwogICAgaWYgKHRoaXMuaW5pdGlhbEJvb2ttYXJrKSB7CiAgICAgIHNldFJvdGF0aW9uKHRoaXMuaW5pdGlhbFJvdGF0aW9uKTsKICAgICAgZGVsZXRlIHRoaXMuaW5pdGlhbFJvdGF0aW9uOwogICAgICB0aGlzLnBkZkxpbmtTZXJ2aWNlLnNldEhhc2godGhpcy5pbml0aWFsQm9va21hcmspOwogICAgICB0aGlzLmluaXRpYWxCb29rbWFyayA9IG51bGw7CiAgICB9IGVsc2UgaWYgKHN0b3JlZEhhc2gpIHsKICAgICAgc2V0Um90YXRpb24ocm90YXRpb24pOwogICAgICB0aGlzLnBkZkxpbmtTZXJ2aWNlLnNldEhhc2goc3RvcmVkSGFzaCk7CiAgICB9CiAgICB0aGlzLnRvb2xiYXI/LnNldFBhZ2VOdW1iZXIodGhpcy5wZGZWaWV3ZXIuY3VycmVudFBhZ2VOdW1iZXIsIHRoaXMucGRmVmlld2VyLmN1cnJlbnRQYWdlTGFiZWwpOwogICAgdGhpcy5zZWNvbmRhcnlUb29sYmFyPy5zZXRQYWdlTnVtYmVyKHRoaXMucGRmVmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyKTsKICAgIGlmICghdGhpcy5wZGZWaWV3ZXIuY3VycmVudFNjYWxlVmFsdWUpIHsKICAgICAgdGhpcy5wZGZWaWV3ZXIuY3VycmVudFNjYWxlVmFsdWUgPSBERUZBVUxUX1NDQUxFX1ZBTFVFOwogICAgfQogIH0sCiAgX2NsZWFudXAoKSB7CiAgICBpZiAoIXRoaXMucGRmRG9jdW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5wZGZWaWV3ZXIuY2xlYW51cCgpOwogICAgdGhpcy5wZGZUaHVtYm5haWxWaWV3ZXI/LmNsZWFudXAoKTsKICAgIHRoaXMucGRmRG9jdW1lbnQuY2xlYW51cChBcHBPcHRpb25zLmdldCgiZm9udEV4dHJhUHJvcGVydGllcyIpKTsKICB9LAogIGZvcmNlUmVuZGVyaW5nKCkgewogICAgdGhpcy5wZGZSZW5kZXJpbmdRdWV1ZS5wcmludGluZyA9ICEhdGhpcy5wcmludFNlcnZpY2U7CiAgICB0aGlzLnBkZlJlbmRlcmluZ1F1ZXVlLmlzVGh1bWJuYWlsVmlld0VuYWJsZWQgPSB0aGlzLnBkZlNpZGViYXI/LnZpc2libGVWaWV3ID09PSBTaWRlYmFyVmlldy5USFVNQlM7CiAgICB0aGlzLnBkZlJlbmRlcmluZ1F1ZXVlLnJlbmRlckhpZ2hlc3RQcmlvcml0eSgpOwogIH0sCiAgYmVmb3JlUHJpbnQoKSB7CiAgICB0aGlzLl9wcmludEFubm90YXRpb25TdG9yYWdlUHJvbWlzZSA9IHRoaXMucGRmU2NyaXB0aW5nTWFuYWdlci5kaXNwYXRjaFdpbGxQcmludCgpLmNhdGNoKCgpID0+IHt9KS50aGVuKCgpID0+IHRoaXMucGRmRG9jdW1lbnQ/LmFubm90YXRpb25TdG9yYWdlLnByaW50KTsKICAgIGlmICh0aGlzLnByaW50U2VydmljZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXMuc3VwcG9ydHNQcmludGluZykgewogICAgICB0aGlzLl9vdGhlckVycm9yKCJwZGZqcy1wcmludGluZy1ub3Qtc3VwcG9ydGVkIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpcy5wZGZWaWV3ZXIucGFnZVZpZXdzUmVhZHkpIHsKICAgICAgdGhpcy5sMTBuLmdldCgicGRmanMtcHJpbnRpbmctbm90LXJlYWR5IikudGhlbihtc2cgPT4gewogICAgICAgIHdpbmRvdy5hbGVydChtc2cpOwogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5wcmludFNlcnZpY2UgPSBQREZQcmludFNlcnZpY2VGYWN0b3J5LmNyZWF0ZVByaW50U2VydmljZSh7CiAgICAgIHBkZkRvY3VtZW50OiB0aGlzLnBkZkRvY3VtZW50LAogICAgICBwYWdlc092ZXJ2aWV3OiB0aGlzLnBkZlZpZXdlci5nZXRQYWdlc092ZXJ2aWV3KCksCiAgICAgIHByaW50Q29udGFpbmVyOiB0aGlzLmFwcENvbmZpZy5wcmludENvbnRhaW5lciwKICAgICAgcHJpbnRSZXNvbHV0aW9uOiBBcHBPcHRpb25zLmdldCgicHJpbnRSZXNvbHV0aW9uIiksCiAgICAgIHByaW50QW5ub3RhdGlvblN0b3JhZ2VQcm9taXNlOiB0aGlzLl9wcmludEFubm90YXRpb25TdG9yYWdlUHJvbWlzZQogICAgfSk7CiAgICB0aGlzLmZvcmNlUmVuZGVyaW5nKCk7CiAgICB0aGlzLnNldFRpdGxlKCk7CiAgICB0aGlzLnByaW50U2VydmljZS5sYXlvdXQoKTsKICAgIGlmICh0aGlzLl9oYXNBbm5vdGF0aW9uRWRpdG9ycykgewogICAgICB0aGlzLmV4dGVybmFsU2VydmljZXMucmVwb3J0VGVsZW1ldHJ5KHsKICAgICAgICB0eXBlOiAiZWRpdGluZyIsCiAgICAgICAgZGF0YTogewogICAgICAgICAgdHlwZTogInByaW50IiwKICAgICAgICAgIHN0YXRzOiB0aGlzLnBkZkRvY3VtZW50Py5hbm5vdGF0aW9uU3RvcmFnZS5lZGl0b3JTdGF0cwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwKICBhZnRlclByaW50KCkgewogICAgaWYgKHRoaXMuX3ByaW50QW5ub3RhdGlvblN0b3JhZ2VQcm9taXNlKSB7CiAgICAgIHRoaXMuX3ByaW50QW5ub3RhdGlvblN0b3JhZ2VQcm9taXNlLnRoZW4oKCkgPT4gewogICAgICAgIHRoaXMucGRmU2NyaXB0aW5nTWFuYWdlci5kaXNwYXRjaERpZFByaW50KCk7CiAgICAgIH0pOwogICAgICB0aGlzLl9wcmludEFubm90YXRpb25TdG9yYWdlUHJvbWlzZSA9IG51bGw7CiAgICB9CiAgICBpZiAodGhpcy5wcmludFNlcnZpY2UpIHsKICAgICAgdGhpcy5wcmludFNlcnZpY2UuZGVzdHJveSgpOwogICAgICB0aGlzLnByaW50U2VydmljZSA9IG51bGw7CiAgICAgIHRoaXMucGRmRG9jdW1lbnQ/LmFubm90YXRpb25TdG9yYWdlLnJlc2V0TW9kaWZpZWQoKTsKICAgIH0KICAgIHRoaXMuZm9yY2VSZW5kZXJpbmcoKTsKICAgIHRoaXMuc2V0VGl0bGUoKTsKICB9LAogIHJvdGF0ZVBhZ2VzKGRlbHRhKSB7CiAgICB0aGlzLnBkZlZpZXdlci5wYWdlc1JvdGF0aW9uICs9IGRlbHRhOwogIH0sCiAgcmVxdWVzdFByZXNlbnRhdGlvbk1vZGUoKSB7CiAgICB0aGlzLnBkZlByZXNlbnRhdGlvbk1vZGU/LnJlcXVlc3QoKTsKICB9LAogIHRyaWdnZXJQcmludGluZygpIHsKICAgIGlmICh0aGlzLnN1cHBvcnRzUHJpbnRpbmcpIHsKICAgICAgd2luZG93LnByaW50KCk7CiAgICB9CiAgfSwKICBiaW5kRXZlbnRzKCkgewogICAgaWYgKHRoaXMuX2V2ZW50QnVzQWJvcnRDb250cm9sbGVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFjID0gdGhpcy5fZXZlbnRCdXNBYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICBjb25zdCBvcHRzID0gewogICAgICBzaWduYWw6IGFjLnNpZ25hbAogICAgfTsKICAgIGNvbnN0IHsKICAgICAgZXZlbnRCdXMsCiAgICAgIGV4dGVybmFsU2VydmljZXMsCiAgICAgIHBkZkRvY3VtZW50UHJvcGVydGllcywKICAgICAgcGRmVmlld2VyLAogICAgICBwcmVmZXJlbmNlcwogICAgfSA9IHRoaXM7CiAgICBldmVudEJ1cy5fb24oInJlc2l6ZSIsIG9uUmVzaXplLmJpbmQodGhpcyksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJoYXNoY2hhbmdlIiwgb25IYXNoY2hhbmdlLmJpbmQodGhpcyksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJiZWZvcmVwcmludCIsIHRoaXMuYmVmb3JlUHJpbnQuYmluZCh0aGlzKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oImFmdGVycHJpbnQiLCB0aGlzLmFmdGVyUHJpbnQuYmluZCh0aGlzKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oInBhZ2VyZW5kZXIiLCBvblBhZ2VSZW5kZXIuYmluZCh0aGlzKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oInBhZ2VyZW5kZXJlZCIsIG9uUGFnZVJlbmRlcmVkLmJpbmQodGhpcyksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJ1cGRhdGV2aWV3YXJlYSIsIG9uVXBkYXRlVmlld2FyZWEuYmluZCh0aGlzKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oInBhZ2VjaGFuZ2luZyIsIG9uUGFnZUNoYW5naW5nLmJpbmQodGhpcyksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJzY2FsZWNoYW5naW5nIiwgb25TY2FsZUNoYW5naW5nLmJpbmQodGhpcyksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJyb3RhdGlvbmNoYW5naW5nIiwgb25Sb3RhdGlvbkNoYW5naW5nLmJpbmQodGhpcyksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJzaWRlYmFydmlld2NoYW5nZWQiLCBvblNpZGViYXJWaWV3Q2hhbmdlZC5iaW5kKHRoaXMpLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigicGFnZW1vZGUiLCBvblBhZ2VNb2RlLmJpbmQodGhpcyksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJuYW1lZGFjdGlvbiIsIG9uTmFtZWRBY3Rpb24uYmluZCh0aGlzKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oInByZXNlbnRhdGlvbm1vZGVjaGFuZ2VkIiwgZXZ0ID0+IHBkZlZpZXdlci5wcmVzZW50YXRpb25Nb2RlU3RhdGUgPSBldnQuc3RhdGUsIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJwcmVzZW50YXRpb25tb2RlIiwgdGhpcy5yZXF1ZXN0UHJlc2VudGF0aW9uTW9kZS5iaW5kKHRoaXMpLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigic3dpdGNoYW5ub3RhdGlvbmVkaXRvcm1vZGUiLCBldnQgPT4gcGRmVmlld2VyLmFubm90YXRpb25FZGl0b3JNb2RlID0gZXZ0LCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigicHJpbnQiLCB0aGlzLnRyaWdnZXJQcmludGluZy5iaW5kKHRoaXMpLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigiZG93bmxvYWQiLCB0aGlzLmRvd25sb2FkT3JTYXZlLmJpbmQodGhpcyksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJmaXJzdHBhZ2UiLCAoKSA9PiB0aGlzLnBhZ2UgPSAxLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigibGFzdHBhZ2UiLCAoKSA9PiB0aGlzLnBhZ2UgPSB0aGlzLnBhZ2VzQ291bnQsIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJuZXh0cGFnZSIsICgpID0+IHBkZlZpZXdlci5uZXh0UGFnZSgpLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigicHJldmlvdXNwYWdlIiwgKCkgPT4gcGRmVmlld2VyLnByZXZpb3VzUGFnZSgpLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigiem9vbWluIiwgdGhpcy56b29tSW4uYmluZCh0aGlzKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oInpvb21vdXQiLCB0aGlzLnpvb21PdXQuYmluZCh0aGlzKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oInpvb21yZXNldCIsIHRoaXMuem9vbVJlc2V0LmJpbmQodGhpcyksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJwYWdlbnVtYmVyY2hhbmdlZCIsIG9uUGFnZU51bWJlckNoYW5nZWQuYmluZCh0aGlzKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oInNjYWxlY2hhbmdlZCIsIGV2dCA9PiBwZGZWaWV3ZXIuY3VycmVudFNjYWxlVmFsdWUgPSBldnQudmFsdWUsIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJyb3RhdGVjdyIsIHRoaXMucm90YXRlUGFnZXMuYmluZCh0aGlzLCA5MCksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJyb3RhdGVjY3ciLCB0aGlzLnJvdGF0ZVBhZ2VzLmJpbmQodGhpcywgLTkwKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oIm9wdGlvbmFsY29udGVudGNvbmZpZyIsIGV2dCA9PiBwZGZWaWV3ZXIub3B0aW9uYWxDb250ZW50Q29uZmlnUHJvbWlzZSA9IGV2dC5wcm9taXNlLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigic3dpdGNoc2Nyb2xsbW9kZSIsIGV2dCA9PiBwZGZWaWV3ZXIuc2Nyb2xsTW9kZSA9IGV2dC5tb2RlLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigic2Nyb2xsbW9kZWNoYW5nZWQiLCBvblZpZXdlck1vZGVzQ2hhbmdlZC5iaW5kKHRoaXMsICJzY3JvbGxNb2RlIiksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJzd2l0Y2hzcHJlYWRtb2RlIiwgZXZ0ID0+IHBkZlZpZXdlci5zcHJlYWRNb2RlID0gZXZ0Lm1vZGUsIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJzcHJlYWRtb2RlY2hhbmdlZCIsIG9uVmlld2VyTW9kZXNDaGFuZ2VkLmJpbmQodGhpcywgInNwcmVhZE1vZGUiKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oImltYWdlYWx0dGV4dHNldHRpbmdzIiwgb25JbWFnZUFsdFRleHRTZXR0aW5ncy5iaW5kKHRoaXMpLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigiZG9jdW1lbnRwcm9wZXJ0aWVzIiwgKCkgPT4gcGRmRG9jdW1lbnRQcm9wZXJ0aWVzPy5vcGVuKCksIG9wdHMpOwogICAgZXZlbnRCdXMuX29uKCJmaW5kZnJvbXVybGhhc2giLCBvbkZpbmRGcm9tVXJsSGFzaC5iaW5kKHRoaXMpLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigidXBkYXRlZmluZG1hdGNoZXNjb3VudCIsIG9uVXBkYXRlRmluZE1hdGNoZXNDb3VudC5iaW5kKHRoaXMpLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigidXBkYXRlZmluZGNvbnRyb2xzdGF0ZSIsIG9uVXBkYXRlRmluZENvbnRyb2xTdGF0ZS5iaW5kKHRoaXMpLCBvcHRzKTsKICAgIGV2ZW50QnVzLl9vbigiZmlsZWlucHV0Y2hhbmdlIiwgb25GaWxlSW5wdXRDaGFuZ2UuYmluZCh0aGlzKSwgb3B0cyk7CiAgICBldmVudEJ1cy5fb24oIm9wZW5maWxlIiwgb25PcGVuRmlsZS5iaW5kKHRoaXMpLCBvcHRzKTsKICB9LAogIGJpbmRXaW5kb3dFdmVudHMoKSB7CiAgICBpZiAodGhpcy5fd2luZG93QWJvcnRDb250cm9sbGVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX3dpbmRvd0Fib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGNvbnN0IHsKICAgICAgZXZlbnRCdXMsCiAgICAgIGFwcENvbmZpZzogewogICAgICAgIG1haW5Db250YWluZXIKICAgICAgfSwKICAgICAgcGRmVmlld2VyLAogICAgICBfd2luZG93QWJvcnRDb250cm9sbGVyOiB7CiAgICAgICAgc2lnbmFsCiAgICAgIH0KICAgIH0gPSB0aGlzOwogICAgdGhpcy5fdG91Y2hNYW5hZ2VyID0gbmV3IFRvdWNoTWFuYWdlcih7CiAgICAgIGNvbnRhaW5lcjogd2luZG93LAogICAgICBpc1BpbmNoaW5nRGlzYWJsZWQ6ICgpID0+IHBkZlZpZXdlci5pc0luUHJlc2VudGF0aW9uTW9kZSwKICAgICAgaXNQaW5jaGluZ1N0b3BwZWQ6ICgpID0+IHRoaXMub3ZlcmxheU1hbmFnZXI/LmFjdGl2ZSwKICAgICAgb25QaW5jaGluZzogdGhpcy50b3VjaFBpbmNoQ2FsbGJhY2suYmluZCh0aGlzKSwKICAgICAgb25QaW5jaEVuZDogdGhpcy50b3VjaFBpbmNoRW5kQ2FsbGJhY2suYmluZCh0aGlzKSwKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIGZ1bmN0aW9uIGFkZFdpbmRvd1Jlc29sdXRpb25DaGFuZ2UoZXZ0ID0gbnVsbCkgewogICAgICBpZiAoZXZ0KSB7CiAgICAgICAgcGRmVmlld2VyLnJlZnJlc2goKTsKICAgICAgfQogICAgICBjb25zdCBtZWRpYVF1ZXJ5TGlzdCA9IHdpbmRvdy5tYXRjaE1lZGlhKGAocmVzb2x1dGlvbjogJHtPdXRwdXRTY2FsZS5waXhlbFJhdGlvfWRwcHgpYCk7CiAgICAgIG1lZGlhUXVlcnlMaXN0LmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGFkZFdpbmRvd1Jlc29sdXRpb25DaGFuZ2UsIHsKICAgICAgICBvbmNlOiB0cnVlLAogICAgICAgIHNpZ25hbAogICAgICB9KTsKICAgIH0KICAgIGFkZFdpbmRvd1Jlc29sdXRpb25DaGFuZ2UoKTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ3aGVlbCIsIG9uV2hlZWwuYmluZCh0aGlzKSwgewogICAgICBwYXNzaXZlOiBmYWxzZSwKICAgICAgc2lnbmFsCiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIG9uQ2xpY2suYmluZCh0aGlzKSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBvbktleURvd24uYmluZCh0aGlzKSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgb25LZXlVcC5iaW5kKHRoaXMpLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgKCkgPT4gZXZlbnRCdXMuZGlzcGF0Y2goInJlc2l6ZSIsIHsKICAgICAgc291cmNlOiB3aW5kb3cKICAgIH0pLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiaGFzaGNoYW5nZSIsICgpID0+IHsKICAgICAgZXZlbnRCdXMuZGlzcGF0Y2goImhhc2hjaGFuZ2UiLCB7CiAgICAgICAgc291cmNlOiB3aW5kb3csCiAgICAgICAgaGFzaDogZG9jdW1lbnQubG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSkKICAgICAgfSk7CiAgICB9LCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JlcHJpbnQiLCAoKSA9PiBldmVudEJ1cy5kaXNwYXRjaCgiYmVmb3JlcHJpbnQiLCB7CiAgICAgIHNvdXJjZTogd2luZG93CiAgICB9KSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImFmdGVycHJpbnQiLCAoKSA9PiBldmVudEJ1cy5kaXNwYXRjaCgiYWZ0ZXJwcmludCIsIHsKICAgICAgc291cmNlOiB3aW5kb3cKICAgIH0pLCB7CiAgICAgIHNpZ25hbAogICAgfSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigidXBkYXRlZnJvbXNhbmRib3giLCBldnQgPT4gewogICAgICBldmVudEJ1cy5kaXNwYXRjaCgidXBkYXRlZnJvbXNhbmRib3giLCB7CiAgICAgICAgc291cmNlOiB3aW5kb3csCiAgICAgICAgZGV0YWlsOiBldnQuZGV0YWlsCiAgICAgIH0pOwogICAgfSwgewogICAgICBzaWduYWwKICAgIH0pOwogICAgaWYgKCEoIm9uc2Nyb2xsZW5kIiBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgICh7CiAgICAgIHNjcm9sbFRvcDogdGhpcy5fbGFzdFNjcm9sbFRvcCwKICAgICAgc2Nyb2xsTGVmdDogdGhpcy5fbGFzdFNjcm9sbExlZnQKICAgIH0gPSBtYWluQ29udGFpbmVyKTsKICAgIGNvbnN0IHNjcm9sbGVuZCA9ICgpID0+IHsKICAgICAgKHsKICAgICAgICBzY3JvbGxUb3A6IHRoaXMuX2xhc3RTY3JvbGxUb3AsCiAgICAgICAgc2Nyb2xsTGVmdDogdGhpcy5fbGFzdFNjcm9sbExlZnQKICAgICAgfSA9IG1haW5Db250YWluZXIpOwogICAgICB0aGlzLl9pc1Njcm9sbGluZyA9IGZhbHNlOwogICAgICBtYWluQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoInNjcm9sbCIsIHNjcm9sbCwgewogICAgICAgIHBhc3NpdmU6IHRydWUsCiAgICAgICAgc2lnbmFsCiAgICAgIH0pOwogICAgICBtYWluQ29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoInNjcm9sbGVuZCIsIHNjcm9sbGVuZCk7CiAgICAgIG1haW5Db250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYmx1ciIsIHNjcm9sbGVuZCk7CiAgICB9OwogICAgY29uc3Qgc2Nyb2xsID0gKCkgPT4gewogICAgICBpZiAodGhpcy5faXNDdHJsS2V5RG93bikgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodGhpcy5fbGFzdFNjcm9sbFRvcCA9PT0gbWFpbkNvbnRhaW5lci5zY3JvbGxUb3AgJiYgdGhpcy5fbGFzdFNjcm9sbExlZnQgPT09IG1haW5Db250YWluZXIuc2Nyb2xsTGVmdCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBtYWluQ29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoInNjcm9sbCIsIHNjcm9sbCk7CiAgICAgIHRoaXMuX2lzU2Nyb2xsaW5nID0gdHJ1ZTsKICAgICAgbWFpbkNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCJzY3JvbGxlbmQiLCBzY3JvbGxlbmQsIHsKICAgICAgICBzaWduYWwKICAgICAgfSk7CiAgICAgIG1haW5Db250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigiYmx1ciIsIHNjcm9sbGVuZCwgewogICAgICAgIHNpZ25hbAogICAgICB9KTsKICAgIH07CiAgICBtYWluQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoInNjcm9sbCIsIHNjcm9sbCwgewogICAgICBwYXNzaXZlOiB0cnVlLAogICAgICBzaWduYWwKICAgIH0pOwogIH0sCiAgdW5iaW5kRXZlbnRzKCkgewogICAgdGhpcy5fZXZlbnRCdXNBYm9ydENvbnRyb2xsZXI/LmFib3J0KCk7CiAgICB0aGlzLl9ldmVudEJ1c0Fib3J0Q29udHJvbGxlciA9IG51bGw7CiAgfSwKICB1bmJpbmRXaW5kb3dFdmVudHMoKSB7CiAgICB0aGlzLl93aW5kb3dBYm9ydENvbnRyb2xsZXI/LmFib3J0KCk7CiAgICB0aGlzLl93aW5kb3dBYm9ydENvbnRyb2xsZXIgPSBudWxsOwogICAgdGhpcy5fdG91Y2hNYW5hZ2VyID0gbnVsbDsKICB9LAogIGFzeW5jIHRlc3RpbmdDbG9zZSgpIHsKICAgIHRoaXMudW5iaW5kRXZlbnRzKCk7CiAgICB0aGlzLnVuYmluZFdpbmRvd0V2ZW50cygpOwogICAgdGhpcy5fZ2xvYmFsQWJvcnRDb250cm9sbGVyPy5hYm9ydCgpOwogICAgdGhpcy5fZ2xvYmFsQWJvcnRDb250cm9sbGVyID0gbnVsbDsKICAgIHRoaXMuZmluZEJhcj8uY2xvc2UoKTsKICAgIGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLmwxMG4/LmRlc3Ryb3koKSwgdGhpcy5jbG9zZSgpXSk7CiAgfSwKICBfYWNjdW11bGF0ZVRpY2tzKHRpY2tzLCBwcm9wKSB7CiAgICBpZiAodGhpc1twcm9wXSA+IDAgJiYgdGlja3MgPCAwIHx8IHRoaXNbcHJvcF0gPCAwICYmIHRpY2tzID4gMCkgewogICAgICB0aGlzW3Byb3BdID0gMDsKICAgIH0KICAgIHRoaXNbcHJvcF0gKz0gdGlja3M7CiAgICBjb25zdCB3aG9sZVRpY2tzID0gTWF0aC50cnVuYyh0aGlzW3Byb3BdKTsKICAgIHRoaXNbcHJvcF0gLT0gd2hvbGVUaWNrczsKICAgIHJldHVybiB3aG9sZVRpY2tzOwogIH0sCiAgX2FjY3VtdWxhdGVGYWN0b3IocHJldmlvdXNTY2FsZSwgZmFjdG9yLCBwcm9wKSB7CiAgICBpZiAoZmFjdG9yID09PSAxKSB7CiAgICAgIHJldHVybiAxOwogICAgfQogICAgaWYgKHRoaXNbcHJvcF0gPiAxICYmIGZhY3RvciA8IDEgfHwgdGhpc1twcm9wXSA8IDEgJiYgZmFjdG9yID4gMSkgewogICAgICB0aGlzW3Byb3BdID0gMTsKICAgIH0KICAgIGNvbnN0IG5ld0ZhY3RvciA9IE1hdGguZmxvb3IocHJldmlvdXNTY2FsZSAqIGZhY3RvciAqIHRoaXNbcHJvcF0gKiAxMDApIC8gKDEwMCAqIHByZXZpb3VzU2NhbGUpOwogICAgdGhpc1twcm9wXSA9IGZhY3RvciAvIG5ld0ZhY3RvcjsKICAgIHJldHVybiBuZXdGYWN0b3I7CiAgfSwKICBfdW5ibG9ja0RvY3VtZW50TG9hZEV2ZW50KCkgewogICAgZG9jdW1lbnQuYmxvY2tVbmJsb2NrT25sb2FkPy4oZmFsc2UpOwogICAgdGhpcy5fdW5ibG9ja0RvY3VtZW50TG9hZEV2ZW50ID0gKCkgPT4ge307CiAgfSwKICBnZXQgc2NyaXB0aW5nUmVhZHkoKSB7CiAgICByZXR1cm4gdGhpcy5wZGZTY3JpcHRpbmdNYW5hZ2VyLnJlYWR5OwogIH0KfTsKaW5pdENvbShQREZWaWV3ZXJBcHBsaWNhdGlvbik7CnsKICBQREZQcmludFNlcnZpY2VGYWN0b3J5LmluaXRHbG9iYWxzKFBERlZpZXdlckFwcGxpY2F0aW9uKTsKfQp7CiAgY29uc3QgSE9TVEVEX1ZJRVdFUl9PUklHSU5TID0gbmV3IFNldChbIm51bGwiLCAiaHR0cDovL21vemlsbGEuZ2l0aHViLmlvIiwgImh0dHBzOi8vbW96aWxsYS5naXRodWIuaW8iXSk7CiAgdmFyIHZhbGlkYXRlRmlsZVVSTCA9IGZ1bmN0aW9uIChmaWxlKSB7CiAgICBpZiAoIWZpbGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgdmlld2VyT3JpZ2luID0gVVJMLnBhcnNlKHdpbmRvdy5sb2NhdGlvbik/Lm9yaWdpbiB8fCAibnVsbCI7CiAgICBpZiAoSE9TVEVEX1ZJRVdFUl9PUklHSU5TLmhhcyh2aWV3ZXJPcmlnaW4pKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGZpbGVPcmlnaW4gPSBVUkwucGFyc2UoZmlsZSwgd2luZG93LmxvY2F0aW9uKT8ub3JpZ2luOwogICAgaWYgKGZpbGVPcmlnaW4gPT09IHZpZXdlck9yaWdpbikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBleCA9IG5ldyBFcnJvcigiZmlsZSBvcmlnaW4gZG9lcyBub3QgbWF0Y2ggdmlld2VyJ3MiKTsKICAgIFBERlZpZXdlckFwcGxpY2F0aW9uLl9kb2N1bWVudEVycm9yKCJwZGZqcy1sb2FkaW5nLWVycm9yIiwgewogICAgICBtZXNzYWdlOiBleC5tZXNzYWdlCiAgICB9KTsKICAgIHRocm93IGV4OwogIH07CiAgdmFyIG9uRmlsZUlucHV0Q2hhbmdlID0gZnVuY3Rpb24gKGV2dCkgewogICAgaWYgKHRoaXMucGRmVmlld2VyPy5pc0luUHJlc2VudGF0aW9uTW9kZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBmaWxlID0gZXZ0LmZpbGVJbnB1dC5maWxlc1swXTsKICAgIHRoaXMub3Blbih7CiAgICAgIHVybDogVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKSwKICAgICAgb3JpZ2luYWxVcmw6IGZpbGUubmFtZQogICAgfSk7CiAgfTsKICB2YXIgb25PcGVuRmlsZSA9IGZ1bmN0aW9uIChldnQpIHsKICAgIHRoaXMuX29wZW5GaWxlSW5wdXQ/LmNsaWNrKCk7CiAgfTsKfQpmdW5jdGlvbiBvblBhZ2VSZW5kZXIoewogIHBhZ2VOdW1iZXIKfSkgewogIGlmIChwYWdlTnVtYmVyID09PSB0aGlzLnBhZ2UpIHsKICAgIHRoaXMudG9vbGJhcj8udXBkYXRlTG9hZGluZ0luZGljYXRvclN0YXRlKHRydWUpOwogIH0KfQpmdW5jdGlvbiBvblBhZ2VSZW5kZXJlZCh7CiAgcGFnZU51bWJlciwKICBpc0RldGFpbFZpZXcsCiAgZXJyb3IKfSkgewogIGlmIChwYWdlTnVtYmVyID09PSB0aGlzLnBhZ2UpIHsKICAgIHRoaXMudG9vbGJhcj8udXBkYXRlTG9hZGluZ0luZGljYXRvclN0YXRlKGZhbHNlKTsKICB9CiAgaWYgKCFpc0RldGFpbFZpZXcgJiYgdGhpcy5wZGZTaWRlYmFyPy52aXNpYmxlVmlldyA9PT0gU2lkZWJhclZpZXcuVEhVTUJTKSB7CiAgICBjb25zdCBwYWdlVmlldyA9IHRoaXMucGRmVmlld2VyLmdldFBhZ2VWaWV3KHBhZ2VOdW1iZXIgLSAxKTsKICAgIGNvbnN0IHRodW1ibmFpbFZpZXcgPSB0aGlzLnBkZlRodW1ibmFpbFZpZXdlcj8uZ2V0VGh1bWJuYWlsKHBhZ2VOdW1iZXIgLSAxKTsKICAgIGlmIChwYWdlVmlldykgewogICAgICB0aHVtYm5haWxWaWV3Py5zZXRJbWFnZShwYWdlVmlldyk7CiAgICB9CiAgfQogIGlmIChlcnJvcikgewogICAgdGhpcy5fb3RoZXJFcnJvcigicGRmanMtcmVuZGVyaW5nLWVycm9yIiwgZXJyb3IpOwogIH0KfQpmdW5jdGlvbiBvblBhZ2VNb2RlKHsKICBtb2RlCn0pIHsKICBsZXQgdmlldzsKICBzd2l0Y2ggKG1vZGUpIHsKICAgIGNhc2UgInRodW1icyI6CiAgICAgIHZpZXcgPSBTaWRlYmFyVmlldy5USFVNQlM7CiAgICAgIGJyZWFrOwogICAgY2FzZSAiYm9va21hcmtzIjoKICAgIGNhc2UgIm91dGxpbmUiOgogICAgICB2aWV3ID0gU2lkZWJhclZpZXcuT1VUTElORTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJhdHRhY2htZW50cyI6CiAgICAgIHZpZXcgPSBTaWRlYmFyVmlldy5BVFRBQ0hNRU5UUzsKICAgICAgYnJlYWs7CiAgICBjYXNlICJsYXllcnMiOgogICAgICB2aWV3ID0gU2lkZWJhclZpZXcuTEFZRVJTOwogICAgICBicmVhazsKICAgIGNhc2UgIm5vbmUiOgogICAgICB2aWV3ID0gU2lkZWJhclZpZXcuTk9ORTsKICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkICJwYWdlbW9kZSIgaGFzaCBwYXJhbWV0ZXI6ICcgKyBtb2RlKTsKICAgICAgcmV0dXJuOwogIH0KICB0aGlzLnBkZlNpZGViYXI/LnN3aXRjaFZpZXcodmlldywgdHJ1ZSk7Cn0KZnVuY3Rpb24gb25OYW1lZEFjdGlvbihldnQpIHsKICBzd2l0Y2ggKGV2dC5hY3Rpb24pIHsKICAgIGNhc2UgIkdvVG9QYWdlIjoKICAgICAgdGhpcy5hcHBDb25maWcudG9vbGJhcj8ucGFnZU51bWJlci5zZWxlY3QoKTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJGaW5kIjoKICAgICAgaWYgKCF0aGlzLnN1cHBvcnRzSW50ZWdyYXRlZEZpbmQpIHsKICAgICAgICB0aGlzLmZpbmRCYXI/LnRvZ2dsZSgpOwogICAgICB9CiAgICAgIGJyZWFrOwogICAgY2FzZSAiUHJpbnQiOgogICAgICB0aGlzLnRyaWdnZXJQcmludGluZygpOwogICAgICBicmVhazsKICAgIGNhc2UgIlNhdmVBcyI6CiAgICAgIHRoaXMuZG93bmxvYWRPclNhdmUoKTsKICAgICAgYnJlYWs7CiAgfQp9CmZ1bmN0aW9uIG9uU2lkZWJhclZpZXdDaGFuZ2VkKHsKICB2aWV3Cn0pIHsKICB0aGlzLnBkZlJlbmRlcmluZ1F1ZXVlLmlzVGh1bWJuYWlsVmlld0VuYWJsZWQgPSB2aWV3ID09PSBTaWRlYmFyVmlldy5USFVNQlM7CiAgaWYgKHRoaXMuaXNJbml0aWFsVmlld1NldCkgewogICAgdGhpcy5zdG9yZT8uc2V0KCJzaWRlYmFyVmlldyIsIHZpZXcpLmNhdGNoKCgpID0+IHt9KTsKICB9Cn0KZnVuY3Rpb24gb25VcGRhdGVWaWV3YXJlYSh7CiAgbG9jYXRpb24KfSkgewogIGlmICh0aGlzLmlzSW5pdGlhbFZpZXdTZXQpIHsKICAgIHRoaXMuc3RvcmU/LnNldE11bHRpcGxlKHsKICAgICAgcGFnZTogbG9jYXRpb24ucGFnZU51bWJlciwKICAgICAgem9vbTogbG9jYXRpb24uc2NhbGUsCiAgICAgIHNjcm9sbExlZnQ6IGxvY2F0aW9uLmxlZnQsCiAgICAgIHNjcm9sbFRvcDogbG9jYXRpb24udG9wLAogICAgICByb3RhdGlvbjogbG9jYXRpb24ucm90YXRpb24KICAgIH0pLmNhdGNoKCgpID0+IHt9KTsKICB9CiAgaWYgKHRoaXMuYXBwQ29uZmlnLnNlY29uZGFyeVRvb2xiYXIpIHsKICAgIHRoaXMuYXBwQ29uZmlnLnNlY29uZGFyeVRvb2xiYXIudmlld0Jvb2ttYXJrQnV0dG9uLmhyZWYgPSB0aGlzLnBkZkxpbmtTZXJ2aWNlLmdldEFuY2hvclVybChsb2NhdGlvbi5wZGZPcGVuUGFyYW1zKTsKICB9Cn0KZnVuY3Rpb24gb25WaWV3ZXJNb2Rlc0NoYW5nZWQobmFtZSwgZXZ0KSB7CiAgaWYgKHRoaXMuaXNJbml0aWFsVmlld1NldCAmJiAhdGhpcy5wZGZWaWV3ZXIuaXNJblByZXNlbnRhdGlvbk1vZGUpIHsKICAgIHRoaXMuc3RvcmU/LnNldChuYW1lLCBldnQubW9kZSkuY2F0Y2goKCkgPT4ge30pOwogIH0KfQpmdW5jdGlvbiBvblJlc2l6ZSgpIHsKICBjb25zdCB7CiAgICBwZGZEb2N1bWVudCwKICAgIHBkZlZpZXdlciwKICAgIHBkZlJlbmRlcmluZ1F1ZXVlCiAgfSA9IHRoaXM7CiAgaWYgKHBkZlJlbmRlcmluZ1F1ZXVlLnByaW50aW5nICYmIHdpbmRvdy5tYXRjaE1lZGlhKCJwcmludCIpLm1hdGNoZXMpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKCFwZGZEb2N1bWVudCkgewogICAgcmV0dXJuOwogIH0KICBjb25zdCBjdXJyZW50U2NhbGVWYWx1ZSA9IHBkZlZpZXdlci5jdXJyZW50U2NhbGVWYWx1ZTsKICBpZiAoY3VycmVudFNjYWxlVmFsdWUgPT09ICJhdXRvIiB8fCBjdXJyZW50U2NhbGVWYWx1ZSA9PT0gInBhZ2UtZml0IiB8fCBjdXJyZW50U2NhbGVWYWx1ZSA9PT0gInBhZ2Utd2lkdGgiKSB7CiAgICBwZGZWaWV3ZXIuY3VycmVudFNjYWxlVmFsdWUgPSBjdXJyZW50U2NhbGVWYWx1ZTsKICB9CiAgcGRmVmlld2VyLnVwZGF0ZSgpOwp9CmZ1bmN0aW9uIG9uSGFzaGNoYW5nZShldnQpIHsKICBjb25zdCBoYXNoID0gZXZ0Lmhhc2g7CiAgaWYgKCFoYXNoKSB7CiAgICByZXR1cm47CiAgfQogIGlmICghdGhpcy5pc0luaXRpYWxWaWV3U2V0KSB7CiAgICB0aGlzLmluaXRpYWxCb29rbWFyayA9IGhhc2g7CiAgfSBlbHNlIGlmICghdGhpcy5wZGZIaXN0b3J5Py5wb3BTdGF0ZUluUHJvZ3Jlc3MpIHsKICAgIHRoaXMucGRmTGlua1NlcnZpY2Uuc2V0SGFzaChoYXNoKTsKICB9Cn0KZnVuY3Rpb24gb25QYWdlTnVtYmVyQ2hhbmdlZChldnQpIHsKICBjb25zdCB7CiAgICBwZGZWaWV3ZXIKICB9ID0gdGhpczsKICBpZiAoZXZ0LnZhbHVlICE9PSAiIikgewogICAgdGhpcy5wZGZMaW5rU2VydmljZS5nb1RvUGFnZShldnQudmFsdWUpOwogIH0KICBpZiAoZXZ0LnZhbHVlICE9PSBwZGZWaWV3ZXIuY3VycmVudFBhZ2VOdW1iZXIudG9TdHJpbmcoKSAmJiBldnQudmFsdWUgIT09IHBkZlZpZXdlci5jdXJyZW50UGFnZUxhYmVsKSB7CiAgICB0aGlzLnRvb2xiYXI/LnNldFBhZ2VOdW1iZXIocGRmVmlld2VyLmN1cnJlbnRQYWdlTnVtYmVyLCBwZGZWaWV3ZXIuY3VycmVudFBhZ2VMYWJlbCk7CiAgfQp9CmZ1bmN0aW9uIG9uSW1hZ2VBbHRUZXh0U2V0dGluZ3MoKSB7CiAgdGhpcy5pbWFnZUFsdFRleHRTZXR0aW5ncz8ub3Blbih7CiAgICBlbmFibGVHdWVzc0FsdFRleHQ6IEFwcE9wdGlvbnMuZ2V0KCJlbmFibGVHdWVzc0FsdFRleHQiKSwKICAgIGVuYWJsZU5ld0FsdFRleHRXaGVuQWRkaW5nSW1hZ2U6IEFwcE9wdGlvbnMuZ2V0KCJlbmFibGVOZXdBbHRUZXh0V2hlbkFkZGluZ0ltYWdlIikKICB9KTsKfQpmdW5jdGlvbiBvbkZpbmRGcm9tVXJsSGFzaChldnQpIHsKICB0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKCJmaW5kIiwgewogICAgc291cmNlOiBldnQuc291cmNlLAogICAgdHlwZTogIiIsCiAgICBxdWVyeTogZXZ0LnF1ZXJ5LAogICAgY2FzZVNlbnNpdGl2ZTogZmFsc2UsCiAgICBlbnRpcmVXb3JkOiBmYWxzZSwKICAgIGhpZ2hsaWdodEFsbDogdHJ1ZSwKICAgIGZpbmRQcmV2aW91czogZmFsc2UsCiAgICBtYXRjaERpYWNyaXRpY3M6IHRydWUKICB9KTsKfQpmdW5jdGlvbiBvblVwZGF0ZUZpbmRNYXRjaGVzQ291bnQoewogIG1hdGNoZXNDb3VudAp9KSB7CiAgaWYgKHRoaXMuc3VwcG9ydHNJbnRlZ3JhdGVkRmluZCkgewogICAgdGhpcy5leHRlcm5hbFNlcnZpY2VzLnVwZGF0ZUZpbmRNYXRjaGVzQ291bnQobWF0Y2hlc0NvdW50KTsKICB9IGVsc2UgewogICAgdGhpcy5maW5kQmFyPy51cGRhdGVSZXN1bHRzQ291bnQobWF0Y2hlc0NvdW50KTsKICB9Cn0KZnVuY3Rpb24gb25VcGRhdGVGaW5kQ29udHJvbFN0YXRlKHsKICBzdGF0ZSwKICBwcmV2aW91cywKICBlbnRpcmVXb3JkLAogIG1hdGNoZXNDb3VudCwKICByYXdRdWVyeQp9KSB7CiAgaWYgKHRoaXMuc3VwcG9ydHNJbnRlZ3JhdGVkRmluZCkgewogICAgdGhpcy5leHRlcm5hbFNlcnZpY2VzLnVwZGF0ZUZpbmRDb250cm9sU3RhdGUoewogICAgICByZXN1bHQ6IHN0YXRlLAogICAgICBmaW5kUHJldmlvdXM6IHByZXZpb3VzLAogICAgICBlbnRpcmVXb3JkLAogICAgICBtYXRjaGVzQ291bnQsCiAgICAgIHJhd1F1ZXJ5CiAgICB9KTsKICB9IGVsc2UgewogICAgdGhpcy5maW5kQmFyPy51cGRhdGVVSVN0YXRlKHN0YXRlLCBwcmV2aW91cywgbWF0Y2hlc0NvdW50KTsKICB9Cn0KZnVuY3Rpb24gb25TY2FsZUNoYW5naW5nKGV2dCkgewogIHRoaXMudG9vbGJhcj8uc2V0UGFnZVNjYWxlKGV2dC5wcmVzZXRWYWx1ZSwgZXZ0LnNjYWxlKTsKICB0aGlzLnBkZlZpZXdlci51cGRhdGUoKTsKfQpmdW5jdGlvbiBvblJvdGF0aW9uQ2hhbmdpbmcoZXZ0KSB7CiAgaWYgKHRoaXMucGRmVGh1bWJuYWlsVmlld2VyKSB7CiAgICB0aGlzLnBkZlRodW1ibmFpbFZpZXdlci5wYWdlc1JvdGF0aW9uID0gZXZ0LnBhZ2VzUm90YXRpb247CiAgfQogIHRoaXMuZm9yY2VSZW5kZXJpbmcoKTsKICB0aGlzLnBkZlZpZXdlci5jdXJyZW50UGFnZU51bWJlciA9IGV2dC5wYWdlTnVtYmVyOwp9CmZ1bmN0aW9uIG9uUGFnZUNoYW5naW5nKHsKICBwYWdlTnVtYmVyLAogIHBhZ2VMYWJlbAp9KSB7CiAgdGhpcy50b29sYmFyPy5zZXRQYWdlTnVtYmVyKHBhZ2VOdW1iZXIsIHBhZ2VMYWJlbCk7CiAgdGhpcy5zZWNvbmRhcnlUb29sYmFyPy5zZXRQYWdlTnVtYmVyKHBhZ2VOdW1iZXIpOwogIGlmICh0aGlzLnBkZlNpZGViYXI/LnZpc2libGVWaWV3ID09PSBTaWRlYmFyVmlldy5USFVNQlMpIHsKICAgIHRoaXMucGRmVGh1bWJuYWlsVmlld2VyPy5zY3JvbGxUaHVtYm5haWxJbnRvVmlldyhwYWdlTnVtYmVyKTsKICB9CiAgY29uc3QgY3VycmVudFBhZ2UgPSB0aGlzLnBkZlZpZXdlci5nZXRQYWdlVmlldyhwYWdlTnVtYmVyIC0gMSk7CiAgdGhpcy50b29sYmFyPy51cGRhdGVMb2FkaW5nSW5kaWNhdG9yU3RhdGUoY3VycmVudFBhZ2U/LnJlbmRlcmluZ1N0YXRlID09PSBSZW5kZXJpbmdTdGF0ZXMuUlVOTklORyk7Cn0KZnVuY3Rpb24gb25XaGVlbChldnQpIHsKICBjb25zdCB7CiAgICBwZGZWaWV3ZXIsCiAgICBzdXBwb3J0c01vdXNlV2hlZWxab29tQ3RybEtleSwKICAgIHN1cHBvcnRzTW91c2VXaGVlbFpvb21NZXRhS2V5LAogICAgc3VwcG9ydHNQaW5jaFRvWm9vbQogIH0gPSB0aGlzOwogIGlmIChwZGZWaWV3ZXIuaXNJblByZXNlbnRhdGlvbk1vZGUpIHsKICAgIHJldHVybjsKICB9CiAgY29uc3QgZGVsdGFNb2RlID0gZXZ0LmRlbHRhTW9kZTsKICBsZXQgc2NhbGVGYWN0b3IgPSBNYXRoLmV4cCgtZXZ0LmRlbHRhWSAvIDEwMCk7CiAgY29uc3QgaXNCdWlsdEluTWFjID0gZmFsc2U7CiAgY29uc3QgaXNQaW5jaFRvWm9vbSA9IGV2dC5jdHJsS2V5ICYmICF0aGlzLl9pc0N0cmxLZXlEb3duICYmIGRlbHRhTW9kZSA9PT0gV2hlZWxFdmVudC5ET01fREVMVEFfUElYRUwgJiYgZXZ0LmRlbHRhWCA9PT0gMCAmJiAoTWF0aC5hYnMoc2NhbGVGYWN0b3IgLSAxKSA8IDAuMDUgfHwgaXNCdWlsdEluTWFjKSAmJiBldnQuZGVsdGFaID09PSAwOwogIGNvbnN0IG9yaWdpbiA9IFtldnQuY2xpZW50WCwgZXZ0LmNsaWVudFldOwogIGlmIChpc1BpbmNoVG9ab29tIHx8IGV2dC5jdHJsS2V5ICYmIHN1cHBvcnRzTW91c2VXaGVlbFpvb21DdHJsS2V5IHx8IGV2dC5tZXRhS2V5ICYmIHN1cHBvcnRzTW91c2VXaGVlbFpvb21NZXRhS2V5KSB7CiAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgIGlmICh0aGlzLl9pc1Njcm9sbGluZyB8fCBkb2N1bWVudC52aXNpYmlsaXR5U3RhdGUgPT09ICJoaWRkZW4iIHx8IHRoaXMub3ZlcmxheU1hbmFnZXIuYWN0aXZlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChpc1BpbmNoVG9ab29tICYmIHN1cHBvcnRzUGluY2hUb1pvb20pIHsKICAgICAgc2NhbGVGYWN0b3IgPSB0aGlzLl9hY2N1bXVsYXRlRmFjdG9yKHBkZlZpZXdlci5jdXJyZW50U2NhbGUsIHNjYWxlRmFjdG9yLCAiX3doZWVsVW51c2VkRmFjdG9yIik7CiAgICAgIHRoaXMudXBkYXRlWm9vbShudWxsLCBzY2FsZUZhY3Rvciwgb3JpZ2luKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGRlbHRhID0gbm9ybWFsaXplV2hlZWxFdmVudERpcmVjdGlvbihldnQpOwogICAgICBsZXQgdGlja3MgPSAwOwogICAgICBpZiAoZGVsdGFNb2RlID09PSBXaGVlbEV2ZW50LkRPTV9ERUxUQV9MSU5FIHx8IGRlbHRhTW9kZSA9PT0gV2hlZWxFdmVudC5ET01fREVMVEFfUEFHRSkgewogICAgICAgIHRpY2tzID0gTWF0aC5hYnMoZGVsdGEpID49IDEgPyBNYXRoLnNpZ24oZGVsdGEpIDogdGhpcy5fYWNjdW11bGF0ZVRpY2tzKGRlbHRhLCAiX3doZWVsVW51c2VkVGlja3MiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBQSVhFTFNfUEVSX0xJTkVfU0NBTEUgPSAzMDsKICAgICAgICB0aWNrcyA9IHRoaXMuX2FjY3VtdWxhdGVUaWNrcyhkZWx0YSAvIFBJWEVMU19QRVJfTElORV9TQ0FMRSwgIl93aGVlbFVudXNlZFRpY2tzIik7CiAgICAgIH0KICAgICAgdGhpcy51cGRhdGVab29tKHRpY2tzLCBudWxsLCBvcmlnaW4pOwogICAgfQogIH0KfQpmdW5jdGlvbiBjbG9zZVNlY29uZGFyeVRvb2xiYXIoewogIHRhcmdldAp9KSB7CiAgaWYgKCF0aGlzLnNlY29uZGFyeVRvb2xiYXI/LmlzT3BlbikgewogICAgcmV0dXJuOwogIH0KICBjb25zdCB7CiAgICB0b29sYmFyLAogICAgc2Vjb25kYXJ5VG9vbGJhcgogIH0gPSB0aGlzLmFwcENvbmZpZzsKICBpZiAodGhpcy5wZGZWaWV3ZXIuY29udGFpbnNFbGVtZW50KHRhcmdldCkgfHwgdG9vbGJhcj8uY29udGFpbmVyLmNvbnRhaW5zKHRhcmdldCkgJiYgIXNlY29uZGFyeVRvb2xiYXI/LnRvb2xiYXIuY29udGFpbnModGFyZ2V0KSAmJiAhc2Vjb25kYXJ5VG9vbGJhcj8udG9nZ2xlQnV0dG9uLmNvbnRhaW5zKHRhcmdldCkpIHsKICAgIHRoaXMuc2Vjb25kYXJ5VG9vbGJhci5jbG9zZSgpOwogIH0KfQpmdW5jdGlvbiBjbG9zZUVkaXRvclVuZG9CYXIoZXZ0KSB7CiAgaWYgKCF0aGlzLmVkaXRvclVuZG9CYXI/LmlzT3BlbikgewogICAgcmV0dXJuOwogIH0KICBpZiAodGhpcy5hcHBDb25maWcuc2Vjb25kYXJ5VG9vbGJhcj8udG9vbGJhci5jb250YWlucyhldnQudGFyZ2V0KSkgewogICAgdGhpcy5lZGl0b3JVbmRvQmFyLmhpZGUoKTsKICB9Cn0KZnVuY3Rpb24gb25DbGljayhldnQpIHsKICBjbG9zZVNlY29uZGFyeVRvb2xiYXIuY2FsbCh0aGlzLCBldnQpOwogIGNsb3NlRWRpdG9yVW5kb0Jhci5jYWxsKHRoaXMsIGV2dCk7Cn0KZnVuY3Rpb24gb25LZXlVcChldnQpIHsKICBpZiAoZXZ0LmtleSA9PT0gIkNvbnRyb2wiKSB7CiAgICB0aGlzLl9pc0N0cmxLZXlEb3duID0gZmFsc2U7CiAgfQp9CmZ1bmN0aW9uIG9uS2V5RG93bihldnQpIHsKICB0aGlzLl9pc0N0cmxLZXlEb3duID0gZXZ0LmtleSA9PT0gIkNvbnRyb2wiOwogIGlmICh0aGlzLmVkaXRvclVuZG9CYXI/LmlzT3BlbiAmJiBldnQua2V5Q29kZSAhPT0gOSAmJiBldnQua2V5Q29kZSAhPT0gMTYgJiYgISgoZXZ0LmtleUNvZGUgPT09IDEzIHx8IGV2dC5rZXlDb2RlID09PSAzMikgJiYgZ2V0QWN0aXZlT3JGb2N1c2VkRWxlbWVudCgpID09PSB0aGlzLmFwcENvbmZpZy5lZGl0b3JVbmRvQmFyLnVuZG9CdXR0b24pKSB7CiAgICB0aGlzLmVkaXRvclVuZG9CYXIuaGlkZSgpOwogIH0KICBpZiAodGhpcy5vdmVybGF5TWFuYWdlci5hY3RpdmUpIHsKICAgIHJldHVybjsKICB9CiAgY29uc3QgewogICAgZXZlbnRCdXMsCiAgICBwZGZWaWV3ZXIKICB9ID0gdGhpczsKICBjb25zdCBpc1ZpZXdlckluUHJlc2VudGF0aW9uTW9kZSA9IHBkZlZpZXdlci5pc0luUHJlc2VudGF0aW9uTW9kZTsKICBsZXQgaGFuZGxlZCA9IGZhbHNlLAogICAgZW5zdXJlVmlld2VyRm9jdXNlZCA9IGZhbHNlOwogIGNvbnN0IGNtZCA9IChldnQuY3RybEtleSA/IDEgOiAwKSB8IChldnQuYWx0S2V5ID8gMiA6IDApIHwgKGV2dC5zaGlmdEtleSA/IDQgOiAwKSB8IChldnQubWV0YUtleSA/IDggOiAwKTsKICBpZiAoY21kID09PSAxIHx8IGNtZCA9PT0gOCB8fCBjbWQgPT09IDUgfHwgY21kID09PSAxMikgewogICAgc3dpdGNoIChldnQua2V5Q29kZSkgewogICAgICBjYXNlIDcwOgogICAgICAgIGlmICghdGhpcy5zdXBwb3J0c0ludGVncmF0ZWRGaW5kICYmICFldnQuc2hpZnRLZXkpIHsKICAgICAgICAgIHRoaXMuZmluZEJhcj8ub3BlbigpOwogICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDcxOgogICAgICAgIGlmICghdGhpcy5zdXBwb3J0c0ludGVncmF0ZWRGaW5kKSB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIHN0YXRlCiAgICAgICAgICB9ID0gdGhpcy5maW5kQ29udHJvbGxlcjsKICAgICAgICAgIGlmIChzdGF0ZSkgewogICAgICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IHsKICAgICAgICAgICAgICBzb3VyY2U6IHdpbmRvdywKICAgICAgICAgICAgICB0eXBlOiAiYWdhaW4iLAogICAgICAgICAgICAgIGZpbmRQcmV2aW91czogY21kID09PSA1IHx8IGNtZCA9PT0gMTIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZXZlbnRCdXMuZGlzcGF0Y2goImZpbmQiLCB7CiAgICAgICAgICAgICAgLi4uc3RhdGUsCiAgICAgICAgICAgICAgLi4ubmV3U3RhdGUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgNjE6CiAgICAgIGNhc2UgMTA3OgogICAgICBjYXNlIDE4NzoKICAgICAgY2FzZSAxNzE6CiAgICAgICAgdGhpcy56b29tSW4oKTsKICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAxNzM6CiAgICAgIGNhc2UgMTA5OgogICAgICBjYXNlIDE4OToKICAgICAgICB0aGlzLnpvb21PdXQoKTsKICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSA0ODoKICAgICAgY2FzZSA5NjoKICAgICAgICBpZiAoIWlzVmlld2VySW5QcmVzZW50YXRpb25Nb2RlKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgdGhpcy56b29tUmVzZXQoKTsKICAgICAgICAgIH0pOwogICAgICAgICAgaGFuZGxlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAzODoKICAgICAgICBpZiAoaXNWaWV3ZXJJblByZXNlbnRhdGlvbk1vZGUgfHwgdGhpcy5wYWdlID4gMSkgewogICAgICAgICAgdGhpcy5wYWdlID0gMTsKICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgZW5zdXJlVmlld2VyRm9jdXNlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDQwOgogICAgICAgIGlmIChpc1ZpZXdlckluUHJlc2VudGF0aW9uTW9kZSB8fCB0aGlzLnBhZ2UgPCB0aGlzLnBhZ2VzQ291bnQpIHsKICAgICAgICAgIHRoaXMucGFnZSA9IHRoaXMucGFnZXNDb3VudDsKICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgZW5zdXJlVmlld2VyRm9jdXNlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgfQogIH0KICBpZiAoY21kID09PSAxIHx8IGNtZCA9PT0gOCkgewogICAgc3dpdGNoIChldnQua2V5Q29kZSkgewogICAgICBjYXNlIDgzOgogICAgICAgIGV2ZW50QnVzLmRpc3BhdGNoKCJkb3dubG9hZCIsIHsKICAgICAgICAgIHNvdXJjZTogd2luZG93CiAgICAgICAgfSk7CiAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgNzk6CiAgICAgICAgewogICAgICAgICAgZXZlbnRCdXMuZGlzcGF0Y2goIm9wZW5maWxlIiwgewogICAgICAgICAgICBzb3VyY2U6IHdpbmRvdwogICAgICAgICAgfSk7CiAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQogIGlmIChjbWQgPT09IDMgfHwgY21kID09PSAxMCkgewogICAgc3dpdGNoIChldnQua2V5Q29kZSkgewogICAgICBjYXNlIDgwOgogICAgICAgIHRoaXMucmVxdWVzdFByZXNlbnRhdGlvbk1vZGUoKTsKICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmV4dGVybmFsU2VydmljZXMucmVwb3J0VGVsZW1ldHJ5KHsKICAgICAgICAgIHR5cGU6ICJidXR0b25zIiwKICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgaWQ6ICJwcmVzZW50YXRpb25Nb2RlS2V5Ym9hcmQiCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgNzE6CiAgICAgICAgaWYgKHRoaXMuYXBwQ29uZmlnLnRvb2xiYXIpIHsKICAgICAgICAgIHRoaXMuYXBwQ29uZmlnLnRvb2xiYXIucGFnZU51bWJlci5zZWxlY3QoKTsKICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgIH0KICB9CiAgaWYgKGhhbmRsZWQpIHsKICAgIGlmIChlbnN1cmVWaWV3ZXJGb2N1c2VkICYmICFpc1ZpZXdlckluUHJlc2VudGF0aW9uTW9kZSkgewogICAgICBwZGZWaWV3ZXIuZm9jdXMoKTsKICAgIH0KICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgcmV0dXJuOwogIH0KICBjb25zdCBjdXJFbGVtZW50ID0gZ2V0QWN0aXZlT3JGb2N1c2VkRWxlbWVudCgpOwogIGNvbnN0IGN1ckVsZW1lbnRUYWdOYW1lID0gY3VyRWxlbWVudD8udGFnTmFtZS50b1VwcGVyQ2FzZSgpOwogIGlmIChjdXJFbGVtZW50VGFnTmFtZSA9PT0gIklOUFVUIiB8fCBjdXJFbGVtZW50VGFnTmFtZSA9PT0gIlRFWFRBUkVBIiB8fCBjdXJFbGVtZW50VGFnTmFtZSA9PT0gIlNFTEVDVCIgfHwgY3VyRWxlbWVudFRhZ05hbWUgPT09ICJCVVRUT04iICYmIChldnQua2V5Q29kZSA9PT0gMTMgfHwgZXZ0LmtleUNvZGUgPT09IDMyKSB8fCBjdXJFbGVtZW50Py5pc0NvbnRlbnRFZGl0YWJsZSkgewogICAgaWYgKGV2dC5rZXlDb2RlICE9PSAyNykgewogICAgICByZXR1cm47CiAgICB9CiAgfQogIGlmIChjbWQgPT09IDApIHsKICAgIGxldCB0dXJuUGFnZSA9IDAsCiAgICAgIHR1cm5Pbmx5SWZQYWdlRml0ID0gZmFsc2U7CiAgICBzd2l0Y2ggKGV2dC5rZXlDb2RlKSB7CiAgICAgIGNhc2UgMzg6CiAgICAgICAgaWYgKHRoaXMuc3VwcG9ydHNDYXJldEJyb3dzaW5nTW9kZSkgewogICAgICAgICAgdGhpcy5tb3ZlQ2FyZXQodHJ1ZSwgZmFsc2UpOwogICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgMzM6CiAgICAgICAgaWYgKHBkZlZpZXdlci5pc1ZlcnRpY2FsU2Nyb2xsYmFyRW5hYmxlZCkgewogICAgICAgICAgdHVybk9ubHlJZlBhZ2VGaXQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICB0dXJuUGFnZSA9IC0xOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDg6CiAgICAgICAgaWYgKCFpc1ZpZXdlckluUHJlc2VudGF0aW9uTW9kZSkgewogICAgICAgICAgdHVybk9ubHlJZlBhZ2VGaXQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICB0dXJuUGFnZSA9IC0xOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDM3OgogICAgICAgIGlmICh0aGlzLnN1cHBvcnRzQ2FyZXRCcm93c2luZ01vZGUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHBkZlZpZXdlci5pc0hvcml6b250YWxTY3JvbGxiYXJFbmFibGVkKSB7CiAgICAgICAgICB0dXJuT25seUlmUGFnZUZpdCA9IHRydWU7CiAgICAgICAgfQogICAgICBjYXNlIDc1OgogICAgICBjYXNlIDgwOgogICAgICAgIHR1cm5QYWdlID0gLTE7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjc6CiAgICAgICAgaWYgKHRoaXMuc2Vjb25kYXJ5VG9vbGJhcj8uaXNPcGVuKSB7CiAgICAgICAgICB0aGlzLnNlY29uZGFyeVRvb2xiYXIuY2xvc2UoKTsKICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuc3VwcG9ydHNJbnRlZ3JhdGVkRmluZCAmJiB0aGlzLmZpbmRCYXI/Lm9wZW5lZCkgewogICAgICAgICAgdGhpcy5maW5kQmFyLmNsb3NlKCk7CiAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgNDA6CiAgICAgICAgaWYgKHRoaXMuc3VwcG9ydHNDYXJldEJyb3dzaW5nTW9kZSkgewogICAgICAgICAgdGhpcy5tb3ZlQ2FyZXQoZmFsc2UsIGZhbHNlKTsKICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIDM0OgogICAgICAgIGlmIChwZGZWaWV3ZXIuaXNWZXJ0aWNhbFNjcm9sbGJhckVuYWJsZWQpIHsKICAgICAgICAgIHR1cm5Pbmx5SWZQYWdlRml0ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgdHVyblBhZ2UgPSAxOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDEzOgogICAgICBjYXNlIDMyOgogICAgICAgIGlmICghaXNWaWV3ZXJJblByZXNlbnRhdGlvbk1vZGUpIHsKICAgICAgICAgIHR1cm5Pbmx5SWZQYWdlRml0ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgdHVyblBhZ2UgPSAxOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDM5OgogICAgICAgIGlmICh0aGlzLnN1cHBvcnRzQ2FyZXRCcm93c2luZ01vZGUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHBkZlZpZXdlci5pc0hvcml6b250YWxTY3JvbGxiYXJFbmFibGVkKSB7CiAgICAgICAgICB0dXJuT25seUlmUGFnZUZpdCA9IHRydWU7CiAgICAgICAgfQogICAgICBjYXNlIDc0OgogICAgICBjYXNlIDc4OgogICAgICAgIHR1cm5QYWdlID0gMTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAzNjoKICAgICAgICBpZiAoaXNWaWV3ZXJJblByZXNlbnRhdGlvbk1vZGUgfHwgdGhpcy5wYWdlID4gMSkgewogICAgICAgICAgdGhpcy5wYWdlID0gMTsKICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgZW5zdXJlVmlld2VyRm9jdXNlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDM1OgogICAgICAgIGlmIChpc1ZpZXdlckluUHJlc2VudGF0aW9uTW9kZSB8fCB0aGlzLnBhZ2UgPCB0aGlzLnBhZ2VzQ291bnQpIHsKICAgICAgICAgIHRoaXMucGFnZSA9IHRoaXMucGFnZXNDb3VudDsKICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgZW5zdXJlVmlld2VyRm9jdXNlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDgzOgogICAgICAgIHRoaXMucGRmQ3Vyc29yVG9vbHM/LnN3aXRjaFRvb2woQ3Vyc29yVG9vbC5TRUxFQ1QpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDcyOgogICAgICAgIHRoaXMucGRmQ3Vyc29yVG9vbHM/LnN3aXRjaFRvb2woQ3Vyc29yVG9vbC5IQU5EKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSA4MjoKICAgICAgICB0aGlzLnJvdGF0ZVBhZ2VzKDkwKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAxMTU6CiAgICAgICAgdGhpcy5wZGZTaWRlYmFyPy50b2dnbGUoKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGlmICh0dXJuUGFnZSAhPT0gMCAmJiAoIXR1cm5Pbmx5SWZQYWdlRml0IHx8IHBkZlZpZXdlci5jdXJyZW50U2NhbGVWYWx1ZSA9PT0gInBhZ2UtZml0IikpIHsKICAgICAgaWYgKHR1cm5QYWdlID4gMCkgewogICAgICAgIHBkZlZpZXdlci5uZXh0UGFnZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHBkZlZpZXdlci5wcmV2aW91c1BhZ2UoKTsKICAgICAgfQogICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgIH0KICB9CiAgaWYgKGNtZCA9PT0gNCkgewogICAgc3dpdGNoIChldnQua2V5Q29kZSkgewogICAgICBjYXNlIDEzOgogICAgICBjYXNlIDMyOgogICAgICAgIGlmICghaXNWaWV3ZXJJblByZXNlbnRhdGlvbk1vZGUgJiYgcGRmVmlld2VyLmN1cnJlbnRTY2FsZVZhbHVlICE9PSAicGFnZS1maXQiKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcGRmVmlld2VyLnByZXZpb3VzUGFnZSgpOwogICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDM4OgogICAgICAgIHRoaXMubW92ZUNhcmV0KHRydWUsIHRydWUpOwogICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDQwOgogICAgICAgIHRoaXMubW92ZUNhcmV0KGZhbHNlLCB0cnVlKTsKICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSA4MjoKICAgICAgICB0aGlzLnJvdGF0ZVBhZ2VzKC05MCk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQogIGlmICghaGFuZGxlZCAmJiAhaXNWaWV3ZXJJblByZXNlbnRhdGlvbk1vZGUpIHsKICAgIGlmIChldnQua2V5Q29kZSA+PSAzMyAmJiBldnQua2V5Q29kZSA8PSA0MCB8fCBldnQua2V5Q29kZSA9PT0gMzIgJiYgY3VyRWxlbWVudFRhZ05hbWUgIT09ICJCVVRUT04iKSB7CiAgICAgIGVuc3VyZVZpZXdlckZvY3VzZWQgPSB0cnVlOwogICAgfQogIH0KICBpZiAoZW5zdXJlVmlld2VyRm9jdXNlZCAmJiAhcGRmVmlld2VyLmNvbnRhaW5zRWxlbWVudChjdXJFbGVtZW50KSkgewogICAgcGRmVmlld2VyLmZvY3VzKCk7CiAgfQogIGlmIChoYW5kbGVkKSB7CiAgICBldnQucHJldmVudERlZmF1bHQoKTsKICB9Cn0KZnVuY3Rpb24gYmVmb3JlVW5sb2FkKGV2dCkgewogIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogIGV2dC5yZXR1cm5WYWx1ZSA9ICIiOwogIHJldHVybiBmYWxzZTsKfQoKOy8vIC4vd2ViL3ZpZXdlci5qcwoKCgoKY29uc3QgQXBwQ29uc3RhbnRzID0gewogIExpbmtUYXJnZXQ6IExpbmtUYXJnZXQsCiAgUmVuZGVyaW5nU3RhdGVzOiBSZW5kZXJpbmdTdGF0ZXMsCiAgU2Nyb2xsTW9kZTogU2Nyb2xsTW9kZSwKICBTcHJlYWRNb2RlOiBTcHJlYWRNb2RlCn07CndpbmRvdy5QREZWaWV3ZXJBcHBsaWNhdGlvbiA9IFBERlZpZXdlckFwcGxpY2F0aW9uOwp3aW5kb3cuUERGVmlld2VyQXBwbGljYXRpb25Db25zdGFudHMgPSBBcHBDb25zdGFudHM7CndpbmRvdy5QREZWaWV3ZXJBcHBsaWNhdGlvbk9wdGlvbnMgPSBBcHBPcHRpb25zOwpmdW5jdGlvbiBnZXRWaWV3ZXJDb25maWd1cmF0aW9uKCkgewogIHJldHVybiB7CiAgICBhcHBDb250YWluZXI6IGRvY3VtZW50LmJvZHksCiAgICBwcmluY2lwYWxDb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtYWluQ29udGFpbmVyIiksCiAgICBtYWluQ29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld2VyQ29udGFpbmVyIiksCiAgICB2aWV3ZXJDb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3ZXIiKSwKICAgIHRvb2xiYXI6IHsKICAgICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidG9vbGJhckNvbnRhaW5lciIpLAogICAgICBudW1QYWdlczogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm51bVBhZ2VzIiksCiAgICAgIHBhZ2VOdW1iZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYWdlTnVtYmVyIiksCiAgICAgIHNjYWxlU2VsZWN0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2NhbGVTZWxlY3QiKSwKICAgICAgY3VzdG9tU2NhbGVPcHRpb246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjdXN0b21TY2FsZU9wdGlvbiIpLAogICAgICBwcmV2aW91czogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByZXZpb3VzIiksCiAgICAgIG5leHQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuZXh0IiksCiAgICAgIHpvb21JbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInpvb21JbkJ1dHRvbiIpLAogICAgICB6b29tT3V0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiem9vbU91dEJ1dHRvbiIpLAogICAgICBwcmludDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByaW50QnV0dG9uIiksCiAgICAgIGVkaXRvckZyZWVUZXh0QnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yRnJlZVRleHRCdXR0b24iKSwKICAgICAgZWRpdG9yRnJlZVRleHRQYXJhbXNUb29sYmFyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yRnJlZVRleHRQYXJhbXNUb29sYmFyIiksCiAgICAgIGVkaXRvckhpZ2hsaWdodEJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvckhpZ2hsaWdodEJ1dHRvbiIpLAogICAgICBlZGl0b3JIaWdobGlnaHRQYXJhbXNUb29sYmFyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9ySGlnaGxpZ2h0UGFyYW1zVG9vbGJhciIpLAogICAgICBlZGl0b3JIaWdobGlnaHRDb2xvclBpY2tlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvckhpZ2hsaWdodENvbG9yUGlja2VyIiksCiAgICAgIGVkaXRvcklua0J1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvcklua0J1dHRvbiIpLAogICAgICBlZGl0b3JJbmtQYXJhbXNUb29sYmFyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9ySW5rUGFyYW1zVG9vbGJhciIpLAogICAgICBlZGl0b3JTdGFtcEJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvclN0YW1wQnV0dG9uIiksCiAgICAgIGVkaXRvclN0YW1wUGFyYW1zVG9vbGJhcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvclN0YW1wUGFyYW1zVG9vbGJhciIpLAogICAgICBlZGl0b3JTaWduYXR1cmVCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0b3JTaWduYXR1cmVCdXR0b24iKSwKICAgICAgZWRpdG9yU2lnbmF0dXJlUGFyYW1zVG9vbGJhcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvclNpZ25hdHVyZVBhcmFtc1Rvb2xiYXIiKSwKICAgICAgZG93bmxvYWQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkb3dubG9hZEJ1dHRvbiIpCiAgICB9LAogICAgc2Vjb25kYXJ5VG9vbGJhcjogewogICAgICB0b29sYmFyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2Vjb25kYXJ5VG9vbGJhciIpLAogICAgICB0b2dnbGVCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWNvbmRhcnlUb29sYmFyVG9nZ2xlQnV0dG9uIiksCiAgICAgIHByZXNlbnRhdGlvbk1vZGVCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcmVzZW50YXRpb25Nb2RlIiksCiAgICAgIG9wZW5GaWxlQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2Vjb25kYXJ5T3BlbkZpbGUiKSwKICAgICAgcHJpbnRCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWNvbmRhcnlQcmludCIpLAogICAgICBkb3dubG9hZEJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlY29uZGFyeURvd25sb2FkIiksCiAgICAgIHZpZXdCb29rbWFya0J1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXdCb29rbWFyayIpLAogICAgICBmaXJzdFBhZ2VCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaXJzdFBhZ2UiKSwKICAgICAgbGFzdFBhZ2VCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsYXN0UGFnZSIpLAogICAgICBwYWdlUm90YXRlQ3dCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYWdlUm90YXRlQ3ciKSwKICAgICAgcGFnZVJvdGF0ZUNjd0J1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBhZ2VSb3RhdGVDY3ciKSwKICAgICAgY3Vyc29yU2VsZWN0VG9vbEJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImN1cnNvclNlbGVjdFRvb2wiKSwKICAgICAgY3Vyc29ySGFuZFRvb2xCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjdXJzb3JIYW5kVG9vbCIpLAogICAgICBzY3JvbGxQYWdlQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2Nyb2xsUGFnZSIpLAogICAgICBzY3JvbGxWZXJ0aWNhbEJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNjcm9sbFZlcnRpY2FsIiksCiAgICAgIHNjcm9sbEhvcml6b250YWxCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzY3JvbGxIb3Jpem9udGFsIiksCiAgICAgIHNjcm9sbFdyYXBwZWRCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzY3JvbGxXcmFwcGVkIiksCiAgICAgIHNwcmVhZE5vbmVCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzcHJlYWROb25lIiksCiAgICAgIHNwcmVhZE9kZEJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNwcmVhZE9kZCIpLAogICAgICBzcHJlYWRFdmVuQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3ByZWFkRXZlbiIpLAogICAgICBpbWFnZUFsdFRleHRTZXR0aW5nc0J1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltYWdlQWx0VGV4dFNldHRpbmdzIiksCiAgICAgIGltYWdlQWx0VGV4dFNldHRpbmdzU2VwYXJhdG9yOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW1hZ2VBbHRUZXh0U2V0dGluZ3NTZXBhcmF0b3IiKSwKICAgICAgZG9jdW1lbnRQcm9wZXJ0aWVzQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZG9jdW1lbnRQcm9wZXJ0aWVzIikKICAgIH0sCiAgICBzaWRlYmFyOiB7CiAgICAgIG91dGVyQ29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgib3V0ZXJDb250YWluZXIiKSwKICAgICAgc2lkZWJhckNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNpZGViYXJDb250YWluZXIiKSwKICAgICAgdG9nZ2xlQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2lkZWJhclRvZ2dsZUJ1dHRvbiIpLAogICAgICByZXNpemVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2lkZWJhclJlc2l6ZXIiKSwKICAgICAgdGh1bWJuYWlsQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld1RodW1ibmFpbCIpLAogICAgICBvdXRsaW5lQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld091dGxpbmUiKSwKICAgICAgYXR0YWNobWVudHNCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3QXR0YWNobWVudHMiKSwKICAgICAgbGF5ZXJzQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld0xheWVycyIpLAogICAgICB0aHVtYm5haWxWaWV3OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGh1bWJuYWlsVmlldyIpLAogICAgICBvdXRsaW5lVmlldzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm91dGxpbmVWaWV3IiksCiAgICAgIGF0dGFjaG1lbnRzVmlldzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF0dGFjaG1lbnRzVmlldyIpLAogICAgICBsYXllcnNWaWV3OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGF5ZXJzVmlldyIpLAogICAgICBjdXJyZW50T3V0bGluZUl0ZW1CdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjdXJyZW50T3V0bGluZUl0ZW0iKQogICAgfSwKICAgIGZpbmRCYXI6IHsKICAgICAgYmFyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmluZGJhciIpLAogICAgICB0b2dnbGVCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3RmluZEJ1dHRvbiIpLAogICAgICBmaW5kRmllbGQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kSW5wdXQiKSwKICAgICAgaGlnaGxpZ2h0QWxsQ2hlY2tib3g6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kSGlnaGxpZ2h0QWxsIiksCiAgICAgIGNhc2VTZW5zaXRpdmVDaGVja2JveDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmRNYXRjaENhc2UiKSwKICAgICAgbWF0Y2hEaWFjcml0aWNzQ2hlY2tib3g6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kTWF0Y2hEaWFjcml0aWNzIiksCiAgICAgIGVudGlyZVdvcmRDaGVja2JveDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmRFbnRpcmVXb3JkIiksCiAgICAgIGZpbmRNc2c6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kTXNnIiksCiAgICAgIGZpbmRSZXN1bHRzQ291bnQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaW5kUmVzdWx0c0NvdW50IiksCiAgICAgIGZpbmRQcmV2aW91c0J1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmRQcmV2aW91c0J1dHRvbiIpLAogICAgICBmaW5kTmV4dEJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbmROZXh0QnV0dG9uIikKICAgIH0sCiAgICBwYXNzd29yZE92ZXJsYXk6IHsKICAgICAgZGlhbG9nOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFzc3dvcmREaWFsb2ciKSwKICAgICAgbGFiZWw6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXNzd29yZFRleHQiKSwKICAgICAgaW5wdXQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXNzd29yZCIpLAogICAgICBzdWJtaXRCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXNzd29yZFN1Ym1pdCIpLAogICAgICBjYW5jZWxCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXNzd29yZENhbmNlbCIpCiAgICB9LAogICAgZG9jdW1lbnRQcm9wZXJ0aWVzOiB7CiAgICAgIGRpYWxvZzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRvY3VtZW50UHJvcGVydGllc0RpYWxvZyIpLAogICAgICBjbG9zZUJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRvY3VtZW50UHJvcGVydGllc0Nsb3NlIiksCiAgICAgIGZpZWxkczogewogICAgICAgIGZpbGVOYW1lOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmlsZU5hbWVGaWVsZCIpLAogICAgICAgIGZpbGVTaXplOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmlsZVNpemVGaWVsZCIpLAogICAgICAgIHRpdGxlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGl0bGVGaWVsZCIpLAogICAgICAgIGF1dGhvcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF1dGhvckZpZWxkIiksCiAgICAgICAgc3ViamVjdDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN1YmplY3RGaWVsZCIpLAogICAgICAgIGtleXdvcmRzOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgia2V5d29yZHNGaWVsZCIpLAogICAgICAgIGNyZWF0aW9uRGF0ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNyZWF0aW9uRGF0ZUZpZWxkIiksCiAgICAgICAgbW9kaWZpY2F0aW9uRGF0ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vZGlmaWNhdGlvbkRhdGVGaWVsZCIpLAogICAgICAgIGNyZWF0b3I6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjcmVhdG9yRmllbGQiKSwKICAgICAgICBwcm9kdWNlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2R1Y2VyRmllbGQiKSwKICAgICAgICB2ZXJzaW9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmVyc2lvbkZpZWxkIiksCiAgICAgICAgcGFnZUNvdW50OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFnZUNvdW50RmllbGQiKSwKICAgICAgICBwYWdlU2l6ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBhZ2VTaXplRmllbGQiKSwKICAgICAgICBsaW5lYXJpemVkOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGluZWFyaXplZEZpZWxkIikKICAgICAgfQogICAgfSwKICAgIGFsdFRleHREaWFsb2c6IHsKICAgICAgZGlhbG9nOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWx0VGV4dERpYWxvZyIpLAogICAgICBvcHRpb25EZXNjcmlwdGlvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRlc2NyaXB0aW9uQnV0dG9uIiksCiAgICAgIG9wdGlvbkRlY29yYXRpdmU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZWNvcmF0aXZlQnV0dG9uIiksCiAgICAgIHRleHRhcmVhOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGVzY3JpcHRpb25UZXh0YXJlYSIpLAogICAgICBjYW5jZWxCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbHRUZXh0Q2FuY2VsIiksCiAgICAgIHNhdmVCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbHRUZXh0U2F2ZSIpCiAgICB9LAogICAgbmV3QWx0VGV4dERpYWxvZzogewogICAgICBkaWFsb2c6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuZXdBbHRUZXh0RGlhbG9nIiksCiAgICAgIHRpdGxlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmV3QWx0VGV4dFRpdGxlIiksCiAgICAgIGRlc2NyaXB0aW9uQ29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmV3QWx0VGV4dERlc2NyaXB0aW9uQ29udGFpbmVyIiksCiAgICAgIHRleHRhcmVhOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmV3QWx0VGV4dERlc2NyaXB0aW9uVGV4dGFyZWEiKSwKICAgICAgZGlzY2xhaW1lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5ld0FsdFRleHREaXNjbGFpbWVyIiksCiAgICAgIGxlYXJuTW9yZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5ld0FsdFRleHRMZWFybk1vcmUiKSwKICAgICAgaW1hZ2VQcmV2aWV3OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmV3QWx0VGV4dEltYWdlUHJldmlldyIpLAogICAgICBjcmVhdGVBdXRvbWF0aWNhbGx5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmV3QWx0VGV4dENyZWF0ZUF1dG9tYXRpY2FsbHkiKSwKICAgICAgY3JlYXRlQXV0b21hdGljYWxseUJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5ld0FsdFRleHRDcmVhdGVBdXRvbWF0aWNhbGx5QnV0dG9uIiksCiAgICAgIGRvd25sb2FkTW9kZWw6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuZXdBbHRUZXh0RG93bmxvYWRNb2RlbCIpLAogICAgICBkb3dubG9hZE1vZGVsRGVzY3JpcHRpb246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuZXdBbHRUZXh0RG93bmxvYWRNb2RlbERlc2NyaXB0aW9uIiksCiAgICAgIGVycm9yOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmV3QWx0VGV4dEVycm9yIiksCiAgICAgIGVycm9yQ2xvc2VCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuZXdBbHRUZXh0Q2xvc2VCdXR0b24iKSwKICAgICAgY2FuY2VsQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmV3QWx0VGV4dENhbmNlbCIpLAogICAgICBub3ROb3dCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuZXdBbHRUZXh0Tm90Tm93IiksCiAgICAgIHNhdmVCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuZXdBbHRUZXh0U2F2ZSIpCiAgICB9LAogICAgYWx0VGV4dFNldHRpbmdzRGlhbG9nOiB7CiAgICAgIGRpYWxvZzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFsdFRleHRTZXR0aW5nc0RpYWxvZyIpLAogICAgICBjcmVhdGVNb2RlbEJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNyZWF0ZU1vZGVsQnV0dG9uIiksCiAgICAgIGFpTW9kZWxTZXR0aW5nczogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFpTW9kZWxTZXR0aW5ncyIpLAogICAgICBsZWFybk1vcmU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbHRUZXh0U2V0dGluZ3NMZWFybk1vcmUiKSwKICAgICAgZGVsZXRlTW9kZWxCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZWxldGVNb2RlbEJ1dHRvbiIpLAogICAgICBkb3dubG9hZE1vZGVsQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZG93bmxvYWRNb2RlbEJ1dHRvbiIpLAogICAgICBzaG93QWx0VGV4dERpYWxvZ0J1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNob3dBbHRUZXh0RGlhbG9nQnV0dG9uIiksCiAgICAgIGFsdFRleHRTZXR0aW5nc0Nsb3NlQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWx0VGV4dFNldHRpbmdzQ2xvc2VCdXR0b24iKSwKICAgICAgY2xvc2VCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbHRUZXh0U2V0dGluZ3NDbG9zZUJ1dHRvbiIpCiAgICB9LAogICAgYWRkU2lnbmF0dXJlRGlhbG9nOiB7CiAgICAgIGRpYWxvZzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFkZFNpZ25hdHVyZURpYWxvZyIpLAogICAgICBwYW5lbHM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZGRTaWduYXR1cmVBY3Rpb25Db250YWluZXIiKSwKICAgICAgdHlwZUJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFkZFNpZ25hdHVyZVR5cGVCdXR0b24iKSwKICAgICAgdHlwZUlucHV0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWRkU2lnbmF0dXJlVHlwZUlucHV0IiksCiAgICAgIGRyYXdCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZGRTaWduYXR1cmVEcmF3QnV0dG9uIiksCiAgICAgIGRyYXdTVkc6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZGRTaWduYXR1cmVEcmF3IiksCiAgICAgIGRyYXdQbGFjZWhvbGRlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFkZFNpZ25hdHVyZURyYXdQbGFjZWhvbGRlciIpLAogICAgICBkcmF3VGhpY2tuZXNzOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWRkU2lnbmF0dXJlRHJhd1RoaWNrbmVzcyIpLAogICAgICBpbWFnZUJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFkZFNpZ25hdHVyZUltYWdlQnV0dG9uIiksCiAgICAgIGltYWdlU1ZHOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWRkU2lnbmF0dXJlSW1hZ2UiKSwKICAgICAgaW1hZ2VQbGFjZWhvbGRlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFkZFNpZ25hdHVyZUltYWdlUGxhY2Vob2xkZXIiKSwKICAgICAgaW1hZ2VQaWNrZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZGRTaWduYXR1cmVGaWxlUGlja2VyIiksCiAgICAgIGltYWdlUGlja2VyTGluazogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFkZFNpZ25hdHVyZUltYWdlQnJvd3NlIiksCiAgICAgIGRlc2NyaXB0aW9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWRkU2lnbmF0dXJlRGVzY3JpcHRpb24iKSwKICAgICAgY2xlYXJCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjbGVhclNpZ25hdHVyZUJ1dHRvbiIpLAogICAgICBzYXZlQ29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWRkU2lnbmF0dXJlU2F2ZUNvbnRhaW5lciIpLAogICAgICBzYXZlQ2hlY2tib3g6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZGRTaWduYXR1cmVTYXZlQ2hlY2tib3giKSwKICAgICAgZXJyb3JCYXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZGRTaWduYXR1cmVFcnJvciIpLAogICAgICBlcnJvckNsb3NlQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWRkU2lnbmF0dXJlRXJyb3JDbG9zZUJ1dHRvbiIpLAogICAgICBjYW5jZWxCdXR0b246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZGRTaWduYXR1cmVDYW5jZWxCdXR0b24iKSwKICAgICAgYWRkQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWRkU2lnbmF0dXJlQWRkQnV0dG9uIikKICAgIH0sCiAgICBlZGl0U2lnbmF0dXJlRGlhbG9nOiB7CiAgICAgIGRpYWxvZzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRTaWduYXR1cmVEZXNjcmlwdGlvbkRpYWxvZyIpLAogICAgICBkZXNjcmlwdGlvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRTaWduYXR1cmVEZXNjcmlwdGlvbiIpLAogICAgICBlZGl0U2lnbmF0dXJlVmlldzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRTaWduYXR1cmVWaWV3IiksCiAgICAgIGNhbmNlbEJ1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRTaWduYXR1cmVDYW5jZWxCdXR0b24iKSwKICAgICAgdXBkYXRlQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdFNpZ25hdHVyZVVwZGF0ZUJ1dHRvbiIpCiAgICB9LAogICAgYW5ub3RhdGlvbkVkaXRvclBhcmFtczogewogICAgICBlZGl0b3JGcmVlVGV4dEZvbnRTaXplOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yRnJlZVRleHRGb250U2l6ZSIpLAogICAgICBlZGl0b3JGcmVlVGV4dENvbG9yOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yRnJlZVRleHRDb2xvciIpLAogICAgICBlZGl0b3JJbmtDb2xvcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvcklua0NvbG9yIiksCiAgICAgIGVkaXRvcklua1RoaWNrbmVzczogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvcklua1RoaWNrbmVzcyIpLAogICAgICBlZGl0b3JJbmtPcGFjaXR5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9ySW5rT3BhY2l0eSIpLAogICAgICBlZGl0b3JTdGFtcEFkZEltYWdlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yU3RhbXBBZGRJbWFnZSIpLAogICAgICBlZGl0b3JTaWduYXR1cmVBZGRTaWduYXR1cmU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0b3JTaWduYXR1cmVBZGRTaWduYXR1cmUiKSwKICAgICAgZWRpdG9yRnJlZUhpZ2hsaWdodFRoaWNrbmVzczogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvckZyZWVIaWdobGlnaHRUaGlja25lc3MiKSwKICAgICAgZWRpdG9ySGlnaGxpZ2h0U2hvd0FsbDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvckhpZ2hsaWdodFNob3dBbGwiKQogICAgfSwKICAgIHByaW50Q29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJpbnRDb250YWluZXIiKSwKICAgIGVkaXRvclVuZG9CYXI6IHsKICAgICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yVW5kb0JhciIpLAogICAgICBtZXNzYWdlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yVW5kb0Jhck1lc3NhZ2UiKSwKICAgICAgdW5kb0J1dHRvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvclVuZG9CYXJVbmRvQnV0dG9uIiksCiAgICAgIGNsb3NlQnV0dG9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yVW5kb0JhckNsb3NlQnV0dG9uIikKICAgIH0KICB9Owp9CmZ1bmN0aW9uIHdlYlZpZXdlckxvYWQoKSB7CiAgY29uc3QgY29uZmlnID0gZ2V0Vmlld2VyQ29uZmlndXJhdGlvbigpOwogIGNvbnN0IGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCJ3ZWJ2aWV3ZXJsb2FkZWQiLCB7CiAgICBidWJibGVzOiB0cnVlLAogICAgY2FuY2VsYWJsZTogdHJ1ZSwKICAgIGRldGFpbDogewogICAgICBzb3VyY2U6IHdpbmRvdwogICAgfQogIH0pOwogIHRyeSB7CiAgICBwYXJlbnQuZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgfSBjYXRjaCAoZXgpIHsKICAgIGNvbnNvbGUuZXJyb3IoIndlYnZpZXdlcmxvYWRlZDoiLCBleCk7CiAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKICB9CiAgUERGVmlld2VyQXBwbGljYXRpb24ucnVuKGNvbmZpZyk7Cn0KZG9jdW1lbnQuYmxvY2tVbmJsb2NrT25sb2FkPy4odHJ1ZSk7CmlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiaW50ZXJhY3RpdmUiIHx8IGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIpIHsKICB3ZWJWaWV3ZXJMb2FkKCk7Cn0gZWxzZSB7CiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIHdlYlZpZXdlckxvYWQsIHRydWUpOwp9CgpleHBvcnQgeyBQREZWaWV3ZXJBcHBsaWNhdGlvbiwgQXBwQ29uc3RhbnRzIGFzIFBERlZpZXdlckFwcGxpY2F0aW9uQ29uc3RhbnRzLCBBcHBPcHRpb25zIGFzIFBERlZpZXdlckFwcGxpY2F0aW9uT3B0aW9ucyB9OwoKLy8jIHNvdXJjZU1hcHBpbmdVUkw9dmlld2VyLm1qcy5tYXA=" type="module"></script>
  </head>

  <body tabindex="0">
    <div id="outerContainer">

      <div id="sidebarContainer">
        <div id="toolbarSidebar" class="toolbarHorizontalGroup">
          <div id="toolbarSidebarLeft">
            <div id="sidebarViewButtons" class="toolbarHorizontalGroup toggled" role="radiogroup">
              <button id="viewThumbnail" class="toolbarButton toggled" type="button" tabindex="0" data-l10n-id="pdfjs-thumbs-button" role="radio" aria-checked="true" aria-controls="thumbnailView">
                 <span data-l10n-id="pdfjs-thumbs-button-label"></span>
              </button>
              <button id="viewOutline" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-document-outline-button" role="radio" aria-checked="false" aria-controls="outlineView">
                 <span data-l10n-id="pdfjs-document-outline-button-label"></span>
              </button>
              <button id="viewAttachments" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-attachments-button" role="radio" aria-checked="false" aria-controls="attachmentsView">
                 <span data-l10n-id="pdfjs-attachments-button-label"></span>
              </button>
              <button id="viewLayers" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-layers-button" role="radio" aria-checked="false" aria-controls="layersView">
                 <span data-l10n-id="pdfjs-layers-button-label"></span>
              </button>
            </div>
          </div>

          <div id="toolbarSidebarRight">
            <div id="outlineOptionsContainer" class="toolbarHorizontalGroup">
              <div class="verticalToolbarSeparator"></div>

              <button id="currentOutlineItem" class="toolbarButton" type="button" disabled="disabled" tabindex="0" data-l10n-id="pdfjs-current-outline-item-button">
                <span data-l10n-id="pdfjs-current-outline-item-button-label"></span>
              </button>
            </div>
          </div>
        </div>
        <div id="sidebarContent">
          <div id="thumbnailView">
          </div>
          <div id="outlineView" class="hidden">
          </div>
          <div id="attachmentsView" class="hidden">
          </div>
          <div id="layersView" class="hidden">
          </div>
        </div>
        <div id="sidebarResizer"></div>
      </div>  <!-- sidebarContainer -->

      <div id="mainContainer">
        <div class="toolbar">
          <div id="toolbarContainer">
            <div id="toolbarViewer" class="toolbarHorizontalGroup">
              <div id="toolbarViewerLeft" class="toolbarHorizontalGroup">
                <button id="sidebarToggleButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-toggle-sidebar-button" aria-expanded="false" aria-haspopup="true" aria-controls="sidebarContainer">
                  <span data-l10n-id="pdfjs-toggle-sidebar-button-label"></span>
                </button>
                <div class="toolbarButtonSpacer"></div>
                <div class="toolbarButtonWithContainer">
                  <button id="viewFindButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-findbar-button" aria-expanded="false" aria-controls="findbar">
                    <span data-l10n-id="pdfjs-findbar-button-label"></span>
                  </button>
                  <div class="hidden doorHanger toolbarHorizontalGroup" id="findbar">
                    <div id="findInputContainer" class="toolbarHorizontalGroup">
                      <span class="loadingInput end toolbarHorizontalGroup">
                        <input id="findInput" class="toolbarField" tabindex="0" data-l10n-id="pdfjs-find-input" aria-invalid="false">
                      </span>
                      <div class="toolbarHorizontalGroup">
                        <button id="findPreviousButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-find-previous-button">
                          <span data-l10n-id="pdfjs-find-previous-button-label"></span>
                        </button>
                        <div class="splitToolbarButtonSeparator"></div>
                        <button id="findNextButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-find-next-button">
                          <span data-l10n-id="pdfjs-find-next-button-label"></span>
                        </button>
                      </div>
                    </div>

                    <div id="findbarOptionsOneContainer" class="toolbarHorizontalGroup">
                      <div class="toggleButton toolbarLabel">
                        <input type="checkbox" id="findHighlightAll" tabindex="0" />
                        <label for="findHighlightAll" data-l10n-id="pdfjs-find-highlight-checkbox"></label>
                      </div>
                      <div class="toggleButton toolbarLabel">
                        <input type="checkbox" id="findMatchCase" tabindex="0" />
                        <label for="findMatchCase" data-l10n-id="pdfjs-find-match-case-checkbox-label"></label>
                      </div>
                    </div>
                    <div id="findbarOptionsTwoContainer" class="toolbarHorizontalGroup">
                      <div class="toggleButton toolbarLabel">
                        <input type="checkbox" id="findMatchDiacritics" tabindex="0" />
                        <label for="findMatchDiacritics" data-l10n-id="pdfjs-find-match-diacritics-checkbox-label"></label>
                      </div>
                      <div class="toggleButton toolbarLabel">
                        <input type="checkbox" id="findEntireWord" tabindex="0" />
                        <label for="findEntireWord" data-l10n-id="pdfjs-find-entire-word-checkbox-label"></label>
                      </div>
                    </div>

                    <div id="findbarMessageContainer" class="toolbarHorizontalGroup" aria-live="polite">
                      <span id="findResultsCount" class="toolbarLabel"></span>
                      <span id="findMsg" class="toolbarLabel"></span>
                    </div>
                  </div>  <!-- findbar -->
                </div>
                <div class="toolbarHorizontalGroup hiddenSmallView">
                  <button class="toolbarButton" type="button" id="previous" tabindex="0" data-l10n-id="pdfjs-previous-button">
                    <span data-l10n-id="pdfjs-previous-button-label"></span>
                  </button>
                  <div class="splitToolbarButtonSeparator"></div>
                  <button class="toolbarButton" type="button" id="next" tabindex="0" data-l10n-id="pdfjs-next-button">
                    <span data-l10n-id="pdfjs-next-button-label"></span>
                  </button>
                </div>
                <div class="toolbarHorizontalGroup">
                  <span class="loadingInput start toolbarHorizontalGroup">
                    <input type="number" id="pageNumber" class="toolbarField" value="1" min="1" tabindex="0" data-l10n-id="pdfjs-page-input" autocomplete="off">
                  </span>
                  <span id="numPages" class="toolbarLabel"></span>
                </div>
              </div>
              <div id="toolbarViewerMiddle" class="toolbarHorizontalGroup">
                <div class="toolbarHorizontalGroup">
                  <button id="zoomOutButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-zoom-out-button">
                    <span data-l10n-id="pdfjs-zoom-out-button-label"></span>
                  </button>
                  <div class="splitToolbarButtonSeparator"></div>
                  <button id="zoomInButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-zoom-in-button">
                    <span data-l10n-id="pdfjs-zoom-in-button-label"></span>
                  </button>
                </div>
                <span id="scaleSelectContainer" class="dropdownToolbarButton">
                  <select id="scaleSelect" tabindex="0" data-l10n-id="pdfjs-zoom-select">
                    <option id="pageAutoOption" value="auto" selected="selected" data-l10n-id="pdfjs-page-scale-auto"></option>
                    <option id="pageActualOption" value="page-actual" data-l10n-id="pdfjs-page-scale-actual"></option>
                    <option id="pageFitOption" value="page-fit" data-l10n-id="pdfjs-page-scale-fit"></option>
                    <option id="pageWidthOption" value="page-width" data-l10n-id="pdfjs-page-scale-width"></option>
                    <option id="customScaleOption" value="custom" disabled="disabled" hidden="true" data-l10n-id="pdfjs-page-scale-percent" data-l10n-args='{ "scale": 0 }'></option>
                    <option value="0.5" data-l10n-id="pdfjs-page-scale-percent" data-l10n-args='{ "scale": 50 }'></option>
                    <option value="0.75" data-l10n-id="pdfjs-page-scale-percent" data-l10n-args='{ "scale": 75 }'></option>
                    <option value="1" data-l10n-id="pdfjs-page-scale-percent" data-l10n-args='{ "scale": 100 }'></option>
                    <option value="1.25" data-l10n-id="pdfjs-page-scale-percent" data-l10n-args='{ "scale": 125 }'></option>
                    <option value="1.5" data-l10n-id="pdfjs-page-scale-percent" data-l10n-args='{ "scale": 150 }'></option>
                    <option value="2" data-l10n-id="pdfjs-page-scale-percent" data-l10n-args='{ "scale": 200 }'></option>
                    <option value="3" data-l10n-id="pdfjs-page-scale-percent" data-l10n-args='{ "scale": 300 }'></option>
                    <option value="4" data-l10n-id="pdfjs-page-scale-percent" data-l10n-args='{ "scale": 400 }'></option>
                  </select>
                </span>
              </div>
              <div id="toolbarViewerRight" class="toolbarHorizontalGroup">
                <div id="editorModeButtons" class="toolbarHorizontalGroup" role="radiogroup">
                  <div id="editorSignature" class="toolbarButtonWithContainer" hidden="true">
                    <button id="editorSignatureButton" class="toolbarButton" type="button" tabindex="0" disabled="disabled" role="radio" aria-expanded="false" aria-haspopup="true" aria-controls="editorSignatureParamsToolbar" data-l10n-id="pdfjs-editor-signature-button">
                      <span data-l10n-id="pdfjs-editor-signature-button-label"></span>
                    </button>
                    <div class="editorParamsToolbar hidden doorHangerRight menu" id="editorSignatureParamsToolbar">
                      <div id="addSignatureDoorHanger" class="menuContainer" role="region" data-l10n-id="pdfjs-editor-add-signature-container">
                        <button id="editorSignatureAddSignature" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-editor-signature-add-signature-button">
                          <span data-l10n-id="pdfjs-editor-signature-add-signature-button-label" class="editorParamsLabel"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div id="editorHighlight" class="toolbarButtonWithContainer">
                    <button id="editorHighlightButton" class="toolbarButton" type="button" disabled="disabled" role="radio" aria-expanded="false" aria-haspopup="true" aria-controls="editorHighlightParamsToolbar" tabindex="0" data-l10n-id="pdfjs-editor-highlight-button">
                      <span data-l10n-id="pdfjs-editor-highlight-button-label"></span>
                    </button>
                    <div class="editorParamsToolbar hidden doorHangerRight" id="editorHighlightParamsToolbar">
                      <div id="highlightParamsToolbarContainer" class="editorParamsToolbarContainer">
                        <div id="editorHighlightColorPicker" class="colorPicker">
                          <span id="highlightColorPickerLabel" class="editorParamsLabel" data-l10n-id="pdfjs-editor-highlight-colorpicker-label"></span>
                        </div>
                        <div id="editorHighlightThickness">
                          <label for="editorFreeHighlightThickness" class="editorParamsLabel" data-l10n-id="pdfjs-editor-free-highlight-thickness-input"></label>
                          <div class="thicknessPicker">
                            <input type="range" id="editorFreeHighlightThickness" class="editorParamsSlider" data-l10n-id="pdfjs-editor-free-highlight-thickness-title" value="12" min="8" max="24" step="1" tabindex="0">
                          </div>
                        </div>
                        <div id="editorHighlightVisibility">
                          <div class="divider"></div>
                          <div class="toggler">
                            <label for="editorHighlightShowAll" class="editorParamsLabel" data-l10n-id="pdfjs-editor-highlight-show-all-button-label"></label>
                            <button id="editorHighlightShowAll" class="toggle-button" type="button" data-l10n-id="pdfjs-editor-highlight-show-all-button" aria-pressed="true" tabindex="0"></button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div id="editorFreeText" class="toolbarButtonWithContainer">
                    <button id="editorFreeTextButton" class="toolbarButton" type="button" disabled="disabled" role="radio" aria-expanded="false" aria-haspopup="true" aria-controls="editorFreeTextParamsToolbar" tabindex="0" data-l10n-id="pdfjs-editor-free-text-button">
                      <span data-l10n-id="pdfjs-editor-free-text-button-label"></span>
                    </button>
                    <div class="editorParamsToolbar hidden doorHangerRight" id="editorFreeTextParamsToolbar">
                      <div class="editorParamsToolbarContainer">
                        <div class="editorParamsSetter">
                          <label for="editorFreeTextColor" class="editorParamsLabel" data-l10n-id="pdfjs-editor-free-text-color-input"></label>
                          <input type="color" id="editorFreeTextColor" class="editorParamsColor" tabindex="0">
                        </div>
                        <div class="editorParamsSetter">
                          <label for="editorFreeTextFontSize" class="editorParamsLabel" data-l10n-id="pdfjs-editor-free-text-size-input"></label>
                          <input type="range" id="editorFreeTextFontSize" class="editorParamsSlider" value="10" min="5" max="100" step="1" tabindex="0">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div id="editorInk" class="toolbarButtonWithContainer">
                    <button id="editorInkButton" class="toolbarButton" type="button" disabled="disabled" role="radio" aria-expanded="false" aria-haspopup="true" aria-controls="editorInkParamsToolbar" tabindex="0" data-l10n-id="pdfjs-editor-ink-button">
                      <span data-l10n-id="pdfjs-editor-ink-button-label"></span>
                    </button>
                    <div class="editorParamsToolbar hidden doorHangerRight" id="editorInkParamsToolbar">
                      <div class="editorParamsToolbarContainer">
                        <div class="editorParamsSetter">
                          <label for="editorInkColor" class="editorParamsLabel" data-l10n-id="pdfjs-editor-ink-color-input"></label>
                          <input type="color" id="editorInkColor" class="editorParamsColor" tabindex="0">
                        </div>
                        <div class="editorParamsSetter">
                          <label for="editorInkThickness" class="editorParamsLabel" data-l10n-id="pdfjs-editor-ink-thickness-input"></label>
                          <input type="range" id="editorInkThickness" class="editorParamsSlider" value="1" min="1" max="20" step="1" tabindex="0">
                        </div>
                        <div class="editorParamsSetter">
                          <label for="editorInkOpacity" class="editorParamsLabel" data-l10n-id="pdfjs-editor-ink-opacity-input"></label>
                          <input type="range" id="editorInkOpacity" class="editorParamsSlider" value="1" min="0.05" max="1" step="0.05" tabindex="0">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div id="editorStamp" class="toolbarButtonWithContainer">
                    <button id="editorStampButton" class="toolbarButton" type="button" disabled="disabled" role="radio" aria-expanded="false" aria-haspopup="true" aria-controls="editorStampParamsToolbar" tabindex="0" data-l10n-id="pdfjs-editor-stamp-button">
                      <span data-l10n-id="pdfjs-editor-stamp-button-label"></span>
                    </button>
                    <div class="editorParamsToolbar hidden doorHangerRight menu" id="editorStampParamsToolbar">
                      <div class="menuContainer">
                        <button id="editorStampAddImage" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-editor-stamp-add-image-button">
                          <span class="editorParamsLabel" data-l10n-id="pdfjs-editor-stamp-add-image-button-label"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div id="editorModeSeparator" class="verticalToolbarSeparator"></div>

                <div class="toolbarHorizontalGroup hiddenMediumView">
                  <button id="printButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-print-button">
                    <span data-l10n-id="pdfjs-print-button-label"></span>
                  </button>

                  <button id="downloadButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-save-button">
                    <span data-l10n-id="pdfjs-save-button-label"></span>
                  </button>
                </div>

                <div class="verticalToolbarSeparator hiddenMediumView"></div>

                <div id="secondaryToolbarToggle" class="toolbarButtonWithContainer">
                  <button id="secondaryToolbarToggleButton" class="toolbarButton" type="button" tabindex="0" data-l10n-id="pdfjs-tools-button" aria-expanded="false" aria-haspopup="true" aria-controls="secondaryToolbar">
                    <span data-l10n-id="pdfjs-tools-button-label"></span>
                  </button>
                  <div id="secondaryToolbar" class="hidden doorHangerRight menu">
                    <div id="secondaryToolbarButtonContainer" class="menuContainer">
                      <button id="secondaryOpenFile" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-open-file-button">
                        <span data-l10n-id="pdfjs-open-file-button-label"></span>
                      </button>

                      <div class="visibleMediumView">
                        <button id="secondaryPrint" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-print-button">
                          <span data-l10n-id="pdfjs-print-button-label"></span>
                        </button>

                        <button id="secondaryDownload" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-save-button">
                          <span data-l10n-id="pdfjs-save-button-label"></span>
                        </button>

                      </div>

                      <div class="horizontalToolbarSeparator"></div>

                      <button id="presentationMode" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-presentation-mode-button">
                        <span data-l10n-id="pdfjs-presentation-mode-button-label"></span>
                      </button>

                      <a href="#" id="viewBookmark" class="toolbarButton labeled" tabindex="0" data-l10n-id="pdfjs-bookmark-button">
                        <span data-l10n-id="pdfjs-bookmark-button-label"></span>
                      </a>

                      <div id="viewBookmarkSeparator" class="horizontalToolbarSeparator"></div>

                      <button id="firstPage" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-first-page-button">
                        <span data-l10n-id="pdfjs-first-page-button-label"></span>
                      </button>
                      <button id="lastPage" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-last-page-button">
                        <span data-l10n-id="pdfjs-last-page-button-label"></span>
                      </button>

                      <div class="horizontalToolbarSeparator"></div>

                      <button id="pageRotateCw" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-page-rotate-cw-button">
                        <span data-l10n-id="pdfjs-page-rotate-cw-button-label"></span>
                      </button>
                      <button id="pageRotateCcw" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-page-rotate-ccw-button">
                        <span data-l10n-id="pdfjs-page-rotate-ccw-button-label"></span>
                      </button>

                      <div class="horizontalToolbarSeparator"></div>

                      <div id="cursorToolButtons" role="radiogroup">
                        <button id="cursorSelectTool" class="toolbarButton labeled toggled" type="button" tabindex="0" data-l10n-id="pdfjs-cursor-text-select-tool-button" role="radio" aria-checked="true">
                          <span data-l10n-id="pdfjs-cursor-text-select-tool-button-label"></span>
                        </button>
                        <button id="cursorHandTool" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-cursor-hand-tool-button" role="radio" aria-checked="false">
                          <span data-l10n-id="pdfjs-cursor-hand-tool-button-label"></span>
                        </button>
                      </div>

                      <div class="horizontalToolbarSeparator"></div>

                      <div id="scrollModeButtons" role="radiogroup">
                        <button id="scrollPage" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-scroll-page-button" role="radio" aria-checked="false">
                          <span data-l10n-id="pdfjs-scroll-page-button-label"></span>
                        </button>
                        <button id="scrollVertical" class="toolbarButton labeled toggled" type="button" tabindex="0" data-l10n-id="pdfjs-scroll-vertical-button" role="radio" aria-checked="true">
                          <span data-l10n-id="pdfjs-scroll-vertical-button-label"></span>
                        </button>
                        <button id="scrollHorizontal" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-scroll-horizontal-button" role="radio" aria-checked="false">
                          <span data-l10n-id="pdfjs-scroll-horizontal-button-label"></span>
                        </button>
                        <button id="scrollWrapped" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-scroll-wrapped-button" role="radio" aria-checked="false">
                          <span data-l10n-id="pdfjs-scroll-wrapped-button-label"></span>
                        </button>
                      </div>

                      <div class="horizontalToolbarSeparator"></div>

                      <div id="spreadModeButtons" role="radiogroup">
                        <button id="spreadNone" class="toolbarButton labeled toggled" type="button" tabindex="0" data-l10n-id="pdfjs-spread-none-button" role="radio" aria-checked="true">
                          <span data-l10n-id="pdfjs-spread-none-button-label"></span>
                        </button>
                        <button id="spreadOdd" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-spread-odd-button" role="radio" aria-checked="false">
                          <span data-l10n-id="pdfjs-spread-odd-button-label"></span>
                        </button>
                        <button id="spreadEven" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-spread-even-button" role="radio" aria-checked="false">
                          <span data-l10n-id="pdfjs-spread-even-button-label"></span>
                        </button>
                      </div>

                      <div id="imageAltTextSettingsSeparator" class="horizontalToolbarSeparator hidden"></div>
                      <button id="imageAltTextSettings" type="button" class="toolbarButton labeled hidden" tabindex="0" data-l10n-id="pdfjs-image-alt-text-settings-button" aria-controls="altTextSettingsDialog">
                        <span data-l10n-id="pdfjs-image-alt-text-settings-button-label"></span>
                      </button>

                      <div class="horizontalToolbarSeparator"></div>

                      <button id="documentProperties" class="toolbarButton labeled" type="button" tabindex="0" data-l10n-id="pdfjs-document-properties-button" aria-controls="documentPropertiesDialog">
                        <span data-l10n-id="pdfjs-document-properties-button-label"></span>
                      </button>
                    </div>
                  </div>  <!-- secondaryToolbar -->
                </div>
              </div>
            </div>
            <div id="loadingBar">
              <div class="progress">
                <div class="glimmer">
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="viewerContainer" tabindex="0">
          <div id="viewer" class="pdfViewer"></div>
        </div>
      </div> <!-- mainContainer -->

      <div id="dialogContainer">
        <dialog id="passwordDialog">
          <div class="row">
            <label for="password" id="passwordText" data-l10n-id="pdfjs-password-label"></label>
          </div>
          <div class="row">
            <input type="password" id="password" class="toolbarField">
          </div>
          <div class="buttonRow">
            <button id="passwordCancel" class="dialogButton" type="button"><span data-l10n-id="pdfjs-password-cancel-button"></span></button>
            <button id="passwordSubmit" class="dialogButton" type="button"><span data-l10n-id="pdfjs-password-ok-button"></span></button>
          </div>
        </dialog>
        <dialog id="documentPropertiesDialog">
          <div class="row">
            <span id="fileNameLabel" data-l10n-id="pdfjs-document-properties-file-name"></span>
            <p id="fileNameField" aria-labelledby="fileNameLabel">-</p>
          </div>
          <div class="row">
            <span id="fileSizeLabel" data-l10n-id="pdfjs-document-properties-file-size"></span>
            <p id="fileSizeField" aria-labelledby="fileSizeLabel">-</p>
          </div>
          <div class="separator"></div>
          <div class="row">
            <span id="titleLabel" data-l10n-id="pdfjs-document-properties-title"></span>
            <p id="titleField" aria-labelledby="titleLabel">-</p>
          </div>
          <div class="row">
            <span id="authorLabel" data-l10n-id="pdfjs-document-properties-author"></span>
            <p id="authorField" aria-labelledby="authorLabel">-</p>
          </div>
          <div class="row">
            <span id="subjectLabel" data-l10n-id="pdfjs-document-properties-subject"></span>
            <p id="subjectField" aria-labelledby="subjectLabel">-</p>
          </div>
          <div class="row">
            <span id="keywordsLabel" data-l10n-id="pdfjs-document-properties-keywords"></span>
            <p id="keywordsField" aria-labelledby="keywordsLabel">-</p>
          </div>
          <div class="row">
            <span id="creationDateLabel" data-l10n-id="pdfjs-document-properties-creation-date"></span>
            <p id="creationDateField" aria-labelledby="creationDateLabel">-</p>
          </div>
          <div class="row">
            <span id="modificationDateLabel" data-l10n-id="pdfjs-document-properties-modification-date"></span>
            <p id="modificationDateField" aria-labelledby="modificationDateLabel">-</p>
          </div>
          <div class="row">
            <span id="creatorLabel" data-l10n-id="pdfjs-document-properties-creator"></span>
            <p id="creatorField" aria-labelledby="creatorLabel">-</p>
          </div>
          <div class="separator"></div>
          <div class="row">
            <span id="producerLabel" data-l10n-id="pdfjs-document-properties-producer"></span>
            <p id="producerField" aria-labelledby="producerLabel">-</p>
          </div>
          <div class="row">
            <span id="versionLabel" data-l10n-id="pdfjs-document-properties-version"></span>
            <p id="versionField" aria-labelledby="versionLabel">-</p>
          </div>
          <div class="row">
            <span id="pageCountLabel" data-l10n-id="pdfjs-document-properties-page-count"></span>
            <p id="pageCountField" aria-labelledby="pageCountLabel">-</p>
          </div>
          <div class="row">
            <span id="pageSizeLabel" data-l10n-id="pdfjs-document-properties-page-size"></span>
            <p id="pageSizeField" aria-labelledby="pageSizeLabel">-</p>
          </div>
          <div class="separator"></div>
          <div class="row">
            <span id="linearizedLabel" data-l10n-id="pdfjs-document-properties-linearized"></span>
            <p id="linearizedField" aria-labelledby="linearizedLabel">-</p>
          </div>
          <div class="buttonRow">
            <button id="documentPropertiesClose" class="dialogButton" type="button"><span data-l10n-id="pdfjs-document-properties-close-button"></span></button>
          </div>
        </dialog>
        <dialog class="dialog altText" id="altTextDialog" aria-labelledby="dialogLabel" aria-describedby="dialogDescription">
          <div id="altTextContainer" class="mainContainer">
            <div id="overallDescription">
              <span id="dialogLabel" data-l10n-id="pdfjs-editor-alt-text-dialog-label" class="title"></span>
              <span id="dialogDescription" data-l10n-id="pdfjs-editor-alt-text-dialog-description"></span>
            </div>
            <div id="addDescription">
              <div class="radio">
                <div class="radioButton">
                  <input type="radio" id="descriptionButton" name="altTextOption" tabindex="0" aria-describedby="descriptionAreaLabel" checked>
                  <label for="descriptionButton" data-l10n-id="pdfjs-editor-alt-text-add-description-label"></label>
                </div>
                <div class="radioLabel">
                  <span id="descriptionAreaLabel" data-l10n-id="pdfjs-editor-alt-text-add-description-description"></span>
                </div>
              </div>
              <div class="descriptionArea">
                <textarea id="descriptionTextarea" aria-labelledby="descriptionAreaLabel" data-l10n-id="pdfjs-editor-alt-text-textarea" tabindex="0"></textarea>
              </div>
            </div>
            <div id="markAsDecorative">
              <div class="radio">
                <div class="radioButton">
                  <input type="radio" id="decorativeButton" name="altTextOption" aria-describedby="decorativeLabel">
                  <label for="decorativeButton" data-l10n-id="pdfjs-editor-alt-text-mark-decorative-label"></label>
                </div>
                <div class="radioLabel">
                  <span id="decorativeLabel" data-l10n-id="pdfjs-editor-alt-text-mark-decorative-description"></span>
                </div>
              </div>
            </div>
            <div id="buttons">
              <button id="altTextCancel" class="secondaryButton" type="button" tabindex="0"><span data-l10n-id="pdfjs-editor-alt-text-cancel-button"></span></button>
              <button id="altTextSave" class="primaryButton" type="button" tabindex="0"><span data-l10n-id="pdfjs-editor-alt-text-save-button"></span></button>
            </div>
          </div>
        </dialog>
        <dialog class="dialog newAltText" id="newAltTextDialog" aria-labelledby="newAltTextTitle" aria-describedby="newAltTextDescription" tabindex="0">
          <div id="newAltTextContainer" class="mainContainer">
            <div class="title">
              <span id="newAltTextTitle" data-l10n-id="pdfjs-editor-new-alt-text-dialog-edit-label" role="sectionhead" tabindex="0"></span>
            </div>
            <div id="mainContent">
              <div id="descriptionAndSettings">
                <div id="descriptionInstruction">
                  <div id="newAltTextDescriptionContainer">
                    <div class="altTextSpinner" role="status" aria-live="polite"></div>
                    <textarea id="newAltTextDescriptionTextarea" aria-labelledby="descriptionAreaLabel" data-l10n-id="pdfjs-editor-new-alt-text-textarea" tabindex="0"></textarea>
                  </div>
                  <span id="newAltTextDescription" role="note" data-l10n-id="pdfjs-editor-new-alt-text-description"></span>
                  <div id="newAltTextDisclaimer" role="note"><div><span data-l10n-id="pdfjs-editor-new-alt-text-disclaimer1"></span> <a href="https://support.mozilla.org/en-US/kb/pdf-alt-text" target="_blank" rel="noopener noreferrer" id="newAltTextLearnMore" data-l10n-id="pdfjs-editor-new-alt-text-disclaimer-learn-more-url" tabindex="0"></a></div></div>
                </div>
                <div id="newAltTextCreateAutomatically" class="toggler">
                  <button id="newAltTextCreateAutomaticallyButton" class="toggle-button" type="button" aria-pressed="true" tabindex="0"></button>
                  <label for="newAltTextCreateAutomaticallyButton" class="togglerLabel" data-l10n-id="pdfjs-editor-new-alt-text-create-automatically-button-label"></label>
                </div>
                <div id="newAltTextDownloadModel" class="hidden">
                  <span id="newAltTextDownloadModelDescription" data-l10n-id="pdfjs-editor-new-alt-text-ai-model-downloading-progress" aria-valuemin="0" data-l10n-args='{ "totalSize": 0, "downloadedSize": 0 }'></span>
                </div>
              </div>
              <div id="newAltTextImagePreview"></div>
            </div>
            <div id="newAltTextError" class="messageBar">
              <div>
                <div>
                  <span class="title" data-l10n-id="pdfjs-editor-new-alt-text-error-title"></span>
                  <span  class="description" data-l10n-id="pdfjs-editor-new-alt-text-error-description"></span>
                </div>
                <button id="newAltTextCloseButton" class="closeButton" type="button" tabindex="0"><span data-l10n-id="pdfjs-editor-new-alt-text-error-close-button"></span></button>
              </div>
            </div>
            <div id="newAltTextButtons" class="dialogButtonsGroup">
              <button id="newAltTextCancel" type="button" class="secondaryButton hidden" tabindex="0"><span data-l10n-id="pdfjs-editor-alt-text-cancel-button"></span></button>
              <button id="newAltTextNotNow" type="button" class="secondaryButton" tabindex="0"><span data-l10n-id="pdfjs-editor-new-alt-text-not-now-button"></span></button>
              <button id="newAltTextSave" type="button" class="primaryButton" tabindex="0"><span data-l10n-id="pdfjs-editor-alt-text-save-button"></span></button>
            </div>
          </div>
        </dialog>

        <dialog class="dialog" id="altTextSettingsDialog" aria-labelledby="altTextSettingsTitle">
          <div id="altTextSettingsContainer" class="mainContainer">
            <div class="title">
              <span id="altTextSettingsTitle" data-l10n-id="pdfjs-editor-alt-text-settings-dialog-label" role="sectionhead" tabindex="0" class="title"></span>
            </div>
            <div id="automaticAltText">
              <span data-l10n-id="pdfjs-editor-alt-text-settings-automatic-title"></span>
              <div id="automaticSettings">
                <div id="createModelSetting">
                  <div class="toggler">
                    <button id="createModelButton" type="button" class="toggle-button" aria-pressed="true" tabindex="0"></button>
                    <label for="createModelButton" class="togglerLabel" data-l10n-id="pdfjs-editor-alt-text-settings-create-model-button-label"></label>
                  </div>
                  <div id="createModelDescription" class="description">
                    <span data-l10n-id="pdfjs-editor-alt-text-settings-create-model-description"></span> <a href="https://support.mozilla.org/en-US/kb/pdf-alt-text" target="_blank" rel="noopener noreferrer" id="altTextSettingsLearnMore" data-l10n-id="pdfjs-editor-new-alt-text-disclaimer-learn-more-url" tabindex="0"></a>
                  </div>
                </div>
                <div id="aiModelSettings">
                  <div>
                    <span data-l10n-id="pdfjs-editor-alt-text-settings-download-model-label" data-l10n-args='{ "totalSize": 180 }'></span>
                    <div id="aiModelDescription" class="description">
                      <span data-l10n-id="pdfjs-editor-alt-text-settings-ai-model-description"></span>
                    </div>
                  </div>
                  <button id="deleteModelButton" type="button" class="secondaryButton" tabindex="0"><span data-l10n-id="pdfjs-editor-alt-text-settings-delete-model-button"></span></button>
                  <button id="downloadModelButton" type="button" class="secondaryButton" tabindex="0"><span data-l10n-id="pdfjs-editor-alt-text-settings-download-model-button"></span></button>
                </div>
              </div>
            </div>
            <div class="dialogSeparator"></div>
            <div id="altTextEditor">
              <span data-l10n-id="pdfjs-editor-alt-text-settings-editor-title"></span>
              <div id="showAltTextEditor">
                <div class="toggler">
                  <button id="showAltTextDialogButton" type="button" class="toggle-button" aria-pressed="true" tabindex="0"></button>
                  <label for="showAltTextDialogButton" class="togglerLabel" data-l10n-id="pdfjs-editor-alt-text-settings-show-dialog-button-label"></label>
                </div>
                <div id="showAltTextDialogDescription" class="description">
                  <span data-l10n-id="pdfjs-editor-alt-text-settings-show-dialog-description"></span>
                </div>
              </div>
            </div>
            <div id="buttons" class="dialogButtonsGroup">
              <button id="altTextSettingsCloseButton" type="button" class="primaryButton" tabindex="0"><span data-l10n-id="pdfjs-editor-alt-text-settings-close-button"></span></button>
            </div>
          </div>
        </dialog>

        <dialog class="dialog signatureDialog" id="addSignatureDialog" aria-labelledby="addSignatureDialogLabel">
          <span id="addSignatureDialogLabel" data-l10n-id="pdfjs-editor-add-signature-dialog-label"></span>
          <div id="addSignatureContainer" class="mainContainer">
            <div class="title">
              <span role="sectionhead" data-l10n-id="pdfjs-editor-add-signature-dialog-title" tabindex="0"></span>
            </div>
            <div role="tablist" id="addSignatureOptions">
              <button id="addSignatureTypeButton" type="button" role="tab" aria-selected="true" aria-controls="addSignatureTypeContainer" data-l10n-id="pdfjs-editor-add-signature-type-button" tabindex="0"></button>
              <button id="addSignatureDrawButton" type="button" role="tab" aria-selected="false" aria-controls="addSignatureDrawContainer" data-l10n-id="pdfjs-editor-add-signature-draw-button" tabindex="0"></button>
              <button id="addSignatureImageButton" type="button" role="tab" aria-selected="false" aria-controls="addSignatureImageContainer" data-l10n-id="pdfjs-editor-add-signature-image-button" tabindex="-1"></button>
            </div>
            <div id="addSignatureActionContainer" data-selected="type">
              <div id="addSignatureTypeContainer" role="tabpanel" aria-labelledby="addSignatureTypeContainer">
                <input id="addSignatureTypeInput" type="text" data-l10n-id="pdfjs-editor-add-signature-type-input" tabindex="0"></input>
              </div>
              <div id="addSignatureDrawContainer" role="tabpanel" aria-labelledby="addSignatureDrawButton" tabindex="-1">
                <svg id="addSignatureDraw" xmlns="http://www.w3.org/2000/svg" aria-labelledby="addSignatureDrawPlaceholder"></svg>
                <span id="addSignatureDrawPlaceholder" data-l10n-id="pdfjs-editor-add-signature-draw-placeholder"></span>
                <div id="thickness">
                  <div>
                    <label for="addSignatureDrawThickness" data-l10n-id="pdfjs-editor-add-signature-draw-thickness-range-label"></label>
                    <input type="range" id="addSignatureDrawThickness" min="1" max="5" step="1" value="1" data-l10n-id="pdfjs-editor-add-signature-draw-thickness-range" data-l10n-args='{ "thickness": 1 }' tabindex="0">
                  </div>
                </div>
              </div>
              <div id="addSignatureImageContainer" role="tabpanel" aria-labelledby="addSignatureImageButton" tabindex="-1">
                <svg id="addSignatureImage" xmlns="http://www.w3.org/2000/svg" aria-labelledby="addSignatureImagePlaceholder"></svg>
                <div id="addSignatureImagePlaceholder">
                  <span data-l10n-id="pdfjs-editor-add-signature-image-placeholder"></span>
                  <label id="addSignatureImageBrowse" for="addSignatureFilePicker" tabindex="0">
                    <a data-l10n-id="pdfjs-editor-add-signature-image-browse-link"></a>
                  </label>
                  <input id="addSignatureFilePicker" type="file"></input>
                </div>
              </div>
              <div id="addSignatureControls">
                <div id="horizontalContainer">
                  <div id="addSignatureDescriptionContainer">
                    <label for="addSignatureDescInput" data-l10n-id="pdfjs-editor-add-signature-description-label"></label>
                    <span id="addSignatureDescription" class="inputWithClearButton">
                      <input id="addSignatureDescInput" type="text" data-l10n-id="pdfjs-editor-add-signature-description-input" tabindex="0"></input>
                      <button class="clearInputButton" type="button" tabindex="0" aria-hidden="true"></button>
                    </span>
                  </div>
                  <button id="clearSignatureButton" type="button" data-l10n-id="pdfjs-editor-add-signature-clear-button" tabindex="0"><span data-l10n-id="pdfjs-editor-add-signature-clear-button-label"></span></button>
                </div>
                <div id="addSignatureSaveContainer">
                  <input type="checkbox" id="addSignatureSaveCheckbox" checked="true"></input>
                  <label for="addSignatureSaveCheckbox" data-l10n-id="pdfjs-editor-add-signature-save-checkbox"></label>
                  <span></span>
                  <span id="addSignatureSaveWarning" data-l10n-id="pdfjs-editor-add-signature-save-warning-message"></span>
                </div>
              </div>
              <div id="addSignatureError" hidden="true" class="messageBar">
                <div>
                  <div>
                    <span class="title" data-l10n-id="pdfjs-editor-add-signature-image-upload-error-title"></span>
                    <span class="description" data-l10n-id="pdfjs-editor-add-signature-image-upload-error-description"></span>
                  </div>
                  <button id="addSignatureErrorCloseButton" class="closeButton" type="button" tabindex="0"><span data-l10n-id="pdfjs-editor-add-signature-error-close-button"></span></button>
                </div>
              </div>
              <div class="dialogButtonsGroup">
                <button id="addSignatureCancelButton" type="button" class="secondaryButton" tabindex="0"><span data-l10n-id="pdfjs-editor-add-signature-cancel-button"></span></button>
                <button id="addSignatureAddButton" type="button" class="primaryButton" disabled tabindex="0"><span data-l10n-id="pdfjs-editor-add-signature-add-button"></span></button>
              </div>
            </div>
          </div>
       </dialog>

       <dialog class="dialog signatureDialog" id="editSignatureDescriptionDialog" aria-labelledby="editSignatureDescriptionTitle">
        <div id="editSignatureDescriptionContainer" class="mainContainer">
          <div class="title">
            <span id="editSignatureDescriptionTitle" role="sectionhead" data-l10n-id="pdfjs-editor-edit-signature-dialog-title" tabindex="0"></span>
          </div>
          <div id="editSignatureDescriptionAndView">
            <div id="editSignatureDescriptionContainer">
              <label for="editSignatureDescInput" data-l10n-id="pdfjs-editor-add-signature-description-label"></label>
              <span id="editSignatureDescription" class="inputWithClearButton">
                <input id="editSignatureDescInput" type="text" data-l10n-id="pdfjs-editor-add-signature-description-input" tabindex="0"></input>
                <button class="clearInputButton" type="button" tabindex="0" aria-hidden="true"></button>
              </span>
            </div>
            <svg id="editSignatureView" xmlns="http://www.w3.org/2000/svg"></svg>
          </div>
          <div class="dialogButtonsGroup">
            <button id="editSignatureCancelButton" type="button" class="secondaryButton" tabindex="0"><span data-l10n-id="pdfjs-editor-add-signature-cancel-button"></span></button>
            <button id="editSignatureUpdateButton" type="button" class="primaryButton" disabled tabindex="0"><span data-l10n-id="pdfjs-editor-edit-signature-update-button"></span></button>
          </div>
        </div>
      </dialog>

        <dialog id="printServiceDialog" style="min-width: 200px;">
          <div class="row">
            <span data-l10n-id="pdfjs-print-progress-message"></span>
          </div>
          <div class="row">
            <progress value="0" max="100"></progress>
            <span data-l10n-id="pdfjs-print-progress-percent" data-l10n-args='{ "progress": 0 }' class="relative-progress">0%</span>
          </div>
          <div class="buttonRow">
            <button id="printCancel" class="dialogButton" type="button"><span data-l10n-id="pdfjs-print-progress-close-button"></span></button>
          </div>
        </dialog>
      </div>  <!-- dialogContainer -->

      <div id="editorUndoBar" class="messageBar" role="status" aria-labelledby="editorUndoBarMessage" tabindex="-1" hidden>
        <div>
          <div>
            <span id="editorUndoBarMessage" class="description"></span>
          </div>
          <button id="editorUndoBarUndoButton" class="undoButton" type="button" tabindex="0" data-l10n-id="pdfjs-editor-undo-bar-undo-button">
            <span data-l10n-id="pdfjs-editor-undo-bar-undo-button-label"></span>
          </button>
          <button id="editorUndoBarCloseButton" class="closeButton" type="button" tabindex="0" data-l10n-id="pdfjs-editor-undo-bar-close-button">
            <span data-l10n-id="pdfjs-editor-undo-bar-close-button-label"></span>
          </button>
        </div>
      </div> <!-- editorUndoBar -->

    </div> <!-- outerContainer -->
    <div id="printContainer"></div>
  </body>
</html>
